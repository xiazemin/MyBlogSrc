---
title: dto
layout: post
category: golang
author: å¤æ³½æ°‘
---
https://juejin.im/post/5ed9e10151882542e8541f01
modelå±‚ä¸å…è®¸ç”³æ˜json tagï¼Œ dtoå±‚åˆé‡å¤é€ è½®å­ï¼Œä¸€ä¸ªè¡¨çš„å­—æ®µå¯èƒ½20ä¸ªå·¦å³ï¼Œé‚£ä¹ˆèµ‹å€¼è¯­å¥éš¾å—æ­»äº†ã€‚
å…¶æ¬¡å°±æ˜¯jsonç›´æ¥è§£æï¼Œmodelå±‚çš„time.Timeï¼Œå®Œè›‹æ ¼å¼ä¸å¯¹ï¼Œè¿”å›çš„æ•°æ®ä¸å¯¹ã€‚
<!-- more -->
{% raw %}
æ¯”å¦‚
{
    "user_name": "xiaoli",
    "create_time": "2020-06-05T13:53:06.293614+08:00"
}
å¤åˆ¶ä»£ç è¿™ç§æƒ…å†µï¼Œæ— æ³•è§£å†³ï¼Œå°±éœ€è¦å¿…é¡»é‡å†™ä¸€ä¸ªdtoã€‚
é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Œæœ¬äººæ€è€ƒäº†ä¸€æ®µæ—¶é—´ï¼Œæœ€ç»ˆä½¿ç”¨Mapæ¥è§£å†³ã€‚
2ã€è§£å†³é—®é¢˜
1ã€åå°„
é‚£ä¹ˆåå°„ä¼šé‡åˆ°ï¼Œå„ç§å¥‡è‘©çš„ä¹¦å†™æ–¹å¼ï¼Œæœ‰äº›äººä»€ä¹ˆéƒ½å‡ºä¼ å…¥æŒ‡é’ˆï¼Œæœ‰äº›äººå„ç§interface{} éšè—è½¬æ¢ï¼Œåæ­£å°±æ˜¯å¤ªè¿‡äºå·®å¼‚åŒ–ã€‚
æ‰€ä»¥å°±æ˜¯éœ€è¦è§£å†³ï¼Œå¦‚ä½•å‡†ç¡®çš„æ‹¿åˆ°Valueå¯¹è±¡ï¼Œä¸‹é¢æ˜¯æˆ‘å†™çš„ä¸€ä¸ªå·¥å…·ç±»
func GetRealValue(value reflect.Value) reflect.Value {
	kind := value.Kind()
	if kind == reflect.Ptr {
		return GetRealValue(value.Elem())
	}
	if kind == reflect.Interface {
		// eg:var s2 interface{}
		//	s2 = User{}
		//	fmt.Println(reflect.ValueOf(&s2).Elem().Kind())// interface
		// æ‰€ä»¥è¿™é‡Œéœ€è¦å°†å®ƒè½¬æ¢
		if value.CanInterface() {
			return GetRealValue(reflect.ValueOf(value.Interface()))
		}
		return GetRealValue(value.Elem())
	}
	return value
}
å¤åˆ¶ä»£ç è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼€å¹²
2ã€ä¸‹åˆ’çº¿å‘½åæ³•
ä¸‹åˆ’çº¿å¦‚ä½•è§£å†³ï¼Œç»“æ„ä½“çš„å­—æ®µå±äºé©¼å³°å‘½åæ³•ï¼Œæ€ä¹ˆè§£å†³å‘¢ï¼Œä¸ºæ­¤ã€‚
å†™äº†ä¸€ä¸ªç®€å•çš„å·¥å…·ç±»
é—®é¢˜ï¼š1ã€å¦‚æœæ˜¯IDï¼Œè¿ç»­å¤§å†™ï¼Œè¾“å‡ºi_d
2ã€å› ä¸ºæ•°ç»„åˆ°åˆ‡ç‰‡éœ€è¦æ‹·è´ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨unsafeè§£å†³ï¼Œå› ä¸ºå­—ç¬¦ä¸²åº•å±‚å°±æ˜¯åˆ‡ç‰‡ï¼Œä½†æ˜¯ä¸å®‰å…¨
func CamelCase(s string) string {
	if s == "" {
		return ""
	}
	t := make([]byte, 0, 32)
	i := 0
	for ; i < len(s); i++ {
		c := s[i]
		if isASCIIDigit(c) {
			t = append(t, c)
			continue
		}
		if isASCIIUpper(c) {
			c ^= ' '
		}
		t = append(t, c)
		for i+1 < len(s) && isASCIIUpper(s[i+1]) {
			i++
			t = append(t, '_', s[i]+32)
		}
	}
	//return *(*string)(unsafe.Pointer(&t))
	return string(t)
}
func isASCIIUpper(c byte) bool {
	return 'A' <= c && c <= 'Z'
}

func isASCIIDigit(c byte) bool {
	return '0' <= c && c <= '9'
}
å¤åˆ¶ä»£ç 3ã€å¼€å¹²
1ã€è§£å†³timeçš„é—®é¢˜
2ã€åå°„ã€ä¸‹åˆ’çº¿å‘½åæ³•
func ToStdMap(bean interface{}) map[string]interface{} {
	_value := GetRealValue(reflect.ValueOf(bean))
	if _value.Kind() != reflect.Struct {
		panic("the bean mush struct")
	}
	_type := _value.Type()
	fieldNum := _value.NumField()
	_map := make(map[string]interface{}, fieldNum)
	for x := 0; x < fieldNum; x++ {
		field := _type.Field(x)
		value := GetRealValue(_value.Field(x))
		if value.CanInterface() {
			realValue := value.Interface()
			switch realValue.(type) {
			case time.Time:
				_map[CamelCase(field.Name)] = times.FormatStdTime(realValue.(time.Time))
			default:
				_map[CamelCase(field.Name)] = realValue
			}
		}
	}
	return _map
}
å¤åˆ¶ä»£ç 4ã€æµ‹è¯•
func TestObjToMap(t *testing.T) {
	users := Users{
		UserName: "xiaoli",
	}
	now := time.Now()
	users.CreateTime = &now
	stdMap := ToStdMap(users)
	bytes, err := json.Marshal(stdMap)
	if err != nil {
		t.Fatal(err)
	}
	fmt.Printf("%s\n", bytes)
}
å¤åˆ¶ä»£ç è¾“å‡ºç»“æœï¼š
å®Œç¾ï¼Œç¾ä¸­ä¸è¶³æ˜¯éœ€è¦ä½¿ç”¨likedMapï¼Œç”±äºGolangæºç åŒ…æ²¡æœ‰ï¼Œæ‰€ä»¥ğŸ˜“ï¼Œæ³¨å®šä¹±åº
{"create_time":"2020-06-05 14:05:31","user_name":"xiaoli"}
å¤åˆ¶ä»£ç å…³æ³¨ä¸‹é¢çš„æ ‡ç­¾ï¼Œå‘ç°æ›´å¤šç›¸ä¼¼æ–‡ç« 


{% endraw %}
