---
title: GO111MODULE
layout: post
category: golang
author: å¤æ³½æ°‘
---
Golangä¸€ç›´å­˜åœ¨ä¸€ä¸ªè¢«äººè¯Ÿç—…çš„é—®é¢˜æ˜¯ç¼ºå°‘ä¸€ä¸ªå®˜æ–¹çš„åŒ…ä¾èµ–ç®¡ç†å·¥å…·ã€‚ä»æˆ‘ä¸ªäººçš„è§’åº¦ä¸Šæ¥çœ‹å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š

GOPATHç‰¹æ€§å¯¹äºå¤šå·¥ç¨‹çš„æƒ…å†µä¸‹ï¼Œæ”¯æŒä¸ç®—å‹å¥½ã€‚
GOPATHæ— æ³•å¯¹ä¾èµ–åŒ…è¿›è¡Œæœ‰æ•ˆçš„ç‰ˆæœ¬ç®¡ç†ï¼Œæ²¡æœ‰ä»»ä½•åœ°æ–¹èƒ½å¤Ÿè¡¨æ˜ä¾èµ–åŒ…çš„å…·ä½“ç‰ˆæœ¬å·ï¼Œæ— æ³•ç®€å•æ¸…æ™°è·å–åˆ°æœ‰æ•ˆçš„ä¾èµ–åŒ…ç‰ˆæœ¬ä¿¡æ¯ç­‰ã€‚
GOPATH
åœ¨ go mod å‡ºç°ä¹‹å‰ï¼Œæ‰€æœ‰çš„ Go é¡¹ç›®éƒ½éœ€è¦æ”¾åœ¨åŒä¸€ä¸ªå·¥ä½œç©ºé—´ï¼š$GOPATH/srcÂ å†…ï¼Œæ¯”å¦‚ï¼š

src/
    github.com/golang/example/
        .git/                      # Git repository metadata
    outyet/
        main.go                # command source
        main_test.go           # test source
    stringutil/
        reverse.go             # package source
        reverse_test.go        # test source
ç›¸æ¯”å…¶ä»–è¯­è¨€ï¼Œè¿™ä¸ªé™åˆ¶æœ‰äº›æ— æ³•ç†è§£ã€‚å…¶å®ï¼Œè¿™å’Œ Go çš„ä¸€è®¾è®¡ç†å¿µç´§å¯†ç›¸å…³ï¼š

åŒ…ç®¡ç†åº”è¯¥æ˜¯å»ä¸­å¿ƒåŒ–çš„

æ‰€ä»¥ Go é‡Œé¢æ²¡æœ‰ maven/npm ä¹‹ç±»çš„åŒ…ç®¡ç†å·¥å…·ï¼Œåªæœ‰ä¸€ä¸ªÂ go getï¼Œæ”¯æŒä»å…¬å…±çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼ˆBitbucket/GitHub..ï¼‰ä¸‹è½½ä¾èµ–ï¼Œå½“ç„¶ä¹Ÿæ”¯æŒè‡ªå·±æ‰˜ç®¡ï¼Œå…·ä½“å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šRemote import pathsã€‚

ç”±äºæ²¡æœ‰ä¸­å¤®ä»“åº“ï¼Œæ‰€ä»¥ Go é¡¹ç›®ä½ç½®å†³å®šäº†å…¶ import pathï¼ŒåŒæ—¶ä¸ºäº†ä¸ go get ä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬çš„é¡¹ç›®åç§°éƒ½æ˜¯Â github.com/user/repoÂ çš„å½¢å¼ã€‚
å½“ç„¶ä¹Ÿå¯ä»¥ä¸æ˜¯è¿™ç§å½¢å¼ï¼Œåªæ˜¯ä¸æ–¹ä¾¿åˆ«äººå¼•ç”¨è€Œå·²ï¼Œåé¢ä¼šè®²åˆ°å¦‚ä½•åœ¨ go mod ä¸­å®ç°è¿™ç§æ•ˆæœ

vendorã€dep
ä½¿ç”¨Â go getÂ ä¸‹è½½ä¾èµ–çš„æ–¹å¼ç®€å•æš´åŠ›ï¼Œä¼´éšäº† Go ä¸ƒå¹´ä¹‹ä¹…ï¼Œç›´åˆ° 1.6ï¼ˆ2016/02/17ï¼‰æ‰æ­£å¼æ”¯æŒäº†Â vendorï¼Œå¯ä»¥æŠŠæ‰€æœ‰ä¾èµ–ä¸‹è½½åˆ°å½“å‰é¡¹ç›®ä¸­ï¼Œè§£å†³å¯é‡å¤æ„å»ºï¼ˆreproducible buildsï¼‰çš„é—®é¢˜ï¼Œä½†æ˜¯æ— æ³•ç®¡ç†ä¾èµ–ç‰ˆæœ¬ã€‚ç¤¾åŒºå‡ºç°äº†å„å¼å„æ ·çš„åŒ…ç®¡ç†å·¥å…·ï¼Œæ¥æ–¹ä¾¿å¼€å‘è€…å›ºåŒ–ä¾èµ–ç‰ˆæœ¬ï¼Œç”±äºä¸åŒç®¡ç†å·¥å…·é‡‡ç”¨ä¸åŒçš„å…ƒä¿¡æ¯æ ¼å¼ï¼ˆæ¯”å¦‚ï¼šgodep çš„ Godeps.jsonã€Glide çš„ glide.yamlï¼‰ï¼Œä¸åˆ©äºç¤¾åŒºå‘å±•ï¼Œæ‰€ä»¥ Go å®˜æ–¹æ¨å‡ºäº†Â depã€‚

dep çš„å®šä½æ˜¯å®éªŒã€æ¢ç´¢å¦‚ä½•ç®¡ç†ç‰ˆæœ¬ï¼Œå¹¶ä¸ä¼šç›´æ¥é›†æˆåˆ° Go å·¥å…·é“¾ï¼ŒGo æ ¸å¿ƒå›¢é˜Ÿä¼šå¸å– dep ä½¿ç”¨ç»éªŒä¸ç¤¾åŒºåé¦ˆï¼Œå¼€å‘ä¸‹ä¸€ä»£åŒ…ç®¡ç†å·¥å…·Â modulesï¼Œå¹¶äº 2019/09/03 å‘å¸ƒçš„Â 1.13Â æ­£å¼æ”¯æŒï¼Œå¹¶éšä¹‹å‘å¸ƒÂ Module Mirror, Index, Checksumï¼Œç”¨äºè§£å†³è½¯ä»¶åˆ†å‘ã€ä¸­é—´äººæ”»å‡»ç­‰é—®é¢˜ã€‚


å¯¹äºGoçš„ç‰ˆæœ¬ç®¡ç†ä¸»è¦ç”¨è¿‡ glideï¼Œä¸‹é¢ä»‹ç» Go 1.11 ä¹‹åå®˜æ–¹æ”¯æŒçš„ç‰ˆæœ¬ç®¡ç†å·¥å…· modã€‚

å…³äº mod å®˜æ–¹ç»™å‡ºäº†ä¸‰ä¸ªå‘½ä»¤ go help modã€go help modulesã€go help module-get å¸®åŠ©äº†è§£ä½¿ç”¨ã€‚

è®¾ç½® GO111MODULE
å¯ä»¥ç”¨ç¯å¢ƒå˜é‡ GO111MODULE å¼€å¯æˆ–å…³é—­æ¨¡å—æ”¯æŒï¼Œå®ƒæœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼šoffã€onã€autoï¼Œé»˜è®¤å€¼æ˜¯ autoã€‚

GO111MODULE=off æ— æ¨¡å—æ”¯æŒï¼Œgo ä¼šä» GOPATH å’Œ vendor æ–‡ä»¶å¤¹å¯»æ‰¾åŒ…ã€‚
GO111MODULE=on æ¨¡å—æ”¯æŒï¼Œgo ä¼šå¿½ç•¥ GOPATH å’Œ vendor æ–‡ä»¶å¤¹ï¼Œåªæ ¹æ® go.mod ä¸‹è½½ä¾èµ–ã€‚
GO111MODULE=auto åœ¨ $GOPATH/src å¤–é¢ä¸”æ ¹ç›®å½•æœ‰ go.mod æ–‡ä»¶æ—¶ï¼Œå¼€å¯æ¨¡å—æ”¯æŒã€‚
åœ¨ä½¿ç”¨æ¨¡å—çš„æ—¶å€™ï¼ŒGOPATH æ˜¯æ— æ„ä¹‰çš„ï¼Œä¸è¿‡å®ƒè¿˜æ˜¯ä¼šæŠŠä¸‹è½½çš„ä¾èµ–å‚¨å­˜åœ¨ ğºğ‘‚ğ‘ƒğ´ğ‘‡ğ»/ğ‘ğ‘˜ğ‘”/ğ‘šğ‘œğ‘‘ä¸­ï¼Œä¹Ÿä¼šæŠŠğ‘”ğ‘œğ‘–ğ‘›ğ‘ ğ‘¡ğ‘ğ‘™ğ‘™çš„ç»“æœæ”¾åœ¨GOPATH/bin ä¸­ã€‚
<!-- more -->
Go Mod å‘½ä»¤
download    download modules to local cache (ä¸‹è½½ä¾èµ–çš„moduleåˆ°æœ¬åœ°cache))
edit        edit go.mod from tools or scripts (ç¼–è¾‘go.modæ–‡ä»¶)
graph       print module requirement graph (æ‰“å°æ¨¡å—ä¾èµ–å›¾))
init        initialize new module in current directory (å†å½“å‰æ–‡ä»¶å¤¹ä¸‹åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„module, åˆ›å»ºgo.modæ–‡ä»¶))
tidy        add missing and remove unused modules (å¢åŠ ä¸¢å¤±çš„moduleï¼Œå»æ‰æœªç”¨çš„module)
vendor      make vendored copy of dependencies (å°†ä¾èµ–å¤åˆ¶åˆ°vendorä¸‹)
verify      verify dependencies have expected content (æ ¡éªŒä¾èµ–)
why         explain why packages or modules are needed (è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–)
 

Go Mod ä½¿ç”¨
åˆ›å»º go.mod æ–‡ä»¶
åœ¨ä¸€ä¸ªæ–°çš„é¡¹ç›®ä¸­ï¼Œéœ€è¦æ‰§è¡Œgo mod init æ¥åˆå§‹åŒ–åˆ›å»ºæ–‡ä»¶go.modï¼Œgo.mod ä¸­ä¼šåˆ—å‡ºæ‰€æœ‰ä¾èµ–åŒ…çš„è·¯å¾„å’Œç‰ˆæœ¬ã€‚

module github.com/xfstart07/watcher

require (
    github.com/apex/log v1.0.0
    github.com/fatih/color v1.7.0 // indirect
    github.com/fsnotify/fsnotify v1.4.7
    github.com/go-ini/ini v1.38.2
    github.com/go-kit/kit v0.7.0
    github.com/go-logfmt/logfmt v0.3.0 // indirect
ï¼‰
 

indirect è¡¨ç¤ºè¿™ä¸ªåº“æ˜¯é—´æ¥å¼•ç”¨è¿›æ¥çš„ã€‚

go mod vendor å‘½ä»¤å¯ä»¥åœ¨é¡¹ç›®ä¸­åˆ›å»º vendor æ–‡ä»¶å¤¹å°†ä¾èµ–åŒ…æ‹·è´è¿‡æ¥ã€‚

go mod download å‘½ä»¤ç”¨äºå°†ä¾èµ–åŒ…ç¼“å­˜åˆ°æœ¬åœ°Cacheèµ·æ¥ã€‚

æ˜¾ç¤ºæ‰€æœ‰Importåº“ä¿¡æ¯
go list -m -json all
-json JSONæ ¼å¼æ˜¾ç¤º
all æ˜¾ç¤ºå…¨éƒ¨åº“
Mod Cache è·¯å¾„
é»˜è®¤åœ¨$GOPATH/pkg ä¸‹é¢ï¼š

$GOPATH/pkg/mod
æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªé¡¹ç›®ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶å½¢å¼ï¼š

âœ  mod ls -lh cache/download/github.com/go-kit/kit/@v/
total 3016
-rw-r--r--  1 a1  staff     7B Sep 29 15:37 list
-rw-------  1 a1  staff    50B Sep 29 15:37 v0.7.0.info
-rw-------  1 a1  staff    29B Sep 29 15:37 v0.7.0.mod
-rw-r--r--  1 a1  staff   1.5M Sep 29 15:37 v0.7.0.zip
-rw-r--r--  1 a1  staff    47B Sep 29 15:37 v0.7.0.ziphash
 

å¯ä»¥çœ‹å‡ºé¡¹ç›®åº“ä¼šå¯¹æ¯ä¸ªç‰ˆæœ¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹æœ‰å¯¹äºç‰ˆæœ¬çš„ä¿¡æ¯ã€‚

 

å¤©å‘æ¥äº†ï¼šgo mod ä¸èƒ½ä¸‹è½½googleåŒ… ï¼Ÿ
å¯¹äºå…¨ä¸–ç•Œç»å¤§å¤šæ•°Gophersæ¥è¯´ï¼ŒGo moduleçš„å¼•å…¥å¸¦æ¥çš„éƒ½æ˜¯æ»¡æ»¡çš„å¹¸ç¦æ„Ÿï¼Œä½†æ˜¯å¯¹äºä½äºä¸­å›½å¤§é™†åœ°åŒºçš„Gopheræ¥è¯´ï¼Œåœ¨è¿™ç§å¹¸ç¦æ„Ÿè¢­æ¥çš„åŒæ—¶ï¼Œä¹Ÿå¤¹å¸¦äº†ä¸€ä¸â€œæ— å¥ˆâ€ã€‚å…¶åŸå› åœ¨äºmodule-aware modeä¸‹ï¼Œgo toolé»˜è®¤ä¸å†ä½¿ç”¨ä¼ ç»ŸGOPATHä¸‹æˆ–top vendorä¸‹é¢çš„åŒ…äº†ï¼Œè€Œæ˜¯åœ¨GOPATH/pkg/mod(go 1.11ä¸­æ˜¯è¿™ä¸ªä½ç½®ï¼Œä¹Ÿè®¸ä»¥åç‰ˆæœ¬è¿™ä¸ªä½ç½®ä¼šå˜åŠ¨)ä¸‹é¢å¯»æ‰¾Go moduleçš„local cacheã€‚

ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œåœ¨å¤§é™†åœ°åŒºæˆ‘ä»¬æ— æ³•ç›´æ¥é€šè¿‡go getå‘½ä»¤æˆ–git cloneè·å–åˆ°ä¸€äº›ç¬¬ä¸‰æ–¹åŒ…ï¼Œè¿™å…¶ä¸­æœ€å¸¸è§çš„å°±æ˜¯golang.org/xä¸‹é¢çš„å„ç§ä¼˜ç§€çš„åŒ…ã€‚ä½†æ˜¯åœ¨ä¼ ç»Ÿçš„GOPATH modeä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä»golang.org/x/xxxçš„mirrorç«™ç‚¹github.com/golang/xxxä¸Šgit cloneè¿™äº›åŒ…ï¼Œç„¶åå°†å…¶é‡å‘½åä¸ºgolang.org/x/xxxã€‚è¿™æ ·ä¹Ÿèƒ½å‹‰å¼ºé€šè¿‡å¼€å‘è€…æœ¬åœ°çš„ç¼–è¯‘ã€‚åˆæˆ–å°†è¿™äº›åŒ…æ”¾å…¥vendorç›®å½•å¹¶æäº¤åˆ°repoä¸­ï¼Œä¹Ÿèƒ½å®ç°æ­£ç¡®çš„æ„å»ºã€‚

ä½†æ˜¯go moduleå¼•å…¥åï¼Œä¸€æ—¦å·¥ä½œåœ¨module-aware modeä¸‹ï¼Œgo buildå°†ä¸care GOPATHä¸‹æˆ–æ˜¯vendorä¸‹çš„åŒ…ï¼Œè€Œæ˜¯åˆ°GOPATH/pkg/modæŸ¥è¯¢æ˜¯å¦æœ‰moduleçš„cacheï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šå»ä¸‹è½½æŸä¸ªç‰ˆæœ¬çš„moduleï¼Œè€Œå¯¹äºgolang.org/x/xxxä¸‹é¢çš„moduleï¼Œåœ¨å¤§é™†åœ°åŒºå¾€å¾€ä¼šgetå¤±è´¥ã€‚

æœ‰æœ‹å‹å¯èƒ½ä¼šè¯´ï¼Œå¯ä»¥ç»§ç»­é€šè¿‡å…¶ä»–mirrorç«™ç‚¹ä¸‹è½½å†æ”¹åå•Šï¼Ÿç†è®ºä¸Šæ˜¯å¯è¡Œçš„ã€‚ä½†æ˜¯ç°å®ä¸­ï¼Œè¿™æ ·åšå¾ˆç¹çã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹go moduleçš„ä¸“ç”¨æœ¬åœ°ç¼“å­˜ç›®å½•ç»“æ„ï¼š

âœ  /Users/tony/go/pkg/mod $tree -L 7
.
â”œâ”€â”€ cache
â”‚   â””â”€â”€ download
â”‚       â””â”€â”€ golang.org
â”‚           â””â”€â”€ x
â”‚               â””â”€â”€ text
â”‚                   â””â”€â”€ @v
â”‚                       â”œâ”€â”€ list
â”‚                       â”œâ”€â”€ v0.1.0.info
â”‚                       â”œâ”€â”€ v0.1.0.mod
â”‚                       â”œâ”€â”€ v0.1.0.zip
â”‚                       â”œâ”€â”€ v0.1.0.ziphash
â”‚                       â”œâ”€â”€ v0.3.0.info
â”‚                       â”œâ”€â”€ v0.3.0.mod
â”‚                       â”œâ”€â”€ v0.3.0.zip
â”‚                       â””â”€â”€ v0.3.0.ziphash
â””â”€â”€ golang.org
    â””â”€â”€ x
        â”œâ”€â”€ text@v0.1.0
        â””â”€â”€ text@v0.3.0
æˆ‘ä»¬çœ‹åˆ°modä¸‹çš„ç»“æ„æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„ã€‚cache/downloadä¸‹é¢å­˜å‚¨äº†æ¯ä¸ªmoduleçš„â€œå…ƒä¿¡æ¯â€ä»¥åŠæ¯ä¸ªmoduleä¸åŒversionçš„zipåŒ…ã€‚æ¯”å¦‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°äº†golang.org/x/textè¿™ä¸ªmoduleçš„v0.1.0å’Œv0.3.0ä¸¤ä¸ªç‰ˆæœ¬çš„å…ƒä¿¡æ¯å’Œå¯¹åº”çš„æºç zipï¼›åŒæ—¶modä¸‹è¿˜ç›´æ¥å­˜æœ‰text moduleçš„ä¸¤ä¸ªç‰ˆæœ¬v0.1.0å’Œv0.3.0çš„æºç ã€‚

å¦‚æœæˆ‘ä»¬è¿˜åƒGOPATH modeä¸‹é‚£ç§é€šè¿‡â€œmirrorç«™ä¸‹è½½å†æ”¹åâ€çš„æ–¹å¼æ¥æ»¡è¶³go buildçš„éœ€æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ‰‹å·¥åˆ†åˆ«åˆ¶ä½œæŸä¸ªmoduleçš„ä¸åŒç‰ˆæœ¬çš„å…ƒä¿¡æ¯ä»¥åŠæºç ç›®å½•ï¼Œåˆ¶ä½œå…ƒä¿¡æ¯æ—¶è¿˜è¦äº†è§£æ¯ä¸ªæ–‡ä»¶ï¼ˆæ¯”å¦‚ï¼šxx.infoã€xxx.modç­‰ï¼‰çš„å†…å®¹çš„ç”Ÿæˆæœºåˆ¶ï¼Œè¿™æ ·çš„æ–¹æ³•çš„â€œä½“éªŒâ€å¹¶ä¸å¥½ã€‚

å¡«å‘ï¼š Go module proxy
é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šå¤§é™†Gopherå¦‚ä½•èƒ½åœ¨go moduleå¼€å¯çš„çŠ¶æ€ä¸‹äº«å—go moduleå¸¦æ¥çš„ç¦åˆ©å‘¢ï¼Ÿ â€œè§£é“ƒè¿˜é¡»ç³»é“ƒäººâ€ï¼ç­”æ¡ˆå°±åœ¨go 1.11ä¸­ã€‚Go 1.11åœ¨å¼•å…¥go moduleçš„åŒæ—¶ï¼Œè¿˜å¼•å…¥äº†Go module proxy(go help goproxyï¼‰çš„æ¦‚å¿µã€‚

go getå‘½ä»¤é»˜è®¤æƒ…å†µä¸‹ï¼Œæ— è®ºæ˜¯åœ¨gopath modeè¿˜æ˜¯module-aware modeï¼Œéƒ½æ˜¯ç›´æ¥ä»vcsæœåŠ¡(æ¯”å¦‚githubã€gitlabç­‰)ä¸‹è½½moduleçš„ã€‚ä½†æ˜¯Go 1.11ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®GOPROXYç¯å¢ƒå˜é‡æ¥åšä¸€äº›æ”¹å˜ï¼šè®©Goå‘½ä»¤ä»å…¶ä»–åœ°æ–¹ä¸‹è½½moduleã€‚æ¯”å¦‚ï¼š

export GOPROXY=https://goproxy.io
 

ä¸€æ—¦å¦‚ä¸Šé¢è®¾ç½®ç”Ÿæ•ˆåï¼Œåç»­goå‘½ä»¤ä¼šé€šè¿‡go module download protocolä¸proxyäº¤äº’ä¸‹è½½ç‰¹å®šç‰ˆæœ¬çš„moduleã€‚èªæ˜çš„å°ä¼™ä¼´ä»¬ä¸€å®šæƒ³åˆ°äº†ã€‚å¦‚æœæˆ‘ä»¬åœ¨æŸä¸ªå›½å¤–VPSä¸Šæ­å»ºä¸€ä¸ªgo module proxy serverçš„å®ç°ï¼Œæˆ‘ä»¬å°†å¯ä»¥é€šè¿‡è¯¥proxyä¸‹è½½åˆ°ç±»ä¼¼golang.org/xä¸‹é¢çš„moduleã€‚ä¸æ­¤åŒæ—¶ï¼Œä¸€äº›è¯¸å¦‚ä»github.comä¸Šget packageæ…¢ç­‰æ¬¡è¦çš„é—®é¢˜å¯èƒ½ä¹Ÿè¢«ä¸€å¹¶fixæ‰äº†ã€‚

æ˜¾ç„¶Goå®˜æ–¹åŠ å…¥go proxyçš„åˆè¡·å¹¶éä¸ºäº†è§£å†³ä¸­å›½å¤§é™†åœ°åŒºçš„ä¸‹è½½qiangå¤–åŒ…çš„çƒ¦æ¼çš„ã€‚ä½†ä¸å¯å¦è®¤çš„æ˜¯ï¼ŒGOPROXYè®©gopheråœ¨versioned goçš„åŸºç¡€ä¸Šï¼Œå¯¹moduleå’Œpackageçš„è·å–è¡Œä¸ºä¸Šå¢åŠ äº†ä¸€å±‚æ§åˆ¶å’Œå¹²é¢„èƒ½åŠ›ã€‚

 https://tonybai.com/2018/07/15/hello-go-module/
 https://roberto.selbach.ca/intro-to-go-modules/
 https://ieevee.com/tech/2018/08/28/go-modules.html
 https://colobu.com/2018/08/27/learn-go-module/
 https://studygolang.com/articles/13895
 
 
Go modules
Go modulesæœºåˆ¶åœ¨go 1.11ä¸­æ˜¯experiment featureï¼ŒæŒ‰ç…§Goçš„æƒ¯ä¾‹ï¼Œåœ¨æ–°çš„experiment featureé¦–æ¬¡åŠ å…¥æ—¶ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç‰¹æ€§å¼€å…³ï¼Œgo modulesä¹Ÿä¸ä¾‹å¤–ï¼ŒGO111MODULEè¿™ä¸ªä¸´æ—¶çš„ç¯å¢ƒå˜é‡å°±æ˜¯go moduleç‰¹æ€§çš„experimentå¼€å…³ã€‚GO111MODULEæœ‰ä¸‰ä¸ªå€¼ï¼šautoã€onå’Œoffï¼Œé»˜è®¤å€¼ä¸ºautoã€‚GO111MODULEçš„å€¼ä¼šç›´æ¥å½±å“Go compilerçš„â€œä¾èµ–ç®¡ç†â€æ¨¡å¼çš„é€‰æ‹©ï¼ˆæ˜¯GOPATH modeè¿˜æ˜¯module-aware modeï¼‰ï¼Œæˆ‘ä»¬è¯¦ç»†æ¥çœ‹ä¸€ä¸‹ï¼š

å½“GO111MODULEçš„å€¼ä¸ºoffæ—¶ï¼Œgo modules experiment featureå…³é—­ï¼Œgo compileræ˜¾ç„¶ä¼šå§‹ç»ˆä½¿ç”¨GOPATH modeï¼Œå³æ— è®ºè¦æ„å»ºçš„æºç ç›®å½•æ˜¯å¦åœ¨GOPATHè·¯å¾„ä¸‹ï¼Œgo compileréƒ½ä¼šåœ¨ä¼ ç»Ÿçš„GOPATHå’Œvendorç›®å½•(ä»…æ”¯æŒåœ¨gopathç›®å½•ä¸‹çš„package)ä¸‹æœç´¢ç›®æ ‡ç¨‹åºä¾èµ–çš„go packageï¼›

å½“GO111MODULEçš„å€¼ä¸ºonæ—¶ï¼ˆexport GO111MODULE=onï¼‰ï¼Œgo modules experiment featureå§‹ç»ˆå¼€å¯ï¼Œä¸offç›¸åï¼Œgo compilerä¼šå§‹ç»ˆä½¿ç”¨module-aware modeï¼Œå³æ— è®ºè¦æ„å»ºçš„æºç ç›®å½•æ˜¯å¦åœ¨GOPATHè·¯å¾„ä¸‹ï¼Œgo compileréƒ½ä¸ä¼šåœ¨ä¼ ç»Ÿçš„GOPATHå’Œvendorç›®å½•ä¸‹æœç´¢ç›®æ ‡ç¨‹åºä¾èµ–çš„go packageï¼Œè€Œæ˜¯åœ¨go modå‘½ä»¤çš„ç¼“å­˜ç›®å½•($GOPATH/pkg/modï¼‰ä¸‹æœç´¢å¯¹åº”ç‰ˆæœ¬çš„ä¾èµ–packageï¼›

å½“GO111MODULEçš„å€¼ä¸ºautoæ—¶(ä¸æ˜¾å¼è®¾ç½®å³ä¸ºauto)ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æ‰€å±•ç°çš„é‚£æ ·ï¼šä½¿ç”¨GOPATH modeè¿˜æ˜¯module-aware modeï¼Œå–å†³äºè¦æ„å»ºçš„æºç ç›®å½•æ‰€åœ¨ä½ç½®ä»¥åŠæ˜¯å¦åŒ…å«go.modæ–‡ä»¶ã€‚å¦‚æœè¦æ„å»ºçš„æºç ç›®å½•ä¸åœ¨ä»¥GOPATH/srcä¸ºæ ¹çš„ç›®å½•ä½“ç³»ä¸‹ï¼Œä¸”åŒ…å«go.modæ–‡ä»¶(ä¸¤ä¸ªæ¡ä»¶ç¼ºä¸€ä¸å¯)ï¼Œé‚£ä¹ˆä½¿ç”¨module-aware modeï¼›å¦åˆ™ä½¿ç”¨ä¼ ç»Ÿçš„GOPATH modeã€‚

Module æ–‡ä»¶
æ‰§è¡Œå‘½ä»¤Â go build && go mod tidyÂ ï¼Œä¸‹è½½ä¾èµ–å¹¶æ•´ç†ã€‚

é¡¹ç›®æ ¹ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼ˆéœ€è¦åŠ å…¥åˆ° git ä¸­ï¼‰ï¼š

æ–‡ä»¶Â go.modï¼šæŒ‡ç¤ºæ¨¡å—åç§°ã€go çš„ç‰ˆæœ¬ã€è¯¥æ¨¡å—çš„ä¾èµ–ä¿¡æ¯ï¼ˆä¾èµ–åç§°ï¼‰ï¼Œç±»ä¼¼ npm ç”Ÿæˆçš„æ–‡ä»¶Â package.jsonÂ ã€‚
æ–‡ä»¶Â go.sumï¼šè¯¥æ¨¡å—çš„æ‰€æœ‰ä¾èµ–çš„æ ¡éªŒå’Œï¼Œç±»ä¼¼ npm ç”Ÿæˆçš„æ–‡ä»¶Â package-lock.jsonÂ 
Module æ˜¯å¤šä¸ª package çš„é›†åˆï¼Œç‰ˆæœ¬ç®¡ç†çš„åŸºæœ¬å•å…ƒï¼Œä½¿ç”¨ go.mod æ–‡ä»¶è®°å½•ä¾èµ–çš„ moduleã€‚

go.mod ä½äºé¡¹ç›®çš„æ ¹ç›®å½•ï¼Œæ”¯æŒ 4 æ¡å‘½ä»¤ï¼šmoduleã€requireã€replaceã€excludeã€‚ç¤ºä¾‹ï¼š

module github.com/my/repo
 
require (
    github.com/some/dependency v1.2.3
    github.com/another/dependency/v4 v4.0.0
)
module å£°æ˜ module pathï¼Œä¸€ä¸ª module å†…æ‰€æœ‰ package çš„ import path éƒ½ä»¥å®ƒä¸ºå‰ç¼€
require å£°æ˜æ‰€ä¾èµ–çš„ moduleï¼Œç‰ˆæœ¬ä¿¡æ¯ä½¿ç”¨å½¢å¦‚Â v(major).(minor).(patch)Â çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬Â 
replace/exclude ç”¨äºæ›¿æ¢ã€æ’æŸ¥æŒ‡å®š module path
go modå‘½ä»¤
golang æä¾›äº† go modå‘½ä»¤æ¥ç®¡ç†åŒ…ã€‚

go mod æœ‰ä»¥ä¸‹å‘½ä»¤ï¼š

å‘½ä»¤	è¯´æ˜
download	download modules to local cache(ä¸‹è½½ä¾èµ–åŒ…)
edit	edit go.mod from tools or scriptsï¼ˆç¼–è¾‘go.modï¼‰
graph	print module requirement graph (æ‰“å°æ¨¡å—ä¾èµ–å›¾)
init	initialize new module in current directoryï¼ˆåœ¨å½“å‰ç›®å½•åˆå§‹åŒ–modï¼‰
tidy	add missing and remove unused modules(æ‹‰å–ç¼ºå°‘çš„æ¨¡å—ï¼Œç§»é™¤ä¸ç”¨çš„æ¨¡å—)
vendor	make vendored copy of dependencies(å°†ä¾èµ–å¤åˆ¶åˆ°vendorä¸‹)
verify	verify dependencies have expected content (éªŒè¯ä¾èµ–æ˜¯å¦æ­£ç¡®ï¼‰
why	explain why packages or modules are needed(è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–)
Go modulesä½¿ç”¨æ­¥éª¤ï¼š
é¦–å…ˆå°†ä½ çš„ç‰ˆæœ¬æ›´æ–°åˆ°æœ€æ–°çš„Goç‰ˆæœ¬(>=1.11)ã€‚
é€šè¿‡goå‘½ä»¤è¡Œï¼Œè¿›å…¥åˆ°ä½ å½“å‰çš„å·¥ç¨‹ç›®å½•ä¸‹ï¼Œåœ¨å‘½ä»¤è¡Œè®¾ç½®ä¸´æ—¶ç¯å¢ƒå˜é‡set GO111MODULE=onï¼›
# å¼€å¯
export GO111MODULE=on
# 1.13 ä¹‹åæ‰æ”¯æŒå¤šä¸ªåœ°å€ï¼Œä¹‹å‰ç‰ˆæœ¬åªæ”¯æŒä¸€ä¸ª
export GOPROXY=https://goproxy.cn,https://mirrors.aliyun.com/goproxy,direct
# 1.13 å¼€å§‹æ”¯æŒï¼Œé…ç½®ç§æœ‰ moduleï¼Œä¸å»æ ¡éªŒ checksum
export GOPRIVATE=*.corp.example.com,rsc.io/private
Â 

æ‰§è¡Œå‘½ä»¤go mod initåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªgo.modæ–‡ä»¶ï¼Œæ‰§è¡Œè¿™æ¡å‘½ä»¤æ—¶ï¼Œå½“å‰ç›®å½•ä¸èƒ½å­˜åœ¨go.modæ–‡ä»¶ã€‚å¦‚æœä¹‹å‰ç”Ÿæˆè¿‡ï¼Œè¦å…ˆåˆ é™¤ï¼›
å¦‚æœä½ å·¥ç¨‹ä¸­å­˜åœ¨ä¸€äº›ä¸èƒ½ç¡®å®šç‰ˆæœ¬çš„åŒ…ï¼Œé‚£ä¹ˆç”Ÿæˆçš„go.modæ–‡ä»¶å¯èƒ½å°±ä¸å®Œæ•´ï¼Œå› æ­¤ç»§ç»­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼›
æ‰§è¡Œgo mod tidyå‘½ä»¤ï¼Œå®ƒä¼šæ·»åŠ ç¼ºå¤±çš„æ¨¡å—ä»¥åŠç§»é™¤ä¸éœ€è¦çš„æ¨¡å—ã€‚æ‰§è¡Œåä¼šç”Ÿæˆgo.sumæ–‡ä»¶(æ¨¡å—ä¸‹è½½æ¡ç›®)ã€‚æ·»åŠ å‚æ•°-vï¼Œä¾‹å¦‚go mod tidy -vå¯ä»¥å°†æ‰§è¡Œçš„ä¿¡æ¯ï¼Œå³åˆ é™¤å’Œæ·»åŠ çš„åŒ…æ‰“å°åˆ°å‘½ä»¤è¡Œï¼›
æ‰§è¡Œå‘½ä»¤go mod verifyæ¥æ£€æŸ¥å½“å‰æ¨¡å—çš„ä¾èµ–æ˜¯å¦å…¨éƒ¨ä¸‹è½½ä¸‹æ¥ï¼Œæ˜¯å¦ä¸‹è½½ä¸‹æ¥è¢«ä¿®æ”¹è¿‡ã€‚å¦‚æœæ‰€æœ‰çš„æ¨¡å—éƒ½æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼Œé‚£ä¹ˆæ‰§è¡Œè¿™æ¡å‘½ä»¤ä¹‹åï¼Œä¼šæ‰“å°all modules verifiedã€‚
æ‰§è¡Œå‘½ä»¤go mod vendorç”Ÿæˆvendoræ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹å°†ä¼šæ”¾ç½®ä½ go.modæ–‡ä»¶æè¿°çš„ä¾èµ–åŒ…ï¼Œæ–‡ä»¶å¤¹ä¸‹åŒæ—¶è¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶modules.txtï¼Œå®ƒæ˜¯ä½ æ•´ä¸ªå·¥ç¨‹çš„æ‰€æœ‰æ¨¡å—ã€‚åœ¨æ‰§è¡Œè¿™æ¡å‘½ä»¤ä¹‹å‰ï¼Œå¦‚æœä½ å·¥ç¨‹ä¹‹å‰æœ‰vendorç›®å½•ï¼Œåº”è¯¥å…ˆè¿›è¡Œåˆ é™¤ã€‚åŒç†go mod vendor -vä¼šå°†æ·»åŠ åˆ°vendorä¸­çš„æ¨¡å—æ‰“å°å‡ºæ¥ï¼›

https://www.ardanlabs.com/blog/2020/04/modules-06-vendoring.html

Introduction
Itâ€™s no secret that I am a fan of vendoring when itâ€™s reasonable and practical to use it for your application projects. I believe vendoring gives your application projects the most durability since the project owns every line of source code it needs to build the applications. If you want a reproducible build without needing to rely on external services (like module mirrors) and being connected to the network, vendoring is the solution.

These are other benefits of vendoring:

If dependencies are removed from the VCS or somehow proxy servers lose modules, you are covered.
Upgrading dependencies can be seen by running diffs and you maintain a history.
You will have the ability to trace and debug your dependencies and test changes if necessary.
Once you run a go mod tidy and go mod vendor your changes will be replaced.
In this post, I will provide a history of Goâ€™s support for vendoring and the changes in default behavior that have existed over time. I will also share how Goâ€™s tooling is capable of maintaining backwards compatibility between versions. Finally, I will share how you may need to (over time) manually upgrade the version listed in the go.mod file to change the default behavior of future Go releases.

Running Different Versions Of Go
To show you the differences in default behavior between Go 1.13 and Go 1.14, I need to be able to run both versions of the tooling on my machine at the same time. Iâ€™ve already installed Go 1.14.2 on my machine at the time I published this post and I access that version using the traditional go front end. However for this post, I also need to run a Go 1.13 environment. So how can I do that without disrupting my current development environment?

Luckily, the Go team publishes version downloads that give you a specific binary for any version of Go you want to use, including Go Tip.

Figure 1


Figure 1 shows a screenshot of the Go 1.13.10 page from the download server. It shows the instructions for building a binary that can be used to build and test your Go code using Go 1.13.10.

Listing 1

$ cd $HOME
$ go get golang.org/dl/go1.13.10

OUTPUT
go: downloading golang.org/dl v0.0.0-20200408221700-d6f4cf58dce2
go: found golang.org/dl/go1.13.10 in golang.org/dl v0.0.0-20200408221700-d6f4cf58dce2


$ go1.13.10 download

OUTPUT
Downloaded   0.0% (    14448 / 121613848 bytes) ...
Downloaded   9.5% ( 11499632 / 121613848 bytes) ...
Downloaded  30.8% ( 37436528 / 121613848 bytes) ...
Downloaded  49.2% ( 59849840 / 121613848 bytes) ...
Downloaded  69.3% ( 84262000 / 121613848 bytes) ...
Downloaded  90.3% (109804656 / 121613848 bytes) ...
Downloaded 100.0% (121613848 / 121613848 bytes)
Unpacking /Users/bill/sdk/go1.13.10/go1.13.10.darwin-amd64.tar.gz ...
Success. You may now run 'go1.13.10'


$ go1.13.10 version

OUTPUT
go version go1.13.10 darwin/amd64


$ go version

OUTPUT
go version go1.14.2 darwin/amd64
Listing 1 shows how after running the go get command for version 1.13.10 of Go and performing the download call, I can now use Go 1.13.10 on my machine without any disruption to my Go 1.14.2 installation.

If you want to remove any version of Go from your machine, you can find the specific binaries in your $GOPATH/bin folder and all the supporting files will be found in $HOME/sdk.

Listing 2

$ cd $GOPATH/bin
$ l

OUTPUT
-rwxr-xr-x   1 bill  staff   7.0M Apr 11 10:51 go1.13.10
-rwxr-xr-x   1 bill  staff   2.3M Jan  6 11:02 gotip


$ cd $HOME
$ l sdk/

OUTPUT
drwxr-xr-x  22 bill  staff   704B Apr 11 10:52 go1.13.10
drwxr-xr-x  24 bill  staff   768B Feb 26 01:59 gotip
Quick Vendoring Tutorial
The Go tooling did a great job minimizing the workflow impacts to manage and vendor an application projectâ€™s dependencies. It requires two commands: tidy and vendor.

Listing 3

$ go mod tidy
Listing 3 shows the tidy command that helps to keep the dependencies listed in your module files accurate. Some editors (like VS Code and GoLand) provide support to update the module files during development but that doesnâ€™t mean the module files will be clean and accurate once you have everything working. I recommend running the tidy command before you commit and push any code back to your VCS.

If you want to vendor those dependencies as well, then run the vendor command after tidy.

Listing 4

$ go mod vendor
Listing 4 shows the vendor command. This command creates a vendor folder inside your project that contains the source code for all the dependencies (direct and indirect) that the project requires to build and test the code. This command should be run after running tidy to keep your vendor folder in sync with your module files. Make sure to commit and push the vendor folder to your VCS.

GOPATH or Module Mode
In Go 1.11, a new mode was added to the Go tooling called â€œmodule modeâ€. When the Go tooling is operating in module mode, the module system is used to find and build code. When the Go tooling is operating in GOPATH mode, the traditional GOPATH system continues to be used to find and build code. One of the bigger struggles I have had with the Go tooling is knowing what mode will be used by default between the different versions. Then knowing what configuration changes and flags I need to keep my builds consistent.

To understand the history and the semantic changes that have occurred over the past 4 versions of Go, itâ€™s good to have a refresher on these modes.

Go 1.11

A new environment variable was introduced called GO111MODULE whose default was auto. This variable would determine if the Go tooling would use module mode or GOPATH mode depending on where the code was located (inside or outside of GOPATH). To force one mode or the other, you would set this variable to on or off. When it came to vendor folders, module mode would ignore a vendor folder by default and build dependencies against the module cache.

Go 1.12

The default setting for GO111MODULE remains auto and the Go tooling continues to determine module mode or GOPATH mode depending on where the code is located (inside or outside of GOPATH). When it comes to vendor folders, module mode would still ignore a vendor folder by default and build dependencies against the module cache.

Go 1.13

The default setting for GO111MODULE remains auto but the Go tooling is no longer sensitive to whether the working directory is within the GOPATH. Module mode would still ignore a vendor folder by default and build dependencies against the module cache.

Go 1.14

The default setting for GO111MODULE remains auto and the Go tooling is still no longer sensitive to whether the working directory is within the GOPATH. However, if a vendor folder exists, it will be used by default to build dependencies instead of the module cache [1]. In addition, the go command verifies that the projectâ€™s vendor/modules.txt file is consistent with its go.mod file.

Backwards Compatibility Between Versions
The change in Go 1.14 to use the vendor folder by default over the module cache is the behavior I wanted for my projects. Initially I thought I could just use Go 1.14 to build against my existing projects and it would be enough, but I was wrong. After my first build with Go 1.14 and not seeing the vendor folder being respected, I learned that the Go tooling reads the go.mod file for version information and maintains backwards compatibility with that version listed. I had no idea, but it is clearly expressed in the release notes for Go 1.14.

https://golang.org/doc/go1.14#go-command

When the main module contains a top-level vendor directory and its go.mod file specifies Go 1.14 or higher, the go command now defaults to -mod=vendor for operations that accept that flag.

In order to use the new default behavior for vendoring, I was going to need to upgrade the version information in the go.mod file from Go 1.13 to Go 1.14. This is something I quickly did.

Small Demo
To show you the behavior of Go 1.13 and Go 1.14, and how the tooling maintains backwards compatibility, I am going to use the service project. I will show you how changing the version listed in go.mod will change the default behavior of the Go tooling.

To start, I will clone the service project outside of my GOPATH.

Listing 5

$ cd $HOME/code
$ git clone https://github.com/ardanlabs/service
$ cd service
$ code .
Listing 5 shows the commands to clone the project and open the project in VS Code.

Listing 6

$ ls -l vendor/

OUTPUT
total 8
drwxr-xr-x   3 bill  staff    96 Mar 26 16:01 contrib.go.opencensus.io
drwxr-xr-x  14 bill  staff   448 Mar 26 16:01 github.com
drwxr-xr-x  20 bill  staff   640 Mar 26 16:01 go.opencensus.io
drwxr-xr-x   3 bill  staff    96 Mar 26 16:01 golang.org
drwxr-xr-x   3 bill  staff    96 Mar 26 16:01 gopkg.in
-rw-r--r--   1 bill  staff  2860 Mar 26 16:01 modules.txt
Listing 6 shows the listing of the vendor folder for the service project. You can see directories for some of the popular VCS sites that exist today as well as several vanity domains. All the code the project depends on to build and test are located inside the vendor folder.

Next, I will manually change the go.mod file back to version 1.13. This will allow me to show you the behavior I experienced when I used Go 1.14 for the first time against this project.

Listing 7

module github.com/ardanlabs/service

go 1.13   // I just changed this from go 1.14 to go 1.13
Listing 7 shows the change I am making to the go.mod file (switching out go 1.14 for go 1.13).

Note: There is a go mod command that can be used to change the version in the go.mod file: go mod edit -go=1.14

Go 1.13
On this first build, I will use Go 1.13.10 to build the sales-api application. Remember, the go.mod file is listing Go 1.13 as the compatible version for this project.

Listing 8

$ cd service/cmd/sales-api
$ go1.13.10 clean -modcache
$ go1.13.10 build

OUTPUT
go: downloading contrib.go.opencensus.io/exporter/zipkin v0.1.1
. . .
go: finding github.com/leodido/go-urn v1.2.0
Listing 8 shows how I navigated to the application folder, cleaned out my local module cache and then performed a build using Go 1.13.10. Notice how the Go tooling downloaded all the dependencies back into my module cache in order to build the binary. The vendor folder was ignored.

To get Go 1.13 to respect the vendor folder, I need to use the -mod=vendor flag when building and testing.

Listing 9

$ go1.13.10 clean -modcache
$ go1.13.10 build -mod=vendor

OUTPUT
Listing 9 shows how I am now using the -mod=vendor flag on the build call. This time the module cache is not re-populated with the missing modules and the code in the vendor folder is respected.

Go 1.14
This time I will run the build command using Go 1.14.2 without the use of the -mod=vendor flag.

Listing 10

$ go clean -modcache
$ go build

OUTPUT
go: downloading github.com/openzipkin/zipkin-go v0.2.2
. . .
go: downloading github.com/golang/groupcache v0.0.0-20200121045136-8c9f03a8e57e

Listing 10 shows what happens when I use Go 1.14 to build the project. The vendor folder is not being respected because the tooling is operating with Go 1.13 semantics. This is because the go.mod file is listing Go 1.13 as the compatible version for the project. When I saw this for the first time I was shocked. This is what started my investigation.

If I switch the go.mod file to version 1.14, the default mode of the Go 1.14 tooling will switch to respect the vendor folder by default.

Listing 11

module github.com/ardanlabs/service

go 1.14   // I just changed this from go 1.13 to go 1.14
Listing 11 shows the change to the go.mod file back to 1.14. I will clear the module cache again and run the build command again using Go 1.14.

Listing 12

$ go clean -modcache
$ go build

OUTPUT
Listing 12 shows that the module cache is not re-populated this time on the call to go build using Go 1.14. Which means the vendor folder is being respected, without the need of the -mod=vendor flag. The default behavior has changed because the module file is listing Go 1.14.

Future Changes For Vendoring and Modules
Thanks to John Reese, here is a link to a discussion about the tooling maintaining backwards compatibility between different versions of Go based on what is listed in the go.mod file. John was instrumental in making sure the post was accurate and flowed correctly.

https://github.com/golang/go/issues/30791

There is more support coming for vendoring that will follow in future releases. One such feature being discussed is about validating the code in the vendor folder to find situations where the code has been changed.

https://github.com/golang/go/issues/27348

I have to thank Chris Hines for reminding me about the default behaviors in the previous versions of Go and how that has been promoted with each new release. Chris also provided some interesting links that share some history and other cool things coming to the Go tooling for modules. Chris was instrumental in making sure the post was accurate and flowed correctly.

https://github.com/golang/go/issues/33848
https://github.com/golang/go/issues/36460

Conclusion
This post is a result of me being surprised that the version listed in go.mod was affecting the default behavior of the Go tooling. In order to gain access to the new default vendoring behavior in Go 1.14 that I wanted, I had to manually upgrade the version listed in go.mod from 1.13 to 1.14.

I havenâ€™t formed any concrete opinions about the Go tooling using the version information in go.mod to maintain backwards compatibility between versions. The Go tooling has never been tied to the Go compatibility promise and so this was unexpected to me. Maybe this is the start of something great and moving forward the Go tooling can grow without the Go community worrying if their builds, tests and workflows will break when a new version of the Go tooling is released.

If you have any opinions, Iâ€™d love to hear them on Twitter.

Footnotes
[1] Beginning with Go 1.11, the -mod=vendor flag caused the go command to load packages from the vendor directory, instead of modules from the module cache. (The vendor directory contains individual packages, not complete modules.) In Go 1.14, the default value of the -mod flag changes depending on the contents of the main module: if there is a vendor directory and the go.mod file specifies go 1.14 or higher, -mod defaults to -mod=vendor. If the go.mod file is read-only, -mod defaults to -mod=readonly. We also added a new value, -mod=mod, meaning â€œload modules from the module cacheâ€ (that is, the same behavior that you get by default if none of the other conditions holds). Even if you are working in a main module for which the default behavior is -mod=vendor, you can explicitly go back to the module cache using the -mod=mod flag. - Bryan Mills
