<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">prctl</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2019-07-09T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Jul 9, 2019</time></p>
					</div>
					 <p>prctl（PR_SET_PDEATHSIG，SIGNAL）在父线程退出时调用，而不是父进程退出(prctl(PR_SET_PDEATHSIG, SIGNAL) is called on parent thread exit, not parent process exit)</p><br />
<br />
<p>Linux下修改进程名称<br />
catalog</p><br />
<br />
<ol><br />
  <li>应用场景</li><br />
  <li>通过Linux prctl修改进程名</li><br />
  <li>通过修改进程argv[0]修改进程名</li><br />
  <li><br />
    <p>通过bash exec命令修改一个进程的cmdline信息</p><br />
  </li><br />
  <li><br />
    <p>应用场景</p><br />
  </li><br />
  <li>标识父子进程名称，防止被误杀</li><br />
  <li>构造假的进程名及参数，引导非法进入人员到蜜罐系统，取证</li><br />
  <li>恶意程序、木马会通过”檫除”自己的进程名，使ps的时候显示的是一个无名字的进程，同时删除进程对应磁盘上的文件<br />
<!-- more --><br />
通过Linux prctl修改进程名</li><br />
</ol><br />
<br />
<p>虽然Linux将所有资源对象都抽象为了文件，但是对一些特殊作用的文件特别定制了一些特别的API集合，对其进行特殊操作，prctl就是其中一个例子</p><br />
<br />
<p>prctl - operations on a process<br />
#include &lt;sys/prctl.h&gt;<br />
int prctl(int option, unsigned long arg2, unsigned long arg3,unsigned long arg4, unsigned long arg5);<br />
prctl() is called with a first argument describing what to do (with values defined in &lt;linux/prctl.h&gt;), and further arguments with a significance depending on the first one. The first argument can be:</p><br />
<br />
<ol><br />
  <li>PR_CAPBSET_READ</li><br />
  <li>PR_CAPBSET_DROP</li><br />
  <li>PR_SET_CHILD_SUBREAPER</li><br />
  <li>PR_GET_CHILD_SUBREAPER</li><br />
  <li>PR_SET_DUMPABLE</li><br />
  <li>PR_SET_ENDIAN</li><br />
  <li>PR_GET_ENDIAN</li><br />
  <li>PR_SET_FPEMU</li><br />
  <li>PR_GET_FPEMU</li><br />
  <li>PR_SET_FPEXC</li><br />
  <li>PR_GET_FPEXC</li><br />
  <li>PR_SET_KEEPCAPS</li><br />
  <li>PR_GET_KEEPCAPS</li><br />
  <li>PR_SET_NAME <br />
1) Set the name of the calling thread, using the value in the location pointed to by (char *) arg2.<br /><br />
2) The name can be up to 16 bytes long, including the terminating null byte. (If the length of the string, including the terminating null byte, exceeds 16 bytes, the string is silently truncated.) <br />
3) This is the same attribute that can be set via pthread_setname_np and retrieved using pthread_getname_np.<br /><br />
4) The attribute is likewise accessible via /proc/self/task/[tid]/comm, where tid is the name of the calling thread.</li><br />
  <li>PR_GET_NAME</li><br />
  <li>PR_SET_NO_NEW_PRIVS</li><br />
  <li>PR_GET_NO_NEW_PRIVS</li><br />
  <li>PR_SET_PDEATHSIG</li><br />
  <li>PR_GET_PDEATHSIG</li><br />
  <li>PR_SET_PTRACER</li><br />
  <li>PR_SET_SECCOMP</li><br />
  <li>PR_GET_SECCOMP</li><br />
  <li>PR_SET_SECUREBITS</li><br />
  <li>PR_GET_SECUREBITS</li><br />
  <li>PR_SET_THP_DISABLE</li><br />
  <li>PR_GET_THP_DISABLE</li><br />
  <li>PR_GET_TID_ADDRESS</li><br />
  <li>PR_SET_TIMERSLACK</li><br />
  <li>PR_GET_TIMERSLACK</li><br />
  <li>PR_SET_TIMING</li><br />
  <li>PR_GET_TIMING</li><br />
  <li>PR_TASK_PERF_EVENTS_DISABLE</li><br />
  <li>PR_TASK_PERF_EVENTS_ENABLE</li><br />
  <li>PR_SET_TSC</li><br />
  <li>PR_GET_TSC</li><br />
  <li>PR_SET_UNALIGN</li><br />
  <li>PR_GET_UNALIGN</li><br />
  <li>PR_MCE_KILL</li><br />
  <li>PR_MCE_KILL_GET</li><br />
  <li>PR_SET_MM</li><br />
  <li>PR_MPX_ENABLE_MANAGEMENT, PR_MPX_DISABLE_MANAGEMENT</li><br />
</ol><br />
<br />
<p>#include <stdio.h><br />
#include &lt;sys/prctl.h&gt;</stdio.h></p><br />
<br />
<p>int main(int argc, char *argv[], char *envp[])<br />
{<br />
    char *new_name = “littlehann-program”;</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>getchar();<br />
prctl(PR_SET_NAME, new_name);<br />
getchar();<br />
<br />
return 0; }<br />
</code></pre></div></div><br />
<br />
<p>但是prctl修改的进程名，只能是16个字节(包括’\0’)，同时，过ps -aux 查看，进程名称并没有改变，改变的只是/prco/(PID)/stat和/prco/(PID)/status的值，而/prco/$(PID)/cmdline并没有改变</p><br />
<br />
<p>#include <stdio.h><br />
#include <string.h></string.h></stdio.h></p><br />
<br />
<p>extern char **environ;<br />
int main(int argc , char *argv[])<br />
{<br />
    int i;</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>printf("argc:%d\n" , argc);<br />
<br />
for (i = 0; i &lt; argc; ++i)<br />
{<br />
    printf("argv[%d](0x%x):%s\n" , i , (unsigned int)argv[i], argv[i]);<br />
}<br />
<br />
printf("evriron=0x%x\n" , (unsigned int)environ[0]);<br />
<br />
return 0; }<br />
</code></pre></div></div><br />
<br />
<p>通过代码运行结果可以看出，我们只需要在进程启动时修改argv[0]所指向的内存空间的内容，就可以修改进程名</p><br />
<br />
<ol><br />
  <li>如果新名称比argv[0]的长度小，我们可以直接修改，并把多余的部分请0</li><br />
  <li>如果新名称比argv[0]长我们需要两步 <br />
 1) 申请新内存保存环境变量信息和argv[1…argc-1]参数信息<br />
 2) 修改argv[0]，将新名称往后到environ的最后一项清0</li><br />
</ol><br />
<br />
<p>通过bash exec命令修改一个进程的cmdline信息</p><br />
<br />
<p>exec -l -a “littlehann-prog” bash<br />
ps<br />
ps -l 29116</p><br />
<br />
<p>在编写网络服务器程序时，为了响应客户端的请求，我们经常需要新建进程来处理业务流程；而且又是为了关闭某个非法请求或者关闭长连接的客户端，这时就需要杀死进程 killall  proc_name。 但是在新建进程时，子进程名与父进程名相同。因此需要由进程名及参数来区分客户端连接。<br />
   在linux中prctl可以满足这个要求，下满是man手册：<br />
      PR_SET_NAME (since Linux 2.6.9)<br />
              Set the process name for the calling process, using the value in<br />
              the location pointed to by (char *) arg2.  The name can be up to<br />
              16  bytes  long,  and  should  be null terminated if it contains<br />
              fewer bytes.<br />
    但是prctl修改的进程名，只能是16个字节(包括’\0’)。下面是修改的代码（changetitle.c）：<br />
点击(此处)折叠或打开</p><br />
<br />
<p>#include <stdio.h><br />
#include &lt;sys/prctl.h&gt;</stdio.h></p><br />
<br />
<p>int main(int argc, char *argv[], char *envp[])<br />
{<br />
    char *new_name = “abcdefghijklmnopqrstuvwxyz”;</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>getchar();<br />
prctl(PR_SET_NAME, new_name);<br />
getchar();<br />
<br />
return 0; }<br />
当新名称长度大于16时就会截断，上面的新名字截断后是abcdefghijklmno。这对于我们来说是有缺陷的。而且通过ps -aux 查看，进程名称并没有改变，改变的只是/prco/$(PID)/stat和 /prco/$(PID)/status的值，而/prco/$(PID)/cmdline并没有改变。这种方式使用起来也是不方便的。    下面介绍另一种方式，可以与上面的方式互补。<br />
首先看一下main函数的原型:int main(int argc, char *argv[]);<br />
    argv[0]存放的是终端执行的程序名称也就是进程名。argv[1...argc-1]存放的是命令行参数。<br />
    linux中main()还有一个隐藏参数就是环境变量信息，存放了运行时所需要的环境变量。<br />
    我们可以通过以下来访问这个变量 点击(此处)折叠或打开<br />
</code></pre></div></div><br />
<br />
<p>extern char **environ;<br />
      argv与environ是连续存放在栈区的。下面代码可以查看参数信息：<br />
点击(此处)折叠或打开</p><br />
<br />
<p>#include <stdio.h><br />
#include <string.h></string.h></stdio.h></p><br />
<br />
<p>extern char **environ;<br />
int main(int argc , char *argv[])<br />
{<br />
    int i;</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>printf("argc:%d\n" , argc);<br />
<br />
for (i = 0; i &lt; argc; ++i)<br />
{<br />
    printf("argv[%d](0x%x):%s\n" , i , (unsigned int)argv[i], argv[i]);<br />
}<br />
<br />
printf("evriron=0x%x\n" , (unsigned int)environ[0]);<br />
<br />
return 0; }<br />
    通过上面可以看出，我们只需要修改argv[0]所指向的内存空间的内容，就可以修改进程名。但是如果新名称比argv[0]的长度小，我们可以直接修改，并把多余的部分请0，如果新名称 比argv[0]长我们需要两步：<br />
        1、申请新内存保存环境变量信息和argv[1...argc-1]参数信息<br />
        2、修改argv[0]，将新名称往后到environ的最后一项清0<br />
    以下是参考代码： 点击(此处)折叠或打开<br />
</code></pre></div></div><br />
<br />
<p>#include <unistd.h><br />
#include <stdio.h><br />
#include <stdarg.h><br />
#include <string.h><br />
#include <stdlib.h><br />
#include &lt;sys/prctl.h&gt;</stdlib.h></string.h></stdarg.h></stdio.h></unistd.h></p><br />
<br />
<h1 id="define-maxline-2048">define MAXLINE 2048</h1><br />
<br />
<p>extern char **environ;</p><br />
<br />
<p>static char <em>*g_main_Argv = NULL; /</em> pointer to argument vector <em>/<br />
static char *g_main_LastArgv = NULL; /</em> end of argv */</p><br />
<br />
<p>void setproctitle_init(int argc, char **argv, char **envp)<br />
{<br />
    int i;</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for (i = 0; envp[i] != NULL; i++) // calc envp num<br />
    continue;<br />
environ = (char **) malloc(sizeof (char *) * (i + 1)); // malloc envp pointer<br />
<br />
for (i = 0; envp[i] != NULL; i++)<br />
{<br />
    environ[i] = malloc(sizeof(char) * strlen(envp[i]));<br />
    strcpy(environ[i], envp[i]);<br />
}<br />
environ[i] = NULL;<br />
<br />
g_main_Argv = argv;<br />
if (i &gt; 0)<br />
  g_main_LastArgv = envp[i - 1] + strlen(envp[i - 1]);<br />
else<br />
  g_main_LastArgv = argv[argc - 1] + strlen(argv[argc - 1]); }<br />
</code></pre></div></div><br />
<br />
<p>void setproctitle(const char *fmt, …)<br />
{<br />
    char *p;<br />
    int i;<br />
    char buf[MAXLINE];</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>extern char **g_main_Argv;<br />
extern char *g_main_LastArgv;<br />
va_list ap;<br />
p = buf;<br />
<br />
va_start(ap, fmt);<br />
vsprintf(p, fmt, ap);<br />
va_end(ap);<br />
<br />
i = strlen(buf);<br />
<br />
if (i &gt; g_main_LastArgv - g_main_Argv[0] - 2)<br />
{<br />
    i = g_main_LastArgv - g_main_Argv[0] - 2;<br />
    buf[i] = '\0';<br />
}<br />
(void) strcpy(g_main_Argv[0], buf);<br />
<br />
p = &amp;g_main_Argv[0][i];<br />
while (p &lt; g_main_LastArgv)<br />
    *p++ = '\0';<br />
g_main_Argv[1] = NULL;<br />
<br />
prctl(PR_SET_NAME,buf); }<br />
</code></pre></div></div><br />
<br />
<p>int main(int argc, char *argv[])<br />
{<br />
    char argv_buf[MAXLINE] = {0}; // save argv paramters</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for(int i = 1; i &lt; argc; i++)<br />
{<br />
    strcat(argv_buf, argv[i]);<br />
    strcat(argv_buf, " ");<br />
}<br />
<br />
setproctitle_init(argc, argv, environ);<br />
<br />
setproctitle("%s@%s %s", "new_name", "ip", argv_buf);<br />
<br />
for (int i = 0; environ[i] != NULL; i++)<br />
    free(environ[i]);<br />
getchar();<br />
<br />
return 0; }<br />
  上面的代码使用了prctl和修改argv[0]两种修改方法的结合，通过ps -a 、 ps -ef  、ps -aux、 top 等等命令都只能查询到新进程名，/proc/$PID/ 下的文件也显示了新进程名的信息。<br />
  应用场景：<br />
     1、标识父子进程名称，防止被误杀<br />
     2、构造假的进程名及参数，引导非法进入人员到蜜罐系统，取证<br />
</code></pre></div></div><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category linux
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>