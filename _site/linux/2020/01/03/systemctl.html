<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">systemctl init.d</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-01-03T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Jan 3, 2020</time></p>
					</div>
					 <p>docker容器不支持 systemctl</p><br />
<br />
<p>情况一：正常情况（系统有service命令）</p><br />
<br />
<p>重启服务命令：[root@centos6 /]# service crond restart</p><br />
<br />
<p>启动服务命令：[root@centos6 /]# service crond start</p><br />
<br />
<p>停止服务命令：[root@centos6 /]# service crond stop</p><br />
<br />
<p>情况二：当linux发行的版本没有service这个命令时候，用如下命令进行停止启动：</p><br />
<br />
<p>停止服务：[root@centos6 /]# /etc/init.d/cron空格stop</p><br />
<br />
<p>启动服务：[root@centos6 /]# /etc/init.d/cron空格start<br />
<!-- more --><br />
ubuntu 在执行crond restart 时提示cron: can’t lock /var/run/crond.pid, otherpid may be 2699: Resource temporarily unavailable</p><br />
<br />
<p>解决方案： rm -rf /var/run/crond.pid 重启即可 <br />
重新加载<br />
处理方法： /etc/init.d/cron reload</p><br />
<br />
<p>重启服务</p><br />
<br />
<p>处理方法：/etc/init.d/crond restart</p><br />
<br />
<p>sudo systemctl status apache2.service<br />
sudo /bin/systemctl status apache2.service<br />
sudo /etc/init.d/apache2 status<br />
sudo service apache2 status<br />
All the above commands work.</p><br />
<br />
<p>Should I prefer one command over the other?<br />
If yes then why?<br />
Are there any other commands I need to be aware of?<br />
Using init.d in Monit caused issues when I wanted to use the status option (status will be that the service is offline when it was actually online – restarted by Monit). Change the code in Monit from inid.d to /bin/systemctl fixed it.</p><br />
<br />
<p>It seems that using init.d provides more information on what happened that the others. If I should be using one of the other commands, is it possible to have them display more information on what was done?</p><br />
<br />
<p>To start, there’s a whole history and struggle between going from SysVInit to SystemD. Rather than trying to break that all down in one answer though, I’ll refer you to some google venturing for more details on the history as well as one particular article on the topic:</p><br />
<br />
<p>http://www.tecmint.com/systemd-replaces-init-in-linux/</p><br />
<br />
<p>In summary though, it’s been a slow and arduous transition. Some legacy features were kept intact (such as init.d to some degree). If you have the option to use systemctl for your service control I recommend using that one. It’s the foreseeable future for Linux and eventually older SysVInit methods will be considered deprecated entirely and removed.</p><br />
<br />
<p>To cover each one you listed specifically:</p><br />
<br />
<p>sudo systemctl status apache2.service<br />
This is the new SystemD approach to handling services. Moving forward, applications on Linux are designed to uses the systemd method, not any other.</p><br />
<br />
<p>sudo /bin/systemctl status apache2.service<br />
This is the same thing as the previous command. The only difference in this case is that it’s not depending on the shell’s $PATH environment variable to find the command, it’s listing the command explicitly by including the path to the command.</p><br />
<br />
<p>sudo /etc/init.d/apache2 status<br />
This is the original SysVInit method of calling on a service. Init scripts would be written for a service and placed into this directory. While this method is still used by many, service was the command that replaced this method of calling on services in SysVInit. There’s some legacy functionality for this on newer systems with SystemD, but most newer programs don’t include this, and not all older application init scripts work with it.</p><br />
<br />
<p>sudo service apache2 status<br />
This was the primary tool used on SysVInit systems for services. In some cases it just linked to the /etc/init.d/ scripts, but in other cases it went to an init script stored elsewhere. It was intended to provide a smoother transition into service dependency handling.</p><br />
<br />
<p>Lastly, you mention wanting to know how to get more information out of the commands, since some provide more information than others. This is almost always determined by the application and how they designed their init or service file. As a general rule though, if it completed silently it was successful. However, to verify a start, stop, or restart, you can use the status sub-command to see how it is doing. You mentioned a status command being incorrect on an old init script. That is a bug that the application developers would have to look at. However, since init scripts are becoming the deprecated method of handling services, they may just ignore the bug until they remove the init script option entirely. The systemctl status should always work correctly otherwise a bug should be logged with the application developers.</p><br />
<br />
<p>init,service和systemctl的区别<br />
、service是一个脚本命令，分析service可知是去/etc/init.d目录下执行相关程序。service和chkconfig结合使用。<br />
服务配置文件存放目录/etc/init.d/</p><br />
<br />
<p>例如</p><br />
<br />
<h1 id="启动sshd服务">启动sshd服务</h1><br />
<p>service sshd start</p><br />
<h1 id="设置sshd服务开机启动">设置sshd服务开机启动</h1><br />
<p>chkconfig sshd start<br />
2、systemd<br />
centos7版本中使用了systemd，systemd同时兼容service,对应的命令就是systemctl<br />
Systemd 是 Linux 系统中最新的初始化系统（init），它主要的设计目标是克服 sysvinit 固有的缺点，提高系统的启动速度<br />
使用systemd的目的是获取更快的启动速度。<br />
为了减少系统启动时间，systemd的目标是<br />
尽可能启动较少的进程<br />
尽可能将更多进程并发启动<br />
可以去查看系统进程的pid，initd的pid是0，如果支持systemd的系统的systemd进程pid为1</p><br />
<br />
<p>systemd把不同的资源称为Unit<br />
每一个 Unit 都有一个配置文件，告诉 Systemd 怎么启动这个 Unit<br />
存放目录：/etc/systemd/system和/usr/lib/systemd/system</p><br />
<br />
<p>对于有先后依赖关系的任务<br />
systemctl融合service和chkconfig功能<br />
systemctl的使用例如</p><br />
<br />
<h1 id="开启服务">开启服务</h1><br />
<p>systemctl start sshd.service</p><br />
<h1 id="设置开机启动">设置开机启动</h1><br />
<p>systemctl enable sshd.service</p><br />
<h1 id="本质上是建立一个软链接-ln--s-usrlibsystemdsystemsshdservice-etcsystemdsystemmulti-usertargetwantssshdservice">本质上是建立一个软链接 ln -s /usr/lib/systemd/system/sshd.service /etc/systemd/system/multi-user.target.wants/sshd.service</h1><br />
<br />
<p>Systemd 的使用<br />
下面针对技术人员的不同角色来简单地介绍一下 systemd 的使用。本文只打算给出简单的描述，让您对 systemd 的使用有一个大概的理解。具体的细节内容太多，即无法在一篇短文内写全，本人也没有那么强大的能力。还需要读者自己去进一步查阅 systemd 的文档。<br />
系统软件开发人员<br />
开发人员需要了解 systemd 的更多细节。比如您打算开发一个新的系统服务，就必须了解如何让这个服务能够被 systemd 管理。这需要您注意以下这些要点：<br />
后台服务进程代码不需要执行两次派生来实现后台精灵进程，只需要实现服务本身的主循环即可。<br />
不要调用 setsid()，交给 systemd 处理<br />
不再需要维护 pid 文件。<br />
Systemd 提供了日志功能，服务进程只需要输出到 stderr 即可，无需使用 syslog。<br />
处理信号 SIGTERM，这个信号的唯一正确作用就是停止当前服务，不要做其他的事情。<br />
SIGHUP 信号的作用是重启服务。<br />
需要套接字的服务，不要自己创建套接字，让 systemd 传入套接字。<br />
使用 sd_notify()函数通知 systemd 服务自己的状态改变。一般地，当服务初始化结束，进入服务就绪状态时，可以调用它。<br />
Unit 文件的编写<br />
对于开发者来说，工作量最大的部分应该是编写配置单元文件，定义所需要的单元。<br />
举例来说，开发人员开发了一个新的服务程序，比如 httpd，就需要为其编写一个配置单元文件以便该服务可以被 systemd 管理，类似 UpStart 的工作配置文件。在该文件中定义服务启动的命令行语法，以及和其他服务的依赖关系等。<br />
此外我们之前已经了解到，systemd 的功能繁多，不仅用来管理服务，还可以管理挂载点，定义定时任务等。这些工作都是由编辑相应的配置单元文件完成的。我在这里给出几个配置单元文件的例子。<br />
下面是 SSH 服务的配置单元文件，服务配置单元文件以.service 为文件名后缀。<br />
#cat /etc/system/system/sshd.service<br />
[Unit]<br />
Description=OpenSSH server daemon<br />
[Service]<br />
EnvironmentFile=/etc/sysconfig/sshd<br />
ExecStartPre=/usr/sbin/sshd-keygen<br />
ExecStart=/usrsbin/sshd –D $OPTIONS<br />
ExecReload=/bin/kill –HUP $MAINPID<br />
KillMode=process<br />
Restart=on-failure<br />
RestartSec=42s<br />
[Install]<br />
WantedBy=multi-user.target<br />
文件分为三个小节。第一个是[Unit]部分，这里仅仅有一个描述信息。第二部分是 Service 定义，其中，ExecStartPre 定义启动服务之前应该运行的命令；ExecStart 定义启动服务的具体命令行语法。第三部分是[Install]，WangtedBy 表明这个服务是在多用户模式下所需要的。<br />
那我们就来看下 multi-user.target 吧：<br />
#cat multi-user.target<br />
[Unit]<br />
Description=Multi-User System<br />
Documentation=man.systemd.special(7)<br />
Requires=basic.target<br />
Conflicts=rescue.service rescure.target<br />
After=basic.target rescue.service rescue.target<br />
AllowIsolate=yes<br />
[Install]<br />
Alias=default.target<br />
第一部分中的 Requires 定义表明 multi-user.target 启动的时候 basic.target 也必须被启动；另外 basic.target 停止的时候，multi-user.target 也必须停止。如果您接着查看 basic.target 文件，会发现它又指定了 sysinit.target 等其他的单元必须随之启动。同样 sysinit.target 也会包含其他的单元。采用这样的层层链接的结构，最终所有需要支持多用户模式的组件服务都会被初始化启动好。<br />
在[Install]小节中有 Alias 定义，即定义本单元的别名，这样在运行 systemctl 的时候就可以使用这个别名来引用本单元。这里的别名是 default.target，比 multi-user.target 要简单一些。。。<br />
此外在/etc/systemd/system 目录下还可以看到诸如*.wants 的目录，放在该目录下的配置单元文件等同于在[Unit]小节中的 wants 关键字，即本单元启动时，还需要启动这些单元。比如您可以简单地把您自己写的 foo.service 文件放入 multi-user.target.wants 目录下，这样每次都会被默认启动了。<br />
最后，让我们来看看 sys-kernel-debug.mout 文件，这个文件定义了一个文件挂载点：</p><br />
<br />
<p>#cat sys-kernel-debug.mount<br />
[Unit]<br />
Description=Debug File Syste<br />
DefaultDependencies=no<br />
ConditionPathExists=/sys/kernel/debug<br />
Before=sysinit.target<br />
[Mount]<br />
What=debugfs<br />
Where=/sys/kernel/debug<br />
Type=debugfs<br />
这个配置单元文件定义了一个挂载点。挂载配置单元文件有一个[Mount]配置小节，里面配置了 What，Where 和 Type 三个数据项。这都是挂载命令所必须的，例子中的配置等同于下面这个挂载命令：<br />
mount –t debugfs /sys/kernel/debug debugfs<br />
配置单元文件的编写需要很多的学习，必须参考 systemd 附带的 man 等文档进行深入学习。希望通过上面几个小例子，大家已经了解配置单元文件的作用和一般写法了。</p><br />
<br />
<p>我的总结：systemd功能更加强大，是某些linux发行版用来代替系统启动init和service的一个新的系统工具，同时还没有失去兼容对init的兼容性。</p><br />
<br />
<p>/etc/init.d 是sysVinit服务的启动方式,对于一些古老的系统或者服务 使用这个.<br />
service 也是sysVinit, 比/etc/init.d先进一点,底层还是调用/etc/init.d<br />
systemctl 是systemD命令的主要方式, 尽管一些老的系统或者命令不支持systemctl, 但是systemctl最后会逐渐的替代其他的命令方式的, 能用这个就优先用这个,是最时尚/方便的</p><br />
<br />
<p>systemctl的config文件存在 /lib/systemd/system/xxxxxx.serive</p><br />
<br />
<p>我们知道，Docker运行一个容器起来的时候，只是为你提供特定的文件系统层和进程隔离，它给你一个VM的感觉却并不是VM，所以你可能偶尔会想要像在物理机那样使用systemctl start|status|stop来管理服务进程，然后你通常会看到<br />
Failed to get D-Bus connection: Operation not permitted<br />
这个错误。<br />
原因很简单：</p><br />
<br />
<p>你需要启动systemd进程<br />
你需要特权<br />
所以你如果想要一个可以使用Systemd的容器，你可以尝试这样启动容器:</p><br />
<br />
<p>1.解决办法一：给权限<br />
cat /etc/redhat-release <br />
//CentOS Linux release 7.2.1511 (Core) <br />
docker run -tdi –privileged centos init<br />
在容器中，你可以使用systemd管理服务进程了:</p><br />
<br />
<p>yum install -y vsftpd<br />
systemctl start vsftpd<br />
systemctl status vsftpd<br />
2.解决办法二：init.d<br />
除此之外你也可以通过其他启动软件的方式: init.d来达到 systemctl 的效果：<br />
比如要启动 mysql 服务：/etc/init.d/mysql start</p><br />
<br />
<p>Linux 服务管理两种方式service和systemctl</p><br />
<br />
<p>1.service命令<br />
service命令其实是去/etc/init.d目录下，去执行相关程序</p><br />
<br />
<h1 id="service命令启动redis脚本">service命令启动redis脚本</h1><br />
<p>service redis start</p><br />
<h1 id="直接启动redis脚本">直接启动redis脚本</h1><br />
<p>/etc/init.d/redis start</p><br />
<h1 id="开机自启动">开机自启动</h1><br />
<p>update-rc.d redis defaults<br />
其中脚本需要我们自己编写</p><br />
<br />
<p>2.systemctl命令<br />
systemd是Linux系统最新的初始化系统(init),作用是提高系统的启动速度，尽可能启动较少的进程，尽可能更多进程并发启动。<br />
systemd对应的进程管理命令是systemctl</p><br />
<br />
<p>1)systemctl命令兼容了service<br />
即systemctl也会去/etc/init.d目录下，查看，执行相关程序</p><br />
<br />
<p>systemctl redis start<br />
systemctl redis stop</p><br />
<h1 id="开机自启动-1">开机自启动</h1><br />
<p>systemctl enable redis<br />
2)systemctl命令管理systemd的资源Unit<br />
systemd的Unit放在目录/usr/lib/systemd/system(Centos)或/etc/systemd/system(Ubuntu)</p><br />
<br />
<p>主要有四种类型文件.mount,.service,.target,.wants</p><br />
<br />
<p>.mount文件</p><br />
<br />
<p>.mount文件定义了一个挂载点，[Mount]节点里配置了What,Where,Type三个数据项<br />
等同于以下命令：</p><br />
<br />
<p>mount -t hugetlbfs /dev/hugepages hugetlbfs<br />
.service文件</p><br />
<br />
<p>.service文件定义了一个服务，分为[Unit]，[Service]，[Install]三个小节<br />
[Unit]<br />
Description:描述，<br />
After：在network.target,auditd.service启动后才启动<br />
ConditionPathExists: 执行条件</p><br />
<br />
<p>[Service]<br />
EnvironmentFile:变量所在文件<br />
ExecStart: 执行启动脚本<br />
Restart: fail时重启</p><br />
<br />
<p>[Install]<br />
Alias:服务别名<br />
WangtedBy: 多用户模式下需要的</p><br />
<br />
<p>.target文件</p><br />
<br />
<p>.target定义了一些基础的组件，供.service文件调用</p><br />
<br />
<p>.wants文件</p><br />
<br />
<p>.wants文件定义了要执行的文件集合，每次执行，.wants文件夹里面的文件都会执行</p><br />
<br />
<p>1、service是一个脚本命令，分析service可知是去/etc/init.d目录下执行相关程序。service和chkconfig结合使用。<br />
服务配置文件存放目录/etc/init.d/</p><br />
<br />
<p>例如</p><br />
<br />
<h1 id="启动sshd服务-1">启动sshd服务</h1><br />
<p>service sshd start</p><br />
<h1 id="设置sshd服务开机启动-1">设置sshd服务开机启动</h1><br />
<p>chkconfig sshd start<br />
2、systemd<br />
centos7版本中使用了systemd，systemd同时兼容service,对应的命令就是systemctl<br />
Systemd 是 Linux 系统中最新的初始化系统（init），它主要的设计目标是克服 sysvinit 固有的缺点，提高系统的启动速度<br />
使用systemd的目的是获取更快的启动速度。<br />
为了减少系统启动时间，systemd的目标是<br />
尽可能启动较少的进程<br />
尽可能将更多进程并发启动<br />
可以去查看系统进程的pid，initd的pid是0，如果支持systemd的系统的systemd进程pid为1</p><br />
<br />
<p>systemd把不同的资源称为Unit<br />
每一个 Unit 都有一个配置文件，告诉 Systemd 怎么启动这个 Unit<br />
存放目录：/etc/systemd/system和/usr/lib/systemd/system</p><br />
<br />
<p>对于有先后依赖关系的任务<br />
systemctl融合service和chkconfig功能<br />
systemctl的使用例如</p><br />
<br />
<h1 id="开启服务-1">开启服务</h1><br />
<p>systemctl start sshd.service</p><br />
<h1 id="设置开机启动-1">设置开机启动</h1><br />
<p>systemctl enable sshd.service</p><br />
<h1 id="本质上是建立一个软链接-ln--s-usrlibsystemdsystemsshdservice-etcsystemdsystemmulti-usertargetwantssshdservice-1">本质上是建立一个软链接 ln -s /usr/lib/systemd/system/sshd.service /etc/systemd/system/multi-user.target.wants/sshd.service</h1><br />
<p>1<br />
2<br />
3<br />
4<br />
5<br />
转载自<br />
http://www.ibm.com/developerworks/cn/linux/1407_liuming_init3/<br />
Systemd 的使用<br />
下面针对技术人员的不同角色来简单地介绍一下 systemd 的使用。本文只打算给出简单的描述，让您对 systemd 的使用有一个大概的理解。具体的细节内容太多，即无法在一篇短文内写全，本人也没有那么强大的能力。还需要读者自己去进一步查阅 systemd 的文档。<br />
系统软件开发人员<br />
开发人员需要了解 systemd 的更多细节。比如您打算开发一个新的系统服务，就必须了解如何让这个服务能够被 systemd 管理。这需要您注意以下这些要点：<br />
后台服务进程代码不需要执行两次派生来实现后台精灵进程，只需要实现服务本身的主循环即可。<br />
不要调用 setsid()，交给 systemd 处理<br />
不再需要维护 pid 文件。<br />
Systemd 提供了日志功能，服务进程只需要输出到 stderr 即可，无需使用 syslog。<br />
处理信号 SIGTERM，这个信号的唯一正确作用就是停止当前服务，不要做其他的事情。<br />
SIGHUP 信号的作用是重启服务。<br />
需要套接字的服务，不要自己创建套接字，让 systemd 传入套接字。<br />
使用 sd_notify()函数通知 systemd 服务自己的状态改变。一般地，当服务初始化结束，进入服务就绪状态时，可以调用它。<br />
Unit 文件的编写<br />
对于开发者来说，工作量最大的部分应该是编写配置单元文件，定义所需要的单元。<br />
举例来说，开发人员开发了一个新的服务程序，比如 httpd，就需要为其编写一个配置单元文件以便该服务可以被 systemd 管理，类似 UpStart 的工作配置文件。在该文件中定义服务启动的命令行语法，以及和其他服务的依赖关系等。<br />
此外我们之前已经了解到，systemd 的功能繁多，不仅用来管理服务，还可以管理挂载点，定义定时任务等。这些工作都是由编辑相应的配置单元文件完成的。我在这里给出几个配置单元文件的例子。<br />
下面是 SSH 服务的配置单元文件，服务配置单元文件以.service 为文件名后缀。<br />
#cat /etc/system/system/sshd.service<br />
[Unit]<br />
Description=OpenSSH server daemon<br />
[Service]<br />
EnvironmentFile=/etc/sysconfig/sshd<br />
ExecStartPre=/usr/sbin/sshd-keygen<br />
ExecStart=/usrsbin/sshd –D $OPTIONS<br />
ExecReload=/bin/kill –HUP $MAINPID<br />
KillMode=process<br />
Restart=on-failure<br />
RestartSec=42s<br />
[Install]<br />
WantedBy=multi-user.target<br />
文件分为三个小节。第一个是[Unit]部分，这里仅仅有一个描述信息。第二部分是 Service 定义，其中，ExecStartPre 定义启动服务之前应该运行的命令；ExecStart 定义启动服务的具体命令行语法。第三部分是[Install]，WangtedBy 表明这个服务是在多用户模式下所需要的。<br />
那我们就来看下 multi-user.target 吧：<br />
#cat multi-user.target<br />
[Unit]<br />
Description=Multi-User System<br />
Documentation=man.systemd.special(7)<br />
Requires=basic.target<br />
Conflicts=rescue.service rescure.target<br />
After=basic.target rescue.service rescue.target<br />
AllowIsolate=yes<br />
[Install]<br />
Alias=default.target<br />
第一部分中的 Requires 定义表明 multi-user.target 启动的时候 basic.target 也必须被启动；另外 basic.target 停止的时候，multi-user.target 也必须停止。如果您接着查看 basic.target 文件，会发现它又指定了 sysinit.target 等其他的单元必须随之启动。同样 sysinit.target 也会包含其他的单元。采用这样的层层链接的结构，最终所有需要支持多用户模式的组件服务都会被初始化启动好。<br />
在[Install]小节中有 Alias 定义，即定义本单元的别名，这样在运行 systemctl 的时候就可以使用这个别名来引用本单元。这里的别名是 default.target，比 multi-user.target 要简单一些。。。<br />
此外在/etc/systemd/system 目录下还可以看到诸如*.wants 的目录，放在该目录下的配置单元文件等同于在[Unit]小节中的 wants 关键字，即本单元启动时，还需要启动这些单元。比如您可以简单地把您自己写的 foo.service 文件放入 multi-user.target.wants 目录下，这样每次都会被默认启动了。<br />
最后，让我们来看看 sys-kernel-debug.mout 文件，这个文件定义了一个文件挂载点：</p><br />
<br />
<p>#cat sys-kernel-debug.mount<br />
[Unit]<br />
Description=Debug File Syste<br />
DefaultDependencies=no<br />
ConditionPathExists=/sys/kernel/debug<br />
Before=sysinit.target<br />
[Mount]<br />
What=debugfs<br />
Where=/sys/kernel/debug<br />
Type=debugfs<br />
这个配置单元文件定义了一个挂载点。挂载配置单元文件有一个[Mount]配置小节，里面配置了 What，Where 和 Type 三个数据项。这都是挂载命令所必须的，例子中的配置等同于下面这个挂载命令：<br />
mount –t debugfs /sys/kernel/debug debugfs<br />
配置单元文件的编写需要很多的学习，必须参考 systemd 附带的 man 等文档进行深入学习。希望通过上面几个小例子，大家已经了解配置单元文件的作用和一般写法了。</p><br />
<br />
<p>我的总结：systemd功能更加强大，是某些linux发行版用来代替系统启动init和service的一个新的系统工具，同时还没有失去兼容对init的兼容性</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category linux
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>