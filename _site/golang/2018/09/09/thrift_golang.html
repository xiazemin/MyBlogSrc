<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">thrift_golang</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2018-09-09T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Sep 9, 2018</time></p>
					</div>
					 <p>Thrift RPC 框架指南<br />
认识Thrift框架<br />
thrift是一个软件框架，用来进行可扩展且跨语言的服务的开发。它结合了功能强大的软件堆栈和代码生成引擎，以构建在 C++, Java, Python, PHP, Ruby, Erlang, Perl, Haskell, C#, Cocoa, JavaScript, Node.js, Smalltalk, and OCaml 这些编程语言间无缝结合的、高效的服务。</p><br />
<br />
<p>thrift最初由facebook开发，07年四月开放源码，08年5月进入apache孵化器。<br />
thrift允许定义一个简单的定义文件中的数据类型和服务接口，以作为输入文件，编译器生成代码用来方便地生成RPC客户端和服务器通信的无缝跨编程语言。<br />
类似Thrift的工具，还有Avro、protocol buffer,但相对于Thrift来讲，都没有Thrift支持全面和使用广泛。<br />
Thrift自下到上可以分为4层<br />
Server(single-threaded, event-driven etc)<br />
服务器进程调度<br />
Processor(compiler generated)<br />
RPC接口处理函数分发，IDL定义接口的实现将挂接到这里面<br />
Protocol (JSON, compact etc)<br />
协议<br />
Transport(raw TCP, HTTP etc)<br />
网络传输<br />
Thrift实际上是实现了C/S模式，通过代码生成工具将接口定义文件生成服务器端和客户端代码（可以为不同语言），从而实现服务端和客户端跨语言的支持。用户在Thirft描述文件中声明自己的服务，这些服务经过编译后会生成相应语言的代码文件，然后用户实现服务（客户端调用服务，服务器端提服务）便可以了。其中protocol（协议层, 定义数据传输格式，可以为二进制或者XML等）和transport（传输层，定义数据传输方式，可以为TCP/IP传输，内存共享或者文件共享等）被用作运行时库。</p><br />
<br />
<p>Thrift支持的传输及服务模型<br />
支持的传输格式：<br />
参数	描述<br />
TBinaryProtocol	二进制格式<br />
TCompactProtocol	压缩格式<br />
TJSONProtocol	JSON格式<br />
TSimpleJSONProtocol	提供JSON只写协议, 生成的文件很容易通过脚本语言解析。<br />
TDebugProtocol	使用易懂的可读的文本格式，以便于debug<br />
支持的数据传输方式：<br />
参数	描述<br />
TSocket	阻塞式socker<br />
TFramedTransport	以frame为单位进行传输，非阻塞式服务中使用。<br />
TFileTransport	以文件形式进行传输。<br />
TMemoryTransport	将内存用于I/O. java实现时内部实际使用了简单的ByteArrayOutputStream。<br />
TZlibTransport	使用zlib进行压缩， 与其他传输方式联合使用。当前无java实现。<br />
支持的服务模型：<br />
参数	描述<br />
TSimpleServer	简单的单线程服务模型，常用于测试<br />
TThreadPoolServer	多线程服务模型，使用标准的阻塞式IO。<br />
TNonblockingServer	多线程服务模型，使用非阻塞式IO（需使用TFramedTransport数据传输方式）<br />
Thrift 下载及安装<br />
如何获取Thrift<br />
官网：http://thrift.apache.org/<br />
golang的Thrift包:<br />
go get git.apache.org/thrift.git/lib/go/thrift<br />
如何安装Thrift<br />
mac下安装Thrift,参考上一篇介绍 <br />
其他平台安装自行挖掘,呵呵。 <br />
安装后通过</p><br />
<br />
<p>liuxinmingMacBook-Rro#:thrift -version<br />
Thrift version 0.9.2 #看到这一行表示安装成功<br />
Golang、PHP通过Thrift调用<br />
先发个官方各种语言DEMO地址 https://git1-us-west.apache.org/repos/asf?p=thrift.git;a=tree;f=tutorial;h=d69498f9f249afaefd9e6257b338515c0ea06390;hb=HEAD</p><br />
<br />
<p>Thrift的协议库IDL文件<br />
语法参考<br />
参考资料<br />
http://www.cnblogs.com/tianhuilove/archive/2011/09/05/2167669.html</p><br />
<br />
<p>http://my.oschina.net/helight/blog/195015<br />
基本类型</p><br />
<br />
<p>bool: 布尔值 (true or false), one byte<br />
byte: 有符号字节<br />
i16: 16位有符号整型<br />
i32: 32位有符号整型<br />
i64: 64位有符号整型<br />
double: 64位浮点型<br />
string: Encoding agnostic text or binary string <br />
基本类型中基本都是有符号数，因为有些语言没有无符号数，所以Thrift不支持无符号整型。<br />
特殊类型</p><br />
<br />
<p>binary: Blob (byte array) a sequence of unencoded bytes <br />
这是string类型的一种变形，主要是为java使用<br />
struct结构体<br />
thrift中struct是定义为一种对象，和面向对象语言的class差不多.,但是struct有以下一些约束： <br />
struct不能继承，但是可以嵌套，不能嵌套自己。</p><br />
<ol><br />
  <li>其成员都是有明确类型</li><br />
  <li>成员是被正整数编号过的，其中的编号使不能重复的，这个是为了在传输过程中编码使用。</li><br />
  <li>成员分割符可以是逗号（,）或是分号（;），而且可以混用，但是为了清晰期间，建议在定义中只使用一种，比如C++学习者可以就使用分号（;）。</li><br />
  <li>字段会有optional和required之分和protobuf一样，但是如果不指定则为无类型–可以不填充该值，但是在序列化传输的时候也会序列化进去， <br />
optional是不填充则部序列化。 <br />
required是必须填充也必须序列化。</li><br />
  <li>每个字段可以设置默认值</li><br />
  <li>同一文件可以定义多个struct，也可以定义在不同的文件，进行include引入。</li><br />
</ol><br />
<br />
<p>struct Work {<br />
  1: i32 num1 = 0,<br />
  2: i32 num2,<br />
  3: Operation op,<br />
  4: optional string comment,<br />
}<br />
容器（Containers）<br />
Thrift3种可用容器类型：</p><br />
<br />
<p>list(t): 元素类型为t的有序表，容许元素重复。<br />
set(t):元素类型为t的无序表，不容许元素重复。对应c++中的set，java中的HashSet,python中的set，php中没有set，则转换为list类型。<br />
map(t,t): 键类型为t，值类型为t的kv对，键不容许重复。对用c++中的map, Java的HashMap, PHP 对应 array, Python/Ruby 的dictionary。 <br />
容器中元素类型可以是除了service外的任何合法Thrift类型（包括结构体和异常）。为了最大的兼容性，map的key最好是thrift的基本类型，有些语言不支持复杂类型的key，JSON协议只支持那些基本类型的key。 <br />
容器都是同构容器，不失异构容器。<br />
实现Thrift TDL文件<br />
batu.thrift文件：</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>BatuThrift TDL</li><br />
  <li>@author liuxinming</li><br />
  <li>@time 2015.5.13<br />
 */</li><br />
</ul><br />
<br />
<p>namespace go batu.demo<br />
namespace php batu.demo</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>结构体定义<br />
 */<br />
struct Article{<br />
 1: i32 id, <br />
 2: string title,<br />
 3: string content,<br />
 4: string author,<br />
}</li><br />
</ul><br />
<br />
<p>const map&lt;string,string&gt; MAPCONSTANT = {‘hello’:’world’, ‘goodnight’:’moon’}</p><br />
<br />
<p>service batuThrift {      <br /><br />
        list<string> CallBack(1:i64 callTime, 2:string name, 3:map&lt;string, string&gt; paramMap),<br />
        void put(1: Article newArticle),<br />
}<br />
编译IDL文件，生成相关代码<br />
thrift -r --gen go batu.thrift<br />
thrift -r --gen php batu.thrift  <br />
thrift -r --gen php:server batu.thrift #生成PHP服务端接口代码有所不一样<br />
Golang Service 实现<br />
先按照golang的Thrift包</string></p><br />
<br />
<p>go get git.apache.org/thrift.git/lib/go/thrift</p><br />
<br />
<p>将Thrift生成的开发库复制到GOPATH中</p><br />
<br />
<p>cp -r /Users/liuxinming/wwwroot/testphp/gen-go/batu $GOPATH/src</p><br />
<br />
<p>开发Go server端代码（后面的代码，目录我们放在$GOPATH/src/thrift 中运行和演示） <br />
test.go文件:</p><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
    “batu/demo” #注意导入Thrift生成的接口包<br />
    “fmt”<br />
    “git.apache.org/thrift.git/lib/go/thrift”<br />
    “os”<br />
    “time”<br />
)</p><br />
<br />
<p>const (<br />
    NetworkAddr = “127.0.0.1:9090” #监听地址&amp;端口<br />
)</p><br />
<br />
<p>type batuThrift struct {<br />
}</p><br />
<br />
<p>func (this *batuThrift) CallBack(callTime int64, name string, paramMap map[string]string) (r []string, err error) {<br />
    fmt.Println(“–&gt;from client Call:”, time.Unix(callTime, 0).Format(“2006-01-02 15:04:05”), name, paramMap)<br />
    r = append(r, “key:”+paramMap[“a”]+”    value:”+paramMap[“b”])<br />
    return<br />
}</p><br />
<br />
<p>func (this *batuThrift) Put(s *demo.Article) (err error) {<br />
    fmt.Printf(“Article—&gt;id: %d\tTitle:%s\tContent:%t\tAuthor:%d\n”, s.Id, s.Title, s.Content, s.Author)<br />
    return nil<br />
}</p><br />
<br />
<p>func main() {<br />
    transportFactory := thrift.NewTFramedTransportFactory(thrift.NewTTransportFactory())<br />
    protocolFactory := thrift.NewTBinaryProtocolFactoryDefault()<br />
    //protocolFactory := thrift.NewTCompactProtocolFactory()</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>serverTransport, err := thrift.NewTServerSocket(NetworkAddr)<br />
if err != nil {<br />
    fmt.Println("Error!", err)<br />
    os.Exit(1)<br />
}<br />
<br />
handler := &amp;batuThrift{}<br />
processor := demo.NewBatuThriftProcessor(handler)<br />
<br />
server := thrift.NewTSimpleServer4(processor, serverTransport, transportFactory, protocolFactory)<br />
fmt.Println("thrift server in", NetworkAddr)<br />
server.Serve() } 4.运行go服务端(监听9090端口)<br />
</code></pre></div></div><br />
<br />
<p>liuxinmingdeMacBook-Pro:thrift liuxinming$ go run test.go <br />
thrift server in 127.0.0.1:9090</p><br />
<br />
<p>至此Go的Thrift服务端OK.</p><br />
<br />
<p>Golang Client 实现<br />
goClient.go文件：</p><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
    “batu/demo”<br />
    “fmt”<br />
    “git.apache.org/thrift.git/lib/go/thrift”<br />
    “net”<br />
    “os”<br />
    “strconv”<br />
    “time”<br />
)</p><br />
<br />
<p>const (<br />
    HOST = “127.0.0.1”<br />
    PORT = “9090”<br />
)</p><br />
<br />
<p>func main() {<br />
    startTime := currentTimeMillis()</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>transportFactory := thrift.NewTFramedTransportFactory(thrift.NewTTransportFactory())<br />
protocolFactory := thrift.NewTBinaryProtocolFactoryDefault()<br />
<br />
transport, err := thrift.NewTSocket(net.JoinHostPort(HOST, PORT))<br />
if err != nil {<br />
    fmt.Fprintln(os.Stderr, "error resolving address:", err)<br />
    os.Exit(1)<br />
}<br />
<br />
useTransport := transportFactory.GetTransport(transport)<br />
client := demo.NewBatuThriftClientFactory(useTransport, protocolFactory)<br />
if err := transport.Open(); err != nil {<br />
    fmt.Fprintln(os.Stderr, "Error opening socket to "+HOST+":"+PORT, " ", err)<br />
    os.Exit(1)<br />
}<br />
defer transport.Close()<br />
<br />
for i := 0; i &lt; 10; i++ {<br />
    paramMap := make(map[string]string)<br />
    paramMap["a"] = "batu.demo"<br />
    paramMap["b"] = "test" + strconv.Itoa(i+1)<br />
    r1, _ := client.CallBack(time.Now().Unix(), "go client", paramMap)<br />
    fmt.Println("GOClient Call-&gt;", r1)<br />
}<br />
<br />
model := demo.Article{1, "Go第一篇文章", "我在这里", "liuxinming"}<br />
client.Put(&amp;model)<br />
endTime := currentTimeMillis()<br />
fmt.Printf("本次调用用时:%d-%d=%d毫秒\n", endTime, startTime, (endTime - startTime))<br />
</code></pre></div></div><br />
<br />
<p>}</p><br />
<br />
<p>func currentTimeMillis() int64 {<br />
    return time.Now().UnixNano() / 1000000<br />
}<br />
goClient运行后结果：</p><br />
<br />
<p>liuxinmingdeMacBook-Pro:thrift liuxinming$ go run goClient.go <br />
GOClient Call-&gt; [key:batu.demo value:test1] <br />
GOClient Call-&gt; [key:batu.demo value:test2] <br />
GOClient Call-&gt; [key:batu.demo value:test3] <br />
GOClient Call-&gt; [key:batu.demo value:test4] <br />
GOClient Call-&gt; [key:batu.demo value:test5] <br />
GOClient Call-&gt; [key:batu.demo value:test6] <br />
GOClient Call-&gt; [key:batu.demo value:test7] <br />
GOClient Call-&gt; [key:batu.demo value:test8] <br />
GOClient Call-&gt; [key:batu.demo value:test9] <br />
GOClient Call-&gt; [key:batu.demo value:test10] <br />
本次调用用时:1431583140857-1431583140855=2毫秒</p><br />
<br />
<p>PHP Client 实现<br />
首先去下载Thrift，git库地址为：https://github.com/apache/thrift<br />
新建项目目录testphp，然后把thrift/lib/php/lib复制到testphp目录下面<br />
复制生成的gen-php到testphp目录下面<br />
客户端代码<br />
&lt;?php<br />
/**</p><br />
<ul><br />
  <li>Thrift RPC - PHPClient</li><br />
  <li>@author liuxinming</li><br />
  <li>@time 2015.5.13<br />
 */<br />
namespace  batu\testDemo;<br />
header(“Content-type: text/html; charset=utf-8”);<br />
$startTime = getMillisecond();//记录开始时间</li><br />
</ul><br />
<br />
<p>$ROOT_DIR = realpath(dirname(<strong>FILE</strong>).’/’);<br />
$GEN_DIR = realpath(dirname(<strong>FILE</strong>).’/’).’/gen-php’;<br />
require_once $ROOT_DIR . ‘/Thrift/ClassLoader/ThriftClassLoader.php’;</p><br />
<br />
<p>use Thrift\ClassLoader\ThriftClassLoader;<br />
use Thrift\Protocol\TBinaryProtocol;<br />
use Thrift\Transport\TSocket;<br />
use Thrift\Transport\TSocketPool;<br />
use Thrift\Transport\TFramedTransport;<br />
use Thrift\Transport\TBufferedTransport;</p><br />
<br />
<p>$loader = new ThriftClassLoader();<br />
$loader-&gt;registerNamespace(‘Thrift’,$ROOT_DIR);<br />
$loader-&gt;registerDefinition(‘batu\demo’, $GEN_DIR);<br />
$loader-&gt;register();</p><br />
<br />
<p>$thriftHost = ‘127.0.0.1’; //UserServer接口服务器IP<br />
$thriftPort = 9090;            //UserServer端口</p><br />
<br />
<p>$socket = new TSocket($thriftHost,$thriftPort);<br /><br />
$socket-&gt;setSendTimeout(10000);#Sets the send timeout.<br />
$socket-&gt;setRecvTimeout(20000);#Sets the receive timeout.<br />
//$transport = new TBufferedTransport($socket); #传输方式：这个要和服务器使用的一致 [go提供后端服务,迭代10000次2.6 ~ 3s完成]<br />
$transport = new TFramedTransport($socket); #传输方式：这个要和服务器使用的一致[go提供后端服务,迭代10000次1.9 ~ 2.1s完成，比TBuffer快了点]<br />
$protocol = new TBinaryProtocol($transport);  #传输格式：二进制格式<br />
$client = new \batu\demo\batuThriftClient($protocol);# 构造客户端</p><br />
<br />
<p>$transport-&gt;open();<br /><br />
$socket-&gt;setDebug(TRUE);</p><br />
<br />
<p>for($i=1;$i&lt;11;$i++){<br />
    $item = array();<br />
    $item[“a”] = “batu.demo”;<br />
    $item[“b”] = “test”+$i;<br />
    $result = $client-&gt;CallBack(time(),”php client”,$item); # 对服务器发起rpc调用<br />
    echo “PHPClient Call-&gt;”.implode(‘’,$result).”<br />”;<br />
}</p><br />
<br />
<p>$s = new \batu\demo\Article();<br />
$s-&gt;id = 1;<br />
$s-&gt;title = ‘插入一篇测试文章’;<br />
$s-&gt;content = ‘我就是这篇文章内容’;<br />
$s-&gt;author = ‘liuxinming’;<br />
$client-&gt;put($s);</p><br />
<br />
<p>$s-&gt;id = 2;<br />
$s-&gt;title = ‘插入二篇测试文章’;<br />
$s-&gt;content = ‘我就是这篇文章内容’;<br />
$s-&gt;author = ‘liuxinming’;<br />
$client-&gt;put($s);</p><br />
<br />
<p>$endTime = getMillisecond();</p><br />
<br />
<p>echo “本次调用用时: :”.$endTime.”-“.$startTime.”=”.($endTime-$startTime).”毫秒<br />”;</p><br />
<br />
<p>function getMillisecond() {<br />
    list($t1, $t2) = explode(‘ ‘, microtime());<br />
    return (float)sprintf(‘%.0f’, (floatval($t1) + floatval($t2)) * 1000);<br />
}</p><br />
<br />
<p>$transport-&gt;close();<br />
PHP运行后结果：</p><br />
<br />
<p>PHPClient Call-&gt;key:batu.demo value:1 <br />
PHPClient Call-&gt;key:batu.demo value:2 <br />
PHPClient Call-&gt;key:batu.demo value:3 <br />
PHPClient Call-&gt;key:batu.demo value:4 <br />
PHPClient Call-&gt;key:batu.demo value:5 <br />
PHPClient Call-&gt;key:batu.demo value:6 <br />
PHPClient Call-&gt;key:batu.demo value:7 <br />
PHPClient Call-&gt;key:batu.demo value:8 <br />
PHPClient Call-&gt;key:batu.demo value:9 <br />
PHPClient Call-&gt;key:batu.demo value:10 <br />
本次调用用时: :1431582183296-1431582183290=6毫秒</p><br />
<br />
<p>Go服务端看到打印数据：</p><br />
<br />
<p>–&gt;from client Call: 2015-05-13 22:43:03 php client map[a:batu.demo b:1] <br />
–&gt;from client Call: 2015-05-13 22:43:03 php client map[a:batu.demo b:2] <br />
–&gt;from client Call: 2015-05-13 22:43:03 php client map[a:batu.demo b:3] <br />
–&gt;from client Call: 2015-05-13 22:43:03 php client map[a:batu.demo b:4] <br />
–&gt;from client Call: 2015-05-13 22:43:03 php client map[a:batu.demo b:5] <br />
–&gt;from client Call: 2015-05-13 22:43:03 php client map[a:batu.demo b:6] <br />
–&gt;from client Call: 2015-05-13 22:43:03 php client map[a:batu.demo b:7] <br />
–&gt;from client Call: 2015-05-13 22:43:03 php client map[b:8 a:batu.demo] <br />
–&gt;from client Call: 2015-05-13 22:43:03 php client map[a:batu.demo b:9] <br />
–&gt;from client Call: 2015-05-13 22:43:03 php client map[a:batu.demo b:10] <br />
Article—&gt;id: 1 Title:插入一篇测试文章 Content:我就是这篇文章内容 Author:liuxinming <br />
Article—&gt;id: 2 Title:插入二篇测试文章 Content:我就是这篇文章内容 Author:liuxinming</p><br />
<br />
<p>完结，至此一个Golang的Thrift服务端 和 PHP的Thrift客户端完成！</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>