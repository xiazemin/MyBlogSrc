<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">golang debug dlv</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2018-12-25T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Dec 25, 2018</time></p>
					</div>
					 <p>https://github.com/go-lang-plugin-org/go-lang-idea-plugin#pre-release-builds<br />
这个插件可以在idea上看到调试按钮，但是不好用<br />
https://github.com/derekparker/delve<br />
Go 官方的debug tool文档写的啥。</p><br />
<br />
<p>GDB does not understand Go programs well. The stack management, threading, and runtime contain aspects that differ enough from the execution model GDB expects that they can confuse the debugger, even when the program is compiled with gccgo.</p><br />
<br />
<p>In short, the instructions below should be taken only as a guide to how to use GDB when it works, not as a guarantee of success.</p><br />
<br />
<p>In time, a more Go-centric debugging architecture may be required.</p><br />
<br />
<p>总结一下上面说的话。</p><br />
<br />
<p>Go 的debug工具有GDB这个玩意，但是目前貌似工作的不咋滴<br />
目前官方只是给你介绍介绍这个玩意怎么用，但是不保证能成功<br />
实话说，我们需要一个更懂 Go 的调试器<br />
最后一句话透露了本质，目前还没有一个非常好的调试工具。难道我们只能在不断打日志然后 build 然后再打日志中调试程序吗？ 当然不是，下面我来介绍一个专门为 Go而生的 debug 工具 Delve。</p><br />
<br />
<p>Delve目的就是为了解决开发者在使用 GDB 调试中遇到的各种各样的问题。我们开始详细的介绍一些使用Delve 调试代码的例子。<br />
　Devle是一个非常棒的golang 调试工具，支持多种调试方式，直接运行调试，或者attach到一个正在运行中的golang程序，进行调试。</p><br />
<br />
<p>　　线上golang服务出现问题时，Devle是必不少的在线调试工具，如果使用docker，也可以把Devle打进docker镜像里，调试代码。<br />
<!-- more --><br />
首先默认你已经安装了 Go 环境，安装命令很简单，一句话。</p><br />
<br />
<p>go get github.com/derekparker/delve/cmd/dlv<br />
注意:如果你使用Go1.5，你必须在运行这个命令前设置GO15VENDOREXPERIMENT=1</p><br />
<br />
<p>调试代码<br />
首先得说明一下，实诚点说，当你想用debug 工具的时候，你的代码估计已经不按照你想象的方式运行了。只是你不知道为什么会这样，因此你可能需要换一种方式启动你的程序，下面我们来演示一下如果使用dlv来启动你的程序。我们的示例代码如下:</p><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
    “fmt”<br />
    “sync”<br />
    “time”<br />
)</p><br />
<br />
<p>func dostuff(wg *sync.WaitGroup, i int) {<br />
    fmt.Printf(“goroutine id %d\n”, i)<br />
    time.Sleep(300 * time.Second)<br />
    fmt.Printf(“goroutine id %d\n”, i)<br />
    wg.Done()<br />
}</p><br />
<br />
<p>func main() {<br />
    var wg sync.WaitGroup<br />
    workers := 10</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wg.Add(workers)<br />
for i := 0; i &lt; workers; i++ {<br />
    go dostuff(&amp;wg, i)<br />
}<br />
wg.Wait() } 在这个示例代码中，我们创建了10个goroutine，这种代码对于 GDB 来说是几乎不可读的，因为它对于goroutine的支持很差。但是Delve作为一个专业的 Go 调试器，对于goroutine这种杀手级功能还是非常了解的。下面我们来启动程序。<br />
</code></pre></div></div><br />
<br />
<p>dlv debug test-debug.go<br />
运行这个命令，dlv会去编译你的代码，然后传一些参数给编译器，好让编译器编译出来更加方便调试的可执行文件，然后启动了你的程序，并且attach上去，这样你的console就会停留在了debug session，下面就可以调试程序了。</p><br />
<br />
<p>首先我们在main函数上设置一个断点。</p><br />
<br />
<p>(dlv) break main.main<br />
Breakpoint 1 set at 0x22d3 for main.main() ./test-debug.go:16<br />
输出信息里面告诉了我们断点的 ID和断点的位置，函数名和文件名以及所在行数。我们使用continue命令让程序运行到我们打断点的地方。</p><br />
<br />
<p>(dlv) continue</p><br />
<blockquote><br />
  <p>main.main() ./test-debug.go:16 (hits goroutine(1):1 total:1) (PC: 0x22d3)<br />
    11:        time.Sleep(300 * time.Second)<br />
    12:        fmt.Printf(“goroutine id %d\n”, i)<br />
    13:        wg.Done()<br />
    14:    }<br />
    15:<br />
=&gt;  16:    func main() {<br />
    17:        var wg sync.WaitGroup<br />
    18:        workers := 10<br />
    19:<br />
    20:        wg.Add(workers)<br />
    21:        for i := 0; i &lt; workers; i++ {<br />
(dlv)<br />
现在程序就停在了第一个断点，现在我们可以使用next命令让程序运行到下一句话，如果你想继续向下，可以直接按回车(Delve会重复上一条命令如果你按下回车键)。</p><br />
</blockquote><br />
<br />
<p>(dlv) next</p><br />
<blockquote><br />
  <p>main.main() ./test-debug.go:17 (PC: 0x22d7)<br />
    12:        fmt.Printf(“goroutine id %d\n”, i)<br />
    13:        wg.Done()<br />
    14:    }<br />
    15:<br />
    16:    func main() {<br />
=&gt;  17:        var wg sync.WaitGroup<br />
    18:        workers := 10<br />
    19:<br />
    20:        wg.Add(workers)<br />
    21:        for i := 0; i &lt; workers; i++ {<br />
    22:            go dostuff(&amp;wg, i)<br />
(dlv)<br />
main.main() ./test-debug.go:18 (PC: 0x22f1)<br />
    13:        wg.Done()<br />
    14:    }<br />
    15:<br />
    16:    func main() {<br />
    17:        var wg sync.WaitGroup<br />
=&gt;  18:        workers := 10<br />
    19:<br />
    20:        wg.Add(workers)<br />
    21:        for i := 0; i &lt; workers; i++ {<br />
    22:            go dostuff(&amp;wg, i)<br />
    23:        }<br />
(dlv)<br />
main.main() ./test-debug.go:20 (PC: 0x22fa)<br />
    15:<br />
    16:    func main() {<br />
    17:        var wg sync.WaitGroup<br />
    18:        workers := 10<br />
    19:<br />
=&gt;  20:        wg.Add(workers)<br />
    21:        for i := 0; i &lt; workers; i++ {<br />
    22:            go dostuff(&amp;wg, i)<br />
    23:        }<br />
    24:        wg.Wait()<br />
    25:    }<br />
(dlv)  <br /><br />
现在我们可以尝试使用print命令去看一下变量的值。</p><br />
</blockquote><br />
<br />
<p>(dlv) print wg<br />
sync.WaitGroup {<br />
    state1: [12]uint8 [0,0,0,0,0,0,0,0,0,0,0,0],<br />
    sema: 0,}<br />
(dlv) print workers<br />
10<br />
(dlv)<br />
同时你也可以输出一个表达式</p><br />
<br />
<p>(dlv) print workers &lt; 100<br />
true<br />
下面我们在另外一个函数dostuff 上设置一个断点</p><br />
<br />
<p>(dlv) break dostuff<br />
Breakpoint 2 set at 0x2058 for main.dostuff() ./test-debug.go:9<br />
我们使用continue到我们设置断点的地方，然后next</p><br />
<br />
<p>(dlv) next<br />
goroutine id 3</p><br />
<blockquote><br />
  <p>main.dostuff() ./test-debug.go:10 (PC: 0x205f)<br />
     5:        “sync”<br />
     6:        “time”<br />
     7:    )<br />
     8:<br />
     9:    func dostuff(wg *sync.WaitGroup, i int) {<br />
=&gt;  10:        fmt.Printf(“goroutine id %d\n”, i)<br />
    11:        time.Sleep(300 * time.Second)<br />
    12:        fmt.Printf(“goroutine id %d\n”, i)<br />
    13:        wg.Done()<br />
    14:    }<br />
    15:<br />
(dlv)<br />
可以看到Delve会告诉你目前的goroutine id，我们试试输出一下i和wg.</p><br />
</blockquote><br />
<br />
<p>(dlv) print i<br />
4<br />
(dlv) print wg<br />
*sync.WaitGroup {<br />
    state1: [12]uint8 [1,0,0,0,10,0,0,0,0,0,0,0],<br />
    sema: 0,}</p><br />
<br />
<p>我们创建了10个goroutine，如果你继续使用next，你会发现你还是在同一个goroutine下。这样就避免了被调试器跳转到了另外的goroutine下导致不必要的调试错误。可见还是为 Go 而生的调试器才是真爱啊。</p><br />
<br />
<p>进阶调试<br />
其实很多时候，我们调试的代码可能是daemon程序或者需要实现编译好在不同机器运行的程序。这就需要我们attach到一个已经在运行中的程序上，下面我们就使用上面的代码来演示一下如何attach到一个程序上进行调试。首先将刚才的程序运行起来,我这里直接使用了</p><br />
<br />
<p>go build test-debug.go<br />
./test-debug<br />
然后使用ps查看正在运行的程序pid</p><br />
<br />
<p>501 40994   549   0 12:08AM ttys003    0:00.00 ./test-debug</p><br />
<br />
<p>然后我们attach上去</p><br />
<br />
<p>dlv attach 40994<br />
可以看到，熟悉的debug seesion又回来了。下面我们可以继续使用上面的命令去设置断点了</p><br />
<br />
<p>(dlv) break dostuff<br />
Breakpoint 1 set at 0x2058 for main.dostuff() /Users/xianlu/WorkSpace/golang/src/test-debug.go:9<br />
(dlv) break dostuff:3<br />
Breakpoint 2 set at 0x2144 for main.dostuff() /Users/xianlu/WorkSpace/golang/src/test-debug.go:12<br />
我使用continue使程序运行到我设置断点的地方</p><br />
<br />
<p>(dlv) continue</p><br />
<blockquote><br />
  <p>main.dostuff() /Users/xianlu/WorkSpace/golang/src/test-debug.go:12 (hits goroutine(18):1 total:8) (PC: 0x2144)<br />
main.dostuff() /Users/xianlu/WorkSpace/golang/src/test-debug.go:12 (hits goroutine(19):1 total:8) (PC: 0x2144)<br />
main.dostuff() /Users/xianlu/WorkSpace/golang/src/test-debug.go:12 (hits goroutine(26):1 total:8) (PC: 0x2144)<br />
main.dostuff() /Users/xianlu/WorkSpace/golang/src/test-debug.go:12 (hits goroutine(23):1 total:8) (PC: 0x2144)<br />
main.dostuff() /Users/xianlu/WorkSpace/golang/src/test-debug.go:12 (hits goroutine(24):1 total:8) (PC: 0x2144)<br />
main.dostuff() /Users/xianlu/WorkSpace/golang/src/test-debug.go:12 (hits goroutine(20):1 total:8) (PC: 0x2144)<br />
main.dostuff() /Users/xianlu/WorkSpace/golang/src/test-debug.go:12 (hits goroutine(21):1 total:8) (PC: 0x2144)<br />
main.dostuff() /Users/xianlu/WorkSpace/golang/src/test-debug.go:12 (hits goroutine(25):1 total:8) (PC: 0x2144)<br />
     7:    )<br />
     8:<br />
     9:    func dostuff(wg *sync.WaitGroup, i int) {<br />
    10:        fmt.Printf(“goroutine id %d\n”, i)<br />
    11:        time.Sleep(300 * time.Second)<br />
=&gt;  12:        fmt.Printf(“goroutine id %d\n”, i)<br />
    13:        wg.Done()<br />
    14:    }<br />
    15:<br />
    16:    func main() {<br />
    17:        var wg sync.WaitGroup<br />
(dlv)<br />
可以看到，Delve已经打印出来了当前正在运行的goroutine，下面我们print一下我们当前的i</p><br />
</blockquote><br />
<br />
<p>(dlv) print i<br />
7<br />
(dlv) print wg<br />
*sync.WaitGroup {<br />
    state1: [12]uint8 [1,0,0,0,10,0,0,0,0,0,0,0],<br />
    sema: 0,}<br />
和上面一样，而且attach到这个进程后，也可以把对应的源码显示出来</p><br />
<br />
<p>一个运行在8000端口上的web服务，访问 hi会返回机器的名称。上面代码的行号是很有用的，等会我们打断点的时候会用到。</p><br />
<br />
<p>　  使用Delve运行我们的main.go</p><br />
<br />
<p>dlv debug ./main.go<br />
在func li  里打一个断点，我们可以使用</p><br />
<br />
<p>b main.hi<br />
或者使用   “文件:行号”来打断点</p><br />
<br />
<p>b /home/goworkspace/src/github.com/mytest/main.go:20<br />
现在执行continue 让服务跑起来。访问一下我们的服务，看hi方法会不会停下来。</p><br />
<br />
<p>curl localhost:8000/hi<br />
　　输入 n 回车，单步执行，</p><br />
<br />
<p>　　输入 print（别名p）输出变量信息　　</p><br />
<br />
<p>　　输入 args 打印出所有的方法参数信息</p><br />
<br />
<p>　　输入 locals 打印所有的本地变量</p><br />
<br />
<p>　使用Delve附加到运行的golang服务进行调试<br />
 　　先编译一下我们的main.go然后去行main</p><br />
<br />
<p>go build main.go</p><br />
<br />
<p>./main<br />
然后使用Delve附加到我们的项目上，先看一下我们的项目的pid</p><br />
<br />
<p>ps aux|grep main<br />
dlv attach 29260<br />
　在hi方法里打断点，然后执行c来等待断点的执行。</p><br />
<br />
<p>b /home/goworkspace/src/github.com/mytest/main.go:20<br />
　　</p><br />
<br />
<p>　　访问我们的服务器，看一下断点会不会被执行</p><br />
<br />
<p>curl localhost:8000/hi</p><br />
<br />
<p>https://tqdev.com/2016-debugging-go-with-vscode-and-delve</p><br />
<br />
<p>dlv debug xxx.go 指定需要debug的文件<br />
进入dlv交互式窗口后，b <filename>:<line> 指定断点<br />
r arg 指定运行参数<br />
n 执行一行<br />
c 运行至断点或程序结束</line></filename></p><br />
<br />
<p>Pass flags to the program you are debugging using –, for example:</p><br />
<br />
<p>dlv exec ./hello – server –config conf/config.toml</p><br />
<br />
<p>https://github.com/derekparker/delve/blob/master/Documentation/usage/dlv.md</p><br />
<br />
<p>Available Commands: <br />
  attach      关联到一个已经运行的程序上进行调试.</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    dlv attach  [程序的PID]   connect     Connect to a headless debug server.   core        Examine a core dump.   debug       Compile and begin debugging main package in current directory, or the package specified.   exec        Execute a precompiled binary, and begin a debug session.   help        Help about any command   run         Deprecated command. Use 'debug' instead.   test        Compile test binary and begin debugging program.   trace       Compile and begin tracing program.   version     Prints version.<br />
</code></pre></div></div><br />
<br />
<p>http://lday.me/2017/02/27/0005_gdb-vs-dlv/<br />
https://guidao.github.io/go_debug.html#orgheadline3</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>