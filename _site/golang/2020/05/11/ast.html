<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">Take a walk the Go AST</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-05-11T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> May 11, 2020</time></p>
					</div>
					 <p>https://nakabonne.dev/posts/take-a-walk-the-go-ast/<br />
https://nakabonne.dev/posts/digging-deeper-into-the-analysis-of-go-code/</p><br />
<br />
<p>What do you refer to when you’re curious about the Go AST? A document? Source code? While reading the documentation helps you understand it in the abstract, you can’t see how APIs relate to each other, etc. Not to mention, read the entire source code and you’ll see it completely, but you should get tired from trying to read the whole stuff.</p><br />
<br />
<p>Therefore, this article aims to be in the middle of them. Let’s take it easy and take a walk through AST to understand how the Go code we usually write is represented internally.</p><br />
<br />
<p>It doesn’t delve into how to parse the source code, and starts with the description after the AST is built. If you’re curious about how the code is converted to the AST, navigate to Digging deeper into the analysis of Go-code.<br />
<!-- more --><br />
Interfaces<br />
First up, let me briefly describe the interface that represents each of the AST nodes. All AST nodes implement the ast.Node interface, which just returns a position in the AST.<br />
In addtion, there are 3 main interfaces that implement ast.Node:</p><br />
<br />
<p>ast.Expr — representing expressions and types node<br />
ast.Stmt — representing statement node<br />
ast.Decl — representing declaration node</p><br />
<br />
<p>You can see from the definition that every Node satisfies the ast.Node interface:</p><br />
<br />
<p>ast/ast.go</p><br />
<br />
<p>// All node types implement the Node interface.<br />
type Node interface {<br />
	Pos() token.Pos // position of first character belonging to the node<br />
	End() token.Pos // position of first character immediately after the node<br />
}</p><br />
<br />
<p>// All expression nodes implement the Expr interface.<br />
type Expr interface {<br />
	Node<br />
	exprNode()<br />
}</p><br />
<br />
<p>// All statement nodes implement the Stmt interface.<br />
type Stmt interface {<br />
	Node<br />
	stmtNode()<br />
}</p><br />
<br />
<p>// All declaration nodes implement the Decl interface.<br />
type Decl interface {<br />
	Node<br />
	declNode()<br />
}<br />
Getting started with walking<br />
Let’s start walking! Take a look at the file we convert to the AST:</p><br />
<br />
<p>package hello</p><br />
<br />
<p>import “fmt”</p><br />
<br />
<p>func greet() {<br />
	fmt.Println(“Hello, World”)<br />
}<br />
Nothing fancy — an overly simple Hello, World program. The AST built on this is:</p><br />
<br />
<p>ast.File<br />
How to walk<br />
All we have to do is traverse this AST node in depth-first order. Let’s print each Node one by one by calling ast.Inspect() recursively.</p><br />
<br />
<p>Also, printing AST directly then we will typically see stuff that is not human readable. To prevent that from happening, we’re going to use ast.Print, a powerful API for human reading of AST:</p><br />
<br />
<p>walk.go<br />
ast.File<br />
The first Node to visit is *ast.File, which is the root of all AST nodes. It implements only the ast.Node interface.</p><br />
<br />
<p>ast.File has references to a package name, import declarations, and function declarations as child nodes. To be precise, it has also Comments and so on, but let me omit them for simplicity. Let’s start with Package Name.</p><br />
<br />
<p>(Note that fields with a nil value are omitted. See the document for a complete list of fields for each node type.)</p><br />
<br />
<p>Package Name<br />
ast.Ident<br />
*ast.Ident {<br />
.  NamePos: dummy.go:1:9<br />
.  Name: “hello”<br />
}<br />
A package name can be represented by the AST node type *ast.Ident, which implements the ast.Expr interface. All identifiers are represented by this structure. It mainly contains its name and a source position within a file set.<br />
From the code shown above, we can see that the package name is hello and is declared in the first line of dummy.go.</p><br />
<br />
<p>We can’t dive any deeper into this node, let’s go back to the *ast.File.</p><br />
<br />
<p>Import Declarations<br />
ast.GenDecl<br />
<em>ast.GenDecl {<br />
.  TokPos: dummy.go:3:1<br />
.  Tok: import<br />
.  Lparen: -<br />
.  Specs: []ast.Spec (len = 1) {<br />
.  .  0: *ast.ImportSpec {/</em> Omission */}<br />
.  }<br />
.  Rparen: -<br />
}<br />
A declaration of import is represented by the AST node type *ast.GenDecl, which implements the ast.Decl interface. ast.GenDecl represents all declarations except for functions; That is, import, const, var, and type.</p><br />
<br />
<p>Tok represents a lexical token — which is specifies what the declaration is about (IMPORT or CONST or TYPE or VAR).<br />
This AST Node tells us that the import declaration is on line 3 in dummy.go.</p><br />
<br />
<p>Let’s visit ast.GenDecl in depth-first order. Take a look *ast.ImportSpec, the next Node.</p><br />
<br />
<p>ast.ImportSpec<br />
<em>ast.ImportSpec {<br />
.  Path: *ast.BasicLit {/</em> Omission */}<br />
.  EndPos: -<br />
}<br />
An ast.ImportSpec node corresponds to a single import declaration. It implements the ast.Spec interface. Visiting Path could make more sense about the import path. Let’s go there.</p><br />
<br />
<p>ast.BasicLit<br />
*ast.BasicLit {<br />
.  ValuePos: dummy.go:3:8<br />
.  Kind: STRING<br />
.  Value: “"fmt"”<br />
}<br />
An ast.BasicLit node represents a literal of basic type. It implements the ast.Expr interface. This contains a type of token and token.INT, token.FLOAT, token.IMAG, token.CHAR, or token.STRING can be used.<br />
From ast.ImportSpec and ast.BasicLit, we can see it has imported package called “fmt”.</p><br />
<br />
<p>We can’t dive any deeper, let’s get back to the top level again.</p><br />
<br />
<p>Function Declarations<br />
ast.FuncDecl<br />
<em>ast.FuncDecl {<br />
.  Name: *ast.Ident {/</em> Omission <em>/}<br />
.  Type: *ast.FuncType {/</em> Omission <em>/}<br />
.  Body: *ast.BlockStmt {/</em> Omission */}<br />
}<br />
An ast.FuncDecl node represents a function declaration. It implements only the ast.Node interface. Let’s take a look at them in order from Name, representing a function name.</p><br />
<br />
<p>ast.Ident<br />
*ast.Ident {<br />
.  NamePos: dummy.go:5:6<br />
.  Name: “greet”<br />
.  Obj: *ast.Object {<br />
.  .  Kind: func<br />
.  .  Name: “greet”<br />
.  .  Decl: *(obj @ 0)<br />
.  }<br />
}<br />
The second time this has appeared, let me skip the basic explanation.</p><br />
<br />
<p>Noteworthy is the *ast.Object. It represents the object to which the identifier refers, but why is this needed? As you know, Go has a concept of scope, which is the extent of source text in which the identifier denotes the specified constant, type, variable, function, label, or package.</p><br />
<br />
<p>The Decl field indicates where the identifier was declared so that it identifies the scope of the identifier. Identifiers that point to the identical object share the identical *ast.Object.</p><br />
<br />
<p>ast.FuncType<br />
<em>ast.FuncType {<br />
.  Func: dummy.go:5:1<br />
.  Params: *ast.FieldList {/</em> Omission */}<br />
}<br />
Go back to being a parent one generation older, an ast.FuncType contains a function signature including parameters, results, and position of “func” keyword.</p><br />
<br />
<p>ast.FieldList<br />
*ast.FieldList {<br />
.  Opening: dummy.go:5:11<br />
.  List: nil<br />
.  Closing: dummy.go:5:12<br />
}<br />
An ast.FieldList node represents a list of Fields, enclosed by parentheses or braces. Function parameters would be shown here if they are defined, but this time none, so no information.</p><br />
<br />
<p>List field is a slice of *ast.Field that contains a pair of identifiers and types. It is highly versatile and is used for a variety of Nodes, including *ast.StructType, *ast.InterfaceType, and here. That is, it’s needed when mapping a type to an identifier as shown below:</p><br />
<br />
<p>foo int<br />
bar string<br />
Let’s loop back to *ast.FuncDecl again and dive a bit into Body, the last field.</p><br />
<br />
<p>ast.BlockStmt<br />
<em>ast.BlockStmt {<br />
.  Lbrace: dummy.go:5:14<br />
.  List: []ast.Stmt (len = 1) {<br />
.  .  0: *ast.ExprStmt {/</em> Omission */}<br />
.  }<br />
.  Rbrace: dummy.go:7:1<br />
}<br />
An ast.BlockStmt node represents a braced statement list. It implements the ast.Stmt interface. It does have a list of statements. What an imaginable node!</p><br />
<br />
<p>ast.ExprStmt<br />
<em>ast.ExprStmt {<br />
.  X: *ast.CallExpr {/</em> Omission */}<br />
}<br />
ast.ExprStmt represents an expression in a statement list. It implements the ast.Stmt interface and contains a single ast.Expr.</p><br />
<br />
<p>ast.CallExpr<br />
<em>ast.CallExpr {<br />
.  Fun: *ast.SelectorExpr {/</em> Omission <em>/}<br />
.  Lparen: dummy.go:6:13<br />
.  Args: []ast.Expr (len = 1) {<br />
.  .  0: *ast.BasicLit {/</em> Omission */}<br />
.  }<br />
.  Ellipsis: -<br />
.  Rparen: dummy.go:6:28<br />
}<br />
ast.CallExpr represents an expression that calls a function. The fields to look at are Fun, the function to call and Args, the list of arguments to pass to it.</p><br />
<br />
<p>ast.SelectorExpr<br />
*ast.SelectorExpr {<br />
.  X: *ast.Ident {<br />
.  .  NamePos: dummy.go:6:2<br />
.  .  Name: “fmt”<br />
.  }<br />
.  Sel: *ast.Ident {<br />
.  .  NamePos: dummy.go:6:6<br />
.  .  Name: “Println”<br />
.  }<br />
}<br />
ast.SelectorExpr represents an expression followed by a selector. Simply put, it means fmt.Println.</p><br />
<br />
<p>ast.BasicLit<br />
*ast.BasicLit {<br />
.  ValuePos: dummy.go:6:14<br />
.  Kind: STRING<br />
.  Value: “"Hello, World"”<br />
}<br />
No longer needed an explanation, Hello, World!</p><br />
<br />
<p>Bottom Line<br />
I’ve left out some of the fields in the node types I’ve introduced, and there are still many other node types.</p><br />
<br />
<p>Nevertheless, I’d say it’s significant to actually walk the walk even if it’s a bit rough. And above all, it’s quite a bit of fun. Copy and paste the code shown in section “How to walk”, and have a try to walk around on your PC.</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>