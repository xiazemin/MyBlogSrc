<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">typeAssert</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-05-22T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> May 22, 2020</time></p>
					</div>
					 <p>https://ieevee.com/tech/2017/07/29/go-type.html<br />
如果某个函数的入参是interface{}，有下面几种方式可以获取入参的方法：</p><br />
<br />
<p>1 fmt:</p><br />
<br />
<p>import “fmt”<br />
func main() {<br />
    v := “hello world”<br />
    fmt.Println(typeof(v))<br />
}<br />
func typeof(v interface{}) string {<br />
    return fmt.Sprintf(“%T”, v)<br />
}<br />
2 反射：</p><br />
<br />
<p>import (<br />
    “reflect”<br />
    “fmt”<br />
)<br />
func main() {<br />
    v := “hello world”<br />
    fmt.Println(typeof(v))<br />
}<br />
func typeof(v interface{}) string {<br />
    return reflect.TypeOf(v).String()<br />
}<br />
3 类型断言：</p><br />
<br />
<p>func main() {<br />
    v := “hello world”<br />
    fmt.Println(typeof(v))<br />
}<br />
func typeof(v interface{}) string {<br />
    switch t := v.(type) {<br />
    case int:<br />
        return “int”<br />
    case float64:<br />
        return “float64”<br />
    //… etc<br />
    default:<br />
        _ = t<br />
        return “unknown”<br />
    }<br />
}<br />
其实前两个都是用了反射，fmt.Printf(“%T”)里最终调用的还是reflect.TypeOf()。</p><br />
<br />
<p>func (p *pp) printArg(arg interface{}, verb rune) {<br />
    …<br />
	// Special processing considerations.<br />
	// %T (the value’s type) and %p (its address) are special; we always do them first.<br />
	switch verb {<br />
	case ‘T’:<br />
		p.fmt.fmt_s(reflect.TypeOf(arg).String())<br />
		return<br />
	case ‘p’:<br />
		p.fmtPointer(reflect.ValueOf(arg), ‘p’)<br />
		return<br />
	}<br />
r<br />
<!-- more --><br />
reflect.TypeOf()的参数是v interface{}，golang的反射是怎么做到的呢？</p><br />
<br />
<p>在golang中，interface也是一个结构体，记录了2个指针：</p><br />
<br />
<p>指针1，指向该变量的类型<br />
指针2，指向该变量的value<br />
如下，空接口的结构体就是上述2个指针，第一个指针的类型是type rtype struct；非空接口由于需要携带的信息更多(例如该接口实现了哪些方法)，所以第一个指针的类型是itab，在itab中记录了该变量的动态类型: typ *rtype。</p><br />
<br />
<p>// emptyInterface is the header for an interface{} value.<br />
type emptyInterface struct {<br />
	typ  *rtype<br />
	word unsafe.Pointer<br />
}</p><br />
<br />
<p>// nonEmptyInterface is the header for a interface value with methods.<br />
type nonEmptyInterface struct {<br />
	// see ../runtime/iface.go:/Itab<br />
	itab *struct {<br />
		ityp   *rtype // static interface type<br />
		typ    *rtype // dynamic concrete type<br />
		link   unsafe.Pointer<br />
		bad    int32<br />
		unused int32<br />
		fun    [100000]unsafe.Pointer // method table<br />
	}<br />
	word unsafe.Pointer<br />
}<br />
我们来看看reflect.TypeOf():</p><br />
<br />
<p>// TypeOf returns the reflection Type that represents the dynamic type of i.<br />
// If i is a nil interface value, TypeOf returns nil.<br />
func TypeOf(i interface{}) Type {<br />
	eface := <em>(</em>emptyInterface)(unsafe.Pointer(&amp;i))<br />
	return toType(eface.typ)<br />
}<br />
TypeOf看到的是空接口interface{}，它将变量的地址转换为空接口，然后将将得到的rtype转为Type接口返回。需要注意，当调用reflect.TypeOf的之前，已经发生了一次隐式的类型转换，即将具体类型的向空接口转换。这个过程比较简单，只要拷贝typ *rtype和word unsafe.Pointer就可以了。</p><br />
<br />
<p>例如w := os.Stdout，该变量的接口值在内存里是这样的：</p><br />
<br />
<p>A *os.File interface value</p><br />
<br />
<p>那么对于第三种，类型断言是怎么判断是不是某个接口呢？回到最初，在golang中，接口是一个松耦合的概念，一个类型是不是实现了某个接口，就是看该类型是否实现了该接口要求的所有函数，所以，类型断言判断的方法就是检查该类型是否实现了接口要求的所有函数。</p><br />
<br />
<p>走读k8s代码的时候，可以看到比较多的类型断言的用法：</p><br />
<br />
<p>func LeastRequestedPriorityMap(pod <em>api.Pod, meta interface{}, nodeInfo *schedulercache.NodeInfo) (schedulerapi.HostPriority, error) {<br />
	var nonZeroRequest *schedulercache.Resource<br />
	if priorityMeta, ok := meta.(</em>priorityMetadata); ok {<br />
		nonZeroRequest = priorityMeta.nonZeroRequest<br />
	} else {<br />
		// We couldn’t parse metadata - fallback to computing it.<br />
		nonZeroRequest = getNonZeroRequests(pod)<br />
	}<br />
	return calculateUnusedPriority(pod, nonZeroRequest, nodeInfo)<br />
}<br />
类型断言的实现在src/runtime/iface.go里(?)，不过这块代码没看懂，等以后再更新吧。</p><br />
<br />
<p>func assertI2I2(inter *interfacetype, i iface) (r iface, b bool) {<br />
	tab := i.tab<br />
	if tab == nil {<br />
		return<br />
	}<br />
	if tab.inter != inter {<br />
		tab = getitab(inter, tab._type, true)<br />
		if tab == nil {<br />
			return<br />
		}<br />
	}<br />
	r.tab = tab<br />
	r.data = i.data<br />
	b = true<br />
	return<br />
}</p><br />
<br />
<p>func assertE2I2(inter *interfacetype, e eface) (r iface, b bool) {<br />
	t := e._type<br />
	if t == nil {<br />
		return<br />
	}<br />
	tab := getitab(inter, t, true)<br />
	if tab == nil {<br />
		return<br />
	}<br />
	r.tab = tab<br />
	r.data = e.data<br />
	b = true<br />
	return<br />
}<br />
Ref:</p><br />
<br />
<p>the go programming language<br />
go internal<br />
how to find a type of a object in golang</p><br />
<br />
<p>https://stackoverflow.com/questions/20170275/how-to-find-the-type-of-an-object-in-go</p><br />
<br />
<p>在Golang类型断言中可以使用反射数组类型吗<br />
import (<br />
  “reflect”<br />
)<br />
func AnythingToSlice(a interface{}) []interface{} {<br />
  rt := reflect.TypeOf(a)<br />
  switch rt.Kind() {<br />
  case reflect.Slice:<br />
    slice, ok := a.([]interface{})<br />
    if ok {<br />
      return slice<br />
    }<br />
    // it works</p><br />
<br />
<p>case reflect.Array:<br />
    // return a[:]<br />
    // it doesn’t work: cannot slice a (type interface {}) <br /><br />
    //<br />
    array, ok := a.([reflect.ValueOf(a).Len()]interface{})<br />
    // :-((( non-constant array bound reflect.ValueOf(a).Len()<br />
    if ok {<br />
       return array[:]<br />
    }</p><br />
<br />
<p>}<br />
  return []interface{}(a)<br />
}</p><br />
<br />
<p>An explicit type is required in a type assertion. The type cannot be constructed through reflection.</p><br />
<br />
<p>Unless the argument is a []interface{}, the slice or array must be copied to produce a []interface{}.</p><br />
<br />
<p>Try this:</p><br />
<br />
<p>func AnythingToSlice(a interface{}) []interface{} {<br />
    v := reflect.ValueOf(a)<br />
    switch v.Kind() {<br />
    case reflect.Slice, reflect.Array:<br />
        result := make([]interface{}, v.Len())<br />
        for i := 0; i &lt; v.Len(); i++ {<br />
            result[i] = v.Index(i).Interface()<br />
        }<br />
        return result<br />
    default:<br />
        panic(“not supported”)<br />
    }<br />
}</p><br />
<br />
<p>1.类型断言<br />
类型断言就是将接口类型的值(x)，装换成类型(T)。格式为：</p><br />
<br />
<p>x.(T)<br />
v:=x.(T)<br />
v,ok:=x.(T)<br />
类型断言的必要条件就是x是接口类型，非接口类型的x不能做类型断言：</p><br />
<br />
<p>var i int=10<br />
v:=i.(int) //错误 i不是接口类型<br />
T可以是非接口类型，如果想断言合法，则T应该实现x的接口</p><br />
<br />
<p>T也可以是接口，则x的动态类型也应该实现接口T</p><br />
<br />
<p>var x interface{}=7  //x的动态类型为int,值为7<br />
i:=x.(int)           // i的类型为int ,值为7</p><br />
<br />
<p>type I interface {m()}<br />
var y I</p><br />
<br />
<p>s:=y.(string)      //非法: string 没有实现接口 I (missing method m)<br />
r:=y.(io.Reader)   //y如果实现了接口io.Reader和I的情况下，  r的类型则为io.Reader<br />
类型断言如果非法，运行时就会出现错误，为了避免这种错误，可以使用一下语法：</p><br />
<br />
<p>v,ok:=x.(T)<br />
ok代表类型断言是否合法，如果非法,ok则为false,这样就不会出现panic了</p><br />
<br />
<p>2.类型切换 type switch<br />
类型切换用来比较类型而不是对值进行比较<br />
type switch它用于检测的是值x的类型T是否匹配某个类型.</p><br />
<br />
<p>格式如下，类似类型断言，但是括号内的不是某个具体的类型，而是单词type:</p><br />
<br />
<p>switch x.(type){</p><br />
<br />
<p>}<br />
type switch语句中可以有一个简写的变量声明，这种情况下，等价于这个变量声明在每个case clause 隐式代码块的开始位置。如果case clause只列出了一个类型，则变量的类型就是这个类型，否则就是原始值的类型</p><br />
<br />
<p>假设下面的例子中的x的类型为x interface{}:</p><br />
<br />
<p>switch i := x.(type) {<br />
case nil:<br />
  printString(“x is nil”) // i的类型是 x的类型 (interface{})<br />
case int:<br />
  printInt(i) // i的类型 int<br />
case float64:<br />
  printFloat64(i) // i的类型是 float64<br />
case func(int) float64:<br />
  printFunction(i) // i的类型是 func(int) float64<br />
case bool, string:<br />
  printString(“type is bool or string”) // i的类型是 x (interface{})<br />
default:<br />
  printString(“don’t know the type”) // i的类型是 x的类型 (interface{})<br />
}</p><br />
<br />
<p>https://studygolang.com/articles/28259?fr=sidebar</p><br />
<br />
<p>golang中的类型<br />
golang中的有两种类型，静态类型（static type）和动态类型（dynamic type）</p><br />
<br />
<p>静态类型：静态类型是在声明变量的时候指定的类型，一个变量的静态类型是永恒不变的，所以才被称为静态类型，也可以简称为类型，普通变量只有静态类型。</p><br />
<br />
<p>package main</p><br />
<br />
<p>import “fmt”</p><br />
<br />
<p>func main()  {<br />
    // 变量i和变量g只有静态类型，变量i的类型为int，i的类型为main.Goose，<br />
    var i int<br />
    var g Goose<br />
    fmt.Printf(“%T\n”, i)<br />
    fmt.Printf(“%T\n”, g)<br />
}</p><br />
<br />
<p>type Goose struct {<br />
    age  int<br />
    name string<br />
}</p><br />
<br />
<p>执行结果：<br />
int<br />
main.Sparrow<br />
动态类型：接口类型变量除了静态类型之外还有动态类型，动态类型是由给接口类型变量赋值的具体值的类型来决定的，除了动态类型之外还有动态值，动态类型和动态值是对应的，动态值就是接口类型变量赋值的具体值，之所以被称为动态类型，是因为接口类型的动态类型是会变化的，由被赋予的值来决定。</p><br />
<br />
<p>package main<br />
import “fmt”<br />
func main()  {<br />
    // 动态类型<br />
    var b Bird<br />
    // b 是main.Sparrow类型<br />
    b = Sparrow{}<br />
    fmt.Printf(“%T\n”, b)<br />
    // b 是main.Parrot类型<br />
    b = Parrot{}<br />
    fmt.Printf(“%T\n”, b)<br />
}<br />
type Bird interface {<br />
    fly()<br />
    sing()<br />
}<br />
// Goose implement Bird interface<br />
type Sparrow struct {<br />
    age  int<br />
    name string<br />
}<br />
func (s Sparrow) fly()  {<br />
    fmt.Println(“I am flying.”)<br />
}<br />
func (s Sparrow) sing()  {<br />
    fmt.Println(“I can sing.”)<br />
}<br />
type Parrot struct {<br />
    age  int<br />
    kind int<br />
    name string<br />
}<br />
func (p Parrot) fly()  {<br />
    fmt.Println(“I am flying.”)<br />
}<br />
func (p Parrot) sing()  {<br />
    fmt.Println(“I can sing.”)<br />
}</p><br />
<br />
<p>执行结果：<br />
main.Sparrow<br />
main.Parrot<br />
但是我们在变量b赋值之前直接获取它的类型会发现返回的结果是nil，这看起来很奇怪，interface在Golang里也是一种类型，那它声明的变量的类型为什么是nil呢？</p><br />
<br />
<p>package main<br />
import “fmt”<br />
func main()  {<br />
    // 动态类型<br />
    var b Bird<br />
    fmt.Printf(“interface类型变量的类型：%T\n”, b)<br />
}<br />
type Bird interface {<br />
    fly()<br />
    sing()<br />
}</p><br />
<br />
<p>执行结果：<br />
interface类型变量的类型：<nil><br />
首先我们需要明确，一个接口类型变量在没有被赋值之前，它的动态类型和动态值都是 nil 。在使用 fmt.Printf("%T\n") 获取一个变量的类型时，其实是调用了reflect包的方法进行获取的， reflect.TypeOf 获取的是接口变量的动态类型， reflect.valueOf() 获取的是接口变量的动态值。所以 fmt.Printf("%T\n",b) 展示的是 reflect.TypeOf 的结果，由于接口变量 b 还没有被赋值，所以它的动态类型是 nil ，动态值也会是 nil 。</nil></p><br />
<br />
<p>对比来看，为什么只是经过了声明未赋值的变量的类型不是 nil 呢？就像在静态类型部分中所展示的那样。原因如下： 我们先来看一下 reflect.TypeOf 函数的定义，func TypeOf(i interface{}) Type{} ，函数的参数是一个 interface 类型的变量，在调用 TypeOf 时，在接口变量 b 没有赋值之前，它的静态类型与参数类型一致，不需要做转换，因为 b 的动态类型为 nil，所以 TypeOf 返回的结果为 nil 。那为什么变量 i 和变量 g 的类型不为 nil 呢？当变量 i 调用 TypeOf 时，会进行类型的转换，将int型变量i转换为 interface 型，在这个过程中会将变量 i 的类型作为 b 的动态类型，变量 i 的值（在这里是变量 i 的零值0）作为 b 的动态值。因为 TypeOf() 获取的是变量 b 的动态类型，所以这个时候展示出的类型为 int。</p><br />
<br />
<p>golang中的类型断言<br />
因为接口变量的动态类型是变化的，有时我们需要知道一个接口变量的动态类型究竟是什么，这就需要使用类型断言，断言就是对接口变量的类型进行检查，其语法结构如下：</p><br />
<br />
<p>value, ok := x.(T)<br />
x表示要断言的接口变量；<br />
T表示要断言的目标类型；<br />
value表示断言成功之后目标类型变量；<br />
ok表示断言的结果，是一个bool型变量，true表示断言成功，false表示失败，如果失败value的值为nil。<br />
代码示例如下：</p><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
    “fmt”<br />
)</p><br />
<br />
<p>func main() {<br />
    // 动态类型<br />
    var b Bird<br />
    // b 是main.Sparrow类型<br />
    b = Sparrow{}</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Listen(b)<br />
<br />
// b 是main.Parrot类型<br />
b = Parrot{}<br />
<br />
Listen(b) }<br />
</code></pre></div></div><br />
<br />
<p>func Listen(b Bird) {<br />
    if _, ok := b.(Sparrow); ok {<br />
        fmt.Println(“Listren sparrow sing.”)<br />
    }</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if _, ok := b.(Parrot); ok {<br />
    fmt.Println("Listren parrot sing.")<br />
}<br />
<br />
b.sing() }<br />
</code></pre></div></div><br />
<br />
<p>type Bird interface {<br />
    fly()<br />
    sing()<br />
}</p><br />
<br />
<p>type Sparrow struct {<br />
    age  int<br />
    name string<br />
}</p><br />
<br />
<p>func (s Sparrow) fly() {<br />
    fmt.Println(“I am sparrow, i can fly.”)<br />
}<br />
func (s Sparrow) sing() {<br />
    fmt.Println(“I am sparrow, i can sing.”)<br />
}</p><br />
<br />
<p>type Parrot struct {<br />
    age  int<br />
    kind int<br />
    name string<br />
}</p><br />
<br />
<p>func (p Parrot) fly() {<br />
    fmt.Println(“I am parrot, i can fly.”)<br />
}<br />
func (p Parrot) sing() {<br />
    fmt.Println(“I am parrot, i can sing.”)<br />
}</p><br />
<br />
<p>执行结果如下：<br />
Listren sparrow sing.<br />
I am sparrow, i can sing.<br />
Listren parrot sing.<br />
I am parrot, i can sing.<br />
有时结合 switch 使用更方便</p><br />
<br />
<p>func Listen(b Bird) {<br />
    switch b.(type) {<br />
    case Sparrow:<br />
        fmt.Println(“Listren sparrow sing.”)<br />
    case Parrot:<br />
        fmt.Println(“Listren parrot sing.”)<br />
    default:<br />
        fmt.Println(“Who are you? I don’t know you.”)<br />
    }<br />
    b.sing()<br />
}</p><br />
<br />
<p>https://studygolang.com/articles/20041</p><br />
<br />
<p>package labs01</p><br />
<br />
<p>import “testing”</p><br />
<br />
<p>type InterfaceA interface {<br />
    AA()<br />
}</p><br />
<br />
<p>type InterfaceB interface {<br />
    BB()<br />
}</p><br />
<br />
<p>type A struct {<br />
    v int<br />
}</p><br />
<br />
<p>func (a *A) AA() {<br />
    a.v += 1<br />
}</p><br />
<br />
<p>type B struct {<br />
    v int<br />
}</p><br />
<br />
<p>func (b *B) BB() {<br />
    b.v += 1<br />
}</p><br />
<br />
<p>func TypeSwitch(v interface{}) {<br />
    switch v.(type) {<br />
    case InterfaceA:<br />
        v.(InterfaceA).AA()<br />
    case InterfaceB:<br />
        v.(InterfaceB).BB()<br />
    }<br />
}</p><br />
<br />
<p>func NormalSwitch(a *A) {<br />
    a.AA()<br />
}</p><br />
<br />
<p>func InterfaceSwitch(v interface{}) {<br />
    v.(InterfaceA).AA()<br />
}</p><br />
<br />
<p>func Benchmark_TypeSwitch(b *testing.B) {<br />
    var a = new(A)</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for i := 0; i &lt; b.N; i++ {<br />
    TypeSwitch(a)<br />
} }<br />
</code></pre></div></div><br />
<br />
<p>func Benchmark_NormalSwitch(b *testing.B) {<br />
    var a = new(A)</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for i := 0; i &lt; b.N; i++ {<br />
    NormalSwitch(a)<br />
} }<br />
</code></pre></div></div><br />
<br />
<p>func Benchmark_InterfaceSwitch(b *testing.B) {<br />
    var a = new(A)</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for i := 0; i &lt; b.N; i++ {<br />
    InterfaceSwitch(a)<br />
} }<br />
</code></pre></div></div><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>