<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">union</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-07-06T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Jul 6, 2020</time></p>
					</div>
					 <p>通常解决此问题的方法是定义一个容纳 yacc 将要处理 的对象的数据类型。这个数据类型是一个 C union 对象，在 yacc 文件的第一部分使用 %union 声明来定义。定义了记号以后，可以为 它们指定一个类型。例如，对于一个玩具级的编程语言来说，您可以像下面这样做：</p><br />
<br />
<p>清单 4. 一个最简化的 %union 声明<br />
%union {<br />
    long    value;<br />
}<br />
%token <value>    NUMBER<br />
%type <value> expression<br />
这就表明，当解析器得到 lexer 返回的 NUMBER 记号时，它可以 认为全局变量 yylval 的名为 value 的 成员已经被赋与了有意义的值。当然，您的 lexer 必须要以某种方式来处理它：</value></value></p><br />
<br />
<p>清单 5. 使一个 lexer 使用 yylval<br />
[0-9]+  {<br />
        yylval.value = strtol(yytext, 0, 10);<br />
        return NUMBER;<br />
    }<br />
yacc 允许您通过符号名引用表达式的组成部分。当解析非终结符时，进入解析器的组成部分被 命名为 $1 、 $2 ，依次类推；它将向 高层解析器返回的值名为 $$ <br />
<!-- more --><br />
https://www.ibm.com/developerworks/cn/linux/l-lexyac.html</p><br />
<br />
<p>https://github.com/chai2010/go-ast-book/blob/master/appendix/a-goyacc/readme.md</p><br />
<br />
<p>yacc是用于构造编译器的工具，而goyacc是Go语言版本的yacc，是从早期的C语言版本yacc移植到Go语言的。早期的goyacc是Go语言标准命令之一，也是构建Go自身编译器的必备工具链之一，后来被逐步移出了内置工具。但是goyacc依然是一个开发语法分析器的利器。本章简单展示如何用goyacc构建一个命令行计算器小程序。</p><br />
<br />
<p>A.1 计算器的特性<br />
特性简介：</p><br />
<br />
<p>支持整数四则运算<br />
支持小括弧提升优先级<br />
支持临时变量保存结果<br />
安装和使用(需要有GCC环境)：</p><br />
<br />
<p>$ go get github.com/chai2010/calculator<br />
$ calculator<br />
1+2<em>3<br />
= 7<br />
x=3-(2-1)<br />
= 2<br />
x</em>2<br />
= 4<br />
A.2 词法符号<br />
先创建tok.h文件，包含词法符号：</p><br />
<br />
<p>enum {<br />
	ILLEGAL = 10000,<br />
	EOL = 10001,</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ID = 258,<br />
NUMBER = 259,<br />
<br />
ADD = 260, // +<br />
SUB = 261, // -<br />
MUL = 262, // *<br />
DIV = 263, // /<br />
ABS = 264, // |<br />
<br />
LPAREN = 265, // (<br />
RPAREN = 266, // )<br />
ASSIGN = 267, // = }; 其中ILLEGAL表示不能识别的无效的符号，EOL表示行的结尾，其它的符号与字面含义相同。<br />
</code></pre></div></div><br />
<br />
<p>A.3 词法解析<br />
然后创建calc.l文件，定义每种词法的正则表达式：</p><br />
<br />
<p>%option noyywrap</p><br />
<br />
<p>%{<br />
#include “tok.h”<br />
%}</p><br />
<br />
<p>%%</p><br />
<br />
<p>[_a-zA-Z]+ { return ID; }<br />
[0-9]+     { return NUMBER; }</p><br />
<br />
<p>”+”    { return ADD; }<br />
“-“    { return SUB; }<br />
“*”    { return MUL; }<br />
“/”    { return DIV; }<br />
“|”    { return ABS; }</p><br />
<br />
<p>”(“    { return LPAREN; }<br />
“)”    { return RPAREN; }<br />
“=”    { return ASSIGN; }</p><br />
<br />
<p>\n     { return EOL; }<br />
[ \t]  { /* ignore whitespace */ }<br />
.      { return ILLEGAL; }</p><br />
<br />
<p>%%<br />
最开始的noyywrap选项表示关闭yywrap特性，也就是去掉对flex库的依赖，生成可移植的词法分析器代码。然后在%{和%}中间是原生的C语言代码，通过包含tok.h引入了每种记号对应的枚举类型。在两组%%中间的部分是每种记号对应的正则表达式，先出现的优先匹配，如果匹配失败则继续尝试后面的规则。每个正则表达式后面跟着一组动作代码，也就是普通的C语言代码，这里都是返回记号的类型。</p><br />
<br />
<p>然后通过flex工具生成C语言词法解析器文件：</p><br />
<br />
<p>$ flex –prefix=yy –header-file=calc.lex.h -o calc.lex.c calc.l<br />
其中–prefix表示生成的代码中标识符都是以yy前缀。在一个项目有多个flex生成代码时，可通过前缀区分。–header-file表示生成头问题，这样方便在其它代码中引用生成的词法分析函数。-o指定输出源代码文件的名字。</p><br />
<br />
<p>生成的词法分析器中，最重要的有以下几个：</p><br />
<br />
<p>extern int yylineno;<br />
extern char *yytext;</p><br />
<br />
<p>extern int yylex (void);<br />
其中yylineno表示当前的行号，yytext表示当前记号对应的字符串。而yylex函数每次从标准输入读取一个记号，返回记号类型的值（在tok.h文件定义），如果遇到文件结尾则返回0。</p><br />
<br />
<p>如果需要从字符串解析，则需使用以下的导出函数：</p><br />
<br />
<p>YY_BUFFER_STATE yy_scan_bytes (yyconst char *bytes,yy_size_t len  );<br />
通过yy_scan_bytes函数，可以设置字符串作为要解析的目标，然后每次调用yylex函数就会从字符串读取数据。这些函数都在calc.lex.h文件中声明。</p><br />
<br />
<p>A.4 将C语言词法分析器包装为Go函数<br />
创建lex.go文件，内容如下：</p><br />
<br />
<p>package main</p><br />
<br />
<p>//#include “tok.h”<br />
//#include “calc.lex.h”<br />
import “C”</p><br />
<br />
<p>type calcLex struct {}</p><br />
<br />
<p>func newCalcLexer(data []byte) <em>calcLex {<br />
	p := new(calcLex)<br />
	C.yy_scan_bytes((</em>C.char)(C.CBytes(data)), C.yy_size_t(len(data)))<br />
	return p<br />
}</p><br />
<br />
<p>func (p *calcLex) Lex(yylval *calcSymType) int {<br />
	var tok = C.yylex()<br />
	var yylineno = int(C.yylineno)<br />
	var yytext = C.GoString(C.yytext)</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>switch tok {<br />
case C.ID:<br />
	// yylval.id = yytext<br />
	return ID<br />
<br />
case C.NUMBER:<br />
	//yylval.value, _ = strconv.Atoi(yytext)<br />
	return NUMBER<br />
<br />
case C.ADD:<br />
	return ADD<br />
// ...<br />
<br />
case C.EOL:<br />
	return EOL<br />
}<br />
<br />
if tok == C.ILLEGAL {<br />
	log.Printf("lex: ILLEGAL token, yytext = %q, yylineno = %d", yytext, yylineno)<br />
}<br />
<br />
return 0 // eof } 新建的calcLex类型对应Go语言版本的词法分析器，底层工作通过CGO调用flex生成的C语言函数完成。首先newCalcLexer创建一个词法分析器，参数是要分析的数据，通过C.yy_scan_bytes函数调用表示从字符串解析记号。然后calcLex类型的Lex方法表示每次需要解析一个记号（暂时忽略方法的calcSymType参数），内部通过调用C.yylex()读取一个记号，同时记录行号和记号对应的字符串。最后将C语言的记号转为Go语言的记号值返回，比如C.ID对应Go语言的ID。<br />
</code></pre></div></div><br />
<br />
<p>对应ID类型，yytext表示变量的名字。对于NUMBER类型，yytext保护数字对应的字符串，可以从字符串解析出数值。但是，Go语言的词法分析器如何返回变量的名字或者是数字的值呢？答案是通过Lex的*calcSymType类型的参数可以记录记号额外的属性值。而calcSymType类型是由goyacc工具生成的代码，在下面我们将介绍yacc的内容。</p><br />
<br />
<p>A.5 goyacc生成语法解析器<br />
goyacc是Go语言版本的yacc工具，是由Go语言官方团队维护的扩展包工具。</p><br />
<br />
<p>创建calc.y文件：</p><br />
<br />
<p>%{<br />
package main</p><br />
<br />
<p>var idValueMap = map[string]int{}<br />
%}</p><br />
<br />
<p>%union {<br />
	value int<br />
	id    string<br />
}</p><br />
<br />
<p>%type  <value> exp factor term<br />
%token <value> NUMBER<br />
%token <id>    ID</id></value></value></p><br />
<br />
<p>%token ADD SUB MUL DIV ABS<br />
%token LPAREN RPAREN ASSIGN<br />
%token EOL</p><br />
<br />
<p>%%<br />
calclist<br />
	: // nothing<br />
	| calclist exp EOL {<br />
		idValueMap[“<em>”] = $2<br />
		fmt.Printf(“= %v\n”, $2)<br />
	}<br />
	| calclist ID ASSIGN exp EOL {<br />
		idValueMap[“</em>”] = $4<br />
		idValueMap[$2] = $4<br />
		fmt.Printf(“= %v\n”, $4)<br />
	}<br />
	;</p><br />
<br />
<p>exp<br />
	: factor         { \(= $1 }<br />
	| exp ADD factor {\) = $1 + $3 }<br />
	| exp SUB factor { $$ = $1 - $3 }<br />
	;</p><br />
<br />
<p>factor<br />
	: term            { \(= $1 }<br />
	| factor MUL term {\) = $1 * $3 }<br />
	| factor DIV term { $$ = $1 / $3 }<br />
	;</p><br />
<br />
<p>term<br />
	: NUMBER            { \(= $1 }<br />
	| ID                {\) = idValueMap[$1] }<br />
	;</p><br />
<br />
<p>%%<br />
和flex工具类型，首先在%{和%}中间是原生的Go语言代码。然后%union定义了属性值，用于记录语法解析中每个规则额外的属性值。通过%type定义BNF规则中非终结的名字，%token定义终结记号名字（和flex定义的记号类型是一致的）。而%type和%token就可以通过<value>或<id>的可选语法，将后面的名字绑定到属性。就是后续代码中$$对应的属性，比如%token <id> ID表示ID对应的属性为id，因此在后面的ID { $$ = idValueMap[$1] }表示数值id属性的值，其中idValueMap用于管理变量的值。</id></id></value></p><br />
<br />
<p>然后通过goyacc工具生成代码：</p><br />
<br />
<p>$ goyacc -o calc.y.go -p “calc” calc.y<br />
其中-o指定输出的文件名，-p指定标识符名字前缀（和flex的–prefix用法类似）。在生成的calc.y.go文件中将包含最重要的calcParse函数，该函数从指定的词法解析器中读取词法，然后进行语法分析。同时将包含calcSymType类型的定义，它是Lex词法函数的输出参数的类型。</p><br />
<br />
<p>在绑定了属性之后，还需要继续完善Lex词法函数的代码：</p><br />
<br />
<p>func (p *calcLex) Lex(yylval *calcSymType) int {<br />
	var tok = C.yylex()<br />
	var yylineno = int(C.yylineno)<br />
	var yytext = C.GoString(C.yytext)</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>switch tok {<br />
case C.ID:<br />
	yylval.id = yytext<br />
	return ID<br />
<br />
case C.NUMBER:<br />
	yylval.value, _ = strconv.Atoi(yytext)<br />
	return NUMBER<br />
<br />
... } 其中yylval.id = yytext表示词法将解析得到的变量名字填充到id属性中。而数字部分则是通过yylval.value属性保存。<br />
</code></pre></div></div><br />
<br />
<p>A.6 运行计算器<br />
创建main函数：</p><br />
<br />
<p>func main() {<br />
	calcParse(newCalcLexer([]byte(“1+2*3”)))<br />
}<br />
newCalcLexer构造一个词法解析器，然后calcParse语法解析器将从词法解析器依次读取记号并解析语法，在解析语法的同时将进行表达式求值运算，同时更新idValueMap全局的变量</p><br />
<br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>