<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">Generating Go code in Kubebuilder style</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-04-03T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Apr 3, 2020</time></p>
					</div>
					 <p>Generally speaking, code generation is the process of producing code from some sort of abstract description. Although this is not a very expressive description, almost everyone has some sort of understanding of code generation. For example, in the cloud native ecosystem generating code from Protobuf or OpenAPI descriptors is quite common.</p><br />
<br />
<p>Code generation, however, is much more than that. Besides specific, (very) high-level definition languages, program code is also such abstract description. Generating code based on code is actually what happens when a compiler translates program code written in a high-level programming language into machine code for example. The compiler parses the code, optimizes it and then generates a set of instructions that our computer can understand.<br />
https://banzaicloud.com/blog/generating-go-code/<br />
<!-- more --><br />
High-level programming languages exist, so that we don’t have to speak to the machine directly. Talking to the machine is tedious, because it works differently than the human brain.</p><br />
<br />
<p>Similarly, we don’t handle repeating things very well either. At least in computer engineering, if something needs to be done more than once, we want to automate it. We’ve invented a lot of tools that help us avoid repeating code, from reusable libraries to parametric polymorphism (commonly known as generics).</p><br />
<br />
<p>What if we can automate writing code as well? In other words: what if we can generate code (in the same language) from code?</p><br />
<br />
<p>In this post, you can read about generating Go code using the same tools as Kubebuilder uses. As an example, we are going to implement a shallow copy generator for structs (which doesn’t make much sense on its own, but serves as an excellent example).</p><br />
<br />
<p>Generating Go code<br />
Generating code (with some simplification) can be split into two phases:</p><br />
<br />
<p>parsing the input and transforming it into an intermediate representation<br />
producing the actual code from that representation<br />
The intermediate representation can vary, but it can be as simple as a set of parameters of a function. The important thing is to have an intermediate layer that acts as a “DTO” between the parser and the code generator, so they don’t depend on each other directly.</p><br />
<br />
<p>For the actual code generation, there are several common solutions in Go. They are not actually specific to Go (ie. the same idea can be applied to other languages as well), but I want to show you how you can do it in Go.</p><br />
<br />
<p>The first (and probably the easiest) way is templating. Almost every language has its own templating solution (either builtin or a userland version). Go has a template engine built into its standard library, using its own template language which can be used for generating code:</p><br />
<br />
<p>1package {{ .PackageName }}<br />
2<br />
3func (o {{ .StructName }}) ShallowCopy() {{ .StructName }} {<br />
4	return {{ .StructName }}{<br />
5		{{- range $field := .Fields }}<br />
6		{{ $field }}: o.{{ $field }},<br />
7		{{- end }}<br />
8	}<br />
9}<br />
Given the following struct:</p><br />
<br />
<p>1package pkg<br />
2<br />
3type MyStruct struct {<br />
4	Field1 int<br />
5	Field2 string<br />
6}<br />
We can create an intermediate representation for our template:</p><br />
<br />
<p>1data := map[string]interface{}{<br />
2	“PackageName”: “pkg”,<br />
3	“StructName”:  “MyStruct”,<br />
4	“Fields”: []string{<br />
5		“Field1”,<br />
6		“Field2”,<br />
7	},<br />
8}<br />
In our case, we can feed that directly into our template to generate our shallow copy function:</p><br />
<br />
<p>1package pkg<br />
2<br />
3func (o MyStruct) ShallowCopy() MyStruct {<br />
4	return MyStruct{<br />
5		Field1: o.Field1,<br />
6		Field2: o.Field2,<br />
7	}<br />
8}<br />
See it in action: https://play.golang.org/p/hCRya6l61U8</p><br />
<br />
<p>Using templates has a major downside though: basically you limit yourself to the tools provided by the template engine, which can be hard or tedious to use for code generation purposes. The above example doesn’t use conditionals or loops for instance. Despite you have them in Go’s template language, it can very quickly become complex and hard to maintain. So while templates are usually more readable and using them is easy for simpler use cases, it can quickly get complex and tricky to maintain.</p><br />
<br />
<p>Another approach that doesn’t suffer from those issues is just writing the code to a buffer in plain Go code:</p><br />
<br />
<p>1b := &amp;bytes.Buffer{}<br />
 2<br />
 3fmt.Fprintf(b, “package %s\n\n”, data.PackageName)<br />
 4fmt.Fprintf(b, “func (o %[1]s) ShallowCopy() %[1]s {\n”, data.StructName)<br />
 5fmt.Fprintf(b, “\treturn %s{\n”, data.StructName)<br />
 6<br />
 7for _, field := range data.Fields {<br />
 8	fmt.Fprintf(b, “\t\t%[1]s: o.%[1]s,”, field)<br />
 9}<br />
10<br />
11fmt.Fprint(b, “\t}\n”)<br />
12fmt.Fprint(b, “}\n”)<br />
See it in action: https://play.golang.org/p/UoiVSDbw88b</p><br />
<br />
<p>Comparing this solution to the template shows that there is a serious readability issue with this one, so in simple use cases it’s probably better to use templating.</p><br />
<br />
<p>As mentioned before, though, templating might not always be the best solution either, so we should try to address the problems of this approach.</p><br />
<br />
<p>One major problem that obscures reading is the API itself. We write lines, but the actual code begins somewhere in the middle of every write operation.</p><br />
<br />
<p>The other problem is indentation: you have to prefix every line with the correct amount of tab characters (technically formatting could be a separate step).</p><br />
<br />
<p>One common solution addressing these issues is a custom writer that exposes a fluent API:</p><br />
<br />
<p>1b := &amp;bytes.Buffer{}<br />
 2w := &amp;genWriter{<br />
 3	w: b,<br />
 4}<br />
 5<br />
 6w.Wf(“package %s\n”, data.PackageName)<br />
 7w.Wf(“func (o %[1]s) ShallowCopy() %[1]s {“, data.StructName)<br />
 8<br />
 9{<br />
10	w := w.Indent()<br />
11<br />
12	w.Wf(“return %s{“, data.StructName)<br />
13<br />
14	{<br />
15		w := w.Indent()<br />
16<br />
17		for _, field := range data.Fields {<br />
18			w.Wf(“%[1]s: o.%[1]s,”, field)<br />
19		}<br />
20	}<br />
21<br />
22	w.W(“}”)<br />
23}<br />
24<br />
25w.W(“}”)<br />
See it in action: https://play.golang.org/p/dS45fgUj2lJ</p><br />
<br />
<p>This is just a very simple (and obviously not the best possible) wrapper around a buffer, but it already improves readability significantly. The Go implementation of Protobuf is a great example for this approach, but under the hood Kubebuilder also uses a similar solution.</p><br />
<br />
<p>Writing to a buffer (even through some sort of wrapper) - though it’s probably the most common solution these days - still has its own issues. It’s still not perfect from a readability perspective, it forces you to linear coding, reusing components is hard (eg. you have to take care of indentations), etc.</p><br />
<br />
<p>Some libraries decided to take this to the next level, and provide a complete (fluent) API for code generation. One such library is jennifer. (Fun fact: code generation libraries are often called Jen, Jenny or Jennifer)</p><br />
<br />
<p>Generating the above code with jennifer looks like this:</p><br />
<br />
<p>1f := jen.NewFile(data.PackageName)<br />
 2<br />
 3f.Func().<br />
 4	Params(jen.Id(“o”).Id(data.StructName)).<br />
 5	Id(“ShallowCopy”).<br />
 6	Params().<br />
 7	Params(jen.Id(data.StructName)).<br />
 8	Block(jen.Return(<br />
 9		jen.Id(data.StructName).Values(jen.DictFunc(func(d jen.Dict) {<br />
10			for _, field := range data.Fields {<br />
11				d[jen.Id(field)] = jen.Id(“o”).Dot(field)<br />
12			}<br />
13		})),<br />
14	))<br />
See it in action: https://play.golang.org/p/Vg8RxDMX6xm</p><br />
<br />
<p>This approach is not necessarily more readable though, but definitely provides a more structured and more reusable solution. It also gives you more freedom in how you want your code to be built (you are not bound to the linear nature of the buffered writer solution). The library is quite well-documented with lots of examples. Give it a try!</p><br />
<br />
<p>To sum up: there are multiple solutions and tools for producing (Go) code in Go, each has its own issues/limitations. Choose the one that fits your use case better and/or easier to use for you.</p><br />
<br />
<p>Using code as input<br />
So far we focused on how the code is being generated from a custom input definition that looked something like this:</p><br />
<br />
<p>1type inputData struct {<br />
 2	PackageName string<br />
 3	StructName  string<br />
 4	Fields      []string<br />
 5}<br />
 6<br />
 7// …<br />
 8<br />
 9data := inputData{<br />
10	PackageName: “pkg”,<br />
11	StructName:  “MyStruct”,<br />
12	Fields: []string{<br />
13		“Field1”,<br />
14		“Field2”,<br />
15	},<br />
16}<br />
As I mentioned earlier, the input for code generation can basically be anything. Common inputs are IDLs (Interface Definition Language), but source code itself can serve as an input for code generation.</p><br />
<br />
<p>In our example, we want to generate a shallow copy function for a simple struct:</p><br />
<br />
<p>1type MyStruct struct {<br />
2	Field1 int<br />
3	Field2 string<br />
4}<br />
For that purpose, we need to parse the Go source code and transform it into the above shown intermediate representation.</p><br />
<br />
<p>Fortunately, Go provides enough tooling for that. The go package in the standard library provides tools to parse the source code into an AST and further examine the code through the go/types package.</p><br />
<br />
<p>There is also golang.org/x/tools/go/packages that helps loading code from packages/modules.</p><br />
<br />
<p>While these tools are sufficient enough to implement a parser for our code generator, presenting them would fill an entire blog post of its own. Instead, I will show you a higher level framework that uses these components under the hood for orchestrating the entire generation process.</p><br />
<br />
<p>Kubebuilder<br />
Kubebuilder is the latest SDK for building so called Operators for Kubernetes. Operators are basically resource orchestrators: you tell the operator the desired state of a resource, and the operator will hammer the target systems until the resource looks exactly like it should.</p><br />
<br />
<p>From our perspective, the desired state is the important bit here. The desired state is described through special, custom Kubernetes manifests (Custom Resources - CRs). Custom resources must follow a strict specification provided by Custom Resource Definitions (CRDs). In an object oriented analogue: CRDs are classes, CRs are objects. Operators watch CRs for changes in the desired state and apply those changes to their managed resources.</p><br />
<br />
<p>Kubebuilder provides various tools for creating Operators and CRDs, keeping the necessary coding at minimum. It does that by providing various code generators for generating boilerplate code for CRDs, CRs and Operators.</p><br />
<br />
<p>For example, the code generation input for CRDs is a plain old struct. This struct is actually used by the operator to do work on the CR. The code generator uses the struct to generate OpenAPI schema, CRD resources, validation and deep copy functions, etc.</p><br />
<br />
<p>Let’s think about this for a minute. Suppose we have the following struct:</p><br />
<br />
<p>1type MyStruct struct {<br />
2	Field1 int<br />
3	Field2 string<br />
4}<br />
There is very limited information available in it. We know the name of the fields, we know their type. How are we supposed to derive validation rules from this information only? We obviously need a way to attach custom information to the code in order to do that. Go doesn’t have an annotation system, Kubebuilder uses markers instead.</p><br />
<br />
<p>Markers are special comments attaching metadata to packages, named types and struct fields:</p><br />
<br />
<p>1// +my:marker:generate=true<br />
2type MyStruct struct {<br />
3	// +my:validation:Min=2<br />
4	Field1 int<br />
5<br />
6	Field2 string<br />
7}<br />
The attached metadata can be used to:</p><br />
<br />
<p>filter types subject to code generation (only generate code for the marked types)<br />
provide additional input for the generator (eg. validation rules for a field)<br />
Markers are registered in a global registry and are processed together with the type information during the code generation.</p><br />
<br />
<p>The code generation framework itself can be broken down into three components:</p><br />
<br />
<p>inputs<br />
generators<br />
outputs<br />
Inputs are input parameters of the whole process or individual generators (a single code generation process can invoke multiple generators), for example the package paths to be loaded.</p><br />
<br />
<p>Generators are implementations of the sigs.k8s.io/controller-tools/pkg/genall.Generator interface.</p><br />
<br />
<p>A generator instance is responsible for two things:</p><br />
<br />
<p>registering custom markers in a common marker registry<br />
traversing the type information (with markers) extracted from the loaded packages and generating code<br />
A very basic implementation a generator looks like this:</p><br />
<br />
<p>1type Generator struct{}<br />
 2<br />
 3func (Generator) RegisterMarkers(into *markers.Registry) error {<br />
 4	return nil<br />
 5}<br />
 6<br />
 7func (Generator) Generate(ctx *genall.GenerationContext) error {<br />
 8	// loop through the loaded packages<br />
 9	for _, root := range ctx.Roots {<br />
10		root.NeedTypesInfo()<br />
11<br />
12		// loop through the types in the package<br />
13		if err := markers.EachType(ctx.Collector, root, func(info *markers.TypeInfo) {<br />
14			// check if the type needs code generation<br />
15			// and extract the necessary information from the type<br />
16		}); err != nil {<br />
17			root.AddError(err)<br />
18			return nil<br />
19		}<br />
20<br />
21		// generate all the code here for a single package<br />
22		// (if there is anything to generate)<br />
23		// invoke the output here<br />
24	}<br />
25<br />
26	return nil<br />
27}<br />
Outputs are responsible for writing the generated code to files. There are basic output implementations in the library (stdout, directory, etc), but you can use your own outputs to control where the generated code gets written.</p><br />
<br />
<p>These components (inputs, generators, outputs) can be used on their own, but the library also comes with a facade, that takes them as its input and coordinates the code generation using these components.</p><br />
<br />
<p>Unfortunately going through the entire code, line by line is simply not possible within the scope of this post. The core concepts and some sample codes are explained above, you can find the source code for the complete example here.</p><br />
<br />
<p>Use Cases<br />
Generally, code generation is very useful for generating boilerplate code and automatically creating different representations of the same information (eg. OpenAPI descriptor -&gt; Request/Response objects and client code). Generating default implementations and mocks are also very common, but generating interfaces is also not without precedent.</p><br />
<br />
<p>At Banzai Cloud we have almost all of these use cases in our projects and we use various code generation tools.</p><br />
<br />
<p>Our latest code generation practice is closely related to how we organize our applications:</p><br />
<br />
<p>We follow the elegant monolith concept in most of our projects. To keep the operational overhead of our components at a minimum we ship them in a low number of artifacts (binaries/images), but in the code we keep the different services of a single application strictly separated. We also separate the business logic from the transport layers:</p><br />
<br />
<p>on the outer layer there is a RESTish HTTP API<br />
internally the components use gRPC for communication</p><br />
<br />
<p>Integrating business logic into transport layers is usually a boring job. That’s why we generate most of that code, so that we can easily integrate business services into various transport methods (using Go kit).</p><br />
<br />
<p>We also generate certain event-driven handlers and mocks for interfaces using the technique explained above. Check out the tool we use for code generation for more examples.</p><br />
<br />
<p>Conclusion<br />
The framework provided by Kubebuilder (controller-tools) provides an easy way to annotate and parse code for code generation purposes whereas text/template and jennifer help with the actual code generation.</p><br />
<br />
<p>Regardless of the use case, this combination can be used to quickly create code generators for various purposes.</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>