<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">TinyGo</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-04-13T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Apr 13, 2020</time></p>
					</div>
					 <p>https://marianogappa.github.io/software/2020/04/01/webassembly-tinygo-cheesse/<br />
This is the story of how I managed to expose my Golang chess API project cheesse as a WebAssembly binary, compiled using TinyGo, so JavaScript could use it without needing a server.<br />
<!-- more --><br />
What are all those technologies?<br />
WebAssembly</p><br />
<br />
<p>Assembly language of the Web, apparently. All major browsers support it, and the Go compiler supports js/wasm as an OS/ARCH target, so one can write Go code that runs on a webpage, rather than on a server.</p><br />
<br />
<p>TinyGo</p><br />
<br />
<p>It’s a Go compiler optimised for the WebAssembly target (and also for microcontrollers). The key advantage over the official Go compiler is that it generates tiny binaries. Even the Go wiki recommends using TinyGo.</p><br />
<br />
<p>Cheesse</p><br />
<br />
<p>Chess API that tells you, e.g.:</p><br />
<br />
<p>given chess board: what are the possible moves?<br />
given a chess board and an action: what does the game look like after?<br />
given a chess match in some notation: how does the chess board evolve?<br />
What’s the goal?<br />
The cheesse API compiles to a wasm binary, exposing the API to JavaScript without needing a server.<br />
It is not necessary to maintain a separate version of the code to compile to this target.<br />
The generated wasm binary has a reasonable size for use on the Web.<br />
Exposing API to JavaScript<br />
Consider one of cheesse’s basic endpoints:</p><br />
<br />
<p>ParseGame(game InputGame) (OutputGame, error)<br />
You give it a chess game and it spits out all relevant info about it, or an error if input is wrong.</p><br />
<br />
<p>This is how you expose a function onto the JavaScript global scope:</p><br />
<br />
<p>// This should be in a “main_js.go”<br />
func main() {<br />
  js.Global().Set(“ParseGame”, js.FuncOf(ParseGame))<br />
  select {} // Code must not finish<br />
}<br />
If you don’t do that select{}, or something to that effect, you’ll find this error in the Developer console of your browser:</p><br />
<br />
<p>Error: Go program has already exited<br />
Mapping values from JS to Go and vice-versa<br />
This is the implementation of the ParseGame function defined above:</p><br />
<br />
<p>func ParseGame(this js.Value, args []js.Value) interface{} {<br />
  og, err := api.ParseGame(convertToInputGame(args[0]))<br />
  return js.ValueOf(map[string]interface{}{<br />
    “outputGame”: convertOutputGame(og),<br />
    “error”: convertError(err),<br />
  })<br />
}<br />
Basically just mapping the API’s inputs and outputs to js/syscall’s interfaces.</p><br />
<br />
<p>ParseGame follows js.FuncOf()’s interface:</p><br />
<br />
<p>(this js.Value, args []js.Value) interface{}<br />
Where args are the arguments supplied to ParseGame from JavaScript.</p><br />
<br />
<p>Here’s a simplified implementation of convertToInputGame:</p><br />
<br />
<p>func convertToInputGame(v js.Value) api.InputGame {<br />
  return api.InputGame{<br />
    DefaultGame: jsBool(v.Get(“defaultGame”)),<br />
    FENString: jsString(v.Get(“fenString”)),<br />
  }<br />
}</p><br />
<br />
<p>func  jsBool(j js.Value) bool {<br />
  if j.IsUndefined() || j.IsNull() {<br />
    return  false<br />
  }<br />
 return j.Bool()<br />
}</p><br />
<br />
<p>func  jsString(j js.Value) string {<br />
  if j.IsUndefined() || j.IsNull() {<br />
    return  “”<br />
  }<br />
  return j.String()<br />
}<br />
For convertOutputGame, it’s trickier. Here’s a very simplified OutputGame:</p><br />
<br />
<p>type OutputGame struct {<br />
  FENString string         <code class="language-plaintext highlighter-rouge">json:"fenString"</code><br />
  Actions   []OutputAction <code class="language-plaintext highlighter-rouge">json:"actions"</code><br />
}</p><br />
<br />
<p>type OutputAction struct {<br />
  FromSquare      string  <code class="language-plaintext highlighter-rouge">json:"fromSquare"</code><br />
  ToSquare        string  <code class="language-plaintext highlighter-rouge">json:"toSquare"</code><br />
}<br />
How do we map a struct with a slice of structs to something that js.ValueOf can receive? For this, first review the docs:</p><br />
<br />
<p>func ValueOf(x interface{}) Value</p><br />
<br />
<p>ValueOf returns x as a JavaScript value:</p><br />
<br />
<table><br />
  <thead><br />
    <tr><br />
      <th>Go</th><br />
      <th>JavaScript</th><br />
    </tr><br />
  </thead><br />
  <tbody><br />
    <tr><br />
      <td>js.Value</td><br />
      <td>[its value]</td><br />
    </tr><br />
    <tr><br />
      <td>js.Func</td><br />
      <td>function</td><br />
    </tr><br />
    <tr><br />
      <td>nil</td><br />
      <td>null</td><br />
    </tr><br />
    <tr><br />
      <td>bool</td><br />
      <td>boolean</td><br />
    </tr><br />
    <tr><br />
      <td>integers and floats</td><br />
      <td>number</td><br />
    </tr><br />
    <tr><br />
      <td>string</td><br />
      <td>string</td><br />
    </tr><br />
    <tr><br />
      <td>[]interface{}</td><br />
      <td>new array</td><br />
    </tr><br />
    <tr><br />
      <td>map[string]interface{}</td><br />
      <td>new object</td><br />
    </tr><br />
  </tbody><br />
</table><br />
<br />
<p>Panics if x is not one of the expected types.<br />
Go struct =&gt; JS object, so top-layer we must send a map[string]interface{}.</p><br />
<br />
<p>The trick is: the map’s values (i.e. the interface{} part) follow the same rules from those docs. That’s how we achieve the nesting.</p><br />
<br />
<p>func convertOutputGame(og api.OutputGame) map[string]interface{} {<br />
  return map[string]interface{}{<br />
    “fenString”: og.FENString,<br />
    “actions”: convertOutputActions(og.Actions),<br />
  }<br />
}</p><br />
<br />
<p>func convertOutputActions(as []api.OutputAction) []interface{} {<br />
  is := make([]interface{}, len(as))<br />
  for i := range as {<br />
    is[i] = convertOutputAction(as[i])<br />
  }<br />
  return is<br />
}</p><br />
<br />
<p>func convertOutputAction(a api.OutputAction) map[string]interface{} {<br />
  return map[string]interface{}{<br />
    “fromSquare”: a.FromPieceSquare,<br />
    “toSquare”: a.ToSquare,<br />
  }<br />
}<br />
Ok, compile time!<br />
✔ $ GOOS=js GOARCH=wasm go build -o poc/main.wasm</p><br />
<h1 id="githubcommarianogappacheesse">github.com/marianogappa/cheesse</h1><br />
<p>./main_js.go:39:6: main redeclared in this block<br />
	previous declaration at ./main.go:17:6<br />
Oh, right. We have two main(). We can use build constraints.</p><br />
<br />
<p>Put this on the first line of main.go:</p><br />
<br />
<p>// +build !js</p><br />
<br />
<p>package main<br />
And this on the first line of main_js.go:</p><br />
<br />
<p>// +build js,wasm</p><br />
<br />
<p>package main<br />
Don’t forget to leave a newline between the // and package main. That’s not optional and fails silently.</p><br />
<br />
<p>Also, don’t do +build !js,wasm. That doesn’t work either. There’s only wasm anyway, right?</p><br />
<br />
<p>Ok, compile time! #2<br />
✔ $ GOOS=js GOARCH=wasm go build -o poc/main.wasm<br />
✔ $<br />
🎉</p><br />
<br />
<p>Follow these instructions on how to load the main.wasm into an index.html file.</p><br />
<br />
<p>If you try to open the index.html directly on your browser you’ll get this error on the browser’s Developer Console:</p><br />
<br />
<p>Fetch API cannot load file:///…/poc/main.wasm.<br />
URL scheme must be “http” or “https” for CORS request.<br />
You need to serve the files.</p><br />
<br />
<p>Serving the files<br />
Your favourite one-liner server (is it Python’s SimpleHTTPServer for all of us?), might give you this error:</p><br />
<br />
<p>TypeError: Response has unsupported MIME type<br />
You need a server that knows about WebAssembly’s MIME type.</p><br />
<br />
<p>The easy way:</p><br />
<br />
<h1 id="install-goexec-go-get--u-githubcomshurcoolgoexec">install goexec: go get -u github.com/shurcooL/goexec</h1><br />
<p>$ goexec ‘http.ListenAndServe(<code class="language-plaintext highlighter-rouge">:8080</code>, http.FileServer(http.Dir(<code class="language-plaintext highlighter-rouge">.</code>)))’<br />
If you really want to use SimpleHTTPServer there’s a solution that I validated to work here.</p><br />
<br />
<p>Did it work?<br />
Yes! 🎉</p><br />
<br />
<p>Working Proof of Concept</p><br />
<br />
<p>But there’s a catch:</p><br />
<br />
<p>$ ll -h main.wasm<br />
-rwxr-xr-x  1 marianol  staff   7.6M 28 Mar 20:45 main.wasm<br />
I know the Web is bloated, but 7.6MB is not gonna fly.</p><br />
<br />
<p>Enter TinyGo<br />
Drop-in replacement for the Go compiler, right?</p><br />
<br />
<p>$ tinygo build -o poc/main.wasm -target wasm .<br />
error: requires go version 1.11, 1.12, or 1.13, got go1.14<br />
Ok, that’s not that bad. Go 1.14 is gonna be supported soon, but for now we’ll have to downgrade:</p><br />
<br />
<p>$ brew install go@1.13<br />
…<br />
$ echo ‘export PATH=”/usr/local/opt/go@1.13/bin:$PATH”’ » ~/.bash_profile<br />
…<br />
$ go version<br />
go version go1.13.9 darwin/amd64<br />
TinyGo, Round 2!<br />
Drop-in replacement for the Go compiler, right?</p><br />
<br />
<p>$ tinygo build -o poc/main.wasm -target wasm .</p><br />
<h1 id="encodingasn1">encoding/asn1</h1><br />
<p>usr/local/Cellar/go@1.13/1.13.9/libexec/src/encoding/asn1/marshal.go:537:47: v.Type().NumMethod undefined (type reflect.Type has no field or method NumMethod)<br />
usr/local/Cellar/go@1.13/1.13.9/libexec/src/encoding/asn1/marshal.go:549:14: DeepEqual not declared by package reflect<br />
usr/local/Cellar/go@1.13/1.13.9/libexec/src/encoding/asn1/marshal.go:558:14: DeepEqual not declared by package reflect<br />
usr/local/Cellar/go@1.13/1.13.9/libexec/src/encoding/asn1/marshal.go:479:93: t.Field(startingField).Tag.Get undefined (type string has no field or method Get)<br />
usr/local/Cellar/go@1.13/1.13.9/libexec/src/encoding/asn1/marshal.go:483:103: t.Field(i + startingField).Tag.Get undefined (type string has no field or method Get)<br />
…<br />
Oh, God, what’s all this?</p><br />
<br />
<p>Ok, the thing with TinyGo is that there are many stdlib packages that are not yet supported, so if you must use them then you can’t use TinyGo, unfortunately.</p><br />
<br />
<p>https://tinygo.org/lang-support/stdlib/</p><br />
<br />
<p>Some key unsupported packages: encoding/json &amp; net/http (I assume encoding/asn1 is a dependency of net/http).</p><br />
<br />
<p>I was using both. Since I don’t need them for the JS part, the solution is to use a TinyGo-specific build constraint instead of // +build !js:</p><br />
<br />
<p>// +build !tinygo<br />
And vice-versa for main_js.go.</p><br />
<br />
<p>TinyGo, Round 3!<br />
$ tinygo build -o poc/main.wasm -target wasm .</p><br />
<h1 id="githubcommarianogappacheesse-1">github.com/marianogappa/cheesse</h1><br />
<p>main_js.go:102:7: j.IsUndefined undefined (type js.Value has no field or method IsUndefined)<br />
main_js.go:102:26: j.IsNull undefined (type js.Value has no field or method IsNull)<br />
main_js.go:95:7: j.IsUndefined undefined (type js.Value has no field or method IsUndefined)<br />
…<br />
Unsupported js/syscall methods?</p><br />
<br />
<p>Nah, this one is not on TinyGo. We’ve downgraded Go to 1.13.9, so those methods don’t exist anymore.</p><br />
<br />
<p>Replace all:</p><br />
<br />
<p>j.IsUndefined()<br />
With:</p><br />
<br />
<p>j == js.Undefined()<br />
TinyGo, Round 4!<br />
$ tinygo build -o poc/main.wasm -target wasm .</p><br />
<h1 id="githubcommarianogappacheesseapi">github.com/marianogappa/cheesse/api</h1><br />
<p>/usr/local/Cellar/tinygo/0.12.0/src/sync/pool.go:14:14 unsupported instruction during init evaluation:<br />
  %23 = inttoptr i32 %22 to %runtime._interface (i8<em>, i8</em>)*, !dbg !1864<br />
Huh?</p><br />
<br />
<p>Ok, that’s confusing, but it’s something to do with an instruction that runs during an init() that indirectly ends up in sync/pool, that must be unsupported or something.</p><br />
<br />
<p>I don’t use init(), and neither should you. But if you have a var in the global scope (i.e. a global variable) that calls something, then the Go compiler will put that in an init().</p><br />
<br />
<p>You shouldn’t have globals either, but we make some exceptions, and in my case it was like a million error literals like this one:</p><br />
<br />
<p>var errBlackCastle = fmt.Errorf(“impossible for black to castle since king has moved”)<br />
It turns out fmt.Errorf ends up calling sync/pool. A brilliant workaround for this one is to replace fmt.Errorf with errors.New. This only works if you have nothing to interpolate, but since it’s a global, you probably don’t.</p><br />
<br />
<p>If you have other globals that call things, keep the var, but initialise the value in your main().</p><br />
<br />
<p>TinyGo: Round 5!<br />
$ tinygo build -o poc/main.wasm -target wasm .<br />
inlinable function call in a function with debug info must have a !dbg location<br />
  call void @runtime.nilPanic(i8* undef, i8* null)<br />
inlinable function call in a function with debug info must have a !dbg location<br />
  %352 = call fastcc i1 @”github.com/marianogappa/cheesse/api.boolMatcher$1”(i32 %351, i8* %pack.int217, i8* %341, i8* undef)<br />
inlinable function call in a function with debug info must have a !dbg location<br />
  %353 = call fastcc i1 @”github.com/marianogappa/cheesse/api.intMatcher$1”(i32 %351, i8* %pack.int217, i8* %341, i8* undef)<br />
inlinable function call in a function with debug info must have a !dbg location<br />
  %354 = call fastcc i1 @”github.com/marianogappa/cheesse/api.pieceTypeMatcher$1”(i32 %351, i8* %pack.int217, i8* %341, i8* undef)<br />
error: optimizations caused a verification failure<br />
WAT. Ok, I don’t know. But if you get this, the workaround is to add the -no-debug flag to the compile line.</p><br />
<br />
<p>TinyGo, Round 6!<br />
$ tinygo build -o poc/main.wasm -no-debug -target wasm .<br />
$<br />
OMG, YES! 🎉🎉🎉 Did it work???</p><br />
<br />
<p>Nope. If you get an error in the Developer Console on your browser, perhaps this one:</p><br />
<br />
<p>TypeError: import object field ‘wasi_unstable’ is not an Object<br />
You need to take into account that every compiler you use, and every version of that compiler might have a different companion wasm_exec.js. For TinyGo, do this:</p><br />
<br />
<p>cp $(tinygo env TINYGOROOT)/targets/wasm_exec.js .<br />
TinyGo, Round 7!<br />
You might do absolutely everything right, get it compiled and then go to your browser’s Developer Console and see this:</p><br />
<br />
<p>panic: syscall/js: Value.Call: property _makeFuncWrapper is not a function, got undefined <a href="http://localhost:8000/wasm_exec.js">wasm_exec.js:201:19</a><br />
That one is this issue: https://github.com/tinygo-org/tinygo/issues/716</p><br />
<br />
<p>It might be solved by the time you read this, but the workaround at the time of this writing is to switch to the dev version of TinyGo, which is pretty bleeding edge but seems to work well.</p><br />
<br />
<p>Follow the Source Install instructions and change branch before installing.</p><br />
<br />
<p>Something like:</p><br />
<br />
<p>$ brew install llvm<br />
$ cd /tmp<br />
$ export GO111MODULE=on<br />
$ go get -d -u github.com/tinygo-org/tinygo<br />
$ cd $GOPATH/src/github.com/tinygo-org/tinygo<br />
$ git checkout dev<br />
$ go install<br />
TinyGo, Round 8!<br />
$ tinygo build -o poc/main.wasm -no-debug -target wasm .<br />
$<br />
Before testing on the browser, remember that you’ve changed the version of TinyGo, so you must copy wasm_exec.js again, only this time the file is in a different place because you’ve built from source:</p><br />
<br />
<p>cp $GOPATH/src/github.com/tinygo-org/tinygo/targets/wasm_exec.js .<br />
Did it work???</p><br />
<br />
<p>Working Proof of Concept</p><br />
<br />
<p>OMG, YES! 🎉🎉🎉</p><br />
<br />
<p>One last check<br />
$ ll -h main.wasm<br />
-rwxr-xr-x  1 marianol  staff   392K 29 Mar 00:21 main.wasm<br />
392 KB! That’s an amazing improvement from 7.6MB! 🎉🎉🎉</p><br />
<br />
<p>Conclusion<br />
Writing Go code for the browser is a reality today. But it’s no picnic. Ideally, we’d write whatever we want, run the Go compiler and get a 1kb npm package or something, right? Well, we’ll get there. Still a better love story than writing JavaScript, aye.</p><br />
<br />
<p>auto-play proof of concept</p><br />
<br />
<p>cheesse open source project</p><br />
<br />
<p>Acknowledgements<br />
I didn’t come up with most of the solutions to the issues outlined in this blogpost. This was only possible thanks to the kind and patient help I received from TinyGo’s author Ayke van Laethem and contributors Jaden Weiss and Johan Brandhorst for hours on end at the #tinygo channel on GopherSlack. Also, thanks to Paul Jolly for pointing me in the right direction while getting started with WebAssembly.</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>