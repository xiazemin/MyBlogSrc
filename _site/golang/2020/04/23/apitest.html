<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">apitest</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-04-23T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Apr 23, 2020</time></p>
					</div>
					 <p>One advantage of the Go language is its standard library, which contains many useful features to develop modern applications, such as HTTP server and client, JSON parser, and tests. It is exactly this last point that I will talk about in this post.</p><br />
<br />
<p>With the standard library it is possible to write tests for your API, as in the following example.<br />
https://dev.to/codenation/testing-apis-in-golang-using-apitest-1860<br />
<!-- more --><br />
API code<br />
In our main.go file, we will create a simple API:<br />
package main</p><br />
<br />
<p>import (<br />
   “encoding/json”<br />
   “log”<br />
   “net/http”<br />
   “os”<br />
   “strconv”<br />
   “time”</p><br />
<br />
<p>“github.com/codegangsta/negroni”<br />
   “github.com/gorilla/context”<br />
   “github.com/gorilla/mux”<br />
)</p><br />
<br />
<p>//Bookmark data<br />
type Bookmark struct {<br />
   ID   int    <code class="language-plaintext highlighter-rouge">json:"id"</code><br />
   Link string <code class="language-plaintext highlighter-rouge">json:"link"</code><br />
}</p><br />
<br />
<p>func main() {<br />
   //router<br />
   r := mux.NewRouter()<br />
   //midllewares<br />
   n := negroni.New(<br />
      negroni.NewLogger(),<br />
   )<br />
   //routes<br />
   r.Handle(“/v1/bookmark”, n.With(<br />
      negroni.Wrap(bookmarkIndex()),<br />
   )).Methods(“GET”, “OPTIONS”).Name(“bookmarkIndex”)<br />
   r.Handle(“/v1/bookmark/{id}”, n.With(<br />
      negroni.Wrap(bookmarkFind()),<br />
   )).Methods(“GET”, “OPTIONS”).Name(“bookmarkFind”)<br />
   http.Handle(“/”, r)<br />
   //server<br />
   logger := log.New(os.Stderr, “logger: “, log.Lshortfile)<br />
   srv := &amp;http.Server{<br />
      ReadTimeout:  5 * time.Second,<br />
      WriteTimeout: 10 * time.Second,<br />
      Addr:         “:8080”,<br />
      Handler:      context.ClearHandler(http.DefaultServeMux),<br />
      ErrorLog:     logger,<br />
   }<br />
   //start server<br />
   err := srv.ListenAndServe()<br />
   if err != nil {<br />
      log.Fatal(err.Error())<br />
   }<br />
}</p><br />
<br />
<p>func bookmarkIndex() http.Handler {<br />
   return http.HandlerFunc(func(w http.ResponseWriter, r <em>http.Request) {<br />
      data := []</em>Bookmark{<br />
         {<br />
            ID:   1,<br />
            Link: “http://google.com”,<br />
         },<br />
         {<br />
            ID:   2,<br />
            Link: “https://apitest.dev”,<br />
         },<br />
      }<br />
      w.Header().Set(“Content-Type”, “application/json”)<br />
      if err := json.NewEncoder(w).Encode(data); err != nil {<br />
         w.WriteHeader(http.StatusInternalServerError)<br />
         w.Write([]byte(“Error reading bookmarks”))<br />
      }<br />
   })<br />
}</p><br />
<br />
<p>func bookmarkFind() http.Handler {<br />
   return http.HandlerFunc(func(w http.ResponseWriter, r <em>http.Request) {<br />
      vars := mux.Vars(r)<br />
      id, err := strconv.Atoi(vars[“id”])<br />
      if err != nil {<br />
         w.WriteHeader(http.StatusInternalServerError)<br />
         w.Write([]byte(“Error reading parameters”))<br />
         return<br />
      }<br />
      data := []</em>Bookmark{<br />
         {<br />
            ID:   2,<br />
            Link: “https://apitest.dev”,<br />
         },<br />
      }<br />
      if id != data[0].ID {<br />
         w.WriteHeader(http.StatusNotFound)<br />
         w.Write([]byte(“Not found”))<br />
         return<br />
      }<br />
      w.Header().Set(“Content-Type”, “application/json”)<br />
      if err := json.NewEncoder(w).Encode(data[0]); err != nil {<br />
         w.WriteHeader(http.StatusInternalServerError)<br />
         w.Write([]byte(“Error reading bookmark”))<br />
      }<br />
   })<br />
}<br />
Compiling<br />
First, we need to start our project as a module, and install the external dependencies, such as negroni and gorilla. For this we execute the command:<br />
go mod init github.com/eminetto/post-apitest<br />
go: creating new go.mod: module github.com/eminetto/post-apitest<br />
Now, running the build command the compilation process will install the dependencies:<br />
go build<br />
go: finding module for package github.com/gorilla/context<br />
go: finding module for package github.com/gorilla/mux<br />
go: finding module for package github.com/codegangsta/negroni<br />
go: found github.com/codegangsta/negroni in github.com/codegangsta/negroni v1.0.0<br />
go: found github.com/gorilla/context in github.com/gorilla/context v1.1.1<br />
go: found github.com/gorilla/mux in github.com/gorilla/mux v1.7.4<br />
Testing with the standard library<br />
We will now create the tests for this API. Our main_test.go file looks like this:<br />
package main</p><br />
<br />
<p>import (<br />
   “net/http”<br />
   “net/http/httptest”<br />
   “testing”</p><br />
<br />
<p>“github.com/gorilla/mux”<br />
)</p><br />
<br />
<p>func Test_bookmarkIndex(t *testing.T) {<br />
   r := mux.NewRouter()<br />
   r.Handle(“/v1/bookmark”, bookmarkIndex())<br />
   ts := httptest.NewServer(r)<br />
   defer ts.Close()<br />
   res, err := http.Get(ts.URL + “/v1/bookmark”)<br />
   if err != nil {<br />
      t.Errorf(“Expected nil, received %s”, err.Error())<br />
   }<br />
   if res.StatusCode != http.StatusOK {<br />
      t.Errorf(“Expected %d, received %d”, http.StatusOK, res.StatusCode)<br />
   }<br />
}</p><br />
<br />
<p>func Test_bookmarkFind(t *testing.T) {<br />
   r := mux.NewRouter()<br />
   r.Handle(“/v1/bookmark/{id}”, bookmarkFind())<br />
   ts := httptest.NewServer(r)<br />
   defer ts.Close()<br />
   t.Run(“not found”, func(t *testing.T) {<br />
      res, err := http.Get(ts.URL + “/v1/bookmark/1”)<br />
      if err != nil {<br />
         t.Errorf(“Expected nil, received %s”, err.Error())<br />
      }<br />
      if res.StatusCode != http.StatusNotFound {<br />
         t.Errorf(“Expected %d, received %d”, http.StatusNotFound, res.StatusCode)<br />
      }<br />
   })<br />
   t.Run(“found”, func(t *testing.T) {<br />
      res, err := http.Get(ts.URL + “/v1/bookmark/2”)<br />
      if err != nil {<br />
         t.Errorf(“Expected nil, received %s”, err.Error())<br />
      }<br />
      if res.StatusCode != http.StatusOK {<br />
         t.Errorf(“Expected %d, received %d”, http.StatusOK, res.StatusCode)<br />
      }<br />
   })<br />
}<br />
Running the tests, we see that everything is passing successfully:<br />
go test -v<br />
=== RUN   Test_bookmarkIndex<br />
— PASS: Test_bookmarkIndex (0.00s)<br />
=== RUN   Test_bookmarkFind<br />
=== RUN   Test_bookmarkFind/not_found<br />
=== RUN   Test_bookmarkFind/found<br />
— PASS: Test_bookmarkFind (0.00s)<br />
    — PASS: Test_bookmarkFind/not_found (0.00s)<br />
    — PASS: Test_bookmarkFind/found (0.00s)<br />
PASS<br />
ok      github.com/eminetto/post-apitest    0.371s<br />
That way, we can test our API using only the standard library. But the tests code aren’t so readable, especially when we are testing a large API, with several endpoints.</p><br />
<br />
<p>Using apitest<br />
To improve our test code, we can use some third-party libraries, such as apitest, which simplifies the process.</p><br />
<br />
<p>Let’s start by installing the new packages. At the terminal, we execute:<br />
go get github.com/steinfletcher/apitest<br />
go: github.com/steinfletcher/apitest upgrade =&gt; v1.4.5<br />
and<br />
go get github.com/steinfletcher/apitest-jsonpath<br />
go: github.com/steinfletcher/apitest-jsonpath upgrade =&gt; v1.5.0<br />
Now let’s alter the main_test.go file:<br />
package main</p><br />
<br />
<p>import (<br />
   “net/http”<br />
   “net/http/httptest”<br />
   “testing”</p><br />
<br />
<p>“github.com/gorilla/mux”<br />
   “github.com/steinfletcher/apitest”<br />
   jsonpath “github.com/steinfletcher/apitest-jsonpath”<br />
)</p><br />
<br />
<p>func Test_bookmarkIndex(t *testing.T) {<br />
   r := mux.NewRouter()<br />
   r.Handle(“/v1/bookmark”, bookmarkIndex())<br />
   ts := httptest.NewServer(r)<br />
   defer ts.Close()<br />
   apitest.New().<br />
      Handler(r).<br />
      Get(“/v1/bookmark”).<br />
      Expect(t).<br />
      Status(http.StatusOK).<br />
      End()<br />
}</p><br />
<br />
<p>func Test_bookmarkFind(t *testing.T) {<br />
   r := mux.NewRouter()<br />
   r.Handle(“/v1/bookmark/{id}”, bookmarkFind())<br />
   ts := httptest.NewServer(r)<br />
   defer ts.Close()<br />
   t.Run(“not found”, func(t *testing.T) {<br />
      apitest.New().<br />
         Handler(r).<br />
         Get(“/v1/bookmark/1”).<br />
         Expect(t).<br />
         Status(http.StatusNotFound).<br />
         End()<br />
   })<br />
   t.Run(“found”, func(t *testing.T) {<br />
      apitest.New().<br />
         Handler(r).<br />
         Get(“/v1/bookmark/2”).<br />
         Expect(t).<br />
         Assert(jsonpath.Equal(<code class="language-plaintext highlighter-rouge">$.link</code>, “https://apitest.dev”)).<br />
         Status(http.StatusOK).<br />
         End()<br />
   })<br />
}<br />
The tests became much more readable, and we gained the functionality to test the resulting JSON. A note: it is also possible to test the resulting JSON using only the standard library, but we need to add a few more lines in the test.</p><br />
<br />
<p>In the documentation you can see how powerful the library is, allowing advanced settings for headers, cookies, debug and mocks. It is worth taking the time to study the options and see the examples provided.</p><br />
<br />
<p>Reports<br />
An interesting feature that I would like to show in this post is reports generation. We need to make a slight change in the code, adding the line Report(apitest.SequenceDiagram()) in the tests, as in the example:<br />
apitest.New().<br />
   Report(apitest.SequenceDiagram()).<br />
   Handler(r).<br />
   Get(“/v1/bookmark”).<br />
   Expect(t).<br />
   Status(http.StatusOK).<br />
   End()<br />
And when we run the tests again, we have the following result:<br />
go test -v<br />
=== RUN   Test_bookmarkIndex<br />
Created sequence diagram (3157381659_2166136261.html): /Users/eminetto/Projects/post-apitest/.sequence/3157381659_2166136261.html<br />
— PASS: Test_bookmarkIndex (0.00s)<br />
=== RUN   Test_bookmarkFind<br />
=== RUN   Test_bookmarkFind/not_found<br />
Created sequence diagram (1543772695_2166136261.html): /Users/eminetto/Projects/post-apitest/.sequence/1543772695_2166136261.html<br />
=== RUN   Test_bookmarkFind/found<br />
Created sequence diagram (1560550314_2166136261.html): /Users/eminetto/Projects/post-apitest/.sequence/1560550314_2166136261.html<br />
— PASS: Test_bookmarkFind (0.00s)<br />
    — PASS: Test_bookmarkFind/not_found (0.00s)<br />
    — PASS: Test_bookmarkFind/found (0.00s)<br />
PASS<br />
ok      github.com/eminetto/post-apitest    0.296s<br />
These are the generated reports:</p><br />
<br />
<p>apitest1</p><br />
<br />
<p>apitest2</p><br />
<br />
<p>Is it worth using?<br />
This is a question that has no single answer. Using only the standard library, the project gains speed in the execution of tests, besides not depending on third-party libraries, which can be a problem in some teams.</p><br />
<br />
<p>With a library like apitest you gain in productivity and ease of maintenance, but you lose in speed of execution. A note on speed: I ran just a few simple tests and benchmarks, so I can’t say for sure how big is the difference compared to the standard library, but an overhead is visible.</p><br />
<br />
<p>Each team can make its benchmarks and make that decision, but most of the time I believe that the team’s productivity will gain several points in this choice.</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>