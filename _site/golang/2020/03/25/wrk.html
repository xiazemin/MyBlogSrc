<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">wrk</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-03-25T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Mar 25, 2020</time></p>
					</div>
					 <p>brew install wrk<br />
git clone https://github.com/wg/wrk<br />
make<br />
make WITH_LUAJIT=/usr WITH_OPENSSL=/usr<br />
<!-- more --><br />
Usage: wrk <options> <url>                            <br />
  Options:                                            <br />
    -c, --connections <N>  Connections to keep open   <br />
    -d, --duration    <T>  Duration of test           <br />
    -t, --threads     <N>  Number of threads to use</N></T></N></url></options></p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-s, --script      &lt;S&gt;  Load Lua script file       <br />
-H, --header      &lt;H&gt;  Add header to request      <br />
    --latency          Print latency statistics   <br />
    --timeout     &lt;T&gt;  Socket/request timeout     <br />
-v, --version          Print version details      <br />
</code></pre></div></div><br />
<br />
<p>Numeric arguments may include a SI unit (1k, 1M, 1G)<br />
  Time arguments may include a time unit (2s, 2m, 2h)<br />
简单翻成中文：</p><br />
<br />
<p>使用方法: wrk <选项> <被测HTTP服务的URL>                            <br />
  Options:                                            <br />
    -c, --connections <N>  跟服务器建立并保持的TCP连接数量  <br />
    -d, --duration    <T>  压测时间           <br />
    -t, --threads     <N>  使用多少个线程进行压测</N></T></N></被测HTTP服务的URL></选项></p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-s, --script      &lt;S&gt;  指定Lua脚本路径       <br />
-H, --header      &lt;H&gt;  为每一个HTTP请求添加HTTP头      <br />
    --latency          在压测结束后，打印延迟统计信息   <br />
    --timeout     &lt;T&gt;  超时时间     <br />
-v, --version          打印正在使用的wrk的详细版本信息<br />
</code></pre></div></div><br />
<br />
<N>代表数字参数，支持国际单位 (1k, 1M, 1G)<br />
  <T>代表时间参数，支持时间单位 (2s, 2m, 2h)<br />
看下版本<br />
<br />
wrk -v<br />
<br />
输出：<br />
wrk 4.0.2 [epoll] Copyright (C) 2012 Will Glozer<br />
<br />
<br />
做一次简单压测，分析下结果<br />
<br />
wrk -t8 -c200 -d30s --latency  "http://www.bing.com"<br />
<br />
输出：<br />
Running 30s test @ http://www.bing.com<br />
  8 threads and 200 connections<br />
  Thread Stats   Avg      Stdev     Max   +/- Stdev<br />
    Latency    46.67ms  215.38ms   1.67s    95.59%<br />
    Req/Sec     7.91k     1.15k   10.26k    70.77%<br />
  Latency Distribution<br />
     50%    2.93ms<br />
     75%    3.78ms<br />
     90%    4.73ms<br />
     99%    1.35s <br />
  1790465 requests in 30.01s, 684.08MB read<br />
Requests/sec:  59658.29<br />
Transfer/sec:     22.79MB<br />
<br />
<br />
https://segmentfault.com/a/1190000014591330<br />
https://github.com/wg/wrk<br />
<br />
使用交互式命令<br />
查看堆栈调用信息<br />
go tool pprof http://localhost:6060/debug/pprof/heap<br />
查看 30 秒内的 CPU 信息<br />
go tool pprof http://localhost:6060/debug/pprof/profile?seconds=30<br />
查看 goroutine 阻塞<br />
go tool pprof http://localhost:6060/debug/pprof/block<br />
收集 5 秒内的执行路径<br />
go tool pprof http://localhost:6060/debug/pprof/trace?seconds=5<br />
争用互斥持有者的堆栈跟踪<br />
go tool pprof http://localhost:6060/debug/pprof/mutex<br />
UI web 界面<br />
相比较于交互式命令行，这个UI分析工具就比较强大了，包括各种流程图式的分析，还有火焰图。但是会麻烦一点，首先我们得导出文件，下面例子是查看堆栈调用信息，其他相关信息需要调相关接口。<br />
<br />
curl -sK -v http://localhost:6060/debug/pprof/heap &gt; heap.out<br />
然后用 go tool 工具 使用该导出文件起一个服务，会自动跳到 UI 界面。这个需要服务器安装 graphviz<br />
<br />
go tool pprof -http=:8080 heap.out<br />
<br />
<br />
Top：类似于 linux top 那种形式。从高到底排序<br />
Graph：默认弹出来的就是该模式，也就是上一个图的那种带有调用关系的图。<br />
Flame Graph：pprof 火焰图。<br />
Peek：类似于 Top 也是从高到底的排序。<br />
Source：和交互命令式的那种一样，带有源码标注。<br />
Disassemble：显示所有的总量。<br />
<br />
UI SAMPLE 为 VIEW 提供 4 种查询模式。<br />
<br />
alloc_objects：已分配的对象总量（不管是否已释放）<br />
alloc_space：已分配的内存总量（不管是否已释放）<br />
inuse_objects： 已分配但尚未释放的对象数量<br />
inuse_sapce：已分配但尚未释放的内存数量<br />
<br />
<br />
1. 编写lua脚本，填写post的数据， 如  post.lua<br />
<br />
wrk.method = "POST"<br />
<br />
wrk.body  = '{"userId": "10001","coinType": "GT","type": "2","amount": "5.1"}'<br />
<br />
wrk.headers["Content-Type"] = "application/json"<br />
<br />
function request()<br />
<br />
  return wrk.format('POST', nil, nil, body)<br />
<br />
end<br />
<br />
2. 执行wrk，开始压力测试:<br />
<br />
wrk -t 16 -c 100 -d 30s --latency --timeout 5s -s post.lua http://localhost:8021/m/zh/order/new <br />
<br />
<br />
setup<br />
<br />
线程出事后支持会调用一次。<br />
<br />
init<br />
<br />
每次请求发送之前被调用。可以接受 wrk 命令行的额外参数。<br />
<br />
delay<br />
<br />
这个函数返回一个数值，在这次请求执行完以后延迟多长时间执行下一个请求，可以对应 thinking time 的场景。<br />
<br />
request<br />
<br />
通过这个函数可以每次请求之前修改本次请求体和Header，我们可以在这里写一些要压力测试的逻辑。<br />
<br />
response<br />
<br />
每次请求返回以后被调用，可以根据响应内容做特殊处理，比如遇到特殊响应停止执行测试，或输出到控制台等等。<br />
<br />
<br />
<br />
每个阶段做的是事如下：<br />
<br />
 setup : 线程出事后会调用一次，每个线程只调用一次<br />
 init  : 每次请求发送之前被调用，可以接受wrk命令行的额外参数<br />
 delay : 这个函数返回一个数值，在这次请求执行完成后延迟多长时间可以进行下一个请求，对应thinking time场景<br />
 request : 通过这个函数可以每次请求之前修改本次请求体和Header， 这里是我们最常使用的地方，可以在这里写一些要压测的逻辑<br />
 response: 每次请求返回后可以针对响应内容做特殊处理，例如遇到特殊情况停止测试或输出到控制台上<br />
 done:    可以用于自定义结果报表，整个过程中只执行一次<br />
2、wrk的全局属性<br />
<br />
wrk = {<br />
    scheme = "http",<br />
    host = "localhost",<br />
    port = nil,<br />
    method = "GET",<br />
    path = "/",<br />
    headers = {},<br />
    body = nil,<br />
    thread = <userdata>,<br />
}<br />
这些全局变量可以直接拿到lua脚本中使用 是一个table类型的wrk，为全局变量，修改这个table会影响所有的请求。<br />
<br />
3、wrk的全局方法<br />
<br />
-- 生成整个request的string<br />
function wrk.format(method, path, headers, body)<br />
<br />
-- 获取域名的IP 和 Port， 返回table, 例如`{127.0.0.1:8080}`<br />
function wrk.lookup(host, service)<br />
<br />
-- 判断addr是否能连接， 返回 true/false<br />
function wrk.connect(addr)<br />
<br />
<br />
<br />
1. 启动阶段:<br />
function setup(thread)<br />
在脚本文件中实现 setup 方法，wrk 就会在测试线程已经初始化，但还没有启动的时候调用该方法。wrk会为每一个测试线程调用一次 setup 方法，并传入代表测试线程的对象thread 作为参数。setup 方法中可操作该thread 对象，获取信息、存储信息、甚至关闭该线程。<br />
<br />
thread.addr             -- get or set the thread's server address<br />
thread:get(name)        -- get the value of a global in the thread's env<br />
thread:set(name, value) -- set the value of a global in the thread's env<br />
thread:stop()           -- stop the thread<br />
运行阶段：<br />
function init(args)<br />
function delay()<br />
function request()<br />
function response(status, headers, body)<br />
init(args):<br />
由测试线程调用，只会在进入运行阶段时，调用一次。支持从启动 wrk 的命令中，获取命令行参数<br />
delay()：<br />
每次发送请求之前调用，可以在这里定制延迟时间，通过返回值（单位毫秒）如:return 1000，即延迟一秒<br />
request():<br />
每次发送请求之前调用，可以对每一次的请求做一些自定义的操作，但是不要在该方法中做耗时的操作<br />
response(status, headers, body):<br />
在每次收到一个响应时被调用，为提升性能，如果没有定义该方法，为了提升效率，那么wrk不会解析 headers 和 body<br />
<br />
结束阶段：<br />
function done(summary, latency, requests)<br />
done()<br />
该方法和setup方法一样，只会被调用一次，整个测试完后执行，在定的参数中获取压测结果，生成定制化的测试报告<br />
<br />
下面是官方对Lua API的说明<br />
<br />
<br />
The public Lua API consists of a global table and a number of global functions:<br />
  wrk = {<br />
    scheme  = "http",<br />
    host    = "localhost",<br />
    port    = nil,<br />
    method  = "GET",<br />
    path    = "/",<br />
    headers = {},<br />
    body    = nil,<br />
    thread  = <userdata>,<br />
  }<br />
<br />
  function wrk.format(method, path, headers, body)<br />
<br />
    wrk.format returns a HTTP request string containing the passed parameters<br />
    merged with values from the wrk table.<br />
<br />
  function wrk.lookup(host, service)<br />
<br />
    wrk.lookup returns a table containing all known addresses for the host<br />
    and service pair. This corresponds to the POSIX getaddrinfo() function.<br />
<br />
  function wrk.connect(addr)<br />
<br />
    wrk.connect returns true if the address can be connected to, otherwise<br />
    it returns false. The address must be one returned from wrk.lookup().<br />
<br />
  The following globals are optional, and if defined must be functions:<br />
<br />
    global setup    -- called during thread setup<br />
    global init     -- called when the thread is starting<br />
    global delay    -- called to get the request delay<br />
    global request  -- called to generate the HTTP request<br />
    global response -- called with HTTP response data<br />
    global done     -- called with results of run<br />
<br />
Setup<br />
<br />
  function setup(thread)<br />
<br />
  The setup phase begins after the target IP address has been resolved and all<br />
  threads have been initialized but not yet started.<br />
<br />
  setup() is called once for each thread and receives a userdata object<br />
  representing the thread.<br />
<br />
    thread.addr             - get or set the thread's server address<br />
    thread:get(name)        - get the value of a global in the thread's env<br />
    thread:set(name, value) - set the value of a global in the thread's env<br />
    thread:stop()           - stop the thread<br />
<br />
  Only boolean, nil, number, and string values or tables of the same may be<br />
  transfered via get()/set() and thread:stop() can only be called while the<br />
  thread is running.<br />
<br />
Running<br />
<br />
  function init(args)<br />
  function delay()<br />
  function request()<br />
  function response(status, headers, body)<br />
<br />
  The running phase begins with a single call to init(), followed by<br />
  a call to request() and response() for each request cycle.<br />
<br />
  The init() function receives any extra command line arguments for the<br />
  script which must be separated from wrk arguments with "--".<br />
<br />
  delay() returns the number of milliseconds to delay sending the next<br />
  request.<br />
<br />
  request() returns a string containing the HTTP request. Building a new<br />
  request each time is expensive, when testing a high performance server<br />
  one solution is to pre-generate all requests in init() and do a quick<br />
  lookup in request().<br />
<br />
  response() is called with the HTTP response status, headers, and body.<br />
  Parsing the headers and body is expensive, so if the response global is<br />
  nil after the call to init() wrk will ignore the headers and body.<br />
<br />
Done<br />
<br />
  function done(summary, latency, requests)<br />
<br />
  The done() function receives a table containing result data, and two<br />
  statistics objects representing the per-request latency and per-thread<br />
  request rate. Duration and latency are microsecond values and rate is<br />
  measured in requests per second.<br />
<br />
  latency.min              -- minimum value seen<br />
  latency.max              -- maximum value seen<br />
  latency.mean             -- average value seen<br />
  latency.stdev            -- standard deviation<br />
  latency:percentile(99.0) -- 99th percentile value<br />
  latency(i)               -- raw value and count<br />
<br />
  summary = {<br />
    duration = N,  -- run duration in microseconds<br />
    requests = N,  -- total completed requests<br />
    bytes    = N,  -- total bytes received<br />
    errors   = {<br />
      connect = N, -- total socket connection errors<br />
      read    = N, -- total socket read errors<br />
      write   = N, -- total socket write errors<br />
      status  = N, -- total HTTP status codes &gt; 399<br />
      timeout = N  -- total request timeouts<br />
    }<br />
  }<br />
</userdata></userdata></T></N><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>