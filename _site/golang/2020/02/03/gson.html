<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">golang map转json的顺序问题</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-02-03T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Feb 3, 2020</time></p>
					</div>
					 <p>我们都知道map是无序的，每次取出key/value的顺序都可能不一致，但map转json的顺序是不是也是无序的吗？尽管json中的参数顺序大部分情况下对使用没有影响，我们不妨看看源码中怎么处理的。</p><br />
<br />
<p>先说结论：</p><br />
<br />
<p>map转json是有序的，按照ASCII码升序排列key。<br />
<!-- more --><br />
溯源<br />
源码位于encoding/json/encode.go中</p><br />
<br />
<p>type mapEncoder struct {<br />
   elemEnc encoderFunc<br />
}</p><br />
<br />
<p>func (me mapEncoder) encode(e *encodeState, v reflect.Value, opts encOpts) {<br />
   if v.IsNil() {//为nil时，返回null<br />
      e.WriteString(“null”)<br />
      return<br />
   }<br />
   e.WriteByte(‘{‘)</p><br />
<br />
<p>// Extract and sort the keys.<br />
   keys := v.MapKeys()//获取map中的所有keys<br />
   sv := make([]reflectWithString, len(keys))<br />
   for i, v := range keys {<br />
      sv[i].v = v<br />
      if err := sv[i].resolve(); err != nil {//处理key，尤其是非string（int/uint）类型的key转string<br />
         e.error(&amp;MarshalerError{v.Type(), err})<br />
      }<br />
   }<br />
   //排序，升序，直接比较字符串<br />
   sort.Slice(sv, func(i, j int) bool { return sv[i].s &lt; sv[j].s })</p><br />
<br />
<p>for i, kv := range sv {<br />
      if i &gt; 0 {<br />
         e.WriteByte(‘,’)<br />
      }<br />
      e.string(kv.s, opts.escapeHTML)<br />
      e.WriteByte(‘:’)<br />
      me.elemEnc(e, v.MapIndex(kv.v), opts)<br />
   }<br />
   e.WriteByte(‘}’)<br />
}</p><br />
<br />
<p>func newMapEncoder(t reflect.Type) encoderFunc {<br />
   switch t.Key().Kind() {<br />
   case reflect.String,<br />
      reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64,<br />
      reflect.Uint, reflect.Uint8, reflect.Uint16, reflect.Uint32, reflect.Uint64, reflect.Uintptr:<br />
   default:<br />
      if !t.Key().Implements(textMarshalerType) {<br />
         return unsupportedTypeEncoder<br />
      }<br />
   }<br />
   me := mapEncoder{typeEncoder(t.Elem())}<br />
   return me.encode<br />
}</p><br />
<br />
<p>{<br />
    “foo”: “Hello, World!”,<br />
    “bar”: {<br />
        “b”: {<br />
            “go”: “1”<br />
        },<br />
        “a”: {<br />
            “go”: “2”<br />
        },<br />
        “c”: {<br />
            “go”: “3”<br />
        }<br />
    }<br />
}<br />
有如上一段 JSON，在程序中需要将其转为一个结构体以方便读取里边的数据，struct 的定义大概如下：</p><br />
<br />
<p>type Foobar struct {<br />
    Foo  string <code class="language-plaintext highlighter-rouge">json:"foo"</code><br />
    Bar map[string]struct {<br />
        Go string <code class="language-plaintext highlighter-rouge">json:"go"</code><br />
    } <code class="language-plaintext highlighter-rouge">json:"bar"</code><br />
}<br />
现在有这么两个需求：</p><br />
<br />
<p>按顺序输出 bar.a、bar.b、bar.c<br />
按顺序输出 bar.b、bar.a、bar.c<br />
如果是用 Java 的小伙伴，肯定已经想到 SortedMap（用的比较多是 TreeMap）和 LinkedHashMap 了，前者是可以按 key 进行排序的，后者则可以保持键值对的插入顺序，而这两者都是 JDK 自带的，任何一个 Javaer 应该都使用过。</p><br />
<br />
<p>但是在 Go 语言的 “简约设计” 面前，这些都是不存在的 ——Go 只提供了最基础的 hash map。</p><br />
<br />
<p>并且，在借助 range 关键字对 Go 的 map 进行遍历访问的时候，会对 map 的 key 的顺序做随机化处理，也就是说即使是同一个 map 在同一个程序里进行两次相同的遍历，前后两轮访问 key 的顺序也是随机化的。(可以在这里验证：https://play.golang.org/p/s3Mj4gNfi4g )</p><br />
<br />
<p>在 Go 的官方 blog 的文章 Go maps in action 也确定了该现象确实存在，并且是有意而为之，</p><br />
<br />
<p>When iterating over a map with a range loop, the iteration order is not specified and is not guaranteed to be the same from one iteration to the next. Since the release of Go 1.0, the runtime has randomized map iteration order.</p><br />
<br />
<p>那么在 Go 里边实现以上需求就得绕些路了。</p><br />
<br />
<p>实现类似 SortedMap 的遍历<br />
SortedMap 主要是对 key 排序，那么我们便可将 map 的 key 全部拿出来，放到一个数组中，然后对这个数组排序后对有序数组遍历，再间接取 map 里的值就行了。</p><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
    “fmt”<br />
    “sort”<br />
)</p><br />
<br />
<p>func main() {<br />
    m := make(map[string]string)<br />
    m[“b”] = “2”<br />
    m[“a”] = “1”<br />
    m[“c”] = “3”</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>keys := make([]string, 0, len(m))<br />
for k, _ := range m {<br />
    keys = append(keys, k)<br />
}<br />
<br />
sort.Strings(keys)<br />
<br />
for _, k := range keys {<br />
    fmt.Printf("Key:%+v, Value:%+v\n", k, m[k])<br />
} } https://play.golang.org/p/vzpwizlRYUO<br />
</code></pre></div></div><br />
<br />
<p>输出：</p><br />
<br />
<p>Key:a, Value:1<br />
Key:b, Value:2<br />
Key:c, Value:3<br />
不过每次都要这么写有些麻烦，我们可以将其封装成一个方法</p><br />
<br />
<p>func sortedMap(m map[string]interface{}, f func(k string, v interface{})) {<br />
    var keys []string<br />
    for k := range m {<br />
        keys = append(keys, k)<br />
    }<br />
    sort.Strings(keys)<br />
    for _, k := range keys {<br />
        f(k, m[k])<br />
    }<br />
}<br />
然后这样调用</p><br />
<br />
<p>func main() {<br />
    m := make(map[string]interface{})<br />
    m[“b”] = “2”<br />
    m[“a”] = “1”<br />
    m[“c”] = “3”</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sortedMap(m, func(k string, v interface{}) {<br />
    val := v.(string)<br />
    fmt.Printf("Key:%+v, Value:%+v\n", k, val)<br />
}) } 不过遗憾的是，因为 Go 不支持泛型，所以该方法并不是很通用（当 key 不为 string 的时候），但终究算是一个解决办法。<br />
</code></pre></div></div><br />
<br />
<p>实现类似 LinkedHashMap<br />
相比于上边按 key 排序来讲，在 Go 中实现 LinkedHashMap 要困难得多，要自己写一套数据结构。</p><br />
<br />
<p>之前有人试图给 Go 标准库提交过相关的代码，但是被拒绝了（(沮丧脸) 详情可见 7930: encoding/json: Optionally preserve the key order of JSON objects ），不过在 GitHub 上还是能找到相关的代码的：go-ordered-json，我们就可以用使用这个库来完成。</p><br />
<br />
<p>正如该项目的 ReadMe 中所说，你应该尽可能避免使用该库</p><br />
<br />
<p>If you can, you should avoid using this package.</p><br />
<br />
<p>但是对我来说，我没有更好的方案（第三方 API 返回的 JSON 中就是用 map 来保持顺序的），那么我也只好好好的 enjoy it 了。</p><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
    “fmt”<br />
    “github.com/virtuald/go-ordered-json”<br />
)</p><br />
<br />
<p>func main() {<br />
    jsonString := <code class="language-plaintext highlighter-rouge">{<br />
    "b": "2",<br />
    "a": "1",<br />
    "c": "3"<br />
}</code></p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oo := json.OrderedObject{}<br />
err := json.Unmarshal([]byte(jsonString), &amp;oo)<br />
if err != nil {<br />
    panic(err)<br />
}<br />
fmt.Printf("%+v", oo) } 输出结果：<br />
</code></pre></div></div><br />
<br />
<p>[{Key:b Value:2} {Key:a Value:1} {Key:c Value:3}]<br />
可以看出 json.OrderedObject 内部其实是把 map 处理成了 slice。</p><br />
<br />
<p>但是注意了：json.OrderedObject 只处理顶层的这个 map，如果嵌套有 map 的话，下层的 map 还是无序的。</p><br />
<br />
<p>（你可能会怀疑是不是因为用了 fmt.Printf 导致打印出来的顺序变了，你可以自己遍历试一下哦～）</p><br />
<br />
<p>现在来看看本文开头的那个 JSON 的例子</p><br />
<br />
<p>{<br />
    “foo”: “Hello, World!”,<br />
    “bar”: {<br />
        “b”: {<br />
            “go”: “1”<br />
        },<br />
        “a”: {<br />
            “go”: “2”<br />
        },<br />
        “c”: {<br />
            “go”: “3”<br />
        }<br />
    }<br />
}<br />
如果我把上边代码中的 jsonString 换成上边的这个 JSON，那么输出的就会是</p><br />
<br />
<p>[{Key:foo Value:Hello, World!} {Key:bar Value:map[a:map[go:2] b:map[go:1] c:map[go:3]]}]<br />
可以看出它只保证了最外层 foo 和 bar 的顺序， 而对于 bar 对应的这个 map，是按 a,b,c 的顺序来，并不是我们期望中的 b,a,c。</p><br />
<br />
<p>不过这个问题也是有解的，我们先创建一个 struct（和文章开头提到那个 struct 有点像），重点就是 Bar 的类型这里是 json.OrderedObject</p><br />
<br />
<p>type Foobar struct {<br />
    Foo string             <code class="language-plaintext highlighter-rouge">json:"foo"</code><br />
    Bar json.OrderedObject <code class="language-plaintext highlighter-rouge">json:"bar"</code><br />
}<br />
然后咱们来开始吧</p><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
    “fmt”<br />
    “github.com/virtuald/go-ordered-json”<br />
)</p><br />
<br />
<p>func main() {</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jsonString := `{<br />
"foo": "Hello, World!",<br />
"bar": {<br />
    "b": {<br />
        "go": "1"<br />
    },<br />
    "a": {<br />
        "go": "2"<br />
    },<br />
    "c": {<br />
        "go": "3"<br />
    }<br />
} }`<br />
<br />
foobar := Foobar{}<br />
err := json.Unmarshal([]byte(jsonString), &amp;foobar)<br />
if err != nil {<br />
    panic(err)<br />
}<br />
<br />
for _, value := range foobar.Bar {<br />
    m := value.Value.(map[string]interface{})<br />
    for k, v := range m {<br />
        fmt.Printf("%+v.%+v=%+v\n", value.Key, k, v)<br />
    }<br />
}<br />
</code></pre></div></div><br />
<br />
<p>}<br />
输出结果：</p><br />
<br />
<p>b.go=1<br />
a.go=2<br />
c.go=3<br />
成功了是不是？！此处应该有掌声～</p><br />
<br />
<p>当然，是献给 virtuald/go-ordered-json 的～</p><br />
<br />
<p>encoding/json<br />
有时间了可以研究一下 encoding/json 库，它的意义相对其他语言来说在 Go 中尤其重要 —— 它还扮演着 struct 转换器的角色。</p><br />
<br />
<p>另外在用它对 map 进行 encode 的时候（就是 json.Marshal 咯），还是挺有意思的，大家猜猜下边这段代码，range 和 json 部分分别是什么样的结果？多运行几次呢？</p><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
	“encoding/json”<br />
	“fmt”<br />
)</p><br />
<br />
<p>func main() {<br />
	jsonString := <code class="language-plaintext highlighter-rouge">{<br />
	"foo": {<br />
		"b": "1",<br />
		"a": "2",<br />
		"c": "3"<br />
	}<br />
}</code><br />
	o := make(map[string]map[string]string)<br />
	err := json.Unmarshal([]byte(jsonString), &amp;o)<br />
	if err != nil {<br />
		panic(err)<br />
	}</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fmt.Println("range:")<br />
for _, m := range o {<br />
	for k, v := range m {<br />
		fmt.Printf("%s, %s\n", k, v)<br />
	}<br />
}<br />
<br />
bytes, err := json.Marshal(o)<br />
if err != nil {<br />
	panic(err)<br />
}<br />
<br />
fmt.Println("")<br />
fmt.Println("json:")<br />
fmt.Printf("%s\n", bytes) } 有兴趣的朋友点击下边的 Go Playground 自己试试<br />
</code></pre></div></div><br />
<br />
<p>https://play.golang.org/p/JcTWRlYjQ5j</p><br />
<br />
<p>https://github.com/virtuald/go-ordered-json</p><br />
<br />
<p>https://github.com/google/gson<br />
LinkedHashMap本身是有序的，使用JDK自带的序列化代码或者fastJson代码序列化后，字符串并非按照插入顺序输出</p><br />
<br />
<p>Map&lt;String,String&gt; linkedMap=new LinkedHashMap&lt;String,String&gt;();<br />
linked2.put(“b”,”2”);<br />
linked2.put(“a”,”1”);<br />
linked2.put(“c”,”3”);<br />
String jsonStr=JSON.toJSONString(linkedMap);<br />
输出jsonStr为{“a”:”1”,”b”:”2”,”c”:”3”}<br />
解决办法：<br />
使用Gson(com.google.gson)序列化<br />
Map&lt;String,String&gt; linkedMap=new LinkedHashMap&lt;String,String&gt;();<br />
linked2.put(“b”,”2”);<br />
linked2.put(“a”,”1”);<br />
linked2.put(“c”,”3”);<br />
Gson gson = new GsonBuilder().enableComplexMapKeySerialization().create();<br />
String jsonStr=gson.toJson(linked2);<br />
System.out.println(jsonStr);<br />
输出jsonStr为{“b”:”2”,”a”:”1”,”c”:”3”}</p><br />
<br />
<p>fastjson（1.2.15）需要将前端多层嵌套json转换为map，由于map的无序性，想了很多办法，最终找到使用 Map m= JSONArray.parseObject(json, LinkedHashMap&lt;String,String&gt;.class); 来转换，问题来了，第一层顺序是对的，但是第二层排序居然出问题了，目前仅仅只是需要转换成String 他居然把String都给自动排序了，后来网上查了很多资料发现还可以采用一种方式：</p><br />
<br />
<p>Java代码</p><br />
<br />
<p>收藏代码</p><br />
<br />
<p>JSONObject jsonObj = new JSONObject(true);<br /><br />
Map m= jsonObj.parseObject(json, LinkedHashMap.class);<br /><br />
 但是输出问题还是存在第二层以后排序混乱，如下：</p><br />
<br />
<p>传入Json：<br />
{“t1”:””,”t3”:””,”t2”:{“a1”:””,”a3”:””,”a2”:””}}</p><br />
<br />
<p>输出：</p><br />
<br />
<p>{t1=, t3=, t2={“a1”:””,”a2”:””,”a3”:””}}</p><br />
<br />
<p>无奈，跟踪fastjson源码，花了2小时在com.alibaba.fastjson.parser.DefaultJSONParser 类中475行发现</p><br />
<br />
<p>Java代码</p><br />
<br />
<p>收藏代码</p><br />
<br />
<p>else if (ch == ‘{‘) { // 减少嵌套，兼容android<br /><br />
                   lexer.nextToken();</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>               final boolean parentIsArray = fieldName != null &amp;&amp; fieldName.getClass() == Integer.class;  <br />
  <br />
               &lt;span style="color: #ff0000;"&gt;&lt;strong&gt;JSONObject input = new JSONObject(lexer.isEnabled(Feature.OrderedField)&lt;/strong&gt;&lt;/span&gt;);  <br />
</code></pre></div></div><br />
<br />
<p>居然这里面判断了Feature.OrderedField</p><br />
<br />
<p>果断知道了解决办法：</p><br />
<br />
<p>HashMap m=  JSON.parseObject(json,LinkedHashMap.class,Feature.OrderedField);</p><br />
<br />
<p>搞定，输出结果：</p><br />
<br />
<p>{t1=, t3=, t2={“a1”:””,”a3”:””,”a2”:””}}</p><br />
<br />
<p>https://github.com/iancoleman/orderedmap</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>