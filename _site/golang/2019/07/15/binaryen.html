<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">binaryen</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2019-07-15T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Jul 15, 2019</time></p>
					</div>
					 <p>https://github.com/WebAssembly/binaryen<br />
WebAssembly 的生态大致分为两部分, 编译器等工具链, 和执行环境<br />
两者依据 spec 来完成对接, 并且实现解耦<br />
工具链部分重要的新项目是 Binaryen, 一个编译器<br />
https://github.com/WebAssembly/binaryen<br />
实现语言是 C++, 可以用于 parse 和 emit WebAssembly<br />
也可以基于 AST 规范进行转换<br />
基于几个部分的工具:</p><br />
<br />
<p>Binaryen shell 可以加载运行代码, 类似解释器<br />
使用的后缀 .wast, 这是 WebAssembly 的某个文本格式</p><br />
<br />
<p>asm2wasm ASM.js 编译到 WebAssembly</p><br />
<br />
<p>wasm2asm WebAssembly 编译到 ASM.js(还没完成)</p><br />
<br />
<p>s2wasm 汇编文件, 后缀 .s, 编译到 WebAssembly, 基于 LLVM<br />
http://llvm.org/devmtg/2015-10/slides/BastienGohman-WebAssembly-HereBeDragons.pdf</p><br />
<br />
<p>wasm.js Binaryen 的 JavaScript 实现, 以便在已有 JavaScript 环境执行</p><br />
<br />
<p>关于 Binaryen 的介绍, 有个幻灯片, 其中一页特别要看下<br />
https://kripken.github.io/talks/wasm.html#/9<br />
Binaryen 就是 Binary 和 Emscripten 的结尾连载一起写<br />
<!-- more --><br />
Emscripten 可以编译 C 或者 C++ 到 ASM.js<br />
而 Binaryen 可以把 ASM.js 编译到 WebAssembly, 整个就通了<br />
可以用 asm2wasm 命令, 也可以用 emcc 直接包含这一步:</p><br />
<br />
<p>emcc file.cpp -o file.js -s ‘BINARYEN=”path-to-binaryen”’<br />
https://github.com/kripken/emscripten/wiki/WebAssembly</p><br />
<br />
<p>目前还没有直接编译到浏览器环境运行的方案<br />
现在测目标是最快能实现和检验效果, 浏览器的事以后再说<br />
而为了测出的目的的话, 有个性能很低的 wasm.js 可以跑<br />
大概就是用来初始化运行环境, 然后解释执行 WebAssembly<br />
估计这个方案和 CoffeeScript 的解释执行会有相似之处<br />
提到一些可以参考的内容<br />
https://kripken.github.io/talks/wasm.html#/10<br />
https://github.com/WebAssembly/build-suite</p><br />
<br />
<p>目前的测试工具, 将来也能用来保证后续代码的可靠性<br />
当然以后运行性能必定是要非常高的<br />
https://github.com/WebAssembly/binaryen/blob/master/src/wasm2asm.h<br />
https://github.com/WebAssembly/polyfill-prototype-2<br />
https://github.com/WebAssembly/design/blob/master/FAQ.md#can-the-polyfill-really-be-efficient<br />
很多 C/C++ 项目将来可以被编译到 WebAssembly, 以后难度不会高</p><br />
<br />
<p>关于 LLVM 后端<br />
WebAssembly 也在开发一个 LLVM 后端, 现在还不成熟<br />
不过将来应该会非常重要的, Binaryen 也支持<br />
LLVM 通常会输出 .s 的汇编后缀文件, 这个也是类似的<br />
这个结果会有点像 C 生成的汇编, 而不是像 AST 的样子<br />
至少能从这个文件比较直接得转换到 WebAssembly<br />
其中会用到 s2wasm 来进行编译, 细节看原文<br />
这个项目有命令行, 也已经集成在 Emscripten 里边</p><br />
<br />
<p>emcc file.cpp -o file.js -s ‘BINARYEN=”path-to-binaryen”’ -s WASM_BACKEND=1<br />
https://github.com/kripken/emscripten/wiki/WebAssembly</p><br />
<br />
<p>现在大致有两条思路, 一条旧一条新, 新的还没成熟, 但将来会取代旧的</p><br />
<br />
<p>Emscripten + asm.js backend + asm2wasm</p><br />
<br />
<p>Emscripten + new WebAssembly backend + s2wasm</p><br />
<br />
<p>另外在 FAQ 里扒了一些感兴趣的内容<br />
https://github.com/WebAssembly/design/blob/master/FAQ.md</p><br />
<br />
<p>使用场景用哪些?<br />
页面上拉了很长的列表, 感觉常用的桌面软件都列上去了<br />
https://github.com/WebAssembly/design/blob/master/UseCases.md</p><br />
<br />
<p>只是针对 C/C++ 程序员设计的吗?<br />
最初可能是为了 C/C++, 后面会跟 ES6 模块接口整合<br />
那么就是很容易复用 C++ 写的类库, 而不用写 C++ 了<br />
构建 LLVM 后端, 支持 LLVM 的 Clang, GCC 等, 因为熟悉所以先对付 LLVM</p><br />
<br />
<p>从长远的目标, WebAssembly 算是提供二进制格式, 实现 Web 平台功能<br />
https://github.com/WebAssembly/design/blob/master/HighLevelGoals.md<br />
比如对 Web 向后兼容, 继承 JavaScript 的同源策略, 异步调用和被调用 JavaScript<br />
访问已有的 API, 提供人类能阅读的文本格式, 对应 View Source 效果<br />
还有 Source Maps, 协程, 多进程, 大于 4GB 内存, 尾递归, 具体看文档<br />
https://github.com/WebAssembly/design/blob/master/FutureFeatures.md#gcdom-integration<br />
对于 Node 环境也支持, 还有移动平台, 网联网设备等等<br />
https://github.com/WebAssembly/design/blob/master/NonWeb.md</p><br />
<br />
<p>关于 Web API 有单独的文档, 在 MVP 这个初步的阶段之后会开始做<br />
https://github.com/WebAssembly/design/blob/master/GC.md</p><br />
<br />
<p>在 WebAssembly 当中直接引用 DOM 和各种对象</p><br />
<br />
<p>直接访问 Web API, 而不是通过 JavaScript 去调用</p><br />
<br />
<p>在 WebAssembly 代码中直接操作 GC 对象</p><br />
<br />
<p>想要替代 JavaScript 吗?<br />
不是的. WebAssembly 只是允许了更多的语言能编译运行<br />
而 JavaScript 作为快速发展的语言, 是享有特权, 一直支持下去的<br />
两种语言很可能会长期共用下去, 比如性能要求高的部分用 WebAssembly</p><br />
<br />
<p>Binaryen 工具链<br />
       Binaryen提供了一系列工具，用来形成他们独有的工作流。</p><br />
<br />
<p>binaryen-shell: A shell that can load and interpret WebAssembly code in S-Expression format, as well as run transformation passes on it. It can also run the spec test suite.<br />
wasm-as: Assembles WebAssembly in text format (currently S-Expression format) into binary format (currently v8 format).<br />
wasm-dis: Un-assembles WebAssembly in binary format (currently v8 format) into text format (currently S-Expression format).<br />
asm2wasm: An asm.js-to-WebAssembly compiler, built on Emscripten’s asm optimizer infrastructure. This is used by Emscripten in Binaryen mode when it uses Emscripten’s fastcomp asm.js backend.<br />
wasm2asm: A WebAssembly-to-asm.js compiler, the reverse of asm2wasm. This is a work in progress.<br />
s2wasm: A compiler from the .s format emitted by the new WebAssembly backend being developed in LLVM. This is used by Emscripten in Binaryen mode when it integrates with the new LLVM backend.<br />
wasm.js: wasm.js contains Binaryen components compiled to JavaScript, including the interpreter, asm2wasm, the S-Expression parser, etc., which allow you to use Binaryen with Emscripten and execute code compiled to WASM even if the browser doesn’t have native support yet. This can be useful as a (slow) polyfill.<br />
binaryen.js: A stand alone library that exposes Binaryen methods for parsing s-expressions and instantiating WASM modules in JavaScript.<br />
现阶段比较有用的命令<br />
binaryen-shell<br />
bin/binaryen-shell [.wast file] [options] [passes, see –help] [–help]<br />
       可以高亮显示wast文件</p><br />
<br />
<p>asm2wasm<br />
bin/asm2wasm [input.asm.js file]<br />
       可以转换asm.js文件到wasm格式，并高亮显示</p><br />
<br />
<p>WebAssembly生成工作流<br />
       binaryen提供了两个流程</p><br />
<br />
<p>C/C++ Source ⇒ asm2wasm ⇒ WebAssembly</p><br />
<br />
<p>C/C++ Source ⇒ WebAssembly LLVM backend ⇒ s2wasm ⇒ WebAssembly</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   还有一个方法，就是使用ilwasm把.NET CIL变成WebAssembly S-expressions，不过这个项目已经很久没动过了。<br />
</code></pre></div></div><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>