<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">gomatrix</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2019-10-12T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Oct 12, 2019</time></p>
					</div>
					 <p>Metrics本来是一个Java库, 捕获JVM和应用程序级指标。也就是说可以获得代码级别的数据指标，比如方法调用了多少次之类。</p><br />
<br />
<p>goalng 在github上使用的包是 https://github.com/rcrowley/go-metrics.git</p><br />
<br />
<p>这个库官方采纳的influxdb 方案只提供了TCP连接功能，然而我想要用的是使用UDP进行数据传输，这样对性能损耗较小。</p><br />
<br />
<p>这主要是由于influxdb是使用http作为API接口，采纳的这个包自己实现了一套定时发送http请求的方式去存储数据。<br />
<!-- more --><br />
MetricRegistry<br />
Metrics中MetricRegistry是中心容器，它是程序中所有度量的容器，所有新的度量工具都要注册到一个MetricRegistry实例中才可以使用，尽量在一个应用中保持让这个MetricRegistry实例保持单例。</p><br />
<br />
<p>示例：</p><br />
<br />
<p>r := metrics.NewRegistry()  // 整个系统全局唯一<br />
c := metrics.NewCounter() // 注册一个计数器<br />
r.Register(“counter”, c)    // 这个注册名全局唯一<br />
度量<br />
Metrics提供5种基本的度量类型：Gauges, Counters, Histograms, Meters和 Timers</p><br />
<br />
<p>Gauge<br />
Gauge是最简单的度量类型，只有一个简单的返回值，</p><br />
<br />
<p>他用来记录一些对象或者事物的瞬时值。</p><br />
<br />
<p>类似于程序里的常量，是不变的值。</p><br />
<br />
<p>Counter<br />
Counter是一个简单的计数器，他可以增加和减少。</p><br />
<br />
<p>类似于程序里的全局变量，可以增加和减少来改变值。</p><br />
<br />
<p>Meter<br />
Meter是一种只能自增的计数器，通常用来度量一系列事件发生的比率。他提供了平均速率，以及指数平滑平均速率，以及采样后的1分钟，5分钟，15分钟速率。</p><br />
<br />
<p>类似于 QPS, 每一分钟发送多少次</p><br />
<br />
<p>Histrogram<br />
Histrogram是用来度量流数据中Value的分布情况，Histrogram可以计算最大/小值、平均值，方差，分位数（如中位数，或者95th分位数），如75%,90%,98%,99%的数据在哪个范围内。</p><br />
<br />
<p>类似于柱状图</p><br />
<br />
<p>中位数<br />
中位数，统计学中的专有名词，代表一个样本、种群或概率分布中的一个数值，其可将数值集合划分为相等的上下两部分。</p><br />
<br />
<p>简单说，就是一排数据从小到大排列后，中间那个数。</p><br />
<br />
<p>例如: 1，3，6，9，11。中间那个数是6，这就是中位数。1，3，6，9，11，13。这是有六个数，中间是两个数了，那么中位数就是6和9</p><br />
<br />
<p>四分位数<br />
四分位数（Quartile）也称四分位点，是指在统计学中把所有数值由小到大排列并分成四等份，处于三个分割点位置的数值。</p><br />
<br />
<p>首先确定四分位数的位置：<br />
Q1的位置= (n+1) × 0.25<br />
Q2的位置= (n+1) × 0.5<br />
Q3的位置= (n+1) × 0.75<br />
所以分位数，就是多少比例样本表示的数值是多少。</p><br />
<br />
<p>Timer<br />
Timer是Histogram跟Meter的一个组合，比如要统计当前请求的速率和处理时间。</p><br />
<br />
<p>Go port of Coda Hale’s Metrics library: https://github.com/dropwizard/metrics.</p><br />
<br />
<p>Documentation: http://godoc.org/github.com/rcrowley/go-metrics.</p><br />
<br />
<p>Usage<br />
Create and update metrics:</p><br />
<br />
<p>c := metrics.NewCounter()<br />
metrics.Register(“foo”, c)<br />
c.Inc(47)</p><br />
<br />
<p>g := metrics.NewGauge()<br />
metrics.Register(“bar”, g)<br />
g.Update(47)</p><br />
<br />
<p>r := NewRegistry()<br />
g := metrics.NewRegisteredFunctionalGauge(“cache-evictions”, r, func() int64 { return cache.getEvictionsCount() })</p><br />
<br />
<p>s := metrics.NewExpDecaySample(1028, 0.015) // or metrics.NewUniformSample(1028)<br />
h := metrics.NewHistogram(s)<br />
metrics.Register(“baz”, h)<br />
h.Update(47)</p><br />
<br />
<p>m := metrics.NewMeter()<br />
metrics.Register(“quux”, m)<br />
m.Mark(47)</p><br />
<br />
<p>t := metrics.NewTimer()<br />
metrics.Register(“bang”, t)<br />
t.Time(func() {})<br />
t.Update(47)<br />
Register() is not threadsafe. For threadsafe metric registration use GetOrRegister:</p><br />
<br />
<p>t := metrics.GetOrRegisterTimer(“account.create.latency”, nil)<br />
t.Time(func() {})<br />
t.Update(47)<br />
NOTE: Be sure to unregister short-lived meters and timers otherwise they will leak memory:</p><br />
<br />
<p>// Will call Stop() on the Meter to allow for garbage collection<br />
metrics.Unregister(“quux”)<br />
// Or similarly for a Timer that embeds a Meter<br />
metrics.Unregister(“bang”)<br />
Periodically log every metric in human-readable form to standard error:</p><br />
<br />
<p>go metrics.Log(metrics.DefaultRegistry, 5 * time.Second, log.New(os.Stderr, “metrics: “, log.Lmicroseconds))<br />
Periodically log every metric in slightly-more-parseable form to syslog:</p><br />
<br />
<p>w, _ := syslog.Dial(“unixgram”, “/dev/log”, syslog.LOG_INFO, “metrics”)<br />
go metrics.Syslog(metrics.DefaultRegistry, 60e9, w)<br />
Periodically emit every metric to Graphite using the Graphite client:</p><br />
<br />
<p>import “github.com/cyberdelia/go-metrics-graphite”</p><br />
<br />
<p>addr, _ := net.ResolveTCPAddr(“tcp”, “127.0.0.1:2003”)<br />
go graphite.Graphite(metrics.DefaultRegistry, 10e9, “metrics”, addr)<br />
Periodically emit every metric into InfluxDB:</p><br />
<br />
<p>NOTE: this has been pulled out of the library due to constant fluctuations in the InfluxDB API. In fact, all client libraries are on their way out. see issues #121 and #124 for progress and details.</p><br />
<br />
<p>import “github.com/vrischmann/go-metrics-influxdb”</p><br />
<br />
<p>go influxdb.InfluxDB(metrics.DefaultRegistry,<br />
  10e9, <br />
  “127.0.0.1:8086”, <br />
  “database-name”, <br />
  “username”, <br />
  “password”<br />
)<br />
Periodically upload every metric to Librato using the Librato client:</p><br />
<br />
<p>Note: the client included with this repository under the librato package has been deprecated and moved to the repository linked above.</p><br />
<br />
<p>import “github.com/mihasya/go-metrics-librato”</p><br />
<br />
<p>go librato.Librato(metrics.DefaultRegistry,<br />
    10e9,                  // interval<br />
    “example@example.com”, // account owner email address<br />
    “token”,               // Librato API token<br />
    “hostname”,            // source<br />
    []float64{0.95},       // percentiles to send<br />
    time.Millisecond,      // time unit<br />
)<br />
Periodically emit every metric to StatHat:</p><br />
<br />
<p>import “github.com/rcrowley/go-metrics/stathat”</p><br />
<br />
<p>go stathat.Stathat(metrics.DefaultRegistry, 10e9, “example@example.com”)<br />
Maintain all metrics along with expvars at /debug/metrics:</p><br />
<br />
<p>This uses the same mechanism as the official expvar but exposed under /debug/metrics, which shows a json representation of all your usual expvars as well as all your go-metrics.</p><br />
<br />
<p>import “github.com/rcrowley/go-metrics/exp”</p><br />
<br />
<p>exp.Exp(metrics.DefaultRegistry)<br />
Installation<br />
go get github.com/rcrowley/go-metrics<br />
StatHat support additionally requires their Go client:</p><br />
<br />
<p>go get github.com/stathat/go<br />
Publishing Metrics<br />
Clients are available for the following destinations:</p><br />
<br />
<p>AppOptics - https://github.com/ysamlan/go-metrics-appoptics<br />
Librato - https://github.com/mihasya/go-metrics-librato<br />
Graphite - https://github.com/cyberdelia/go-metrics-graphite<br />
InfluxDB - https://github.com/vrischmann/go-metrics-influxdb<br />
Ganglia - https://github.com/appscode/metlia<br />
Prometheus - https://github.com/deathowl/go-metrics-prometheus<br />
DataDog - https://github.com/syntaqx/go-metrics-datadog<br />
SignalFX - https://github.com/pascallouisperez/go-metrics-signalfx<br />
Honeycomb - https://github.com/getspine/go-metrics-honeycomb<br />
Wavefront - https://github.com/wavefrontHQ/go-metrics-wavefront<br />
Open-Falcon - https://github.com/g4zhuj/go-metrics-falcon<br />
AWS CloudWatch - https://github.com/savaki/cloudmetrics</p><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
	“github.com/rcrowley/go-metrics”<br />
	“time”<br />
	“os”<br />
	“log”<br />
)</p><br />
<br />
<p>func main(){</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>s := metrics.NewExpDecaySample(1024, 0.015) // or metrics.NewUniformSample(1028)<br />
 <br />
h := metrics.NewHistogram(s)<br />
 <br />
metrics.Register("baz", h)<br />
h.Update(1)<br />
 <br />
 <br />
go metrics.Log(metrics.DefaultRegistry,<br />
	1 * time.Second,<br />
	log.New(os.Stdout, "metrics: ", log.Lmicroseconds))<br />
 <br />
 <br />
var j int64<br />
j = 1<br />
for true {<br />
	time.Sleep(time.Second * 1)<br />
	j++<br />
	h.Update(j)<br />
} }<br />
</code></pre></div></div><br />
<br />
<p>metrics.NewExpDecaySample这函数的两个参数的含义： 第一是内部存储数据的个数</p><br />
<br />
<p>第二个是指数后乘以的数值 具体位置</p><br />
<br />
<p>输出到influxdb</p><br />
<br />
<p>influxdb的安装和基本使用这里不做介绍</p><br />
<br />
<p>使用下面工作<br />
https://github.com/vrischmann/go-metrics-influxdb</p><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
	“github.com/rcrowley/go-metrics”<br />
	“time”<br />
	“github.com/vrischmann/go-metrics-influxdb”<br />
)</p><br />
<br />
<p>func main(){<br />
	m := metrics.NewMeter()<br />
	metrics.Register(“quux”, m)<br />
	m.Mark(1)</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go influxdb.InfluxDB(metrics.DefaultRegistry,<br />
	time.Second * 5,<br />
	"http://192.168.150.74:8086",<br />
	"mydb",<br />
	"",<br />
	"")<br />
 <br />
var j int64<br />
j = 1<br />
for true {<br />
	time.Sleep(time.Second*1)<br />
	m.Mark(j)<br />
	j += 1<br />
} }<br />
</code></pre></div></div><br />
<br />
<p>看以上的代码 其他地方都不用改动 只要改下输出的地方就可以了</p><br />
<br />
<p>在influx中使用设置的database 表名则自用生成 使用 是 metrics中register 设置的名字加上类型 在这里例子中 表名为quux.meter</p><br />
<br />
<p>就可以在influxdb 里面看到</p><br />
<br />
<p>https://prometheus.io/docs/guides/go-application/</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>