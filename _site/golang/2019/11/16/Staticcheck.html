<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">Staticcheck</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2019-11-16T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Nov 16, 2019</time></p>
					</div>
					 <p>https://github.com/dominikh/go-tools<br />
<!-- more --><br />
oo often we discover subtle bugs only after deploying to production. Even in a language like Go it’s possible to write ineffectual code and not catch bugs until it’s too late.</p><br />
<br />
<p>Staticcheck is a static analysis tool for Go code. It has various checks, such as a check for unused variables, a check for deferring the Lock method on a mutex right after locking (the user probably meant to defer Unlock instead), a check for unreachable code, and more.</p><br />
<br />
<p>In this post we’ll show sample code for which staticcheck returns errors, and how to fix the affected code.</p><br />
<br />
<p>Value is never used (SA4006)<br />
I always double check these errors as they can cause some serious bugs. Here’s one example:</p><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
	“errors”<br />
	“fmt”<br />
	“log”<br />
)</p><br />
<br />
<p>type Result struct {<br />
	Entries []string<br />
}</p><br />
<br />
<p>func Query() (Result, error) {<br />
	return Result{<br />
		Entries: []string{},<br />
	}, nil<br />
}</p><br />
<br />
<p>func ResultEntries() (Result, error) {<br />
	err := errors.New(“no entries found”)<br />
	result, err := Query()<br />
	if err != nil {<br />
		return Result{}, err<br />
	}<br />
	if len(result.Entries) == 0 {<br />
		return Result{}, err<br />
	}<br />
	return result, nil<br />
}</p><br />
<br />
<p>func main() {<br />
	result, err := ResultEntries()<br />
	if err != nil {<br />
		log.Fatal(err)<br />
	}<br />
	fmt.Printf(“result=%v, err=%v”, result, err)<br />
}<br />
When running staticcheck on this code, we see the following errors:</p><br />
<br />
<p>$ staticcheck main.go<br />
main.go:20:2: this value of err is never used (SA4006)<br />
main.go:20:19: New is a pure function but its return value is ignored (SA4017)<br />
We’re going to ignore the second error as it’s a side effect of the first.</p><br />
<br />
<p>If we run the code, we see:</p><br />
<br />
<p>$ go run main.go<br />
result={[]}, err=<nil><br />
Let's investigate:</nil></p><br />
<br />
<p>We have two functions, Query() and ResultEntries(). The Query function returns an empty set of entries for the purpose of this example. The ResultEntries() function declares an error at the top, err := errors.New(“no entries found”), and then calls Query() right below that to get the result.</p><br />
<br />
<p>This call to Query, however, overwrites the err variable to <nil> when the error returned is nil. So when we check the length of result.Entries and find that it's 0, we return Result{}, err but the err we're returning is not the err we declared at the top of the function, but rather the <nil> error which was returned by Query().</nil></nil></p><br />
<br />
<p>This example is quite harmless but one can imagine how similar code might lead to a more serious bug.</p><br />
<br />
<p>So how do we fix it?</p><br />
<br />
<p>The method you choose to fix this will depend on your preferred style. Here is one way:</p><br />
<br />
<p>func ResultEntries() (Result, error) {<br />
	result, err := Query()<br />
	if err != nil {<br />
		return Result{}, err<br />
	}</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>err = errors.New("no entries found")<br />
if len(result.Entries) == 0 {<br />
	return Result{}, err<br />
}<br />
<br />
return result, nil } Here we reassign the err variable before checking the length of result.Entries. This will now return the correct error:<br />
</code></pre></div></div><br />
<br />
<p>$ go run main.go<br />
2019/09/18 19:03:40 no entries found<br />
exit status 1<br />
and staticcheck no longer complains:</p><br />
<br />
<p>$ staticcheck main.go<br />
$<br />
Another way would be:</p><br />
<br />
<p>func ResultEntries() (Result, error) {<br />
	result, err := Query()<br />
	if err != nil {<br />
		return Result{}, err<br />
	}</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if len(result.Entries) == 0 {<br />
	return Result{}, errors.New("no entries found")<br />
}<br />
<br />
return result, nil } Calling regexp.MatchString in a loop has poor performance (SA6000) If staticcheck finds this issue in your code, you can fix it for better performance. Here's an example (note: this is not an extensive regular expression for matching emails):<br />
</code></pre></div></div><br />
<br />
<p>package main</p><br />
<br />
<p>import (<br />
	“fmt”<br />
	“log”<br />
	“regexp”<br />
)</p><br />
<br />
<p>func ValidateEmails(addrs []string) (bool, error) {<br />
	for _, email := range addrs {<br />
		matched, err := regexp.MatchString(“^[a-zA-Z0-9.]+@[a-zA-Z0-9]+\.[a-zA-Z0-9]*$”, email)<br />
		if err != nil {<br />
			return false, err<br />
		}</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	if !matched {<br />
		return false, nil<br />
	}<br />
}<br />
<br />
return true, nil }<br />
</code></pre></div></div><br />
<br />
<p>func main() {<br />
	emails := []string{“testuser@gmail.com”, “anotheruser@yahoo.com”, “onemoreuser@hotmail.com”}</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matched, err := ValidateEmails(emails)<br />
if err != nil {<br />
	log.Fatal(err)<br />
}<br />
<br />
fmt.Println(matched) } In this example we pass a slice of email addresses to a validation function that matches them with a regular expression. Staticcheck finds the following issue:<br />
</code></pre></div></div><br />
<br />
<p>$ staticcheck main.go<br />
main.go:11:37: calling regexp.MatchString in a loop has poor performance, consider using regexp.Compile (SA6000)<br />
Let’s fix it and then look at some benchmarks.</p><br />
<br />
<p>To fix the issue we’ll compile the regular expression at the beginning of the function instead of recreating it in the loop every iteration:</p><br />
<br />
<p>func ValidateEmails(addrs []string) (bool, error) {<br />
	re := regexp.MustCompile(<code class="language-plaintext highlighter-rouge">^[a-zA-Z0-9.]+@[a-zA-Z0-9]+\.[a-zA-Z0-9]*$</code>)<br />
	for _, email := range addrs {<br />
		matched := re.MatchString(email)</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	if !matched {<br />
		return false, nil<br />
	}<br />
}<br />
<br />
return true, nil } The method regexp.MustCompile creates a reusable regular expression struct and panics if it can't be compiled. You may have noticed that the string changed slightly, but we'll ignore that for the purposes of this post it's not relevant to the overall fix. If we run staticcheck on this new code, we see no errors:<br />
</code></pre></div></div><br />
<br />
<p>$ staticcheck main.go<br />
$<br />
The code runs and returns true:</p><br />
<br />
<p>$ go run main.go<br />
true<br />
Now let’s write a benchmark to compare these two methods. We’ll call the original method ValidateEmailsRegexpLoop, and keep the current implementation called ValidateEmails:</p><br />
<br />
<p>package main</p><br />
<br />
<p>import “testing”</p><br />
<br />
<p>func BenchmarkValidateEmailsRegexpLoop(b *testing.B) {<br />
	emails := []string{“testuser@gmail.com”, “anotheruser@yahoo.com”, “onemoreuser@hotmail.com”}<br />
	for i := 0; i &lt; b.N; i++ {<br />
		_, err := ValidateEmailsRegexpLoop(emails)<br />
		if err != nil {<br />
			b.Fatal(err)<br />
		}<br />
	}<br />
}</p><br />
<br />
<p>func BenchmarkValidateEmails(b *testing.B) {<br />
	emails := []string{“testuser@gmail.com”, “anotheruser@yahoo.com”, “onemoreuser@hotmail.com”}<br />
	for i := 0; i &lt; b.N; i++ {<br />
		_, err := ValidateEmails(emails)<br />
		if err != nil {<br />
			b.Fatal(err)<br />
		}<br />
	}<br />
}<br />
Let’s run this benchmark:</p><br />
<br />
<p>$ go test -bench=.<br />
goos: darwin<br />
goarch: amd64<br />
BenchmarkValidateEmailsRegexpLoop-4         100000         21150 ns/op<br />
BenchmarkValidateEmails-4                   200000          8108 ns/op<br />
PASS<br />
ok      _/Users/gopher  4.045s<br />
There is a significant performance improvement by declaring the regular expression once outside of the loop. Thanks staticcheck!</p><br />
<br />
<p>Running Staticcheck on popular open source codebases<br />
As the co-creator of Go Report Card, I’m passionate about open source code quality. Let’s take a look at staticcheck results for some popular open source repositories.</p><br />
<br />
<p>aws/aws-sdk-go<br />
github.com/aws/aws-sdk-go is the official AWS SDK for Go. To install it, run:</p><br />
<br />
<p>$ go get github.com/aws/aws-sdk-go<br />
and then:</p><br />
<br />
<p>$ cd $GOPATH/src/github.com/aws/aws-sdk-go<br />
Staticcheck takes a long time to run on the entire codebase, so let’s run it on a single directory and its sub-directories:</p><br />
<br />
<p>$ aws-sdk-go git:(master) staticcheck ./aws/…<br />
There are many results. The one in particular we’ll take a look at is:</p><br />
<br />
<p>aws/request/request_retry_test.go:133:2: unreachable case clause: github.com/aws/aws-sdk-go/aws/request.temporary will always match before *net/url.Error (SA4020)<br />
Here is the function:</p><br />
<br />
<p>func debugerr(t *testing.T, err error) {<br />
	t.Logf(“Error, %v”, err)</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>switch err := err.(type) {<br />
case temporary:<br />
	t.Logf("%s is a temporary error: %t", err, err.Temporary())<br />
	return<br />
case *url.Error:<br />
	t.Logf("err: %s, nested err: %#v", err, err.Err)<br />
	if operr, ok := err.Err.(*net.OpError); ok {<br />
		t.Logf("operr: %#v", operr)<br />
	}<br />
	debugerr(t, err.Err)<br />
	return<br />
default:<br />
	return<br />
} } We need to take a look at the temporary type definition as well as url.Error to see what's going on. The temporary type is located in aws/request/retryer.go:<br />
</code></pre></div></div><br />
<br />
<p>type temporary interface {<br />
    Temporary() bool<br />
}<br />
and in the stdlib net/url package we’ll find a concrete type Error that implements a Temporary() method (along with some others). In other words, url.Error implements the temporary interface.</p><br />
<br />
<p>To break it down, let’s imagine that we do pass a url.Error to the debugerr function. We go into the type switch and ask, “is this value’s type temporary?” The answer is “yes” because url.Error implements the Temporary() method, the only method in the temporary interface. Thus we enter that case and return – and we never get to case *url.Error.</p><br />
<br />
<p>This can be fixed by swapping the case statements:</p><br />
<br />
<p>func debugerr(t *testing.T, err error) {<br />
	t.Logf(“Error, %v”, err)</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>switch err := err.(type) {<br />
case *url.Error:<br />
	t.Logf("err: %s, nested err: %#v", err, err.Err)<br />
	if operr, ok := err.Err.(*net.OpError); ok {<br />
		t.Logf("operr: %#v", operr)<br />
	}<br />
	debugerr(t, err.Err)<br />
	return<br />
case temporary:<br />
	t.Logf("%s is a temporary error: %t", err, err.Temporary())<br />
	return<br />
default:<br />
	return<br />
} } Now, if we pass a url.Error to this function, it will match in the first case statement.<br />
</code></pre></div></div><br />
<br />
<p>Staticcheck also finds other issues that could be fixed in small PRs. Here are a few that stood out to me:</p><br />
<br />
<p>service/s3/host_style_bucket.go:70:2: var accelElem is unused (U1000)<br />
service/glacier/treehash.go:58:5: should omit nil check; len() for nil slices is defined as zero (S1009)<br />
service/s3/s3manager/upload.go:366:2: field bufferUploadPool is unused (U1000)<br />
Kubernetes<br />
Staticcheck found many issues in Kubernetes. Let’s take a look at some of them:</p><br />
<br />
<p>First, we’ll get the source:</p><br />
<br />
<p>go get k8s.io/kubernetes<br />
Kubernetes is quite a large codebase, so this time we’ll just focus on one package, pkg/volume:</p><br />
<br />
<p>staticcheck ./pkg/volume/…<br />
There are many results, but we’ll focus on one of them for now:</p><br />
<br />
<p>pkg/volume/azure_file/azure_file.go:122:31: this value of err is never used (SA4006)<br />
If we take a look at that code, we see the following function:</p><br />
<br />
<p>func (plugin *azureFilePlugin) newMounterInternal(spec *volume.Spec, pod *v1.Pod, util azureUtil, mounter mount.Interface) (volume.Mounter, error) {<br />
	share, readOnly, err := getVolumeSource(spec)<br />
	if err != nil {<br />
		return nil, err<br />
	}<br />
	secretName, secretNamespace, err := getSecretNameAndNamespace(spec, pod.Namespace)<br />
	return &amp;azureFileMounter{<br />
		azureFile: &amp;azureFile{<br />
			volName:         spec.Name(),<br />
			mounter:         mounter,<br />
			pod:             pod,<br />
			plugin:          plugin,<br />
			MetricsProvider: volume.NewMetricsStatFS(getPath(pod.UID, spec.Name(), plugin.host)),<br />
		},<br />
		util:            util,<br />
		secretNamespace: secretNamespace,<br />
		secretName:      secretName,<br />
		shareName:       share,<br />
		readOnly:        readOnly,<br />
		mountOptions:    volutil.MountOptionFromSpec(spec),<br />
	}, nil<br />
}<br />
We can see that the error returned by the getSecretNameAndNamespace function is ignored. We should add an error check:</p><br />
<br />
<p>func (plugin *azureFilePlugin) newMounterInternal(spec *volume.Spec, pod *v1.Pod, util azureUtil, mounter mount.Interface) (volume.Mounter, error) {<br />
  share, readOnly, err := getVolumeSource(spec)<br />
  if err != nil {<br />
    return nil, err<br />
  }<br />
  secretName, secretNamespace, err := getSecretNameAndNamespace(spec, pod.Namespace)<br />
  if err != nil {<br />
    return nil, err<br />
  }<br />
  return &amp;azureFileMounter{<br />
    azureFile: &amp;azureFile{<br />
      volName:         spec.Name(),<br />
      mounter:         mounter,<br />
      pod:             pod,<br />
      plugin:          plugin,<br />
      MetricsProvider: volume.NewMetricsStatFS(getPath(pod.UID, spec.Name(), plugin.host)),<br />
    },<br />
    util:            util,<br />
    secretNamespace: secretNamespace,<br />
    secretName:      secretName,<br />
    shareName:       share,<br />
    readOnly:        readOnly,<br />
    mountOptions:    volutil.MountOptionFromSpec(spec),<br />
  }, nil<br />
}<br />
The Go source tree<br />
That’s right, staticcheck even found some bugs in the Go source itself!</p><br />
<br />
<p>To be fair, it didn’t find anything egregious, but I didn’t run it on every package so it’s possible there are some more bugs hiding elsewhere.</p><br />
<br />
<p>We’ll take a look at another unused error variable in a file called database/sql/sql_test.go. The test is TestTxEndBadConn:</p><br />
<br />
<p>dbQuery := func(endTx func(tx *Tx) error) func() error {<br />
	return func() error {<br />
		tx, err := db.Begin()<br />
		if err != nil {<br />
			return err<br />
		}<br />
		rows, err := tx.Query(“SELECT|t1|age,name|”)<br />
		if err == nil {<br />
			err = rows.Close()<br />
		} else {<br />
			return err<br />
		}<br />
		return endTx(tx)<br />
	}<br />
}<br />
Staticcheck tells us the following:</p><br />
<br />
<p>database/sql/sql_test.go:2888:5: this value of err is never used (SA4006)<br />
This refers to the line err = rows.Close(). We can fix it by checking the error:</p><br />
<br />
<p>dbQuery := func(endTx func(tx *Tx) error) func() error {<br />
	return func() error {<br />
		tx, err := db.Begin()<br />
		if err != nil {<br />
			return err<br />
		}<br />
		rows, err := tx.Query(“SELECT|t1|age,name|”)<br />
		if err == nil {<br />
			err = rows.Close()<br />
			if err != nil {<br />
				return err<br />
			}<br />
		} else {<br />
			return err<br />
		}<br />
		return endTx(tx)<br />
	}<br />
}<br />
Or perhaps this is more idiomatic:</p><br />
<br />
<p>dbQuery := func(endTx func(tx *Tx) error) func() error {<br />
	return func() error {<br />
		tx, err := db.Begin()<br />
		if err != nil {<br />
			return err<br />
		}<br />
		rows, err := tx.Query(“SELECT|t1|age,name|”)<br />
		if err != nil {<br />
			return err<br />
		}</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	err = rows.Close()<br />
	if err != nil {<br />
		return err<br />
	}<br />
<br />
	return endTx(tx)<br />
} } There are other functions in the same test file that call rows.Close() without checking the error, so maybe that is fine too.<br />
</code></pre></div></div><br />
<br />
<p>If you’ve been wanting to make a contribution to the Go source code, this could be your chance.</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category golang
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>