<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">PHP SPL（PHP 标准库）</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-04-21T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Apr 21, 2020</time></p>
					</div>
					 <p>一、什么是spl库？<br />
SPL是用于解决典型问题(standard problems)的一组接口与类的集合。</p><br />
<br />
<p>此扩展只能在php 5.0以后使用，从PHP 5.3.0 不再被关闭,会一直有效.成为php内核组件一部份。</p><br />
<br />
<p>SPL提供了一组标准数据结构。</p><br />
<br />
<p>二、SPL如何使用？<br />
1.构建此扩展不需要其他扩展。</p><br />
<br />
<p>更详细的情况可参考 http://php.net/manual/zh/spl.datastructures.php<br />
<!-- more --><br />
双向链表<br />
双链表是一种重要的线性存储结构，对于双链表中的每个节点，不仅仅存储自己的信息，还要保存前驱和后继节点的地址。</p><br />
<br />
<p>SplDoublyLinkedList</p><br />
<br />
<p>SplStack（栈）</p><br />
<br />
<p>SplQueue（队列）</p><br />
<br />
<p>SplDoublyLinkedList implements Iterator , ArrayAccess , Countable {    /* 方法 */<br />
    public __construct ( void )  <br /><br />
    public void add ( mixed $index , mixed $newval )  <br /><br />
    public mixed bottom ( void )//双链表的尾部节点<br />
    public int count ( void )//双联表元素的个数<br />
    public mixed current ( void )//当前记录<br />
    public int getIteratorMode ( void ) //获取迭代模式<br />
    public bool isEmpty ( void )//检测双链表是否为空<br />
    public mixed key ( void )//当前节点索引<br />
    public void next ( void )//移到下条记录<br />
    public bool offsetExists ( mixed $index )//指定index处节点是否存在<br />
    public mixed offsetGet ( mixed $index )//获取指定index处节点值<br />
    public void offsetSet ( mixed $index , mixed $newval )//设置指定index处值<br />
    public void offsetUnset ( mixed $index )//删除指定index处节点<br />
    public mixed pop ( void )//从双链表的尾部弹出元素<br />
    public void prev ( void )//移到上条记录<br />
    public void push ( mixed $value )//添加元素到双链表的尾部<br />
    public void rewind ( void )//将指针指向迭代开始处<br />
    public string serialize ( void )//序列化存储<br />
    public void setIteratorMode ( int $mode )//设置迭代模式<br />
    public mixed shift ( void )//双链表的头部移除元素<br />
    public mixed top ( void )//双链表的头部节点<br />
    public void unserialize ( string $serialized )//反序列化<br />
    public void unshift ( mixed $value )//双链表的头部添加元素<br />
    public bool valid ( void )//检查双链表是否还有节点<br />
}</p><br />
<br />
<p>接下来是使用方法：</p><br />
<br />
<p>$list = new SplDoublyLinkedList();<br />
$list-&gt;push(‘a’);<br />
$list-&gt;push(‘b’);<br />
$list-&gt;push(‘c’);<br />
$list-&gt;push(‘d’);</p><br />
<br />
<p>$list-&gt;unshift(‘top’);<br />
$list-&gt;shift();</p><br />
<br />
<p>$list-&gt;rewind();//rewind操作用于把节点指针指向Bottom所在的节点<br />
echo ‘curren node:’.$list-&gt;current().”<br />”;//获取当前节点</p><br />
<br />
<p>$list-&gt;next();//指针指向下一个节点<br />
echo ‘next node:’.$list-&gt;current().”<br />”;</p><br />
<br />
<p>$list-&gt;next();<br />
$list-&gt;next();<br />
$list-&gt;prev();//指针指向上一个节点<br />
echo ‘next node:’.$list-&gt;current().”<br />”;</p><br />
<br />
<p>if($list-&gt;current())<br />
    echo ‘current node is valid<br />’;<br />
else<br />
    echo ‘current node is invalid<br />’;</p><br />
<br />
<p>if($list-&gt;valid())//如果当前节点是有效节点，valid返回true<br />
    echo “valid list<br />”;<br />
else<br />
  echo “invalid list <br />”;</p><br />
<br />
<p>var_dump(array(<br />
    ‘pop’ =&gt; $list-&gt;pop(),<br />
    ‘count’ =&gt; $list-&gt;count(),  <br /><br />
    ‘isEmpty’ =&gt; $list-&gt;isEmpty(),  <br /><br />
    ‘bottom’ =&gt; $list-&gt;bottom(),  <br /><br />
    ‘top’ =&gt; $list-&gt;top()<br />
));</p><br />
<br />
<p>$list-&gt;setIteratorMode(SplDoublyLinkedList::IT_MODE_FIFO);<br />
var_dump($list-&gt;getIteratorMode());</p><br />
<br />
<p>for($list-&gt;rewind(); $list-&gt;valid(); $list-&gt;next()){<br />
    echo $list-&gt;current().PHP_EOL;<br />
}</p><br />
<br />
<p>var_dump($a = $list-&gt;serialize());<br />
//print_r($list-&gt;unserialize($a));</p><br />
<br />
<p>$list-&gt;offsetSet(0,’new one’);<br />
$list-&gt;offsetUnset(0);<br />
var_dump(array(<br />
    ‘offsetExists’ =&gt; $list-&gt;offsetExists(4),  <br /><br />
    ‘offsetGet’ =&gt; $list-&gt;offsetGet(0),<br />
));<br />
var_dump($list);</p><br />
<br />
<p>//堆栈，先进后出<br />
$stack = new SplStack();//继承自SplDoublyLinkedList类</p><br />
<br />
<p>$stack-&gt;push(“a<br />”);<br />
$stack-&gt;push(“b<br />”);</p><br />
<br />
<p>echo $stack-&gt;pop();<br />
echo $stack-&gt;pop();<br />
echo $stack-&gt;offsetSet(0,’B’);//堆栈的offset=0是Top所在的位置，offset=1是Top位置节点靠近bottom位置的相邻节点，以此类推</p><br />
<br />
<p>$stack-&gt;rewind();//双向链表的rewind和堆栈的rewind相反，堆栈的rewind使得当前指针指向Top所在的位置，而双向链表调用之后指向bottom所在位置<br />
echo ‘current:’.$stack-&gt;current().’<br />’;<br />
$stack-&gt;next();//堆栈的next操作使指针指向靠近bottom位置的下一个节点，而双向链表是靠近top的下一个节点<br />
echo ‘current:’.$stack-&gt;current().’<br />’;<br />
echo ‘<br /><br />’;</p><br />
<br />
<p>//队列，先进先出<br />
$queue = new SplQueue();//继承自SplDoublyLinkedList类<br />
$queue-&gt;enqueue(“a<br />”);//插入一个节点到队列里面的Top位置<br />
$queue-&gt;enqueue(“b<br />”);<br />
$queue-&gt;offsetSet(0,’A’);//堆栈的offset=0是Top所在的位置，offset=1是Top位置节点靠近bottom位置的相邻节点，以此类推<br />
echo $queue-&gt;dequeue();<br />
echo $queue-&gt;dequeue();<br />
echo “<br /><br />”;</p><br />
<br />
<p>堆<br />
堆(Heap)就是为了实现优先队列而设计的一种数据结构，它是通过构造二叉堆(二叉树的一种)实现。根节点最大的堆叫做最大堆或大根堆（SplMaxHeap），根节点最小的堆叫做最小堆或小根堆（SplMinHeap）。二叉堆还常用于排序(堆排序)</p><br />
<br />
<p>SplHeap</p><br />
<br />
<p>SplMaxHeap</p><br />
<br />
<p>SplMinHeap</p><br />
<br />
<p>SplPriorityQueue</p><br />
<br />
<p>abstract SplHeap implements Iterator , Countable {  <br /><br />
    /* 方法 用法同双向链表一致 */<br />
    public __construct ( void )  <br /><br />
    abstract protected int compare ( mixed $value1 , mixed $value2 )  <br /><br />
    public int count ( void )  <br /><br />
    public mixed current ( void )  <br /><br />
    public mixed extract ( void )  <br /><br />
    public void insert ( mixed $value )  <br /><br />
    public bool isEmpty ( void )  <br /><br />
    public mixed key ( void )  <br /><br />
    public void next ( void )  <br /><br />
    public void recoverFromCorruption ( void )  <br /><br />
    public void rewind ( void )  <br /><br />
    public mixed top ( void )  <br /><br />
    public bool valid ( void )<br />
}</p><br />
<br />
<p>使用方法：</p><br />
<br />
<p>//堆<br />
class MySplHeap extends SplHeap{<br />
    //compare()方法用来比较两个元素的大小，绝对他们在堆中的位置<br />
    public function compare( $value1, $value2 ) {<br />
        return ( $value1 - $value2 );<br />
        }<br />
}</p><br />
<br />
<p>$obj = new MySplHeap();<br />
$obj-&gt;insert(0);<br />
$obj-&gt;insert(1);<br />
$obj-&gt;insert(2);<br />
$obj-&gt;insert(3);<br />
$obj-&gt;insert(4);<br />
echo $obj-&gt;top();//4<br />
echo $obj-&gt;count();//5</p><br />
<br />
<p>foreach ($obj as $item) {<br />
    echo $item.”<br />”;<br />
}</p><br />
<br />
<p>阵列<br />
优先队列也是非常实用的一种数据结构，可以通过加权对值进行排序，由于排序在php内部实现，业务代码中将精简不少而且更高效。通过SplPriorityQueue::setExtractFlags(int  $flag)设置提取方式可以提取数据（等同最大堆）、优先级、和两者都提取的方式。</p><br />
<br />
<p>SplFixedArray</p><br />
<br />
<p>SplFixedArray implements Iterator , ArrayAccess , Countable {<br />
　　/* 方法 */　　<br />
　　public __construct ([ int $size = 0 ] )<br />
　　public int count ( void )<br />
　　public mixed current ( void )<br />
　　public static SplFixedArray fromArray ( array $array [, bool $save_indexes = true ] )<br />
　　public int getSize ( void )<br />
　　public int key ( void )<br />
　　public void next ( void )<br />
　　public bool offsetExists ( int $index )<br />
　　public mixed offsetGet ( int $index )<br />
　　public void offsetSet ( int $index , mixed $newval )<br />
　　public void offsetUnset ( int $index )<br />
　　public void rewind ( void )<br />
　　public int setSize ( int $size )<br />
　　public array toArray ( void )<br />
　　public bool valid ( void )<br />
　　public void __wakeup ( void )<br />
}</p><br />
<br />
<p>使用方法：</p><br />
<br />
<p>$arr = new SplFixedArray(4);<br />
$arr[0] = ‘php’;<br />
$arr[1] = 1;<br />
$arr[3] = ‘python’;//遍历， $arr[2] 为null<br />
foreach($arr as $v) {<br />
    echo $v . PHP_EOL;<br />
}</p><br />
<br />
<p>//获取数组长度<br />
echo $arr-&gt;getSize(); //4</p><br />
<br />
<p>//增加数组长度<br />
$arr-&gt;setSize(5);<br />
$arr[4] = ‘new one’;</p><br />
<br />
<p>//捕获异常<br />
try{<br />
    echo $arr[10];<br />
} catch (RuntimeException $e) {<br />
    echo $e-&gt;getMessage();<br />
}</p><br />
<br />
<p>映射<br />
用来存储一组对象的，特别是当你需要唯一标识对象的时候。</p><br />
<br />
<p>SplObjectStorage</p><br />
<br />
<p>SplObjectStorage implements Countable , Iterator , Serializable , ArrayAccess {<br />
　　/* 方法 */　　<br />
　　public void addAll ( SplObjectStorage $storage )<br />
　　public void attach ( object $object [, mixed $data = NULL ] )<br />
　　public bool contains ( object $object )<br />
　　public int count ( void )<br />
　　public object current ( void )<br />
　　public void detach ( object $object )<br />
　　public string getHash ( object $object )<br />
　　public mixed getInfo ( void )<br />
　　public int key ( void )<br />
　　public void next ( void )<br />
　　public bool offsetExists ( object $object )<br />
　　public mixed offsetGet ( object $object )<br />
　　public void offsetSet ( object $object [, mixed $data = NULL ] )<br />
　　public void offsetUnset ( object $object )<br />
　　public void removeAll ( SplObjectStorage $storage )<br />
　　public void removeAllExcept ( SplObjectStorage $storage )<br />
　　public void rewind ( void )<br />
　　public string serialize ( void )<br />
　　public void setInfo ( mixed $data )<br />
　　public void unserialize ( string $serialized )<br />
　　public bool valid ( void )<br />
}</p><br />
<br />
<p>使用方法：</p><br />
<br />
<p>class A {<br />
    public $i;  <br /><br />
    public function __construct($i) {<br />
        $this-&gt;i = $i;<br />
    }<br />
}</p><br />
<br />
<p>$a1 = new A(1);<br />
$a2 = new A(2);<br />
$a3 = new A(3);<br />
$a4 = new A(4);</p><br />
<br />
<p>$container = new SplObjectStorage();</p><br />
<br />
<p>//SplObjectStorage::attach 添加对象到Storage中<br />
$container-&gt;attach($a1);<br />
$container-&gt;attach($a2);<br />
$container-&gt;attach($a3);</p><br />
<br />
<p>//SplObjectStorage::detach 将对象从Storage中移除<br />
$container-&gt;detach($a2);</p><br />
<br />
<p>//SplObjectStorage::contains用于检查对象是否存在Storage中<br />
var_dump($container-&gt;contains($a1)); //true<br />
var_dump($container-&gt;contains($a4)); //false</p><br />
<br />
<p>//遍历<br />
$container-&gt;rewind();<br />
while($container-&gt;valid()) {<br />
    var_dump($container-&gt;current());  <br /><br />
    $container-&gt;next();<br />
}</p><br />
<br />
<p>https://www.w3cschool.cn/doc_php/php-arrayobject-getarraycopy.html<br />
Exports the ArrayObject to an array.</p><br />
<br />
<p>class OrderInfo extends \ArrayObject implements \JsonSerializable {}</p><br />
<br />
<p>https://www.w3cschool.cn/doc_php/php-jsonserializable-jsonserialize.html?lang=en</p><br />
<br />
<p>https://www.php.net/manual/en/arrayiterator.getarraycopy.php</p><br />
<br />
<p>https://www.php.net/manual/de/jsonserializable.jsonserialize.php</p><br />
<br />
<p>https://www.php.net/manual/zh/class.arrayobject.php</p><br />
<br />
<p>https://www.php.net/manual/en/arrayobject.offsetunset.php</p><br />
<br />
<p>https://www.php.net/manual/en/arrayobject.getarraycopy.php</p><br />
<br />
<p>第一部分 简介</p><br />
<br />
<ol><br />
  <li><br />
    <p>什么是SPL？</p><br />
  </li><br />
  <li><br />
    <p>什么是Iterator？</p><br />
  </li><br />
</ol><br />
<br />
<p>第二部分 SPL Interfaces</p><br />
<br />
<ol><br />
  <li><br />
    <p>Iterator界面</p><br />
  </li><br />
  <li><br />
    <p>ArrayAccess界面</p><br />
  </li><br />
  <li><br />
    <p>IteratorAggregate界面</p><br />
  </li><br />
  <li><br />
    <p>RecursiveIterator界面</p><br />
  </li><br />
  <li><br />
    <p>SeekableIterator界面</p><br />
  </li><br />
  <li><br />
    <p>Countable界面</p><br />
  </li><br />
</ol><br />
<br />
<p>第三部分 SPL Classes</p><br />
<br />
<ol><br />
  <li><br />
    <p>SPL的内置类</p><br />
  </li><br />
  <li><br />
    <p>DirectoryIterator类</p><br />
  </li><br />
  <li><br />
    <p>ArrayObject类</p><br />
  </li><br />
  <li><br />
    <p>ArrayIterator类</p><br />
  </li><br />
  <li><br />
    <p>RecursiveArrayIterator类和RecursiveIteratorIterator类</p><br />
  </li><br />
  <li><br />
    <p>FilterIterator类</p><br />
  </li><br />
  <li><br />
    <p>SimpleXMLIterator类</p><br />
  </li><br />
  <li><br />
    <p>CachingIterator类</p><br />
  </li><br />
  <li><br />
    <p>LimitIterator类</p><br />
  </li><br />
  <li><br />
    <p>SplFileObject类</p><br />
  </li><br />
</ol><br />
<br />
<p>第一部 简介</p><br />
<br />
<ol><br />
  <li>什么是SPL？<br />
SPL是Standard PHP Library（PHP标准库）的缩写。</li><br />
</ol><br />
<br />
<p>根据官方定义，它是”a collection of interfaces and classes that are meant to solve standard problems”。但是，目前在使用中，SPL更多地被看作是一种使object（物体）模仿array（数组）行为的interfaces和classes。</p><br />
<br />
<ol><br />
  <li>什么是Iterator？</li><br />
</ol><br />
<br />
<p>SPL的核心概念就是Iterator。这指的是一种Design Pattern，根据《Design Patterns》一书的定义，Iterator的作用是”provide an object which traverses some aggregate structure, abstracting away assumptions about the implementation of that structure.”</p><br />
<br />
<p>wikipedia中说，”an iterator is an object which allows a programmer to traverse through all the elements of a collection, regardless of its specific implementation”…….”the iterator pattern is a design pattern in which iterators are used to access the elements of an aggregate object sequentially without exposing its underlying representation”.</p><br />
<br />
<p>通俗地说，Iterator能够使许多不同的数据结构，都能有统一的操作界面，比如一个数据库的结果集、同一个目录中的文件集、或者一个文本中每一行构成的集合。</p><br />
<br />
<p>如果按照普通情况，遍历一个MySQL的结果集，程序需要这样写：</p><br />
<br />
<p>// Fetch the “aggregate structure”<br />
$result = mysql_query(“SELECT * FROM users”);</p><br />
<br />
<p>// Iterate over the structure<br />
while ( $row = mysql_fetch_array($result) ) {<br />
   // do stuff with the row here<br />
}</p><br />
<br />
<p>读出一个目录中的内容，需要这样写：</p><br />
<br />
<p>// Fetch the “aggregate structure”<br />
$dh = opendir(‘/home/harryf/files’);</p><br />
<br />
<p>// Iterate over the structure<br />
while ( $file = readdir($dh) ) {<br />
   // do stuff with the file here<br />
}</p><br />
<br />
<p>读出一个文本文件的内容，需要这样写：</p><br />
<br />
<p>// Fetch the “aggregate structure”<br />
$fh = fopen(“/home/hfuecks/files/results.txt”, “r”);</p><br />
<br />
<p>// Iterate over the structure<br />
while (!feof($fh)) {</p><br />
<br />
<p>$line = fgets($fh);<br />
   // do stuff with the line here</p><br />
<br />
<p>}</p><br />
<br />
<p>上面三段代码，虽然处理的是不同的resource（资源），但是功能都是遍历结果集（loop over contents），因此Iterator的基本思想，就是将这三种不同的操作统一起来，用同样的命令界面，处理不同的资源。</p><br />
<br />
<p>第二部分 SPL Interfaces</p><br />
<br />
<ol><br />
  <li>Iterator界面</li><br />
</ol><br />
<br />
<p>SPL规定，所有部署了Iterator界面的class，都可以用在foreach Loop中。Iterator界面中包含5个必须部署的方法：</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* current()<br />
<br />
  This method returns the current index's value. You are solely<br />
  responsible for tracking what the current index is as the <br />
 interface does not do this for you.<br />
<br />
* key()<br />
<br />
  This method returns the value of the current index's key. For <br />
  foreach loops this is extremely important so that the key <br />
  value can be populated.<br />
<br />
* next()<br />
<br />
  This method moves the internal index forward one entry.<br />
<br />
* rewind()<br />
<br />
  This method should reset the internal index to the first element.<br />
<br />
* valid()<br />
<br />
  This method should return true or false if there is a current <br />
  element. It is called after rewind() or next().<br />
</code></pre></div></div><br />
<br />
<p>下面就是一个部署了Iterator界面的class示例：</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>An iterator for native PHP arrays, re-inventing the wheel<br />
*</li><br />
  <li><br />
    <p>Notice the “implements Iterator” - important!<br />
*/<br />
class ArrayReloaded implements Iterator {</p><br />
<br />
    <p>/**</p><br />
    <ul><br />
      <li>A native PHP array to iterate over<br />
 */<br />
 private $array = array();</li><br />
    </ul><br />
<br />
    <p>/**</p><br />
    <ul><br />
      <li>A switch to keep track of the end of the array<br />
 */<br />
 private $valid = FALSE;</li><br />
    </ul><br />
<br />
    <p>/**</p><br />
    <ul><br />
      <li>Constructor</li><br />
      <li>@param array native PHP array to iterate over<br />
 */<br />
 function __construct($array) {<br />
 $this-&gt;array = $array;<br />
 }</li><br />
    </ul><br />
<br />
    <p>/**</p><br />
    <ul><br />
      <li>Return the array “pointer” to the first element</li><br />
      <li>PHP’s reset() returns false if the array has no elements<br />
 */<br />
 function rewind(){<br />
 $this-&gt;valid = (FALSE !== reset($this-&gt;array));<br />
 }</li><br />
    </ul><br />
<br />
    <p>/**</p><br />
    <ul><br />
      <li>Return the current array element<br />
 */<br />
 function current(){<br />
 return current($this-&gt;array);<br />
 }</li><br />
    </ul><br />
<br />
    <p>/**</p><br />
    <ul><br />
      <li>Return the key of the current array element<br />
 */<br />
 function key(){<br />
 return key($this-&gt;array);<br />
 }</li><br />
    </ul><br />
<br />
    <p>/**</p><br />
    <ul><br />
      <li>Move forward by one</li><br />
      <li>PHP’s next() returns false if there are no more elements<br />
 */<br />
 function next(){<br />
 $this-&gt;valid = (FALSE !== next($this-&gt;array));<br />
 }</li><br />
    </ul><br />
<br />
    <p>/**</p><br />
    <ul><br />
      <li>Is the current element valid?<br />
 */<br />
 function valid(){<br />
 return $this-&gt;valid;<br />
 }<br />
}</li><br />
    </ul><br />
  </li><br />
</ul><br />
<br />
<p>使用方法如下：</p><br />
<br />
<p>// Create iterator object<br />
$colors = new ArrayReloaded(array (‘red’,’green’,’blue’,));</p><br />
<br />
<p>// Iterate away!<br />
foreach ( $colors as $color ) {<br />
 echo $color.”<br />”;<br />
}</p><br />
<br />
<p>你也可以在foreach循环中使用key()方法：</p><br />
<br />
<p>// Display the keys as well<br />
foreach ( $colors as $key =&gt; $color ) {<br />
 echo “$key: $color<br />”;<br />
}</p><br />
<br />
<p>除了foreach循环外，也可以使用while循环，</p><br />
<br />
<p>// Reset the iterator - foreach does this automatically<br />
$colors-&gt;rewind();</p><br />
<br />
<p>// Loop while valid<br />
while ( $colors-&gt;valid() ) {</p><br />
<br />
<p>echo $colors-&gt;key().”: “.$colors-&gt;current().”<br />
“;<br />
   $colors-&gt;next();</p><br />
<br />
<p>}</p><br />
<br />
<p>根据测试，while循环要稍快于foreach循环，因为运行时少了一层中间调用。</p><br />
<br />
<ol><br />
  <li><br />
    <p>ArrayAccess界面<br />
部署ArrayAccess界面，可以使得object像array那样操作。ArrayAccess界面包含四个必须部署的方法：</p><br />
<br />
    <ul><br />
      <li><br />
        <p>offsetExists($offset)</p><br />
<br />
        <p>This method is used to tell php if there is a value<br />
for the key specified by offset. It should return <br />
true or false.</p><br />
      </li><br />
      <li><br />
        <p>offsetGet($offset)</p><br />
<br />
        <p>This method is used to return the value specified <br />
by the key offset.</p><br />
      </li><br />
      <li><br />
        <p>offsetSet($offset, $value)</p><br />
<br />
        <p>This method is used to set a value within the object, <br />
you can throw an exception from this function for a <br />
read-only collection.</p><br />
      </li><br />
      <li><br />
        <p>offsetUnset($offset)</p><br />
<br />
        <p>This method is used when a value is removed from <br />
an array either through unset() or assigning the key <br />
a value of null. In the case of numerical arrays, this <br />
offset should not be deleted and the array should <br />
not be reindexed unless that is specifically the <br />
behavior you want.</p><br />
      </li><br />
    </ul><br />
  </li><br />
</ol><br />
<br />
<p>下面就是一个部署ArrayAccess界面的实例：</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>A class that can be used like an array<br />
*/<br />
class Article implements ArrayAccess {</li><br />
</ul><br />
<br />
<p>public $title;</p><br />
<br />
<p>public $author;</p><br />
<br />
<p>public $category;</p><br />
<br />
<p>function __construct($title,$author,$category) {<br />
   $this-&gt;title = $title;<br />
   $this-&gt;author = $author;<br />
   $this-&gt;category = $category;<br />
 }</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>Defined by ArrayAccess interface</li><br />
  <li>Set a value given it’s key e.g. $A[‘title’] = ‘foo’;</li><br />
  <li>@param mixed key (string or integer)</li><br />
  <li>@param mixed value</li><br />
  <li>@return void<br />
 */<br />
 function offsetSet($key, $value) {<br />
if ( array_key_exists($key,get_object_vars($this)) ) {<br />
  $this-&gt;{$key} = $value;<br />
}<br />
 }</li><br />
</ul><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>Defined by ArrayAccess interface</li><br />
  <li>Return a value given it’s key e.g. echo $A[‘title’];</li><br />
  <li>@param mixed key (string or integer)</li><br />
  <li>@return mixed value<br />
 */<br />
 function offsetGet($key) {<br />
if ( array_key_exists($key,get_object_vars($this)) ) {<br />
  return $this-&gt;{$key};<br />
}<br />
 }</li><br />
</ul><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>Defined by ArrayAccess interface</li><br />
  <li>Unset a value by it’s key e.g. unset($A[‘title’]);</li><br />
  <li>@param mixed key (string or integer)</li><br />
  <li>@return void<br />
 */<br />
 function offsetUnset($key) {<br />
if ( array_key_exists($key,get_object_vars($this)) ) {<br />
  unset($this-&gt;{$key});<br />
}<br />
 }</li><br />
</ul><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>Defined by ArrayAccess interface</li><br />
  <li>Check value exists, given it’s key e.g. isset($A[‘title’])</li><br />
  <li>@param mixed key (string or integer)</li><br />
  <li>@return boolean<br />
 */<br />
 function offsetExists($offset) {<br />
return array_key_exists($offset,get_object_vars($this));<br />
 }</li><br />
</ul><br />
<br />
<p>}</p><br />
<br />
<p>使用方法如下：</p><br />
<br />
<p>// Create the object<br />
$A = new Article(‘SPL Rocks’,’Joe Bloggs’, ‘PHP’);</p><br />
<br />
<p>// Check what it looks like<br />
echo ‘Initial State:&lt;div&gt;’;<br />
print_r($A);<br />
echo ‘&lt;/div&gt;’;</p><br />
<br />
<p>// Change the title using array syntax<br />
$A[‘title’] = ‘SPL <em>really</em> rocks’;</p><br />
<br />
<p>// Try setting a non existent property (ignored)<br />
$A[‘not found’] = 1;</p><br />
<br />
<p>// Unset the author field<br />
unset($A[‘author’]);</p><br />
<br />
<p>// Check what it looks like again<br />
echo ‘Final State:&lt;div&gt;’;<br />
print_r($A);<br />
echo ‘&lt;/div&gt;’;</p><br />
<br />
<p>运行结果如下：</p><br />
<br />
<p>Initial State:</p><br />
<br />
<p>Article Object<br />
(<br />
   [title] =&gt; SPL Rocks<br />
   [author] =&gt; Joe Bloggs<br />
   [category] =&gt; PHP<br />
)</p><br />
<br />
<p>Final State:</p><br />
<br />
<p>Article Object<br />
(<br />
   [title] =&gt; SPL <em>really</em> rocks<br />
   [category] =&gt; PHP<br />
)</p><br />
<br />
<p>可以看到，$A虽然是一个object，但是完全可以像array那样操作。</p><br />
<br />
<p>你还可以在读取数据时，增加程序内部的逻辑：</p><br />
<br />
<p>function offsetGet($key) {<br />
   if ( array_key_exists($key,get_object_vars($this)) ) {<br />
     return strtolower($this-&gt;{$key});<br />
   }<br />
 }</p><br />
<br />
<ol><br />
  <li>IteratorAggregate界面</li><br />
</ol><br />
<br />
<p>但是，虽然$A可以像数组那样操作，却无法使用foreach遍历，除非部署了前面提到的Iterator界面。</p><br />
<br />
<p>另一个解决方法是，有时会需要将数据和遍历部分分开，这时就可以部署IteratorAggregate界面。它规定了一个getIterator()方法，返回一个使用Iterator界面的object。</p><br />
<br />
<p>还是以上一节的Article类为例：</p><br />
<br />
<p>class Article implements ArrayAccess, IteratorAggregate {</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>Defined by IteratorAggregate interface</li><br />
  <li>Returns an iterator for for this object, for use with foreach</li><br />
  <li>@return ArrayIterator<br />
 */<br />
 function getIterator() {<br />
return new ArrayIterator($this);<br />
 }</li><br />
</ul><br />
<br />
<p>使用方法如下：</p><br />
<br />
<p>$A = new Article(‘SPL Rocks’,’Joe Bloggs’, ‘PHP’);</p><br />
<br />
<p>// Loop (getIterator will be called automatically)<br />
echo ‘Looping with foreach:&lt;div&gt;’;<br />
foreach ( $A as $field =&gt; $value ) {<br />
 echo “$field : $value<br />”;<br />
}<br />
echo ‘&lt;/div&gt;’;</p><br />
<br />
<p>// Get the size of the iterator (see how many properties are left)<br />
echo “Object has “.sizeof($A-&gt;getIterator()).” elements”;</p><br />
<br />
<p>显示结果如下：</p><br />
<br />
<p>Looping with foreach:</p><br />
<br />
<p>title : SPL Rocks<br />
author : Joe Bloggs<br />
category : PHP</p><br />
<br />
<p>Object has 3 elements</p><br />
<br />
<ol><br />
  <li>RecursiveIterator界面</li><br />
</ol><br />
<br />
<p>这个界面用于遍历多层数据，它继承了Iterator界面，因而也具有标准的current()、key()、next()、 rewind()和valid()方法。同时，它自己还规定了getChildren()和hasChildren()方法。The getChildren() method must return an object that implements RecursiveIterator.</p><br />
<br />
<ol><br />
  <li>SeekableIterator界面</li><br />
</ol><br />
<br />
<p>SeekableIterator界面也是Iterator界面的延伸，除了Iterator的5个方法以外，还规定了seek()方法，参数是元素的位置，返回该元素。如果该位置不存在，则抛出OutOfBoundsException。</p><br />
<br />
<p>下面是一个是实例：</p><br />
<br />
<p>&lt;?php</p><br />
<br />
<p>class PartyMemberIterator implements SeekableIterator<br />
{<br />
    public function __construct(PartyMember $member)<br />
    {<br />
        // Store $member locally for iteration<br />
    }</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public function seek($index)<br />
{<br />
    $this-&gt;rewind();<br />
    $position = 0;<br />
<br />
    while ($position &lt; $index &amp;&amp; $this-&gt;valid()) {<br />
        $this-&gt;next();<br />
        $position++;<br />
    }<br />
<br />
    if (!$this-&gt;valid()) {<br />
        throw new OutOfBoundsException('Invalid position');<br />
    }<br />
}<br />
<br />
// Implement current(), key(), next(), rewind()<br />
// and valid() to iterate over data in $member }<br />
</code></pre></div></div><br />
<br />
<p>?&gt;</p><br />
<br />
<ol><br />
  <li>Countable界面</li><br />
</ol><br />
<br />
<p>这个界面规定了一个count()方法，返回结果集的数量。</p><br />
<br />
<p>第三部分 SPL Classes</p><br />
<br />
<ol><br />
  <li>SPL的内置类</li><br />
</ol><br />
<br />
<p>SPL除了定义一系列Interfaces以外，还提供一系列的内置类，它们对应不同的任务，大大简化了编程。</p><br />
<br />
<p>查看所有的内置类，可以使用下面的代码：</p><br />
<br />
<p>&lt;?php<br />
// a simple foreach() to traverse the SPL class names<br />
foreach(spl_classes() as $key=&gt;$value)<br />
        {<br />
        echo $key.’ -&gt; ‘.$value.’<br />’;<br />
        }<br />
?&gt;</p><br />
<br />
<ol><br />
  <li>DirectoryIterator类</li><br />
</ol><br />
<br />
<p>这个类用来查看一个目录中的所有文件和子目录：</p><br />
<br />
<p>&lt;?php</p><br />
<br />
<p>try{<br />
  /<strong>* class create new DirectoryIterator Object **<em>/<br />
    foreach ( new DirectoryIterator(‘./’) as $Item )<br />
        {<br />
        echo $Item.’<br />’;<br />
        }<br />
    }<br />
/</em></strong> if an exception is thrown, catch it here ***/<br />
catch(Exception $e){<br />
    echo ‘No files Found!<br />’;<br />
}<br />
?&gt;</p><br />
<br />
<p>查看文件的详细信息：</p><br />
<br />
<table><br />
<?php<br />
<br />
foreach(new DirectoryIterator('./' ) as $file )<br />
    {<br />
    if( $file->getFilename()  == 'foo.txt' )<br />
        {<br />
        echo '<tr><td>getFilename()</td><td> '; var_dump($file->getFilename()); echo '</td></tr>';<br />
    echo '<tr><td>getBasename()</td><td> '; var_dump($file->getBasename()); echo '</td></tr>';<br />
        echo '<tr><td>isDot()</td><td> '; var_dump($file->isDot()); echo '</td></tr>';<br />
        echo '<tr><td>__toString()</td><td> '; var_dump($file->__toString()); echo '</td></tr>';<br />
        echo '<tr><td>getPath()</td><td> '; var_dump($file->getPath()); echo '</td></tr>';<br />
        echo '<tr><td>getPathname()</td><td> '; var_dump($file->getPathname()); echo '</td></tr>';<br />
        echo '<tr><td>getPerms()</td><td> '; var_dump($file->getPerms()); echo '</td></tr>';<br />
        echo '<tr><td>getInode()</td><td> '; var_dump($file->getInode()); echo '</td></tr>';<br />
        echo '<tr><td>getSize()</td><td> '; var_dump($file->getSize()); echo '</td></tr>';<br />
        echo '<tr><td>getOwner()</td><td> '; var_dump($file->getOwner()); echo '</td></tr>';<br />
        echo '<tr><td>$file->getGroup()</td><td> '; var_dump($file->getGroup()); echo '</td></tr>';<br />
        echo '<tr><td>getATime()</td><td> '; var_dump($file->getATime()); echo '</td></tr>';<br />
        echo '<tr><td>getMTime()</td><td> '; var_dump($file->getMTime()); echo '</td></tr>';<br />
        echo '<tr><td>getCTime()</td><td> '; var_dump($file->getCTime()); echo '</td></tr>';<br />
        echo '<tr><td>getType()</td><td> '; var_dump($file->getType()); echo '</td></tr>';<br />
        echo '<tr><td>isWritable()</td><td> '; var_dump($file->isWritable()); echo '</td></tr>';<br />
        echo '<tr><td>isReadable()</td><td> '; var_dump($file->isReadable()); echo '</td></tr>';<br />
        echo '<tr><td>isExecutable(</td><td> '; var_dump($file->isExecutable()); echo '</td></tr>';<br />
        echo '<tr><td>isFile()</td><td> '; var_dump($file->isFile()); echo '</td></tr>';<br />
        echo '<tr><td>isDir()</td><td> '; var_dump($file->isDir()); echo '</td></tr>';<br />
        echo '<tr><td>isLink()</td><td> '; var_dump($file->isLink()); echo '</td></tr>';<br />
        echo '<tr><td>getFileInfo()</td><td> '; var_dump($file->getFileInfo()); echo '</td></tr>';<br />
        echo '<tr><td>getPathInfo()</td><td> '; var_dump($file->getPathInfo()); echo '</td></tr>';<br />
        echo '<tr><td>openFile()</td><td> '; var_dump($file->openFile()); echo '</td></tr>';<br />
        echo '<tr><td>setFileClass()</td><td> '; var_dump($file->setFileClass()); echo '</td></tr>';<br />
        echo '<tr><td>setInfoClass()</td><td> '; var_dump($file->setInfoClass()); echo '</td></tr>';<br />
        }<br />
}<br />
?><br />
</table><br />
<br />
<p>除了foreach循环外，还可以使用while循环：</p><br />
<br />
<p>&lt;?php<br />
/<em>** create a new iterator object **</em>/<br />
$it = new DirectoryIterator(‘./’);</p><br />
<br />
<p>/<strong>* loop directly over the object **<em>/<br />
while($it-&gt;valid())<br />
    {<br />
    echo $it-&gt;key().’ – ‘.$it-&gt;current().’<br />’;<br />
    /</em></strong> move to the next iteration ***/<br />
    $it-&gt;next();<br />
    }<br />
?&gt;</p><br />
<br />
<p>如果要过滤所有子目录，可以在valid()方法中过滤：</p><br />
<br />
<p>&lt;?php<br />
/<em>** create a new iterator object **</em>/<br />
$it = new DirectoryIterator(‘./’);</p><br />
<br />
<p>/<strong>* loop directly over the object **<em>/<br />
while($it-&gt;valid())<br />
        {<br />
        /</em></strong> check if value is a directory <strong><em>/<br />
        if($it-&gt;isDir())<br />
                {<br />
                /</em></strong> echo the key and current value <strong><em>/<br />
                echo $it-&gt;key().’ – ‘.$it-&gt;current().’<br />’;<br />
                }<br />
        /</em></strong> move to the next iteration ***/<br />
        $it-&gt;next();<br />
        }<br />
?&gt;</p><br />
<br />
<ol><br />
  <li>ArrayObject类</li><br />
</ol><br />
<br />
<p>这个类可以将Array转化为object。</p><br />
<br />
<p>&lt;?php</p><br />
<br />
<p>/<em>** a simple array **</em>/<br />
$array = array(‘koala’, ‘kangaroo’, ‘wombat’, ‘wallaby’, ‘emu’, ‘kiwi’, ‘kookaburra’, ‘platypus’);</p><br />
<br />
<p>/<em>** create the array object **</em>/<br />
$arrayObj = new ArrayObject($array);</p><br />
<br />
<p>/<strong>* iterate over the array **<em>/<br />
for($iterator = $arrayObj-&gt;getIterator();<br />
   /</em></strong> check if valid <strong><em>/<br />
   $iterator-&gt;valid();<br />
   /</em></strong> move to the next array member <strong><em>/<br />
   $iterator-&gt;next())<br />
    {<br />
    /</em></strong> output the key and current array value ***/<br />
    echo $iterator-&gt;key() . ‘ =&gt; ‘ . $iterator-&gt;current() . ‘<br />’;<br />
    }<br />
?&gt;</p><br />
<br />
<p>增加一个元素：</p><br />
<br />
<p>$arrayObj-&gt;append(‘dingo’);</p><br />
<br />
<p>对元素排序：</p><br />
<br />
<p>$arrayObj-&gt;natcasesort();</p><br />
<br />
<p>显示元素的数量：</p><br />
<br />
<p>echo $arrayObj-&gt;count();</p><br />
<br />
<p>删除一个元素：</p><br />
<br />
<p>$arrayObj-&gt;offsetUnset(5);</p><br />
<br />
<p>某一个元素是否存在：</p><br />
<br />
<p>if ($arrayObj-&gt;offsetExists(3))<br />
    {<br />
       echo ‘Offset Exists<br />’;<br />
    }</p><br />
<br />
<p>更改某个位置的元素值：</p><br />
<br />
<p>$arrayObj-&gt;offsetSet(5, “galah”);</p><br />
<br />
<p>显示某个位置的元素值：</p><br />
<br />
<p>echo $arrayObj-&gt;offsetGet(4);</p><br />
<br />
<ol><br />
  <li>ArrayIterator类<br />
这个类实际上是对ArrayObject类的补充，为后者提供遍历功能。</li><br />
</ol><br />
<br />
<p>示例如下：</p><br />
<br />
<p>&lt;?php<br />
/<em>** a simple array **</em>/<br />
$array = array(‘koala’, ‘kangaroo’, ‘wombat’, ‘wallaby’, ‘emu’, ‘kiwi’, ‘kookaburra’, ‘platypus’);</p><br />
<br />
<p>try {<br />
    $object = new ArrayIterator($array);<br />
    foreach($object as $key=&gt;$value)<br />
        {<br />
        echo $key.’ =&gt; ‘.$value.’<br />’;<br />
        }<br />
    }<br />
catch (Exception $e)<br />
    {<br />
    echo $e-&gt;getMessage();<br />
    }<br />
?&gt;</p><br />
<br />
<p>ArrayIterator类也支持offset类方法和count()方法：</p><br />
<br />
<ul><br />
<?php<br />
/*** a simple array ***/<br />
$array = array('koala', 'kangaroo', 'wombat', 'wallaby', 'emu', 'kiwi', 'kookaburra', 'platypus');<br />
<br />
try {<br />
    $object = new ArrayIterator($array);<br />
    /*** check for the existence of the offset 2 ***/<br />
    if($object->offSetExists(2))<br />
    {<br />
    /*** set the offset of 2 to a new value ***/<br />
    $object->offSetSet(2, 'Goanna');<br />
    }<br />
   /*** unset the kiwi ***/<br />
   foreach($object as $key=>$value)<br />
        {<br />
        /*** check the value of the key ***/<br />
        if($object->offSetGet($key) === 'kiwi')<br />
            {<br />
            /*** unset the current key ***/<br />
            $object->offSetUnset($key);<br />
            }<br />
        echo '<li>'.$key.' - '.$value.'</li>'."\n";<br />
        }<br />
    }<br />
catch (Exception $e)<br />
    {<br />
    echo $e->getMessage();<br />
    }<br />
?><br />
</ul><br />
<br />
<ol><br />
  <li>RecursiveArrayIterator类和RecursiveIteratorIterator类</li><br />
</ol><br />
<br />
<p>ArrayIterator类和ArrayObject类，只支持遍历一维数组。如果要遍历多维数组，必须先用RecursiveIteratorIterator生成一个Iterator，然后再对这个Iterator使用RecursiveIteratorIterator。</p><br />
<br />
<p>&lt;?php<br />
$array = array(<br />
    array(‘name’=&gt;’butch’, ‘sex’=&gt;’m’, ‘breed’=&gt;’boxer’),<br />
    array(‘name’=&gt;’fido’, ‘sex’=&gt;’m’, ‘breed’=&gt;’doberman’),<br />
    array(‘name’=&gt;’girly’,’sex’=&gt;’f’, ‘breed’=&gt;’poodle’)<br />
);</p><br />
<br />
<p>foreach(new RecursiveIteratorIterator(new RecursiveArrayIterator($array)) as $key=&gt;$value)<br />
    {<br />
    echo $key.’ – ‘.$value.’<br />’;<br />
    }<br />
?&gt;</p><br />
<br />
<ol><br />
  <li>FilterIterator类</li><br />
</ol><br />
<br />
<p>FilterIterator类可以对元素进行过滤，只要在accept()方法中设置过滤条件就可以了。</p><br />
<br />
<p>示例如下：</p><br />
<br />
<p>&lt;?php<br />
/<em>** a simple array **</em>/<br />
$animals = array(‘koala’, ‘kangaroo’, ‘wombat’, ‘wallaby’, ‘emu’, ‘NZ’=&gt;’kiwi’, ‘kookaburra’, ‘platypus’);</p><br />
<br />
<p>class CullingIterator extends FilterIterator{</p><br />
<br />
<p>/<em>** The filteriterator takes  a iterator as param: **</em>/<br />
public function __construct( Iterator $it ){<br />
  parent::__construct( $it );<br />
}</p><br />
<br />
<p>/<em>** check if key is numeric **</em>/<br />
function accept(){<br />
  return is_numeric($this-&gt;key());<br />
}</p><br />
<br />
<p>}/<em>** end of class **</em>/<br />
$cull = new CullingIterator(new ArrayIterator($animals));</p><br />
<br />
<p>foreach($cull as $key=&gt;$value)<br />
    {<br />
    echo $key.’ == ‘.$value.’<br />’;<br />
    }<br />
?&gt;</p><br />
<br />
<p>下面是另一个返回质数的例子：</p><br />
<br />
<p>&lt;?php</p><br />
<br />
<p>class PrimeFilter extends FilterIterator{</p><br />
<br />
<p>/<em>** The filteriterator takes  a iterator as param: **</em>/<br />
public function __construct(Iterator $it){<br />
  parent::__construct($it);<br />
}</p><br />
<br />
<p>/<em>** check if current value is prime **</em>/<br />
function accept(){<br />
if($this-&gt;current() % 2 != 1)<br />
    {<br />
    return false;<br />
    }<br />
$d = 3;<br />
$x = sqrt($this-&gt;current());<br />
while ($this-&gt;current() % $d != 0 &amp;&amp; $d &lt; $x)<br />
    {<br />
    $d += 2;<br />
    }<br />
 return (($this-&gt;current() % $d == 0 &amp;&amp; $this-&gt;current() != $d) * 1) == 0 ? true : false;<br />
}</p><br />
<br />
<p>}/<em>** end of class **</em>/</p><br />
<br />
<p>/<em>** an array of numbers **</em>/<br />
$numbers = range(212345,212456);</p><br />
<br />
<p>/<em>** create a new FilterIterator object **</em>/<br />
$primes = new primeFilter(new ArrayIterator($numbers));</p><br />
<br />
<p>foreach($primes as $value)<br />
    {<br />
    echo $value.’ is prime.<br />’;<br />
    }<br />
?&gt;</p><br />
<br />
<ol><br />
  <li>SimpleXMLIterator类</li><br />
</ol><br />
<br />
<p>这个类用来遍历xml文件。</p><br />
<br />
<p>示例如下：</p><br />
<br />
<p>&lt;?php</p><br />
<br />
<p>/<em>** a simple xml tree **</em>/<br />
 $xmlstring = «&lt;XML<br />
&lt;?xml version = “1.0” encoding=”UTF-8” standalone=”yes”?&gt;</p><br />
<document><br />
  <animal><br />
    <category id="26"><br />
      <species>Phascolarctidae</species><br />
      <type>koala</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="27"><br />
      <species>macropod</species><br />
      <type>kangaroo</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="28"><br />
      <species>diprotodon</species><br />
      <type>wombat</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="31"><br />
      <species>macropod</species><br />
      <type>wallaby</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="21"><br />
      <species>dromaius</species><br />
      <type>emu</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="22"><br />
      <species>Apteryx</species><br />
      <type>kiwi</type><br />
      <name>Troy</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="23"><br />
      <species>kingfisher</species><br />
      <type>kookaburra</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="48"><br />
      <species>monotremes</species><br />
      <type>platypus</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="4"><br />
      <species>arachnid</species><br />
      <type>funnel web</type><br />
      <name>Bruce</name><br />
      <legs>8</legs><br />
    </category><br />
  </animal><br />
</document><br />
<p>XML;</p><br />
<br />
<p>/<strong>* a new simpleXML iterator object **<em>/<br />
try    {<br />
       /</em></strong> a new simple xml iterator <strong><em>/<br />
       $it = new SimpleXMLIterator($xmlstring);<br />
       /</em></strong> a new limitIterator object ***/<br />
       foreach(new RecursiveIteratorIterator($it,1) as $name =&gt; $data)<br />
          {<br />
          echo $name.’ – ‘.$data.’<br />’;<br />
          }<br />
    }<br />
catch(Exception $e)<br />
    {<br />
    echo $e-&gt;getMessage();<br />
    }<br />
?&gt;</p><br />
<br />
<p>new RecursiveIteratorIterator($it,1)表示显示所有包括父元素在内的子元素。</p><br />
<br />
<p>显示某一个特定的元素值，可以这样写：</p><br />
<br />
<p>&lt;?php<br />
try {<br />
    /<em>** a new simpleXML iterator object **</em>/<br />
    $sxi =  new SimpleXMLIterator($xmlstring);</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foreach ( $sxi as $node )<br />
    {<br />
    foreach($node as $k=&gt;$v)<br />
        {<br />
        echo $v-&gt;species.'&lt;br /&gt;';<br />
        }<br />
    }<br />
} catch(Exception $e)<br />
{<br />
echo $e-&gt;getMessage();<br />
} ?&gt;<br />
</code></pre></div></div><br />
<br />
<p>相对应的while循环写法为：</p><br />
<br />
<p>&lt;?php</p><br />
<br />
<p>try {<br />
$sxe = simplexml_load_string($xmlstring, ‘SimpleXMLIterator’);</p><br />
<br />
<p>for ($sxe-&gt;rewind(); $sxe-&gt;valid(); $sxe-&gt;next())<br />
    {<br />
    if($sxe-&gt;hasChildren())<br />
        {<br />
        foreach($sxe-&gt;getChildren() as $element=&gt;$value)<br />
          {<br />
          echo $value-&gt;species.’<br />’;<br />
          }<br />
        }<br />
     }<br />
   }<br />
catch(Exception $e)<br />
   {<br />
   echo $e-&gt;getMessage();<br />
   }<br />
?&gt;</p><br />
<br />
<p>最方便的写法，还是使用xpath：</p><br />
<br />
<p>&lt;?php<br />
try {<br />
    /<em>** a new simpleXML iterator object **</em>/<br />
    $sxi =  new SimpleXMLIterator($xmlstring);</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*** set the xpath ***/<br />
$foo = $sxi-&gt;xpath('animal/category/species');<br />
<br />
/*** iterate over the xpath ***/<br />
foreach ($foo as $k=&gt;$v)<br />
    {<br />
    echo $v.'&lt;br /&gt;';<br />
    }<br />
} catch(Exception $e)<br />
{<br />
echo $e-&gt;getMessage();<br />
} ?&gt;<br />
</code></pre></div></div><br />
<br />
<p>下面的例子，显示有namespace的情况：</p><br />
<br />
<p>&lt;?php</p><br />
<br />
<p>/<em>** a simple xml tree **</em>/<br />
 $xmlstring = «&lt;XML<br />
&lt;?xml version = “1.0” encoding=”UTF-8” standalone=”yes”?&gt;</p><br />
<document xmlns:spec="http://example.org/animal-species"><br />
  <animal><br />
    <category id="26"><br />
      <species>Phascolarctidae</species><br />
      <spec:name>Speed Hump</spec:name><br />
      <type>koala</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="27"><br />
      <species>macropod</species><br />
      <spec:name>Boonga</spec:name><br />
      <type>kangaroo</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="28"><br />
      <species>diprotodon</species><br />
      <spec:name>pot holer</spec:name><br />
      <type>wombat</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="31"><br />
      <species>macropod</species><br />
      <spec:name>Target</spec:name><br />
      <type>wallaby</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="21"><br />
      <species>dromaius</species><br />
      <spec:name>Road Runner</spec:name><br />
      <type>emu</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="22"><br />
      <species>Apteryx</species><br />
      <spec:name>Football</spec:name><br />
      <type>kiwi</type><br />
      <name>Troy</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="23"><br />
      <species>kingfisher</species><br />
      <spec:name>snaker</spec:name><br />
      <type>kookaburra</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="48"><br />
      <species>monotremes</species><br />
      <spec:name>Swamp Rat</spec:name><br />
      <type>platypus</type><br />
      <name>Bruce</name><br />
    </category><br />
  </animal><br />
  <animal><br />
    <category id="4"><br />
      <species>arachnid</species><br />
      <spec:name>Killer</spec:name><br />
      <type>funnel web</type><br />
      <name>Bruce</name><br />
      <legs>8</legs><br />
    </category><br />
  </animal><br />
</document><br />
<p>XML;</p><br />
<br />
<p>/<strong>* a new simpleXML iterator object **<em>/<br />
try {<br />
    /</em></strong> a new simpleXML iterator object ***/<br />
    $sxi =  new SimpleXMLIterator($xmlstring);</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$sxi-&gt; registerXPathNamespace('spec', 'http://www.exampe.org/species-title');<br />
<br />
/*** set the xpath ***/<br />
$result = $sxi-&gt;xpath('//spec:name');<br />
<br />
/*** get all declared namespaces ***/    foreach($sxi-&gt;getDocNamespaces('animal') as $ns)<br />
    {<br />
    echo $ns.'&lt;br /&gt;';<br />
    }<br />
<br />
/*** iterate over the xpath ***/<br />
foreach ($result as $k=&gt;$v)<br />
    {<br />
    echo $v.'&lt;br /&gt;';<br />
    }<br />
} catch(Exception $e)<br />
{<br />
echo $e-&gt;getMessage();<br />
} ?&gt;<br />
</code></pre></div></div><br />
<br />
<p>增加一个节点：</p><br />
<br />
<p>&lt;?php <br />
 $xmlstring = «&lt;XML<br />
&lt;?xml version = “1.0” encoding=”UTF-8” standalone=”yes”?&gt;</p><br />
<document><br />
  <animal>koala</animal><br />
  <animal>kangaroo</animal><br />
  <animal>wombat</animal><br />
  <animal>wallaby</animal><br />
  <animal>emu</animal><br />
  <animal>kiwi</animal><br />
  <animal>kookaburra</animal><br />
  <animal>platypus</animal><br />
  <animal>funnel web</animal><br />
</document><br />
<p>XML;</p><br />
<br />
<p>try {<br />
    /<em>** a new simpleXML iterator object **</em>/<br />
    $sxi =  new SimpleXMLIterator($xmlstring);</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*** add a child ***/<br />
$sxi-&gt;addChild('animal', 'Tiger');<br />
<br />
/*** a new simpleXML iterator object ***/<br />
$new = new SimpleXmlIterator($sxi-&gt;saveXML());<br />
<br />
/*** iterate over the new tree ***/<br />
foreach($new as $val)<br />
    {<br />
    echo $val.'&lt;br /&gt;';<br />
    }<br />
} catch(Exception $e)<br />
{<br />
echo $e-&gt;getMessage();<br />
} ?&gt;<br />
</code></pre></div></div><br />
<br />
<p>增加属性：</p><br />
<br />
<p>&lt;?php <br />
$xmlstring =«&lt;XML<br />
&lt;?xml version = “1.0” encoding=”UTF-8” standalone=”yes”?&gt;</p><br />
<document><br />
  <animal>koala</animal><br />
  <animal>kangaroo</animal><br />
  <animal>wombat</animal><br />
  <animal>wallaby</animal><br />
  <animal>emu</animal><br />
  <animal>kiwi</animal><br />
  <animal>kookaburra</animal><br />
  <animal>platypus</animal><br />
  <animal>funnel web</animal><br />
</document><br />
<p>XML;</p><br />
<br />
<p>try {<br />
    /<em>** a new simpleXML iterator object **</em>/<br />
    $sxi =  new SimpleXMLIterator($xmlstring);</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*** add an attribute with a namespace ***/<br />
$sxi-&gt;addAttribute('id:att1', 'good things', 'urn::test-foo');<br />
<br />
/*** add an attribute without a  namespace ***/<br />
$sxi-&gt;addAttribute('att2', 'no-ns');<br />
<br />
echo htmlentities($sxi-&gt;saveXML());<br />
} catch(Exception $e)<br />
{<br />
echo $e-&gt;getMessage();<br />
} ?&gt;<br />
</code></pre></div></div><br />
<br />
<ol><br />
  <li>CachingIterator类</li><br />
</ol><br />
<br />
<p>这个类有一个hasNext()方法，用来判断是否还有下一个元素。</p><br />
<br />
<p>示例如下：</p><br />
<br />
<p>&lt;?php<br />
/<em>** a simple array **</em>/<br />
$array = array(‘koala’, ‘kangaroo’, ‘wombat’, ‘wallaby’, ‘emu’, ‘kiwi’, ‘kookaburra’, ‘platypus’);</p><br />
<br />
<p>try {<br />
    /<em>** create a new object **</em>/<br />
    $object = new CachingIterator(new ArrayIterator($array));<br />
    foreach($object as $value)<br />
        {<br />
        echo $value;<br />
        if($object-&gt;hasNext())<br />
            {<br />
            echo ‘,’;<br />
            }<br />
        }<br />
    }<br />
catch (Exception $e)<br />
    {<br />
    echo $e-&gt;getMessage();<br />
    }<br />
?&gt;</p><br />
<br />
<ol><br />
  <li>LimitIterator类</li><br />
</ol><br />
<br />
<p>这个类用来限定返回结果集的数量和位置，必须提供offset和limit两个参数，与SQL命令中limit语句类似。</p><br />
<br />
<p>示例如下：</p><br />
<br />
<p>&lt;?php<br />
/<em>** the offset value **</em>/<br />
$offset = 3;</p><br />
<br />
<p>/<em>** the limit of records to show **</em>/<br />
$limit = 2;</p><br />
<br />
<p>$array = array(‘koala’, ‘kangaroo’, ‘wombat’, ‘wallaby’, ‘emu’, ‘kiwi’, ‘kookaburra’, ‘platypus’);</p><br />
<br />
<p>$it = new LimitIterator(new ArrayIterator($array), $offset, $limit);</p><br />
<br />
<p>foreach($it as $k=&gt;$v)<br />
    {<br />
    echo $it-&gt;getPosition().’<br />’;<br />
    }<br />
?&gt;</p><br />
<br />
<p>另一个例子是：</p><br />
<br />
<p>&lt;?php</p><br />
<br />
<p>/<em>** a simple array **</em>/<br />
$array = array(‘koala’, ‘kangaroo’, ‘wombat’, ‘wallaby’, ‘emu’, ‘kiwi’, ‘kookaburra’, ‘platypus’);</p><br />
<br />
<p>$it = new LimitIterator(new ArrayIterator($array));</p><br />
<br />
<p>try<br />
    {<br />
    $it-&gt;seek(5);<br />
    echo $it-&gt;current();<br />
    }<br />
catch(OutOfBoundsException $e)<br />
    {<br />
    echo $e-&gt;getMessage() . “<br />”;<br />
    }<br />
?&gt;</p><br />
<br />
<ol><br />
  <li>SplFileObject类</li><br />
</ol><br />
<br />
<p>这个类用来对文本文件进行遍历。</p><br />
<br />
<p>示例如下：</p><br />
<br />
<p>&lt;?php</p><br />
<br />
<p>try{<br />
    // iterate directly over the object<br />
    foreach( new SplFileObject("/usr/local/apache/logs/access_log") as $line)<br />
    // and echo each line of the file<br />
    echo $line.’<br />’;<br />
}<br />
catch (Exception $e)<br />
    {<br />
    echo $e-&gt;getMessage();<br />
    }<br />
?&gt;</p><br />
<br />
<p>返回文本文件的第三行，可以这样写：</p><br />
<br />
<p>&lt;?php</p><br />
<br />
<p>try{<br />
    $file = new SplFileObject(“/usr/local/apache/logs/access_log”);</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$file-&gt;seek(3);<br />
<br />
echo $file-&gt;current();<br />
    } catch (Exception $e)<br />
{<br />
echo $e-&gt;getMessage();<br />
} ?&gt;<br />
</code></pre></div></div><br />
<br />
<p>[参考文献]</p><br />
<br />
<ol><br />
  <li><br />
    <p>Introduction to Standard PHP Library (SPL), By Kevin Waterson</p><br />
  </li><br />
  <li><br />
    <p>Introducing PHP 5’s Standard Library, By Harry Fuecks</p><br />
  </li><br />
  <li><br />
    <p>The Standard PHP Library (SPL), By Ben Ramsey</p><br />
  </li><br />
  <li><br />
    <p>SPL - Standard PHP Library Documentation</p><br />
  </li><br />
</ol><br />
<br />
<p>http://www.ruanyifeng.com/blog/2008/07/php_spl_notes.html</p><br />
<br />
<p>SPL，PHP 标准库（Standard PHP Library） ，从 PHP 5.0 起内置的组件和接口，并且从 PHP5.3 已逐渐的成熟。SPL 其实在所有的 PHP5 开发环境中被内置，同时无需任何设置。</p><br />
<br />
<p>似乎众多的 PHP 开发人员基本没有使用它，甚至闻所未闻。究其原因，可以追述到它那阳春白雪般的说明文档，使你忽略了「它的存在」。SPL 这块宝石犹如铁达尼的「海洋之心」般，被沉入海底。而现在它应该被我们捞起，并将它穿戴在应有的位置 ，而这也是这篇文章所要表述的观点。</p><br />
<br />
<p>那么，SPL 提供了什么？</p><br />
<br />
<p>SPL 对 PHP 引擎进行了扩展，例如 ArrayAccess、Countable 和 SeekableIterator 等接口，它们用于以数组形式操作对象。同时，你还可以使用 RecursiveIterator、ArrayObejcts 等其他迭代器进行数据的迭代操作。</p><br />
<br />
<p>它还内置几个的对象例如 Exceptions、SplObserver、Spltorage 以及 splautoloadregister、splclasses、iteratorapply 等的帮助函数（helper functions），用于重载对应的功能。</p><br />
<br />
<p>这些工具聚合在一起就好比是把多功能的瑞士军刀，善用它们可以从质上提升 PHP 的代码效率。那么，我们如何发挥它的威力？</p><br />
<br />
<p>重载 autoloader</p><br />
<br />
<p>如果你是位「教科书式的程序员」，那么你保证了解如何使用 __autoload 去代替 includes/requires 操作惰性载入对应的类，对不？</p><br />
<br />
<p>但久之，你会发现你已经陷入了困境，首先是你要保证你的类文件必须在指定的文件路径中，例如在 Zend 框架中你必须使用「_」来分割类、方法名称（你如何解决这一问题？）。</p><br />
<br />
<p>另外的一个问题，就是当项目变得越来越复杂， __autoload内的逻辑也会变得相应的复杂。到最后，甚至你会加入异常判断，以及将所有的载入类的逻辑如数写到其中。</p><br />
<br />
<p>大家都知道「鸡蛋不能放到一个篮子中」，利用 SPL 可以分离 __autoload的载入逻辑。只需要写个你自己的 autoload 函数，然后利用 SPL 提供的函数重载它。</p><br />
<br />
<p>例如上述 Zend 框架的问题，你可以重载 Zend loader 对应的方法，如果它没有找到对应的类，那么就使用你先前定义的函数。</p><br />
<br />
<p>PHP SPL标准库-接口<br />
PHP SPL标准库有一下接口：</p><br />
<br />
<p>Countable<br />
OuterIterator <br />
RecursiveIterator <br />
SeekableIterator<br />
SplObserver <br />
SplSubject<br />
ArrayObject<br />
其中OuterIterator、RecursiveIterator、SeekableIterator都是继承Iterator类的。</p><br />
<br />
<p>Coutable接口：<br />
实现Coutable接口的对象可用于 count() 函数计数。</p><br />
<br />
<p>class Mycount implements Countable<br />
{<br />
    public function count()<br />
    {<br />
        static $count = 0;<br />
        $count++;<br />
        return $count;<br />
    }<br />
}</p><br />
<br />
<p>$count = new Mycount();<br />
$count-&gt;count();<br />
$count-&gt;count();</p><br />
<br />
<p>echo count($count); //3<br />
echo count($count); //4<br />
说明：</p><br />
<br />
<p>调用 count() 函数时，Mycount::count() 方法被调用，count() 函数的第二个参数将不会产生影响。</p><br />
<br />
<p>OuterIterator接口：<br />
它是自定义或修改迭代过程。</p><br />
<br />
<p>// IteratorIterator是OuterIterator的一个实现类<br />
class MyOuterIterator extends  IteratorIterator {<br />
    public function current()<br />
    {<br />
        return parent::current() . ‘TEST’;<br />
    }<br />
}</p><br />
<br />
<p>foreach(new MyOuterIterator(new ArrayIterator([‘b’,’a’,’c’])) as $key =&gt; $value) {<br />
    echo “$key-&gt;$value”.PHP_EOL;<br />
}</p><br />
<br />
<p>/*<br />
结果：<br />
0-&gt;bTEST<br />
1-&gt;aTEST<br />
2-&gt;cTEST<br />
*/<br />
在实际应用中，OuterIterator非常有用：</p><br />
<br />
<p>$db = new PDO(‘mysql:host=localhost;dbname=test’, ‘root’, ‘mckee’);<br />
$db-&gt;query(‘set names utf8’);<br />
$pdoStatement = $db-&gt;query(‘SELECT * FROM test1’, PDO::FETCH_ASSOC);<br />
$iterator = new IteratorIterator($pdoStatement);<br />
$tenRecordArray = iterator_to_array($iterator);<br />
print_r($tenRecordArray);<br />
RecursiveIterator接口：<br />
用于循环迭代多层结构的数据，RecursiveIterator另外提供了两个方法：</p><br />
<br />
<p>RecursiveIterator::getChildren：获取当前元素下子迭代器</p><br />
<br />
<p>RecursiveIterator::hasChildren：判断当前元素下是否有迭代器<br />
class MyRecursiveIterator implements RecursiveIterator<br />
{<br />
    private $_data;<br />
    private $_position = 0;</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public function __construct(array $data) {<br />
    $this-&gt;_data = $data;<br />
}<br />
  <br />
public function valid() {<br />
    return isset($this-&gt;_data[$this-&gt;_position]);<br />
}<br />
  <br />
public function hasChildren() {<br />
    return is_array($this-&gt;_data[$this-&gt;_position]);<br />
}<br />
  <br />
public function next() {<br />
    $this-&gt;_position++;<br />
}<br />
  <br />
public function current() {<br />
    return $this-&gt;_data[$this-&gt;_position];<br />
}<br />
  <br />
public function getChildren() {<br />
    print_r($this-&gt;_data[$this-&gt;_position]);<br />
}<br />
  <br />
public function rewind() {<br />
    $this-&gt;_position = 0;<br />
}<br />
  <br />
public function key() {<br />
    return $this-&gt;_position;<br />
} }<br />
</code></pre></div></div><br />
<br />
<p>$arr = array(0, 1=&gt; array(10, 20), 2, 3 =&gt; array(1, 2));<br />
$mri = new MyRecursiveIterator($arr);</p><br />
<br />
<p>foreach ($mri as $c =&gt; $v) {<br />
    if ($mri-&gt;hasChildren()) {<br />
        echo “$c has children: “ .PHP_EOL;<br />
        $mri-&gt;getChildren();<br />
    } else {<br />
        echo “$v” .PHP_EOL;<br />
    }<br />
}<br />
输出结果：<br />
0<br />
1 has children:<br />
Array<br />
(<br />
    [0] =&gt; 10<br />
    [1] =&gt; 20<br />
)<br />
2<br />
3 has children:<br />
Array<br />
(<br />
    [0] =&gt; 1<br />
    [1] =&gt; 2<br />
)<br />
SeekableIterator接口：<br />
通过 seek() 方法实现可搜索的迭代器，用于搜索某个位置下的元素。</p><br />
<br />
<p>class  MySeekableIterator  implements  SeekableIterator  {<br />
    private  $position = 0;</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private  $array  = array(<br />
    "first element" ,<br />
    "second element" ,<br />
    "third element" ,<br />
    "fourth element"<br />
);<br />
 <br />
public function  seek ( $position ) {<br />
    if (!isset( $this -&gt; array [ $position ])) {<br />
        throw new  OutOfBoundsException ( "invalid seek position ( $position )" );<br />
    }<br />
  <br />
   $this -&gt; position  =  $position ;<br />
}<br />
  <br />
public function  rewind () {<br />
    $this -&gt; position  =  0 ;<br />
}<br />
  <br />
public function  current () {<br />
    return  $this -&gt; array [ $this -&gt; position ];<br />
}<br />
  <br />
public function  key () {<br />
    return  $this -&gt; position ;<br />
}<br />
  <br />
public function  next () {<br />
    ++ $this -&gt; position ;<br />
}<br />
  <br />
public function  valid () {<br />
    return isset( $this -&gt; array [ $this -&gt; position ]);<br />
} }<br />
</code></pre></div></div><br />
<br />
<p>try{<br />
    $it  = new  MySeekableIterator ;<br />
    echo  $it -&gt; current (),  “\n” ;</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$it -&gt; seek ( 2 );<br />
echo  $it -&gt; current (),  "\n" ;<br />
  <br />
$it -&gt; seek ( 1 );<br />
echo  $it -&gt; current (),  "\n" ;<br />
  <br />
$it -&gt; seek ( 10 ); }catch( OutOfBoundsException $e ){<br />
echo  $e -&gt; getMessage (); } 输出结果：<br />
</code></pre></div></div><br />
<br />
<p>1<br />
2<br />
3<br />
4<br />
first element<br />
third element<br />
second element<br />
invalid seek position ( 10 )<br />
SplObserver和SplSubject接口：<br />
SplObserver和SplSubject接口用来实现观察者设计模式，观察者设计模式是指当一个类的状态发生变化时，依赖它的对象都会收到通知并更新。使用场景非常广泛，比如说当一个事件发生后，需要更新多个逻辑操作，传统方式是在事件添加后编写逻辑，这种代码耦合并难以维护，观察者模式可实现低耦合的通知和更新机制。</p><br />
<br />
<p>SplObserver和SplSubject的接口结构：<br />
// SplSubject结构 被观察的对象<br />
interface SplSubject{<br />
    public function attach(SplObserver $observer); // 添加观察者<br />
    public function detach(SplObserver $observer); // 剔除观察者<br />
    public function notify(); // 通知观察者<br />
}</p><br />
<br />
<p>// SplObserver结构 代表观察者<br />
interface SplObserver{<br />
    public function update(SplSubject $subject); // 更新操作<br />
}<br />
看下面一个实现观察者的例子：<br />
class Subject implements SplSubject<br />
{<br />
    private $observers = array();</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public function attach(SplObserver  $observer)<br />
{<br />
    $this-&gt;observers[] = $observer;<br />
}<br />
  <br />
public function detach(SplObserver  $observer)<br />
{<br />
    if($index = array_search($observer, $this-&gt;observers, true)) {<br />
        unset($this-&gt;observers[$index]);<br />
    }<br />
}<br />
  <br />
public function notify()<br />
{<br />
    foreach($this-&gt;observers as $observer) {<br />
        $observer-&gt;update($this);<br />
    }<br />
} }<br />
</code></pre></div></div><br />
<br />
<p>class Observer1 implements  SplObserver<br />
{<br />
    public function update(SplSubject  $subject)<br />
    {<br />
        echo “逻辑1代码”.PHP_EOL;<br />
    }<br />
}</p><br />
<br />
<p>class Observer2 implements  SplObserver<br />
{<br />
    public function update(SplSubject  $subject)<br />
    {<br />
        echo “逻辑2代码”.PHP_EOL;<br />
    }<br />
}</p><br />
<br />
<p>$subject = new Subject();<br />
$subject-&gt;attach(new Observer1());<br />
$subject-&gt;attach(new Observer2());</p><br />
<br />
<p>$subject-&gt;notify();<br />
运行结果：</p><br />
<br />
<p>1<br />
2<br />
逻辑1代码<br />
逻辑2代码<br />
ArrayObject接口：<br />
ArrayObject 是将数组转换为数组对象。<br />
// 返回当前数组元素<br />
ArrayIterator::current( void )</p><br />
<br />
<p>// 返回当前数组key<br />
ArrayIterator::key(void)</p><br />
<br />
<p>// 指向下个数组元素<br />
ArrayIterator::next (void)</p><br />
<br />
<p>// 重置数组指针到头<br />
ArrayIterator::rewind(void )</p><br />
<br />
<p>// 查找数组中某一位置<br />
ArrayIterator::seek()</p><br />
<br />
<p>// 检查数组是否还包含其他元素<br />
ArrayIterator::valid()</p><br />
<br />
<p>// 添加新元素<br />
ArrayObject::append()</p><br />
<br />
<p>// 构造一个新的数组对象<br />
ArrayObject::__construct()</p><br />
<br />
<p>// 返回迭代器中元素个数<br />
ArrayObject::count()</p><br />
<br />
<p>// 从一个数组对象构造一个新迭代器<br />
ArrayObject::getIterator()</p><br />
<br />
<p>// 判断提交的值是否存在<br />
ArrayObject::offsetExists(mixed index )</p><br />
<br />
<p>// 指定 name 获取值<br />
ArrayObject::offsetGet()</p><br />
<br />
<p>// 修改指定 name 的值<br />
ArrayObject::offsetSet()</p><br />
<br />
<p>// 删除数据<br />
ArrayObject::offsetUnset()<br />
实现例子1：<br />
$array =array(‘1’=&gt;’one’, ‘2’=&gt;’two’, ‘3’=&gt;’three’);<br />
// 构造一个ArrayObject对象<br />
$arrayobject = new ArrayObject($array);<br />
for( $iterator= $arrayobject-&gt;getIterator();// 构造一个迭代器 <br /><br />
    $iterator-&gt;valid();  // 检查是否还含有元素 <br /><br />
    $iterator-&gt;next() ){ // 指向下个元素 <br /><br />
    echo $iterator-&gt;key() . ‘ =&gt; ‘ . $iterator-&gt;current() . “\n”; // 打印数组元素<br />
}<br />
输出结果：</p><br />
<br />
<p>1<br />
1 =&gt; one 2 =&gt; two 3 =&gt; three<br />
实现例子2：<br />
$arrayobject =new ArrayObject();<br />
$arrayobject[] = ‘zero’;<br />
$arrayobject[] = ‘one’;<br />
$arrayobject[] = ‘two’;<br />
$iterator= $arrayobject-&gt;getIterator();<br />
$iterator-&gt;next();<br />
echo $iterator-&gt;key().”<br />”;<br />
// 重置指针到头部<br />
$iterator-&gt;rewind();<br />
echo $iterator-&gt;key();<br />
输出结果：<br />
1<br />
0</p><br />
<br />
<p>https://stackoverflow.com/questions/14610307/spl-arrayobject-arrayobjectstd-prop-list/16619183#16619183</p><br />
<br />
<p>http://bobao.360.cn/news/detail/215.html<br />
https://www.anquanke.com/vul/id/1041474</p><br />
<br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category php
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>