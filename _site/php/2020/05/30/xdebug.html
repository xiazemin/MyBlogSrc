<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">PHP 调试技巧 扩展调试</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-05-30T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> May 30, 2020</time></p>
					</div>
					 <p>https://www.zhihu.com/question/20348619/answer/101893104</p><br />
<br />
<p>xdebug的xdebug_start_trace();<br />
/* 业务代码     */<br />
xdebug_stop_trace();<br />
他解决了我长久以来一个代码调试问题：比如有以下几个场景：1、一个有几百行的函数，里面有很多return，现在函数异常返回了，但是我不知道是从哪一行返回的，这时候呢，我一般的做法都是每一行echo();die();太费事了。2、接触一个新的框架，代码执行出现异常，怎么办呢，肯定也是一行一行的echo();die();3、想学习一个新框架，想知道代码的执行轨迹：执行了哪些类、调用了哪些类的方法，等等。现在呢，xdebug的代码跟踪，能帮我们轻松解决上面的问题。xdebug的安装（网上我看到了很多的都是在说xdebug、phpstorm、chrome咋配合起来远程调试，搞得大家好像觉得xdebug用起来那么费事，那么高级，其实没必要）：1、安装php xdebug扩展（不再细说）2、配置：这里只讲代码跟踪相关的配置：cat /etc/php.d/xdebug.ini<br />
extension=/usr/lib64/php/modules/xdebug.so <br />
;代码跟踪日志文件位置,注意要先新建这个traces目录，并设置777<br />
xdebug.trace_output_dir = /tmp/traces<br />
;代码跟踪日志文件格式 <br />
xdebug.trace_output_name = trace.%c.%p<br />
;trace中显示函数的参数值，这个很有用，待会细说<br />
xdebug.collect_params = 4<br />
xdebug.collect_includes = On<br />
xdebug.collect_return = On<br />
xdebug.show_mem_delta = On<br />
;var_display_max_depth这个参数也很有用。用来设置数组或者对象显示的最大层级。<br />
;默认是3。参见官方文档的说明：Controls how many nested levels of array elements <br />
;and object properties are when variables are displayed <br />
;with either xdebug_var_dump(), xdebug.show_local_vars or through Function Traces.<br />
xdebug.var_display_max_depth = 2安装好之后，代码执行明细(trace)，就存放在/tmp/traces目录下了:<br />
<!-- more --><br />
我截取一段trace日志，大家看下，就能感知到这个用法的方便了：</p><br />
<br />
<p>1、显示了参数的值：就这一点，我想就会节省我们phper很多的调试时间（默认不显示参数值，只显示调用的函数。需要添加xdebug.collect_params这个配置）2、显示了代码的执行轨迹。类似于c语言的单步调试吧。就这些了，反正用了xdebug，我是觉得debug的时候节省了大量时间，分享给大家，希望对你们也有帮助。ps：如果大家都xdebug的安装有困惑，可以参考http://www.ibm.com/developerworks/cn/opensource/os-php-xdebug/index.html——-以下是2017.12.08补充——-再补充一种调试方法：利用symfony/var-dumper包中的dump()函数，格式化输出变量效果如下：<img src="https://pic1.zhimg.com/50/v2-b995144bdfaec5440bca2445c279de77_hd.jpg" data-caption="" data-size="normal" data-rawwidth="403" data-rawheight="607" class="content_image" width="403" />当然，很多框架里面都内置了类似的打印函数，这里只所以推荐，更重要的一个原因是：可以通过全局安装，实现dump()函数对所有项目可见，无需在项目中引入任何代码库。安装方法如下：1、执行 composer global require symfony/var-dumper ，全局安装var-dumper包，默认会安装到${HOME}/.config/composer目录。2、在php.ini文件中加入一行:auto_prepend_file = ${HOME}/.config/composer/vendor/autoload.php<br />
//auto_prepend_file可以简单地理解成：执行所有的php代码之前先include你指定的文件从此以后，在你任意的php项目中调用dump($var);<br />
//调用dump函数的时候，会触发autoload，实现函数、类的自动加载。<br />
//关于composer autoload，不明白的可以参考<br />
//https://laravel-china.org/topics/1002/deep-composer-autoload就可以实现上述的打印效果了。2018-11-5号补充：xdebug trace 可视化工具：splitbrain/xdebug-trace-tree QCacheGrind (KCacheGrind) Windows build</p><br />
<br />
<p>https://www.zhihu.com/question/20348619?sort=created</p><br />
<br />
<p>https://www.php.net/manual/zh/internals2.buildsys.environment.php</p><br />
<br />
<p>使用 gdb 调试 PHP 扩展</p><br />
<br />
<p>php的扩展使用c/c++开发，可以很容易的使用gdb进行调试。具体步骤如下： 首先编译php的时候需要加上** –enable-debug**参数</p><br />
<br />
<p>./configure –enable-debug</p><br />
<br />
<p>make &amp;&amp; make install</p><br />
<br />
<p>在我的ubuntu机器上面测试，扩展的目录默认为 /usr/local/lib/php/extensions/debug-non-zts-20131226/<br />
这样进行php的源码调试也很方便。<br />
下一步进行扩展创建，进入php源码的ext目录，运行</p><br />
<br />
<p>./ext_skel –extname=mydebug</p><br />
<br />
<p>当前目录下会自动生成mydebug目录，然后进入该目录，编辑config.m4文件，去掉10~12行的dnl，如下</p><br />
<br />
<p>PHP_ARG_WITH(mydebug, for mydebug support,</p><br />
<br />
<p>Make sure that the comment is aligned:</p><br />
<br />
<p>[ –with-mydebug Include mydebug support])</p><br />
<br />
<p>在最后一行添加</p><br />
<br />
<p>if test -z “$PHP_DEBUG”; then</p><br />
<br />
<p>AC_ARG_ENABLE(debug,</p><br />
<br />
<p>[–enable-debg compile with debugging system],</p><br />
<br />
<p>[PHP_DEBUG=$enableval], [PHP_DEBUG=no]</p><br />
<br />
<p>)</p><br />
<br />
<p>fi</p><br />
<br />
<p>这样就表示该扩展能够进行调试了，然后编译该扩展，使用命令</p><br />
<br />
<p>phpize</p><br />
<br />
<p>./configure –enable-debug</p><br />
<br />
<p>make &amp;&amp; make install</p><br />
<br />
<p>这里的 phpize 和 php-config 需要事先配置好环境变量，然后加载该扩展。在我的机器上面地址为/usr/local/lib/php/extensions/debug-non-zts-20131226/。进入mydebug扩展源码目录，默认生成的函数为confirm_mydebug_compiled，定义在 mydebug.c，扩展自动生成的函数。</p><br />
<br />
<p>PHP_FUNCTION(confirm_mydebug_compiled)</p><br />
<br />
<p>{</p><br />
<br />
<p>char *arg = NULL;</p><br />
<br />
<p>int arg_len, len;</p><br />
<br />
<p>char *strg;</p><br />
<br />
<p>if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, “s”, &amp;arg, &amp;arg_len) == FAILURE) {</p><br />
<br />
<p>return;</p><br />
<br />
<p>}</p><br />
<br />
<p>len = spprintf(&amp;strg, 0, “Congratulations! You have successfully modified ext/%.78s/config.m4. Module %.78s is now compiled into PHP.”, “mydebug”, arg);</p><br />
<br />
<p>RETURN_STRINGL(strg, len, 0);</p><br />
<br />
<p>}</p><br />
<br />
<p>大概意思就是获取字符串参数，然后拼成一句字符串返回。通过nm命令查看生成的mydebug.so导出的符号。</p><br />
<br />
<p>运行 nm mydebug.so</p><br />
<br />
<p>返回 zif_confirm_mydebug_compiled</p><br />
<br />
<p>……</p><br />
<br />
<p>PHP_FUNCTION 实际就是在函数名前面添加 zif_，然后进行gdb调试</p><br />
<br />
<p>第一步运行: gdb php</p><br />
<br />
<p>然后运行： break zif_confirm_mydebug_compiled</p><br />
<br />
<p>终端提示：Function “zif_confirm_mydebug_compiled” not defined.</p><br />
<br />
<p>Make breakpoint pending on future shared library load? (y or [n])</p><br />
<br />
<p>输入： y</p><br />
<br />
<p>输入: run /tmp/test.php</p><br />
<br />
<p>此时会回显:Breakpoint 1, zif_confirm_mydebug_compiled (ht=1, return_value=0xb7bf0d44, return_value_ptr=0xb7bd6104, this_ptr=0x0, return_value_used=1)</p><br />
<br />
<p>at /…../php-5.6.6/ext/mydebug/mydebug.c:56</p><br />
<br />
<p>然后输入: l</p><br />
<br />
<p>显示：<br />
 PHP_FUNCTION(confirm_mydebug_compiled)<br />
 {<br />
 char *arg = NULL;<br />
 int arg_len, len;<br />
 char *strg;<br />
 if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, “s”, &amp;arg, &amp;arg_len) == FAILURE) {</p><br />
<br />
<p>其中文件/tmp/test.php的内容为：</p><br />
<br />
<p>&lt;?php</p><br />
<br />
<p>echo confirm_mydebug_compiled(“hello world”);</p><br />
<br />
<p>可以看到，函数源代码已经出来了，可以使用常用的gdb命令进行调试了。</p><br />
<br />
<p>https://blog.csdn.net/luolaifa000/article/details/100518718</p><br />
<br />
<p>https://blog.it2048.cn/article-php-ext/</p><br />
<br />
<p>php扩展xdebug （php页面调试）<br />
https://blog.csdn.net/weixin_34405925/article/details/89797004</p><br />
<br />
<p>https://www.laruence.com/2009/04/28/719.html</p><br />
<br />
<p>实战<br />
vi config.m4<br />
if test -z “$PHP_DEBUG”; then<br />
AC_ARG_ENABLE(debug,<br />
[–enable-debg compile with debugging system],<br />
[PHP_DEBUG=$enableval], [PHP_DEBUG=no]<br />
)<br />
fi</p><br />
<br />
<p>$./configure –enable-debug<br />
checking for grep that handles long lines and -e… /usr/bin/grep<br />
checking for egrep… /usr/bin/grep -E</p><br />
<br />
<p>$make &amp;&amp; make install</p><br />
<br />
<p>$nm mydebug.so<br />
/Library/Developer/CommandLineTools/usr/bin/nm: mydebug.so: No such file or directory.</p><br />
<br />
<p>$nm  /usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.so</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            U _OnUpdateLong<br />
             U _OnUpdateString<br />
             U ___memcpy_chk<br />
             U ___stack_chk_fail<br />
             U ___stack_chk_guard<br />
             U ___strcat_chk<br />
             U ___strcpy_chk<br />
             U ___zend_malloc<br />
             U __array_init<br />
             U __efree<br />
             U __emalloc<br />
             U __zval_ptr_dtor<br />
             U _add_assoc_long_ex<br />
             U _ap_php_snprintf<br />
             U _asctime<br />
             U _executor_globals<br />
             U _fclose<br />
             U _feof<br />
             U _fopen<br />
             U _fread<br />
             U _fseek<br />
             U _ftime<br />
             U _fwrite 0000000000001600 T _getTimems 0000000000002940 T _get_module 0000000000003170 s _ini_entries 0000000000003440 b _le_myFile<br />
             U _localtime<br />
             U _malloc 0000000000003290 S _myFile_functions 0000000000003418 S _myFile_globals 0000000000003370 D _myFile_module_entry 0000000000002890 T _myStrConcat 0000000000001650 T _my_execute_ex 0000000000001930 t _my_get_file_class_function_name 0000000000003438 b _my_zend_execute_ex 0000000000002600 t _myfile_dtor<br />
             U _php_info_print_table_end<br />
             U _php_info_print_table_header<br />
             U _php_info_print_table_start<br />
             U _php_sprintf<br />
             U _printf 0000000000001410 T _save_log<br />
             U _strcmp<br />
             U _strlen<br />
             U _strncmp<br />
             U _strpprintf<br />
             U _time<br />
             U _zend_error<br />
             U _zend_execute_ex<br />
             U _zend_fetch_resource<br />
             U _zend_hash_str_exists<br />
             U _zend_list_close<br />
             U _zend_parse_parameters<br />
             U _zend_register_ini_entries<br />
             U _zend_register_list_destructors_ex<br />
             U _zend_register_resource 0000000000002950 t _zend_string_alloc 0000000000002a20 t _zend_string_forget_hash_val 0000000000002340 t _zend_string_init<br />
             U _zend_unregister_ini_entries 0000000000001ea0 T _zif_confirm_myFile_compiled 0000000000002030 T _zif_file_close 00000000000024d0 T _zif_file_eof 0000000000001f50 T _zif_file_open 00000000000020b0 T _zif_file_read 00000000000023a0 T _zif_file_write 0000000000002650 T _zm_activate_myFile 0000000000002710 T _zm_deactivate_myFile 0000000000002900 T _zm_info_myFile 0000000000002630 T _zm_shutdown_myFile 00000000000025b0 T _zm_startup_myFile 0000000000001e80 t _zval_get_type<br />
             U dyld_stub_binder<br />
</code></pre></div></div><br />
<br />
<p>e$ lldb php<br />
(lldb) target create “php”<br />
Current executable set to ‘php’ (x86_64).<br />
(lldb) b  _zm_shutdown_myFile<br />
Breakpoint 1: no locations (pending).<br />
WARNING:  Unable to resolve breakpoint to any actual locations.<br />
(lldb)</p><br />
<br />
<p>(lldb) file /usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.so<br />
Current executable set to ‘/usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.so’ (x86_64).<br />
(lldb) b  _zm_shutdown_myFile<br />
Breakpoint 1: no locations (pending).<br />
WARNING:  Unable to resolve breakpoint to any actual locations.<br />
(lldb)</p><br />
<br />
<p>(gdb) b _zm_shutdown_myFile<br />
Function “_zm_shutdown_myFile” not defined.<br />
Make breakpoint pending on future shared library load? (y or [n]) y<br />
Breakpoint 1 (_zm_shutdown_myFile) pending.<br />
(gdb)</p><br />
<br />
<p>$lldb -c /cores/core.38839<br />
(lldb) target create –core “/cores/core.38839”<br />
warning: (x86_64) /cores/core.38839 load command 108 LC_SEGMENT_64 has a fileoff + filesize (0x28a0e000) that extends beyond the end of the file (0x28a0d000), the segment will be truncated to match<br />
warning: (x86_64) /cores/core.38839 load command 109 LC_SEGMENT_64 has a fileoff (0x28a0e000) that extends beyond the end of the file (0x28a0d000), ignoring this section</p><br />
<br />
<p>error: myFile.so debug map object file ‘/Users/didi/PhpstormProjects/c/php-src/ext/myFile/.libs/myFile.o’ has changed (actual time is 0x5ed26b84, debug map time is 0x5ed26abc) since this executable was linked, file will be ignored<br />
Core file ‘/cores/core.38839’ (x86_64) was loaded.<br />
(lldb)<br />
Core file ‘/cores/core.38839’ (x86_64) was loaded.<br />
(lldb) bt</p><br />
<ul><br />
  <li>thread #1: tid = 0x0000, 0x0000000103049e99 php`php_sprintf(s=”%d”, format=””) + 361 at php_sprintf.c:37, stop reason = signal SIGSTOP<br />
    <ul><br />
      <li>frame #0: 0x0000000103049e99 php<code class="language-plaintext highlighter-rouge">php_sprintf(s="%d", format="") + 361 at php_sprintf.c:37<br />
frame #1: 0x00000001042ea821 myFile.so</code>zm_deactivate_myFile + 305<br />
frame #2: 0x00000001030f5b8e php<code class="language-plaintext highlighter-rouge">zend_deactivate_modules + 222 at zend_API.c:2574<br />
frame #3: 0x000000010303d2a4 php</code>php_request_shutdown(dummy=0x0000000000000000) + 580 at main.c:1847<br />
frame #4: 0x0000000103206e7e php<code class="language-plaintext highlighter-rouge">do_cli(argc=2, argv=0x00007fff5cffefd0) + 6958 at php_cli.c:1157<br />
frame #5: 0x000000010320515a php</code>main(argc=2, argv=0x00007fff5cffefd0) + 1898 at php_cli.c:1378<br />
frame #6: 0x00007fff8ad7c5ad libdyld.dylib`start + 1</li><br />
    </ul><br />
  </li><br />
</ul><br />
<br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category php
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>