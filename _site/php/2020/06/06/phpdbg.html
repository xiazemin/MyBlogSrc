<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">phpdbg gdb</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-06-06T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Jun 6, 2020</time></p>
					</div>
					 <p>查看opcode<br />
php是先把源码解析成opcode，然后再把opcode传递给zend_vm进行执行的。</p><br />
<br />
<p>// 一个opcode的结构<br />
struct _zend_op {<br />
     const void *handler; // opcode对应的执行函数，每个opcode都有一个对应的执行函数<br />
     znode_op op1;  // 执行参数的第一个元素<br />
     znode_op op2;  //  执行参数的第二个元素<br />
     znode_op result; // 执行结果<br />
     uint32_t extended_value; // 额外扩展的字段和值<br />
     uint32_t lineno; // 行数<br />
     zend_uchar opcode;   // 操作码，具体操作码列表见 http://cn.php.net/manual/zh/internals2.opcodes.php<br />
     zend_uchar op1_type; // 第一个元素的类型<br />
     zend_uchar op2_type; // 第二个元素的类型<br />
     zend_uchar result_type; // 结果的类型<br />
};<br />
在php7中，我们能很方便用phpdbg来查看一个文件或者一个函数的opcode了。至于phpdbg的使用，现在网上介绍不多，不过好在有很详细的help文档。下面是一个最简单的opcode代码：</p><br />
<br />
<p>$ bin/phpdbg -f /home/xiaoju/software/php7/demo/echo.php<br />
prompt&gt; list 100<br />
00001: &lt;?php<br />
00002:<br />
00003: $a = 1;<br />
00004: $b = $a;<br />
00005: $b = $b + 1;<br />
00006: echo $b;<br />
00007:<br />
prompt&gt; print exec<br />
[Context /home/xiaoju/software/php7/demo/echo.php (6 ops)]<br />
L1-7 {main}() /home/xiaoju/software/php7/demo/echo.php - 0x7fe3fae63300 + 6 ops<br />
L3    #0     ASSIGN                  $a                   1<br />
L4    #1     ASSIGN                  $b                   $a<br />
L5    #2     ADD                     $b                   1                    ~2<br />
L5    #3     ASSIGN                  $b                   ~2<br />
L6    #4     ECHO                    $b<br />
L7    #5     RETURN                  1<br />
这个php文件就做了一个最简单的加法操作。生成了6个_zend_op。所展示的每一行代表一个_zend_op</p><br />
<br />
<p>_zendop.lineno  op号   _zend_op.opcode       _zend_op.op1          _zend_op.op2          _zend_op.result<br />
L5              #2     ADD                     $b                   1                    ~2<br />
这里_zend_op.opcode对应的操作在官网有文档和详细的例子可以查看：http://cn.php.net/manual/zh/internals2.opcodes.php</p><br />
<br />
<p>值得一说的是，phpdbg还有一个远端UI版本，能让我们在近端诊断服务端的php信息<br />
<!-- more --></p><br />
<br />
<p>gdb<br />
但是我们的目标还是在于研究php源码，phpdbg只能分析到opcode这层，还是不够的，gdb可能是更好的选择。</p><br />
<br />
<p>gdb的使用和平时使用差不多</p><br />
<br />
<p>比如我现在有个脚本echo.php:</p><br />
<br />
<p>1 &lt;?php<br />
  2<br />
  3 $a = 1;<br />
  4 $b = $a;<br />
  5 $b = $b + 1;<br />
  6 echo $b;<br />
我的php安装路径在：</p><br />
<br />
<p>/home/xiaoju/software/php7/bin/php<br />
php源码路径在：</p><br />
<br />
<p>/home/xiaoju/webroot/php-src/php-src-master/<br />
运行gdb</p><br />
<br />
<p>$ gdb /home/xiaoju/software/php7/bin/php<br />
加载gdbinit:</p><br />
<br />
<p>(gdb) source /home/xiaoju/webroot/php-src/php-src-master/.gdbinit<br />
设置断点:</p><br />
<br />
<p>(gdb) b zend_execute_scripts<br />
运行：</p><br />
<br />
<p>(gdb) run -f /home/xiaoju/software/php7/demo/echo.php<br />
我想在1459这行设置个断点：</p><br />
<br />
<p>1452          for (i = 0; i &lt; file_count; i++) {<br />
1453               file_handle = va_arg(files, zend_file_handle *);<br />
1454               if (!file_handle) {<br />
1455                    continue;<br />
1456               }<br />
1457<br />
1458               op_array = zend_compile_file(file_handle, type);<br />
1459               if (file_handle-&gt;opened_path) {<br />
1460                    zend_hash_add_empty_element(&amp;EG(included_files), file_handle-&gt;opened_path);<br />
1461               }</p><br />
<br />
<p>(gdb) b 1459<br />
继续跑</p><br />
<br />
<p>(gdb) continue<br />
(gdb) s<br />
(gdb) s<br />
打印出这个时候的op_array</p><br />
<br />
<p>(gdb) p *op_array<br />
$4 = {type = 2 ‘\002’, arg_flags = “\000\000”, fn_flags = 134217728, function_name = 0x0, scope = 0x0,<br />
  prototype = 0x0, num_args = 0, required_num_args = 0, arg_info = 0x0, refcount = 0x7ffff6002000, last = 6,<br />
  opcodes = 0x7ffff6076240, last_var = 2, T = 4, vars = 0x7ffff6079030, last_live_range = 0, last_try_catch = 0,<br />
  live_range = 0x0, try_catch_array = 0x0, static_variables = 0x0, filename = 0x7ffff605c2d0, line_start = 1,<br />
  line_end = 7, doc_comment = 0x0, early_binding = 4294967295, last_literal = 3, literals = 0x7ffff60030c0,<br />
  cache_size = 0, run_time_cache = 0x0, reserved = {0x0, 0x0, 0x0, 0x0}}<br />
我可以优化输出：</p><br />
<br />
<p>(gdb) set print pretty on<br />
(gdb) p *op_array<br />
$5 = {<br />
  type = 2 ‘\002’,<br />
  arg_flags = “\000\000”,<br />
  fn_flags = 134217728,<br />
  function_name = 0x0,<br />
  scope = 0x0,<br />
  prototype = 0x0,<br />
  num_args = 0,<br />
  required_num_args = 0,<br />
  arg_info = 0x0,<br />
  refcount = 0x7ffff6002000,<br />
  last = 6,<br />
  opcodes = 0x7ffff6076240,<br />
  last_var = 2,<br />
  T = 4,<br />
  vars = 0x7ffff6079030,<br />
  last_live_range = 0,<br />
  last_try_catch = 0,<br />
  live_range = 0x0,<br />
  try_catch_array = 0x0,<br />
  static_variables = 0x0,<br />
  filename = 0x7ffff605c2d0,<br />
  line_start = 1,<br />
  line_end = 7,<br />
  doc_comment = 0x0,<br />
  early_binding = 4294967295,<br />
  last_literal = 3,<br />
  literals = 0x7ffff60030c0,<br />
  cache_size = 0,<br />
  run_time_cache = 0x0,<br />
  reserved = {0x0, 0x0, 0x0, 0x0}<br />
}<br />
我想打出op_array.filename.val的具体值</p><br />
<br />
<p>(gdb) p (op_array.filename.len)<br />
$12 = 40<br />
(gdb) p *(op_array.filename.val)@40<br />
$13 = “/home/xiaoju/software/php7/demo/echo.php”<br />
好了，我们可以顺便研究下_zend_op_array这个结构：</p><br />
<br />
<p>// opcode组成的数组，编译的时候就是生成这个结构<br />
struct _zend_op_array {<br />
     zend_uchar type;  // op array的类型，比如 ZEND_EVAL_CODE<br />
     zend_uchar arg_flags[3]; /* bitset of arg_info.pass_by_reference <em>/<br />
     uint32_t fn_flags;<br />
     zend_string *function_name;<br />
     zend_class_entry *scope;<br />
     zend_function *prototype;<br />
     uint32_t num_args;  // 脚本的参数<br />
     uint32_t required_num_args;<br />
     zend_arg_info *arg_info;<br />
     /</em> END of common elements */</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> uint32_t *refcount; // 这个结构的引用次数<br />
<br />
 uint32_t last;  // opcode的个数<br />
 zend_op *opcodes;  // 存储所有的opcode<br />
<br />
 int last_var; // php变量的个数<br />
 uint32_t T;<br />
 zend_string **vars; // 被编译的php变量的个数<br />
<br />
 int last_live_range;<br />
 int last_try_catch;  // try_catch的个数<br />
 zend_live_range *live_range;<br />
 zend_try_catch_element *try_catch_array; //<br />
<br />
 /* static variables support */<br />
 HashTable *static_variables; // 静态变量<br />
<br />
 zend_string *filename;  // 执行的脚本的文件<br />
 uint32_t line_start; // 开始于第几行<br />
 uint32_t line_end; // 结束于第几行<br />
 zend_string *doc_comment; // 文档的注释<br />
 uint32_t early_binding; /* the linked list of delayed declarations */<br />
<br />
 int last_literal;<br />
 zval *literals;<br />
<br />
 int  cache_size;<br />
 void **run_time_cache;<br />
<br />
 void *reserved[ZEND_MAX_RESERVED_RESOURCES]; // 保留字段 };<br />
</code></pre></div></div><br />
<br />
<p>$sudo gdb php<br />
(gdb)source /Users/didi/PhpstormProjects/c/php-src/.gdbinit<br />
(gdb) run -f  spl.php<br />
xzm 2 spl_autoload</p><br />
<br />
<p>Program received signal SIGSEGV, Segmentation fault.<br />
0x00007fff9a84fd32 in strlen () from /usr/lib/system/libsystem_c.dylib</p><br />
<br />
<p>https://www.cnblogs.com/yjf512/p/6112634.html</p><br />
<br />
<p>发现在自己扩展代码break比较困难<br />
但是可以在php的src里break，然后走到自己的代码<br />
(gdb) b my_get_file_class_function_info<br />
Cannot access memory at address 0x1d20<br />
(gdb)  b zend_execute_scripts<br />
Breakpoint 2 at 0x1004eadfc: file Zend/zend.c, line 1434.<br />
(gdb) b execute_ex<br />
Breakpoint 4 at 0x10055190c: file Zend/zend_vm_execute.h, line 417.<br />
(gdb) run -f  spl.php</p><br />
<br />
<p>(gdb) continue<br />
(gdb) s<br />
(gdb) s</p><br />
<br />
<p>(gdb)  zbacktrace<br />
Attempt to extract a component of a value that is not a structure.</p><br />
<br />
<p>➜ gdb -p $PID<br />
(gdb) source /path/to/php-src/.gdbinit<br />
(gdb) zbacktrace<br />
[2018-06-27 Wed]: update<br />
调试数据库死循环<br />
shell&gt; mysqladmin -uroot processlist<br />
或者<br />
mysql&gt; show processlist;<br />
结果<br />
+——-+——+———–+—–+———+——+——-+——–+———-+<br />
| Id    | User | Host      | db  | Command | Time | State | Info   | Progress |<br />
+——-+——+———–+—–+———+——+——-+——–+———-+<br />
| 12471 | xxx  | IP:60608  | xxx | Sleep   | 49   |       |        | 0.000    |<br />
| 12491 | xxx  | localhost |     | Sleep   | 69   |       |        | 0.000    |<br />
可以看到是 IP:60608 这个连接一直占用着数据库，登录到 IP 对应的 host 上，执行 lsof -i tcp:60608 可以看到对应的 pid，再执行下面的 debug 可以看到数据库是在哪里死循环了<br />
➜ gdb -p $PID<br />
(gdb) source /path/to/php-src/.gdbinit<br />
(gdb) zbacktrace</p><br />
<br />
<p>https://sunznx.com/php/php-debug.html</p><br />
<br />
<p>使用 gdb 调试 PHP core</p><br />
<br />
<p>一、开启<br />
查看是否开启 core dump 输出<br />
ulimit -a</p><br />
<br />
<p>打开 core dump 文件记录<br />
ulimit -c unlimited</p><br />
<br />
<p>yum install gdb php-dbg</p><br />
<br />
<p>关闭 core dump 文件记录<br />
ulimit -c 0</p><br />
<br />
<p>设置内核core dump出来的存放路径（注意目录要有权限给php写）：<br />
echo “/tmp/core.%e.%p.%t” &gt; /proc/sys/kernel/core_pattern</p><br />
<br />
<p>二、调试<br />
1、准备 .gdbinit 文件<br />
获取地址：https://github.com/php/php-src/blob/master/.gdbinit<br />
保存在服务器上，例如 /root/.gdbinit 备用。</p><br />
<br />
<p>2、用 gdb 打开 core 文件<br />
gdb php-fpm -c core-php-fpm.920</p><br />
<br />
<p>可以看到类似下边的字样：</p><br />
<br />
<p>Core was generated by `php-fpm: pool www            ‘.<br />
Program terminated with signal 11, Segmentation fault.<br />
3、查看 core 发生时刻的堆栈<br />
(gdb) bt<br />
#0  zend_mm_alloc_small (size=<value optimized="" out="">) at /usr/src/debug/php-7.0.6/Zend/zend_alloc.c:1295<br />
#1  zend_mm_alloc_heap (size=<value optimized="" out="">) at /usr/src/debug/php-7.0.6/Zend/zend_alloc.c:1366<br />
#2  _emalloc (size=<value optimized="" out="">) at /usr/src/debug/php-7.0.6/Zend/zend_alloc.c:2450<br />
#3  0x00007f7a6fad0511 in apm_sprintf (fmt=0x7f7a6faeff50 "\n %04d-%02d-%02d %02d:%02d:%02d Version %s\n Process %d received signal %2d: %s , bss[%p]\n")<br />
    at /PHP/64/source/php7.0.0_nzts/ext/apm/apm_common.c:371<br />
#4  0x00007f7a6facbefd in print_backtrace (sig=11) at /PHP/64/source/php7.0.0_nzts/ext/apm/apm.c:1937<br />
#5  0x00007f7a6facbfd7 in agent_fatal_signal_handler (sig=11) at /PHP/64/source/php7.0.0_nzts/ext/apm/apm.c:1955<br />
#6  <signal handler="" called=""><br />
#7  zend_mm_alloc_small (size=<value optimized="" out="">) at /usr/src/debug/php-7.0.6/Zend/zend_alloc.c:1295<br />
#8  zend_mm_alloc_heap (size=<value optimized="" out="">) at /usr/src/debug/php-7.0.6/Zend/zend_alloc.c:1366<br />
4、引入 PHP 源代码中提供的 .gdbinit (gdb 命令编写脚本)<br />
(gdb) source /root/.gdbinit<br />
5、查看 backtrace 和变量值<br />
(gdb) zbacktrace<br />
[0x7f7a75e138c0] C("DEBUG") /usr/share/nginx/html/smartphp/common.php:28<br />
[0x7f7a75e137d0] Model-&gt;_connectDb() /usr/share/nginx/html/smartphp/core/Model.class.php:44<br />
[0x7f7a75e13680] Model-&gt;bindData("SELECT\40tips\40FROM\40keyword_phone\40WHERE\40word=:word", array(1)[0x7f7a75e136f0], "getdata") /usr/share/nginx/html/smartphp/core/Model.class.php:143<br />
[0x7f7a75e13580] Model-&gt;getData("SELECT\40tips\40FROM\40keyword_phone\40WHERE\40word=:word", array(1)[0x7f7a75e135f0]) /usr/share/nginx/html/smartphp/core/Model.class.php:215<br />
[0x7f7a75e134c0] Model-&gt;getField("SELECT\40tips\40FROM\40keyword_phone\40WHERE\40word=:word", array(1)[0x7f7a75e13530]) /usr/share/nginx/html/appdata/smartphp/core/Model.class.php:264<br />
(gdb) print ((zval *)0x7f7a75e13530)<br />
$1 = (zval *) 0x7f7a75e13530</value></value></signal></value></value></value></p><br />
<br />
<p>(gdb) printzv $1<br />
[0x7f7a75e13530] (refcount=3) array:     Packed(1)[0x7f7a75e94888]: {<br />
      [0] 0 =&gt; [0x7f7a75e6ad88] (refcount=4) string: PP红包。<br />
}<br />
https://bugs.php.net/bugs-generating-backtrace.php<br />
http://www.laruence.com/2011/06/23/2057.html<br />
https://kn007.net/topics/php-fpm-how-to-core-dump/<br />
http://www.laruence.com/2011/12/06/2381.html</p><br />
<br />
<p>https://segmentfault.com/a/1190000005168629</p><br />
<br />
<p>在zbacktrace时，总是报 No symbol table is loaded. Use the “file” command. 这个符号表是指什么呢？怎么加载进去呢？<br />
 看一下屏幕上的提示，会有类似这样的： debuginfo-install php-fpm-7.0.27-1.el6.remi.x86_64 ，执行这个命令安装一下必要的文件就可以了</p><br />
<br />
<p>https://blog.csdn.net/weixin_30387423/article/details/98027448<br />
 https://www.bbsmax.com/A/KE5QmPM5LG/</p><br />
<br />
<p>https://segmentfault.com/a/1190000002703073<br />
 http://www.phppan.com/2012/10/php-exception-class/</p><br />
<br />
<p>the most likely root cause of the seg fault event is the string that is being passed to strlen() does not have terminating NUL character within the bounds of the array containing the string</p><br />
<br />
<p>https://stackoverflow.com/questions/42588450/debugging-c-code-with-lldb-osx</p><br />
<br />
<p>https://ivanzz1001.github.io/records/post/cplusplus/2018/11/02/cpluscplus-gdbusage_part3</p><br />
<br />
<p>https://visualgdb.com/gdbreference/commands/break</p><br />
<br />
<p>https://stackoverflow.com/questions/100444/how-to-set-breakpoints-on-future-shared-libraries-with-a-command-flag</p><br />
<br />
<p>https://stackoverflow.com/questions/54161727/make-breakpoint-pending-on-future-shared-library-load-y-or-n</p><br />
<br />
<p>https://blog.csdn.net/leonpengweicn/article/details/43668095</p><br />
<br />
<p>https://www.tfzx.net/index.php/article/8684855.html<br />
https://sourceware.org/bugzilla/show_bug.cgi?id=11786<br />
https://stackoverflow.com/questions/23553527/gdb-error-in-re-settings-breakpoint-cannot-access-memory<br />
https://stackoverflow.com/questions/16009341/gdb-patching-results-in-cannot-access-memory-at-address-0x<br />
https://blog.csdn.net/nust20/article/details/96493101</p><br />
<br />
<p>https://gywbd.github.io/posts/2016/2/debug-php-source-code.html</p><br />
<br />
<p>https://www.cnblogs.com/breg/p/3831865.html</p><br />
<br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category php
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>