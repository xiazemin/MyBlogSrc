<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">call_user_function_ex 扩展调用php脚本函数</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-08-30T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Aug 30, 2020</time></p>
					</div>
					 <p>其中可能我认为最关键的应该是在PHP扩展里怎么调用用户空间里的函数了！对于一个framework来说，最基本的功能就是路由到请求对应的Action了。</p><br />
<br />
<p>在PHP扩展里是通过 call_user_function_ex 函数来调用用户空间的函数的。下面我们来分析下这个函数的使用方式吧。</p><br />
<br />
<p>下面这个是call_user_function_ex 函数的定义：</p><br />
<br />
<p>ZEND_API int call_user_function_ex(<br />
	HashTable *function_table, <br />
	zval **object_pp, <br />
	zval *function_name, <br />
	zval **retval_ptr_ptr, <br />
	zend_uint param_count, <br />
	zval **params[], <br />
	int no_seperation, <br />
	HashTable *symbol_table TSRMLS_DC);<br />
function_table is the hash table where the function you wish to call is located. If you're using object_pp, set this to NULL. If the function is global, most likely it's located in the hash table returned by the macro CG() with the parameter `function_table', i.e.</p><br />
<br />
<p>CG(function_table)<br />
object_pp is a pointer to a zval pointer where an initialized object is located. If you use this, set function_table to NULL, as previously noted.<br />
function_name is a pointer to a zval which contains the name of the function in string form.<br />
retval_ptr_ptr is a pointer to a zval pointer which will contain the return value of the function. The zval passed doesn't need to be initialized, and it may cause problems if you initialize it when it's not neccesary. You  must  always pass a real pointer to a zval pointer, you may not use NULL for this as it will cause a segmentation fault.<br />
param_count is the number of parameters you wish to pass to the function being called.<br />
params is an array of pointers to zval pointers. Note: this is <em>not</em> a PHP/zval array, it is a C array. Example:<br />
zval *foo; zval *bar; zval **params[2]; params[0] = &amp;foo; params[1] = bar;<br />
no_seperation is either 1 or 0, 0 being no zval seperation, 1 enabling zval seperation. <br />
symbol_table is the hash table for symbols. I currently don't know what this is, so when I find out, I'll edit the post and put it here<br />
After the symbol_table parameter, you should put TSRMLS_CC to make it threadsafe.<br />
<!-- more --><br />
https://my.oschina.net/jackin/blog/172926<br />
https://forums.phpfreaks.com/topic/1303-call_user_function_ex-documentation/</p><br />
<br />
<p>&lt;?php<br />
class demo {<br />
    public function get_site_name ($prefix) {<br />
        return $prefix.”信海龙的博客\n”;<br />
    }<br />
}<br />
function get_site_url ($prefix) {<br />
    return $prefix.”www.bo56.com\n”;<br />
}</p><br />
<br />
<p>function call_function ($obj, $fun, $param) {<br />
    if ($obj == null) {<br />
        $result = $fun($param);<br />
    } else {<br />
        $result = $obj-&gt;$fun($param);<br />
    }<br />
    return $result;<br />
}<br />
$demo = new demo();<br />
echo call_function($demo, “get_site_name”, “site name:”);<br />
echo call_function(null, “get_site_url”, “site url:”);<br />
?&gt;</p><br />
<br />
<p>我们将要使用扩展实现call_function方法的功能。</p><br />
<br />
<p>代码<br />
基础代码<br />
这个扩展，我们将在say扩展上增加call_function()。say扩展相关代码大家请看这篇博文。PHP7扩展开发之hello word 文中已经详细介绍了如何创建一个扩展和提供了源码下载。</p><br />
<br />
<p>代码实现<br />
call_function的源码如下：</p><br />
<br />
<p>PHP_FUNCTION(call_function)<br />
{<br />
    zval            *obj = NULL;<br />
    zval            *fun = NULL;<br />
    zval            *param = NULL;<br />
    zval            retval;<br />
    zval            args[1];</p><br />
<br />
<p>#ifndef FAST_ZPP<br />
    /* Get function parameters and do error-checking. */<br />
    if (zend_parse_parameters(ZEND_NUM_ARGS(), “zzz”, &amp;obj, &amp;fun, &amp;param) == FAILURE) {<br />
        return;<br />
    }<br />
#else<br />
    ZEND_PARSE_PARAMETERS_START(3, 3)<br />
        Z_PARAM_ZVAL(obj)<br />
        Z_PARAM_ZVAL(fun)<br />
        Z_PARAM_ZVAL(param)<br />
    ZEND_PARSE_PARAMETERS_END();<br />
#endif</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>args[0] = *param;<br />
if (obj == NULL || Z_TYPE_P(obj) == IS_NULL) {<br />
    call_user_function_ex(EG(function_table), NULL, fun, &amp;retval, 1, args, 0, NULL);<br />
} else {<br />
    call_user_function_ex(EG(function_table), obj, fun, &amp;retval, 1, args, 0, NULL);<br />
}<br />
RETURN_ZVAL(&amp;retval, 0, 1); }<br />
</code></pre></div></div><br />
<br />
<p>代码解读<br />
参数的接受之前有过文章详细说明过，这里就不再说了。这次我们主要说下call_user_function_ex方法的使用。</p><br />
<br />
<p>call_user_function_ex方法用于调用函数和方法。参数说明如下：</p><br />
<ul><br />
  <li>第一个参数：方法表。通常情况下，写 EG(function_table) 更多信息查看</li><br />
  <li>第二个参数：对象。如果不是调用对象的方法，而是调用函数，填写NULL</li><br />
  <li>第三个参数：方法名。</li><br />
  <li>第四个参数：返回值。</li><br />
  <li>第五个参数：参数个数。</li><br />
  <li>第六个参数：参数值。是一个zval数组。</li><br />
  <li>第七个参数：参数是否进行分离操作。详细的，你可以搜索下 PHP 参数分离。查看相关文章</li><br />
  <li>第八个参数：符号表。一般情况写设置为NULL即可。</li><br />
</ul><br />
<br />
<p>https://blog.csdn.net/u011957758/article/details/72513935</p><br />
<br />
<p>https://www.cnblogs.com/wuhen781/p/6132878.html<br />
https://forums.phpfreaks.com/topic/1303-call_user_function_ex-documentation/</p><br />
<br />
<p>调用类的内部方法和 call_user_func 函数的调用方式一样，都是使用了数组的形式来调用。</p><br />
<br />
<p>call_user_func ( callback $function [, mixed $parameter [, mixed $… ]] )</p><br />
<br />
<p>调用第一个参数所提供的用户自定义的函数。<br />
返回值：返回调用函数的结果，或FALSE。</p><br />
<br />
<p>example</p><br />
<br />
<p>：</p><br />
<br />
<p>&lt;?php<br />
function eat($fruit) //参数可以为多个<br />
{<br />
echo “You want to eat $fruit, no problem”;<br />
}<br />
call_user_func(‘eat’, “apple”); //print: You want to eat apple, no problem;<br />
call_user_func(‘eat’, “orange”); //print: You want to eat orange,no problem;<br />
?&gt;</p><br />
<br />
<p>调用类的内部方法：</p><br />
<br />
<p>&lt;?php<br />
class myclass {<br />
function say_hello($name)<br />
{<br />
echo “Hello!$name”;<br />
}<br />
}<br />
$classname = “myclass”;<br />
//调用类内部的函数需要使用数组方式 array(类名，方法名)<br />
call_user_func(array($classname, ‘say_hello’), ‘dain_sun’);<br />
//print Hello! dain_sun<br />
?&gt;</p><br />
<br />
<p>call_user_func_array 函数和 call_user_func 很相似，只是<br />
使<br />
用了数组<br />
的传递参数形式，让参数的结构更清晰:</p><br />
<br />
<p>call_user_func_array</p><br />
<br />
<p>( callback</p><br />
<br />
<p>$function</p><br />
<br />
<p>, array<br />
$param_arr</p><br />
<br />
<p>)</p><br />
<br />
<p>类中的回调函数最好是static的</p><br />
<br />
<p>数组中的第一个参数（类名）也可以用实例化的对象来代替。</p><br />
<br />
<p>调用用户定义的函数，参数为数组形式。<br />
返回值：返回调用函数的结果，或FALSE。</p><br />
<br />
<p>&lt;?php<br />
function debug($var, $val)<br />
{<br />
echo “variable: $var <br /> value: $val <br />”;<br />
echo “&lt;hr&gt;”;<br />
}<br />
$host = $_SERVER[“SERVER_NAME”];<br />
$file = $_SERVER[“PHP_SELF”];<br />
call_user_func_array(‘debug’, array(“host”, $host));<br />
call_user_func_array(‘debug’, array(“file”, $file));<br />
?&gt;</p><br />
<br />
<p>调用类的内部方法和 call_user_func 函数的调用方式一样，都是使用了数组的形式来调用。</p><br />
<br />
<p>exmaple:</p><br />
<br />
<p>&lt;?php<br />
class test<br />
{<br />
function debug($var, $val)<br />
{<br />
echo “variable: $var <br /> value: $val <br />”;<br />
echo “&lt;hr&gt;”;<br />
}<br />
}<br />
$host = $_SERVER[“SERVER_NAME”];<br />
$file = $_SERVER[“PHP_SELF”];<br />
call_user_func_array(array(‘test’, ‘debug’), array(“host”, $host));<br />
call_user_func_array(array(‘test’, ‘debug’), array(“file”, $file));<br />
?&gt;</p><br />
<br />
<p>注：call_user_func<br />
函数和call_user_func_array函数都支持引用。</p><br />
<br />
<p>&lt;?php<br />
function increment(&amp;$var)<br />
{<br />
$var++;<br />
}<br />
$a = 0;<br />
call_user_func(‘increment’, $a);<br />
echo $a; // 0<br />
call_user_func_array(‘increment’, array(&amp;$a)); // You can use this instead<br />
echo $a; // 1<br />
?&gt;</p><br />
<br />
<p>很多时候，需要把控制权限交给用户，或者在扩展里完成某件事后去回调用户的方法。</p><br />
<br />
<p>在PHP扩展里是通过 call_user_function_ex 函数来调用用户空间的函数的。</p><br />
<br />
<p>定义<br />
它的定义在 Zend/zend_API.h :</p><br />
<br />
<p>#define call_user_function_ex(function_table, object, function_name, retval_ptr, param_count, params, no_separation, symbol_table)</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>_call_user_function_ex(object, function_name, retval_ptr, param_count, params, no_separation) 通过宏定义替换为_call_user_function_ex,其中参数 function_table 被移除了，它之所以在API才存在大概是为了兼容以前的写法。函数的真正定义是：<br />
</code></pre></div></div><br />
<br />
<p>ZEND_API int _call_user_function_ex(<br />
    zval *object, <br />
    zval *function_name, <br />
    zval *retval_ptr, <br />
    uint32_t param_count, <br />
    zval params[], <br />
    int no_separation);<br />
参数分析：</p><br />
<br />
<p>zval *object:这个是用来我们调用类里的某个方法的对象。</p><br />
<br />
<p>zval *function_name:要调用的函数的名字。</p><br />
<br />
<p>zval *retval_ptr：收集回调函数的返回值。</p><br />
<br />
<p>uint32_t param_count：回调函数需要传递参数的个数。</p><br />
<br />
<p>zval params[]: 参数列表。</p><br />
<br />
<p>int no_separation：是否对zval进行分离，如果设为1则直接会出错，分离的作用是为了优化空间。</p><br />
<br />
<p>回调功能的实现<br />
PHP_FUNCTION(hello_callback)<br />
{<br />
    zval *function_name;<br />
    zval retval;<br />
    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, “z”, &amp;function_name) == FAILURE) {<br />
        return;<br />
    }<br />
    if (Z_TYPE_P(function_name) != IS_STRING) {<br />
        php_printf(“Function require string argumnets!”);<br />
        return;<br />
    }<br />
    //TSRMLS_FETCH();<br />
    if (call_user_function_ex(EG(function_table), NULL, function_name, &amp;retval, 0, NULL, 0, NULL TSRMLS_CC) != SUCCESS) {<br />
        php_printf(“Function call failed!”);<br />
        return;<br />
    }</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*return_value = retval;<br />
zval_copy_ctor(return_value);<br />
zval_ptr_dtor(&amp;retval);<br />
</code></pre></div></div><br />
<br />
<p>}<br />
zval_copy_ctor()原始（zval）的内容拷贝给它。zval_ptr_dtor()释放空间。return_value不是一个函数外的变量，它的由函数声明里的变量。PHP_FUNCTION(hello_callback)这个声明是简写，最终会被预处理宏替换为：</p><br />
<br />
<p>void zif_hello_callback(zend_execute_data *execute_data, zval *return_value)<br />
return_value变量其实也就是最终返回给调用脚本的，RETURN_STR(s) 等返回函数最终也都是宏替换为对该变量的操作。</p><br />
<br />
<p>测试脚本：</p><br />
<br />
<p>&lt;?php<br />
function fun1() {<br />
    for ($i = 0; $i &lt; 5; $i++) {<br />
        echo ‘fun1:’.$i.”\n”;<br />
    }<br />
    return ‘call end’;<br />
}</p><br />
<br />
<p>echo hello_callback(‘fun1’);<br />
一个并行扩展<br />
早期的php不支持多进程多线程的，现在随着发展有很多扩展不断完善它，诸如pthread,swoole等，不仅能多线程，而且能实现异步。</p><br />
<br />
<p>利用c语言多线程pthread库来实现一个简单的并行扩展。</p><br />
<br />
<p>先声明我们一会用到的结构：</p><br />
<br />
<p>struct myarg<br />
{<br />
    zval *fun;<br />
    zval ret;<br />
};<br />
线程函数：</p><br />
<br />
<p>static void my_thread(struct myarg *arg) {<br />
    zval *fun = arg-&gt;fun;<br />
    zval ret = arg-&gt;ret;<br />
    if (call_user_function_ex(EG(function_table), NULL, fun, &amp;ret, 0, NULL, 0, NULL TSRMLS_CC) != SUCCESS) {<br />
        return;<br />
    }<br />
}<br />
函数的实现：</p><br />
<br />
<p>PHP_FUNCTION(hello_thread)<br />
{<br />
    pthread_t tid;<br />
    zval <em>fun1, *fun2;<br />
    zval ret1, ret2;<br />
    struct myarg arg;<br />
    int ret;<br />
    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, “zz”, &amp;fun1, &amp;fun2) == FAILURE) {<br />
        return;<br />
    }<br />
    arg.fun = fun1;<br />
    arg.ret = ret1;<br />
    ret = pthread_create(&amp;tid, NULL, (void</em>)my_thread, (void*)&amp;arg);<br />
    if(ret != 0) {<br />
        php_printf(“Thread Create Error\n”);<br />
        exit(0);<br />
    }<br />
    if (call_user_function_ex(EG(function_table), NULL, fun2, &amp;ret2, 0, NULL, 0, NULL TSRMLS_CC) != SUCCESS) {<br />
        return;<br />
    }<br />
    pthread_join(tid, NULL);<br />
    RETURN_NULL();</p><br />
<br />
<p>}<br />
测试脚本：</p><br />
<br />
<p>&lt;?php<br />
function fun1() {<br />
    for ($i = 0; $i &lt; 5; $i++) {<br />
        echo ‘fun1:’.$i.’\n’;<br />
    }<br />
}</p><br />
<br />
<p>function fun2() {<br />
    for ($i = 0; $i &lt; 5; $i++) {<br />
        echo ‘fun2:’.$i.’\n’;<br />
    }<br />
}</p><br />
<br />
<p>hello_thread(‘fun1’, ‘fun2’);<br />
echo ‘after 多并发’;</p><br />
<br />
<p>https://segmentfault.com/a/1190000007648157<br />
http://www.hongweipeng.com/index.php/archives/1026/?utm_source=tuicool&amp;utm_medium=referral<br />
https://blog.csdn.net/qq_32783703/article/details/80641355</p><br />
<br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category php
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>