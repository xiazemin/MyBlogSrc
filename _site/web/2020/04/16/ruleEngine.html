<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">Java各种规则引擎</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-04-16T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Apr 16, 2020</time></p>
					</div>
					 <p>一. Drools规则引擎<br />
简介：<br />
Drools就是为了解决业务代码和业务规则分离的引擎。<br />
Drools 规则是在 Java 应用程序上运行的，其要执行的步骤顺序由代码确定<br />
，为了实现这一点，Drools 规则引擎将业务规则转换成执行树。<br />
特性：<br />
优点：<br />
　　　1、简化系统架构，优化应用<br />
　　　2、提高系统的可维护性和维护成本<br />
　　　3、方便系统的整合<br />
　　　4、减少编写“硬代码”业务规则的成本和风险<br />
3.原理：<br />
<!-- more --><br />
	<img src="https://xiazemin.github.io/MyBlog/img/dtools.webp" /><br />
	使用方式：<br />
(1)Maven 依赖：</p><br />
<br />
<dependencies><br />
    <dependency><br />
        <groupId>org.kie</groupId><br />
        <artifactId>kie-api</artifactId><br />
        <version>6.5.0.Final</version><br />
    </dependency><br />
    <dependency><br />
        <groupId>org.drools</groupId><br />
        <artifactId>drools-compiler</artifactId><br />
        <version>6.5.0.Final</version><br />
        <scope>runtime</scope><br />
    </dependency><br />
    <dependency><br />
        <groupId>junit</groupId><br />
        <artifactId>junit</artifactId><br />
        <version>4.12</version><br />
    </dependency><br />
</dependencies><br />
<p>（2）新建配置文件/src/resources/META-INF/kmodule.xml</p><br />
<br />
<p>&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;</p><br />
<kmodule xmlns="http://jboss.org/kie/6.0.0/kmodule"><br />
    <kbase name="rules" packages="rules"><br />
        <ksession name="myAgeSession" /><br />
    </kbase><br />
</kmodule><br />
<p>（3）新建drools规则文件/src/resources/rules/age.drl</p><br />
<br />
<p>import com.lrq.wechatDemo.domain.User               // 导入类</p><br />
<br />
<p>dialect  “mvel”</p><br />
<br />
<p>rule “age”                                      // 规则名，唯一<br />
    when<br />
        $user : User(age&lt;15 || age&gt;60)     //规则的条件部分<br />
    then<br />
        System.out.println(“年龄不符合要求！”);<br />
end<br />
工程搭建完毕，效果如图：</p><br />
<br />
<p>项目结构.png<br />
测试用例：</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/26<br />
 <em>/<br />
@RunWith(SpringJUnit4ClassRunner.class)<br />
@ContextConfiguration(locations = {“classpath</em>:applicationContext.xml”})<br />
public class TestUser {</p><br />
<br />
    <p>private static KieContainer container = null;<br />
 private KieSession statefulKieSession = null;</p><br />
<br />
    <p>@Test<br />
 public void test(){<br />
     KieServices kieServices = KieServices.Factory.get();<br />
     container = kieServices.getKieClasspathContainer();<br />
     statefulKieSession = container.newKieSession(“myAgeSession”);<br />
     User user = new User(“duval yang”,12);<br />
     statefulKieSession.insert(user);<br />
     statefulKieSession.fireAllRules();<br />
     statefulKieSession.dispose();</p><br />
<br />
    <p>}</p><br />
  </li><br />
</ul><br />
<br />
<p>}</p><br />
<br />
<p>二.Aviator表达式求值引擎<br />
简介：<br />
Aviator是一个高性能、轻量级的java语言实现的表达式求值引擎，主要用于各<br />
种表达式的动态求值。现在已经有很多开源可用的java表达式求值引擎，为什<br />
么还需要Avaitor呢？</p><br />
<br />
<p>Aviator的设计目标是轻量级和高性能 ，相比于Groovy、JRuby的笨重，Aviator<br />
非常小，加上依赖包也才450K,不算依赖包的话只有70K；当然，Aviator的语法<br />
是受限的，它不是一门完整的语言，而只是语言的一小部分集合。</p><br />
<br />
<p>其次，Aviator的实现思路与其他轻量级的求值器很不相同，其他求值器一般都<br />
是通过解释的方式运行，而Aviator则是直接将表达式编译成Java字节码，交给<br />
JVM去执行。简单来说，Aviator的定位是介于Groovy这样的重量级脚本语言和<br />
IKExpression这样的轻量级表达式引擎之间。<br />
特性：<br />
（1）支持大部分运算操作符，包括算术操作符、关系运算符、逻辑操作符、<br />
正则匹配操作符(=~)、三元表达式?: ，并且支持操作符的优先级和括号强制优<br />
先级，具体请看后面的操作符列表。<br />
（2）支持函数调用和自定义函数。<br />
（3）支持正则表达式匹配，类似Ruby、Perl的匹配语法，并且支持类Ruby的<br />
$digit指向匹配分组。自动类型转换，当执行操作的时候，会自动判断操作数类<br />
型并做相应转换，无法转换即抛异常。<br />
（4）支持传入变量，支持类似a.b.c的嵌套变量访问。<br />
（5）性能优秀。<br />
（6）Aviator的限制，没有if else、do while等语句，没有赋值语句，仅支持逻<br />
辑表达式、算术表达式、三元表达式和正则匹配。没有位运算符</p><br />
<br />
<p>整体结构：</p><br />
<br />
<p>整体结构.png<br />
maven依赖：</p><br />
<br />
<dependency><br />
    <groupId>com.googlecode.aviator</groupId><br />
    <artifactId>aviator</artifactId><br />
    <version>${aviator.version}</version><br />
</dependency><br />
<p>执行方式<br />
执行表达式的方法有两个：execute()、exec();<br />
execute()，需要传递Map格式参数<br />
exec(),不需要传递Map<br />
示例：</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/25<br />
 */<br />
public class Test {<br />
 public static void main(String[] args) {<br />
     // exec执行方式，无需传递Map格式<br />
     String age = “18”;<br />
     System.out.println(AviatorEvaluator.exec(“‘His age is ‘+ age +’!’”, age));</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> // execute执行方式，需传递Map格式<br />
 Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();<br />
 map.put("age", "18");<br />
 System.out.println(AviatorEvaluator.execute("'His age is '+ age +'!'",  map));<br />
</code></pre></div>    </div><br />
<br />
    <p>}<br />
}<br />
使用函数<br />
Aviator可以使用两种函数：内置函数、自定义函数<br />
（1）内置函数</p><br />
  </li><br />
</ul><br />
<br />
<p>Aviator内置函数.png<br />
Aviator内置函数.png</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li>CreateDate: 2018/12/25<br />
 */<br />
public class Test {<br />
 public static void main(String[] args) {<br />
     Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();<br />
     map.put(“s1”,”123qwer”);<br />
     map.put(“s2”,”123”);</li><br />
</ul><br />
<br />
<p>System.out.println(AviatorEvaluator.execute(“string.startsWith(s1,s2)”,map));</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>} }<br />
</code></pre></div></div><br />
<br />
<p>（2）自定义函数</p><br />
<br />
<p>自定义函数要继承AbstractFunction类，重写目标方法。</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li>CreateDate: 2018/12/25<br />
 */<br />
public class Test {<br />
 public static void main(String[] args) {<br />
     // 注册自定义函数<br />
     AviatorEvaluator.addFunction(new MultiplyFunction());<br />
     // 方式1<br />
     System.out.println(AviatorEvaluator.execute(“multiply(12.23, -2.3)”));<br />
     // 方式2<br />
     Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();<br />
     params.put(“a”, 12.23);<br />
     params.put(“b”, -2.3);<br />
     System.out.println(AviatorEvaluator.execute(“multiply(a, b)”, params));<br />
 }</li><br />
</ul><br />
<br />
<p>}</p><br />
<br />
<p>class MultiplyFunction extends AbstractFunction{<br />
    @Override<br />
    public AviatorObject call(Map&lt;String, Object&gt; env, AviatorObject arg1, AviatorObject arg2) {</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    double num1 = FunctionUtils.getNumberValue(arg1, env).doubleValue();<br />
    double num2 = FunctionUtils.getNumberValue(arg2, env).doubleValue();<br />
    return new AviatorDouble(num1 * num2);<br />
}<br />
<br />
@Override<br />
public String getName() {<br />
    return "multiply";<br />
}<br />
</code></pre></div></div><br />
<br />
<p>}<br />
常用操作符的使用<br />
（1）操作符列表</p><br />
<br />
<p>操作符列表.png<br />
（2）常量和变量</p><br />
<br />
<p>常量和变量.png<br />
（3）编译表达式</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/25<br />
*/<br />
public class Test {<br />
 public static void main(String[] args) {<br />
     String expression = “a+(b-c)&gt;100”;<br />
     // 编译表达式<br />
     Expression compiledExp = AviatorEvaluator.compile(expression);</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Map&lt;String, Object&gt; env = new HashMap&lt;&gt;();<br />
 env.put("a", 100.3);<br />
 env.put("b", 45);<br />
 env.put("c", -199.100);<br />
<br />
 // 执行表达式<br />
 Boolean result = (Boolean) compiledExp.execute(env);<br />
 System.out.println(result);<br />
</code></pre></div>    </div><br />
<br />
    <p>}<br />
}</p><br />
  </li><br />
</ul><br />
<br />
<p>(4) 访问数组和集合<br />
List和数组用list[0]和array[0]，Map用map.date</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/25<br />
 */<br />
public class Test {<br />
 public static void main(String[] args) {</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> final List&lt;String&gt; list = new ArrayList&lt;&gt;();<br />
 list.add("hello");<br />
 list.add(" world");<br />
<br />
 final int[] array = new int[3];<br />
 array[0] = 0;<br />
 array[1] = 1;<br />
 array[2] = 3;<br />
<br />
 final Map&lt;String, Date&gt; map = new HashMap&lt;&gt;();<br />
 map.put("date", new Date());<br />
<br />
 Map&lt;String, Object&gt; env = new HashMap&lt;&gt;();<br />
 env.put("list", list);<br />
 env.put("array", array);<br />
 env.put("map", map);<br />
<br />
 System.out.println(AviatorEvaluator.execute(<br />
         "list[0]+':'+array[0]+':'+'today is '+map.date", env));<br />
</code></pre></div>    </div><br />
<br />
    <p>}</p><br />
  </li><br />
</ul><br />
<br />
<p>}<br />
（5） 三元比较符</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/25<br />
 */<br />
public class Test {<br />
 public static void main(String[] args) {</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Map&lt;String, Object&gt; env = new HashMap&lt;String, Object&gt;();<br />
 env.put("a", -5);<br />
 String result = (String) AviatorEvaluator.execute("a&gt;0? 'yes':'no'", env);<br />
 System.out.println(result);  }<br />
</code></pre></div>    </div><br />
  </li><br />
</ul><br />
<br />
<p>}<br />
(6) 正则表达式匹配</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li>CreateDate: 2018/12/25<br />
 */<br />
public class Test {<br />
 public static void main(String[] args) {<br />
     String email = “hello2018@gmail.com”;<br />
     Map&lt;String, Object&gt; env = new HashMap&lt;String, Object&gt;();<br />
     env.put(“email”, email);<br />
     String username = (String) AviatorEvaluator.execute(“email=~/([\w0-8]+)@\w+[\.\w+]+/ ? $1 : ‘unknow’ “, env);<br />
     System.out.println(username);<br />
 }<br />
}<br />
(7) 变量的语法糖衣</li><br />
</ul><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/25<br />
 */<br />
public class Test {<br />
 public static void main(String[] args) {<br />
     User user = new User(1,”jack”,”18”);<br />
     Map&lt;String, Object&gt; env = new HashMap&lt;&gt;();<br />
     env.put(“user”, user);</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> String result = (String) AviatorEvaluator.execute(" '[user id='+ user.id + ',name='+user.name + ',age=' +user.age +']' ", env);<br />
 System.out.println(result);  } }<br />
</code></pre></div>    </div><br />
  </li><br />
</ul><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/25<br />
 */<br />
public class User {</p><br />
<br />
    <p>private int id;</p><br />
<br />
    <p>private String name;</p><br />
<br />
    <p>private String age;</p><br />
<br />
    <p>public User() {<br />
 }</p><br />
<br />
    <p>public User(int id, String name, String age) {<br />
     this.id = id;<br />
     this.name = name;<br />
     this.age = age;<br />
 }</p><br />
<br />
    <p>public int getId() {<br />
     return id;<br />
 }</p><br />
<br />
    <p>public void setId(int id) {<br />
     this.id = id;<br />
 }</p><br />
<br />
    <p>public String getName() {<br />
     return name;<br />
 }</p><br />
<br />
    <p>public void setName(String name) {<br />
     this.name = name;<br />
 }</p><br />
<br />
    <p>public String getAge() {<br />
     return age;<br />
 }</p><br />
<br />
    <p>public void setAge(String age) {<br />
     this.age = age;<br />
 }</p><br />
<br />
    <p>@Override<br />
 public String toString() {<br />
     return “User{“ +<br />
             “id=” + id +<br />
             “, name=’” + name + ‘'’ +<br />
             “, age=’” + age + ‘'’ +<br />
             ‘}’;<br />
 }</p><br />
  </li><br />
</ul><br />
<br />
<p>}<br />
(8) nil对象[任何对象都比nil大除了nil本身]</p><br />
<br />
<p>nil是Aviator内置的常量，类似java中的null，表示空的值。nil跟null不同的在<br />
于，在java中null只能使用在==、!=的比较运算符，而nil还可以使用&gt;、&gt;=、<br />
&lt;、&lt;=等比较运算符。Aviator规定，[任何对象都比nil大除了nil本身]。用户传入<br />
的变量如果为null，将自动以nil替代。</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    AviatorEvaluator.execute("nil == nil");  //true <br />
    AviatorEvaluator.execute(" 3&gt; nil");    //true <br />
    AviatorEvaluator.execute(" true!= nil");    //true <br />
    AviatorEvaluator.execute(" ' '&gt;nil ");  //true <br />
    AviatorEvaluator.execute(" a==nil ");   //true,a is null nil与String相加的时候，跟java一样显示为null<br />
</code></pre></div></div><br />
<br />
<p>(9) 日期比较</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/25<br />
 */<br />
public class Test {<br />
 public static void main(String[] args) {<br />
     Map&lt;String, Object&gt; env = new HashMap&lt;String, Object&gt;();<br />
     final Date date = new Date();<br />
     String dateStr = new SimpleDateFormat(“yyyy-MM-dd HH:mm:ss:SS”).format(date);<br />
     env.put(“date”, date);<br />
     env.put(“dateStr”, dateStr);</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Boolean result = (Boolean) AviatorEvaluator.execute("date==dateStr",  env);<br />
 System.out.println(result);<br />
<br />
 result = (Boolean) AviatorEvaluator.execute("date &gt; '2009-12-20  00:00:00:00' ", env);<br />
 System.out.println(result);<br />
<br />
 result = (Boolean) AviatorEvaluator.execute("date &lt; '2200-12-20  00:00:00:00' ", env);<br />
 System.out.println(result);<br />
<br />
 result = (Boolean) AviatorEvaluator.execute("date ==date ", env);<br />
 System.out.println(result);<br />
</code></pre></div>    </div><br />
<br />
    <p>}<br />
}<br />
(10) 语法手册</p><br />
  </li><br />
</ul><br />
<br />
<p>数据类型<br />
Number类型：数字类型，支持两种类型，分别对应Java的Long和Double，也就是说任何整数都将被转换为Long，而任何浮点数都将被转换为Double，包括用户传入的数值也是如此转换。不支持科学计数法，仅支持十进制。如-1、100、2.3等。</p><br />
<br />
<p>String类型： 字符串类型，单引号或者双引号括起来的文本串，如’hello world’，变量如果传入的是String或者Character也将转为String类型。</p><br />
<br />
<p>Bool类型： 常量true和false，表示真值和假值，与java的Boolean.TRUE和Boolean.False对应。</p><br />
<br />
<p>Pattern类型： 类似Ruby、perl的正则表达式，以//括起来的字符串，如//d+/，内部实现为java.util.Pattern。</p><br />
<br />
<p>变量类型： 与Java的变量命名规则相同，变量的值由用户传入，如”a”、”b”等</p><br />
<br />
<p>nil类型: 常量nil,类似java中的null，但是nil比较特殊，nil不仅可以参与==、!=的比较，也可以参与&gt;、&gt;=、&lt;、&lt;=的比较，Aviator规定任何类型都n大于nil除了nil本身，nil==nil返回true。用户传入的变量值如果为null，那么也将作为nil处理，nil打印为null。</p><br />
<br />
<p>算术运算符<br />
Aviator支持常见的算术运算符，包括+ - <tt></tt> / % 五个二元运算符，和一元运算符”-“。其中 - <tt></tt> / %和一元的”-“仅能作用于Number类型。</p><br />
<br />
<p>”+”不仅能用于Number类型，还可以用于String的相加，或者字符串与其他对象的相加。Aviator规定，任何类型与String相加，结果为String。</p><br />
<br />
<p>逻辑运算符<br />
Avaitor的支持的逻辑运算符包括，一元否定运算符”!”，以及逻辑与的”&amp;&amp;”，逻辑或的”||”。逻辑运算符的操作数只能为Boolean。</p><br />
<br />
<p>关系运算符<br />
Aviator支持的关系运算符包括”&lt;” “&lt;=” “&gt;” “&gt;=” 以及”==”和”!=” 。<br />
&amp;&amp;和||都执行短路规则。</p><br />
<br />
<p>关系运算符可以作用于Number之间、String之间、Pattern之间、Boolean之间、变量之间以及其他类型与nil之间的关系比较，不同类型除了nil之外不能相互比较。</p><br />
<br />
<p>Aviator规定任何对象都比nil大除了nil之外。</p><br />
<br />
<p>匹配运算符<br />
匹配运算符”=~”用于String和Pattern的匹配，它的左操作数必须为String，右操作数必须为Pattern。匹配成功后，Pattern的分组将存于变量$num，num为分组索引。</p><br />
<br />
<p>三元运算符<br />
Aviator没有提供if else语句，但是提供了三元运算符 “?:”，形式为 bool ? exp1: exp2。 其中bool必须为结果为Boolean类型的表达式，而exp1和exp2可以为任何合法的Aviator表达式，并且不要求exp1和exp2返回的结果类型一致。</p><br />
<br />
<p>两种模式<br />
默认AviatorEvaluator以编译速度优先：<br />
AviatorEvaluator.setOptimize(AviatorEvaluator.COMPILE);<br />
你可以修改为运行速度优先，这会做更多的编译优化：<br />
AviatorEvaluator.setOptimize(AviatorEvaluator.EVAL);<br />
三.MVEL表达式解析器<br />
1.简介 ：</p><br />
<br />
<p>MVEL在很大程度上受到Java语法的启发，作为一个表达式语言，也有一些根本<br />
的区别，旨在更高的效率，例如：直接支持集合、数组和字符串匹配等操作以<br />
及正则表达式。 MVEL用于执行使用Java语法编写的表达式。<br />
2.特性：</p><br />
<br />
<p>MVEL是一个功能强大的基于Java应用程序的表达式语言。<br />
目前最新的版本是2.0，具有以下特性：<br />
(1). 动态JIT优化器。当负载超过一个确保代码产生的阈值时，选择性地产生字<br />
节代码,这大大减少了内存的使用量。新的静态类型检查和属性支持，允许集成<br />
类型安全表达。<br />
(2). 错误报告的改善。包括行和列的错误信息。<br />
(3). 新的脚本语言特征。MVEL2.0 包含函数定义，如：闭包，lambda定义，<br />
标准循环构造(for, while, do-while, do-until…)，空值安全导航操作，内联with<br />
-context运营 ，易变的（isdef）的测试运营等等。<br />
(4). 改进的集成功能。迎合主流的需求，MVEL2.0支持基础类型的个性化属性处理器，集成到JIT中。<br />
(5). 更快的模板引擎，支持线性模板定义，宏定义和个性化标记定义。<br />
(6). 新的交互式shell（MVELSH）。</p><br />
<br />
<p>(7). 缺少可选类型安全<br />
(8). 集成不良，通常通过映射填入内容。没有字节码不能运作用字节码生成编<br />
译时间慢，还增加了可扩展性问题；不用字节码生成运行时执行非常慢<br />
(9). 内存消耗过大<br />
(10). Jar巨大/依赖规模<br />
3.原理：</p><br />
<br />
<p>与java不同，MVEL是动态类型（带有可选分类），也就是说在源文件中是没有<br />
类型限制的。一条MVEL表达式，简单的可以是单个标识符，复杂的则可能是<br />
一个充满了方法调用和内部集合创建的庞大的布尔表达式。<br />
4.使用方式：<br />
maven引入jar：</p><br />
<br />
<dependency><br />
            <groupId>org.mvel</groupId><br />
            <artifactId>mvel2</artifactId><br />
            <version>2.3.1.Final</version><br />
        </dependency><br />
<br />
<p>测试：</p><br />
<br />
<p>package com.lrq.wechatdemo.utils;</p><br />
<br />
<p>import com.google.common.collect.Maps;<br />
import org.mvel2.MVEL;</p><br />
<br />
<p>import java.util.Map;</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/26<br />
 */<br />
public class MvelUtils {</p><br />
<br />
    <p>public static void main(String[] args) {<br />
     String expression = “a == null &amp;&amp; b == nil “;<br />
     Map&lt;String,Object&gt; map = Maps.newHashMap();<br />
     map.put(“a”,null);<br />
     map.put(“b”,null);</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Object object = MVEL.eval(expression,map);<br />
 System.out.println(object);  }<br />
</code></pre></div>    </div><br />
  </li><br />
</ul><br />
<br />
<p>}<br />
四.EasyRules规则引擎<br />
1.简介：</p><br />
<br />
<p>easy-rules首先集成了mvel表达式，后续可能集成SpEL的一款轻量<br />
级规则引擎<br />
2.特性：</p><br />
<br />
<p>easy rules是一个简单而强大的java规则引擎，它有以下特性：</p><br />
<br />
<p>轻量级框架，学习成本低<br />
基于POJO<br />
为定义业务引擎提供有用的抽象和简便的应用<br />
从原始的规则组合成复杂的规则<br />
它主要包括几个主要的类或接口：Rule,RulesEngine,RuleListener,Facts <br />
还有几个主要的注解：@Action,@Condition,@Fact,@Priority,@Rule<br />
3.使用方式：</p><br />
<br />
<p>@Rule可以标注name和description属性，每个rule的name要唯一，<br />
如果没有指定，则RuleProxy则默认取类名<br />
@Condition是条件判断，要求返回boolean值，表示是否满足条件</p><br />
<br />
<p>@Action标注条件成立之后触发的方法</p><br />
<br />
<p>@Priority标注该rule的优先级，默认是Integer.MAX_VALUE - 1，值<br />
越小越优先</p><br />
<br />
<p>@Fact 我们要注意Facts的使用。Facts的用法很像Map，它是客户<br />
端和规则文件之间通信的桥梁。在客户端使用put方法向Facts中添<br />
加数据，在规则文件中通过key来得到相应的数据。<br />
有两种使用方式：</p><br />
<br />
<p>java方式<br />
首先先创建规则并标注属性<br />
package com.lrq.wechatdemo.rules;</p><br />
<br />
<p>import org.jeasy.rules.annotation.Action;<br />
import org.jeasy.rules.annotation.Condition;<br />
import org.jeasy.rules.annotation.Fact;<br />
import org.jeasy.rules.annotation.Rule;<br />
import org.jeasy.rules.support.UnitRuleGroup;</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/26<br />
 */<br />
public class RuleClass {</p><br />
<br />
    <p>@Rule(priority = 1) //规则设定优先级<br />
 public static class FizzRule {<br />
     @Condition<br />
     public boolean isFizz(@Fact(“number”) Integer number) {<br />
         return number % 5 == 0;<br />
     }</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> @Action<br />
 public void printFizz() {<br />
     System.out.print("fizz\n");<br />
 }  }<br />
</code></pre></div>    </div><br />
<br />
    <p>@Rule(priority = 2)<br />
 public static class BuzzRule {<br />
     @Condition<br />
     public boolean isBuzz(@Fact(“number”) Integer number) {<br />
         return number % 7 == 0;<br />
     }</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> @Action<br />
 public void printBuzz() {<br />
     System.out.print("buzz\n");<br />
 }  }<br />
</code></pre></div>    </div><br />
<br />
    <p>public static class FizzBuzzRule extends UnitRuleGroup {</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> public FizzBuzzRule(Object... rules) {<br />
     for (Object rule : rules) {<br />
         addRule(rule);<br />
     }<br />
 }<br />
<br />
 @Override<br />
 public int getPriority() {<br />
     return 0;<br />
 }  }<br />
</code></pre></div>    </div><br />
<br />
    <p>@Rule(priority = 3)<br />
 public static class NonFizzBuzzRule {</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> @Condition<br />
 public boolean isNotFizzNorBuzz(@Fact("number") Integer number) {<br />
     // can return true, because this is the latest rule to trigger according to<br />
     // assigned priorities<br />
     // and in which case, the number is not fizz nor buzz<br />
     return number % 5 != 0 || number % 7 != 0;<br />
 }<br />
<br />
 @Action<br />
 public void printInput(@Fact("number") Integer number) {<br />
     System.out.print(number+"\n");<br />
 }  }<br />
</code></pre></div>    </div><br />
  </li><br />
</ul><br />
<br />
<p>}<br />
然后客户端调用</p><br />
<br />
<p>package com.lrq.wechatdemo.rules;</p><br />
<br />
<p>import org.jeasy.rules.api.Facts;<br />
import org.jeasy.rules.api.Rules;<br />
import org.jeasy.rules.api.RulesEngine;<br />
import org.jeasy.rules.core.DefaultRulesEngine;<br />
import org.jeasy.rules.core.RulesEngineParameters;</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/26<br />
 */<br />
public class RuleJavaClient {<br />
 public static void main(String[] args) {<br />
     // 创建规则引擎<br />
     RulesEngineParameters parameters = new RulesEngineParameters().skipOnFirstAppliedRule(true);<br />
     RulesEngine fizzBuzzEngine = new DefaultRulesEngine(parameters);</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> // 创建规则集并注册规则<br />
 Rules rules = new Rules();<br />
 rules.register(new RuleClass.FizzRule());<br />
 rules.register(new RuleClass.BuzzRule());<br />
 rules.register(new RuleClass.FizzBuzzRule(new RuleClass.FizzRule(), new RuleClass.BuzzRule()));<br />
 rules.register(new RuleClass.NonFizzBuzzRule());<br />
<br />
 // 执行规则<br />
 Facts facts = new Facts();<br />
 for (int i = 1; i &lt;= 100; i++) {<br />
     facts.put("number", i);<br />
     fizzBuzzEngine.fire(rules, facts);<br />
     System.out.println();<br />
 }  }<br />
</code></pre></div>    </div><br />
  </li><br />
</ul><br />
<br />
<p>}</p><br />
<br />
<p>2.yml方式</p><br />
<br />
<p>resources目录下新建fizzbuzz.yml</p><br />
<br />
<hr /><br />
<p>name: “fizz rule”<br />
description: “print fizz if the number is multiple of 5”<br />
priority: 1<br />
condition: “number % 5 == 0”<br />
actions:</p><br />
<ul><br />
  <li>“System.out.println("fizz")”</li><br />
</ul><br />
<br />
<hr /><br />
<p>name: “buzz rule”<br />
description: “print buzz if the number is multiple of 7”<br />
priority: 2<br />
condition: “number % 7 == 0”<br />
actions:</p><br />
<ul><br />
  <li>“System.out.println("buzz")”</li><br />
</ul><br />
<br />
<hr /><br />
<p>name: “fizzbuzz rule”<br />
description: “print fizzbuzz if the number is multiple of 5 and 7”<br />
priority: 0<br />
condition: “number % 5 == 0 &amp;&amp; number % 7 == 0”<br />
actions:</p><br />
<ul><br />
  <li>“System.out.println("fizzbuzz")”</li><br />
</ul><br />
<br />
<hr /><br />
<p>name: “non fizzbuzz rule”<br />
description: “print the number itself otherwise”<br />
priority: 3<br />
condition: “number % 5 != 0 || number % 7 != 0”<br />
actions:</p><br />
<ul><br />
  <li>“System.out.println(number)”<br />
客户端调用：</li><br />
</ul><br />
<br />
<p>package com.lrq.wechatdemo.rules;</p><br />
<br />
<p>import org.jeasy.rules.api.Facts;<br />
import org.jeasy.rules.api.Rules;<br />
import org.jeasy.rules.api.RulesEngine;<br />
import org.jeasy.rules.core.DefaultRulesEngine;<br />
import org.jeasy.rules.core.RulesEngineParameters;<br />
import org.jeasy.rules.mvel.MVELRuleFactory;</p><br />
<br />
<p>import java.io.FileNotFoundException;<br />
import java.io.FileReader;</p><br />
<br />
<p>/**</p><br />
<ul><br />
  <li>CreateBy: haleyliu</li><br />
  <li><br />
    <p>CreateDate: 2018/12/26<br />
 */<br />
public class RuleYmlClient {</p><br />
<br />
    <p>public static void main(String[] args) throws FileNotFoundException {<br />
     // create a rules engine<br />
     RulesEngineParameters parameters = new RulesEngineParameters().skipOnFirstAppliedRule(true);<br />
     RulesEngine fizzBuzzEngine = new DefaultRulesEngine(parameters);</p><br />
<br />
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> // create rules<br />
 Rules rules = MVELRuleFactory.createRulesFrom(new FileReader("fizzbuzz.yml"));<br />
<br />
 // fire rules<br />
 Facts facts = new Facts();<br />
 for (int i = 1; i &lt;= 100; i++) {<br />
     facts.put("number", i);<br />
     fizzBuzzEngine.fire(rules, facts);<br />
     System.out.println();<br />
 }  } }<br />
</code></pre></div>    </div><br />
  </li><br />
</ul><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category web
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>