<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">Node.js RESTful API</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-02-17T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Feb 17, 2020</time></p>
					</div>
					 <p>什么是 REST？<br />
REST即表述性状态传递（英文：Representational State Transfer，简称REST）是Roy Fielding博士在2000年他的博士论文中提出来的一种软件架构风格。</p><br />
<br />
<p>表述性状态转移是一组架构约束条件和原则。满足这些约束条件和原则的应用程序或设计就是RESTful。需要注意的是，REST是设计风格而不是标准。REST通常基于使用HTTP，URI，和XML（标准通用标记语言下的一个子集）以及HTML（标准通用标记语言下的一个应用）这些现有的广泛流行的协议和标准。REST 通常使用 JSON 数据格式。</p><br />
<br />
<p>HTTP 方法<br />
以下为 REST 基本架构的四个方法：<br />
GET - 用于获取数据。</p><br />
<br />
<p>PUT - 用于更新或添加数据。</p><br />
<br />
<p>DELETE - 用于删除数据。</p><br />
<br />
<p>POST - 用于添加数据。</p><br />
<br />
<p>RESTful Web Services<br />
Web service是一个平台独立的，低耦合的，自包含的、基于可编程的web的应用程序，可使用开放的XML（标准通用标记语言下的一个子集）标准来描述、发布、发现、协调和配置这些应用程序，用于开发分布式的互操作的应用程序。</p><br />
<br />
<p>基于 REST 架构的 Web Services 即是 RESTful。</p><br />
<br />
<p>由于轻量级以及通过 HTTP 直接传输数据的特性，Web 服务的 RESTful 方法已经成为最常见的替代方法。可以使用各种语言（比如 Java 程序、Perl、Ruby、Python、PHP 和 Javascript[包括 Ajax]）实现客户端。</p><br />
<br />
<p>RESTful Web 服务通常可以通过自动客户端或代表用户的应用程序访问。但是，这种服务的简便性让用户能够与之直接交互，使用它们的 Web 浏览器构建一个 GET URL 并读取返回的内容。</p><br />
<br />
<p>更多介绍，可以查看：RESTful 架构详解</p><br />
<br />
<p>创建 RESTful<br />
首先，创建一个 json 数据资源文件 users.json，内容如下：</p><br />
<br />
<p>{<br />
   “user1” : {<br />
      “name” : “mahesh”,<br />
      “password” : “password1”,<br />
      “profession” : “teacher”,<br />
      “id”: 1<br />
   },<br />
   “user2” : {<br />
      “name” : “suresh”,<br />
      “password” : “password2”,<br />
      “profession” : “librarian”,<br />
      “id”: 2<br />
   },<br />
   “user3” : {<br />
      “name” : “ramesh”,<br />
      “password” : “password3”,<br />
      “profession” : “clerk”,<br />
      “id”: 3<br />
   }<br />
}<br />
基于以上数据，我们创建以下 RESTful API：</p><br />
<br />
<p>序号	URI	HTTP 方法	发送内容	结果<br />
1	listUsers	GET	空	显示所有用户列表<br />
2	addUser	POST	JSON 字符串	添加新用户<br />
3	deleteUser	DELETE	JSON 字符串	删除用户<br />
4	:id	GET	空	显示用户详细信息<br />
获取用户列表：<br />
以下代码，我们创建了 RESTful API listUsers，用于读取用户的信息列表， server.js 文件代码如下所示：</p><br />
<br />
<p>var express = require(‘express’);<br />
var app = express();<br />
var fs = require(“fs”);</p><br />
<br />
<p>app.get(‘/listUsers’, function (req, res) {<br />
   fs.readFile( __dirname + “/” + “users.json”, ‘utf8’, function (err, data) {<br />
       console.log( data );<br />
       res.end( data );<br />
   });<br />
})</p><br />
<br />
<p>var server = app.listen(8081, function () {</p><br />
<br />
<p>var host = server.address().address<br />
  var port = server.address().port</p><br />
<br />
<p>console.log(“应用实例，访问地址为 http://%s:%s”, host, port)</p><br />
<br />
<p>})<br />
接下来执行以下命令：</p><br />
<br />
<p>$ node server.js <br />
应用实例，访问地址为 http://0.0.0.0:8081<br />
在浏览器中访问 http://127.0.0.1:8081/listUsers，结果如下所示：</p><br />
<br />
<p>{<br />
   “user1” : {<br />
      “name” : “mahesh”,<br />
      “password” : “password1”,<br />
      “profession” : “teacher”,<br />
      “id”: 1<br />
   },<br />
   “user2” : {<br />
      “name” : “suresh”,<br />
      “password” : “password2”,<br />
      “profession” : “librarian”,<br />
      “id”: 2<br />
   },<br />
   “user3” : {<br />
      “name” : “ramesh”,<br />
      “password” : “password3”,<br />
      “profession” : “clerk”,<br />
      “id”: 3<br />
   }<br />
}<br />
添加用户<br />
以下代码，我们创建了 RESTful API addUser， 用于添加新的用户数据，server.js 文件代码如下所示：</p><br />
<br />
<p>var express = require(‘express’);<br />
var app = express();<br />
var fs = require(“fs”);</p><br />
<br />
<p>//添加的新用户数据<br />
var user = {<br />
   “user4” : {<br />
      “name” : “mohit”,<br />
      “password” : “password4”,<br />
      “profession” : “teacher”,<br />
      “id”: 4<br />
   }<br />
}</p><br />
<br />
<p>app.get(‘/addUser’, function (req, res) {<br />
   // 读取已存在的数据<br />
   fs.readFile( __dirname + “/” + “users.json”, ‘utf8’, function (err, data) {<br />
       data = JSON.parse( data );<br />
       data[“user4”] = user[“user4”];<br />
       console.log( data );<br />
       res.end( JSON.stringify(data));<br />
   });<br />
})</p><br />
<br />
<p>var server = app.listen(8081, function () {</p><br />
<br />
<p>var host = server.address().address<br />
  var port = server.address().port<br />
  console.log(“应用实例，访问地址为 http://%s:%s”, host, port)</p><br />
<br />
<p>})<br />
接下来执行以下命令：</p><br />
<br />
<p>$ node server.js <br />
应用实例，访问地址为 http://0.0.0.0:8081<br />
在浏览器中访问 http://127.0.0.1:8081/addUser，结果如下所示：</p><br />
<br />
<p>{ user1:<br />
   { name: ‘mahesh’,<br />
     password: ‘password1’,<br />
     profession: ‘teacher’,<br />
     id: 1 },<br />
  user2:<br />
   { name: ‘suresh’,<br />
     password: ‘password2’,<br />
     profession: ‘librarian’,<br />
     id: 2 },<br />
  user3:<br />
   { name: ‘ramesh’,<br />
     password: ‘password3’,<br />
     profession: ‘clerk’,<br />
     id: 3 },<br />
  user4:<br />
   { name: ‘mohit’,<br />
     password: ‘password4’,<br />
     profession: ‘teacher’,<br />
     id: 4 } <br />
}<br />
显示用户详情<br />
以下代码，我们创建了 RESTful API :id（用户id）， 用于读取指定用户的详细信息，server.js 文件代码如下所示：</p><br />
<br />
<p>var express = require(‘express’);<br />
var app = express();<br />
var fs = require(“fs”);</p><br />
<br />
<p>app.get(‘/:id’, function (req, res) {<br />
   // 首先我们读取已存在的用户<br />
   fs.readFile( __dirname + “/” + “users.json”, ‘utf8’, function (err, data) {<br />
       data = JSON.parse( data );<br />
       var user = data[“user” + req.params.id] <br />
       console.log( user );<br />
       res.end( JSON.stringify(user));<br />
   });<br />
})</p><br />
<br />
<p>var server = app.listen(8081, function () {</p><br />
<br />
<p>var host = server.address().address<br />
  var port = server.address().port<br />
  console.log(“应用实例，访问地址为 http://%s:%s”, host, port)</p><br />
<br />
<p>})<br />
接下来执行以下命令：</p><br />
<br />
<p>$ node server.js <br />
应用实例，访问地址为 http://0.0.0.0:8081<br />
在浏览器中访问 http://127.0.0.1:8081/2，结果如下所示：</p><br />
<br />
<p>{<br />
   “name”:”suresh”,<br />
   “password”:”password2”,<br />
   “profession”:”librarian”,<br />
   “id”:2<br />
}<br />
删除用户<br />
以下代码，我们创建了 RESTful API deleteUser， 用于删除指定用户的详细信息，以下实例中，用户 id 为 2，server.js 文件代码如下所示：</p><br />
<br />
<p>var express = require(‘express’);<br />
var app = express();<br />
var fs = require(“fs”);</p><br />
<br />
<p>var id = 2;</p><br />
<br />
<p>app.get(‘/deleteUser’, function (req, res) {</p><br />
<br />
<p>// First read existing users.<br />
   fs.readFile( __dirname + “/” + “users.json”, ‘utf8’, function (err, data) {<br />
       data = JSON.parse( data );<br />
       delete data[“user” + id];</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   console.log( data );<br />
   res.end( JSON.stringify(data));    }); })<br />
</code></pre></div></div><br />
<br />
<p>var server = app.listen(8081, function () {</p><br />
<br />
<p>var host = server.address().address<br />
  var port = server.address().port<br />
  console.log(“应用实例，访问地址为 http://%s:%s”, host, port)</p><br />
<br />
<p>})<br />
接下来执行以下命令：</p><br />
<br />
<p>$ node server.js <br />
应用实例，访问地址为 http://0.0.0.0:8081<br />
在浏览器中访问 http://127.0.0.1:8081/deleteUser，结果如下所示：</p><br />
<br />
<p>{ user1:<br />
   { name: ‘mahesh’,<br />
     password: ‘password1’,<br />
     profession: ‘teacher’,<br />
     id: 1 },<br />
  user3:<br />
   { name: ‘ramesh’,<br />
     password: ‘password3’,<br />
     profession: ‘clerk’,<br />
     id: 3 } <br />
}<br />
<!-- more --><br />
Node.js 多进程<br />
我们都知道 Node.js 是以单线程的模式运行的，但它使用的是事件驱动来处理并发，这样有助于我们在多核 cpu 的系统上创建多个子进程，从而提高性能。</p><br />
<br />
<p>每个子进程总是带有三个流对象：child.stdin, child.stdout 和child.stderr。他们可能会共享父进程的 stdio 流，或者也可以是独立的被导流的流对象。</p><br />
<br />
<p>Node 提供了 child_process 模块来创建子进程，方法有：</p><br />
<br />
<p>exec - child_process.exec 使用子进程执行命令，缓存子进程的输出，并将子进程的输出以回调函数参数的形式返回。</p><br />
<br />
<p>spawn - child_process.spawn 使用指定的命令行参数创建新进程。</p><br />
<br />
<p>fork - child_process.fork 是 spawn()的特殊形式，用于在子进程中运行的模块，如 fork(‘./son.js’) 相当于 spawn(‘node’, [’./son.js’]) 。与spawn方法不同的是，fork会在父进程与子进程之间，建立一个通信管道，用于进程之间的通信。</p><br />
<br />
<p>exec() 方法<br />
child_process.exec 使用子进程执行命令，缓存子进程的输出，并将子进程的输出以回调函数参数的形式返回。</p><br />
<br />
<p>语法如下所示：</p><br />
<br />
<p>child_process.exec(command[, options], callback)<br />
参数<br />
参数说明如下：</p><br />
<br />
<p>command： 字符串， 将要运行的命令，参数使用空格隔开</p><br />
<br />
<p>options ：对象，可以是：</p><br />
<br />
<p>cwd ，字符串，子进程的当前工作目录<br />
env，对象 环境变量键值对<br />
encoding ，字符串，字符编码（默认： ‘utf8’）<br />
shell ，字符串，将要执行命令的 Shell（默认: 在 UNIX 中为/bin/sh， 在 Windows 中为cmd.exe， Shell 应当能识别 -c开关在 UNIX 中，或 /s /c 在 Windows 中。 在Windows 中，命令行解析应当能兼容cmd.exe）<br />
timeout，数字，超时时间（默认： 0）<br />
maxBuffer，数字， 在 stdout 或 stderr 中允许存在的最大缓冲（二进制），如果超出那么子进程将会被杀死 （默认: 200*1024）<br />
killSignal ，字符串，结束信号（默认：’SIGTERM’）<br />
uid，数字，设置用户进程的 ID<br />
gid，数字，设置进程组的 ID<br />
callback ：回调函数，包含三个参数error, stdout 和 stderr。</p><br />
<br />
<p>exec() 方法返回最大的缓冲区，并等待进程结束，一次性返回缓冲区的内容。</p><br />
<br />
<p>实例<br />
让我们创建两个 js 文件 support.js 和 master.js。</p><br />
<br />
<p>support.js 文件代码：<br />
console.log(“进程 “ + process.argv[2] + “ 执行。” );<br />
master.js 文件代码：<br />
const fs = require(‘fs’);<br />
const child_process = require(‘child_process’);</p><br />
<br />
<p>for(var i=0; i&lt;3; i++) {<br />
    var workerProcess = child_process.exec(‘node support.js ‘+i, function (error, stdout, stderr) {<br />
        if (error) {<br />
            console.log(error.stack);<br />
            console.log(‘Error code: ‘+error.code);<br />
            console.log(‘Signal received: ‘+error.signal);<br />
        }<br />
        console.log(‘stdout: ‘ + stdout);<br />
        console.log(‘stderr: ‘ + stderr);<br />
    });</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>workerProcess.on('exit', function (code) {<br />
    console.log('子进程已退出，退出码 '+code);<br />
}); } 执行以上代码，输出结果为：<br />
</code></pre></div></div><br />
<br />
<p>$ node master.js <br />
子进程已退出，退出码 0<br />
stdout: 进程 1 执行。</p><br />
<br />
<p>stderr: <br />
子进程已退出，退出码 0<br />
stdout: 进程 0 执行。</p><br />
<br />
<p>stderr: <br />
子进程已退出，退出码 0<br />
stdout: 进程 2 执行。</p><br />
<br />
<p>stderr: <br />
spawn() 方法<br />
child_process.spawn 使用指定的命令行参数创建新进程，语法格式如下：</p><br />
<br />
<p>child_process.spawn(command[, args][, options])<br />
参数<br />
参数说明如下：</p><br />
<br />
<p>command： 将要运行的命令</p><br />
<br />
<p>args： Array 字符串参数数组</p><br />
<br />
<p>options Object</p><br />
<br />
<p>cwd String 子进程的当前工作目录<br />
env Object 环境变量键值对<br />
stdio Array|String 子进程的 stdio 配置<br />
detached Boolean 这个子进程将会变成进程组的领导<br />
uid Number 设置用户进程的 ID<br />
gid Number 设置进程组的 ID<br />
spawn() 方法返回流 (stdout &amp; stderr)，在进程返回大量数据时使用。进程一旦开始执行时 spawn() 就开始接收响应。</p><br />
<br />
<p>实例<br />
让我们创建两个 js 文件 support.js 和 master.js。</p><br />
<br />
<p>support.js 文件代码：<br />
console.log(“进程 “ + process.argv[2] + “ 执行。” );<br />
master.js 文件代码：<br />
const fs = require(‘fs’);<br />
const child_process = require(‘child_process’);</p><br />
<br />
<p>for(var i=0; i&lt;3; i++) {<br />
   var workerProcess = child_process.spawn(‘node’, [‘support.js’, i]);</p><br />
<br />
<p>workerProcess.stdout.on(‘data’, function (data) {<br />
      console.log(‘stdout: ‘ + data);<br />
   });</p><br />
<br />
<p>workerProcess.stderr.on(‘data’, function (data) {<br />
      console.log(‘stderr: ‘ + data);<br />
   });</p><br />
<br />
<p>workerProcess.on(‘close’, function (code) {<br />
      console.log(‘子进程已退出，退出码 ‘+code);<br />
   });<br />
}<br />
执行以上代码，输出结果为：</p><br />
<br />
<p>$ node master.js stdout: 进程 0 执行。</p><br />
<br />
<p>子进程已退出，退出码 0<br />
stdout: 进程 1 执行。</p><br />
<br />
<p>子进程已退出，退出码 0<br />
stdout: 进程 2 执行。</p><br />
<br />
<p>子进程已退出，退出码 0<br />
fork 方法<br />
child_process.fork 是 spawn() 方法的特殊形式，用于创建进程，语法格式如下：</p><br />
<br />
<p>child_process.fork(modulePath[, args][, options])<br />
参数<br />
参数说明如下：</p><br />
<br />
<p>modulePath： String，将要在子进程中运行的模块</p><br />
<br />
<p>args： Array 字符串参数数组</p><br />
<br />
<p>options：Object</p><br />
<br />
<p>cwd String 子进程的当前工作目录<br />
env Object 环境变量键值对<br />
execPath String 创建子进程的可执行文件<br />
execArgv Array 子进程的可执行文件的字符串参数数组（默认： process.execArgv）<br />
silent Boolean 如果为true，子进程的stdin，stdout和stderr将会被关联至父进程，否则，它们将会从父进程中继承。（默认为：false）<br />
uid Number 设置用户进程的 ID<br />
gid Number 设置进程组的 ID<br />
返回的对象除了拥有ChildProcess实例的所有方法，还有一个内建的通信信道。</p><br />
<br />
<p>实例<br />
让我们创建两个 js 文件 support.js 和 master.js。</p><br />
<br />
<p>support.js 文件代码：<br />
console.log(“进程 “ + process.argv[2] + “ 执行。” );<br />
master.js 文件代码：<br />
const fs = require(‘fs’);<br />
const child_process = require(‘child_process’);</p><br />
<br />
<p>for(var i=0; i&lt;3; i++) {<br />
   var worker_process = child_process.fork(“support.js”, [i]);</p><br />
<br />
<p>worker_process.on(‘close’, function (code) {<br />
      console.log(‘子进程已退出，退出码 ‘ + code);<br />
   });<br />
}<br />
执行以上代码，输出结果为：</p><br />
<br />
<p>$ node master.js <br />
进程 0 执行。<br />
子进程已退出，退出码 0<br />
进程 1 执行。<br />
子进程已退出，退出码 0<br />
进程 2 执行。<br />
子进程已退出，退出码 0</p><br />
<br />
<p>Node.js JXcore 打包<br />
Node.js 是一个开放源代码、跨平台的、用于服务器端和网络应用的运行环境。</p><br />
<br />
<p>JXcore 是一个支持多线程的 Node.js 发行版本，基本不需要对你现有的代码做任何改动就可以直接线程安全地以多线程运行。</p><br />
<br />
<p>这篇文章主要是要向大家介绍 JXcore 的打包功能。</p><br />
<br />
<p>JXcore 安装<br />
下载 JXcore 安装包，并解压，在解压的的目录下提供了 jx 二进制文件命令，接下来我们主要使用这个命令。</p><br />
<br />
<p>步骤1、下载<br />
下载 JXcore 安装包 https://github.com/jxcore/jxcore-release，你需要根据你自己的系统环境来下载安装包。</p><br />
<br />
<p>1、Window 平台下载：Download(Windows x64 (V8))。</p><br />
<br />
<p>2、Linux/OSX 安装命令：</p><br />
<br />
<p>$ curl https://raw.githubusercontent.com/jxcore/jxcore/master/tools/jx_install.sh | bash<br />
如果权限不足，可以使用以下命令：</p><br />
<br />
<p>$ curl https://raw.githubusercontent.com/jxcore/jxcore/master/tools/jx_install.sh | sudo bash<br />
以上步骤如果操作正确，使用以下命令，会输出版本号信息：</p><br />
<br />
<p>$ jx –version<br />
v0.10.32<br />
包代码<br />
例如，我们的 Node.js 项目包含以下几个文件，其中 index.js 是主文件：</p><br />
<br />
<p>drwxr-xr-x  2 root root  4096 Nov 13 12:42 images<br />
-rwxr-xr-x  1 root root 30457 Mar  6 12:19 index.htm<br />
-rwxr-xr-x  1 root root 30452 Mar  1 12:54 index.js<br />
drwxr-xr-x 23 root root  4096 Jan 15 03:48 node_modules<br />
drwxr-xr-x  2 root root  4096 Mar 21 06:10 scripts<br />
drwxr-xr-x  2 root root  4096 Feb 15 11:56 style<br />
接下来我们使用 jx 命令打包以上项目，并指定 index.js 为 Node.js 项目的主文件：</p><br />
<br />
<p>$ jx package index.js index<br />
以上命令执行成功，会生成以下两个文件：</p><br />
<br />
<p>index.jxp 这是一个中间件文件，包含了需要编译的完整项目信息。</p><br />
<br />
<p>index.jx 这是一个完整包信息的二进制文件，可运行在客户端上。</p><br />
<br />
<p>载入 JX 文件<br />
Node.js 的项目运行：</p><br />
<br />
<p>$ node index.js command_line_arguments<br />
使用 JXcore 编译后，我们可以使用以下命令来执行生成的 jx 二进制文件：</p><br />
<br />
<p>$ jx index.jx command_line_arguments<br />
更多 JXcore 安装参考：https://github.com/jxcore/jxcore/blob/master/doc/INSTALLATION.md。</p><br />
<br />
<p>更多 JXcore 功能特性你可以参考官网：https://github.com/jxcore/jxcore。</p><br />
<br />
<p>Node.js 连接 MySQL<br />
本章节我们将为大家介绍如何使用 Node.js 来连接 MySQL，并对数据库进行操作。</p><br />
<br />
<p>如果你还没有 MySQL 的基本知识，可以参考我们的教程：MySQL 教程。</p><br />
<br />
<p>本教程使用到的 Websites 表 SQL 文件：websites.sql。</p><br />
<br />
<p>安装驱动<br />
本教程使用了淘宝定制的 cnpm 命令进行安装：</p><br />
<br />
<p>$ cnpm install mysql<br />
连接数据库<br />
在以下实例中根据你的实际配置修改数据库用户名、及密码及数据库名：</p><br />
<br />
<p>test.js 文件代码：<br />
var mysql      = require(‘mysql’);<br />
var connection = mysql.createConnection({<br />
  host     : ‘localhost’,<br />
  user     : ‘root’,<br />
  password : ‘123456’,<br />
  database : ‘test’<br />
});</p><br />
<br />
<p>connection.connect();</p><br />
<br />
<p>connection.query(‘SELECT 1 + 1 AS solution’, function (error, results, fields) {<br />
  if (error) throw error;<br />
  console.log(‘The solution is: ‘, results[0].solution);<br />
});<br />
执行以下命令输出结果为：</p><br />
<br />
<p>$ node test.js<br />
The solution is: 2<br />
数据库连接参数说明：<br />
参数	描述<br />
host	主机地址 （默认：localhost）<br />
　　user	用户名<br />
　　password	密码<br />
　　port	端口号 （默认：3306）<br />
　　database	数据库名<br />
　　charset	连接字符集（默认：’UTF8_GENERAL_CI’，注意字符集的字母都要大写）<br />
　　localAddress	此IP用于TCP连接（可选）<br />
　　socketPath	连接到unix域路径，当使用 host 和 port 时会被忽略<br />
　　timezone	时区（默认：’local’）<br />
　　connectTimeout	连接超时（默认：不限制；单位：毫秒）<br />
　　stringifyObjects	是否序列化对象<br />
　　typeCast	是否将列值转化为本地JavaScript类型值 （默认：true）<br />
　　queryFormat	自定义query语句格式化方法<br />
　　supportBigNumbers	数据库支持bigint或decimal类型列时，需要设此option为true （默认：false）<br />
　　bigNumberStrings	supportBigNumbers和bigNumberStrings启用 强制bigint或decimal列以JavaScript字符串类型返回（默认：false）<br />
　　dateStrings	强制timestamp,datetime,data类型以字符串类型返回，而不是JavaScript Date类型（默认：false）<br />
　　debug	开启调试（默认：false）<br />
　　multipleStatements	是否许一个query中有多个MySQL语句 （默认：false）<br />
　　flags	用于修改连接标志<br />
　　ssl	使用ssl参数（与crypto.createCredenitals参数格式一至）或一个包含ssl配置文件名称的字符串，目前只捆绑Amazon RDS的配置文件<br />
更多说明可参见：https://github.com/mysqljs/mysql</p><br />
<br />
<p>数据库操作( CURD )<br />
在进行数据库操作前，你需要将本站提供的 Websites 表 SQL 文件websites.sql 导入到你的 MySQL 数据库中。</p><br />
<br />
<p>本教程测试的 MySQL 用户名为 root，密码为 123456，数据库为 test，你需要根据自己配置情况修改。</p><br />
<br />
<p>查询数据<br />
将上面我们提供的 SQL 文件导入数据库后，执行以下代码即可查询出数据：</p><br />
<br />
<p>查询数据<br />
var mysql  = require(‘mysql’);</p><br />
<br />
<p>var connection = mysql.createConnection({   <br /><br />
  host     : ‘localhost’,     <br /><br />
  user     : ‘root’,            <br /><br />
  password : ‘123456’,     <br /><br />
  port: ‘3306’,                 <br /><br />
  database: ‘test’ <br />
});</p><br />
<br />
<p>connection.connect();</p><br />
<br />
<p>var  sql = ‘SELECT * FROM websites’;<br />
//查<br />
connection.query(sql,function (err, result) {<br />
        if(err){<br />
          console.log(‘[SELECT ERROR] - ‘,err.message);<br />
          return;<br />
        }</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   console.log('--------------------------SELECT----------------------------');<br />
   console.log(result);<br />
   console.log('------------------------------------------------------------\n\n');   });<br />
</code></pre></div></div><br />
<br />
<p>connection.end();<br />
执行以下命令输出就结果为：</p><br />
<br />
<p>$ node test.js<br />
————————–SELECT—————————-<br />
[ RowDataPacket {<br />
    id: 1,<br />
    name: ‘Google’,<br />
    url: ‘https://www.google.cm/’,<br />
    alexa: 1,<br />
    country: ‘USA’ },<br />
  RowDataPacket {<br />
    id: 2,<br />
    name: ‘淘宝’,<br />
    url: ‘https://www.taobao.com/’,<br />
    alexa: 13,<br />
    country: ‘CN’ },<br />
  RowDataPacket {<br />
    id: 3,<br />
    name: ‘菜鸟教程’,<br />
    url: ‘http://www.runoob.com/’,<br />
    alexa: 4689,<br />
    country: ‘CN’ },<br />
  RowDataPacket {<br />
    id: 4,<br />
    name: ‘微博’,<br />
    url: ‘http://weibo.com/’,<br />
    alexa: 20,<br />
    country: ‘CN’ },<br />
  RowDataPacket {<br />
    id: 5,<br />
    name: ‘Facebook’,<br />
    url: ‘https://www.facebook.com/’,<br />
    alexa: 3,<br />
    country: ‘USA’ } ]<br />
————————————————————<br />
插入数据<br />
我们可以向数据表 websties 插入数据：</p><br />
<br />
<p>插入数据<br />
var mysql  = require(‘mysql’);</p><br />
<br />
<p>var connection = mysql.createConnection({   <br /><br />
  host     : ‘localhost’,     <br /><br />
  user     : ‘root’,            <br /><br />
  password : ‘123456’,     <br /><br />
  port: ‘3306’,                 <br /><br />
  database: ‘test’ <br />
});</p><br />
<br />
<p>connection.connect();</p><br />
<br />
<p>var  addSql = ‘INSERT INTO websites(Id,name,url,alexa,country) VALUES(0,?,?,?,?)’;<br />
var  addSqlParams = [‘菜鸟工具’, ‘https://c.runoob.com’,’23453’, ‘CN’];<br />
//增<br />
connection.query(addSql,addSqlParams,function (err, result) {<br />
        if(err){<br />
         console.log(‘[INSERT ERROR] - ‘,err.message);<br />
         return;<br />
        }</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   console.log('--------------------------INSERT----------------------------');<br />
   //console.log('INSERT ID:',result.insertId);        <br />
   console.log('INSERT ID:',result);        <br />
   console.log('-----------------------------------------------------------------\n\n');   });<br />
</code></pre></div></div><br />
<br />
<p>connection.end();<br />
执行以下命令输出就结果为：</p><br />
<br />
<p>$ node test.js<br />
————————–INSERT—————————-<br />
INSERT ID: OkPacket {<br />
  fieldCount: 0,<br />
  affectedRows: 1,<br />
  insertId: 6,<br />
  serverStatus: 2,<br />
  warningCount: 0,<br />
  message: ‘’,<br />
  protocol41: true,<br />
  changedRows: 0 }<br />
—————————————————————–<br />
执行成功后，查看数据表，即可以看到添加的数据：</p><br />
<br />
<p>更新数据<br />
我们也可以对数据库的数据进行修改：</p><br />
<br />
<p>更新数据<br />
var mysql  = require(‘mysql’);</p><br />
<br />
<p>var connection = mysql.createConnection({   <br /><br />
  host     : ‘localhost’,     <br /><br />
  user     : ‘root’,            <br /><br />
  password : ‘123456’,     <br /><br />
  port: ‘3306’,                 <br /><br />
  database: ‘test’ <br />
});</p><br />
<br />
<p>connection.connect();</p><br />
<br />
<p>var modSql = ‘UPDATE websites SET name = ?,url = ? WHERE Id = ?’;<br />
var modSqlParams = [‘菜鸟移动站’, ‘https://m.runoob.com’,6];<br />
//改<br />
connection.query(modSql,modSqlParams,function (err, result) {<br />
   if(err){<br />
         console.log(‘[UPDATE ERROR] - ‘,err.message);<br />
         return;<br />
   }      <br /><br />
  console.log(‘————————–UPDATE—————————-‘);<br />
  console.log(‘UPDATE affectedRows’,result.affectedRows);<br />
  console.log(‘—————————————————————–\n\n’);<br />
});</p><br />
<br />
<p>connection.end();<br />
执行以下命令输出就结果为：</p><br />
<br />
<p>————————–UPDATE—————————-<br />
UPDATE affectedRows 1<br />
—————————————————————–<br />
执行成功后，查看数据表，即可以看到更新的数据：</p><br />
<br />
<p>删除数据<br />
我们可以使用以下代码来删除 id 为 6 的数据:</p><br />
<br />
<p>删除数据<br />
var mysql  = require(‘mysql’);</p><br />
<br />
<p>var connection = mysql.createConnection({   <br /><br />
  host     : ‘localhost’,     <br /><br />
  user     : ‘root’,            <br /><br />
  password : ‘123456’,     <br /><br />
  port: ‘3306’,                 <br /><br />
  database: ‘test’ <br />
});</p><br />
<br />
<p>connection.connect();</p><br />
<br />
<p>var delSql = ‘DELETE FROM websites where id=6’;<br />
//删<br />
connection.query(delSql,function (err, result) {<br />
        if(err){<br />
          console.log(‘[DELETE ERROR] - ‘,err.message);<br />
          return;<br />
        }</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   console.log('--------------------------DELETE----------------------------');<br />
   console.log('DELETE affectedRows',result.affectedRows);<br />
   console.log('-----------------------------------------------------------------\n\n');   });<br />
</code></pre></div></div><br />
<br />
<p>connection.end();</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category web
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>