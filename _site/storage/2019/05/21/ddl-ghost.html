<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">mysql ddl-ghost</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2019-05-21T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> May 21, 2019</time></p>
					</div>
					 <p><img src="https://xiazemin.github.io/MyBlog/img/mysqlghost.png" /><br />
GHOST工作原理：</p><br />
<br />
<p>1、首先新建一张ghost表，结构与源表相同<br />
2、使用alter命令修改ghost表<br />
3.1、模拟从库命令获取主库上该表的binlog(基于全镜像的行模式的binlog包含更改前和更改后的所有数据)，并解析成语句到ghost表上执行。<br />
3.2、获取源表的数据范围（如按照主键获取到最大值和最小值），然后将数据拆分为多个批次拷贝插入到ghost表中<br />
4、锁住源表，防止用户修改源表数据<br />
5、将源表重命名，将ghost表改名为源表<br />
6、释放表锁，清理gh-ost工具产生的表。<br />
<!-- more --><br />
GHOST有工作模式：</p><br />
<br />
<p>1.连接主库直接修改<br />
    直连主库<br />
    主库上创建ghost表<br />
    新表(ghost表)上直接alter修改表结构<br />
    迁移原表数据到新表<br />
    拉取解析binlog事件,应用到新表<br />
    cut-over阶段,用新表替换掉原表<br />
2.连接从库间接应用到主库<br />
    连接从库<br />
    校验完后,在主库创建新表<br />
    迁移原表数据到新表<br />
    模拟从库的从库,拉取解析增量binlog应用到主库<br />
    cut-over阶段,用新表替换掉原表</p><br />
<br />
<p>两者不同的点就在于,通过连接从库来进行变更,对主库的性能影响最小，但使用主库能够减少网络影响，操作速度更快。<br />
如何保证源表和新表数据一致：</p><br />
<br />
<p>由于使用binlog获得的数据总是新于或者等于从源表拷贝的数据：<br />
1、在应用binlog导出的数据时，将UPDATE和DELETE直接应用ghost表，将INSERT修改为REPLACE INTO再应用到ghost表。<br />
2、在copy源表数据到ghost表时，使用INSERT IGNORE来忽略掉ghost表已存在的记录<br />
3、对于在gh-ost工作期间发生的DELETE操作：<br />
    A：如果记录在从源表删除前被复制到ghost表， 则ghost表中记录会在应用binlog导出的DELETE命令时删除。<br />
    B：使用记录在从源表复制到ghost表之前被删除，则记录不会被复制到ghost表，应用binlog导出的DELETE命令也不会报错。<br />
GHOST支持跨服务器操作</p><br />
<br />
<p>假设有一套主从复制A1–&gt;A2，A1为主库，A2为从库，另有一台服务器B1装有gh-ost，可以在B1上执行对A1上表的修改：<br />
    1、对于数据拷贝操作，B1发送查询到A1上先获取最大值和最小值，然后在B1上进行拆分成不同批次，再从B1上发送命令给A1执行小范围数据拷贝<br />
    2、对于Binlog解析，先模拟B1到A1的搭建复制，从A1上拉取binlog到B1，在B1上解析成SQL命令，再发送到A1上执行。</p><br />
<br />
<p>对于跨服务器执行gh-ost命令，会导致大量数据在数据库服务器到命令服务器之间传输，需要考虑网络带宽和网络稳定<br />
重命名原理</p><br />
<br />
<p>在pt-osc或者online ddl中,最后的rename操作一般是耗时比较短,但如果表结构变更过程中,有大查询进来,那么在rename操作的时候,会触发MDL锁的等待,如果在高峰期,这就是个严重的问题。所以gh-ost是怎么做的呢？</p><br />
<br />
<p>gh-ost利用了MySQL的一个特性，就是原子性的rename请求，在所有被blocked的请求中，优先级永远是最高的。gh-ost基于此设计了该方案：一个连接对原表加锁，另启一个连接尝试rename操作，此时会被阻塞住，当释放lock的时候，rename会首先被执行，其他被阻塞的请求会继续应用到新表。<br />
唯一索引问题</p><br />
<br />
<p>如果通过gh-ost来新增唯一索引，由于REPLACE INTO和INSERT IGNORE会受到ghost表上唯一索引的影响，当在唯一索引上存在数据重复时，会导致数据丢失。</p><br />
<br />
<p>常用GHOST模板</p><br />
<br />
<p>##================================================##<br />
mysql_ip=”127.0.0.1”<br />
mysql_port=3358<br />
ghost_user=”root”<br />
ghost_password=”123.com”<br />
ghost_database=”test1”<br />
ghost_table=”tb002”<br />
ghost_command=”ADD C4 INT COMMENT ‘测试列’”</p><br />
<br />
<p>./gh-ost <br /><br />
–allow-on-master <br /><br />
–max-load=”Threads_running=256” <br /><br />
–critical-load=”Threads_running=512” <br /><br />
–chunk-size=1000 <br /><br />
–initially-drop-old-table <br /><br />
–initially-drop-ghost-table <br /><br />
–initially-drop-socket-file <br /><br />
–timestamp-old-table <br /><br />
–force-table-names=”” <br /><br />
–host=”${mysql_ip}” <br /><br />
–port=”${mysql_port}” <br /><br />
–user=”${ghost_user}” <br /><br />
–password=”${ghost_password}” <br /><br />
–database=”${ghost_database}” <br /><br />
–table=”${ghost_table}” <br /><br />
–alter=”${ghost_command}” <br /><br />
–verbose <br /><br />
–execute <br />
GHOST常用参数：</p><br />
<br />
<p>1、如果希望直接读取主库BINLOG，需要指定allow-on-master参数<br />
2、如果想避免上次操作失败产生的临时表导致新操作失败，建议使用initially-drop-ghost-table和initially-drop-socket-file参数<br />
3、如果希望GHOST操作完成后删除源表，使用ok-to-drop-table参数<br />
4、如果希望GHOST操作完成后保留源表，建议使用timestamp-old-table参数且不使用ok-to-drop-table参数<br />
5、使用参数max-load来控制主库繁忙时暂停GHOST运行<br />
6、使用参数critical-load来控制主库繁忙时终止GHOST运行<br />
7、使用参数throttle-flag-file或throttle-query来控制GHOST暂停运行<br />
8、使用参数panic-flag-file来控制GHOST停止运行<br />
9、使用参数throttle-control-replicas来控制GHOST对从库复制延迟的影响<br />
GHOST建议：</p><br />
<br />
<p>1、避免同一时间允许多个GHOST<br />
2、请勿使用GHOST来创建唯一索引<br />
3、建议从主库读取BINLOG，执行效率较高<br />
4、建议设置critical-load和max-load时仅考虑Threads_running的值，使用Threads_connected容易因连接暴涨导致GHOST暂停或中止<br />
5、在磁盘空间足够的条件下，使用timestamp-old-table来保存源表，一方面立即删除源表会造成IO压力，另一方面防止执行中出现BUG或误操作。</p><br />
<br />
<p>GHOST所有参数：</p><br />
<br />
<p>Usage of gh-ost:<br />
  -allow-master-master<br />
        当运行MM双主模式时需要显示设置。</p><br />
<br />
<p>-allow-nullable-unique-key<br />
        设置是否运行唯一键列中使用NULL值，使用ghost创建唯一索引，存在数据丢失风险，慎用！</p><br />
<br />
<p>-allow-on-master<br />
        当使用主节点的BINLOG来操作时，需要设置该值为ON。</p><br />
<br />
<p>-alter string<br />
        修改命令，不包含ALTER TABLE部分。</p><br />
<br />
<p>-approve-renamed-columns ALTER<br />
        当使用ghost进行修改列名操作，需要设置该值</p><br />
<br />
<p>-ask-pass<br />
        提升输入密码</p><br />
<br />
<p>-assume-master-host string<br />
        在双主或多主复制场景下，设置以哪个主节点的BINLOG为主。</p><br />
<br />
<p>-assume-rbr<br />
        假定使用基于ROW格式的复制模式</p><br />
<br />
<p>-check-flag<br />
        Check if another flag exists/supported. This allows for cross-version scripting. Exits with 0 when all additional provided flags exist, nonzero otherwise. You must provide (dummy) values for flags that require a value. Example: gh-ost –check-flag –cut-over-lock-timeout-seconds –nice-ratio 0</p><br />
<br />
<p>-chunk-size int<br />
        设置每个批次复制数据的行数，取值范围100至100000，默认为1000</p><br />
<br />
<p>-concurrent-rowcount<br />
        (with –exact-rowcount), when true (default): count rows after row-copy begins, concurrently, and adjust row estimate later on; when false: first count rows, then start row copy (default true)<br />
        设置对拷贝记录的计数方式。</p><br />
<br />
<p>-conf string<br />
        配置文件的路径</p><br />
<br />
<p>-critical-load string<br />
        Comma delimited status-name=threshold, same format as –max-load. When status exceeds threshold, app panics and quits<br />
        设置GHOST运行的最大阈值，当超过该阈值后，终止GHOST运行。</p><br />
<br />
<p>-critical-load-hibernate-seconds int<br />
        When nonzero, critical-load does not panic and bail out; instead, gh-ost goes into hibernate for the specified duration. It will not read/write anything to from/to any server<br />
        当该值不为0时，如果达到critical-load设置的阈值，会休眠指定时间，然后再次检查。</p><br />
<br />
<p>-critical-load-interval-millis int<br />
        When 0, migration immediately bails out upon meeting critical-load. When non-zero, a second check is done after given interval, and migration only bails out if 2nd check still meets critical load<br />
        设置达到critical-load设置的阈值后的检查间隔。</p><br />
<br />
<p>-cut-over string<br />
        choose cut-over type (default|atomic, two-step) (default “atomic”)<br />
        设置切换源表和新表表名的操作方式，默认为自动</p><br />
<br />
<p>-cut-over-lock-timeout-seconds int<br />
        Max number of seconds to hold locks on tables while attempting to cut-over (retry attempted when lock exceeds timeout) (default 3)<br />
        设置在cut-over时获取表锁的超时时间。</p><br />
<br />
<p>-database string<br />
        database name (mandatory)<br />
        数据库名</p><br />
<br />
<p>-debug<br />
        debug mode (very verbose)<br />
        DEBUG模式</p><br />
<br />
<p>-default-retries int<br />
        Default number of retries for various operations before panicking (default 60)<br />
        默认重试次数</p><br />
<br />
<p>-discard-foreign-keys<br />
        DANGER! This flag will migrate a table that has foreign keys and will NOT create foreign keys on the ghost table, thus your altered table will have NO foreign keys. This is useful for intentional dropping of foreign keys<br />
        设置是否丢弃外键，谨慎设置。</p><br />
<br />
<p>-dml-batch-size int<br />
        batch size for DML events to apply in a single transaction (range 1-100) (default 10)</p><br />
<br />
<p>-exact-rowcount<br />
        actually count table rows as opposed to estimate them (results in more accurate progress estimation)</p><br />
<br />
<p>-execute<br />
        actually execute the alter &amp; migrate the table. Default is noop: do some tests and exit<br />
        设置运行GHOST操作，默认不执行，仅检查并退出。</p><br />
<br />
<p>-force-named-cut-over<br />
        When true, the ‘unpostpone|cut-over’ interactive command must name the migrated table</p><br />
<br />
<p>-force-table-names string<br />
        table name prefix to be used on the temporary tables<br />
        设置临时表的前缀</p><br />
<br />
<p>-heartbeat-interval-millis int<br />
        how frequently would gh-ost inject a heartbeat value (default 100)<br />
        设置检查心跳时间间隔</p><br />
<br />
<p>-help<br />
        Display usage</p><br />
<br />
<p>-hooks-hint string<br />
        arbitrary message to be injected to hooks via GH_OST_HOOKS_HINT, for your convenience</p><br />
<br />
<p>-hooks-path string<br />
        directory where hook files are found (default: empty, ie. hooks disabled). Hook files found on this path, and conforming to hook naming conventions will be executed</p><br />
<br />
<p>-host string<br />
        MySQL hostname (preferably a replica, not the master) (default “127.0.0.1”)</p><br />
<br />
<p>-initially-drop-ghost-table<br />
        Drop a possibly existing Ghost table (remains from a previous run?) before beginning operation. Default is to panic and abort if such table exists<br />
        设置是否删除已存在的ghost表，默认不删除，如果ghost表存在，则立即退出。</p><br />
<br />
<p>-initially-drop-old-table<br />
        Drop a possibly existing OLD table (remains from a previous run?) before beginning operation. Default is to panic and abort if such table exists<br />
        设置是否删除已存在的OLD表，默认不删除，如果存在，则立即退出。</p><br />
<br />
<p>-initially-drop-socket-file<br />
        Should gh-ost forcibly delete an existing socket file. Be careful: this might drop the socket file of a running migration!<br />
        设置是否删除已有的socket文件</p><br />
<br />
<p>-master-password string<br />
        MySQL password on master, if different from that on replica. Requires –assume-master-host</p><br />
<br />
<p>-master-user string<br />
        MySQL user on master, if different from that on replica. Requires –assume-master-host</p><br />
<br />
<p>-max-lag-millis int<br />
        replication lag at which to throttle operation (default 1500)<br />
        设置复制延迟阈值，如果复制延迟超过该阈值，则暂停GHOST操作。</p><br />
<br />
<p>-max-load string<br />
        Comma delimited status-name=threshold. e.g: ‘Threads_running=100,Threads_connected=500’. When status exceeds threshold, app throttles writes<br />
        设置GHOST允许阈值，如果超过该值，则暂停GHOST操作。</p><br />
<br />
<p>-migrate-on-replica<br />
        Have the migration run on a replica, not on the master. This will do the full migration on the replica including cut-over (as opposed to –test-on-replica)</p><br />
<br />
<p>-nice-ratio float<br />
        force being ‘nice’, imply sleep time per chunk time; range: [0.0..100.0]. Example values: 0 is aggressive. 1: for every 1ms spent copying rows, sleep additional 1ms (effectively doubling runtime); 0.7: for every 10ms spend in a rowcopy chunk, spend 7ms sleeping immediately after<br />
        设置显示GHOST进度的格式</p><br />
<br />
<p>-ok-to-drop-table<br />
        Shall the tool drop the old table at end of operation. DROPping tables can be a long locking operation, which is why I’m not doing it by default. I’m an online tool, yes?<br />
        设置GHOST完成后是否删除OLD表，对于超大表，删除表操作会持续很长时间，并且造成性能问题，建议将表删除操作放到业务低峰期操作。</p><br />
<br />
<p>-panic-flag-file string<br />
        when this file is created, gh-ost will immediately terminate, without cleanup<br />
        当GHOST检查到该文件存在时，会立即退出而不做任何清理。</p><br />
<br />
<p>-password string<br />
        MySQL password</p><br />
<br />
<p>-port int<br />
        MySQL port (preferably a replica, not the master) (default 3306)</p><br />
<br />
<p>-postpone-cut-over-flag-file string<br />
        while this file exists, migration will postpone the final stage of swapping tables, and will keep on syncing the ghost table. Cut-over/swapping would be ready to perform the moment the file is deleted.<br />
        当GHOST检查到该文件存在时，会将切换表名操作延期，直到该文件被删除。</p><br />
<br />
<p>-quiet<br />
        quiet<br />
  -replica-server-id uint<br />
        server id used by gh-ost process. Default: 99999 (default 99999)<br />
        指定GHOST操作实例的server-id</p><br />
<br />
<p>-replication-lag-query string<br />
        Deprecated. gh-ost uses an internal, subsecond resolution query<br />
        已弃用。</p><br />
<br />
<p>-serve-socket-file string<br />
        Unix socket file to serve on. Default: auto-determined and advertised upon startup<br />
        指定实例使用的socket文件路径</p><br />
<br />
<p>-serve-tcp-port int<br />
        TCP port to serve on. Default: disabled</p><br />
<br />
<p>-skip-foreign-key-checks<br />
        set to ‘true’ when you know for certain there are no foreign keys on your table, and wish to skip the time it takes for gh-ost to verify that<br />
        忽略外键检查</p><br />
<br />
<p>-skip-renamed-columns ALTER<br />
        in case your ALTER statement renames columns, gh-ost will note that and offer its interpretation of the rename. By default gh-ost does not proceed to execute. This flag tells gh-ost to skip the renamed columns, i.e. to treat what gh-ost thinks are renamed columns as unrelated columns. NOTE: you may lose column data<br />
        忽略列名修改操作</p><br />
<br />
<p>-stack<br />
        add stack trace upon error</p><br />
<br />
<p>-switch-to-rbr<br />
        let this tool automatically switch binary log format to ‘ROW’ on the replica, if needed. The format will NOT be switched back. I’m too scared to do that, and wish to protect you if you happen to execute another migration while this one is running<br />
        使用GHOST工具修改复制格式为ROW模式</p><br />
<br />
<p>-table string<br />
        table name (mandatory)<br />
        修改表的表名</p><br />
<br />
<p>-test-on-replica<br />
        Have the migration run on a replica, not on the master. At the end of migration replication is stopped, and tables are swapped and immediately swap-revert. Replication remains stopped and you can compare the two tables for building trust<br />
        在复制节点上进行测试</p><br />
<br />
<p>-test-on-replica-skip-replica-stop<br />
        When –test-on-replica is enabled, do not issue commands stop replication (requires –test-on-replica)</p><br />
<br />
<p>-throttle-additional-flag-file string<br />
        operation pauses when this file exists; hint: keep default, use for throttling multiple gh-ost operations (default “/tmp/gh-ost.throttle”)<br />
        当该文件存在时，GHOST操作会暂停，默认值为/tmp/gh-ost.throttle</p><br />
<br />
<p>-throttle-control-replicas string<br />
        List of replicas on which to check for lag; comma delimited. Example: myhost1.com:3306,myhost2.com,myhost3.com:3307<br />
        设置要复制延迟的从库</p><br />
<br />
<p>-throttle-flag-file string<br />
        operation pauses when this file exists; hint: use a file that is specific to the table being altered<br />
        当该文件存在时，GHOST操作会暂停</p><br />
<br />
<p>-throttle-http string<br />
        when given, gh-ost checks given URL via HEAD request; any response code other than 200 (OK) causes throttling; make sure it has low latency response<br />
        基于HTTP方式来决定GHOST暂停</p><br />
<br />
<p>-throttle-query string<br />
        when given, issued (every second) to check if operation should throttle. Expecting to return zero for no-throttle, &gt;0 for throttle. Query is issued on the migrated server. Make sure this query is lightweight<br />
        基于QUERY方式来决定GHOST暂停</p><br />
<br />
<p>-timestamp-old-table<br />
        Use a timestamp in old table name. This makes old table names unique and non conflicting cross migrations<br />
        GHOST操作完成后，将老表设置带有时间戳</p><br />
<br />
<p>-tungsten<br />
        explicitly let gh-ost know that you are running on a tungsten-replication based topology (you are likely to also provide –assume-master-host)<br />
        tungsten-replication是一种异构复制技术，如MySQL到MongoDB的复制</p><br />
<br />
<p>-user string<br />
        MySQL user</p><br />
<br />
<p>-verbose<br />
        verbose<br />
        设置该参数会导致GHOST输出更多详细信息</p><br />
<br />
<p>-version<br />
        Print version &amp; exit</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category storage
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>