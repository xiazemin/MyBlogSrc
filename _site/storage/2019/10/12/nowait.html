<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">nowait</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2019-10-12T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Oct 12, 2019</time></p>
					</div>
					 <p>1、for update 和 for update nowait 的区别：</p><br />
<br />
<p>首先一点，如果只是select 的话，Oracle是不会加任何锁的，也就是Oracle对 select 读到的数据不会有任何限制，虽然这时候有可能另外一个进程正在修改表中的数据，并且修改的结果可能影响到你目前select语句的结果，但是因为没有锁，所以select结果为当前时刻表中记录的状态。</p><br />
<br />
<p>如果加入了for update， 则Oracle一旦发现（符合查询条件的）这批数据正在被修改，则不会发出该select语句查询，直到数据被修改结束（被commit），马上自动执行这个select语句。</p><br />
<br />
<p>同样，如果该查询语句发出后，有人需要修改这批数据（中的一条或几条），它也必须等到查询结束后（commit）后，才能修改。</p><br />
<br />
<p>for update nowait和 for update 都会对所查询到得结果集进行加锁，所不同的是，如果另外一个线程正在修改结果集中的数据，for update nowait 不会进行资源等待，只要发现结果集中有些数据被加锁，立刻返回 “ORA-00054错误，内容是资源正忙, 但指定以 NOWAIT 方式获取资源”。</p><br />
<br />
<p>for update 和 for update nowait 加上的是一个行级锁，也就是只有符合where条件的数据被加锁。如果仅仅用update语句来更改数据时，可能会因为加不上锁而没有响应地、莫名其妙地等待，但如果在此之前，for  update NOWAIT语句将要更改的数据试探性地加锁，就可以通过立即返回的错误提示而明白其中的道理，或许这就是For Update和NOWAIT的意义之所在。</p><br />
<br />
<p>经过测试，以for update 或 for update nowait方式进行查询加锁，在select的结果集中，只要有任何一个记录在加锁，则整个结果集都在等待系统资源（如果是nowait，则抛出相应的异常）</p><br />
<br />
<p>2、for update nowait 与 for update 的目的:<br />
锁定表的所有行，排斥其他针对这个表的写操作。确保只有当前事务对指定表进行写操作。<br />
for update nowait和 for update的区别：</p><br />
<br />
<p>别的事务要对这个表进行写操作时，是等待一段时间还是马上就被数据库系统拒绝而返回.制定采用nowait方式来进行检索，所以当发现数据被别的session锁定中的时候，就会迅速返回ORA-00054错误，内容是资源正忙, 但指定以 NOWAIT 方式获取资源。所以在程序中我们可以采用nowait方式迅速判断当前数据是否被锁定中，如果锁定中的话，就要采取相应的业务措施进行处理。<br />
<!-- more --></p><br />
<br />
<p>如何理解上面的话.<br />
开启一会话 (就是开一个sqlwindow)<br />
  select  empno,ename from emp where empno=’7369’ for update nowait ;<br />
得到下面结果集:<br />
    empno  ename<br />
    7369    smith<br />
开启另一会话<br />
  select  empno,ename from emp where empno=’7369’ for update nowait ;<br />
返回RA-00054错误，内容是资源正忙, 但指定以 NOWAIT 方式获取资源<br />
上面会话都提交commit;</p><br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>开启一会话,<br />
  select  empno,ename from emp where empno='7369' for update ;<br />
得到下面结果集:<br />
    empno  ename<br />
    7369    smith<br />
开启另一会话<br />
  select  empno,ename from emp where empno='7369' for update;<br />
<br />
阻塞，不返回错误。<br />
提交第一个会话，第二个回话自动执行<br />
提交第二个会话<br />
</code></pre></div></div><br />
<p>for update: 当第一个session最后commit或者rollback之后，第二个session中的检索结果就是自动跳出来，并且也把数据锁定住.<br />
  开启一会话：<br />
     select empno,ename from emp   where empno=”7369” for update；<br />
得到下面结果集:<br />
    empno  ename<br />
    7369    smith<br />
开启另一个会话，<br />
   update emp set ename=’ALLEN’  where empno=”7396”;<br />
阻塞。<br />
  提交第一个会话，update 语句执行<br />
再开启一会话<br />
    update emp set ename=”SMITH” where empno=’7396’;<br />
同样阻塞，虽然第一个会话因为提交而释放了锁，但是第二个会话中的update 又给这一行加锁了;<br />
for update nowait:当你第一个session放开锁定以后,第二个session才能正常运行。当你第二个session语句运行后，数据又被你第二个session语句锁定住了，这个时候只要你第二个session语句后还没有commit，别的session照样不能对数据进行锁定更新等等。</p><br />
<br />
<p>对比区别：<br />
select * from TTable1 for update 锁定表的所有行，只能读不能写<br />
2  select * from TTable1 where pkid = 1 for update 只锁定pkid=1的行<br />
3  select * from Table1 a join Table2 b on a.pkid=b.pkid for update 锁定两个表的所有记录<br />
4 select * from Table1 a join Table2 b on a.pkid=b.pkid where a.pkid = 10 for update 锁定两个表的中满足条件的行</p><br />
<ol><br />
  <li>select * from Table1 a join Table2 b on a.pkid=b.pkid where a.pkid = 10 for update of a.pkid 只锁定Table1中满足条件的行<br />
for update 是把所有的表都锁点 for update of 根据of 后表的条件锁定相对应的表<br />
———–<br />
关于NOWAIT(如果一定要用FOR UPDATE，我更建议加上NOWAIT)<br />
当有LOCK冲突时会提示错误并结束STATEMENT而不是在那里等待(比如:要查的行已经被其它事务锁了,当前的锁事务与之冲突,加上nowait,当前的事务会结束会提示错误并立即结束 STATEMENT而不再等待).<br />
如果加了for update后 该语句用来锁定特定的行（如果有where子句，就是满足where条件的那些行）。当这些行被锁定后，其他会话可以选择这些行，但不能更改或删除这些行，直到该语句的事务被commit语句或rollback语句结束为止。<br />
因为FOR   UPDATE子句获得了锁，所以COMMIT将释放这些锁。当锁释放了，该游标就无效了。<br />
就是这些区别了</li><br />
</ol><br />
<br />
<p>关于oracle中的select…for update of columns<br />
问题，如下：select * from emp where empno = 7369 for update; 会对表中员工编号为7369的记录进行上锁。其他用户无法对该记录进行操作，只能查询。select * from emp where empno = 7369 for update of sal; 这条语句是不是意味着只对表中的7369 这一行的sal字段的数据进行了上锁，其他数据则可以被其他用户做更新操作呢。学员测试结果为二条语句的效果是一样的。其他用户对整行都无法更新，那么是不是意味着 for update of columns这句没有什么意义呢？</p><br />
<br />
<p>这个问题估计很多玩ORACLE的同学们都没有去思考过【网上相关的帖子不多】。现在将其功能讲解一下。</p><br />
<br />
<p>从单独一张表的操作来看，上面二条语句的效果确实是相同的。但是如果涉及到多表操作的时候 for update of columns就起到了非常大的作用了。现假定有二个用户，scott和mm。</p><br />
<br />
<p>scott执行语句：select * from emp e,dept d where e.deptno = d.deptno for update; –对二张表都进行了整表锁定<br />
mm执行语句：select * from scott.dept for update wait 3; –试图锁定scott用户的dept表</p><br />
<br />
<p>结果是：<br />
ERROR 位于第 1 行:<br />
ORA-30006: 资源已被占用; 执行操作时出现 WAIT 超时</p><br />
<br />
<p>现在，scott用户先进行解锁rollback,再在for update语句后面加上of columns，进行测试</p><br />
<br />
<p>scott执行语句：select * from emp e,dept d where e.deptno = d.deptno for update of sal ;<br />
mm执行语句：select * from scott.dept for update wait 3;</p><br />
<br />
<p>结果是：<br />
成功锁定了dept表的数据.</p><br />
<br />
<p>mm再次执行语句：select * from scott.emp for update wait 3;</p><br />
<br />
<p>结果是：<br />
ERROR 位于第 1 行:<br />
ORA-30006: 资源已被占用; 执行操作时出现 WAIT 超时</p><br />
<br />
<p>通过这段代码案例，我们可以得到结论，for update of columns 用在多表连接锁定时，可以指定要锁定的是哪几张表，而如果表中的列没有在for update of 后面出现的话，就意味着这张表其实并没有被锁定，其他用户是可以对这些表的数据进行update操作的。这种情况经常会出现在用户对带有连接查询的视图进行操作场景下。用户只锁定相关表的数据，其他用户仍然可以对视图中其他原始表的数据来进行操作。</p><br />
<br />
<p>Oracle 的for update行锁<br />
SELECT…FOR UPDATE 语句的语法如下：<br />
SELECT … FOR UPDATE [OF column_list][WAIT n|NOWAIT][SKIP LOCKED];<br />
其中：<br />
OF 子句用于指定即将更新的列，即锁定行上的特定列。<br />
WAIT 子句指定等待其他用户释放锁的秒数，防止无限期的等待。<br />
“使用FOR UPDATE WAIT”子句的优点如下：<br />
１防止无限期地等待被锁定的行；<br />
２允许应用程序中对锁的等待时间进行更多的控制。<br />
３对于交互式应用程序非常有用，因为这些用户不能等待不确定<br />
４ 若使用了skip locked，则可以越过锁定的行，不会报告由wait n 引发的‘资源忙’异常报告</p><br />
<br />
<p>示例:<br />
create table t(a varchar2(20),b varchar2(20));<br />
insert into t values(‘1’,’1’);<br />
insert into t values(‘2’,’2’);<br />
insert into t values(‘3’,’3’);<br />
insert into t values(‘4’,’4’);<br />
现在执行如下操作：<br />
在plsql develope中打开两个sql窗口，<br />
在1窗口中运行sql<br />
select * from t where a=’1’ for update;<br />
在2窗口中运行sql1</p><br />
<ol><br />
  <li>select * from t where a=’1’; 这一点问题也没有，因为行级锁不会影响纯粹的select语句<br />
再运行sql2</li><br />
  <li>select * from t where a=’1’ for update; 则这一句sql在执行时，永远处于等待状态，除非窗口1中sql被提交或回滚。<br />
如何才能让sql2不等待或等待指定的时间呢？ 我们再运行sql3</li><br />
  <li>select * from t where a=’1’ for update nowait; 则在执行此sql时，直接报资源忙的异常。<br />
若执行 select * from t where a=’1’ for update wait 6; 则在等待6秒后，报 资源忙的异常。<br />
如果我们执行sql4</li><br />
  <li>select * from t where a=’1’ for update nowait skip Locked; 则执行sql时，即不等待，也不报资源忙异常。<br />
现在我们看看执行如下操作将会发生什么呢？<br />
在窗口1中执行：<br />
select * from t where rownum&lt;=3 nowait skip Locked;<br />
在窗口2中执行：<br />
select * from t where rownum&lt;=6 nowait skip Locked;<br />
select for update 也就如此了吧，insert、update、delete操作默认加行级锁，其原理和操作与select for update并无两样。<br />
select for update of，这个of子句在牵连到多个表时，具有较大作用，如不使用of指定锁定的表的列，则所有表的相关行均被锁定，若在of中指定了需修改的列，则只有与这些列相关的表的行才会被锁定。</li><br />
</ol><br />
<br />
<p>SQL语句：</p><br />
<br />
<p>SELECT … FOR UPDATE [OF column_list][WAIT n|NOWAIT][SKIP LOCKED]; <br />
详解：</p><br />
<br />
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OF 子句用于指定即将更新的列，即锁定行上的特定列。 <br />
WAIT 子句指定等待其他用户释放锁的秒数，防止无限期的等待。<br />
</code></pre></div></div><br />
<br />
<p>示例：</p><br />
<br />
<p>SELECT * FROM ‘account’ FOR UPDATE<br />
 会等待行锁释放之后，返回查询结果。</p><br />
<br />
<p>SELECT * FROM ‘account’ FOR UPDATE NOWAIT<br />
 不等待行锁释放，提示锁冲突，不返回结果</p><br />
<br />
<p>SELECT * FROM ‘account’ FOR UPDATE WAIT 5<br />
 等待5秒，若行锁仍未释放，则提示锁冲突，不返回结果</p><br />
<br />
<p>SELECT * FROM ‘account’ FOR UPDATE SKIP LOCKED<br />
 查询返回查询结果，但忽略有行锁的记录</p><br />
<br />
<p>“使用FOR UPDATE WAIT”子句的优点如下： <br />
　　1防止无限期地等待被锁定的行； <br />
　　2允许应用程序中对锁的等待时间进行更多的控制。 <br />
　　3对于交互式应用程序非常有用，因为这些用户不能等待不确定 <br />
　　4 若使用了skip locked，则可以越过锁定的行，不会报告由wait n 引发的‘资源忙’异常报告</p><br />
<br />
<p>简单场景：</p><br />
<br />
<p>【钱包扣钱】事务中：</p><br />
<br />
<p>//事务<br />
SELECT balance FROM ‘account’ WHERE id = 1 FROM UPDATE<br />
//判断钱包是否大于需要扣除的金额，例如100<br />
UPDATE ‘account’ SET balance = balance - 100 WHERE id =1 <br />
//提交事务<br />
在未提交事务之前，其他人使用for update语句查询这个时候会出现被锁住，无法被读取。保证准确性</p><br />
<br />
<p>SELECT … FOR UPDATE 的Row Lock 与Table Lock</p><br />
<br />
<p>只有「明确」的指定主键，MySQL 才会执行Row lock (只锁住被选取的数据) ，否则MySQL 将会执行Table Lock (将整个数据表单给锁住)。</p><br />
<br />
<p>示例：</p><br />
<br />
<p>表account 其中主键为id</p><br />
<br />
<p>SELECT * FROM ‘account’ WHERE id=’3’ FOR UPDATE;<br />
 有主键，并且有此数据，row lock</p><br />
<br />
<p>SELECT * FROM ‘account’ WHERE id=’-1’ FOR UPDATE;<br />
 主键，若查无此数据，无lock</p><br />
<br />
<p>SELECT * FROM ‘account’ WHERE name=’小树’ FOR UPDATE;<br />
 无主键，table lock</p><br />
<br />
<p>SELECT * FROM ‘account’ WHERE id&lt;&gt;’3’ FOR UPDATE;<br />
SELECT * FROM ‘account’ WHERE id&gt;’3’ FOR UPDATE;<br />
SELECT * FROM ‘account’ WHERE id LIKE ‘3’ FOR UPDATE;<br />
主键不明确，table lock</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category storage
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>