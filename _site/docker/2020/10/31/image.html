<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">Docker基础镜像的制作</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-10-31T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Oct 31, 2020</time></p>
					</div>
					 <p>大部分的文章讨论的都是怎么从docker hub或者openvz上下载基础镜像，然后添加自己的功能制作镜像，包括涵盖了大部分docker内容的。但是如果实在找不到想要的基础镜像，比如我想制作Fedora Core 2的基础镜像，可是找了好久都没有找到，就需要自己从头制作基础镜像。</p><br />
<br />
<p>制作需要在linux下，我的操作系统是centos6.5。</p><br />
<br />
<ol><br />
  <li>安装febootstrap</li><br />
</ol><br />
<br />
<p>Febootstrap在EPEL库里，所以首先要把EPEL库增加到yum源里。</p><br />
<br />
<p>在/etc/yum.repo.d/下新建epel.repo,内容如下</p><br />
<br />
<p>[epel]</p><br />
<br />
<p>name=fedora-epel</p><br />
<br />
<p>baseurl=http://mirrors.aliyun.com/epel/6/i/i386/</p><br />
<br />
<p>enabled=1</p><br />
<br />
<p>gpgcheck=0</p><br />
<br />
<p>然后#yum install febootstrap</p><br />
<br />
<ol><br />
  <li>系统版本的选择</li><br />
</ol><br />
<br />
<p>目前实际机器上用的系统是Fedora Core release3（Heidelberg）Kernel 2.6.9-34.EL on i586,编译用的机器系统是Red Hat AS4 U3, gcc版本gcc version 3.4.520051201 (Red Hat 3.4.5-2)</p><br />
<br />
<p>现在我从网上找到了fedora core 3，但是发现内核版本是kernel2.6.9-1.667 gcc 版本是gcc version3.4.2 20041017 (Red Hat 3.4.2-6.fc3)，而Red Hat AS4 U3没有找到更新源。这就陷入了困境，如果采用fc3，与之前的编译环境不符，可是又找不到Red Hat AS4 U3的源，最后找到了一篇文章（参考https://wenku.baidu.com/view/a97f9bb2fd0a79563c1e72c0.html）知道了CentOS4.3等同于RedHat AS4 U3，既然这样就直接用centos4.3来制作编译环境吧。</p><br />
<br />
<p>附上找了好久找到的更新源</p><br />
<br />
<p>Centos4.3 http://vault.centos.org/4.3/os/i386/</p><br />
<br />
<p>Centos6.5 http://vault.centos.org/6.5/os/i386/</p><br />
<br />
<p>Fedora core3 http://archives.fedoraproject.org/pub/archive/fedora/linux/core/3/i386/os/<br />
<!-- more --></p><br />
<br />
<p>.    制作镜像文件</p><br />
<br />
<p>利用febootstrap制作镜像文件，首先要找到更新源的地址。找了好久终于找到</p><br />
<br />
<p>制作命令</p><br />
<br />
<p>$febootstrap -i bash -i gcc-c++ -i openssh -i yum -i make centos4.3 centos4.3 http://vault.centos.org/4.3/os/i386/</p><br />
<br />
<p>其中-i后是要安装的程序，centos4.3是镜像标签，后一个centos4.3是生成的目录，后面是源地址。</p><br />
<br />
<p>执行完毕后会在当前目录下生成centos4.3目录</p><br />
<br />
<p>中间碰到错误UnicodeDecodeError: ‘ascii’ codeccan’t decode byte 0xe8 in position</p><br />
<br />
<p>是yumrepo.py中报出的。</p><br />
<br />
<p>只要修改这个文件，在import后增加</p><br />
<br />
<p>Import sys</p><br />
<br />
<p>reload(sys)<br />
    sys.setdefaultencoding(‘utf-8’)</p><br />
<br />
<p>生成完centos4.3目录后用</p><br />
<br />
<p>$cd centos4.3</p><br />
<br />
<p>$tar -czvf centos4.3.tar.gz *</p><br />
<br />
<p>（注意，一定要进入centos4.3目录后用这个命令，不要把centos目录也压进压缩包了。否则运行容器的时候会出现used “exec:"bash": executable file not found in $PATH”: unknown.的错误。）</p><br />
<br />
<p>（由于我的操作系统是centos6.5，而docker是在window上安装的dockertoolbox17，后来导入文件的时候出现了错误，发现是tar版本的问题，于是在centos6.5上只用tar -cvf打包，然后在docker虚拟机上压缩。）</p><br />
<br />
<p>生成镜像的压缩文件。</p><br />
<br />
<ol><br />
  <li>在docker中导入</li><br />
</ol><br />
<br />
<p>$docker imager import centos4.3.tar.gz centos:4.3</p><br />
<br />
<p>可以将镜像导入</p><br />
<br />
<p>在 Dockerfile 中， 每一条指令都会创建一个镜像层，继而会增加整体镜像的大小。<br />
举例来说：</p><br />
<br />
<p>FROM busybox</p><br />
<br />
<p>RUN mkdir /tmp/foo</p><br />
<br />
<p>RUN dd if=/dev/zero of=/tmp/foo/bar bs=1048576 count=100</p><br />
<br />
<p>RUN rm /tmp/foo/bar<br />
以上 Dockerfile 干了这几件事：</p><br />
<br />
<p>基于一个官方的基础镜像 busybox(只有1M多)<br />
创建一个文件夹(/tmp/foo)和一个文件(bar)<br />
为该文件分配了100M大小<br />
再把这个大文件删除<br />
事实上，它最终什么也没做，我们把它构建成镜像看看（构建可以参考一期）：</p><br />
<br />
<p>docker build -t busybox:test .<br />
再让我们来对比下原生的 busybox 镜像大小和我们生成的镜像大小：</p><br />
<br />
<table><br />
  <tbody><br />
    <tr><br />
      <td>$ docker images</td><br />
      <td>grep</td><br />
    </tr><br />
  </tbody><br />
</table><br />
<br />
<p>busyboxbusybox    test     896c63dbdb96    2 seconds ago    106 MB</p><br />
<br />
<p>busybox    latest   2b8fd9751c4c    9 weeks ago      1.093 MB<br />
出乎意料的是，却生成了 106 MB 的镜像。</p><br />
<br />
<p>多出了 100 M，这是为何？这点和 git 类似（都用到了Copy-On-Write技术），我用 git 做了如下两次提交（添加了又删除），请问 A_VERY_LARGE_FILE 还在 git 仓库中吗？</p><br />
<br />
<p>$ git add  A_VERY_LARGE_FILE</p><br />
<br />
<p>$ git commit</p><br />
<br />
<p>$ git rm  A_VERY_LARGE_FILE</p><br />
<br />
<p>$ git commit<br />
答案是： 在的 ，并且会占用仓库的大小。Git 会保存每一次提交的文件版本，而 Dockerfile 中每一条指令都可能增加整体镜像的大小，即使它最终什么事情都没做。</p><br />
<br />
<p>方法： 串联你的 Dockerfile 指令（一般是 RUN 指令）。</p><br />
<br />
<p>Dockerfile 中的 RUN 指令通过 &amp;&amp; 和 / 支持将命令串联在一起，有时能达到意想不到的精简效果。</p><br />
<br />
<p>步骤 4：压缩你的镜像</p><br />
<br />
<p>方法：试着用命令或工具压缩你的镜像。</p><br />
<br />
<p>docker 自带的一些命令还能协助压缩镜像，比如 export 和 import</p><br />
<br />
<p>https://blog.csdn.net/a1010256340/article/details/80092038</p><br />
<br />
<p>https://www.jianshu.com/p/e8979e00bf0b</p><br />
<br />
<p>https://blog.csdn.net/liumiaocn/article/details/100922774?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~first_rank_v2~rank_v28-1-100922774.nonecase&amp;utm_term=docker%20%E6%9C%80%E5%A4%A7%E5%B1%82%E6%95%B0&amp;spm=1000.2123.3001.4430<br />
http://www.cocoachina.com/articles/75641</p><br />
<br />
<p>通过 docker history 查看到层的信息，但是除了最顶一层，其余的 ID 均为<missing>。</missing></p><br />
<br />
<p>所以看到资料说通过 tag 可以进行层的回滚，但是这里没有 ID 可用也就似乎无法使用 tag 命令了。</p><br />
<br />
<p>按照我的理解，docker 的镜像应该是层的叠加而成的，那么进行回滚时理论上也应该可以逐层回滚吧？<br />
在 build 的主机上有 cache，可以用 tag。<br />
pull 下来 /save 然后 load 都不能‘层回滚’的，因为 build 的操作跟上下文环境有关，不像 git。<br />
https://github.com/moby/moby/issues/20131<br />
https://github.com/moby/moby/issues/20316</p><br />
<br />
<p>docker支持多种graphDriver，包括vfs、devicemapper、overlay、overlay2、aufs等等，其中最常用的就是aufs了，但随着linux内核3.18把overlay纳入其中，overlay的地位变得更重目前docker默认的存储类型就是overlay2，docker版本是1.8，如下</p><br />
<br />
<p>image.png</p><br />
<br />
<p>docker默认的存储目录是/var/lib/docker，下面我们简单打印一下这个目录：</p><br />
<br />
<p>[root@docker2 ~]# ll /var/lib/docker<br />
总用量 24<br />
drwx——.   2 root root    24 5月  15 2019 builder<br />
drwx——.   4 root root    92 5月  15 2019 buildkit<br />
drwx——.   3 root root    78 3月   8 11:14 containers<br />
drwx——.   3 root root    22 5月  15 2019 image<br />
drwxr-x—.   3 root root    19 5月  15 2019 network<br />
drwx——. 165 root root 16384 3月   8 11:14 overlay2<br />
drwx——.   4 root root    32 5月  15 2019 plugins<br />
drwx——    2 root root     6 3月   8 11:10 runtimes<br />
drwx——.   4 root root    83 3月   8 11:10 swarm<br />
drwx——    2 root root     6 3月   8 11:10 tmp<br />
drwx——.   2 root root     6 5月  15 2019 trust<br />
drwx——.  21 root root  4096 8月  11 2019 volumes<br />
只关心image和overlay2，image:主要存放镜像中layer层的元数据和overlay2:各层的具体信息。<br />
做这个实验之前，我们应该先启动一个容器，在这里使用nginx作为实验:</p><br />
<br />
<p>[root@docker2 ~]# docker ps <br />
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES<br />
88984d1d86a9        nginx               “nginx -g ‘daemon of…”   45 hours ago        Up 5 hours          0.0.0.0:80-&gt;80/tcp   nginx              “nginx -g ‘daemon of…”   4 seconds ago       Up 3 seconds        80/tcp              practical_vaughan<br />
可以看到新启动的nginx容器的id是88984d1d86a9，我们继续往下看。</p><br />
<br />
<p>上面说了，我们只需要关心/var/lib/docker/image和/var/lib/docker/overlay2，可以先到/var/lib/docker/image打印一下：</p><br />
<br />
<p>[root@docker2 ~]# cd /var/lib/docker/image/<br />
[root@docker2 image]# ll<br />
总用量 0<br />
drwx——. 5 root root 81 3月   6 19:29 overlay2<br />
我们只能看到overlay2这个目录，docker会在/var/lib/docker/image目录下给使用的存储驱动创建一个目录，如这里的overlay2。<br />
接下来，使用tree命令浏览一下这个目录：</p><br />
<br />
<p>[root@docker2 image]# tree -L 2 overlay2/<br />
overlay2/<br />
├── distribution    <br /><br />
│   ├── diffid-by-digest<br />
│   └── v2metadata-by-diffid<br />
├── <br />
│   ├── content<br />
│   └── metadata<br />
├── <br />
│   ├── mounts<br />
│   ├── sha256<br />
│   └── tmp<br />
└── repositories.json</p><br />
<br />
<p>这里的关键地方是imagedb和layerdb目录，看这个目录名字，很明显就是专门用来存储元数据的地方，那为什么区分image和layer呢？因为在docker中，image是由多个layer组合而成的，换句话就是layer是一个共享的层，可能有多个image会指向某个layer。<br />
那如何才能确认image包含了哪些layer呢？答案就在imagedb这个目录中去找。比如上面启动的nginx容器，我们可以先找到这个容器对应的镜像：</p><br />
<br />
<p>[root@docker2 image]# docker images nginx<br />
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br />
nginx               latest              6678c7c2e56c        3 days ago          127MB<br />
nginx               1.13.7-alpine       22f5726c6dc0        2 years ago         15.5MB<br />
可以看到，imageID是6678c7c2e56c，再次记住这个id，我们打印/var/lib/docker/image/overlay2/imagedb/content/sha256这个目录：</p><br />
<br />
<p>[root@docker2 sha256]# ll  |grep 6678c7c2e56c<br />
-rw——-  1 root root  6666 3月   6 19:29 6678c7c2e56c970388f8d5a398aa30f2ab60e85f20165e101053c3d3a11e6663<br />
第一行的6678c7c2e56c970388f8d5a398aa30f2ab60e85f20165e101053c3d3a11e6663正是记录我们nginx镜像元数据的文件，接下来cat一下这个文件，得到一个长长的json：</p><br />
<br />
<p>[root@docker2 sha256]# cat 6678c7c2e56c970388f8d5a398aa30f2ab60e85f20165e101053c3d3a11e6663  |python  -mjson.tool<br />
。。。。。。<br />
    “rootfs”: {<br />
        “diff_ids”: [<br />
            “sha256:f2cb0ecef392f2a630fa1205b874ab2e2aedf96de04d0b8838e4e728e28142da”,<br />
            “sha256:71f2244bc14dacf7f73128b4b89b1318f41a9421dffc008c2ba91bb6dc2716f1”,<br />
            “sha256:55a77731ed2630d9c092258490b03be3491d5f245fe13a1c6cb4e21babfb15b7”<br />
        ],<br />
        “type”: “layers”<br />
由于篇幅原因，我只展示最关键的一部分，也就是rootfs。可以看到rootfs的diff_ids是一个包含了3个元素的数组，其实这3个元素正是组成nginx镜像的3个layerID，从上往下看，就是底层到顶层，也就是说f2cb0ecef392f2a630fa1205b874ab2e2aedf96de04d0b8838e4e728e28142da是image的最底层。既然得到了组成这个image的所有layerID，那么我们就可以带着这些layerID去寻找对应的layer了。<br />
接下来，我们返回到上一层的layerdb中，先打印一下这个目录：</p><br />
<br />
<p>[root@docker2 layerdb]# ll<br />
总用量 20<br />
drwxr-xr-x.   3 root root    78 3月   8 11:14 mounts<br />
drwxr-xr-x. 162 root root 16384 3月   6 19:29 sha256<br />
drwxr-xr-x.   2 root root     6 3月   6 19:29 tmp<br />
在这里我们只管mounts和sha256两个目录，再打印一下sha256目录:</p><br />
<br />
<p>[root@docker2 layerdb]# ll sha256/ |grep f2cb0ecef392f2a630fa1205b874ab2e2aedf96de04d0b8838e4e728e28142da<br />
drwx——  2 root root 71 3月   6 19:27 f2cb0ecef392f2a630fa1205b874ab2e2aedf96de04d0b8838e4e728e28142da<br />
在这里，我们仅仅发现f2cb0ecef392f2a630fa1205b874ab2e2aedf96de04d0b8838e4e728e28142da这个最底层的layer，那么剩余两个layer为什么会没有呢？那是因为docker使用了chainID的方式去保存这些layer，简单来说就是chainID=sha256sum(H(chainID) diffid)，也就是f2cb0ecef392f2a630fa1205b874ab2e2aedf96de04d0b8838e4e728e28142da..的上一层的sha256 id是：</p><br />
<br />
<p>[root@docker2 sha256]#  echo -n “sha256:f2cb0ecef392f2a630fa1205b874ab2e2aedf96de04d0b8838e4e728e28142da sha256:71f2244bc14dacf7f73128b4b89b1318f41a9421dffc008c2ba91bb6dc2716f1” |sha256sum -<br />
1541955a517830d061b79f2b52b1aed297d81c009ce7766a15527979b6e719c4  -<br />
这个时候，你能看到f2cb0ecef392f2a630fa1205b874ab2e2aedf96de04d0b8838e4e728e28142da这个layer层的目录了吧？依次类推，我们就能找出所有的layerID的组合。<br />
但是上面我们也说了，/var/lib/docker/image/overlay2/layerdb存的只是元数据，那么真实的rootfs到底存在哪里呢？其中cache-id就是我们关键所在了。我们打印一下/var/lib/docker/image/overlay2/layerdb/sha256/f2cb0ecef392f2a630fa1205b874ab2e2aedf96de04d0b8838e4e728e28142da/cache-id:</p><br />
<br />
<p>[root@docker2 layerdb]# cat sha256/1541955a517830d061b79f2b52b1aed297d81c009ce7766a15527979b6e719c4/cache-id <br />
f77d281af55651a70e5fc8f31de840d5b5461f36d930545db39f01bc839e4097<br />
没错，这个id就是对应/var/lib/docker/overlay2/f77d281af55651a70e5fc8f31de840d5b5461f36d930545db39f01bc839e4097。因此，以此类推，更高一层的layer对应的cache-id也能找到对应的rootfs，当这些rootfs的diff目录通过联合挂载的方式挂载到某个目录，就能完整整个容器需要的rootfs了。</p><br />
<br />
<p>https://blog.51cto.com/12182612/2476386?source=dra</p><br />
<br />
<p>如果其中的 Liberty Image 发生变化的时候，例如需要升级 Liberty 版本的时候，只需要重新更新该节点和该节点之后的其他 Image 节点，而不会影响到 Liberty Image 节点的兄弟节点或者父亲节点以及由这些节点衍生出来的其他的 Docker Image。当更新 App Image 的时候，由于其均来自同样的父亲节点 Liberty Image。 所以每次更新的时候只会做 EAR 包的增量更新。</p><br />
<br />
<p>https://www.ibm.com/developerworks/cn/devops/1601_kongyi_devopsdockerimages/index.html</p><br />
<br />
<p>https://www.cnblogs.com/autopenguin/p/7390239.html<br />
https://www.cnblogs.com/sparkdev/p/9092082.html<br />
https://imagelayers.io/?images=qqeqwe:latest,ert:latest,2345:latest</p><br />
<br />
<p>docker-compose.yml定义中的服务的image参数具有双重含义,具体取决于构建参数的存在.</p><br />
<blockquote><br />
  <p>如果没有构建节,则只需拉动并运行图像.<br />
如果您有一个构建节,那么image将是您构建的名称<br />
图像被标记为,并运行.</p><br />
</blockquote><br />
<br />
<p>http://www.cocoachina.com/articles/75641<br />
https://blog.csdn.net/z136370204/article/details/108831582</p><br />
<br />
<p>使用多阶段构建<br />
对于多阶段构建，可以在 Dockerfile 中使用多个 FROM 语句。每个 FROM 指令都可以使用不同的基镜像，并且它们都开始了构建的新阶段。您可以选择性地将工件从一个阶段复制到另一个阶段，舍弃在最终镜像中您不想要的所有内容。为了说明这是如何工作的，让我们使用多阶段构建调整前一节中的 Dockerfile。</p><br />
<br />
<p>Dockerfile：</p><br />
<br />
<p>FROM golang:1.7.3<br />
WORKDIR /go/src/github.com/alexellis/href-counter/<br />
RUN go get -d -v golang.org/x/net/html<br /><br />
COPY app.go .<br />
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .</p><br />
<br />
<p>FROM alpine:latest<br /><br />
RUN apk –no-cache add ca-certificates<br />
WORKDIR /root/<br />
COPY –from=0 /go/src/github.com/alexellis/href-counter/app .<br />
CMD [”./app”]</p><br />
<br />
<p>https://www.cnblogs.com/ittranslator/p/13235891.html</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category docker
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>