<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sci blog jekyll theme">
    <meta name="author" content="AIR RAYA Group">
    <link href='/MyBlog/img/favicon.ico' type='image/icon' rel='shortcut icon'/>

    <title>泽民博客 | Jekyll theme</title>

    <link rel="stylesheet" href="/MyBlog/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="/MyBlog/css/font-awesome.min.css">
    <link href="/MyBlog/css/simple-sidebar.css" rel="stylesheet">
	<link href="/MyBlog/css/classic-10_7.css" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link href="/MyBlog/css/style.css" rel="stylesheet">
    <link href="/MyBlog/css/pygments.css" rel="stylesheet">
    <!-- Fonts -->
 <link href="/MyBlog/css/front.css" rel="stylesheet" type="text/css">
 <link href="/MyBlog/css/Josefin_Slab.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Architects_Daughter.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Schoolbell.css" rel="stylesheet" type="text/css">
<link href="/MyBlog/css/Codystar.css" rel="stylesheet" type="text/css">

 <script type="text/javascript" src="/MyBlog/js/jquery-1.12.0.min.js"></script>	

<link href="/MyBlog/css/calendar/common.css" type="text/css"  rel="stylesheet">
<script type="text/javascript" src="/MyBlog/js/calendar/calendar.js"></script>
	<!-- share this -->
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="/MyBlog/js/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b28464c3-d287-4257-ad18-058346dd35f7", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="/MyBlog/js/html5shiv.js"></script>
        <script src="/MyBlog/js/respond.min.js"></script>
    <![endif]-->
   
   <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e965cab8c73512b8b23939e7051d93bd";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <script async src="/MyBlog/katex/katex.js"></script>
    <link rel="stylesheet" href="/MyBlog/katex/katex.css">

    <!--轮播图片-->
    <!--script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="https://xiazemin.github.io/MyBlog/js/jquery.stripesrotator.js"></script>
    <script type="text/javascript">
                    $(document).ready(function() {
                    alert($('#rotator_xzm'));
                     alert($('#rotator_xzm').fn);
                    $('#rotator_xzm').stripesRotator({ images: [ "https://xiazemin.github.io/MyBlog/img/BPlusTree.png", "https://xiazemin.github.io/MyBlog/img/linuxMMap.jpeg"] });
                    });
    </script-->

    <!--水印-->
    <script type="text/javascript" src="/MyBlog/js/waterMark.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
    watermark({watermark_txt0:'泽民博客',watermark_txt1:'zemin',watermark_txt2:(new Date()).Format("yyyy-MM-dd hh:mm:ss.S")});
    })
    </script>
     <!--水印-->
     <!--adscene-->
    <script data-ad-client="ca-pub-6672721494777557" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

 <body>
<div id="wrapper">
 <!-- Navigation -->
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/MyBlog">
                        Home
                    </a>
                </li>
                <li>
                    <a href="#">About</a>
                </li>
                <li>
                    <a href="#">Services</a>
                </li>
                <li>
                    <a href="#">Portfolio</a>
                </li>
                <li>
                    <a href="#">Events</a>
                </li>
                <li>
                    <a href="#">Blog</a>
                </li>
                <li>
                    <a href="#">FAQ</a>
                </li>
                <li>
                    <a href="#">Contact</a>
                </li>
            </ul>
        </div>


    <header class="intro-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="heading text-center">
                        <a href="https://xiazemin.github.io/MyBlog/" style="color: #fff; font-size: 4em; font-family: 'Schoolbell', cursive;">泽民博客</a>
                        <a href="#menu-toggle" class="btn btn-default sciblog" id="menu-toggle" style="font-weight: bold;">&#9776; Menu</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

     <script async src="/MyBlog/js/busuanzi.pure.mini.js"></script>

    <script type="text/javascript" src="/MyBlog/js/jquery.js"></script>
    <script type="text/javascript" src="/MyBlog/js/jquery.stripesrotator.js"></script>


 <div class="container">
	<div class="row">
        <div class="box">
                <div class="col-lg-12">
                    <div class="intro-text text-center">
					<h1 class="post-title" itemprop="name headline">如何运行多进程Docker容器</h1>
					<p class="post-meta"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">by 夏泽民</span></span> <time datetime="2020-01-03T00:00:00+08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Jan 3, 2020</time></p>
					</div>
					 <p>https://github.com/kiwenlau/kubernetes-shell<br />
https://github.com/kiwenlau/kubernetes-supervisor<br />
一般来说，Docker容器比较适合运行单个进程。例如，项目”使用多个Docker容器运行Kubernetes“，Kubernetes的各个组件分别运行在各个容器之中，每个容器只运行单个进程。</p><br />
<br />
<p>然而，很多时候我们需要在Docker容器中运行多个进程。例如，项目”使用单个Docker容器运行Kubernetes“，kubernetes的各个组件均运行在同一个容器中，该容器中运行了多个进程。那么，如何运行多进程Docker容器？</p><br />
<br />
<p>一种方法是使用Shell脚本，另一种方法是使用进程管理工具Supervisor。kiwenlau/kubernetes-shell和kiwenlau/kubernetes-supervisor分别采用了这两种方法，用于启动多个进程来运行Kubernetes的各个组件，从而实现”使用单个Docker容器运行Kubernetes“。下面我将分别介绍两种不同方法。</p><br />
<br />
<p>二. 使用Shell脚本运行多进程Docker容器<br />
这个方法大家应该会比较熟悉，使用Shell脚本依次启动Kubernetes的各个组件即可。以下为start-kubernetes.sh</p><br />
<br />
<p>#!/bin/bash</p><br />
<br />
<h1 id="start-docker-daemon">start docker daemon</h1><br />
<p>docker daemon &gt; /var/log/docker.log 2&gt;&amp;1 &amp;</p><br />
<br />
<h1 id="start-etcd">start etcd</h1><br />
<p>etcd –data-dir=/var/etcd/data &gt; /var/log/etcd.log 2&gt;&amp;1 &amp;</p><br />
<br />
<h1 id="wait-for-ectd-to-setup">wait for ectd to setup</h1><br />
<p>sleep 5</p><br />
<br />
<h1 id="start-apiserver">start apiserver</h1><br />
<p>kube-apiserver –service-cluster-ip-range=10.0.0.1/24 –insecure-bind-address=0.0.0.0 –etcd_servers=http://127.0.0.1:4001 &gt; /var/log/kube-apiserver.log 2&gt;&amp;1 &amp;</p><br />
<br />
<h1 id="wait-for-apiserver-to-setup">wait for apiserver to setup</h1><br />
<p>sleep 5</p><br />
<br />
<h1 id="start-controller-manager-sheduler-kubelet-and-proxy">start controller manager, sheduler, kubelet and proxy</h1><br />
<p>kube-controller-manager –master=http://0.0.0.0:8080 &gt; /var/log/kube-controller-manager.log 2&gt;&amp;1 &amp;<br />
kube-scheduler –master=http://0.0.0.0:8080 &gt; /var/log/kube-scheduler.log 2&gt;&amp;1 &amp;<br />
kubelet –api_servers=http://0.0.0.0:8080 –address=0.0.0.0 –cluster_dns=10.0.0.10 –cluster_domain=”kubernetes.local” –pod-infra-container-image=”kiwenlau/pause:0.8.0”  &gt; /var/log/kubelet.log 2&gt;&amp;1 &amp;<br />
kube-proxy –master=http://0.0.0.0:8080 &gt; /var/log/kube-proxy.log 2&gt;&amp;1 &amp;</p><br />
<br />
<h1 id="just-keep-this-script-running">just keep this script running</h1><br />
<p>while [[ true ]]; do<br />
	sleep 1<br />
done<br />
然后在Dockerfile中，将start-kubernetes.sh指定为Docker容器默认执行的命令即可:</p><br />
<br />
<p>CMD [“start-kubernetes.sh”]<br />
需要注意的一点在于，start-kubernetes.sh脚本将作为Docker容器的1号进程运行，必须始终保持运行。因为Docker容器仅在1号进程运行时保持运行，换言之，Docker容器将在1号进程退出后Exited。由于Kubernetes的各个组件都以后台进程方式执行，我在脚本末尾添加了死循环，以保持start-kubernetes.sh脚本始终处于运行状态。</p><br />
<br />
<h1 id="just-keep-this-script-running-1">just keep this script running</h1><br />
<p>while [[ true ]]; do<br />
	sleep 1<br />
done<br />
三. 使用supervisor运行多进程Docker容器<br />
Supervisor是进程管理工具。这时，需要编写supervisor的配置文件kubernetes.conf:</p><br />
<br />
<p>[supervisord]<br />
nodaemon=true</p><br />
<br />
<p>[program:etcd]<br />
command=etcd –data-dir=/var/etcd/data<br />
autorestart=true<br />
stdout_logfile=/var/log/etcd.stdout.log<br />
stderr_logfile=/var/log/etcd.stderr.log</p><br />
<br />
<p>[program:kube-apiserver]<br />
command=kube-apiserver –service-cluster-ip-range=10.0.0.1/24 –insecure-bind-address=0.0.0.0 –etcd_servers=http://127.0.0.1:4001<br />
autorestart=true<br />
stdout_logfile=/var/log/kube-apiserver.stdout.log<br />
stderr_logfile=/var/log/kube-apiserver.stderr.log</p><br />
<br />
<p>[program:kube-controller-manager]<br />
command=kube-controller-manager –master=http://0.0.0.0:8080<br />
autorestart=true<br />
stdout_logfile=/var/log/controller-manager.stdout.log<br />
stderr_logfile=/var/log/controller-manager.stderr.log</p><br />
<br />
<p>[program:kube-scheduler]<br />
command=kube-scheduler –master=http://0.0.0.0:8080<br />
autorestart=true<br />
stdout_logfile=/var/log/kube-scheduler.stdout.log<br />
stderr_logfile=/var/log/kube-scheduler.stderr.log</p><br />
<br />
<p>[program:kubelet]<br />
command=kubelet –api_servers=http://0.0.0.0:8080 –address=0.0.0.0 –cluster_dns=10.0.0.10 –cluster_domain=”kubernetes.local” –pod-infra-container-image=”kiwenlau/pause:0.8.0”<br />
autorestart=true<br />
stdout_logfile=/var/log/kubelet.stdout.log<br />
stderr_logfile=/var/log/kubelet.stderr.log</p><br />
<br />
<p>[program:kube-proxy]<br />
command=kube-proxy –master=http://0.0.0.0:8080<br />
autorestart=true<br />
stdout_logfile=/var/log/kube-proxy.stdout.log<br />
stderr_logfile=/var/log/kube-proxy.stderr.log</p><br />
<br />
<p>[program:docker]<br />
command=docker daemon<br />
autorestart=true<br />
stdout_logfile=/var/log/docker.stdout.log<br />
stderr_logfile=/var/log/docker.stderr.log<br />
可知，将Kubernetes的各个组件的启动命令设为command即可。autorestart参数设为true，意味着supervisor将负责重启意外退出的组件。stdout_logfile和stderr_logfile参数则可以用于设置命令的标准输出文件和标准错误输出文件。</p><br />
<br />
<p>然后在Dockerfile中，将supervisord指定为Docker容器默认执行的命令即可:</p><br />
<br />
<p>CMD [“supervisord”, “-c”, “/etc/supervisor/conf.d/kubernetes.conf”]<br />
此时, supervisord是Docker容器中的1号进程，也需要始终保持运行状态。nodaemon设为true时，表示supervisor保持前台运行而非在后台运行。若supervisor在后台运行，则Docker容器也会在执行supervisord命令后立即Exited.</p><br />
<br />
<p>[supervisord]<br />
nodaemon=true<br />
四. 总结<br />
使用Shell脚本运行多进程Docker容器，优势是大家比较熟悉。由于需要保持Docker容器的1号进程始终运行，这一点比较容易出错。若要实现进程意外退出后自动重启的话，使用shell脚本比较麻烦。</p><br />
<br />
<p>使用supervisor运行多进程Docker容器，非常方便。另外，保持1号进程保持运行，以及进程意外退出后自动重启，实现起来都很简单。</p><br />
<br />
<p>使用多个Docker容器运行Kubernetes<br />
GitHub地址<br />
https://github.com/kiwenlau/single-kubernetes-docker</p><br />
<br />
<!-- more --><br />
<p>https://docs.docker.com/config/containers/multi-service_container/</p><br />
<br />
<p>https://devops.stackexchange.com/questions/447/why-it-is-recommended-to-run-only-one-process-in-a-container</p><br />
<br />
<p>对于springboot项目，一开始是用java -jar 方式容器中启动，并作为容器的主进程。但测试环境，经常代码逻辑可能有问题，导致主进程失败，容器启动失败，进而触发marathon/k8s健康检查失败，进而不断重启容器。开发呢也一直抱怨看不到“事故现场”。所以针对这种情况，直观的想法是 不让java -jar 作为容器的主进程，进而产生一个在容器中运行多进程的问题。</p><br />
<br />
<p>但容器中运行多进程，跟 one process per container 的理念相悖，我们就得探寻下来龙去脉了。</p><br />
<br />
<p>从业界来说，虽然一个容器一个进程是官方推荐，但好像并不被大厂所遵守，以至于阿里甚至专门搞了一个PouchContainer 出来，美团容器平台架构及容器技术实践</p><br />
<br />
<p>此外要注意的是，一个容器多进程 在k8s 的Pod 概念下，要相机做出一定的调整。</p><br />
<br />
<p>为什么推荐一个容器一个进程？<br />
stack exchange Why it is recommended to run only one process in a container? 有一系列回答</p><br />
<br />
<p>Run Multiple Processes in a Container 也提了三个advantages</p><br />
<br />
<p>理由要找的话有很多，比较喜欢一个回答：As in most cases, it’s not all-or-nothing. The guidance of “one process per container” stems from the idea that containers should serve a distinct purpose. For example, a container should not be both a web application and a Redis server.</p><br />
<br />
<p>There are cases where it makes sense to run multiple processes in a single container, as long as both processes support a single, modular function.</p><br />
<br />
<p>一个容器多个进程有什么风险<br />
理解Docker容器的进程管理</p><br />
<br />
<p>linux 对pid=1进程的要求</p><br />
<br />
<p>管理孤儿进程。当一个子进程终止后，它首先会变成一个“失效(defunct)”的进程，也称为“僵尸（zombie）”进程，等待父进程或系统收回（reap）。如果父进程已经结束了，那些依然在运行中的子进程会成为“孤儿（orphaned）”进程。在Linux中Init进程(PID1)作为所有进程的父进程，会维护进程树的状态，一旦有某个子进程成为了“孤儿”进程后，init就会负责接管这个子进程。当一个子进程成为“僵尸”进程之后，如果其父进程已经结束，init会收割这些“僵尸”，释放PID资源。<br />
如果它没有提供某个信号的处理逻辑，那么发送给它的该信号都会被屏蔽。init 进程一般不处理 SIGTERM 信号，they’re built for hardware shutdowns instead. 原本是防止init进程被误杀。<br />
docker stop 对PID1进程 的要求</p><br />
<br />
<p>支持管理运行过程中可能产生的僵尸/孤儿进程<br />
容器的PID1进程需要能够正确的处理SIGTERM信号来支持优雅退出，如果容器中包含多个进程，需要PID1进程能够正确的传播SIGTERM信号来结束所有的子进程之后再退出。<br />
综上，如果一个容器有多个进程，可选的实践方式为：</p><br />
<br />
<p>多个进程关系对等，由一个init 进程管理，比如supervisor、systemd<br />
一个进程（A）作为主进程，拉起另一个进程（B）</p><br />
<br />
<p>A 先挂，因为容器的生命周期与 主进程一致，则进程B 也会被kill 结束<br />
B 先挂，则要看A 是否具备僵尸进程的处理能力（大部分不具备）。若A 不具备，B 成为僵尸进程，容器存续期间，僵尸进程一致存在。<br />
A 通常不支持 SIGTERM<br />
所以第二种方案通常不可取，对于第一种方案，则有init 进程的选型问题</p><br />
<br />
 	僵尸进程回收	处理SIGTERM信号	alpine 安装大小	专用镜像	备注<br />
<p>sh/bash	支持	不支持	0m	 	脚本中可以使用exec 顶替掉sh/bash 自身<br />
Supervisor	待确认	支持	79m	 	 <br />
runit	待确认	支持	31m	phusion/baseimage-docker	 <br />
s6	 	 	33m	 	 <br />
一个容器多个进程的可能选择<br />
自定义脚本<br />
官方 Run multiple services in a container</p><br />
<br />
<p>systemd<br />
CHAPTER 3. USING SYSTEMD WITH CONTAINERS</p><br />
<br />
<p>Running Docker Containers with Systemd</p><br />
<br />
<p>Do you need to execute more than one process per container?</p><br />
<br />
<p>supervisor<br />
官方 Run multiple services in a container</p><br />
<br />
<p>Admatic Tech Blog: Starting Multiple Services inside a Container with Supervisord</p><br />
<br />
<p>使用</p><br />
<br />
<p>supervisord.conf</p><br />
<br />
<p>[supervisord]<br />
nodaemon=true<br />
logfile=/dev/stdout<br />
loglevel=debug<br />
logfile_maxbytes=0</p><br />
<br />
<p>[program:pinggoogle]<br />
command=ping admatic.in<br />
autostart=true<br />
autorestart=true<br />
startsecs=5<br />
stdout_logfile=NONE<br />
stderr_logfile=NONE<br />
Dockerfile</p><br />
<br />
<p>FROM ubuntu<br />
…<br />
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf<br />
…<br />
CMD [“/usr/bin/supervisord”]<br />
runit<br />
Run Multiple Processes in a Container</p><br />
<br />
<p>A fully­ powered Linux environment typically includes an ​init​ process that spawns and supervises other processes, such as system daemons. The command defined in the CMD instruction of the Dockerfile is the only process launched inside the Docker container, so ​system daemons do not start automatically, even if properly installed.</p><br />
<br />
<p>runit - a UNIX init scheme with service supervision</p><br />
<br />
<p>使用<br />
Dockerfile</p><br />
<br />
<p>FROM phusion/passenger-­ruby22</p><br />
<br />
<p>…</p><br />
<br />
<p>#install custom bootstrap script as runit service<br />
COPY myapp/start.sh /etc/service/myapp/run<br />
myapp/start.sh</p><br />
<br />
<p>#!/bin/sh<br />
exec command<br />
在这个Dockerfile 中，CMD 继承自 base image。 将myapp/start.sh 拷贝到 容器的 /etc/service/myapp/run 文件中即可 被runit 管理，runit 会管理 /etc/service/ 下的应用（目录可配置），即 Each service is associated with a service directory</p><br />
<br />
<p>这里要注意：记得通过exec 方式执行 command，这涉及到 shell，exec，source执行脚本的区别</p><br />
<br />
<p>Using runit for maintaining services</p><br />
<br />
<p>runit：进程管理工具runit</p><br />
<br />
 	作用	备注<br />
<p>runit-init	runit-init is the first process the kernel starts. If runit-init is started as process no 1, it runs and replaces itself with runit	 <br />
runsvdir	starts and monitors a collection of runsv processes	当runsvdir检查到/etc/service目录下包含一个新的目录时，runsvdir会启动一个runsv进程来执行和监控run脚本。<br />
runsvchdir	change services directory of runsvdir	 <br />
sv	control and manage services monitored by runsv	sv status /etc/service/test<br />
sv stop /etc/service/test<br />
sv restart /etc/service/test<br />
runsv	starts and monitors a service and optionally an appendant log service	 <br />
chpst	runs a program with a changed process state	run脚本默认被root用户执行，通过chpst可以将run配置为普通用户来执行。<br />
utmpset	logout a line from utmp and wtmp file	 <br />
svlogd	runit’s service logging daemon	 <br />
runit 工作原理</p><br />
<br />
<p>s6<br />
Managing multiple processes in Docker containers</p><br />
<br />
<p>Docker-friendliness image<br />
与其在init 进程工具的选型上挣扎，是否有更有魄力的工具呢？</p><br />
<br />
<p>docker 原生支持多进程，比如阿里的 pouch<br />
原生支持多进程的 镜像<br />
github 有一个 phusion/baseimage-docker 笔者2018.11.7 看到时，有6848个star。 该镜像有几个优点：</p><br />
<br />
<p>Modifications for Docker-friendliness.<br />
Administration tools that are especially useful in the context of Docker.<br />
Mechanisms for easily running multiple processes, without violating the Docker philosophy. 具体的说，The Docker developers advocate running a single logical service inside a single container. But we are not disputing that. Baseimage-docker advocates running multiple OS processes inside a single container, and a single logical service can consist of multiple OS processes.<br />
什么叫 ubuntu 对 Docker-friendliness？（待体会）</p><br />
<br />
<p>multi-user<br />
multi-process<br />
优雅的管理springboot 项目<br />
回到文开始提到的问题：</p><br />
<br />
<p>phusion/baseimage-docker 的image 是基于ubuntu，笔者试着用alpine + runit + sshd 实现了一个简洁的base image，具体情况待实践一段时间再交流。</p><br />
<br />
<p>多进程方式，使得不管springboot 是否启动成功，容器都会启动成功<br />
另外采取 措施监控 springboot 的健康状态，以决定是否 向该容器打入流量<br />
runit 正常会尝试不断重启，实际上往往因为代码的原因，启动一次就行了。因此启动springboot 的时候，先检查下 有没有/etc/service/springboot/supervise（runsv将服务的状态保存服务对应在supervise目录中） 文件，若没有则是第一次启动。有则是第二次启动，写入/etc/service/springboot/down（down 告知runsv 停止该服务）</p><br />
<br />
<p>https://qiankunli.github.io/2018/11/06/multi_process_per_container.html</p><br />

					 <span class='st_sharethis_large' displayText='ShareThis'></span>
						<span class='st_facebook_large' displayText='Facebook'></span>
						<span class='st_twitter_large' displayText='Tweet'></span>
						<span class='st_linkedin_large' displayText='LinkedIn'></span>
						<span class='st_pinterest_large' displayText='Pinterest'></span>
						<span class='st_email_large' displayText='Email'></span>
                </div>
                Category docker
        </div>
	</div>
  
  
       <!--赞-->
    	  <div class="row">
            <div class="col-lg-6">
                <img src="https://xiazemin.github.io/MyBlog/img/webwxgetmsgimg.jpeg"  height="400" width="auto" />
            </div>
          </div>

        <div class="row">
                <div class="col-md-12">
			<div id="disqus_thread"></div>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/MyBlog/css/default.css">
<script src="/MyBlog/js/gitment.browser.js"></script>
<script type="text/javascript" src="/MyBlog/js/json2.js"></script>
<script>
var gitment = new Gitment({
    owner: 'xiazemin',
    repo: 'MyBlogComment',
    oauth: {
        client_id: '981ba8c916c262631ea0',
        client_secret: 'a52260ef92de69011ccd1cf355b973ef11d6da0e',
    },
});

var MyGitmentContainer=gitment.render('gitmentContainer');
window.setTimeout(MyGitMentBtnclick,1000); 
//document.ready(function(){ 
//window.onload=function(){}

function MyGitMentBtnclick(){
//var MyGitmentContainer=document.getElementById('gitmentContainer');
	var ele=[],all=MyGitmentContainer.getElementsByTagName("*");
	for(var i=0;i<all.length;i++){
	  if(all[i].className=='gitment-comments-init-btn'){
		MyGitMentBtn=all[i];
		console.log(MyGitMentBtn);
		MyGitMentBtn.click();
	  }
	}
}

</script>



			<!--script>
			/**
			* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
			*/
			/*
			var disqus_config = function () {
			this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			};
			*/
			(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//airrayagroup.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
			})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
			<script id="dsq-count-scr" src="//airrayagroup.disqus.com/count.js" async></script-->
          </div>
       </div>

</div>
<hr>
     <footer>
        <div class="container">
             <a href="/MyBlog/" style="color: green; font-size: 2em; font-family: 'Schoolbell', cursive;">首页</a>
            <div class="row">
                <div class="col-lg-6">
                    <p>Copyright &copy; 2017 465474307@qq.com <p>
                </div>
                <div class="col-lg-6">
                    <p style="float: right;">Jekyll theme by <a href="https://github.com/xiazemin/">夏泽民</a></p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="/MyBlog/js/jquery-1.12.0.min.js"></script>
    <script src="/MyBlog/js/jquery-migrate-1.2.1.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="/MyBlog/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"6","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/MyBlog/shareapi/js/share.js?v=89860593.js?'];</script>


<!-- 2d  -->
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.0.min.js"></script>
<script type="text/javascript" charset="utf-8"  src="/MyBlog/js/L2Dwidget.min.js"></script>
<script type="text/javascript">
 setTimeout(()=> {
/*L2Dwidget.init({"display": {
        "superSample": 2,
        "width": 200,
        "height": 400,
             "position": "right",
                 "hOffset": 0,
        "vOffset": 0
          }
     });
*/
 L2Dwidget
        .on('*', (name) => {
          console.log('%c EVENT ' + '%c -> ' + name, 'background: #222; color: yellow', 'background: #fff; color: #000')
        })
        .init({
          dialog: {
            // 开启对话框
            enable: true,
            script: {
              // 每空闲 10 秒钟，显示一条一言
              'every idle 10s': '$hitokoto$',
              // 当触摸到星星图案
              'hover .star': '星星在天上而你在我心里 (*/ω＼*)',
              // 当触摸到角色身体
              'tap body': '哎呀！别碰我！',
              // 当触摸到角色头部
              'tap face': '人家已经不是小孩子了！'
            }
          }
        });

})
</script>



    <!--html xmlns:wb="http://open.weibo.com/wb">
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
    <wb:follow-button uid="2165491993" type="red_1" width="67" height="24" ></wb:follow-button-->

      <!--本文来自-->
     <script type="text/javascript">
      /* 仅IE
     document.body.oncopy = function(){
        setTimeout( 
            function () { 
        var text =window.clipboardData.getData("text"); 
        if (text) { 
            text = text + "/r/n本篇文章来源于 xiazemin 的 泽民博客|https://xiazemin.github.io/MyBlog/index.html 原文链接："+location.href; clipboardData.setData("text", text); 
          }
       },
     100 )
    }
     */
     //绑定在了body上，也可以绑定在其他可用元素行，但是不是所有元素都支持copy和past事件。

     /*
$(document.body).bind({
    copy: function(event) {//copy事件
        //var cpTxt = "复制的数据";
        var clipboardData = window.clipboardData; //for IE
        if (!clipboardData) { // for chrome
            clipboardData = event.originalEvent.clipboardData;
        }

        if (event.clipboardData != null/false/undefined) { //ignore the incorrectness of the truncation
        clipboarddata = event.clipboardData;
        } else if (window.clipboardData != null/false/undefined) {
         clipboarddata = window.clipboardData;
        } else { //default to the last option even if it is null/false/undefined
         clipboarddata = event.originalEvent.clipboardData;
        }

        //e.clipboardData.getData('text');//可以获取用户选中复制的数据
        //clipboardData.setData('Text', cpTxt);
        alert(clipboarddata.getData('text'));
        //$('#message').text('Copy Data : ' + cpTxt);
        return false;//否则设不生效
    },paste: function(e) {//paste事件
        var eve = e.originalEvent
        var cp = eve.clipboardData;
        var data = null;
        var clipboardData = window.clipboardData; // IE
        if (!clipboardData) { //chrome
            clipboardData = e.originalEvent.clipboardData
        }
        data = clipboardData.getData('Text');
        //$('#message').html(data);
    }
});     
*/
function addLink() {
    var body_element = document.getElementsByTagName('body')[0];
    var selection;
    selection = window.getSelection();
    var pagelink = "<br /><br />本文来源：xiazemin 的 泽民博客 <a href='"+document.location.href+"'>"+document.location.href+"</a>";
//+document.location.href+当前页面链接
    var copy_text = selection + pagelink;
    console.log(copy_text);
    var new_div = document.createElement('div');
    new_div.style.left='-99999px';
    new_div.style.position='absolute';
    body_element.appendChild(new_div );
    new_div.innerHTML = copy_text ;
    selection.selectAllChildren(new_div );
    window.setTimeout(function() {
        body_element.removeChild(new_div );
    },0);
}
document.oncopy = addLink;
     </script>
    <!--本文来自-->

</div>
  </body>

</html>