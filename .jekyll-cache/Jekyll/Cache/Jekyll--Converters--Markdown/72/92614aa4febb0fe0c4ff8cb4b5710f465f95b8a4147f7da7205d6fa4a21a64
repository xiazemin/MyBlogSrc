I"ü^<p>ç”±äºä¸€æ®µæœºå™¨è¯­è¨€ç¨‹åºçš„é‚»è¿‘æŒ‡ä»¤ä¹‹é—´å‡ºç°äº†æŸç§å…³è”åï¼Œä¸ºäº†é¿å…å‡ºé”™è€Œä½¿å¾—å®ƒä»¬ä¸èƒ½åŒæ—¶è¢«è§£é‡Šçš„ç°è±¡ï¼Œåˆç§°ç›¸å…³å†²çªã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>åœ¨æµæ°´è§£é‡Šè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°ä¸‰ç§ç›¸å…³ï¼Œè¿™ä¸‰ç§ç›¸å…³æ˜¯èµ„æºç›¸å…³ã€æ•°æ®ç›¸å…³å’Œæ§åˆ¶ç›¸å…³ã€‚

1. èµ„æºç›¸å…³

èµ„æºç›¸å…³----æ˜¯æŒ‡å¤šæ¡æŒ‡ä»¤è¿›å…¥æµæ°´çº¿ååœ¨åŒä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…äº‰ç”¨åŒä¸€åŠŸèƒ½éƒ¨ä»¶æ‰€å‘ç”Ÿçš„ç›¸å…³ã€‚

åœ¨å›¾1æ‰€ç¤ºçš„æµæ°´è§£é‡Šæ—¶ç©ºå›¾ä¸­ï¼Œåœ¨ç¬¬4ä¸ªæ—¶é’Ÿå‘¨æœŸæ—¶ï¼Œç¬¬I1æ¡æŒ‡ä»¤çš„MEMæ®µä¸ç¬¬I4æ¡æŒ‡ä»¤çš„IFæ®µéƒ½è¦è®¿é—®å­˜å‚¨å™¨ã€‚å½“æ•°æ®å’ŒæŒ‡ä»¤æ··å­˜åœ¨åŒä¸€ä¸ªå­˜å‚¨å™¨ä¸”åªæœ‰ä¸€ä¸ªè®¿é—®ç«¯å£æ—¶ï¼Œä¾¿ä¼šå‘ç”Ÿä¸¤æ¡æŒ‡ä»¤äº‰ç”¨åŒä¸€ä¸ªå­˜å‚¨å™¨èµ„æºçš„ç›¸å…³å†²çªã€‚ &lt;!-- more --&gt;  è§£å†³èµ„æºç›¸å…³çš„æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹äº”ç§ï¼š

(1)ä»æ—¶é—´ä¸Šæ¨åä¸‹ä¸€æ¡æŒ‡ä»¤çš„è®¿å­˜æ“ä½œã€‚

(2)è®©æ“ä½œæ•°å’ŒæŒ‡ä»¤åˆ†åˆ«å­˜æ”¾äºä¸¤ä¸ªç‹¬ç«‹ç¼–å€ä¸”å¯åŒæ—¶è®¿é—®çš„ä¸»å­˜å‚¨å™¨ä¸­ã€‚

(3)ä»ç„¶ç»´æŒæŒ‡ä»¤å’Œæ“ä½œæ•°æ··å­˜ï¼Œä½†é‡‡ç”¨å¤šæ¨¡å—äº¤å‰ä¸»å­˜ç»“æ„ã€‚

(4)åœ¨CPUå†…å¢è®¾æŒ‡ä»¤Cacheã€‚

(5)åœ¨CPUå†…å¢è®¾æŒ‡ä»¤Cacheå’Œæ•°æ®Cacheã€‚

2. æ•°æ®ç›¸å…³

æ•°æ®ç›¸å…³----æ˜¯æŒ‡ç”±äºç›¸é‚»çš„ä¸¤æ¡æˆ–å¤šæ¡æŒ‡ä»¤ä½¿ç”¨äº†ç›¸åŒçš„æ•°æ®åœ°å€è€Œå‘ç”Ÿçš„å…³è”ã€‚è¿™é‡Œæ‰€è¯´çš„æ•°æ®åœ°å€åŒ…æ‹¬å­˜å‚¨å•å…ƒåœ°å€å’Œå¯„å­˜å™¨åœ°å€ã€‚

ä¾‹å¦‚ï¼Œæœ‰å¦‚ä¸‹ä¸‰æ¡æŒ‡ä»¤ä¾æ¬¡æµå…¥å¦‚å›¾2æ‰€ç¤ºçš„æµæ°´çº¿ï¼š

    ADD R1ï¼ŒR2ï¼ŒR3    ï¼›(R2)+(R3)â†’R1

    SUB R1ï¼ŒR4ï¼ŒR5    ï¼›(R4)-(R5)â†’R1

    AND R4ï¼ŒR1ï¼ŒR7    ï¼›(R1)âˆ§(R7)â†’R4
</code></pre></div></div>

<p>ç¬¬ä¸‰æ¡æŒ‡ä»¤ä¸å‰é¢ä¸¤æ¡æŒ‡ä»¤ä¹‹é—´å­˜åœ¨ç€å…³äºå¯„å­˜å™¨R1çš„å…ˆå†™åè¯»ï¼ˆRAWï¼‰æ•°æ®ç›¸å…³ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>è§£å†³æ•°æ®ç›¸å…³çš„æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š

(1)æ¨åç›¸å…³å•å…ƒçš„è¯»ã€‚
  (2)è®¾ç½®ç›¸å…³ä¸“ç”¨é€šè·¯ï¼Œåˆç§°é‡‡ç”¨å®šå‘ä¼ é€æŠ€æœ¯ã€‚
   æ¨åç›¸å…³å•å…ƒçš„è¯»å’Œè®¾ç½®ç›¸å…³ä¸“ç”¨é€šè·¯æ˜¯è§£å†³æµæ°´è§£é‡Šæ–¹å¼ä¸­æ•°æ®ç›¸å…³çš„ä¸¤ç§åŸºæœ¬æ–¹æ³•ã€‚æ¨åç›¸å…³å•å…ƒçš„è¯»æ˜¯ä»¥é™ä½é€Ÿåº¦ä¸ºä»£ä»·ï¼Œä½¿è®¾å¤‡åŸºæœ¬ä¸Šä¸å¢åŠ ï¼Œè€Œè®¾ç½®ç›¸å…³ä¸“ç”¨é€šè·¯æ˜¯ä»¥å¢åŠ ç¡¬ä»¶ä¸ºä»£ä»·ï¼Œä½¿æµæ°´è§£é‡Šçš„æ€§èƒ½å°½å¯èƒ½ä¸é™ä½ã€‚

å¯¹æµæ°´çš„æµåŠ¨é¡ºåºçš„å®‰æ’å’Œæ§åˆ¶å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼šé¡ºåºæµåŠ¨æ–¹å¼å’Œå¼‚æ­¥æµåŠ¨æ–¹å¼ã€‚

é¡ºåºæµåŠ¨æ–¹å¼----æ˜¯æŒ‡æµæ°´çº¿è¾“å‡ºç«¯çš„ä»»åŠ¡ï¼ˆæŒ‡ä»¤ï¼‰æµå‡ºé¡ºåºå’Œè¾“å…¥ç«¯çš„æµå…¥é¡ºåºä¸€æ ·ã€‚

é¡ºåºæµåŠ¨æ–¹å¼çš„ä¼˜ç‚¹æ˜¯æ§åˆ¶æ¯”è¾ƒç®€å•ã€‚å…¶ç¼ºç‚¹æ˜¯ä¸€æ—¦å‘ç”Ÿæ•°æ®ç›¸å…³åï¼Œåœ¨ç©ºé—´å’Œæ—¶é—´ä¸Šéƒ½ä¼šæœ‰æŸå¤±ï¼Œä½¿å¾—æµæ°´çº¿çš„ååç‡å’ŒåŠŸèƒ½éƒ¨ä»¶çš„åˆ©ç”¨ç‡é™ä½ã€‚

å¼‚æ­¥æµåŠ¨æ–¹å¼----æ˜¯æŒ‡æµæ°´çº¿è¾“å‡ºç«¯çš„ä»»åŠ¡ï¼ˆæŒ‡ä»¤ï¼‰æµå‡ºé¡ºåºå’Œè¾“å…¥ç«¯çš„æµå…¥é¡ºåºå¯ä»¥ä¸ä¸€æ ·ã€‚

å¼‚æ­¥æµåŠ¨æ–¹å¼çš„ä¼˜ç‚¹æ˜¯æµæ°´çº¿çš„ååç‡å’ŒåŠŸèƒ½éƒ¨ä»¶çš„åˆ©ç”¨ç‡éƒ½ä¸ä¼šä¸‹é™ã€‚ä½†é‡‡ç”¨å¼‚æ­¥æµåŠ¨æ–¹å¼å¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼Œé‡‡ç”¨å¼‚æ­¥æµåŠ¨çš„æ§åˆ¶å¤æ‚ï¼Œè€Œä¸”ä¼šå‘ç”Ÿåœ¨é¡ºåºæµåŠ¨ä¸­ä¸ä¼šå‡ºç°çš„å…¶å®ƒç›¸å…³ã€‚ç”±äºå¼‚æ­¥æµåŠ¨è¦æ”¹å˜æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºï¼ŒåŒæ—¶æµæ°´çº¿çš„å¼‚æ­¥æµåŠ¨è¿˜ä¼šä½¿ç›¸å…³æƒ…å†µå¤æ‚åŒ–ï¼Œä¼šå‡ºç°é™¤å…ˆå†™åè¯»ï¼ˆRAWï¼‰ç›¸å…³ä»¥å¤–çš„å…ˆè¯»åå†™ï¼ˆWARï¼‰ç›¸å…³å’Œå†™å†™ï¼ˆWAWï¼‰ç›¸å…³ã€‚

    3. æ§åˆ¶ç›¸å…³

æ§åˆ¶ç›¸å…³----æ˜¯æŒ‡ç”±è½¬ç§»æŒ‡ä»¤å¼•èµ·çš„ç›¸å…³ã€‚

è§£å†³æ§åˆ¶ç›¸å…³çš„æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š

(1)å»¶è¿Ÿè½¬ç§»æŠ€æœ¯ã€‚

å»¶è¿Ÿè½¬ç§»æŠ€æœ¯----å°†è½¬ç§»æŒ‡ä»¤ä¸å…¶å‰é¢çš„ä¸è½¬ç§»æŒ‡ä»¤æ— å…³çš„ä¸€æ¡æˆ–å‡ æ¡æŒ‡ä»¤å¯¹æ¢ä½ç½®ï¼Œè®©æˆåŠŸè½¬ç§»æ€»æ˜¯åœ¨ç´§è·Ÿçš„æŒ‡ä»¤è¢«æ‰§è¡Œä¹‹åå‘ç”Ÿï¼Œä»è€Œä½¿é¢„å–çš„æŒ‡ä»¤ä¸ä½œåºŸã€‚

(2)è½¬ç§»é¢„æµ‹æŠ€æœ¯ã€‚

è½¬ç§»é¢„æµ‹æŠ€æœ¯å¯åˆ†ä¸ºé™æ€è½¬ç§»é¢„æµ‹å’ŒåŠ¨æ€è½¬ç§»é¢„æµ‹ä¸¤ç§ï¼ˆç”±ç¡¬ä»¶æ¥å®ç°ï¼‰ã€‚

é™æ€è½¬ç§»é¢„æµ‹æŠ€æœ¯æœ‰ä¸¤ç§å®ç°æ–¹æ³•ï¼š

ä¸€ç§æ˜¯åˆ†æç¨‹åºç»“æ„æœ¬èº«çš„ç‰¹ç‚¹æ¥è¿›è¡Œé¢„æµ‹ã€‚ä¸å°‘æ¡ä»¶è½¬ç§»æŒ‡ä»¤è½¬å‘ä¸¤ä¸ªç›®æ ‡åœ°å€çš„æ¦‚ç‡æ˜¯èƒ½å¤Ÿé¢„ä¼°çš„ï¼Œå¦‚è‹¥x86æ±‡ç¼–è¯­è¨€ä¸­è¿ç»­çš„ä¸¤æ¡è¯­å¥ä¸ºâ€œADD AX,BXâ€ã€â€œJNZ L1â€ï¼Œåˆ™è½¬å‘æ ‡å·L1çš„æ¦‚ç‡è¦é«˜ï¼Œåªè¦ç¼–è¯‘ç¨‹åºæŠŠå‡ºç°æ¦‚ç‡é«˜çš„åˆ†æ”¯å®‰æ’ä¸ºçŒœé€‰åˆ†æ”¯ï¼Œå°±èƒ½æ˜¾è‘—å‡å°‘ç”±äºå¤„ç†æ¡ä»¶è½¬ç§»æ‰€å¸¦æ¥çš„æµæ°´çº¿ååç‡å’Œæ•ˆç‡çš„æŸå¤±ã€‚

å¦ä¸€ç§æ˜¯æŒ‰ç…§åˆ†æ”¯çš„æ–¹å‘æ¥é¢„æµ‹åˆ†æ”¯æ˜¯å¦è½¬ç§»æˆåŠŸã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå‘ååˆ†æ”¯è¢«å‡å®šä¸ºå¾ªç¯çš„ä¸€éƒ¨åˆ†è€Œä¸”è¢«å‡å®šä¸ºå‘ç”Ÿè½¬ç§»ï¼Œè¿™ç§é™æ€é¢„æµ‹çš„å‡†ç¡®æ€§æ˜¯ç›¸å½“é«˜çš„ã€‚å‘å‰åˆ†æ”¯è¢«å‡å®šä¸ºæ¡ä»¶è¯­å¥çš„ä¸€éƒ¨åˆ†è€Œä¸”è¢«å‡å®šä¸ºä¸å‘ç”Ÿè½¬ç§»ï¼Œè¿™ç§é™æ€é¢„æµ‹çš„å‡†ç¡®æ€§æ¯”å‘ååˆ†æ”¯çš„å‡†ç¡®æ€§è¦ä½å¾—å¤šã€‚

è¦æé«˜é¢„æµ‹çš„å‡†ç¡®åº¦ï¼Œå¯ä»¥é‡‡ç”¨åŠ¨æ€é¢„æµ‹çš„æ–¹æ³•ï¼Œåœ¨ç¡¬ä»¶ä¸Šå»ºç«‹åˆ†æ”¯é¢„æµ‹ç¼“å†²ç«™åŠåˆ†æ”¯ç›®æ ‡ç¼“å†²ç«™ï¼Œæ ¹æ®æ‰§è¡Œè¿‡ç¨‹ä¸­è½¬ç§»çš„å†å²è®°å½•æ¥åŠ¨æ€çš„é¢„æµ‹è½¬ç§»ç›®æ ‡ï¼Œå…¶é¢„æµ‹å‡†ç¡®åº¦å¯ä»¥æé«˜åˆ°90%ä»¥ä¸Šã€‚è¿™ç§æ–¹æ³•å·²åœ¨ç°ä»£å¾®å¤„ç†å™¨çš„è½¬ç§»é¢„æµ‹ä¸­å¾—åˆ°äº†å¹¿æ³›åº”ç”¨ã€‚ä¾‹å¦‚ï¼ŒPentium 4å¾®å¤„ç†å™¨ä¸­çš„L1 BTBï¼ˆBranch Target Bufferï¼Œè½¬ç§»ç›®æ ‡ç¼“å†²å™¨ï¼‰é‡‡ç”¨çš„å°±æ˜¯åŠ¨æ€è½¬ç§»é¢„æµ‹æŠ€æœ¯ï¼Œå½“è½¬ç§»æŒ‡ä»¤ä¸åœ¨BTBä¸­æ—¶ï¼Œåˆ™é‡‡ç”¨é™æ€è½¬ç§»é¢„æµ‹æŠ€æœ¯ã€‚

åœ¨å®‰è…¾ä½“ç³»ç»“æ„è®¾è®¡æ—¶ï¼Œé‡‡ç”¨äº†ä¸€ç§æ–°çš„è½¬ç§»é¢„æµ‹æŠ€æœ¯ã€‚è¯¥æŠ€æœ¯å°†ä¼ ç»Ÿçš„åˆ†æ”¯ç»“æ„å˜ä¸ºæ— åˆ†æ”¯çš„å¹¶è¡Œä»£ç ï¼Œå½“å¤„ç†æœºåœ¨è¿è¡Œä¸­é‡åˆ°åˆ†æ”¯æ—¶ï¼Œå®ƒå¹¶ä¸æ˜¯è¿›è¡Œä¼ ç»Ÿçš„åˆ†æ”¯é¢„æµ‹å¹¶é€‰æ‹©å¯èƒ½æ€§æœ€å¤§çš„ä¸€ä¸ªåˆ†æ”¯æ‰§è¡Œï¼Œè€Œæ˜¯åˆ©ç”¨å¤šä¸ªåŠŸèƒ½éƒ¨ä»¶æŒ‰åˆ†æ”¯çš„æ‰€æœ‰å¯èƒ½çš„åç»­è·¯å¾„å¼€å§‹å¹¶è¡Œæ‰§è¡Œå¤šæ®µä»£ç ï¼Œå¹¶æš‚å­˜å„æ®µä»£ç çš„æ‰§è¡Œç»“æœï¼Œç›´åˆ°å¤„ç†æœºèƒ½å¤Ÿç¡®è®¤åˆ†æ”¯è½¬ç§»ä¸å¦çš„æ¡ä»¶æ˜¯çœŸæ˜¯å‡æ—¶ï¼Œå¤„ç†æœºå†æŠŠåº”è¯¥é€‰æ‹©çš„è·¯å¾„ä¸Šçš„æŒ‡ä»¤æ‰§è¡Œç»“æœä¿ç•™ä¸‹æ¥ã€‚é‡‡ç”¨äº†è¿™ç§æŠ€æœ¯åï¼Œå¯æ¶ˆé™¤å¤§éƒ¨åˆ†è½¬ç§»æŒ‡ä»¤å¯¹æµæ°´è§£é‡Šçš„å½±å“ï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œé€Ÿåº¦å¾—åˆ°æé«˜ã€‚

æµæ°´çº¿å†’é™© å›é¡¾ä¸€ä¸‹å¸¸ç”¨äº”é˜¶æ®µæµæ°´çº¿ï¼šFï¼ˆå–æŒ‡ï¼‰Dï¼ˆè¯‘ç ï¼‰Eï¼ˆæ‰§è¡Œï¼‰Mï¼ˆè®¿å­˜ï¼‰Wï¼ˆå†™å›ï¼‰ æ³¨æ„ï¼šå¯¹å¯„å­˜å™¨æ–‡ä»¶çš„å†™åªæœ‰åœ¨æ—¶é’Ÿä¸Šå‡çš„æ—¶å€™æ‰ä¼šæ›´æ–°ï¼
</code></pre></div></div>

<p>æ•°æ®å†’é™©çš„åŸå› ï¼šå¯¹å¯„å­˜å™¨æ–‡ä»¶çš„è¯»å†™æ˜¯åœ¨ä¸åŒé˜¶æ®µè¿›è¡Œçš„</p>

<p>1.ç”¨æš‚åœæ¥é¿å…æ•°æ®å†’é™©
æš‚åœæ—¶ï¼Œå¤„ç†å™¨ä¼šåœæ­¢æµæ°´çº¿ä¸­ä¸€æ¡æˆ–å¤šæ¡æŒ‡ä»¤ï¼Œç›´åˆ°å†’é™©æ¡ä»¶ä¸å†æ»¡è¶³ã€‚
åœ¨æœ¬è¯¥æ­£å¸¸å¤„ç†çš„æŸæŒ‡ä»¤é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬æ¯æ¬¡è¦æŠŠä¸€æ¡æŒ‡ä»¤é˜»å¡åœ¨è¯‘ç é˜¶æ®µï¼Œå°±åœ¨æ‰§è¡Œé˜¶æ®µæ’å…¥ä¸€ä¸ªæ°”æ³¡ã€‚
å®ç°ç®€å•ï¼Œä½†æ€§èƒ½ä¸å¥½ï¼Œä¸¥é‡é™ä½äº†æ•´ä½“çš„ååé‡
2.ç”¨è½¬å‘æ¥é¿å…æ•°æ®å†’é™©
â‘ è¯‘ç é˜¶æ®µé€»è¾‘å‘ç°å¯„å­˜å™¨æ˜¯æ“ä½œæ•°çš„æºå¯„å­˜å™¨ï¼Œä½†æ˜¯åœ¨å†™ç«¯å£ä¸Šè¿˜æœ‰ä¸€ä¸ªå¯¹è¯¥å¯„å­˜å™¨æœªè¿›è¡Œçš„å†™ï¼Œå°†ç»“æœå€¼ç›´æ¥ä»ä¸€ä¸ªæµæ°´çº¿é˜¶æ®µä¼ åˆ°è¾ƒæ—©é˜¶æ®µçš„æŠ€æœ¯ç§°ä¸ºæ•°æ®è½¬å‘ï¼ˆæ—è·¯ï¼‰ã€‚è¿™ç§æƒ…å†µçš„ä¿¡å·æ˜¯W_valEã€‚
â‘¡è®¿å­˜é˜¶æ®µä¸­æœ‰å¯¹å¯„å­˜å™¨æœªè¿›è¡Œçš„å†™ï¼Œä¹Ÿå¯ä»¥ç”¨æ•°æ®è½¬å‘ã€‚è¿™ç§æƒ…å†µçš„ä¿¡å·æ˜¯m_valEã€‚
â‘¢æ‰§è¡Œé˜¶æ®µALUæ­£åœ¨è®¡ç®—çš„å€¼ç¨åä¼šå†™å…¥å¯„å­˜å™¨æ—¶ï¼Œä¹Ÿå¯ä»¥å°†ALUçš„è¾“å‡ºä¿¡å·ä½œä¸ºæ“ä½œæ•°valBï¼Œè¿™ç§æƒ…å†µçš„ä¿¡å·æ˜¯e_valMã€‚
â‘£å¯è½¬å‘åˆšä»å†…å­˜ä¸­è¯»å‡ºçš„å€¼ï¼Œè¿™ç§æƒ…å†µçš„ä¿¡å·æ˜¯m_valMã€‚
â‘¤å¯è½¬å‘å†™å›é˜¶æ®µå¯¹ç«¯å£Mæœªè¿›è¡Œçš„å†™ï¼Œè¿™ç§æƒ…å†µçš„ä¿¡å·æ˜¯W_valMã€‚
3.åŠ è½½/ä½¿ç”¨æ•°æ®å†’é™©
æœ‰ä¸€ç±»æ•°æ®å†’é™©ä¸èƒ½å•çº¯ç”¨è½¬å‘æ¥è§£å†³ï¼Œå› ä¸ºå†…å­˜è¯»åœ¨æµæ°´çº¿å‘ç”Ÿçš„æ¯”è¾ƒæ™šï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æš‚åœå’Œè½¬å‘ç»“åˆèµ·æ¥ï¼Œé¿å…åŠ è½½/ä½¿ç”¨æ•°æ®å†’é™©ã€‚
è¿™ç§ç”¨æš‚åœæ¥å¤„ç†åŠ è½½/ä½¿ç”¨å†’é™©çš„æ–¹æ³•ç§°ä¸ºåŠ è½½äº’é”ï¼ŒåŠ è½½äº’é”å’Œè½¬å‘æŠ€æœ¯ç»“åˆèµ·æ¥ï¼Œè¶³ä»¥å¤„ç†æ‰€æœ‰å¯èƒ½ç±»å‹çš„æ•°æ®å†’é™©
4.é¿å…æ§åˆ¶å†’é™©
å½“å¤„ç†å™¨æ— æ³•æ ¹æ®å¤„äºå–å€¼é˜¶æ®µçš„å½“å‰æŒ‡ä»¤æ¥ç¡®å®šä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€æ—¶ï¼Œå°±ä¼šå‡ºç°æ§åˆ¶å†’é™©ï¼ˆåœ¨æµæ°´çº¿åŒ–å¤„ç†å™¨ä¸­ï¼Œæ§åˆ¶å†’é™©åªä¼šå‘ç”Ÿåœ¨retæŒ‡ä»¤å’Œè·³è½¬æŒ‡ä»¤ï¼‰è·³è½¬æŒ‡ä»¤åªæœ‰åœ¨æ¡ä»¶è·³è½¬æ–¹å‘é¢„æµ‹é”™è¯¯æ—¶æ‰ä¼šé€ æˆéº»çƒ¦ã€‚
retæŒ‡ä»¤ç»è¿‡è¯‘ç ï¼Œæ‰§è¡Œå’Œè®¿å­˜é˜¶æ®µæ—¶ï¼Œæµæ°´çº¿ä¸èƒ½åšä»»ä½•æœ‰ç”¨çš„æ´»åŠ¨ï¼Œæˆ‘ä»¬åªèƒ½åœ¨æµæ°´çº¿ä¸­æ’å…¥ä¸‰ä¸ªæ°”æ³¡ï¼Œä¸€æ—¦retæŒ‡ä»¤åˆ°è¾¾å†™å›é˜¶æ®µï¼ŒPCé€‰æ‹©é€»è¾‘å°±ä¼šå°†ç¨‹åºè®¡æ•°å™¨è®¾ä¸ºè¿”å›åœ°å€ã€‚
è·³è½¬æŒ‡ä»¤çš„æ‰§è¡Œé˜¶æ®µæ‰ä¼šçŸ¥é“æ˜¯å¦åº”è¯¥è·³è½¬ï¼Œä½†åœ¨è¿™ä¹‹å‰æµæ°´çº¿é¢„æµ‹ä¼šé€‰æ‹©åˆ†æ”¯å¹¶å–æŒ‡ã€è¯‘ç ã€æ‰§è¡Œï¼Œå½“è·³è½¬æŒ‡ä»¤é€šè¿‡æ‰§è¡Œé˜¶æ®µåï¼Œæµæ°´çº¿ä¼šå‘è¯‘ç é˜¶æ®µå’Œæ‰§è¡Œé˜¶æ®µæ’å…¥æ°”æ³¡ï¼Œå–æ¶ˆä¸¤æ¡ç›®æ ‡æŒ‡ä»¤ï¼ŒåŒæ—¶å–å‡ºè·³è½¬æŒ‡ä»¤åé¢çš„é‚£æ¡æŒ‡ä»¤ï¼Œ
ç¼ºç‚¹ï¼šä¸¤ä¸ªæ—¶é’Ÿå‘¨æœŸçš„æŒ‡ä»¤å¤„ç†èƒ½åŠ›æ˜¯è¢«æµªè´¹çš„ã€‚</p>

<p>é€šè¿‡æ…é‡è€ƒè™‘æµæ°´çº¿çš„æ§åˆ¶é€»è¾‘ï¼Œæ§åˆ¶å†’é™©æ˜¯å¯ä»¥è¢«å¤„ç†çš„ï¼Œæš‚åœå’Œå¾€æµæ°´çº¿ä¸­æ’å…¥æ°”æ³¡çš„æŠ€æœ¯å¯ä»¥åŠ¨æ€è°ƒæ•´æµæ°´çº¿çš„æµç¨‹ã€‚</p>

<p>1 ä¸»è¦å®ç°ä»£ç </p>

<p>1.1 PC</p>

<p>ä¸»ä½“ä¸ºä¸€ä¸ª32ä½å¯„å­˜å™¨ï¼Œå¸¦æœ‰stallä¿¡å·å…³é—­å†™ä½¿èƒ½ä¿¡å·</p>

<p>module PC(IF_Result,Clk,En,Clrn,IF_Addr,stall);</p>

<p>input [31:0]IF_Result;</p>

<p>input Clk,En,Clrn,stall;</p>

<p>output [31:0] IF_Addr;</p>

<p>wire En_S;</p>

<p>assign En_S=En&amp;~stall;</p>

<p>D_FFEC32 pc(IF_Result,Clk,En_S,Clrn,IF_Addr);</p>

<p>Endmodule</p>

<p>1.2 INSTMEMï¼ˆæŒ‡ä»¤å­˜å‚¨å™¨ï¼‰</p>

<p>ä¸»è¦å‚è€ƒä¹¦ä¸Šä»£ç ï¼ˆé™„æ¯æ¡æŒ‡ä»¤å…·ä½“å«ä¹‰ï¼‰</p>

<p>module INSTMEM(Addr,Inst);//æŒ‡ä»¤å­˜å‚¨å™¨</p>

<p>input[31:0]Addr;</p>

<p>output[31:0]Inst;</p>

<p>wire[31:0]Rom[31:0];</p>

<p>assign Rom[5â€™h00]=32â€™b001000_00000_00001_0000_0000_0000_0010; //addi$1,$0,2â€“$1=2  2 0 2</p>

<p>assignRom[5â€™h01]=32â€™b001000_00000_00010_0000_0000_0000_0100; //addi $2,$0,4â€“$2=4  4 0 4</p>

<p>assignRom[5â€™h02]=32â€™b000000_00010_00001_00011_00000_100010; //sub$3,$2,$1â€“$3=$2-$1=2  ï¼ˆ$2,rs,memçº§æ•°æ®å‰æ¨ï¼‰2 4 2</p>

<p>assignRom[5â€™h03]=32â€™b101011_00010_00001_0000_0000_0000_1010; //sw$1,10($2)â€“[10+$2]=$1=2 ï¼ˆ$2,rs,wbçº§æ•°æ®å‰æ¨ï¼‰e 4 a</p>

<p>assign Rom[5â€™h04]=32â€™b100011_00010_00100_0000_0000_0000_1010;//lw $4,10($2)â€“$4=[10+$2]=2                 e4a</p>

<p>assignRom[5â€™h05]=32â€™b000000_00100_00001_00011_00000_100000;//add $3,$4,$1â€“$3=$4+$1=6$3=6             422</p>

<p>assignRom[5â€™h06]=32â€™b000000_00001_00011_00010_00000_100000;//add $2,$1,$3â€“$2=$1+$3=8 ($3 ,rt,mem) 624</p>

<p>assignRom[5â€™h07]=32â€™b001000_00000_00001_0000_0000_0000_0010;//addi $1,$0,2â€“$1=2                                    202</p>

<p>assignRom[5â€™h08]=32â€™b000000_00001_00010_00100_00000_100000;//add $4,$1,$2 â€“$4=$1+$2=10(&amp;2 ,rt,wb)   8 2 6  assign Inst=Rom[Addr[6:2]];</p>

<p>endmodule</p>

<p>1.3 CONUNITï¼ˆæ§åˆ¶éƒ¨ä»¶ï¼‰</p>

<p>module CONUNIT(M_Op,Op,Func,M_Z,Regrt,Se,Wreg,Aluqb,Aluc,Wmem,Pcsrc,Reg2reg,Rs,Rt,E_Rd,M_Rd,E_Wreg,M_Wreg,FwdA,FwdB,E_Reg2reg,stall);</p>

<p>input [5:0]Op,Func,M_Op;</p>

<p>input M_Z;</p>

<p>input E_Wreg,M_Wreg,E_Reg2reg;</p>

<p>input [4:0]E_Rd,M_Rd,Rs,Rt;</p>

<p>output Regrt,Se,Wreg,Aluqb,Wmem,Reg2reg,stall;</p>

<p>output [1:0]Pcsrc,Aluc;</p>

<p>output reg [1:0]FwdA,FwdB;</p>

<table>
  <tbody>
    <tr>
      <td>wire R_type=~</td>
      <td>Op;</td>
    </tr>
  </tbody>
</table>

<p>wireI_add=R_type&amp;Func[5]&amp;~Func[4]&amp;~Func[3]&amp;~Func[2]&amp;~Func[1]&amp;~Func[0];</p>

<p>wireI_sub=R_type&amp;Func[5]&amp;~Func[4]&amp;~Func[3]&amp;~Func[2]&amp;Func[1]&amp;~Func[0];</p>

<p>wireI_and=R_type&amp;Func[5]&amp;~Func[4]&amp;~Func[3]&amp;Func[2]&amp;~Func[1]&amp;~Func[0];</p>

<p>wireI_or=R_type&amp;Func[5]&amp;~Func[4]&amp;~Func[3]&amp;Func[2]&amp;~Func[1]&amp;Func[0];</p>

<p>wire I_addi=~Op[5]&amp;~Op[4]&amp;Op[3]&amp;~Op[2]&amp;~Op[1]&amp;~Op[0];</p>

<p>wire I_andi=~Op[5]&amp;~Op[4]&amp;Op[3]&amp;Op[2]&amp;~Op[1]&amp;~Op[0];</p>

<p>wire I_ori=~Op[5]&amp;~Op[4]&amp;Op[3]&amp;Op[2]&amp;~Op[1]&amp;Op[0];</p>

<p>wire I_lw=Op[5]&amp;~Op[4]&amp;~Op[3]&amp;~Op[2]&amp;Op[1]&amp;Op[0];</p>

<p>wire I_sw=Op[5]&amp;~Op[4]&amp;Op[3]&amp;~Op[2]&amp;Op[1]&amp;Op[0];</p>

<p>wire I_beq=~Op[5]&amp;~Op[4]&amp;~Op[3]&amp;Op[2]&amp;~Op[1]&amp;~Op[0];</p>

<p>wire I_bne=~Op[5]&amp;~Op[4]&amp;~Op[3]&amp;Op[2]&amp;~Op[1]&amp;Op[0];</p>

<p>wireM_beq=~M_Op[5]&amp;~M_Op[4]&amp;~M_Op[3]&amp;M_Op[2]&amp;~M_Op[1]&amp;~M_Op[0];</p>

<p>wireM_bne=~M_Op[5]&amp;~M_Op[4]&amp;~M_Op[3]&amp;M_Op[2]&amp;~M_Op[1]&amp;M_Op[0];</p>

<p>wire I_J=~Op[5]&amp;~Op[4]&amp;~Op[3]&amp;~Op[2]&amp;Op[1]&amp;~Op[0];</p>

<table>
  <tbody>
    <tr>
      <td>wire E_Inst = I_add</td>
      <td>I_sub</td>
      <td>I_and</td>
      <td>I_or</td>
      <td>I_sw</td>
      <td>I_beq</td>
      <td>I_bne;</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>assign Regrt = I_addi</td>
      <td>I_andi</td>
      <td>I_ori</td>
      <td>I_lw</td>
      <td>I_sw</td>
      <td>I_beq</td>
      <td>I_bne</td>
      <td>I_J;</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>assign Se = I_addi</td>
      <td>I_lw</td>
      <td>I_sw</td>
      <td>I_beq</td>
      <td>I_bne;</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>assign Wreg = I_add</td>
      <td>I_sub</td>
      <td>I_and</td>
      <td>I_or</td>
      <td>I_addi</td>
      <td>I_andi</td>
      <td>I_ori</td>
      <td>I_lw;</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>assign Aluqb = I_add</td>
      <td>I_sub</td>
      <td>I_and</td>
      <td>I_or</td>
      <td>I_beq</td>
      <td>I_bne</td>
      <td>I_J;</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>assign Aluc[1] = I_and</td>
      <td>I_or</td>
      <td>I_andi</td>
      <td>I_ori;</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>assign Aluc[0] = I_sub</td>
      <td>I_or</td>
      <td>I_ori</td>
      <td>I_beq</td>
      <td>I_bne;</td>
    </tr>
  </tbody>
</table>

<p>assign Wmem = I_sw;</p>

<table>
  <tbody>
    <tr>
      <td>assign Pcsrc[1] = (M_beq&amp;M_Z)</td>
      <td>(M_bne&amp;~M_Z)</td>
      <td>I_J;</td>
    </tr>
  </tbody>
</table>

<p>assign Pcsrc[0] = I_J;</p>

<table>
  <tbody>
    <tr>
      <td>assign Reg2reg = I_add</td>
      <td>I_sub</td>
      <td>I_and</td>
      <td>I_or</td>
      <td>I_addi</td>
      <td>I_andi</td>
      <td>I_ori</td>
      <td>I_sw</td>
      <td>I_beq</td>
      <td>I_bne</td>
      <td>I_J;</td>
    </tr>
  </tbody>
</table>

<p>always@(E_Rd,M_Rd,E_Wreg,M_Wreg,Rs,Rt)begin</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FwdA=2'b00;
</code></pre></div></div>

<p>if((Rs==E_Rd)&amp;(E_Rd!=0)&amp;(E_Wreg==1))begin</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    FwdA=2'b10;

end else begin

   if((Rs==M_Rd)&amp;(M_Rd!=0)&amp;(M_Wreg==1))begin

        FwdA=2'b01;

    end

end
</code></pre></div></div>

<p>end</p>

<p>always@(E_Rd,M_Rd,E_Wreg,M_Wreg,Rs,Rt)begin</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FwdB=2'b00;
</code></pre></div></div>

<p>if((Rt==E_Rd)&amp;(E_Rd!=0)&amp;(E_Wreg==1))begin</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           FwdB=2'b10;

end else begin

   if((Rt==M_Rd)&amp;(M_Rd!=0)&amp;(M_Wreg==1))begin

        FwdB=2'b01;

    end

end
</code></pre></div></div>

<p>end</p>

<table>
  <tbody>
    <tr>
      <td>assignstall=((Rs==E_Rd)</td>
      <td>(Rt==E_Rd))&amp;(E_Reg2reg==0)&amp;(E_Rd!=0)&amp;(E_Wreg==1);</td>
    </tr>
  </tbody>
</table>

<p>endmodule</p>

<p>Â </p>

<p>1.4 REGFILE(å¯„å­˜å™¨)</p>

<p>ä¸»è¦å‚è€ƒä¹¦ä¸Šä»£ç </p>

<p>module REGFILE(Ra,Rb,D,Wr,We,Clk,Clrn,Qa,Qb);</p>

<p>input [4:0]Ra,Rb,Wr;</p>

<p>input [31:0]D;</p>

<p>input We,Clk,Clrn;</p>

<p>output [31:0]Qa,Qb;</p>

<p>wire[31:0]Y_mux,Q31_reg32,Q30_reg32,Q29_reg32,Q28_reg32,Q27_reg32,Q26_reg32,Q25_reg32,Q24_reg32,Q23_reg32,Q22_reg32,Q21_reg32,Q20_reg32,Q19_reg32,Q18_reg32,Q17_reg32,Q16_reg32,Q15_reg32,Q14_reg32,Q13_reg32,Q12_reg32,Q11_reg32,Q10_reg32,Q9_reg32,Q8_reg32,Q7_reg32,Q6_reg32,Q5_reg32,Q4_reg32,Q3_reg32,Q2_reg32,Q1_reg32,Q0_reg32;</p>

<p>DEC5T32E dec(Wr,We,Y_mux);</p>

<p>REG32_DOWN A(D,Y_mux,Clk,Clrn,Q31_reg32,Q30_reg32,Q29_reg32,Q28_reg32,Q27_reg32,Q26_reg32,Q25_reg32,Q24_reg32,Q23_reg32,Q22_reg32,Q21_reg32,Q20_reg32,Q19_reg32,Q18_reg32,Q17_reg32,Q16_reg32,Q15_reg32,Q14_reg32,Q13_reg32,Q12_reg32,Q11_reg32,Q10_reg32,Q9_reg32,Q8_reg32,Q7_reg32,Q6_reg32,Q5_reg32,Q4_reg32,Q3_reg32,Q2_reg32,Q1_reg32,Q0_reg32);</p>

<p>MUX32X32 select1(Q0_reg32,Q1_reg32,Q2_reg32,Q3_reg32,Q4_reg32,Q5_reg32,Q6_reg32,Q7_reg32,Q8_reg32,Q9_reg32,Q10_reg32,Q11_reg32,Q12_reg32,Q13_reg32,Q14_reg32,Q15_reg32,Q16_reg32,Q17_reg32,Q18_reg32,Q19_reg32,Q20_reg32,Q21_reg32,Q22_reg32,Q23_reg32,Q24_reg32,Q25_reg32,Q26_reg32,Q27_reg32,Q28_reg32,Q29_reg32,Q30_reg32,Q31_reg32,Ra,Qa);</p>

<p>MUX32X32select2(Q0_reg32,Q1_reg32,Q2_reg32,Q3_reg32,Q4_reg32,Q5_reg32,Q6_reg32,Q7_reg32,Q8_reg32,Q9_reg32,Q10_reg32,Q11_reg32,Q12_reg32,Q13_reg32,Q14_reg32,Q15_reg32,Q16_reg32,Q17_reg32,Q18_reg32,Q19_reg32,Q20_reg32,Q21_reg32,Q22_reg32,Q23_reg32,Q24_reg32,Q25_reg32,Q26_reg32,Q27_reg32,Q28_reg32,Q29_reg32,Q30_reg32,Q31_reg32,Rb,Qb);</p>

<p>Endmodule</p>

<p>Â </p>

<p>å®ç°ä¸‹é™æ²¿å†™å…¥æ•°æ®ä¸»è¦ç”±å°†D_FFéƒ¨ä»¶æ”¹ä¸ºä¸‹é™æ²¿æ›´æ–°ï¼š</p>

<p>module D_FF_DOWN(D,Clk,Q,Qn);</p>

<p>input D,Clk;</p>

<p>output Q,Qn;</p>

<p>wire Clkn,Q0,Qn0;</p>

<p>not i0(Clkn,Clk);</p>

<p>D_Latch d0(D,Clk,Q0,Qn0);</p>

<p>D_Latch d1(Q0,Clkn,Q,Qn);</p>

<p>endmodule</p>

<p>1.5 ALUï¼ˆè®¡ç®—éƒ¨ä»¶ï¼‰</p>

<p>ä»…å®ç°åŠ ã€å‡ã€æŒ‰ä½ä¸ã€æŒ‰ä½æˆ–</p>

<p>module ALU(X,Y,Aluc,R,Z);//ALUä»£ç </p>

<p>input [31:0]X,Y;</p>

<p>input [1:0]Aluc;</p>

<p>output [31:0]R;</p>

<p>output Z;</p>

<p>wire[31:0]d_as,d_and,d_or,d_and_or;</p>

<p>ADDSUB_32 as(X,Y,Aluc[0],d_as);</p>

<p>assign d_and=X&amp;Y;</p>

<table>
  <tbody>
    <tr>
      <td>assign d_or=X</td>
      <td>Y;</td>
    </tr>
  </tbody>
</table>

<p>MUX2X32select1(d_and,d_or,Aluc[0],d_and_or);</p>

<p>MUX2X32seleted(d_as,d_and_or,Aluc[1],R);</p>

<table>
  <tbody>
    <tr>
      <td>assign Z=~</td>
      <td>R;</td>
    </tr>
  </tbody>
</table>

<p>endmodule</p>

<p>1.6 DATAMEMï¼ˆæ•°æ®å­˜å‚¨å™¨ï¼‰</p>

<p>module DATAMEM(Addr,Din,Clk,We,Dout);</p>

<p>input[31:0]Addr,Din;</p>

<p>input Clk,We;</p>

<p>output[31:0]Dout;</p>

<p>reg[31:0]Ram[31:0];</p>

<p>assign Dout=Ram[Addr[6:2]];</p>

<p>always@(posedge Clk)begin</p>

<p>if(We)Ram[Addr[6:2]]&lt;=Din;</p>

<p>end</p>

<p>integer i;</p>

<p>initial begin</p>

<p>for(i=0;i&lt;32;i=i+1)</p>

<p>Ram[i]=0;</p>

<p>end</p>

<p>endmodule</p>

<p>Â </p>

<p>1.7 ä¸­é—´å¯„å­˜å™¨ï¼ˆä»¥ID/EXçº§ä¸ºä¾‹ï¼‰</p>

<p>ä¸»è¦ä¸ºè‹¥å¹²ä¸ªè‹¥å¹²ä½å¯„å­˜å™¨ç»„æˆï¼Œåœ¨åŠ ä¸Šstallä¿¡å·æ§åˆ¶æ¸…é›¶ã€‚</p>

<p>moduleREGidex(D0,D1,D2,D3,D4,D5,D6,D7,D8,D9,D10,En,Clk,Clrn_S,Q0,Q1,Q2,Q3,Q4,Q5,Q6,Q7,Q8,Q9,Q10,D11,D12,Q11,Q12,stall);</p>

<p>input [31:0] D6,D7,D8,D9;</p>

<p>input [5:0]D3;</p>

<p>input [4:0]D10;</p>

<p>input [1:0]D4,D11,D12;</p>

<p>input D0,D1,D2,D5;</p>

<p>input En,Clk,Clrn_S,stall;</p>

<p>wire Clrn;</p>

<p>assign Clrn=Clrn_S&amp;~stall;</p>

<p>output [31:0] Q6,Q7,Q8,Q9;</p>

<p>output [5:0] Q3;</p>

<p>output [4:0]Q10;</p>

<p>output [1:0]Q4,Q11,Q12;</p>

<p>output Q0,Q1,Q2,Q5;</p>

<p>D_FFEC q0(D0,Clk,En,Clrn,Q0);</p>

<p>D_FFEC q1(D1,Clk,En,Clrn,Q1);</p>

<p>D_FFEC q2(D2,Clk,En,Clrn,Q2);</p>

<p>D_FFEC6 q3(D3,Clk,En,Clrn,Q3);</p>

<p>D_FFEC2 q4(D4,Clk,En,Clrn,Q4);</p>

<p>D_FFEC q5(D5,Clk,En,Clrn,Q5);</p>

<p>D_FFEC32 q6(D6,Clk,En,Clrn,Q6);</p>

<p>D_FFEC32 q7(D7,Clk,En,Clrn,Q7);</p>

<p>D_FFEC32 q8(D8,Clk,En,Clrn,Q8);</p>

<p>D_FFEC32 q9(D9,Clk,En,Clrn,Q9);</p>

<p>D_FFEC5 q10(D10,Clk,En,Clrn,Q10);</p>

<p>D_FFEC2 q11(D11,Clk,En,Clrn,Q11);</p>

<p>D_FFEC2 q12(D12,Clk,En,Clrn,Q12);</p>

<p>endmodule</p>

<p>Â </p>

<p>1.8 MAINï¼ˆç»„è£…éƒ¨åˆ†ï¼‰</p>

<p>module MAIN(Clk,En,Clrn,IF_ADDR,EX_X,EX_Y,EX_R);</p>

<p>input Clk,En,Clrn;</p>

<p>output[31:0] IF_ADDR,EX_R,EX_X,EX_Y;</p>

<p>wire [31:0] IF_Result,IF_Addr,IF_PCadd4,IF_Inst,D,ID_Qa,ID_Qb,ID_PCadd4,ID_Inst;</p>

<p>wire [31:0]E_PC,E_R1,E_R2,E_I,E_I_L2,Y,E_R,EX_PC,M_PC,M_R,M_S,Dout,W_D,W_C,ID_EXTIMM,Alu_X,E_NUM;</p>

<p>wire[5:0] M_Op,E_Op;</p>

<p>wire [4:0] ID_Wr,W_Wr,E_Rd,M_Rd;</p>

<p>wire [1:0]Aluc,Pcsrc,E_Aluc,FwdA,FwdB,E_FwdA,E_FwdB;</p>

<p>wire M_Z,Regrt,Se,Wreg,Aluqb,Reg2reg,Wmem;</p>

<p>wireE_Wreg,E_Reg2reg,E_Wmem,E_Aluqb,E_Z,Cout,M_Wreg,M_Reg2reg,M_Wmem,W_Wreg,W_Reg2reg,stall;</p>

<p>//IF</p>

<p>MUX4X32 mux4x32(IF_PCadd4,0,M_PC,0,Pcsrc,IF_Result);</p>

<p>PC pc(IF_Result,Clk,En,Clrn,IF_Addr,stall);</p>

<p>PCadd4 pcadd4(IF_Addr,IF_PCadd4);</p>

<p>INSTMEM instmem(IF_Addr,IF_Inst);</p>

<p>REG_ifid ifid(IF_PCadd4,IF_Inst,En,Clk,Clrn,ID_PCadd4,ID_Inst,stall);</p>

<p>//ID</p>

<p>CONUNITconunit(M_Op,ID_Inst[31:26],ID_Inst[5:0],M_Z,Regrt,Se,Wreg,Aluqb,Aluc,Wmem,Pcsrc,Reg2reg,ID_Inst[25:21],ID_Inst[20:16],E_Rd,M_Rd,E_Wreg,M_Wreg,FwdA,FwdB,E_Reg2reg,stall);</p>

<p>MUX2X5 mux2x5(ID_Inst[15:11],ID_Inst[20:16],Regrt,ID_Wr);</p>

<p>EXT16T32 ext16t32(ID_Inst[15:0],Se,ID_EXTIMM);</p>

<p>REGFILEregfile(ID_Inst[25:21],ID_Inst[20:16],D,W_Wr,W_Wreg,Clk,Clrn,ID_Qa,ID_Qb);</p>

<p>REGidex idex(Wreg,Reg2reg,Wmem,ID_Inst[31:26],Aluc,Aluqb,ID_PCadd4,ID_Qa,ID_Qb,ID_EXTIMM,ID_Wr,En,Clk,Clrn,E_Wreg,E_Reg2reg,E_Wmem,E_Op,E_Aluc,E_Aluqb,E_PC,E_R1,E_R2,E_I,E_Rd,FwdA,FwdB,E_FwdA,E_FwdB,stall);</p>

<p>//EX</p>

<p>SHIFTER32_L2 shifter2(E_I,E_I_L2);</p>

<p>MUX4X32 mux4x32_ex_1(E_R1,D,M_R,0,E_FwdA,Alu_X);</p>

<p>MUX4X32 mux4x32_ex_2(E_R2,D,M_R,0,E_FwdB,E_NUM);</p>

<p>MUX2X32 mux2x321(E_I,E_NUM,E_Aluqb,Y);</p>

<p>ALU alu(Alu_X,Y,E_Aluc,E_R,E_Z);</p>

<p>CLA_32 cla_32(E_PC,E_I_L2,0,EX_PC,Cout);</p>

<p>REGexmemexmem(E_Wreg,E_Reg2reg,E_Wmem,E_Op,EX_PC,E_Z,E_R,E_R2,E_Rd,En,Clk,Clrn,M_Wreg,M_Reg2reg,M_Wmem,M_Op,M_PC,M_Z,M_R,M_S,M_Rd);</p>

<p>//MEM</p>

<p>DATAMEM datamem(M_R,M_S,Clk,M_Wmem,Dout);</p>

<p>REGmemwbmemwb(M_Wreg,M_Reg2reg,M_R,Dout,M_Rd,En,Clk,Clrn,W_Wreg,W_Reg2reg,W_D,W_C,W_Wr);</p>

<p>//WB</p>

<p>MUX2X32 mux2x322(W_C,W_D,W_Reg2reg,D);</p>

<p>assign IF_ADDR=IF_Addr;</p>

<p>assign EX_R=E_R;</p>

<p>assign EX_X=Alu_X;</p>

<p>assign EX_Y=Y;</p>

<p>endmodule</p>

<p>2 ç»“æ„å›¾</p>

<p>å›¾2-1 æµæ°´çº¿CPUç»“æ„å›¾</p>

<p>3 æµ‹è¯•ä»£ç åŠä»¿çœŸç»“æœ</p>

<p>3.1 æµ‹è¯•ä»£ç </p>

<p>module TEST;</p>

<p>reg Clk;</p>

<p>reg En;</p>

<p>reg Clrn;</p>

<p>wire [31:0] IF_ADDR;</p>

<p>wire [31:0] EX_R;</p>

<p>wire [31:0] EX_X;</p>

<p>wire [31:0] EX_Y;</p>

<p>MAIN uut(</p>

<p>.Clk(Clk),</p>

<p>.En(En),</p>

<p>.Clrn(Clrn),</p>

<p>.IF_ADDR(IF_ADDR),</p>

<p>.EX_R(EX_R),</p>

<p>.EX_X(EX_X),</p>

<p>.EX_Y(EX_Y)</p>

<p>);</p>

<p>initial begin</p>

<p>Clk=0;Clrn=0;En=1;</p>

<p>#10;</p>

<p>Clk=1;Clrn=0;</p>

<p>#10;</p>

<p>Clrn=1;</p>

<p>Clk=0;</p>

<p>forever #20 Clk=~Clk;</p>

<p>end</p>

<p>endmodule</p>

<p>3.2 ä»¿çœŸç»“æœ</p>

<p>3.3 ä»¿çœŸç»“æœåˆ†æ</p>

<p>ç»“åˆæŒ‡ä»¤å‚¨å­˜å™¨ï¼Œä¸»è¦è§‚å¯ŸEX_X,EX_Y,EX_Rä¸‰ä¸ªå˜é‡ï¼ˆALUè®¡ç®—éƒ¨ä»¶çš„Xï¼ŒYï¼ŒRç«¯ï¼‰</p>

<p>æŒ‡ä»¤åœ°å€</p>

<p>æŒ‡ä»¤ä»£ç </p>

<p>å«ä¹‰</p>

<p>Qa</p>

<p>Qb</p>

<p>R</p>

<p>00000000</p>

<p>001000_00000_00001_0000_0000_0000_0010</p>

<p>addi $1,$0,2â€“$1=2</p>

<p>$0(0)</p>

<p>2(ç«‹å³æ•°)</p>

<p>$1(2)</p>

<p>00000004</p>

<p>001000_00000_00010_0000_0000_0000_0100</p>

<p>addi $2,$0,4â€“$2=4</p>

<p>$0(0)</p>

<p>4(ç«‹å³æ•°)</p>

<p>$2(4)</p>

<p>00000008</p>

<p>000000_00010_00001_00011_00000_100010</p>

<p>sub $3,$2,$1Â  ï¼ˆ$2,rs,mem)</p>

<p>$2(4)</p>

<p>$1(2)</p>

<p>$3(2)</p>

<p>0000000C</p>

<p>101011_00010_00001_0000_0000_0000_1010</p>

<p>sw $1,10($2) ï¼ˆ$2,rs,wbï¼‰</p>

<p>$2(4)</p>

<p>10</p>

<p>e</p>

<p>00000010</p>

<p>100011_00010_00100_0000_0000_0000_1010</p>

<p>lw $4,10($2)Â Â  $4=2</p>

<p>$2(4)</p>

<p>10</p>

<p>e</p>

<p>00000014</p>

<p>000000_00100_00001_00011_00000_100000</p>

<p>add $3,$4,$1Â </p>

<p>$4(2)</p>

<p>$1(2)</p>

<p>$3(4)</p>

<p>00000018</p>

<p>000000_00001_00011_00010_00000_100000</p>

<p>add $2,$1,$3 ($3 ,rt,mem)</p>

<p>$1(2)</p>

<p>$3(4)</p>

<p>$2(6)</p>

<p>0000001C</p>

<p>001000_00000_00001_0000_0000_0000_0010</p>

<p>addi $1,$0,2â€“$1=2Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </p>

<p>$0(0)</p>

<p>2(ç«‹å³æ•°)</p>

<p>$1(2)</p>

<p>00000020</p>

<p>000000_00001_00010_00100_00000_100000</p>

<p>add $4,$1,$2 (&amp;2 ,rt,wb)</p>

<p>$1(2)</p>

<p>$2(6)</p>

<p>$4(8)</p>
:ET