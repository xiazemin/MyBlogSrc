I"Úz<p>å®˜æ–¹å®šä¹‰ï¼š</p>

<p>Package template implements data-driven templates for generating textual output.</p>

<p>template åŒ…æ˜¯æ•°æ®é©±åŠ¨çš„æ–‡æœ¬è¾“å‡ºæ¨¡æ¿ï¼Œå…¶å®å°±æ˜¯åœ¨å†™å¥½çš„æ¨¡æ¿ä¸­å¡«å……æ•°æ®ã€‚
æ¨¡æ¿
ä»€ä¹ˆæ˜¯æ¨¡æ¿ï¼Ÿ
ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡æ¿ç¤ºä¾‹ï¼š
// æ¨¡æ¿å®šä¹‰
tepl := â€œMy name is {{ . }}â€</p>

<p>// è§£ææ¨¡æ¿
tmpl, err := template.New(â€œtestâ€).Parse(tepl)</p>

<p>// æ•°æ®é©±åŠ¨æ¨¡æ¿
data := â€œjackâ€
err = tmpl.Execute(os.Stdout, data)
å¤åˆ¶ä»£ç {{ å’Œ }} ä¸­é—´çš„å¥å· . ä»£è¡¨ä¼ å…¥æ¨¡æ¿çš„æ•°æ®ï¼Œæ ¹æ®ä¼ å…¥çš„æ•°æ®ä¸åŒæ¸²æŸ“ä¸åŒçš„å†…å®¹ã€‚
. å¯ä»¥ä»£è¡¨ go è¯­è¨€ä¸­çš„ä»»ä½•ç±»å‹ï¼Œå¦‚ç»“æ„ä½“ã€å“ˆå¸Œç­‰ã€‚
è‡³äº {{ å’Œ }} åŒ…è£¹çš„å†…å®¹ç»Ÿç§°ä¸º actionï¼Œåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p>

<p>æ•°æ®æ±‚å€¼ï¼ˆdata evaluationsï¼‰
æ§åˆ¶ç»“æ„ï¼ˆcontrol structuresï¼‰</p>

<p>action æ±‚å€¼çš„ç»“æœä¼šç›´æ¥å¤åˆ¶åˆ°æ¨¡æ¿ä¸­ï¼Œæ§åˆ¶ç»“æ„å’Œæˆ‘ä»¬å†™ Go ç¨‹åºå·®ä¸å¤šï¼Œä¹Ÿæ˜¯æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥ã€å˜é‡ã€å‡½æ•°è°ƒç”¨ç­‰ç­‰â€¦
å°†æ¨¡æ¿æˆåŠŸè§£æï¼ˆParseï¼‰åï¼Œå¯ä»¥å®‰å…¨åœ°åœ¨å¹¶å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¦‚æœè¾“å‡ºåˆ°åŒä¸€ä¸ª io.Writer æ•°æ®å¯èƒ½ä¼šé‡å ï¼ˆå› ä¸ºä¸èƒ½ä¿è¯å¹¶å‘æ‰§è¡Œçš„å…ˆåé¡ºåºï¼‰ã€‚
<!-- more -->
Actions
æ¨¡æ¿ä¸­çš„ action å¹¶ä¸å¤šï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªçœ‹ã€‚
æ³¨é‡Š
{{/* comment */}}
å¤åˆ¶ä»£ç è£å‰ªç©ºæ ¼
// è£å‰ª content å‰åçš„ç©ºæ ¼
{{- content -}}</p>

<p>// è£å‰ª content å‰é¢çš„ç©ºæ ¼
{{- content }}</p>

<p>// è£å‰ª content åé¢çš„ç©ºæ ¼
{{ content -}}
å¤åˆ¶ä»£ç æ–‡æœ¬è¾“å‡º
{{ pipeline }}
å¤åˆ¶ä»£ç pipeline ä»£è¡¨çš„æ•°æ®ä¼šäº§ç”Ÿä¸è°ƒç”¨ fmt.Print å‡½æ•°ç±»ä¼¼çš„è¾“å‡ºï¼Œä¾‹å¦‚æ•´æ•°ç±»å‹çš„ 3 ä¼šè½¬æ¢æˆå­—ç¬¦ä¸² â€œ3â€ è¾“å‡ºã€‚
æ¡ä»¶è¯­å¥
{{ if pipeline }} T1 {{ end }}</p>

<p>{{ if pipeline }} T1 {{ else }} T0 {{ end }}</p>

<p>{{ if pipeline }} T1 {{ else if pipeline }} T0 {{ end }}</p>

<p>// ä¸Šé¢çš„è¯­æ³•å…¶å®æ˜¯ä¸‹é¢çš„ç®€å†™
{{ if pipeline }} T1 {{ else }}{{ if pipeline }} T0 { {end }}{{ end }}</p>

<p>{{ if pipeline }} T1 {{ else if pipeline }} T2 {{ else }} T0 {{ end }}
å¤åˆ¶ä»£ç å¦‚æœ pipeline çš„å€¼ä¸ºç©ºï¼Œä¸ä¼šè¾“å‡º T1ï¼Œé™¤æ­¤ä¹‹å¤– T1 éƒ½ä¼šè¢«è¾“å‡ºã€‚
ç©ºå€¼æœ‰ falseã€0ã€ä»»æ„ nil æŒ‡é’ˆã€æ¥å£å€¼ã€æ•°ç»„ã€åˆ‡ç‰‡ã€å­—å…¸å’Œç©ºå­—ç¬¦ä¸² â€œâ€œï¼ˆé•¿åº¦ä¸º 0 çš„å­—ç¬¦ä¸²ï¼‰ã€‚
å¾ªç¯è¯­å¥
{{ range pipeline }} T1 {{ end }}</p>

<p>// è¿™ä¸ª else æ¯”è¾ƒæœ‰æ„æ€ï¼Œå¦‚æœ pipeline çš„é•¿åº¦ä¸º 0 åˆ™è¾“å‡º else ä¸­çš„å†…å®¹
{{ range pipeline }} T1 {{ else }} T0 {{ end }}</p>

<p>// è·å–å®¹å™¨çš„ä¸‹æ ‡
{{ range $index, $value := pipeline }} T1 {{ end }}
å¤åˆ¶ä»£ç pipeline çš„å€¼å¿…é¡»æ˜¯æ•°ç»„ã€åˆ‡ç‰‡ã€å­—å…¸å’Œé€šé“ä¸­çš„ä¸€ç§ï¼Œå³å¯è¿­ä»£ç±»å‹çš„å€¼ï¼Œæ ¹æ®å€¼çš„é•¿åº¦è¾“å‡ºå¤šä¸ª T1ã€‚
define
{{ define â€œnameâ€ }} T {{ end }}
å¤åˆ¶ä»£ç å®šä¹‰å‘½åä¸º name çš„æ¨¡æ¿ã€‚
template
{{ template â€œnameâ€ }}</p>

<p>{{ template â€œnameâ€ pipeline }}
å¤åˆ¶ä»£ç å¼•ç”¨å‘½åä¸º name çš„æ¨¡æ¿ã€‚
block
{{ block â€œnameâ€ pipeline }} T1 {{ end }}
å¤åˆ¶ä»£ç block çš„è¯­ä¹‰æ˜¯å¦‚æœæœ‰å‘½åä¸º name çš„æ¨¡æ¿ï¼Œå°±å¼•ç”¨è¿‡æ¥æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰å‘½åä¸º name çš„æ¨¡æ¿ï¼Œå°±æ˜¯æ‰§è¡Œè‡ªå·±å®šä¹‰çš„å†…å®¹ã€‚
ä¹Ÿå°±æ˜¯å¤šåšäº†ä¸€æ­¥æ¨¡æ¿æ˜¯å¦å­˜åœ¨çš„åˆ¤æ–­ï¼Œæ ¹æ®è¿™ä¸ªç»“æœæ¸²æŸ“ä¸åŒçš„å†…å®¹ã€‚
with
{{ with pipeline }} T1 {{ end }}</p>

<p>// å¦‚æœ pipeline æ˜¯ç©ºå€¼åˆ™è¾“å‡º T0
{{ with pipeline }} T1 {{ else }} T0 {{ end }}</p>

<p>{{ with arg }}
    . // æ­¤æ—¶ . å°±æ˜¯ arg
{{ end }}
å¤åˆ¶ä»£ç with åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œåœ¨æ­¤ç¯å¢ƒä¸­çš„ . ä¸å¤–é¢çš„ . æ— å…³ã€‚
å‚æ•°
å‚æ•°çš„å€¼æœ‰å¤šç§è¡¨ç°å½¢å¼ï¼Œå¯ä»¥æ±‚å€¼ä»»ä½•ç±»å‹ï¼ŒåŒ…æ‹¬å‡½æ•°ã€æŒ‡é’ˆï¼ˆæŒ‡é’ˆä¼šè‡ªåŠ¨é—´æ¥å–å€¼åˆ°åŸå§‹çš„å€¼ï¼‰ï¼š</p>

<p>å¸ƒå°”ã€å­—ç¬¦ä¸²ã€å­—ç¬¦ã€æµ®ç‚¹æ•°ã€å¤æ•°çš„è¡Œä¸ºå’Œ Go ç±»ä¼¼
å…³é”®å­— nil ä»£è¡¨ go è¯­è¨€ä¸­çš„ nil
å­—ç¬¦å¥å· . ä»£è¡¨å€¼çš„ç»“æœ
ä»¥ $ å­—ç¬¦å¼€å¤´çš„å˜é‡åˆ™ä¸ºå˜é‡å¯¹åº”çš„å€¼
ç»“æ„ä½“çš„å­—æ®µè¡¨ç¤ºä¸º .Fieldï¼Œç»“æœæ˜¯ Field çš„å€¼ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ .Field1.Field2
å­—å…¸çš„ key è¡¨ç¤ºä¸º .Key ç»“æœæ˜¯ Key å¯¹åº”çš„å€¼
å¦‚æœæ˜¯ç»“æ„ä½“çš„æ–¹æ³•é›†ä¸­çš„æ–¹æ³• .Method ç»“æœæ˜¯æ–¹æ³•è°ƒç”¨åè¿”å›çš„å€¼ï¼ˆThe result is the value of invoking the method with dot as the receiverï¼‰**</p>

<p>æ–¹æ³•è¦ä¹ˆåªæœ‰ä¸€ä¸ªä»»æ„ç±»å‹çš„è¿”å›å€¼è¦ä¹ˆç¬¬äºŒä¸ªè¿”å›å€¼ä¸º errorï¼Œä¸èƒ½å†å¤šäº†ï¼Œå¦‚æœ error ä¸ä¸º nilï¼Œä¼šç›´æ¥æŠ¥é”™ï¼Œåœæ­¢æ¨¡æ¿æ¸²æŸ“
æ–¹æ³•è°ƒç”¨çš„ç»“æœå¯ä»¥ç»§ç»­é“¾å¼è°ƒç”¨ .Field1.Key1.Method1.Field2.Key2.Method2
å£°æ˜å˜é‡æ–¹æ³•é›†ä¹Ÿå¯ä»¥è°ƒç”¨ $x.Method1.Field
ç”¨æ‹¬å·å°†è°ƒç”¨åˆ†ç»„ print (.Func1 arg1) (.Func2 arg2) æˆ– (.StructValuedMethod â€œargâ€).Field</p>

<p>è¿™é‡Œæœ€éš¾æ‡‚çš„å¯èƒ½å°±æ˜¯å‡½æ•°è¢«è°ƒç”¨çš„æ–¹å¼ï¼Œå¦‚æœè®¿é—®ç»“æ„ä½“æ–¹æ³•é›†ä¸­çš„å‡½æ•°å’Œå­—æ®µä¸­çš„å‡½æ•°ï¼Œæ­¤æ—¶çš„è¡Œä¸ºæœ‰ä»€ä¹ˆä¸åŒ?
å†™ä¸ª demo æµ‹ä¸€ä¸‹ï¼š
type T struct {
	Add func(int) int
}</p>

<p>func (t *T) Sub(i int) int {
	log.Println(â€œget argument i:â€, i)
	return i - 1
}</p>

<p>func arguments() {
	ts := &amp;T{
		Add: func(i int) int {
			return i + 1
		},
	}
	tpl := `
		// åªèƒ½ä½¿ç”¨ call è°ƒç”¨
		call field func Add: {{ call .ts.Add .y }}
		// ç›´æ¥ä¼ å…¥ .y è°ƒç”¨
		call method func Sub: {{ .ts.Sub .y }}
	`
	t, _ := template.New(â€œtestâ€).Parse(tpl)
	t.Execute(os.Stdout, map[string]interface{}{
		â€œyâ€: 3,
		â€œtsâ€: ts,
	})
}</p>

<p>output:</p>

<p>call field func Add: 4
call method func Sub: 2
å¤åˆ¶ä»£ç å¯ä»¥å¾—å‡ºç»“è®ºï¼šå¦‚æœå‡½æ•°æ˜¯ç»“æ„ä½“ä¸­çš„å‡½æ•°å­—æ®µï¼Œè¯¥å‡½æ•°ä¸ä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œåªèƒ½ä½¿ç”¨å†…ç½®å‡½æ•° call è°ƒç”¨ã€‚
å¦‚æœå‡½æ•°æ˜¯ç»“æ„ä½“æ–¹æ³•é›†ä¸­çš„æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¹¶ä¸”ä¼šå°†è¿”å›å€¼èµ‹å€¼ç»™ .ï¼Œå¦‚æœå‡½æ•°è¿”å›æ–°çš„ç»“æ„ä½“ã€mapï¼Œå¯ä»¥ç»§ç»­é“¾å¼è°ƒç”¨ã€‚
å˜é‡
action ä¸­çš„ pipeline å¯ä»¥åˆå§‹åŒ–å˜é‡å­˜å‚¨ç»“æœï¼Œè¯­æ³•ä¹Ÿå¾ˆç®€å•ï¼š
$variable = pipeline
å¤åˆ¶ä»£ç æ­¤æ—¶ï¼Œè¿™ä¸ª action å£°æ˜äº†ä¸€ä¸ªå˜é‡è€Œæ²¡æœ‰äº§ç”Ÿä»»ä½•è¾“å‡ºã€‚
range å¾ªç¯å¯ä»¥å£°æ˜ä¸¤ä¸ªå˜é‡ï¼š
range $index, $element := pipeline
å¤åˆ¶ä»£ç åœ¨ ifã€with å’Œ range ä¸­ï¼Œå˜é‡çš„ä½œç”¨åŸŸæ‹“å±•åˆ° {{ end }} æ‰€åœ¨çš„ä½ç½®ã€‚
å¦‚æœä¸æ˜¯æ§åˆ¶ç»“æ„ï¼Œå£°æ˜çš„å˜é‡çš„ä½œç”¨åŸŸä¼šæ‰©å±•åˆ°æ•´ä¸ªæ¨¡æ¿ã€‚
ä¾‹å¦‚åœ¨æ¨¡æ¿å¼€å§‹æ—¶å£°æ˜å˜é‡ï¼š
{{ $pages := .pagination.Pages }}
{{ $current := .pagination.Current }}
å¤åˆ¶ä»£ç åœ¨æ¸²æŸ“å¼€å§‹çš„æ—¶å€™ï¼Œ$ å˜é‡ä¼šè¢«æ›¿æ¢æˆ . å¼€å¤´çš„å€¼ï¼Œä¾‹å¦‚ $pages ä¼šè¢«æ›¿æ¢æˆ .pagenation.Pagesã€‚æ‰€ä»¥åœ¨æ¨¡æ¿é—´çš„ç›¸äº’å¼•ç”¨ä¸ä¼šä¼ é€’å˜é‡ï¼Œå˜é‡åªåœ¨æŸä¸ªç‰¹å®šçš„ä½œç”¨åŸŸä¸­äº§ç”Ÿä½œç”¨ã€‚
å‡½æ•°
æ¨¡æ¿æ¸²æŸ“æ—¶ä¼šåœ¨ä¸¤ä¸ªåœ°æ–¹æŸ¥æ‰¾å‡½æ•°ï¼š</p>

<p>è‡ªå®šä¹‰çš„å‡½æ•° map
å…¨å±€å‡½æ•° mapï¼Œè¿™äº›å‡½æ•°æ˜¯æ¨¡æ¿å†…ç½®çš„</p>

<p>è‡ªå®šä¹‰å‡½æ•°ä½¿ç”¨ func (t *Template) Funcs(funcMap FuncMap) *Template æ³¨å†Œã€‚
å…¨å±€å‡½æ•°åˆ—è¡¨ï¼š
and
è¿”å›å‚æ•°ä¹‹é—´ and å¸ƒå°”æ“ä½œçš„ç»“æœï¼Œå…¶å®å°±æ˜¯ JavaScript ä¸­çš„é€»è¾‘æ“ä½œç¬¦ &amp;&amp;ï¼Œè¿”å›ç¬¬ä¸€ä¸ªèƒ½è½¬æ¢æˆ false çš„å€¼ï¼Œåœ¨ Go ä¸­å°±æ˜¯é›¶å€¼ï¼Œå¦‚æœéƒ½ä¸º true è¿”å›æœ€åä¸€ä¸ªå€¼ã€‚
tpl := â€œ{{ and .x .y .z }}â€
t, _ := template.New(â€œtestâ€).Parse(tpl)
t.Execute(os.Stdout, map[string]interface{}{
    â€œxâ€: 1,
    â€œyâ€: 0,
    â€œzâ€: 3,
})</p>

<p>output:</p>

<p>0
å¤åˆ¶ä»£ç or
é€»è¾‘æ“ä½œç¬¦ ||ï¼Œè¿”å›ç¬¬ä¸€ä¸ªèƒ½è½¬æ¢æˆ true çš„å€¼ï¼Œåœ¨ Go ä¸­å°±æ˜¯éé›¶å€¼ï¼Œå¦‚æœéƒ½ä¸º false è¿”å›æœ€åä¸€ä¸ªå€¼ã€‚
tpl := â€œ{{ or .x .y .z }}â€
t, _ := template.New(â€œtestâ€).Parse(tpl)
t.Execute(os.Stdout, map[string]interface{}{
    â€œxâ€: 1,
    â€œyâ€: 0,
    â€œzâ€: 3,
})</p>

<p>output:</p>

<p>1
å¤åˆ¶ä»£ç call
è¿”å›è°ƒç”¨ç¬¬ä¸€ä¸ªå‡½æ•°å‚æ•°çš„ç»“æœï¼Œå‡½æ•°å¿…é¡»æœ‰ä¸€ä¸ªæˆ–ä¸¤ä¸ªå›å€¼ï¼ˆç¬¬äºŒä¸ªè¿”å›å€¼å¿…é¡»æ˜¯ errorï¼Œå¦‚æœå€¼ä¸ä¸º nil ä¼šåœæ­¢æ¨¡æ¿æ¸²æŸ“ï¼‰
tpl := â€œcall: {{ call .x .y .z }} \nâ€
t, _ := template.New(â€œtestâ€).Parse(tpl)
t.Execute(os.Stdout, map[string]interface{}{
    â€œxâ€: func(x, y int) int { return x+y},
    â€œyâ€: 2,
    â€œzâ€: 3,
})</p>

<p>output:</p>

<p>5
å¤åˆ¶ä»£ç html
è¿”å›è½¬ä¹‰åçš„ HTML å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå‡½æ•°ä¸èƒ½åœ¨ html/template ä¸­ä½¿ç”¨ã€‚
js
è¿”å›è½¬ä¹‰åçš„ JavaScript å­—ç¬¦ä¸²ã€‚
index
åœ¨ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ arrayã€sliceã€map æ—¶ä½¿ç”¨ï¼Œè¿”å›å¯¹åº”ä¸‹æ ‡çš„å€¼ã€‚
index x 1 2 3 ç­‰äº x[1][2][3]ã€‚
len
è¿”å›å¤åˆç±»å‹çš„é•¿åº¦ã€‚
not
è¿”å›å¸ƒå°”ç±»å‹å‚æ•°çš„ç›¸åå€¼ã€‚
print
ç­‰äº fmt.Sprintã€‚
printf
ç­‰äº fmt.Sprintfã€‚
println
ç­‰äº fmt.Sprintlnã€‚
urlquery
å¯¹å­—ç¬¦ä¸²è¿›è¡Œ url Query è½¬ä¹‰ï¼Œä¸èƒ½åœ¨ html/template åŒ…ä¸­ä½¿ç”¨ã€‚
// URLQueryEscaper returns the escaped value of the textual representation of
// its arguments in a form suitable for embedding in a URL query.
func URLQueryEscaper(args â€¦interface{}) string {
	return url.QueryEscape(evalArgs(args))
}
å¤åˆ¶ä»£ç ä»æºç å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°ç›´æ¥è°ƒç”¨ url.QueryEscape å¯¹å­—ç¬¦ä¸²è¿›è¡Œè½¬ä¹‰ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç¥ç§˜çš„ã€‚
æ¯”è¾ƒå‡½æ•°</p>

<p>eq: ==
ge: &gt;=
gt: &gt;
le: &lt;=
lt: &lt;
ne: !=</p>

<p>åˆ†æä¸¤ä¸ªæºç ï¼š
// eq evaluates the comparison a == b || a == c || â€¦
func eq(arg1 reflect.Value, arg2 â€¦reflect.Value) (bool, error) {
	v1 := indirectInterface(arg1)
	k1, err := basicKind(v1)
	if err != nil {
		return false, err
	}
	if len(arg2) == 0 {
		return false, errNoComparison
	}
	for _, arg := range arg2 {
		v2 := indirectInterface(arg)
		k2, err := basicKind(v2)
		if err != nil {
			return false, err
		}
		truth := false
		if k1 != k2 {
			// Special case: Can compare integer values regardless of typeâ€™s sign.
			switch {
			case k1 == intKind &amp;&amp; k2 == uintKind:
				truth = v1.Int() &gt;= 0 &amp;&amp; uint64(v1.Int()) == v2.Uint()
			case k1 == uintKind &amp;&amp; k2 == intKind:
				truth = v2.Int() &gt;= 0 &amp;&amp; v1.Uint() == uint64(v2.Int())
			default:
				return false, errBadComparison
			}
		} else {
			switch k1 {
			case boolKind:
				truth = v1.Bool() == v2.Bool()
			case complexKind:
				truth = v1.Complex() == v2.Complex()
			case floatKind:
				truth = v1.Float() == v2.Float()
			case intKind:
				truth = v1.Int() == v2.Int()
			case stringKind:
				truth = v1.String() == v2.String()
			case uintKind:
				truth = v1.Uint() == v2.Uint()
			default:
				panic(â€œinvalid kindâ€)
			}
		}
		if truth {
			return true, nil
		}
	}
	return false, nil
}</p>

<p>// ne evaluates the comparison a != b.
func ne(arg1, arg2 reflect.Value) (bool, error) {
	// != is the inverse of ==.
	equal, err := eq(arg1, arg2)
	return !equal, err
}
å¤åˆ¶ä»£ç eq å…ˆåˆ¤æ–­æ¥å£ç±»å‹æ˜¯å¦ç›¸ç­‰ï¼Œç„¶ååˆ¤æ–­å€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ²¡ä»€ä¹ˆç‰¹æ®Šçš„åœ°æ–¹ã€‚
ne æ›´æ˜¯ç®€å•çš„è°ƒç”¨ eqï¼Œç„¶åå–åã€‚
geã€gtã€leã€lt ä¸ eq ç±»ä¼¼ï¼Œå…ˆåˆ¤æ–­ç±»å‹ï¼Œç„¶ååˆ¤æ–­å¤§å°ã€‚
åµŒå¥—æ¨¡æ¿
ä¸‹é¢æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ï¼š
// åŠ è½½æ¨¡æ¿
template.ParseFiles(â€œtemplates/â€)</p>

<p>// åŠ è½½å¤šä¸ªæ¨¡æ¿åˆ°ä¸€ä¸ªå‘½åç©ºé—´ï¼ˆåŒä¸€ä¸ªå‘½åç©ºé—´çš„æ¨¡å—å¯ä»¥äº’ç›¸å¼•ç”¨ï¼‰
template.ParseFiles(â€œheader.tmplâ€, â€œcontent.tmplâ€, â€œfooter.tmplâ€)</p>

<p>// must åŠ è½½å¤±è´¥æ—¶ panic
tmpl := template.Must(template.ParseFiles(â€œlayout.htmlâ€))</p>

<p>// æ‰§è¡ŒåŠ è½½åçš„æ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤æ‰§è¡Œç¬¬ä¸€ä¸ª
tmpl.Execute(w, â€œtestâ€)</p>

<p>// å¦‚æœ tmpl ä¸­æœ‰å¾ˆå¤šä¸ªæ¨¡æ¿ï¼Œå¯ä»¥æŒ‡å®šè¦æ‰§è¡Œçš„æ¨¡æ¿å
tmpl.ExecuteTemplate(w, â€œlayoutâ€, â€œHello worldâ€)
å¤åˆ¶ä»£ç ExecuteTemplate æŒ‡å®šçš„åå­—å°±æ˜¯æ¨¡æ¿æ–‡ä»¶ä¸­ define â€œnameâ€ çš„ nameã€‚
æ€»ç»“
Parse ç³»åˆ—å‡½æ•°åˆå§‹åŒ–çš„ Template ç±»å‹å®ä¾‹ã€‚
Execute ç³»åˆ—å‡½æ•°åˆ™å°†æ•°æ®ä¼ é€’ç»™æ¨¡æ¿æ¸²æŸ“æœ€ç»ˆçš„å­—ç¬¦ä¸²ã€‚
æ¨¡æ¿æœ¬è´¨ä¸Šå°±æ˜¯ Parse å‡½æ•°åŠ è½½å¤šä¸ªæ–‡ä»¶åˆ°ä¸€ä¸ª Tempalte ç±»å‹å®ä¾‹ä¸­ï¼Œè§£ææ–‡ä»¶ä¸­çš„ define å…³é”®å­—æ³¨å†Œå‘½åæ¨¡æ¿ï¼Œå‘½åæ¨¡æ¿ä¹‹é—´å¯ä»¥ä½¿ç”¨ template äº’ç›¸å¼•ç”¨ï¼ŒExecute ä¼ å…¥å¯¹åº”çš„æ•°æ®æ¸²æŸ“ã€‚</p>

<p>Goæ ‡å‡†åº“æä¾›äº†å‡ ä¸ªpackageå¯ä»¥äº§ç”Ÿè¾“å‡ºç»“æœï¼Œè€Œtext/template æä¾›äº†åŸºäºæ¨¡æ¿è¾“å‡ºæ–‡æœ¬å†…å®¹çš„åŠŸèƒ½ã€‚html/templateåˆ™æ˜¯äº§ç”Ÿ å®‰å…¨çš„HTMLæ ¼å¼çš„è¾“å‡ºã€‚è¿™ä¸¤ä¸ªåŒ…ä½¿ç”¨ç›¸åŒçš„æ¥å£ï¼Œä½†æ˜¯æˆ‘ä¸‹é¢çš„ä¾‹å­ä¸»è¦é¢å‘HTMLåº”ç”¨ã€‚</p>

<p>è§£æå’Œåˆ›å»ºæ¨¡æ¿
å‘½åæ¨¡æ¿
æ¨¡æ¿æ²¡æœ‰é™å®šæ‰©å±•åï¼Œæœ€æµè¡Œçš„åç¼€æ˜¯.tmpl, vim-goæä¾›äº†å¯¹å®ƒçš„æ”¯æŒï¼Œå¹¶ä¸”godocçš„ä¾‹å­ä¸­ä¹Ÿä½¿ç”¨è¿™ä¸ªåç¼€ã€‚Atom å’Œ GoSublime å¯¹.gohtmlåç¼€çš„æ–‡ä»¶æä¾›äº†è¯­æ³•é«˜äº®çš„æ”¯æŒã€‚é€šè¿‡å¯¹ä»£ç åº“çš„åˆ†æç»Ÿè®¡å‘ç°.tplåç¼€ä¹Ÿè¢«ç»å¸¸ä½¿ç”¨ã€‚å½“ç„¶åç¼€å¹¶ä¸é‡è¦ï¼Œåœ¨é¡¹ç›®ä¸­ä¿æŒæ¸…æ™°å’Œä¸€è‡´å³å¯ã€‚</p>

<p>åˆ›å»ºæ¨¡æ¿
tpl, err := template.Parse(filename)å¾—åˆ°æ–‡ä»¶åä¸ºåå­—çš„æ¨¡æ¿ï¼Œå¹¶ä¿å­˜åœ¨tplå˜é‡ä¸­ã€‚tplå¯ä»¥è¢«æ‰§è¡Œæ¥æ˜¾ç¤ºæ¨¡æ¿ã€‚</p>

<p>è§£æå¤šä¸ªæ¨¡æ¿
template.ParseFiles(filenames)å¯ä»¥è§£æä¸€ç»„æ¨¡æ¿ï¼Œä½¿ç”¨æ–‡ä»¶åä½œä¸ºæ¨¡æ¿çš„åå­—ã€‚template.ParseGlob(pattern)ä¼šæ ¹æ®patternè§£ææ‰€æœ‰åŒ¹é…çš„æ¨¡æ¿å¹¶ä¿å­˜ã€‚</p>

<p>è§£æå­—ç¬¦ä¸²æ¨¡æ¿
t, err := template.New(â€œfooâ€).Parse({ {define â€œTâ€}}Hello, { {.}}!{ {end}}<code class="language-plaintext highlighter-rouge">)</code> å¯ä»¥è§£æå­—ç¬¦ä¸²æ¨¡æ¿ï¼Œå¹¶è®¾ç½®å®ƒçš„åå­—ã€‚</p>

<p>æ‰§è¡Œæ¨¡æ¿
æ‰§è¡Œç®€å•æ¨¡æ¿
åˆä¸¤ç§æ–¹å¼æ‰§è¡Œæ¨¡æ¿ã€‚ç®€å•çš„æ¨¡æ¿tplå¯ä»¥é€šè¿‡tpl.Execute(io.Writer, data)å»æ‰§è¡Œï¼Œ æ¨¡æ¿æ¸²æŸ“åçš„å†…å®¹å†™å…¥åˆ°io.Writerä¸­ã€‚Dataæ˜¯ä¼ ç»™æ¨¡æ¿çš„åŠ¨æ€æ•°æ®ã€‚</p>

<p>æ‰§è¡Œå‘½åçš„æ¨¡æ¿
tpl.ExecuteTemplate(io.Writer, name, data)å’Œä¸Šé¢çš„ç®€å•æ¨¡æ¿ç±»ä¼¼ï¼Œåªä¸è¿‡ä¼ å…¥äº†ä¸€ä¸ªæ¨¡æ¿çš„åå­—ï¼ŒæŒ‡å®šè¦æ¸²æŸ“çš„æ¨¡æ¿(å› ä¸ºtplå¯ä»¥åŒ…å«å¤šä¸ªæ¨¡æ¿)ã€‚</p>

<p>æ¨¡æ¿ç¼–ç å’ŒHTML
ä¸Šä¸‹æ–‡ç¼–ç 
html/templateåŸºäºä¸Šä¸‹æ–‡ä¿¡æ¯è¿›è¡Œç¼–ç ï¼Œå› æ­¤ä»»ä½•éœ€è¦ç¼–ç çš„å­—ç¬¦éƒ½èƒ½è¢«æ­£ç¡®çš„è¿›è¡Œç¼–ç ã€‚</p>

<p>ä¾‹å¦‚â€&lt;h1&gt;A header!&lt;/h1&gt;â€œä¸­çš„å°–æ‹¬å·ä¼šè¢«ç¼–ç ä¸º&lt;h1&gt;A header!&lt;/h1&gt;ã€‚</p>

<p>template.HTMLå¯ä»¥å‘Šè¯‰Goè¦å¤„ç†çš„å­—ç¬¦ä¸²æ˜¯å®‰å…¨çš„ï¼Œä¸éœ€è¦ç¼–ç ã€‚template.HTML(â€œ&lt;h1&gt;A Safe header&lt;/h1&gt;â€œ)ä¼šè¾“å‡º&lt;h1&gt;A Safe header&lt;/h1&gt;ï¼Œæ³¨æ„è¿™ä¸ªæ–¹æ³•å¤„ç†ç”¨æˆ·çš„è¾“å…¥çš„æ—¶å€™æ¯”è¾ƒå±é™©ã€‚</p>

<p>html/templateè¿˜å¯ä»¥æ ¹æ®æ¨¡æ¿ä¸­çš„å±æ€§è¿›è¡Œä¸åŒçš„ç¼–ç ã€‚(The go html/template package is aware of attributes within the template and will encode values differently based on the attribute.)</p>

<p>Go æ¨¡æ¿ä¹Ÿå¯ä»¥åº”ç”¨javascriptã€‚structå’Œmapè¢«å±•å¼€ä¸ºJSON å¯¹è±¡ï¼Œå¼•å·ä¼šè¢«å¢åŠ åˆ°å­—ç¬¦ä¸²ä¸­ï¼Œï¼Œç”¨åšå‡½æ•°å‚æ•°å’Œå˜é‡çš„å€¼ã€‚</p>

<p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
// Go
type Cat struct {
	Name string
	Age int
}
kitten := Cat{â€œSamâ€, 12}
// Template
<script>
	var cat = { {.kitten\}\}
</script>
// Javascript
var cat = {â€œNameâ€:â€Samâ€, â€œAgeâ€ 12}
å®‰å…¨å­—ç¬¦ä¸²å’Œ HTMLæ³¨é‡Š
é»˜è®¤æƒ…å†µä¸‹ html/templateä¼šåˆ é™¤æ¨¡æ¿ä¸­çš„æ‰€æœ‰æ³¨é‡Šï¼Œè¿™ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œå› ä¸ºæœ‰äº›æ³¨é‡Šæ˜¯æœ‰ç”¨çš„ï¼Œæ¯”å¦‚:</p>

<p>1
2
3
<!--[if IE]>
Place content here to target all Internet Explorer users.
<![endif]-->
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿”å›æ³¨é‡Šçš„å‡½æ•°ã€‚åœ¨FuncMapä¸­å®šä¹‰htmlSafeæ–¹æ³•ï¼š</p>

<p>1
2
3
4
5
testTemplate, err = template.New(â€œhello.gohtmlâ€).Funcs(template.FuncMap{
	â€œhtmlSafeâ€: func(html string) template.HTML {
		return template.HTML(html)
    },
}).ParseFiles(â€œhello.gohtmlâ€)
è¿™ä¸ªå‡½æ•°ä¼šäº§ç”Ÿä¸€æ¨¡ä¸€æ ·çš„HTMLä»£ç ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ç”¨åœ¨æ¨¡æ¿ä¸­ä¿ç•™å‰é¢çš„æ³¨é‡Šï¼š</p>

<p>1
2
3
{ {htmlSafe â€œ&lt;!â€“[if IE 6]&gt;â€ }}</p>
<meta http-equiv="Content-Type" content="text/html; charset=Unicode" />

<p>{ { htmlSafe â€œ&lt;![endif]â€“&gt;â€ }}
æ¨¡æ¿å˜é‡
. å­—ç¬¦
æ¨¡æ¿å˜é‡å¯ä»¥æ˜¯boolean, string, character, integer, floating-point, imaginary æˆ–è€… complex constantã€‚ä¼ ç»™æ¨¡æ¿è¿™æ ·çš„æ•°æ®å°±å¯ä»¥é€šè¿‡ç‚¹å·.æ¥è®¿é—®ï¼š</p>

<p>1
{ { . }}
å¦‚æœæ•°æ®æ˜¯å¤æ‚ç±»å‹çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡{ { .FieldName }}æ¥è®¿é—®å®ƒçš„å­—æ®µã€‚</p>

<p>å¦‚æœå­—æ®µè¿˜æ˜¯å¤æ‚ç±»å‹ï¼Œå¯ä»¥é“¾å¼è®¿é—® { { .Struct.StructTwo.Field }}ã€‚</p>

<p>æ¨¡æ¿ä¸­çš„å˜é‡
ä¼ ç»™æ¨¡æ¿çš„æ•°æ®å¯ä»¥å­˜åœ¨æ¨¡æ¿ä¸­çš„å˜é‡ä¸­ï¼Œåœ¨æ•´ä¸ªæ¨¡æ¿ä¸­éƒ½èƒ½è®¿é—®ã€‚ æ¯”å¦‚ { {$number := .}}, æˆ‘ä»¬ä½¿ç”¨$numberä½œä¸ºå˜é‡ï¼Œä¿å­˜ä¼ å…¥çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨{ {$number}}æ¥è®¿é—®å˜é‡ã€‚</p>

<p>1
2
{ {$number := .}}</p>
<h1> It is day number { {$number\}\} of the month </h1>
<p>1
2
3
4
5
var tpl *template.Template
tpl = template.Must(template.ParseFiles(â€œtemplateNameâ€))
err := tpl.ExecuteTemplate(os.Stdout, â€œtemplateNameâ€, 23)
ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬æŠŠ23ä¼ ç»™æ¨¡æ¿ï¼Œæ¨¡æ¿çš„å˜é‡$numberçš„å€¼æ˜¯23,å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ã€‚</p>

<p>æ¨¡æ¿åŠ¨ä½œ
if/else è¯­å¥
åƒå…¶å®ƒè¯­è¨€ï¼Œæ¨¡æ¿æ”¯æŒif/elseè¯­å¥ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ifæ£€æŸ¥æ•°æ®ï¼Œå¦‚æœä¸æ»¡è¶³å¯ä»¥æ‰§è¡Œelseã€‚ç©ºå€¼æ˜¯æ˜¯false, 0ã€nilã€ç©ºå­—ç¬¦ä¸²æˆ–è€…é•¿åº¦ä¸º0çš„å­—ç¬¦ä¸²éƒ½æ˜¯falseã€‚</p>

<p>1</p>
<h1>Hello, { {if .Name\}\} { {.Name\}\} { {else\}\} Anonymous { {end\}\}!</h1>
<p>å¦‚æœ.Nameå­˜åœ¨ï¼Œä¼šè¾“å‡ºHello, Name,å¦åˆ™è¾“å‡ºHello, Anonymousã€‚</p>

<p>æ¨¡æ¿ä¹Ÿæä¾›äº†{ {else if .Name2 }}å¤„ç†å¤šä¸ªåˆ†æ”¯ã€‚</p>

<p>ç§»é™¤ç©ºæ ¼
å¾€æ¨¡æ¿ä¸­å¢åŠ ä¸åŒçš„å€¼çš„æ—¶å€™å¯èƒ½ä¼šå¢åŠ ä¸€å®šæ•°é‡çš„ç©ºæ ¼ã€‚æˆ‘ä»¬æ—¢å¯ä»¥æ”¹å˜æˆ‘ä»¬çš„æ¨¡æ¿ä»¥ä¾¿æ›´å¥½çš„å¤„ç†å®ƒï¼Œå¿½ç•¥/æœ€å°åŒ–è¿™ç§æ•ˆæœï¼Œæˆ–è€…æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å‡å·-ï¼š</p>

<p>1</p>
<h1>Hello, { {if .Name\}\} { {.Name\}\} { {- else\}\} Anonymous { {- end\}\}!</h1>
<p>ä¸Šé¢çš„ä¾‹å­å‘Šè¯‰æ¨¡æ¿ç§»é™¤ .Nameå˜é‡ä¹‹é—´çš„ç©ºæ ¼ã€‚æˆ‘ä»¬åœ¨endå…³é”®å­—ä¸­ä¹ŸåŠ å…¥å‡å·ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯åœ¨æ¨¡æ¿ä¸­æˆ‘ä»¬é€šè¿‡ç©ºæ ¼æ›´æ–¹ä¾¿ç¼–ç¨‹è°ƒè¯•ï¼Œä½†æ˜¯ç”Ÿäº§ç¯å¢ƒä¸­æˆ‘ä»¬ä¸éœ€è¦ç©ºæ ¼ã€‚</p>

<p>Range
æ¨¡æ¿æä¾›rangeå…³é”®å­—æ¥éå†æ•°æ®ã€‚å‡å¦‚æˆ‘ä»¬åˆä¸‹é¢çš„æ•°æ®ç»“æ„ï¼š</p>

<p>1
2
3
4
5
6
7
8
9
10
type Item struct {
	Name  string
	Price int
}
type ViewData struct {
	Name  string
	Items []Item
}
ViewDataå¯¹è±¡ä¼ ç»™æ¨¡æ¿ï¼Œæ¨¡æ¿å¦‚ä¸‹ï¼š</p>

<p>1
2
3
4
5
6
{ {range .Items}}</p>
<div class="item">
    <h3 class="name">{ {.Name\}\}</h3>
    <span class="price">${ {.Price\}\}</span>
  </div>
<p>{ {end}}
å¯¹äºItemsä¸­çš„æ¯ä¸ªItem, æˆ‘ä»¬è¾“å‡ºå®ƒçš„åç§°å’Œä»·æ ¼ã€‚åœ¨rangeä¸­å½“å‰çš„é¡¹ç›®å˜æˆäº†{ {.}}ï¼Œå®ƒçš„å±æ€§æ˜¯{ {.Name}}å’Œ{ {.Price}}ã€‚</p>

<p>æ¨¡æ¿å‡½æ•°
æ¨¡æ¿åŒ…æä¾›äº†ä¸€ç»„é¢„å®šä¹‰çš„å‡½æ•°ï¼Œä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ã€‚</p>

<p>è·å–ç´¢å¼•å€¼
å¦‚æœä¼ ç»™æ¨¡æ¿çš„æ•°æ®æ˜¯mapã€sliceã€æ•°ç»„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å®ƒçš„ç´¢å¼•å€¼ã€‚æˆ‘ä»¬ä½¿ç”¨{ {index x number}}æ¥è®¿é—®xçš„ç¬¬numberä¸ªå…ƒç´ ï¼Œ indexæ˜¯å…³é”®å­—ã€‚æ¯”å¦‚{ {index names 2}}ç­‰ä»·äºnames[2]ã€‚{ {index names 2 3 4}} ç­‰ä»·äº names[2][3][4]ã€‚</p>

<p>1
2
3</p>
<body>
    <h1> { {index .FavNums 2 \}\}</h1>
</body>
<p>1
2
3
4
5
6
7
8
9
10
type person struct {
	Name    string
	FavNums []int
}
func main() {
	tpl := template.Must(template.ParseGlob(â€œ*.gohtmlâ€))
	tpl.Execute(os.Stdout, &amp;person{â€œCurtisâ€, []int{7, 11, 94}})
}
ä¸Šé¢çš„ä¾‹å­ä¼ å…¥ä¸€ä¸ªpersonçš„æ•°æ®ç»“æ„ï¼Œå¾—åˆ°å®ƒçš„FavNumså­—æ®µä¸­çš„ç¬¬ä¸‰ä¸ªå€¼ã€‚</p>

<p>and å‡½æ•°
andå‡½æ•°è¿”å›boolå€¼ï¼Œé€šè¿‡è¿”å›ç¬¬ä¸€ä¸ªç©ºå€¼æˆ–è€…æœ€åä¸€ä¸ªå€¼ã€‚and x yé€»è¾‘ä¸Šç›¸å½“äºif x then y else xã€‚è€ƒè™‘ä¸‹é¢çš„ä»£ç :</p>

<p>1
2
3
4
5
6
7
type User struct {<br />
  Admin bool
}
type ViewData struct {<br />
  *User
}
ä¼ å…¥ä¸€ä¸ªAdminä¸ºtrueçš„ViewDataå¯¹è±¡ç»™æ¨¡æ¿:</p>

<p>1
2
3
4
5
{ {if and .User .User.Admin}}
  You are an admin user!
{ {else}}
  Access denied!
{ {end}}
ç»“æœä¼šæ˜¾ç¤ºYou are an admin user!, å¦‚æœViewDataä¸åŒ…å«ä¸€ä¸ªUserå€¼ï¼Œæˆ–è€…Adminä¸ºfalse,æ˜¾ç¤ºç»“æœåˆ™ä¼šæ˜¯Access denied!ã€‚</p>

<p>or å‡½æ•°
ç±»ä¼¼ and å‡½æ•°ï¼Œä½†æ˜¯åªè¦é‡åˆ° trueå°±è¿”å›ã€‚or x y ç­‰ä»·äº if x then x else yã€‚ x éç©ºçš„æƒ…å†µä¸‹yä¸ä¼šè¢«è¯„ä¼°ã€‚</p>

<p>not å‡½æ•°
notå‡½æ•°è¿”å›å‚æ•°çš„ç›¸åå€¼:</p>

<p>1
2
3
{ { if not .Authenticated}}
  Access Denied!
{ { end }}
ç®¡é“
å‡½æ•°è°ƒç”¨å¯ä»¥é“¾å¼è°ƒç”¨ï¼Œå‰ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºç»“æœä½œä¸ºä¸‹ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„å‚æ•°ã€‚html/templateç§°ä¹‹ä¸ºç®¡é“ï¼Œç±»ä¼¼äºlinux shellå‘½ä»¤ä¸­çš„ç®¡é“ä¸€æ ·ï¼Œå®ƒé‡‡ç”¨|åˆ†éš”ã€‚</p>

<p>æ³¨æ„å‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºç»“æœæ˜¯ä½œä¸ºä¸‹ä¸€ä¸ªå‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œæœ€ç»ˆå‘½ä»¤çš„è¾“å‡ºç»“æœå°±æ˜¯è¿™ä¸ªç®¡é“çš„ç»“æœã€‚</p>

<p>æ¨¡æ¿æ¯”è¾ƒå‡½æ•°
æ¯”è¾ƒ
html/templateæä¾›äº†ä¸€ç³»åˆ—çš„å‡½æ•°ç”¨åšæ•°æ®çš„æ¯”è¾ƒã€‚æ•°æ®çš„ç±»å‹åªèƒ½æ˜¯åŸºæœ¬ç±»å‹å’Œå‘½åçš„åŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚type Temp float3ï¼Œæ ¼å¼æ˜¯{ { function arg1 arg2 }}ã€‚</p>

<p>eq: arg1 == arg2
ne: arg1 != arg2
lt: arg1 &lt; arg2
le: arg1 &lt;= arg2
gt: arg1 &gt; arg2
ge: arg1 &gt;= arg2
eqå‡½æ•°æ¯”è¾ƒç‰¹æ®Šï¼Œå¯ä»¥æ‹¿å¤šä¸ªå‚æ•°å’Œç¬¬ä¸€ä¸ªå‚æ•°è¿›è¡Œæ¯”è¾ƒã€‚{ { eq arg1 arg2 arg3 arg4}}é€»è¾‘æ˜¯arg1==arg2 || arg1==arg3 || arg1==arg4ã€‚</p>

<p>åµŒå¥—æ¨¡æ¿å’Œå¸ƒå±€
åµŒå¥—æ¨¡æ¿
åµŒå¥—æ¨¡æ¿å¯ä»¥ç”¨åšè·¨æ¨¡æ¿çš„å…¬å…±éƒ¨åˆ†ä»£ç ï¼Œæ¯”å¦‚ headeræˆ–è€… footerã€‚ä½¿ç”¨åµŒå¥—æ¨¡æ¿æˆ‘ä»¬å°±å¯ä»¥é¿å…ä¸€ç‚¹å°å°çš„æ”¹åŠ¨å°±éœ€è¦ä¿®æ”¹æ¯ä¸ªæ¨¡æ¿ã€‚åµŒå¥—æ¨¡æ¿å®šä¹‰å¦‚ä¸‹ï¼š</p>

<p>1
2
3
4
5
{ {define â€œfooterâ€}}</p>
<footer> 
	<p>Here is the footer</p>
</footer>
<p>{ {end}}
è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸ºfooterçš„æ¨¡æ¿ï¼Œå¯ä»¥åœ¨å…¶ä»–æ¨¡æ¿ä¸­ä½¿ç”¨ï¼š</p>

<p>1
{ {template â€œfooterâ€}}
æ¨¡æ¿ä¹‹é—´ä¼ é€’å˜é‡
æ¨¡æ¿actionå¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’æ•°æ®ç»™åµŒå¥—çš„æ¨¡æ¿ï¼š</p>

<p>1
2
3
4
5
6
7
8
9
10
11
12
// Define a nested template called header
{ {define â€œheaderâ€}}
	&lt;h1&gt;{ {.}}&lt;/h1&gt;
{ {end}}
// Call template and pass a name parameter
{ {range .Items}}</p>
<div class="item">
    { {template "header" .Name\}\}
    <span class="price">${ {.Price\}\}</span>
  </div>
<p>{ {end}}
è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å’Œä¸Šé¢ä¸€æ ·çš„rangeéå†itemsï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šæŠŠæ¯ä¸ªnameä¼ ç»™headeræ¨¡æ¿ã€‚</p>

<p>åˆ›å»ºå¸ƒå±€
Globæ¨¡å¼é€šè¿‡é€šé…ç¬¦åŒ¹é…ä¸€ç»„æ–‡ä»¶åã€‚template.ParseGlob(pattern string)ä¼šåŒ¹é…æ‰€æœ‰ç¬¦åˆæ¨¡å¼çš„æ¨¡æ¿ã€‚template.ParseFiles(filesâ€¦)ä¹Ÿå¯ä»¥ç”¨æ¥è§£æä¸€ç»„æ–‡ä»¶ã€‚
ã€
æ¨¡æ¿é»˜è®¤æƒ…å†µä¸‹ä¼šä½¿ç”¨é…ç½®çš„å‚æ•°æ–‡ä»¶åçš„base nameä½œä¸ºæ¨¡æ¿åã€‚è¿™æ„å‘³ç€views/layouts/hello.gohtmlçš„æ–‡ä»¶åæ˜¯hello.gohtml,å¦‚æœæ¨¡æ¿ä¸­æœ‰{ {define â€œtemplateNameâ€}}çš„è¯ï¼Œé‚£ä¹ˆtemplateNameä¼šç”¨ä½œè¿™ä¸ªæ¨¡æ¿çš„åå­—ã€‚</p>

<p>æ¨¡æ¿å¯ä»¥é€šè¿‡t.ExecuteTemplate(w, â€œtemplateNameâ€, nil)æ¥æ‰§è¡Œï¼Œ tæ˜¯ä¸€ä¸ªç±»å‹ä¸ºTemplateçš„å¯¹è±¡ï¼Œwçš„ç±»å‹æ˜¯io.Writer,æ¯”å¦‚http.ResponseWriter,ç„¶åæ˜¯è¦æ‰§è¡Œçš„æ¨¡æ¿çš„åç§°ï¼Œä»¥åŠè¦ä¼ å…¥çš„æ•°æ®ï¼š</p>

<p>main.go
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
// Omitted imports &amp; package
var LayoutDir string = â€œviews/layoutsâ€<br />
var bootstrap <em>template.Template
func main() {
	var err error
	bootstrap, err = template.ParseGlob(LayoutDir + â€œ/</em>.gohtmlâ€)
	if err != nil {
		panic(err)
	}
	http.HandleFunc(â€œ/â€, handler)
	http.ListenAndServe(â€œ:8080â€, nil)
}
func handler(w http.ResponseWriter, r *http.Request) {
	bootstrap.ExecuteTemplate(w, â€œbootstrapâ€, nil)
}
æ‰€æœ‰çš„.gohtmlæ–‡ä»¶éƒ½è¢«è§£æï¼Œç„¶åå½“è®¿é—®/çš„æ—¶å€™ï¼Œbootstrapä¼šè¢«æ‰§è¡Œã€‚</p>

<p>views/layouts/bootstrap.gohtmlå®šä¹‰å¦‚ä¸‹:</p>

<p>views/layouts/bootstrap.gohtml
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
{ {define â€œbootstrapâ€}}
&lt;!DOCTYPE html&gt;</p>
<html lang="en">  
  <head>
    <title>Go Templates</title>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
  </head>
  <body>
    <div class="container-fluid">
      <h1>Filler header</h1>
	  <p>Filler paragraph</p>
    </div>
    <!-- jquery & Bootstrap JS -->
    &lt;script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"  
    &lt;/script&gt;
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js">
    </script>
  </body>
</html>
<p>{ {end}}
æ¨¡æ¿è°ƒç”¨å‡½æ•°
å‡½æ•°å˜é‡ (è°ƒç”¨ç»“æ„ä½“çš„æ–¹æ³•)
æˆ‘ä»¬å¯ä»¥è°ƒç”¨æ¨¡æ¿ä¸­å¯¹è±¡çš„æ–¹æ³•è¿”å›æ•°æ®ï¼Œä¸‹é¢å®šä¹‰äº†Userç±»å‹ï¼Œä»¥åŠä¸€ä¸ªæ–¹æ³•ï¼š</p>

<p>1
2
3
4
5
6
7
8
9
10
11
12
type User struct {<br />
  ID    int
  Email string
}
func (u User) HasPermission(feature string) bool {<br />
  if feature == â€œfeature-aâ€ {
    return true
  } else {
    return false
  }
}
å½“Userç±»å‹ä¼ ç»™æ¨¡æ¿åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿ä¸­è°ƒç”¨å®ƒçš„æ–¹æ³•ï¼š</p>

<p>1
2
3
4
5
6
7
8
9
10
11
{ {if .User.HasPermission â€œfeature-aâ€}}</p>
<div class="feature">
    <h3>Feature A</h3>
    <p>Some other stuff here...</p>
  </div>
<p>{ {else}}</p>
<div class="feature disabled">
    <h3>Feature A</h3>
    <p>To enable Feature A please upgrade your plan</p>
  </div>
<p>{ {end}}
æ¨¡æ¿ä¼šè°ƒç”¨Userçš„HasPermissionæ–¹æ³•åšæ£€æŸ¥ï¼Œå¹¶ä¸”æ ¹æ®è¿™ä¸ªè¿”å›ç»“æœæ¸²æŸ“æ•°æ®ã€‚</p>

<p>å‡½æ•°å˜é‡ (è°ƒç”¨)
å¦‚æœæœ‰æ—¶HasPermissionæ–¹æ³•çš„è®¾è®¡ä¸å¾—ä¸éœ€è¦æ›´æ”¹ï¼Œä½†æ˜¯å½“å‰çš„å‡½æ•°æ–¹æ³•æœ‰ä¸æ»¡è¶³è¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°ï¼ˆfunc(string) boolï¼‰ä½œä¸ºUserç±»å‹çš„å­—æ®µï¼Œè¿™æ ·åœ¨åˆ›å»ºUserçš„æ—¶å€™å¯ä»¥æŒ‡æ´¾ä¸åŒçš„å‡½æ•°å®ç°ï¼š</p>

<p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
// Structs
type ViewData struct {<br />
  User User
}
type User struct {<br />
  ID            int
  Email         string
  HasPermission func(string) bool
}
// Example of creating a ViewData
vd := ViewData{
		User: User{
			ID:    1,
			Email: â€œcurtis.vermeeren@gmail.comâ€,
			// Create the HasPermission function
			HasPermission: func(feature string) bool {
				if feature == â€œfeature-bâ€ {
					return true
				}
				return false
			},
		},
	}
// Executing the ViewData with the template
err := testTemplate.Execute(w, vd)
æˆ‘ä»¬éœ€è¦å‘Šè¯‰Goæ¨¡æ¿æˆ‘ä»¬æƒ³è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œè¿™é‡Œä½¿ç”¨callå…³é”®å­—ã€‚æŠŠä¸Šé¢çš„ä¾‹å­ä¿®æ”¹å¦‚ä¸‹ï¼š</p>

<p>1
2
3
4
5
6
7
8
9
10
11
{ {if (call .User.HasPermission â€œfeature-bâ€)}}</p>
<div class="feature">
    <h3>Feature B</h3>
    <p>Some other stuff here...</p>
  </div>
<p>{ {else}}</p>
<div class="feature disabled">
    <h3>Feature B</h3>
    <p>To enable Feature B please upgrade your plan</p>
  </div>
<p>{ {end}}
è‡ªå®šä¹‰å‡½æ•°
å¦å¤–ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨template.FuncMapåˆ›å»ºè‡ªå®šä¹‰çš„å‡½æ•°,å®ƒåˆ›å»ºä¸€ä¸ªå…¨å±€çš„å‡½æ•°ï¼Œå¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ä¸­ä½¿ç”¨ã€‚FuncMapé€šè¿‡map[string]interface{}å°†å‡½æ•°åæ˜ å°„åˆ°å‡½æ•°ä¸Šã€‚æ³¨æ„æ˜ å°„çš„å‡½æ•°å¿…é¡»åªæœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œæˆ–è€…æœ‰ä¸¤ä¸ªè¿”å›å€¼ä½†æ˜¯ç¬¬äºŒä¸ªæ˜¯errorç±»å‹ã€‚</p>

<p>1
2
3
4
5
6
7
8
9
// Creating a template with function hasPermission
testTemplate, err = template.New(â€œhello.gohtmlâ€).Funcs(template.FuncMap{
    â€œhasPermissionâ€: func(user User, feature string) bool {
      if user.ID == 1 &amp;&amp; feature == â€œfeature-aâ€ {
        return true
      }
      return false
    },
  }).ParseFiles(â€œhello.gohtmlâ€)
è¿™ä¸ªå‡½æ•°hasPermissionæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æŸä¸ªæƒé™ï¼Œå®ƒä¼šè¢«ä¿å­˜åœ¨FuncMapä¸­ã€‚æ³¨æ„è‡ªå®šä¹‰çš„å‡½æ•°å¿…é¡»åœ¨è°ƒç”¨ParseFiles()ä¹‹å‰åˆ›å»ºã€‚</p>

<p>è¿™ä¸ªå‡½æ•°åœ¨æ¨¡æ¿ä¸­çš„ä½¿ç”¨å¦‚ä¸‹ï¼š</p>

<p>1
{ { if hasPermission .User â€œfeature-aâ€ }}
éœ€è¦ä¼ å…¥.Userå’Œfeature-aå‚æ•°ã€‚</p>

<p>è‡ªå®šä¹‰å‡½æ•° (å…¨å±€)
æˆ‘ä»¬å‰é¢å®ç°çš„è‡ªå®šä¹‰æ–¹æ³•éœ€è¦ä¾èµ–.Userç±»å‹ï¼Œå¾ˆå¤šæƒ…å†µä¸‹è¿™ç§æ–¹å¼å·¥ä½œçš„å¾ˆå¥½ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ªå¤§å‹çš„åº”ç”¨ä¸­ä¼ ç»™æ¨¡æ¿å¤ªå¤šçš„å¯¹è±¡ç»´æŠ¤èµ·æ¥å¾ˆå›°éš¾ã€‚æˆ‘ä»¬éœ€è¦æ”¹å˜è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè®©å®ƒæ— éœ€ä¾èµ–Userå¯¹è±¡ã€‚</p>

<p>å’Œä¸Šé¢çš„å®ç°ç±»ä¼¼ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç¼ºçœçš„hasPermissionå‡½æ•°ï¼Œè¿™æ ·å¯ä»¥æ­£å¸¸è§£ææ¨¡æ¿ã€‚</p>

<p>1
2
3
4
5
testTemplate, err = template.New(â€œhello.gohtmlâ€).Funcs(template.FuncMap{
  â€œhasPermissionâ€: func(feature string) bool {
    return false
  },
}).ParseFiles(â€œhello.gohtmlâ€)
è¿™ä¸ªå‡½æ•°åœ¨main()ä¸­æˆ–è€…æŸå¤„åˆ›å»ºï¼Œå¹¶ä¸”ä¿è¯åœ¨è§£ææ–‡ä»¶ä¹‹å‰æ”¾å…¥åˆ° hello.gohtml çš„function mapä¸­ã€‚è¿™ä¸ªç¼ºçœçš„å‡½æ•°æ€»æ˜¯è¿”å›false,ä½†æ˜¯ä¸ç®¡æ€æ ·ï¼Œå‡½æ•°æ˜¯å·²å®šä¹‰çš„ï¼Œè€Œä¸”ä¸éœ€è¦Userï¼Œæ¨¡æ¿ä¹Ÿå¯ä»¥æ­£å¸¸è§£æã€‚</p>

<p>ä¸‹ä¸€ä¸ªæŠ€å·§å°±æ˜¯é‡æ–°å®šä¹‰hasPermissionå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥ä½¿ç”¨Userå¯¹è±¡çš„æ•°æ®ï¼Œä½†æ˜¯å®ƒæ˜¯åœ¨Handlerå¤„ç†ä¸­ä½¿ç”¨çš„ï¼Œè€Œä¸æ˜¯ä¼ ç»™æ¨¡æ¿ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯é—­åŒ…çš„æ–¹å¼ã€‚æ‰€ä»¥åœ¨æ¨¡æ¿æ‰§è¡Œä¹‹å‰ä½ æ­»æœ‰æœºä¼šé‡æ–°å®šä¹‰å‡½æ•°çš„ã€‚</p>

<p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
func handler(w http.ResponseWriter, r *http.Request) {
	w.Header().Set(â€œContent-Typeâ€, â€œtext/htmlâ€)
	user := User{
		ID:    1,
		Email: â€œCurtis.vermeeren@gmail.comâ€,
	}
	vd := ViewData{}
	err := testTemplate.Funcs(template.FuncMap{
		â€œhasPermissionâ€: func(feature string) bool {
			if user.ID == 1 &amp;&amp; feature == â€œfeature-aâ€ {
				return true
			}
			return false
		},
	}).Execute(w, vd)
	if err != nil {
		http.Error(w, err.Error(), http.StatusInternalServerError)
	}
}
åœ¨è¿™ä¸ªHandlerä¸­Userè¢«åˆ›å»ºï¼ŒViewDataä½¿ç”¨è¿™ä¸ªUserå¯¹è±¡ã€‚hasPermissioné‡‡ç”¨é—­åŒ…çš„æ–¹å¼é‡æ–°å®šä¹‰äº†å‡½æ•°ã€‚{ {if hasPermission â€œfeature-aâ€}}çš„çš„ç¡®ç¡®æ²¡æœ‰ä¼ å…¥Userå‚æ•°ã€‚</p>

<p>ç¬¬ä¸‰æ–¹è‡ªå®šä¹‰å‡½æ•°
é™¤äº†å®˜æ–¹çš„é¢„å®šä¹‰çš„å‡½æ•°å¤–ï¼Œä¸€äº›ç¬¬ä¸‰æ–¹ä¹Ÿå®šä¹‰äº†ä¸€äº›å‡½æ•°ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™äº›åº“ï¼Œé¿å…é‡å¤é€ è½®å­ã€‚</p>

<p>æ¯”å¦‚sprigåº“ï¼Œå®šä¹‰äº†å¾ˆå¤šçš„å‡½æ•°ï¼š</p>

<p>String Functions: trim, wrap, randAlpha, plural, etc.
String List Functions: splitList, sortAlpha, etc.
Math Functions: add, max, mul, etc.
Integer Slice Functions: until, untilStep
Date Functions: now, date, etc.
Defaults Functions: default, empty, coalesce, toJson, toPrettyJson, toRawJson, ternary
Encoding Functions: b64enc, b64dec, etc.
Lists and List Functions: list, first, uniq, etc.
Dictionaries and Dict Functions: get, set, dict, hasKey, pluck, deepCopy, etc.
Type Conversion Functions: atoi, int64, toString, etc.
File Path Functions: base, dir, ext, clean, isAbs
Flow Control Functions: fail
Advanced Functions
UUID Functions: uuidv4
OS Functions: env, expandenv
Version Comparison Functions: semver, semverCompare
Reflection: typeOf, kindIs, typeIsLike, etc.
Cryptographic and Security Functions: derivePassword, sha256sum, genPrivateKey, etc.</p>

<p>éœ€è¦æ³¨æ„ä¸‰ç‚¹ï¼š</p>

<p>å˜é‡æœ‰ä½œç”¨åŸŸï¼Œåªè¦å‡ºç°endï¼Œåˆ™å½“å‰å±‚æ¬¡çš„ä½œç”¨åŸŸç»“æŸã€‚å†…å±‚å¯ä»¥è®¿é—®å¤–å±‚å˜é‡ï¼Œä½†å¤–å±‚ä¸èƒ½è®¿é—®å†…å±‚å˜é‡ã€‚
æœ‰ä¸€ä¸ªç‰¹æ®Šå˜é‡$ï¼Œå®ƒä»£è¡¨æ¨¡æ¿çš„æœ€é¡¶çº§ä½œç”¨åŸŸå¯¹è±¡(é€šä¿—åœ°ç†è§£ï¼Œæ˜¯ä»¥æ¨¡æ¿ä¸ºå…¨å±€ä½œç”¨åŸŸçš„å…¨å±€å˜é‡)ï¼Œåœ¨Execute()æ‰§è¡Œçš„æ—¶å€™è¿›è¡Œèµ‹å€¼ï¼Œä¸”ä¸€ç›´ä¸å˜ã€‚ä¾‹å¦‚ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ$ = [11 22 33 44 55]ã€‚å†ä¾‹å¦‚ï¼Œdefineå®šä¹‰äº†ä¸€ä¸ªæ¨¡æ¿t1ï¼Œåˆ™t1ä¸­çš„$ä½œç”¨åŸŸåªå±äºè¿™ä¸ªt1ã€‚
å˜é‡ä¸å¯åœ¨æ¨¡æ¿ä¹‹é—´ç»§æ‰¿ã€‚æ™®é€šå˜é‡å¯èƒ½æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œä½†å¯¹äºç‰¹æ®Šå˜é‡â€.â€å’Œâ€$â€ï¼Œæ¯”è¾ƒå®¹æ˜“ææ··ã€‚è§ä¸‹é¢çš„ä¾‹å­ã€‚
ä¾‹å¦‚ï¼š</p>

<p>func main() {
    t1 := template.New(â€œtest1â€)
    tmpl, _ := t1.Parse(
`
{{- define â€œT1â€}}ONE {{println .}}{{end}}
{{- define â€œT2â€}}{{template â€œT1â€ $}}{{end}}
{{- template â€œT2â€ . -}}
`)
    _ = tmpl.Execute(os.Stdout, â€œhello worldâ€)
}
ä¸Šé¢ä½¿ç”¨defineé¢å¤–å®šä¹‰äº†T1å’ŒT2ä¸¤ä¸ªæ¨¡æ¿ï¼ŒT2ä¸­åµŒå¥—äº†T1ã€‚{{template â€œT2â€ .}}çš„ç‚¹ä»£è¡¨é¡¶çº§ä½œç”¨åŸŸçš„â€hello worldâ€å¯¹è±¡ã€‚åœ¨T2ä¸­ä½¿ç”¨äº†ç‰¹æ®Šå˜é‡$ï¼Œè¿™ä¸ª$çš„èŒƒå›´æ˜¯T2çš„ï¼Œä¸ä¼šç»§æ‰¿é¡¶çº§ä½œç”¨åŸŸâ€hello worldâ€ã€‚ä½†å› ä¸ºæ‰§è¡ŒT2çš„æ—¶å€™ï¼Œä¼ é€’çš„æ˜¯â€.â€ï¼Œæ‰€ä»¥è¿™é‡Œçš„$çš„å€¼ä»ç„¶æ˜¯â€hello worldâ€ã€‚</p>

<p>ä¸ä»…$ä¸ä¼šåœ¨æ¨¡æ¿ä¹‹é—´ç»§æ‰¿ï¼Œ.ä¹Ÿä¸ä¼šåœ¨æ¨¡æ¿ä¹‹é—´ç»§æ‰¿(å…¶å®ƒæ‰€æœ‰å˜é‡éƒ½ä¸ä¼šç»§æ‰¿)ã€‚å®é™…ä¸Šï¼Œtemplateå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„æ‰§è¡Œè¿‡ç¨‹æ˜¯template(â€œT2â€,.)ã€‚å¦‚æœæŠŠä¸Šé¢çš„$æ¢æˆâ€.â€ï¼Œç»“æœæ˜¯ä¸€æ ·çš„ã€‚å¦‚æœæ¢æˆ{{template â€œT2â€}}ï¼Œåˆ™$=nil</p>
:ET