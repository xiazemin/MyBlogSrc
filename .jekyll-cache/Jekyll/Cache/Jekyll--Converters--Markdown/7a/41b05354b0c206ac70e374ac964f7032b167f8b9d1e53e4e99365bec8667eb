I"ö<p>0.é¦–å…ˆä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ</p>

<p>çº¿ç¨‹æ± å°±æ˜¯åˆ›å»ºå¤šä¸ªçº¿ç¨‹å¹¶ä¸”è¿›è¡Œç®¡ç†çš„å®¹å™¨ã€‚ï¼ˆçº¿ç¨‹æ± æ˜¯ä¸ªå®¹å™¨ï¼Œå¯ä»¥åˆ›å»ºçº¿ç¨‹å’Œç®¡ç†çº¿ç¨‹ï¼Œå¹¶ä¸”ç»™çº¿ç¨‹åˆ†é…ä»»åŠ¡ï¼‰</p>

<p>1.ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± å‘¢ï¼Ÿ</p>

<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨Javaä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å…¶å®æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„äº‹æƒ…ï¼Œåªè¦new Threadå°±å¯ä»¥äº†ï¼Œä½†æ˜¯è¿™æ ·åšå¹¶ä¸æ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆä¸å¥½å‘¢ï¼Ÿ</p>

<p>æ¯”å¦‚åœ¨ä¸€ä¸ªé¡¹ç›®é‡Œï¼Œå…¨éƒ¨éƒ½æ˜¯ç”¨çš„new Threadçš„æ–¹å¼å»å¯ç”¨çº¿ç¨‹ï¼Œé‚£ä¹ˆåˆ›å»ºå¥½Thread1ï¼Œè€Œ1åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œåˆ›å»ºäº†Thread2ï¼Œç­‰ç­‰ç­‰â€¦ åˆ›å»ºäº†10ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼Œ</p>

<p>1ï¼Œ2ï¼Œ3éƒ½æ‰§è¡Œå®Œæ¯•äº†ä½†æ˜¯æ²¡è¢«é”€æ¯ï¼Œå°±å¯èƒ½å¯¼è‡´æ— é™åˆ¶çš„æ–°å»ºçº¿ç¨‹ï¼Œç›¸äº’ç«äº‰ï¼Œå ç”¨è¿‡å¤šçš„ç³»ç»Ÿèµ„æºï¼Œå¯¼è‡´æ­»é”ä»¥åŠOOMã€‚</p>

<p>è€Œä¸”è¿™äº›çº¿ç¨‹ç¼ºä¹ç»Ÿä¸€çš„ç®¡ç†çš„åŠŸèƒ½ï¼Œä¹Ÿç¼ºä¹å®šæœŸæ‰§è¡Œï¼Œå®šæ—¶æ‰§è¡Œï¼Œçº¿ç¨‹ä¸­æ–­çš„åŠŸèƒ½ã€‚</p>

<p>è¯´äº†è¿™ä¹ˆå¤šï¼Œé‚£ä¹ˆçº¿ç¨‹æ± çš„å¥½å¤„æ˜¯å•¥å•Šï¼Ÿ</p>

<p>çº¿ç¨‹æ± çš„å¥½å¤„æœ‰ä»¥ä¸‹3æ–¹é¢ï¼š</p>

<p>ï¼ˆ1ï¼‰ é‡ç”¨å·²ç»å­˜åœ¨çš„çº¿ç¨‹ï¼Œå‡å°‘äº†çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ã€‚</p>

<p>ï¼ˆ2ï¼‰å¯æœ‰æ•ˆæ§åˆ¶æœ€å¤§å¹¶å‘çš„çº¿ç¨‹æ•°ï¼Œæé«˜äº†ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ç‡é¿å…å¾ˆå¤šç«äº‰ï¼Œé¿å…äº†OOMå•Š æ­»é”å•Šç­‰ã€‚</p>

<p>ï¼ˆ3ï¼‰å¯ä»¥æä¾›å®šæ—¶å’Œå®šæœŸçš„æ‰§è¡Œæ–¹å¼ï¼Œå•çº¿ç¨‹ï¼Œå¹¶å‘æ•°é‡çš„æ§åˆ¶ç­‰åŠŸèƒ½ï¼</p>

<p>çº¿ç¨‹æ± å¯ä»¥ä½¿å¾—å¯¹çº¿ç¨‹çš„ç®¡ç†æ›´åŠ æ–¹ä¾¿ï¼Œå¹¶ä¸”å¯¹é«˜å¹¶å‘çš„æ§åˆ¶å°½åœ¨æŒæ¡ã€‚</p>

<p>2.å››ç§Javaçº¿ç¨‹æ± åŠŸèƒ½åŠåˆ†æ</p>

<p>çº¿ç¨‹æ± éƒ½ç»§æ‰¿äº†ExecutorServiceçš„æ¥å£ï¼Œæ‰€ä»¥ä»–ä»¬éƒ½å…·æœ‰ExecutorServiceçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼šè¿è¡Œï¼Œå…³é—­ï¼Œç»ˆæ­¢ï¼›</p>

<p>å› ä¸ºç»§æ‰¿äº†ExecutorServiceæ¥å£ï¼Œæ‰€ä»¥å®ƒåœ¨è¢«åˆ›å»ºçš„æ—¶å€™å°±æ˜¯å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå½“çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œå°±ä¼šè¿›å…¥å…³é—­çŠ¶æ€ï¼Œåªæœ‰è°ƒç”¨äº†shutdownï¼ˆï¼‰çš„æ—¶å€™æ‰æ˜¯æ­£å¼çš„ç»ˆæ­¢äº†è¿™ä¸ªçº¿ç¨‹æ± ã€‚</p>

<p>javaé€šè¿‡Executorså·¥å‚ç±»æä¾›æˆ‘ä»¬çš„çº¿ç¨‹æ± ä¸€å…±æœ‰4ç§ï¼š</p>

<p>fixedThreadPool() //å¯åŠ¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± </p>

<p>CachedThreadPool() //æŒ‰éœ€åˆ†é…çš„çº¿ç¨‹æ± </p>

<p>ScheduledThreadPoolExecutor()//å®šæ—¶ï¼Œå®šæœŸæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± </p>

<p>ThreadPoolExecutor()//æŒ‡å®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ã€‚</p>

<p>æˆ‘ä»¬å…ˆæ¥è¯´å‚æ•°æœ€å¤šçš„çº¿ç¨‹ï¼Œæ–¹ä¾¿ä¸‹é¢å¯¹å‚æ•°çš„ç†è§£ï¼Œ</p>

<p>ThreadPoolExecutorï¼ˆï¼‰</p>

<p>ThreadPoolExecutoræ˜¯çº¿ç¨‹æ± çš„å®ç°ç±»ä¹‹ä¸€ï¼Œå®ƒä¸»è¦æ˜¯å¯åŠ¨æŒ‡å®šæ•°é‡çº¿ç¨‹ä»¥åŠå°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œå¹¶ä¸”å°†ä»»åŠ¡å‘é€ç»™ç©ºé—²çš„çº¿ç¨‹ã€‚</p>

<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ‹¥æœ‰æœ€å¤šæ„é€ å‡½æ•°çš„çº¿ç¨‹æ± çš„æ„é€ å‡½æ•°å§ï¼š</p>

<p>public ThreadPoolExecutor(int corePoolSize, 
                              int maximumPoolSize, 
                              long keepAliveTime, 
                              TimeUnit unit, 
                              BlockingQueue<Runnable> workQueue, 
                              RejectedExecutionHandler handler)
corePoolSize ï¼š çº¿ç¨‹çš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</Runnable></p>

<p>maximumPoolSizeï¼šçº¿ç¨‹å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚</p>

<p>keepAliveTimeï¼šå½“å‰çº¿ç¨‹æ±  çº¿ç¨‹æ€»æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œç»ˆæ­¢å¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„æ—¶é—´ã€‚</p>

<p>Unitï¼škeepAliveTimeå‚æ•°çš„æ—¶é—´å•ä½</p>

<p>workQueueï¼šé˜Ÿä¼é˜Ÿåˆ—ï¼Œå¦‚æœçº¿ç¨‹æ± è¾¾åˆ°äº†æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¹¶ä¸”å…¶ä»–çº¿ç¨‹éƒ½å¤„äºæ´»åŠ¨çŠ¶æ€çš„æ—¶å€™ï¼Œåˆ™å°†æ–°ä»»åŠ¡æ”¾å…¥æ­¤é˜Ÿåˆ—ã€‚</p>

<p>threadFactoryï¼šå®šåˆ¶çº¿ç¨‹çš„åˆ›å»ºè¿‡ç¨‹</p>

<p>Handlerï¼šæ‹’ç»ç­–ç•¥ï¼Œå½“workQueueé˜Ÿæ»¡æ—¶ï¼Œé‡‡å–çš„æªæ–½ã€‚</p>

<p>ThreadPoolExecutorï¼ˆï¼‰çš„ä½œç”¨ä¸»è¦æ˜¯è®©æˆ‘ä»¬æ›´çµæ´»çš„ä½¿ç”¨çº¿ç¨‹æ± ï¼Œè¿™é‡Œä¸è¯¦ç»†çš„ä¸¾ä¾‹äº†ã€‚</p>

<p>fixedThreadPool() //å¯åŠ¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± </p>

<p>åœ¨Androidä¸­ï¼Œç”±äºç³»ç»Ÿèµ„æºæœ‰é™ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¸¸ç”¨çš„å°±æ˜¯fixedThreadPool()ã€‚</p>

<p>fixedThreadPoolï¼ˆint sizeï¼‰ å°±åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œsizeï¼Œå°±æ˜¯çº¿ç¨‹æ± ä¸­æœ€å¤§å¯åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹</p>

<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯¥çº¿ç¨‹æ± çš„å®ç°è¿‡ç¨‹</p>

<p>åœ¨å®ç°ä¸Šè·ŸThreadPoolExecutorç±»ä¼¼fixedThreadPoolç®€åŒ–äº†å®ç°è¿‡ç¨‹ï¼ŒæŠŠcorePoolSizeå’ŒmaximumpoolSizeçš„å€¼éƒ½è®¾ä¸ºä¼ å…¥çš„sizeï¼Œå¹¶ä¸”è®¾ç½®keepAliveTimeä¸º0msï¼Œç„¶åé‡‡ç”¨çš„æ˜¯LinkedBlockingQueueé˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—æ˜¯é“¾å¼ç»“æ„ï¼Œæ‰€ä»¥æ˜¯æ— è¾¹ç•Œçš„ã€‚å¯ä»¥å®¹çº³æ— æ•°ä¸ªä»»åŠ¡ã€‚</p>

<p>æ€»ç»“ï¼šæ¯”å¦‚æˆ‘åˆ›å»º3ä¸ªçº¿ç¨‹çš„fixedThreadPool ï¼Œå½“3ä¸ªéƒ½ä¸ºæ´»è·ƒçš„æ—¶å€™ï¼Œåé¢çš„ä»»åŠ¡ä¼šè¢«åŠ å…¥æ— è¾¹ç•Œçš„é“¾å¼é˜Ÿåˆ—ï¼ˆLinkedBlockingQueueï¼‰ï¼Œæœ‰ç©ºé—²ï¼Œå°±æ‰§è¡Œä»»åŠ¡ã€‚</p>

<p>ä½¿ç”¨è¿‡ç¨‹ï¼š</p>

<p>private static void fixedThreadPool(int size) throws ExecutionException, InterruptedException {
        ExecutorService executorService = Executors.newFixedThreadPool(size);
//        ExecutorService executorService2 = Executors.newSingleThreadExecutor();
        for (int i = 0; i &lt; 10; i++) {
            Future<Integer> task = executorService.submit(new Callable<Integer>() {
                @Override
                public Integer call() throws Exception {
                    System.out.println("æ‰§è¡Œçº¿ç¨‹" + Thread.currentThread().getName());
                    return fibc(40);
                }
            });
            System.out.println("ç¬¬"+i+"æ¬¡è®¡ç®—,ç»“æœ:"+task.get());
        }
ç»“æœï¼š</Integer></Integer></p>

<p>CachedThreadPool() //æŒ‰éœ€åˆ†é…çš„çº¿ç¨‹æ± </p>

<p>å¯¹æ¯”fixedThreadPoolæ¥è¯´ CachedThreadPoolå°±è¦æ›´å¿«ä¸€äº›ï¼Œä¸ºä»€ä¹ˆå¿«å‘¢ï¼Ÿ</p>

<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹CachedThreadPoolçš„å®ç°æºç ï¼š</p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„Â Â maximumPoolSizeï¼šçº¿ç¨‹å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚Â  ä¸ºMAX_VALUE(æ— é™å¤§)ï¼Œ</p>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æœ‰ä»»åŠ¡å¹¶ä¸”å…¶ä»–çº¿ç¨‹éƒ½åœ¨æ´»è·ƒæ€ï¼Œå°±ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹ ï¼ˆå› ä¸ºæ²¡æœ‰ä¸Šé™ï¼‰</p>

<p>è€Œå½“æœ‰ç©ºé—²çš„çº¿ç¨‹çš„æ—¶å€™ï¼Œå°±ä¼šå»è°ƒç”¨ç©ºé—²çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</p>

<p>ä½¿ç”¨è¿‡ç¨‹ï¼š</p>

<p>private static void newCacheThreadPool(){
        ExecutorService executorService = Executors.newCachedThreadPool();
        for (int i = 0; i &lt; 100; i++) {
            Future task = executorService.submit(new Runnable() {
                @Override
                public void run() {
                    System.out.println(Thread.currentThread().getName()+â€â€”-&gt;â€+fibc(20));
                }
            });
        }
    }
ç»“æœï¼š</p>

<p>ScheduledThreadPoolExecutor() å®šæ—¶å®šæœŸçš„çº¿ç¨‹æ± </p>

<p>åˆ›å»ºScheduledThreadPoolExecutorå¾ˆç®€å•ï¼Œåªè¦ä¼ å…¥corePoolSizeï¼ˆï¼‰çº¿ç¨‹çš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚å°±å¯ä»¥å¼€å¯è¿™ä¸ªçº¿ç¨‹æ± </p>

<p>ç„¶åæˆ‘ä»¬éœ€è¦ä½¿ç”¨å®ƒçš„å®šæ—¶ä»»åŠ¡ï¼Œå°±éœ€è¦å®ç°ä»–çš„scheduleAtFixedRateæ–¹æ³• è¿™ä¸ªæ–¹æ³•æœ‰4ä¸ªå‚æ•°ï¼š</p>

<p>ç¬¬ä¸€ä¸ªä¸ºè¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>

<p>ç¬¬äºŒä¸ªä¸ºæ¯æ¬¡ä»»åŠ¡æ‰§è¡Œçš„å»¶è¿Ÿï¼Œæ¯”å¦‚ä¼ å…¥1ï¼Œå°±ä¼šæ¯éš”1ç§’æ‰§è¡Œä¸€æ¬¡ã€‚</p>

<p>ç¬¬ä¸‰ä¸ªä¸ºæ‰§è¡Œçš„å‘¨æœŸ</p>

<p>ç¬¬å››ä¸ªä¸ºç¬¬äºŒä¸ªå‚æ•°çš„æ—¶é—´å•ä½ã€‚</p>

<p>*æ— è®ºå®ç°å‡ ä¸ªscheduleAtFixedRateæ–¹æ³•ï¼Œä»–ä»¬éƒ½äº’ä¸å¹²æ‰°ã€‚</p>

<p>å®ç°å¦‚ä¸‹</p>

<p>private static void newScheduledThreadPool(){
        ScheduledExecutorService executorService = Executors.newScheduledThreadPool(3);
        executorService.scheduleAtFixedRate(new Runnable() {
            @Override
            public void run() {
                System.out.println(Thread.currentThread().getName()+â€â€”â€“&gt;â€ + fibc(40));
            }
        },5,3,TimeUnit.SECONDS);</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    executorService.scheduleAtFixedRate(new Runnable() {
        @Override
        public void run() {
            System.out.println(Thread.currentThread().getName()+"-----&gt;" + fibc(5));
        }
    },1,1,TimeUnit.SECONDS);
 
 
    executorService.scheduleAtFixedRate(new Runnable() {
        @Override
        public void run() {
            System.out.println(Thread.currentThread().getName()+"-----&gt;" + fibc(1));
        }
    },1,2,TimeUnit.SECONDS);
} æˆ‘è¿™é‡Œå®ç°äº†3ä¸ªscheduleAtFixedRateæ–¹æ³•ï¼Œ
</code></pre></div></div>

<p>ç¬¬ä¸€ä¸ªä¸º5sä¸€æ¬¡ï¼Œ3ä¸ªå‘¨æœŸæ‰§è¡Œä¸€æ¬¡</p>

<p>ç¬¬äºŒä¸ªä¸º1sä¸€æ¬¡ï¼Œ1ä¸ªå‘¨æœŸæ‰§è¡Œä¸€æ¬¡</p>

<p>ç¬¬ä¸‰ä¸ªä¸º1sä¸€æ¬¡ï¼Œ2ä¸ªå‘¨æœŸæ‰§è¡Œä¸€æ¬¡</p>

<p>ç»“æœå¦‚ä¸‹ï¼š</p>

<p>æ€»ç»“ï¼šçº¿ç¨‹æ± çš„ä½¿ç”¨ï¼Œå¯ä»¥æ›´è§„èŒƒçš„ç®¡ç†å’Œåˆ›å»ºé”€æ¯çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥æ›´å¤šæ ·åŒ–çš„å»ä½¿ç”¨çº¿ç¨‹ï¼Œå‡å°æˆ‘ä»¬çš„ç³»ç»Ÿå¼€æ”¯ã€‚
<!-- more -->
Executoræ¡†æ¶æœ€æ ¸å¿ƒçš„ç±»æ˜¯ThreadPoolExecutorï¼Œå®ƒæ˜¯çº¿ç¨‹æ± çš„å®ç°ç±»ï¼Œä¸»è¦ç”±ä¸‹åˆ—4ä¸ªç»„ä»¶æ„æˆã€‚</p>

<p>Â Â Â Â Â·corePoolï¼šæ ¸å¿ƒçº¿ç¨‹æ± çš„å¤§å°ã€‚</p>

<p>Â Â Â Â Â·maximumPoolï¼šæœ€å¤§çº¿ç¨‹æ± çš„å¤§å°ã€‚</p>

<p>Â Â Â Â Â·BlockingQueueï¼šç”¨æ¥æš‚æ—¶ä¿å­˜ä»»åŠ¡çš„å·¥ä½œé˜Ÿåˆ—ã€‚</p>

<p>Â Â Â Â Â·RejectedExecutionHandlerï¼šå½“ThreadPoolExecutorå·²ç»å…³é—­æˆ–ThreadPoolExecutorå·²ç»é¥±å’Œæ—¶ï¼ˆè¾¾åˆ°äº†æœ€å¤§çº¿ç¨‹æ± å¤§å°ä¸”å·¥ä½œé˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œexecute()æ–¹æ³•å°†è¦è°ƒç”¨çš„Handlerã€‚</p>

<p>é€šè¿‡Executoræ¡†æ¶çš„å·¥å…·ç±»Executorsï¼Œå¯ä»¥åˆ›å»º3ç§ç±»å‹çš„ThreadPoolExecutorã€‚</p>

<p>Â Â Â Â Â·FixedThreadPoolã€‚</p>

<p>Â Â Â Â Â·SingleThreadExecutorã€‚</p>

<p>Â Â Â Â Â·CachedThreadPoolã€‚Â </p>

<p>ä¸‹é¢å°†åˆ†åˆ«ä»‹ç»è¿™3ç§ThreadPoolExecutorã€‚</p>

<p>FixedThreadPoolè¢«ç§°ä¸ºå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ã€‚ä¸‹é¢æ˜¯FixedThreadPoolçš„æºä»£ç å®ç°ã€‚</p>

<p>publicÂ staticÂ ExecutorServiceÂ newFixedThreadPool(intÂ nThreads)Â {Â </p>

<p>Â Â Â Â returnÂ newÂ ThreadPoolExecutor(nThreads,nThreads,</p>

<p>Â Â Â Â 0L,Â TimeUnit.MILLISECONDS,newÂ LinkedBlockingQueue());</p>

<p>}</p>

<p>FixedThreadPoolçš„corePoolSizeå’ŒmaximumPoolSizeéƒ½è¢«è®¾ç½®ä¸ºåˆ›å»ºFixedThreadPoolæ—¶æŒ‡å®šçš„å‚æ•°nThreadsã€‚å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶ï¼ŒkeepAliveTimeä¸ºå¤šä½™çš„ç©ºé—²çº¿ç¨‹ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´åå¤šä½™çš„çº¿ç¨‹å°†è¢«ç»ˆæ­¢ã€‚è¿™é‡ŒæŠŠkeepAliveTimeè®¾ç½®ä¸º0Lï¼Œæ„å‘³ç€å¤šä½™çš„ç©ºé—²çº¿ç¨‹ä¼šè¢«ç«‹å³ç»ˆæ­¢ã€‚</p>

<p>FixedThreadPoolçš„execute()æ–¹æ³•çš„è¿è¡Œç¤ºæ„å›¾å¦‚å›¾æ‰€ç¤ºã€‚</p>

<p>FixedThreadPoolçš„execute()çš„è¿è¡Œç¤ºæ„å›¾
ä¸Šå›¾çš„è¯´æ˜å¦‚ä¸‹ã€‚</p>

<p>Â Â Â Â 1ï¼‰å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°‘äºcorePoolSizeï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>

<p>Â Â Â Â 2ï¼‰åœ¨çº¿ç¨‹æ± å®Œæˆé¢„çƒ­ä¹‹åï¼ˆå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°ç­‰äºcorePoolSizeï¼‰ï¼Œå°†ä»»åŠ¡åŠ å…¥Â LinkedBlockingQueueã€‚</p>

<p>Â Â Â Â 3ï¼‰çº¿ç¨‹æ‰§è¡Œå®Œ1ä¸­çš„ä»»åŠ¡åï¼Œä¼šåœ¨å¾ªç¯ä¸­åå¤ä»LinkedBlockingQueueè·å–ä»»åŠ¡æ¥æ‰§è¡Œã€‚</p>

<p>FixedThreadPoolä½¿ç”¨æ— ç•Œé˜Ÿåˆ—LinkedBlockingQueueä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—çš„å®¹é‡ä¸ºÂ Integer.MAX_VALUEï¼‰ã€‚ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ä½œä¸ºå·¥ä½œé˜Ÿåˆ—ä¼šå¯¹çº¿ç¨‹æ± å¸¦æ¥å¦‚ä¸‹å½±å“ã€‚</p>

<p>Â Â Â Â 1ï¼‰å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è¾¾åˆ°corePoolSizeåï¼Œæ–°ä»»åŠ¡å°†åœ¨æ— ç•Œé˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œå› æ­¤çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸ä¼šè¶…è¿‡Â  Â Â Â Â Â corePoolSizeã€‚</p>

<p>Â Â Â Â 2ï¼‰ç”±äº1ï¼Œä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ—¶maximumPoolSizeå°†æ˜¯ä¸€ä¸ªæ— æ•ˆå‚æ•°ã€‚Â </p>

<p>Â Â Â Â 3ï¼‰ç”±äº1å’Œ2ï¼Œä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ—¶keepAliveTimeå°†æ˜¯ä¸€ä¸ªæ— æ•ˆå‚æ•°ã€‚</p>

<p>Â Â Â Â 4ï¼‰ç”±äºä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼Œè¿è¡Œä¸­çš„FixedThreadPoolï¼ˆæœªæ‰§è¡Œæ–¹æ³•shutdown()æˆ–Â shutdownNow()ï¼‰ä¸ä¼šæ‹’ç»ä»»åŠ¡Â  Â ï¼ˆä¸ä¼šè°ƒç”¨RejectedExecutionHandler.rejectedExecutionæ–¹æ³•ï¼‰ã€‚</p>

<p>SingleThreadExecutorè¯¦è§£</p>

<p>SingleThreadExecutoræ˜¯ä½¿ç”¨å•ä¸ªworkerçº¿ç¨‹çš„Executorã€‚ä¸‹é¢æ˜¯SingleThreadExecutorçš„æºä»£ç å®ç°ã€‚</p>

<p>publicÂ staticÂ ExecutorServiceÂ newSingleThreadExecutor()Â {Â </p>

<p>Â Â Â Â returnÂ newÂ FinalizableDelegatedExecutorService(newÂ ThreadPoolExecutor(1,Â 1,0L,Â TimeUnit.MILLISECONDSÂ Â Â Â ,newÂ LinkedBlockingQueue()));</p>

<p>}</p>

<p>SingleThreadExecutorçš„corePoolSizeå’ŒmaximumPoolSizeè¢«è®¾ç½®ä¸º1ã€‚å…¶ä»–å‚æ•°ä¸Â FixedThreadPoolç›¸åŒã€‚SingleThreadExecutorä½¿ç”¨æ— ç•Œé˜Ÿåˆ—LinkedBlockingQueueä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—çš„å®¹é‡ä¸ºInteger.MAX_VALUEï¼‰ã€‚SingleThreadExecutorä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ä½œä¸ºå·¥ä½œé˜Ÿåˆ—å¯¹çº¿ç¨‹æ± å¸¦æ¥çš„å½±å“ä¸FixedThreadPoolç›¸åŒï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p>

<p>SingleThreadExecutorçš„è¿è¡Œç¤ºæ„å›¾å¦‚å›¾æ‰€ç¤ºã€‚</p>

<p>SingleThreadExecutorçš„execute()çš„è¿è¡Œç¤ºæ„
å¯¹ä¸Šå›¾çš„è¯´æ˜å¦‚ä¸‹ã€‚</p>

<p>Â Â Â Â 1ï¼‰å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°‘äºcorePoolSizeï¼ˆå³çº¿ç¨‹æ± ä¸­æ— è¿è¡Œçš„çº¿ç¨‹ï¼‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>

<p>Â Â Â Â 2ï¼‰åœ¨çº¿ç¨‹æ± å®Œæˆé¢„çƒ­ä¹‹åï¼ˆå½“å‰çº¿ç¨‹æ± ä¸­æœ‰ä¸€ä¸ªè¿è¡Œçš„çº¿ç¨‹ï¼‰ï¼Œå°†ä»»åŠ¡åŠ å…¥Linked-Â BlockingQueueã€‚</p>

<p>Â Â Â Â 3ï¼‰çº¿ç¨‹æ‰§è¡Œå®Œ1ä¸­çš„ä»»åŠ¡åï¼Œä¼šåœ¨ä¸€ä¸ªæ— é™å¾ªç¯ä¸­åå¤ä»LinkedBlockingQueueè·å–ä»»åŠ¡æ¥æ‰§è¡Œã€‚</p>

<p>CachedThreadPoolè¯¦è§£</p>

<p>CachedThreadPoolæ˜¯ä¸€ä¸ªä¼šæ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚ä¸‹é¢æ˜¯åˆ›å»ºCachedThreadPoolçš„æºä»£ç ã€‚</p>

<p>publicÂ staticÂ ExecutorServiceÂ newCachedThreadPool()Â { Â Â Â Â returnÂ newÂ ThreadPoolExecutor(0,Â Integer.MAX_VALUE,</p>

<p>Â Â Â Â 60L,Â TimeUnit.SECONDS,newÂ SynchronousQueue());</p>

<p>}</p>

<p>CachedThreadPoolçš„corePoolSizeè¢«è®¾ç½®ä¸º0ï¼Œå³corePoolä¸ºç©ºï¼›maximumPoolSizeè¢«è®¾ç½®ä¸ºÂ Integer.MAX_VALUEï¼Œå³maximumPoolæ˜¯æ— ç•Œçš„ã€‚è¿™é‡ŒæŠŠkeepAliveTimeè®¾ç½®ä¸º60Lï¼Œæ„å‘³ç€Â CachedThreadPoolä¸­çš„ç©ºé—²çº¿ç¨‹ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ä¸º60ç§’ï¼Œç©ºé—²çº¿ç¨‹è¶…è¿‡60ç§’åå°†ä¼šè¢«ç»ˆæ­¢ã€‚</p>

<p>FixedThreadPoolå’ŒSingleThreadExecutorä½¿ç”¨æ— ç•Œé˜Ÿåˆ—LinkedBlockingQueueä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ã€‚CachedThreadPoolä½¿ç”¨æ²¡æœ‰å®¹é‡çš„SynchronousQueueä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ï¼Œä½†Â CachedThreadPoolçš„maximumPoolæ˜¯æ— ç•Œçš„ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸»çº¿ç¨‹æäº¤ä»»åŠ¡çš„é€Ÿåº¦é«˜äºÂ maximumPoolä¸­çº¿ç¨‹å¤„ç†ä»»åŠ¡çš„é€Ÿåº¦æ—¶ï¼ŒCachedThreadPoolä¼šä¸æ–­åˆ›å»ºæ–°çº¿ç¨‹ã€‚æç«¯æƒ…å†µä¸‹ï¼ŒÂ CachedThreadPoolä¼šå› ä¸ºåˆ›å»ºè¿‡å¤šçº¿ç¨‹è€Œè€—å°½CPUå’Œå†…å­˜èµ„æºã€‚</p>

<p>CachedThreadPoolçš„execute()æ–¹æ³•çš„æ‰§è¡Œç¤ºæ„å›¾å¦‚å›¾æ‰€ç¤ºã€‚</p>

<p>å¯¹ä¸Šå›¾çš„è¯´æ˜å¦‚ä¸‹ã€‚</p>

<p>Â Â Â Â 1ï¼‰é¦–å…ˆæ‰§è¡ŒSynchronousQueue.offerï¼ˆRunnableÂ taskï¼‰ã€‚å¦‚æœå½“å‰maximumPoolä¸­æœ‰ç©ºé—²çº¿ç¨‹æ­£åœ¨æ‰§è¡ŒÂ  Â Â Â Â Â SynchronousQueue.pollï¼ˆkeepAliveTimeï¼ŒTimeUnit.NANOSECONDSï¼‰ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹æ‰§è¡Œofferæ“ä½œä¸ç©ºé—²çº¿Â  Â Â Â Â Â ç¨‹æ‰§è¡Œçš„pollæ“ä½œé…å¯¹æˆåŠŸï¼Œä¸»çº¿ç¨‹æŠŠä»»åŠ¡äº¤ç»™ç©ºé—²çº¿ç¨‹æ‰§è¡Œï¼Œexecute()æ–¹æ³•æ‰§è¡Œå®Œæˆï¼›å¦åˆ™æ‰§è¡Œä¸‹é¢çš„æ­¥éª¤</p>

<p>Â Â Â Â 2ï¼‰å½“åˆå§‹maximumPoolä¸ºç©ºï¼Œæˆ–è€…maximumPoolä¸­å½“å‰æ²¡æœ‰ç©ºé—²çº¿ç¨‹æ—¶ï¼Œå°†æ²¡æœ‰çº¿ç¨‹æ‰§Â  Â Â Â Â Â è¡ŒÂ SynchronousQueue.pollï¼ˆkeepAliveTimeï¼ŒTimeUnit.NANOSECONDSï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¥éª¤1ï¼‰å°†å¤±è´¥ã€‚Â  Â Â Â Â Â æ­¤æ—¶CachedThreadPoolä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œexecute()æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚</p>

<p>Â Â Â Â 3ï¼‰åœ¨æ­¥éª¤2ï¼‰ä¸­æ–°åˆ›å»ºçš„çº¿ç¨‹å°†ä»»åŠ¡æ‰§è¡Œå®Œåï¼Œä¼šæ‰§è¡ŒÂ SynchronousQueue.pollï¼ˆkeepAliveTimeï¼ŒÂ  Â Â Â Â Â TimeUnit.NANOSECONDSï¼‰ã€‚è¿™ä¸ªpollæ“ä½œä¼šè®©ç©ºé—²çº¿ç¨‹æœ€å¤šåœ¨SynchronousQueueä¸­ç­‰å¾…60ç§’é’Ÿã€‚å¦‚æœ60Â  Â Â Â Â Â ç§’é’Ÿå†…ä¸»çº¿ç¨‹æäº¤äº†ä¸€ä¸ªæ–°ä»»åŠ¡ï¼ˆä¸»çº¿ç¨‹æ‰§è¡Œæ­¥éª¤1ï¼‰ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªç©ºé—²çº¿ç¨‹å°†æ‰§è¡Œä¸»çº¿ç¨‹æäº¤çš„æ–°ä»»åŠ¡ï¼›å¦Â  Â Â Â Â Â åˆ™ï¼Œè¿™ä¸ªç©ºé—²çº¿ç¨‹å°†ç»ˆæ­¢ã€‚ç”±äºç©ºé—²60ç§’çš„ç©ºé—²çº¿ç¨‹ä¼šè¢«ç»ˆæ­¢ï¼Œå› æ­¤é•¿æ—¶é—´ä¿æŒç©ºé—²çš„CachedThreadPoolä¸Â  Â  Â Â Â Â ä¼šä½¿ç”¨ä»»ä½•èµ„æºã€‚</p>

<p>å‰é¢æåˆ°è¿‡ï¼ŒSynchronousQueueæ˜¯ä¸€ä¸ªæ²¡æœ‰å®¹é‡çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„å¯¹åº”ç§»é™¤æ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚CachedThreadPoolä½¿ç”¨SynchronousQueueï¼ŒæŠŠä¸»çº¿ç¨‹æäº¤çš„ä»»åŠ¡ä¼ é€’ç»™ç©ºé—²çº¿ç¨‹æ‰§è¡Œ</p>

<p>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± 
ã€€ã€€çº¿ç¨‹æ± å°±æ˜¯ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹[å¾ªç¯æ‰§è¡Œ]å¤šä¸ªåº”ç”¨é€»è¾‘çš„çº¿ç¨‹é›†åˆ.</p>

<p>çº¿ç¨‹æ± çš„ä½œç”¨ï¼š
ã€€ã€€çº¿ç¨‹æ± ä½œç”¨å°±æ˜¯é™åˆ¶ç³»ç»Ÿä¸­æ‰§è¡Œçº¿ç¨‹çš„æ•°é‡ã€‚
ã€€ã€€æ ¹æ®ç³»ç»Ÿçš„ç¯å¢ƒæƒ…å†µï¼Œå¯ä»¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨è®¾ç½®çº¿ç¨‹æ•°é‡ï¼Œè¾¾åˆ°è¿è¡Œçš„æœ€ä½³æ•ˆæœï¼›å°‘äº†æµªè´¹äº†ç³»ç»Ÿèµ„æºï¼Œå¤šäº†é€ æˆç³»ç»Ÿæ‹¥æŒ¤æ•ˆç‡ä¸é«˜ã€‚ç”¨çº¿ç¨‹æ± æ§åˆ¶çº¿ç¨‹æ•°é‡ï¼Œå…¶ä»–çº¿ç¨‹æ’é˜Ÿç­‰å€™ã€‚ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå†ä»é˜Ÿåˆ—çš„ä¸­å–æœ€å‰é¢çš„ä»»åŠ¡å¼€å§‹æ‰§è¡Œã€‚è‹¥é˜Ÿåˆ—ä¸­æ²¡æœ‰ç­‰å¾…è¿›ç¨‹ï¼Œçº¿ç¨‹æ± çš„è¿™ä¸€èµ„æºå¤„äºç­‰å¾…ã€‚å½“ä¸€ä¸ªæ–°ä»»åŠ¡éœ€è¦è¿è¡Œæ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­æœ‰ç­‰å¾…çš„å·¥ä½œçº¿ç¨‹ï¼Œå°±å¯ä»¥å¼€å§‹è¿è¡Œäº†ï¼›å¦åˆ™è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚</p>

<p>çº¿ç¨‹æ± æ¥å£:</p>

<p>å¤åˆ¶ä»£ç 
/**</p>
<ul>
  <li>
    <p>çº¿ç¨‹æ± æ–¹æ³•å®šä¹‰
 */
public interface ThreadPools<Job extends="" Runnable="">{</Job></p>

    <p>/**</p>
    <ul>
      <li>æ‰§è¡Œä¸€ä¸ªä»»åŠ¡(Job),è¿™ä¸ªJobå¿…é¡»å®ç°Runnable</li>
      <li>@param job
  */
 public void execute(Job job);</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>å…³é—­çº¿ç¨‹æ± 
  */
 public void shutdown();</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>å¢åŠ å·¥ä½œè€…çº¿ç¨‹ï¼Œå³ç”¨æ¥æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹</li>
      <li>@param num
  */
 public void addWorkers(int num);</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>å‡å°‘å·¥ä½œè€…çº¿ç¨‹</li>
      <li>@param num
  */
 public void removeWorker(int num);</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>è·å–æ­£åœ¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡
  */
 public int getJobSize();
}
å¤åˆ¶ä»£ç 
ã€€ã€€å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡execute(Job)æ–¹æ³•å°†Jobæäº¤å…¥çº¿ç¨‹æ± æ¥æ‰§è¡Œï¼Œå®¢æˆ·ç«¯å®Œå…¨ä¸ç”¨ç­‰å¾…Jobçš„æ‰§è¡Œå®Œæˆã€‚é™¤äº†execute(Job)æ–¹æ³•ä»¥å¤–ï¼Œçº¿ç¨‹æ± æ¥å£æä¾›äº†å¢åŠ /å‡å°‘å·¥ä½œè€…çº¿ç¨‹ä»¥åŠå…³é—­çº¿ç¨‹æ± çš„æ–¹æ³•ã€‚æ¯ä¸ªå®¢æˆ·ç«¯æäº¤çš„Jobéƒ½ä¼šè¿›å…¥åˆ°ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ä¸­ç­‰å¾…å·¥ä½œè€…çº¿ç¨‹çš„å¤„ç†ã€‚</li>
    </ul>
  </li>
</ul>

<p>çº¿ç¨‹æ± é»˜è®¤å®ç°
å¤åˆ¶ä»£ç 
import java.util.ArrayList;
import java.util.Collections;
import java.util.LinkedList;
import java.util.List;
import java.util.concurrent.atomic.AtomicLong;</p>

<p>/**</p>
<ul>
  <li>çº¿ç¨‹æ± </li>
  <li>@param <Job>
 */
public class DefaultThreadPool<Job extends="" Runnable=""> implements ThreadPools<Job>{
 /**
</Job></Job></Job>    <ul>
      <li>çº¿ç¨‹æ± ç»´æŠ¤å·¥ä½œè€…çº¿ç¨‹çš„æœ€å¤§æ•°é‡
  */
 private static final int MAX_WORKER_NUMBERS=30;</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>çº¿ç¨‹æ± ç»´æŠ¤å·¥ä½œè€…çº¿ç¨‹çš„æœ€é»˜è®¤å·¥ä½œæ•°é‡
  */
 private static final int DEFAULT_WORKER_NUMBERS = 5;</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>çº¿ç¨‹æ± ç»´æŠ¤å·¥ä½œè€…çº¿ç¨‹çš„æœ€å°æ•°é‡
  */
 private static final int MIN_WORKER_NUMBERS = 1;</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>ç»´æŠ¤ä¸€ä¸ªå·¥ä½œåˆ—è¡¨,é‡Œé¢åŠ å…¥å®¢æˆ·ç«¯å‘èµ·çš„å·¥ä½œ
  */
 private final LinkedList<Job> jobs = new LinkedList<Job>();</Job></Job></li>
    </ul>

    <p>/**</p>
    <ul>
      <li>å·¥ä½œè€…çº¿ç¨‹çš„åˆ—è¡¨
  */
 private final List<Worker> workers = Collections.synchronizedList(new ArrayList<Worker>());</Worker></Worker></li>
    </ul>

    <p>/**</p>
    <ul>
      <li>å·¥ä½œè€…çº¿ç¨‹çš„æ•°é‡
  */
 private int workerNum;
 /**
  *æ¯ä¸ªå·¥ä½œè€…çº¿ç¨‹ç¼–å·ç”Ÿæˆ
  */
 private AtomicLong threadNum = new AtomicLong();</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>ç¬¬ä¸€æ­¥:æ„é€ å‡½æ•°ï¼Œç”¨äºåˆå§‹åŒ–çº¿ç¨‹æ± </li>
      <li>é¦–å…ˆåˆ¤æ–­åˆå§‹åŒ–çº¿ç¨‹æ± çš„çº¿ç¨‹ä¸ªæ•°æ˜¯å¦å¤§äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¦‚æœå¤§äºåˆ™çº¿ç¨‹æ± çš„é»˜è®¤åˆå§‹åŒ–å€¼ä¸º DEFAULT_WORKER_NUMBERS
  */
 public DefaultThreadPool(int num){
 if (num &gt; MAX_WORKER_NUMBERS) {
     this.workerNum =DEFAULT_WORKER_NUMBERS;
 } else {
     this.workerNum = num;
 }
 initializeWorkers(workerNum);
 }</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>åˆå§‹åŒ–æ¯ä¸ªå·¥ä½œè€…çº¿ç¨‹
  */
 private void initializeWorkers(int num) {
 for (int i = 0; i &lt; num; i++) {
     Worker worker = new Worker();
     //æ·»åŠ åˆ°å·¥ä½œè€…çº¿ç¨‹çš„åˆ—è¡¨
     workers.add(worker);
     //å¯åŠ¨å·¥ä½œè€…çº¿ç¨‹
     Thread thread = new Thread(worker);
     thread.start();
 }
 }</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>æ‰§è¡Œä¸€ä¸ªä»»åŠ¡(Job),è¿™ä¸ªJobå¿…é¡»å®ç°Runnable</li>
      <li>@param job
  */
 @Override
 public void execute(Job job) {
 //å¦‚æœjobä¸ºnullï¼ŒæŠ›å‡ºç©ºæŒ‡é’ˆ
 if (job==null){
     throw new NullPointerException();
 }
 //è¿™é‡Œè¿›è¡Œæ‰§è¡Œ TODO å½“ä¾›å¤§äºæ±‚æ—¶å€™ï¼Œè€ƒè™‘å¦‚ä½•ä¸´æ—¶æ·»åŠ çº¿ç¨‹æ•°
 if (job != null) {
     //æ ¹æ®çº¿ç¨‹çš„â€ç­‰å¾…/é€šçŸ¥æœºåˆ¶â€è¿™é‡Œå¿…é¡»å¯¹jobsåŠ é”
     synchronized (jobs) {
         jobs.addLast(job);
         jobs.notify();
     }
 }</li>
    </ul>

    <p>}</p>

    <p>/**</p>
    <ul>
      <li>å…³é—­çº¿ç¨‹æ± 
  */
 @Override
 public void shutdown() {
 for (Worker worker:workers) {
     worker.shutdown();
 }
 }</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>å¢åŠ å·¥ä½œè€…çº¿ç¨‹ï¼Œå³ç”¨æ¥æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹</li>
      <li>@param num
  */
 @Override
 public void addWorkers(int num) {
 //åŠ é”ï¼Œé˜²æ­¢è¯¥çº¿ç¨‹è¿˜æ²¡å¢åŠ å®Œæˆè€Œä¸‹ä¸ªçº¿ç¨‹ç»§ç»­å¢åŠ å¯¼è‡´å·¥ä½œè€…çº¿ç¨‹è¶…è¿‡æœ€å¤§å€¼
 synchronized (jobs) {
     if (num + this.workerNum &gt; MAX_WORKER_NUMBERS) {
         num = MAX_WORKER_NUMBERS - this.workerNum;
     }
     initializeWorkers(num);
     this.workerNum += num;
 }
 }</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>å‡å°‘å·¥ä½œè€…çº¿ç¨‹</li>
      <li>@param num
  */
 @Override
 public void removeWorker(int num) {
 synchronized (jobs) {
     if(num&gt;=this.workerNum){
         throw new IllegalArgumentException(â€œè¶…è¿‡äº†å·²æœ‰çš„çº¿ç¨‹æ•°é‡â€);
     }
     for (int i = 0; i &lt; num; i++) {
         Worker worker = workers.get(i);
         if (worker != null) {
             //å…³é—­è¯¥çº¿ç¨‹å¹¶ä»åˆ—è¡¨ä¸­ç§»é™¤
             worker.shutdown();
             workers.remove(i);
         }
     }
     this.workerNum -= num;
 }</li>
    </ul>

    <p>}</p>

    <p>/**</p>
    <ul>
      <li>è·å–æ­£åœ¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡
  */
 @Override
 public int getJobSize() {
 return workers.size();
 }</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>
        <p>æ¶ˆè´¹è€…
  */
 class Worker implements Runnable {
 // è¡¨ç¤ºæ˜¯å¦è¿è¡Œè¯¥worker
 private volatile boolean running = true;</p>

        <p>@Override
 public void run() {
     while (running) { //è¿™ä¸ªå·¥ä½œçº¿ç¨‹å°±ä¸€ç›´å¾ªç¯ï¼Œä¸åœçš„æ£€æµ‹æ˜¯å¦è¿˜æœ‰ä»»åŠ¡åŒºæ‰§è¡Œ
         Job job = null;
         //çº¿ç¨‹çš„ç­‰å¾…/é€šçŸ¥æœºåˆ¶
         synchronized (jobs) {
             if (jobs.isEmpty()) {//å·¥ä½œé˜Ÿåˆ—ä¸ºç©º
                 try {
                     jobs.wait();//çº¿ç¨‹ç­‰å¾…å”¤é†’
                 } catch (InterruptedException e) {
                     //æ„ŸçŸ¥åˆ°å¤–éƒ¨å¯¹è¯¥çº¿ç¨‹çš„ä¸­æ–­æ“ä½œï¼Œè¿”å›
                     Thread.currentThread().interrupt();
                     return;
                 }
             }
             // å–å‡ºä¸€ä¸ªjob
             job = jobs.removeFirst();
         }
         //æ‰§è¡Œjob
         if (job != null) {
             job.run();
         }
     }
 }</p>

        <p>/**</p>
        <ul>
          <li>ç»ˆæ­¢è¯¥çº¿ç¨‹
  */
 public void shutdown() {
 running = false;
 }
 }</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>}
å¤åˆ¶ä»£ç 
ã€€ã€€ä»çº¿ç¨‹æ± çš„å®ç°ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“å®¢æˆ·ç«¯è°ƒç”¨execute(Job)æ–¹æ³•æ—¶ï¼Œä¼šä¸æ–­åœ°å‘ä»»åŠ¡åˆ—è¡¨jobsä¸­æ·»åŠ Jobï¼Œè€Œæ¯ä¸ªå·¥ä½œè€…çº¿ç¨‹ä¼šä¸è¯»çš„ä»jobsä¸Šè·å–Jobæ¥æ‰§è¡Œï¼Œå½“jobsä¸ºç©ºæ—¶ï¼Œå·¥ä½œè€…çº¿ç¨‹è¿›å…¥WAITINGçŠ¶æ€ã€‚</p>

<p>ã€€ã€€å½“æ·»åŠ ä¸€ä¸ªJobåï¼Œå¯¹å·¥ä½œé˜Ÿåˆ—jobsè°ƒç”¨å…¶notify()æ–¹æ³•æ¥å”¤é†’ä¸€ä¸ªå·¥ä½œè€…çº¿ç¨‹ã€‚æ­¤å¤„æˆ‘ä»¬ä¸è°ƒç”¨notifyAll(),é¿å…å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å…¨éƒ¨ç§»åŠ¨åˆ°é˜»å¡é˜Ÿåˆ—ä¸­è€Œé€ æˆèµ„æºæµªè´¹ã€‚</p>

<p>ã€€ã€€çº¿ç¨‹æ± çš„æœ¬è´¨å°±æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å·¥ä½œé˜Ÿåˆ—è¿æ¥å·¥ä½œè€…çº¿ç¨‹å’Œå®¢æˆ·ç«¯çº¿ç¨‹ã€‚å®¢æˆ·ç«¯çº¿ç¨‹æŠŠä»»åŠ¡æ”¾å…¥å·¥ä½œé˜Ÿåˆ—åä¾¿è¿”å›ï¼Œè€Œå·¥ä½œè€…çº¿ç¨‹åˆ™ä¸ç«¯çš„ä»å·¥ä½œé˜Ÿåˆ—ä¸­å–å‡ºå·¥ä½œå¹¶æ‰§è¡Œã€‚å½“å·¥ä½œé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå·¥ä½œè€…çº¿ç¨‹è¿›å…¥WAITINGçŠ¶æ€ï¼Œå½“æœ‰å®¢æˆ·ç«¯å‘é€ä»»åŠ¡è¿‡æ¥åä¼šé€šè¿‡ä»»æ„ä¸€ä¸ªå·¥ä½œè€…çº¿ç¨‹ï¼Œéšç€å¤§é‡ä»»åŠ¡çš„æäº¤ï¼Œæ›´å¤šçš„å·¥ä½œè€…çº¿ç¨‹è¢«å”¤é†’ã€‚</p>

<p>Jobå®ç°
å¤åˆ¶ä»£ç 
public class Job implements Runnable{</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Override
public void run() {
    try {
        Thread.sleep(2500);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    System.out.println("å½“å‰çº¿ç¨‹åç§°:"+Thread.currentThread().getName()+";"+"jobè¢«æŒ‡æ‰§è¡Œäº†");
} } å¤åˆ¶ä»£ç  æµ‹è¯•ç¨‹åº å¤åˆ¶ä»£ç  public class WorkTest {
public static void main(String[] args) {
    DefaultThreadPool defaultThreadPool = new DefaultThreadPool(10);
    for (int i=0;i&lt;10000;i++){
        if (i==30){
            defaultThreadPool.addWorkers(10);
        }
        Job job = new Job();
        defaultThreadPool.execute(job);
    }
} } å¤åˆ¶ä»£ç  consoleç»“æœï¼š
</code></pre></div></div>

<p>ä½¿ç”¨Executorså·¥å…·ç±»åˆ›å»ºçº¿ç¨‹æ± ï¼š</p>

<p>å¤åˆ¶ä»£ç 
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;</p>

<p>/**</p>
<ul>
  <li>è¿è¡Œç»“æœï¼šæ€»å…±åªä¼šåˆ›å»º5ä¸ªçº¿ç¨‹ï¼Œ å¼€å§‹æ‰§è¡Œäº”ä¸ªçº¿ç¨‹ï¼Œ</li>
  <li>å½“äº”ä¸ªçº¿ç¨‹éƒ½å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå†æ¬¡æäº¤çš„ä»»åŠ¡éƒ½ä¼šåŠ å…¥é˜Ÿåˆ—ç­‰åˆ°å…¶ä»–çº¿ç¨‹è¿è¡Œç»“æŸï¼Œå½“çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€æ—¶ä¼šè¢«ä¸‹ä¸€ä¸ªä»»åŠ¡å¤ç”¨
 *
 */
public class newFixedThreadPoolTest {
 public static void main(String[] args) {
     //Executorså·¥å‚ç±»åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼Œä»¥å…±äº«çš„æ— ç•Œé˜Ÿåˆ—æ–¹å¼æ¥è¿è¡Œè¿™äº›çº¿ç¨‹
     ExecutorService executorService = Executors.newFixedThreadPool(5);
     for(int i = 0; i &lt; 20; i++) {
         Runnable synRunnable = new Runnable() {
             public void run() {
                 System.out.println(Thread.currentThread().getName());
             }
         };
         executorService.execute(synRunnable);
     }
 }
}</li>
</ul>

<p>ExecutorServiceæ˜¯çº¿ç¨‹æ± æ¥å£ã€‚å®ƒå®šä¹‰äº†4ä¸­çº¿ç¨‹æ± ï¼š</p>

<ol>
  <li>newCachedThreadPoolï¼š
åº•å±‚ï¼šè¿”å›ThreadPoolExecutorå®ä¾‹ï¼ŒcorePoolSizeä¸º0ï¼›maximumPoolSizeä¸ºInteger.MAX_VALUEï¼›keepAliveTimeä¸º60Lï¼›unitä¸ºTimeUnit.SECONDSï¼›workQueueä¸ºSynchronousQueue(åŒæ­¥é˜Ÿåˆ—)
é€šä¿—ï¼šå½“æœ‰æ–°ä»»åŠ¡åˆ°æ¥ï¼Œåˆ™æ’å…¥åˆ°SynchronousQueueä¸­ï¼Œç”±äºSynchronousQueueæ˜¯åŒæ­¥é˜Ÿåˆ—ï¼Œå› æ­¤ä¼šåœ¨æ± ä¸­å¯»æ‰¾å¯ç”¨çº¿ç¨‹æ¥æ‰§è¡Œï¼Œè‹¥æœ‰å¯ä»¥çº¿ç¨‹åˆ™æ‰§è¡Œï¼Œè‹¥æ²¡æœ‰å¯ç”¨çº¿ç¨‹åˆ™åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ï¼›è‹¥æ± ä¸­çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡æŒ‡å®šå¤§å°ï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¢«é”€æ¯ã€‚
é€‚ç”¨ï¼šæ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥çš„å°ç¨‹åºæˆ–è€…è´Ÿè½½è¾ƒè½»çš„æœåŠ¡å™¨</li>
  <li>newFixedThreadPoolï¼š
åº•å±‚ï¼šè¿”å›ThreadPoolExecutorå®ä¾‹ï¼Œæ¥æ”¶å‚æ•°ä¸ºæ‰€è®¾å®šçº¿ç¨‹æ•°é‡nThreadï¼ŒcorePoolSizeä¸ºnThreadï¼ŒmaximumPoolSizeä¸ºnThreadï¼›keepAliveTimeä¸º0L(ä¸é™æ—¶)ï¼›unitä¸ºï¼šTimeUnit.MILLISECONDSï¼›WorkQueueä¸ºï¼šnew LinkedBlockingQueue<Runnable>() æ— ç•Œé˜»å¡é˜Ÿåˆ—
é€šä¿—ï¼šåˆ›å»ºå¯å®¹çº³å›ºå®šæ•°é‡çº¿ç¨‹çš„æ± å­ï¼Œæ¯éš”çº¿ç¨‹çš„å­˜æ´»æ—¶é—´æ˜¯æ— é™çš„ï¼Œå½“æ± å­æ»¡äº†å°±ä¸åœ¨æ·»åŠ çº¿ç¨‹äº†ï¼›å¦‚æœæ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹å‡åœ¨ç¹å¿™çŠ¶æ€ï¼Œå¯¹äºæ–°ä»»åŠ¡ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—ä¸­(æ— ç•Œçš„é˜»å¡é˜Ÿåˆ—)ï¼Œä½†æ˜¯ï¼Œåœ¨çº¿ç¨‹æ± ç©ºé—²æ—¶ï¼Œå³çº¿ç¨‹æ± ä¸­æ²¡æœ‰å¯è¿è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒä¸ä¼šé‡Šæ”¾å·¥ä½œçº¿ç¨‹ï¼Œè¿˜ä¼šå ç”¨ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚
é€‚ç”¨ï¼šæ‰§è¡Œé•¿æœŸçš„ä»»åŠ¡ï¼Œæ€§èƒ½å¥½å¾ˆå¤š</Runnable></li>
  <li>newSingleThreadExecutor:
åº•å±‚ï¼šFinalizableDelegatedExecutorServiceåŒ…è£…çš„ThreadPoolExecutorå®ä¾‹ï¼ŒcorePoolSizeä¸º1ï¼›maximumPoolSizeä¸º1ï¼›keepAliveTimeä¸º0Lï¼›unitä¸ºï¼šTimeUnit.MILLISECONDSï¼›workQueueä¸ºï¼šnew LinkedBlockingQueue<Runnable>() æ— ç•Œé˜»å¡é˜Ÿåˆ—
é€šä¿—ï¼šåˆ›å»ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä¸”çº¿ç¨‹çš„å­˜æ´»æ—¶é—´æ˜¯æ— é™çš„ï¼›å½“è¯¥çº¿ç¨‹æ­£ç¹å¿™æ—¶ï¼Œå¯¹äºæ–°ä»»åŠ¡ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—ä¸­(æ— ç•Œçš„é˜»å¡é˜Ÿåˆ—)
é€‚ç”¨ï¼šä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œçš„åœºæ™¯</Runnable></li>
  <li>NewScheduledThreadPool:
åº•å±‚ï¼šåˆ›å»ºScheduledThreadPoolExecutorå®ä¾‹ï¼ŒcorePoolSizeä¸ºä¼ é€’æ¥çš„å‚æ•°ï¼ŒmaximumPoolSizeä¸ºInteger.MAX_VALUEï¼›keepAliveTimeä¸º0ï¼›unitä¸ºï¼šTimeUnit.NANOSECONDSï¼›workQueueä¸ºï¼šnew DelayedWorkQueue() ä¸€ä¸ªæŒ‰è¶…æ—¶æ—¶é—´å‡åºæ’åºçš„é˜Ÿåˆ—
é€šä¿—ï¼šåˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± å†…çº¿ç¨‹å­˜æ´»æ—¶é—´æ— é™åˆ¶ï¼Œçº¿ç¨‹æ± å¯ä»¥æ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹å‡å¤„äºç¹å¿™çŠ¶æ€ï¼Œå¯¹äºæ–°ä»»åŠ¡ä¼šè¿›å…¥DelayedWorkQueueé˜Ÿåˆ—ä¸­ï¼Œè¿™æ˜¯ä¸€ç§æŒ‰ç…§è¶…æ—¶æ—¶é—´æ’åºçš„é˜Ÿåˆ—ç»“æ„
é€‚ç”¨ï¼šå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„åœºæ™¯</li>
</ol>

<p>Javaå¤šçº¿ç¨‹å®ç°æ–¹å¼ä¸»è¦æœ‰å››ç§ï¼šç»§æ‰¿Threadç±»ã€å®ç°Runnableæ¥å£ã€å®ç°Callableæ¥å£é€šè¿‡FutureTaskåŒ…è£…å™¨æ¥åˆ›å»ºThreadçº¿ç¨‹ã€ä½¿ç”¨ExecutorServiceã€Callableã€Futureå®ç°æœ‰è¿”å›ç»“æœçš„å¤šçº¿ç¨‹ã€‚</p>

<p>å…¶ä¸­å‰ä¸¤ç§æ–¹å¼çº¿ç¨‹æ‰§è¡Œå®Œåéƒ½æ²¡æœ‰è¿”å›å€¼ï¼Œåä¸¤ç§æ˜¯å¸¦è¿”å›å€¼çš„ã€‚</p>

<p>1ã€ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹
Threadç±»æœ¬è´¨ä¸Šæ˜¯å®ç°äº†Runnableæ¥å£çš„ä¸€ä¸ªå®ä¾‹ï¼Œä»£è¡¨ä¸€ä¸ªçº¿ç¨‹çš„å®ä¾‹ã€‚å¯åŠ¨çº¿ç¨‹çš„å”¯ä¸€æ–¹æ³•å°±æ˜¯é€šè¿‡Threadç±»çš„start()å®ä¾‹æ–¹æ³•ã€‚start()æ–¹æ³•æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œå®ƒå°†å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œrun()æ–¹æ³•ã€‚è¿™ç§æ–¹å¼å®ç°å¤šçº¿ç¨‹å¾ˆç®€å•ï¼Œé€šè¿‡è‡ªå·±çš„ç±»ç›´æ¥extend Threadï¼Œå¹¶å¤å†™run()æ–¹æ³•ï¼Œå°±å¯ä»¥å¯åŠ¨æ–°çº¿ç¨‹å¹¶æ‰§è¡Œè‡ªå·±å®šä¹‰çš„run()æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>

<p>å¤åˆ¶ä»£ç 
public class MyThread extends Thread {<br />
ã€€ã€€public void run() {<br />
ã€€ã€€ System.out.println(â€œMyThread.run()â€);<br />
ã€€ã€€}<br />
}</p>

<p>MyThread myThread1 = new MyThread();<br />
MyThread myThread2 = new MyThread();<br />
myThread1.start();<br />
myThread2.start();<br />
å¤åˆ¶ä»£ç 
2ã€å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹
å¦‚æœè‡ªå·±çš„ç±»å·²ç»extendså¦ä¸€ä¸ªç±»ï¼Œå°±æ— æ³•ç›´æ¥extends Threadï¼Œæ­¤æ—¶ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªRunnableæ¥å£ï¼Œå¦‚ä¸‹ï¼š</p>

<p>public class MyThread extends OtherClass implements Runnable {<br />
ã€€ã€€public void run() {<br />
ã€€ã€€ System.out.println(â€œMyThread.run()â€);<br />
ã€€ã€€}<br />
}<br />
ä¸ºäº†å¯åŠ¨MyThreadï¼Œéœ€è¦é¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ªThreadï¼Œå¹¶ä¼ å…¥è‡ªå·±çš„MyThreadå®ä¾‹ï¼š</p>

<p>MyThread myThread = new MyThread();<br />
Thread thread = new Thread(myThread);<br />
thread.start();<br />
äº‹å®ä¸Šï¼Œå½“ä¼ å…¥ä¸€ä¸ªRunnable targetå‚æ•°ç»™Threadåï¼ŒThreadçš„run()æ–¹æ³•å°±ä¼šè°ƒç”¨target.run()ï¼Œå‚è€ƒJDKæºä»£ç ï¼š</p>

<p>public void run() {<br />
ã€€ã€€if (target != null) {<br />
ã€€ã€€ target.run();<br />
ã€€ã€€}<br />
}<br />
3ã€å®ç°Callableæ¥å£é€šè¿‡FutureTaskåŒ…è£…å™¨æ¥åˆ›å»ºThreadçº¿ç¨‹</p>

<p>Callableæ¥å£ï¼ˆä¹Ÿåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼‰å®šä¹‰å¦‚ä¸‹ï¼š</p>

<p>public interface Callable<V>   { 
  V callï¼ˆï¼‰ throws Exception;   } 
å¤åˆ¶ä»£ç 
public class SomeCallable<V> extends OtherClass implements Callable<V> {</V></V></V></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Override
public V call() throws Exception {
    // TODO Auto-generated method stub
    return null;
}
</code></pre></div></div>

<p>}
å¤åˆ¶ä»£ç 
å¤åˆ¶ä»£ç 
Callable<V> oneCallable = new SomeCallable<V>();   
//ç”±Callable<Integer>åˆ›å»ºä¸€ä¸ªFutureTask<Integer>å¯¹è±¡ï¼š   
FutureTask<V> oneTask = new FutureTask<V>(oneCallable);   
//æ³¨é‡Šï¼šFutureTask<Integer>æ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå®ƒé€šè¿‡æ¥å—Callable<Integer>æ¥åˆ›å»ºï¼Œå®ƒåŒæ—¶å®ç°äº†Futureå’ŒRunnableæ¥å£ã€‚ 
  //ç”±FutureTask<Integer>åˆ›å»ºä¸€ä¸ªThreadå¯¹è±¡ï¼š   
Thread oneThread = new Thread(oneTask);   
oneThread.start();   
//è‡³æ­¤ï¼Œä¸€ä¸ªçº¿ç¨‹å°±åˆ›å»ºå®Œæˆäº†ã€‚
å¤åˆ¶ä»£ç 
4ã€ä½¿ç”¨ExecutorServiceã€Callableã€Futureå®ç°æœ‰è¿”å›ç»“æœçš„çº¿ç¨‹</Integer></Integer></Integer></V></V></Integer></Integer></V></V></p>

<p>ExecutorServiceã€Callableã€Futureä¸‰ä¸ªæ¥å£å®é™…ä¸Šéƒ½æ˜¯å±äºExecutoræ¡†æ¶ã€‚è¿”å›ç»“æœçš„çº¿ç¨‹æ˜¯åœ¨JDK1.5ä¸­å¼•å…¥çš„æ–°ç‰¹å¾ï¼Œæœ‰äº†è¿™ç§ç‰¹å¾å°±ä¸éœ€è¦å†ä¸ºäº†å¾—åˆ°è¿”å›å€¼è€Œå¤§è´¹å‘¨æŠ˜äº†ã€‚è€Œä¸”è‡ªå·±å®ç°äº†ä¹Ÿå¯èƒ½æ¼æ´ç™¾å‡ºã€‚</p>

<p>å¯è¿”å›å€¼çš„ä»»åŠ¡å¿…é¡»å®ç°Callableæ¥å£ã€‚ç±»ä¼¼çš„ï¼Œæ— è¿”å›å€¼çš„ä»»åŠ¡å¿…é¡»å®ç°Runnableæ¥å£ã€‚</p>

<p>æ‰§è¡ŒCallableä»»åŠ¡åï¼Œå¯ä»¥è·å–ä¸€ä¸ªFutureçš„å¯¹è±¡ï¼Œåœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨getå°±å¯ä»¥è·å–åˆ°Callableä»»åŠ¡è¿”å›çš„Objectäº†ã€‚</p>

<p>æ³¨æ„ï¼šgetæ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œå³ï¼šçº¿ç¨‹æ— è¿”å›ç»“æœï¼Œgetæ–¹æ³•ä¼šä¸€ç›´ç­‰å¾…ã€‚</p>

<p>å†ç»“åˆçº¿ç¨‹æ± æ¥å£ExecutorServiceå°±å¯ä»¥å®ç°ä¼ è¯´ä¸­æœ‰è¿”å›ç»“æœçš„å¤šçº¿ç¨‹äº†ã€‚</p>

<p>ä¸‹é¢æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„æœ‰è¿”å›ç»“æœçš„å¤šçº¿ç¨‹æµ‹è¯•ä¾‹å­ï¼Œåœ¨JDK1.5ä¸‹éªŒè¯è¿‡æ²¡é—®é¢˜å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
import java.util.concurrent.*;<br />
import java.util.Date;<br />
import java.util.List;<br />
import java.util.ArrayList;</p>

<p>/**</p>
<ul>
  <li>
    <p>æœ‰è¿”å›å€¼çš„çº¿ç¨‹ 
*/<br />
@SuppressWarnings(â€œuncheckedâ€)<br />
public class Test {<br />
public static void main(String[] args) throws ExecutionException,<br />
  InterruptedException {<br />
 System.out.println(â€œâ€”-ç¨‹åºå¼€å§‹è¿è¡Œâ€”-â€œ);<br />
 Date date1 = new Date();</p>

    <p>int taskSize = 5;<br />
 // åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± <br />
 ExecutorService pool = Executors.newFixedThreadPool(taskSize);<br />
 // åˆ›å»ºå¤šä¸ªæœ‰è¿”å›å€¼çš„ä»»åŠ¡<br />
 List<Future> list = new ArrayList<Future>();  
 for (int i = 0; i &lt; taskSize; i++) {  
  Callable c = new MyCallable(i + " ");  
  // æ‰§è¡Œä»»åŠ¡å¹¶è·å–Futureå¯¹è±¡  
  Future f = pool.submit(c);  
  // System.out.println("&gt;&gt;&gt;" + f.get().toString());  
  list.add(f);  
 }  
 // å…³é—­çº¿ç¨‹æ±   
 pool.shutdown();</Future></Future></p>

    <p>// è·å–æ‰€æœ‰å¹¶å‘ä»»åŠ¡çš„è¿è¡Œç»“æœ<br />
 for (Future f : list) {<br />
  // ä»Futureå¯¹è±¡ä¸Šè·å–ä»»åŠ¡çš„è¿”å›å€¼ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°<br />
  System.out.println(â€œÂ»&gt;â€ + f.get().toString());<br />
 }</p>

    <p>Date date2 = new Date();<br />
 System.out.println(â€œâ€”-ç¨‹åºç»“æŸè¿è¡Œâ€”-ï¼Œç¨‹åºè¿è¡Œæ—¶é—´ã€â€</p>
    <ul>
      <li>(date2.getTime() - date1.getTime()) + â€œæ¯«ç§’ã€‘â€);<br />
}<br />
}</li>
    </ul>
  </li>
</ul>

<p>class MyCallable implements Callable<object> {<br />
private String taskNum;</object></p>

<p>MyCallable(String taskNum) {<br />
   this.taskNum = taskNum;<br />
}</p>

<p>public Object call() throws Exception {<br />
   System.out.println(â€œÂ»&gt;â€ + taskNum + â€œä»»åŠ¡å¯åŠ¨â€);<br />
   Date dateTmp1 = new Date();<br />
   Thread.sleep(1000);<br />
   Date dateTmp2 = new Date();<br />
   long time = dateTmp2.getTime() - dateTmp1.getTime();<br />
   System.out.println(â€œÂ»&gt;â€ + taskNum + â€œä»»åŠ¡ç»ˆæ­¢â€);<br />
   return taskNum + â€œä»»åŠ¡è¿”å›è¿è¡Œç»“æœ,å½“å‰ä»»åŠ¡æ—¶é—´ã€â€ + time + â€œæ¯«ç§’ã€‘â€;<br />
}<br />
}<br />
å¤åˆ¶ä»£ç </p>

<p>ä»£ç è¯´æ˜ï¼š
ä¸Šè¿°ä»£ç ä¸­Executorsç±»ï¼Œæä¾›äº†ä¸€ç³»åˆ—å·¥å‚æ–¹æ³•ç”¨äºåˆ›å»ºçº¿ç¨‹æ± ï¼Œè¿”å›çš„çº¿ç¨‹æ± éƒ½å®ç°äº†ExecutorServiceæ¥å£ã€‚
public static ExecutorService newFixedThreadPool(int nThreads) 
åˆ›å»ºå›ºå®šæ•°ç›®çº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚
public static ExecutorService newCachedThreadPool() 
åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œè°ƒç”¨execute å°†é‡ç”¨ä»¥å‰æ„é€ çš„çº¿ç¨‹ï¼ˆå¦‚æœçº¿ç¨‹å¯ç”¨ï¼‰ã€‚å¦‚æœç°æœ‰çº¿ç¨‹æ²¡æœ‰å¯ç”¨çš„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¹¶æ·»åŠ åˆ°æ± ä¸­ã€‚ç»ˆæ­¢å¹¶ä»ç¼“å­˜ä¸­ç§»é™¤é‚£äº›å·²æœ‰ 60 ç§’é’Ÿæœªè¢«ä½¿ç”¨çš„çº¿ç¨‹ã€‚
public static ExecutorService newSingleThreadExecutor() 
åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„Executorã€‚
public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) 
åˆ›å»ºä¸€ä¸ªæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§çš„ä»»åŠ¡æ‰§è¡Œçš„çº¿ç¨‹æ± ï¼Œå¤šæ•°æƒ…å†µä¸‹å¯ç”¨æ¥æ›¿ä»£Timerç±»ã€‚</p>

<p>ExecutoreServiceæä¾›äº†submit()æ–¹æ³•ï¼Œä¼ é€’ä¸€ä¸ªCallableï¼Œæˆ–Runnableï¼Œè¿”å›Futureã€‚å¦‚æœExecutoråå°çº¿ç¨‹æ± è¿˜æ²¡æœ‰å®ŒæˆCallableçš„è®¡ç®—ï¼Œè¿™è°ƒç”¨è¿”å›Futureå¯¹è±¡çš„get()æ–¹æ³•ï¼Œä¼šé˜»å¡ç›´åˆ°è®¡ç®—å®Œæˆã€‚</p>

<p>1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼š  java.util.concurrent.Executorsæä¾›äº†ä¸€ä¸ª java.util.concurrent.Executoræ¥å£çš„å®ç°ç”¨äºåˆ›å»ºçº¿ç¨‹æ± </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>å¤šçº¿ç¨‹æŠ€æœ¯ä¸»è¦è§£å†³å¤„ç†å™¨å•å…ƒå†…å¤šä¸ªçº¿ç¨‹æ‰§è¡Œçš„é—®é¢˜ï¼Œå®ƒå¯ä»¥æ˜¾è‘—å‡å°‘å¤„ç†å™¨å•å…ƒçš„é—²ç½®æ—¶é—´ï¼Œå¢åŠ å¤„ç†å™¨å•å…ƒçš„ååèƒ½åŠ›ã€‚    
å‡è®¾ä¸€ä¸ªæœåŠ¡å™¨å®Œæˆä¸€é¡¹ä»»åŠ¡æ‰€éœ€æ—¶é—´ä¸ºï¼šT1 åˆ›å»ºçº¿ç¨‹æ—¶é—´ï¼ŒT2 åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡çš„æ—¶é—´ï¼ŒT3 é”€æ¯çº¿ç¨‹æ—¶é—´ã€‚
</code></pre></div></div>

<p>å¦‚æœï¼šT1 + T3 è¿œå¤§äº T2ï¼Œåˆ™å¯ä»¥é‡‡ç”¨çº¿ç¨‹æ± ï¼Œä»¥æé«˜æœåŠ¡å™¨æ€§èƒ½ã€‚</p>

<p>ä¸€ä¸ªçº¿ç¨‹æ± åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªåŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼š
1ã€çº¿ç¨‹æ± ç®¡ç†å™¨ï¼ˆThreadPoolï¼‰ï¼šç”¨äºåˆ›å»ºå¹¶ç®¡ç†çº¿ç¨‹æ± ï¼ŒåŒ…æ‹¬ åˆ›å»ºçº¿ç¨‹æ± ï¼Œé”€æ¯çº¿ç¨‹æ± ï¼Œæ·»åŠ æ–°ä»»åŠ¡ï¼›
2ã€å·¥ä½œçº¿ç¨‹ï¼ˆPoolWorkerï¼‰ï¼šçº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Œåœ¨æ²¡æœ‰ä»»åŠ¡æ—¶å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¯ä»¥å¾ªç¯çš„æ‰§è¡Œä»»åŠ¡ï¼›
3ã€ä»»åŠ¡æ¥å£ï¼ˆTaskï¼‰ï¼šæ¯ä¸ªä»»åŠ¡å¿…é¡»å®ç°çš„æ¥å£ï¼Œä»¥ä¾›å·¥ä½œçº¿ç¨‹è°ƒåº¦ä»»åŠ¡çš„æ‰§è¡Œï¼Œå®ƒä¸»è¦è§„å®šäº†ä»»åŠ¡çš„å…¥å£ï¼Œä»»åŠ¡æ‰§è¡Œå®Œåçš„æ”¶å°¾å·¥ä½œï¼Œä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ç­‰ï¼›
4ã€ä»»åŠ¡é˜Ÿåˆ—ï¼ˆtaskQueueï¼‰ï¼šç”¨äºå­˜æ”¾æ²¡æœ‰å¤„ç†çš„ä»»åŠ¡ã€‚æä¾›ä¸€ç§ç¼“å†²æœºåˆ¶ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>çº¿ç¨‹æ± æŠ€æœ¯æ­£æ˜¯å…³æ³¨å¦‚ä½•ç¼©çŸ­æˆ–è°ƒæ•´T1,T3æ—¶é—´çš„æŠ€æœ¯ï¼Œä»è€Œæé«˜æœåŠ¡å™¨ç¨‹åºæ€§èƒ½çš„ã€‚å®ƒæŠŠT1ï¼ŒT3åˆ†åˆ«å®‰æ’åœ¨æœåŠ¡å™¨ç¨‹åºçš„å¯åŠ¨å’Œç»“æŸçš„æ—¶é—´æ®µæˆ–è€…ä¸€äº›ç©ºé—²çš„æ—¶é—´æ®µï¼Œè¿™æ ·åœ¨æœåŠ¡å™¨ç¨‹åºå¤„ç†å®¢æˆ·è¯·æ±‚æ—¶ï¼Œä¸ä¼šæœ‰T1ï¼ŒT3çš„å¼€é”€äº†ã€‚
çº¿ç¨‹æ± ä¸ä»…è°ƒæ•´T1,T3äº§ç”Ÿçš„æ—¶é—´æ®µï¼Œè€Œä¸”å®ƒè¿˜æ˜¾è‘—å‡å°‘äº†åˆ›å»ºçº¿ç¨‹çš„æ•°ç›®ï¼Œçœ‹ä¸€ä¸ªä¾‹å­ï¼š
å‡è®¾ä¸€ä¸ªæœåŠ¡å™¨ä¸€å¤©è¦å¤„ç†50000ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”æ¯ä¸ªè¯·æ±‚éœ€è¦ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å®Œæˆã€‚åœ¨çº¿ç¨‹æ± ä¸­ï¼Œçº¿ç¨‹æ•°ä¸€èˆ¬æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥äº§ç”Ÿçº¿ç¨‹æ€»æ•°ä¸ä¼šè¶…è¿‡çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°ç›®ï¼Œè€Œå¦‚æœæœåŠ¡å™¨ä¸åˆ©ç”¨çº¿ç¨‹æ± æ¥å¤„ç†è¿™äº›è¯·æ±‚åˆ™çº¿ç¨‹æ€»æ•°ä¸º50000ã€‚ä¸€èˆ¬çº¿ç¨‹æ± å¤§å°æ˜¯è¿œå°äº50000ã€‚æ‰€ä»¥åˆ©ç”¨çº¿ç¨‹æ± çš„æœåŠ¡å™¨ç¨‹åºä¸ä¼šä¸ºäº†åˆ›å»º50000è€Œåœ¨å¤„ç†è¯·æ±‚æ—¶æµªè´¹æ—¶é—´ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚
</code></pre></div></div>

<p>2.å¸¸è§çº¿ç¨‹æ± </p>

<p>â‘ newSingleThreadExecutor</p>

<p>å•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå³çº¿ç¨‹æ± ä¸­æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å·¥ä½œï¼Œå•çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œä»»åŠ¡</p>

<p>â‘¡newFixedThreadPool(n)</p>

<p>å›ºå®šæ•°é‡çš„çº¿ç¨‹æ± ï¼Œæ²¡æäº¤ä¸€ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œç›´åˆ°è¾¾åˆ°çº¿ç¨‹æ± çš„æœ€å¤§æ•°é‡ï¼Œç„¶ååé¢è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ç›´åˆ°å‰é¢çš„ä»»åŠ¡å®Œæˆæ‰ç»§ç»­æ‰§è¡Œ</p>

<p>â‘¢newCacheThreadPoolï¼ˆæ¨èä½¿ç”¨ï¼‰</p>

<p>å¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå½“çº¿ç¨‹æ± å¤§å°è¶…è¿‡äº†å¤„ç†ä»»åŠ¡æ‰€éœ€çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ä¼šå›æ”¶éƒ¨åˆ†ç©ºé—²ï¼ˆä¸€èˆ¬æ˜¯60ç§’æ— æ‰§è¡Œï¼‰çš„çº¿ç¨‹ï¼Œå½“æœ‰ä»»åŠ¡æ¥æ—¶ï¼Œåˆæ™ºèƒ½çš„æ·»åŠ æ–°çº¿ç¨‹æ¥æ‰§è¡Œã€‚</p>

<p>â‘£newScheduledThreadPool</p>

<p>å¤§å°æ— é™åˆ¶çš„çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶å’Œå‘¨æœŸæ€§çš„æ‰§è¡Œçº¿ç¨‹</p>

<p>javaæä¾›çš„çº¿ç¨‹æ± æ›´åŠ å¼ºå¤§ï¼Œç›¸ä¿¡ç†è§£çº¿ç¨‹æ± çš„å·¥ä½œåŸç†ï¼Œçœ‹ç±»åº“ä¸­çš„çº¿ç¨‹æ± å°±ä¸ä¼šæ„Ÿåˆ°é™Œç”Ÿäº†ã€‚</p>

<p>Javaçº¿ç¨‹æ± ä½¿ç”¨è¯´æ˜</p>

<p>ä¸€ï¼šç®€ä»‹
çº¿ç¨‹çš„ä½¿ç”¨åœ¨javaä¸­å æœ‰æå…¶é‡è¦çš„åœ°ä½ï¼Œåœ¨jdk1.4æå…¶ä¹‹å‰çš„jdkç‰ˆæœ¬ä¸­ï¼Œå…³äºçº¿ç¨‹æ± çš„ä½¿ç”¨æ˜¯æå…¶ç®€é™‹çš„ã€‚åœ¨jdk1.5ä¹‹åè¿™ä¸€æƒ…å†µæœ‰äº†å¾ˆå¤§çš„æ”¹è§‚ã€‚Jdk1.5ä¹‹ååŠ å…¥äº†java.util.concurrentåŒ…ï¼Œè¿™ä¸ªåŒ…ä¸­ä¸»è¦ä»‹ç»javaä¸­çº¿ç¨‹ä»¥åŠçº¿ç¨‹æ± çš„ä½¿ç”¨ã€‚ä¸ºæˆ‘ä»¬åœ¨å¼€å‘ä¸­å¤„ç†çº¿ç¨‹çš„é—®é¢˜æä¾›äº†éå¸¸å¤§çš„å¸®åŠ©ã€‚</p>

<p>äºŒï¼šçº¿ç¨‹æ± 
çº¿ç¨‹æ± çš„ä½œç”¨ï¼š</p>

<p>çº¿ç¨‹æ± ä½œç”¨å°±æ˜¯é™åˆ¶ç³»ç»Ÿä¸­æ‰§è¡Œçº¿ç¨‹çš„æ•°é‡ã€‚
     æ ¹æ®ç³»ç»Ÿçš„ç¯å¢ƒæƒ…å†µï¼Œå¯ä»¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨è®¾ç½®çº¿ç¨‹æ•°é‡ï¼Œè¾¾åˆ°è¿è¡Œçš„æœ€ä½³æ•ˆæœï¼›å°‘äº†æµªè´¹äº†ç³»ç»Ÿèµ„æºï¼Œå¤šäº†é€ æˆç³»ç»Ÿæ‹¥æŒ¤æ•ˆç‡ä¸é«˜ã€‚ç”¨çº¿ç¨‹æ± æ§åˆ¶çº¿ç¨‹æ•°é‡ï¼Œå…¶ä»–çº¿ç¨‹æ’é˜Ÿç­‰å€™ã€‚ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå†ä»é˜Ÿåˆ—çš„ä¸­å–æœ€å‰é¢çš„ä»»åŠ¡å¼€å§‹æ‰§è¡Œã€‚è‹¥é˜Ÿåˆ—ä¸­æ²¡æœ‰ç­‰å¾…è¿›ç¨‹ï¼Œçº¿ç¨‹æ± çš„è¿™ä¸€èµ„æºå¤„äºç­‰å¾…ã€‚å½“ä¸€ä¸ªæ–°ä»»åŠ¡éœ€è¦è¿è¡Œæ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­æœ‰ç­‰å¾…çš„å·¥ä½œçº¿ç¨‹ï¼Œå°±å¯ä»¥å¼€å§‹è¿è¡Œäº†ï¼›å¦åˆ™è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚</p>

<p>ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± :</p>

<p>1.å‡å°‘äº†åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ¬¡æ•°ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½å¯ä»¥è¢«é‡å¤åˆ©ç”¨ï¼Œå¯æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚</p>

<p>2.å¯ä»¥æ ¹æ®ç³»ç»Ÿçš„æ‰¿å—èƒ½åŠ›ï¼Œè°ƒæ•´çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿çº¿ç¨‹çš„æ•°ç›®ï¼Œé˜²æ­¢å› ä¸ºæ¶ˆè€—è¿‡å¤šçš„å†…å­˜ï¼Œè€ŒæŠŠæœåŠ¡å™¨ç´¯è¶´ä¸‹(æ¯ä¸ªçº¿ç¨‹éœ€è¦å¤§çº¦1MBå†…å­˜ï¼Œçº¿ç¨‹å¼€çš„è¶Šå¤šï¼Œæ¶ˆè€—çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§ï¼Œæœ€åæ­»æœº)ã€‚</p>

<p>Javaé‡Œé¢çº¿ç¨‹æ± çš„é¡¶çº§æ¥å£æ˜¯Executorï¼Œä½†æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šè®²Executorå¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè€Œåªæ˜¯ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹çš„å·¥å…·ã€‚çœŸæ­£çš„çº¿ç¨‹æ± æ¥å£æ˜¯ExecutorServiceã€‚</p>

<p>æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªç±»ï¼š</p>

<p>ExecutorService</p>

<p>çœŸæ­£çš„çº¿ç¨‹æ± æ¥å£ã€‚</p>

<p>ScheduledExecutorService</p>

<p>èƒ½å’ŒTimer/TimerTaskç±»ä¼¼ï¼Œè§£å†³é‚£äº›éœ€è¦ä»»åŠ¡é‡å¤æ‰§è¡Œçš„é—®é¢˜ã€‚</p>

<p>ThreadPoolExecutor</p>

<p>ExecutorServiceçš„é»˜è®¤å®ç°ã€‚</p>

<p>ScheduledThreadPoolExecutor</p>

<p>ç»§æ‰¿ThreadPoolExecutorçš„ScheduledExecutorServiceæ¥å£å®ç°ï¼Œå‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦çš„ç±»å®ç°ã€‚</p>

<p>è¦é…ç½®ä¸€ä¸ªçº¿ç¨‹æ± æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºçº¿ç¨‹æ± çš„åŸç†ä¸æ˜¯å¾ˆæ¸…æ¥šçš„æƒ…å†µä¸‹ï¼Œå¾ˆæœ‰å¯èƒ½é…ç½®çš„çº¿ç¨‹æ± ä¸æ˜¯è¾ƒä¼˜çš„ï¼Œå› æ­¤åœ¨Executorsç±»é‡Œé¢æä¾›äº†ä¸€äº›é™æ€å·¥å‚ï¼Œç”Ÿæˆä¸€äº›å¸¸ç”¨çš„çº¿ç¨‹æ± ã€‚</p>

<ol>
  <li>newSingleThreadExecutor</li>
</ol>

<p>åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚è¿™ä¸ªçº¿ç¨‹æ± åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å·¥ä½œï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºå•çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡ã€‚å¦‚æœè¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹å› ä¸ºå¼‚å¸¸ç»“æŸï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ›¿ä»£å®ƒã€‚æ­¤çº¿ç¨‹æ± ä¿è¯æ‰€æœ‰ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæŒ‰ç…§ä»»åŠ¡çš„æäº¤é¡ºåºæ‰§è¡Œã€‚</p>

<p>2.newFixedThreadPool</p>

<p>åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚æ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œç›´åˆ°çº¿ç¨‹è¾¾åˆ°çº¿ç¨‹æ± çš„æœ€å¤§å¤§å°ã€‚çº¿ç¨‹æ± çš„å¤§å°ä¸€æ—¦è¾¾åˆ°æœ€å¤§å€¼å°±ä¼šä¿æŒä¸å˜ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å› ä¸ºæ‰§è¡Œå¼‚å¸¸è€Œç»“æŸï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šè¡¥å……ä¸€ä¸ªæ–°çº¿ç¨‹ã€‚</p>

<ol>
  <li>newCachedThreadPool</li>
</ol>

<p>åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ã€‚å¦‚æœçº¿ç¨‹æ± çš„å¤§å°è¶…è¿‡äº†å¤„ç†ä»»åŠ¡æ‰€éœ€è¦çš„çº¿ç¨‹ï¼Œ</p>

<p>é‚£ä¹ˆå°±ä¼šå›æ”¶éƒ¨åˆ†ç©ºé—²ï¼ˆ60ç§’ä¸æ‰§è¡Œä»»åŠ¡ï¼‰çš„çº¿ç¨‹ï¼Œå½“ä»»åŠ¡æ•°å¢åŠ æ—¶ï¼Œæ­¤çº¿ç¨‹æ± åˆå¯ä»¥æ™ºèƒ½çš„æ·»åŠ æ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚æ­¤çº¿ç¨‹æ± ä¸ä¼šå¯¹çº¿ç¨‹æ± å¤§å°åšé™åˆ¶ï¼Œçº¿ç¨‹æ± å¤§å°å®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿï¼ˆæˆ–è€…è¯´JVMï¼‰èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹å¤§å°ã€‚</p>

<p>4.newScheduledThreadPool</p>

<p>åˆ›å»ºä¸€ä¸ªå¤§å°æ— é™çš„çº¿ç¨‹æ± ã€‚æ­¤çº¿ç¨‹æ± æ”¯æŒå®šæ—¶ä»¥åŠå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„éœ€æ±‚ã€‚</p>

<p>å®ä¾‹</p>

<p>1ï¼šnewSingleThreadExecutor</p>

<p>package com.thread;
/*</p>
<ul>
  <li>é€šè¿‡å®ç°Runnableæ¥å£ï¼Œå®ç°å¤šçº¿ç¨‹</li>
  <li>Runnableç±»æ˜¯æœ‰run()æ–¹æ³•çš„ï¼›</li>
  <li>ä½†æ˜¯æ²¡æœ‰startæ–¹æ³•</li>
  <li>å‚è€ƒï¼š</li>
  <li>
    <p>http://blog.csdn.net/qq_31753145/article/details/50899119</p>
  </li>
  <li>*/</li>
</ul>

<p>public class MyThread extends Thread {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Override
public void run() {
    // TODO Auto-generated method stub //        super.run();
System.out.println(Thread.currentThread().getName()+"æ­£åœ¨æ‰§è¡Œ....");
}  } package com.thread;
</code></pre></div></div>

<p>import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;</p>

<p>/*</p>
<ul>
  <li>é€šè¿‡å®ç°Runnableæ¥å£ï¼Œå®ç°å¤šçº¿ç¨‹</li>
  <li>Runnableç±»æ˜¯æœ‰run()æ–¹æ³•çš„ï¼›</li>
  <li>ä½†æ˜¯æ²¡æœ‰startæ–¹æ³•</li>
  <li>å‚è€ƒï¼š</li>
  <li>
    <p>http://blog.csdn.net/qq_31753145/article/details/50899119</p>
  </li>
  <li>*/</li>
</ul>

<p>public class singleThreadExecutorTest{</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static void main(String[] args) {
    ExecutorService pool=Executors.newSingleThreadExecutor();
    
    //åˆ›å»ºå®ç°äº†Runnableæ¥å£å¯¹è±¡ï¼ŒThreadå¯¹è±¡å½“ç„¶ä¹Ÿå®ç°äº†Runnableæ¥å£;      
    Thread t1=new MyThread();       
    Thread t2=new MyThread();       
    Thread t3=new MyThread();       
    Thread t4=new MyThread();       
    Thread t5=new MyThread();
    
    //å°†çº¿ç¨‹æ”¾åˆ°æ± ä¸­æ‰§è¡Œï¼›     
    pool.execute(t1);
    pool.execute(t2);
    pool.execute(t3);
    pool.execute(t4);
    pool.execute(t5);
    
    //å…³é—­çº¿ç¨‹æ±        
   pool.shutdown(); 
} } ç»“æœï¼š
</code></pre></div></div>

<p>pool-1-thread-1æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-1æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-1æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-1æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-1æ­£åœ¨æ‰§è¡Œâ€¦.
2ï¼šnewFixedThreadPool</p>

<p>package com.thread;</p>

<p>import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;</p>

<p>/*</p>
<ul>
  <li>é€šè¿‡å®ç°Runnableæ¥å£ï¼Œå®ç°å¤šçº¿ç¨‹</li>
  <li>Runnableç±»æ˜¯æœ‰run()æ–¹æ³•çš„ï¼›</li>
  <li>ä½†æ˜¯æ²¡æœ‰startæ–¹æ³•</li>
  <li>å‚è€ƒï¼š</li>
  <li>
    <p>http://blog.csdn.net/qq_31753145/article/details/50899119</p>
  </li>
  <li>*/</li>
</ul>

<p>public class fixedThreadExecutorTest{</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static void main(String[] args) {
    ExecutorService pool=Executors.newFixedThreadPool(2);
    
    //åˆ›å»ºå®ç°äº†Runnableæ¥å£å¯¹è±¡ï¼ŒThreadå¯¹è±¡å½“ç„¶ä¹Ÿå®ç°äº†Runnableæ¥å£;              
    Thread t1=new MyThread();      
    Thread t2=new MyThread();        
    Thread t3=new MyThread();      
    Thread t4=new MyThread();      
    Thread t5=new MyThread();
   
    //å°†çº¿ç¨‹æ”¾åˆ°æ± ä¸­æ‰§è¡Œï¼›      
    pool.execute(t1);
    pool.execute(t2);
    pool.execute(t3);
    pool.execute(t4);
    pool.execute(t5);
    
    //å…³é—­çº¿ç¨‹æ±        
   pool.shutdown();
}
</code></pre></div></div>

<p>}
ç»“æœï¼š</p>

<p>pool-1-thread-1æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-1æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-1æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-1æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-2æ­£åœ¨æ‰§è¡Œâ€¦.
3ï¼šnewCachedThreadPool</p>

<p>package com.thread;</p>

<p>import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;</p>

<p>/*</p>
<ul>
  <li>é€šè¿‡å®ç°Runnableæ¥å£ï¼Œå®ç°å¤šçº¿ç¨‹</li>
  <li>Runnableç±»æ˜¯æœ‰run()æ–¹æ³•çš„ï¼›</li>
  <li>ä½†æ˜¯æ²¡æœ‰startæ–¹æ³•</li>
  <li>å‚è€ƒï¼š</li>
  <li>
    <p>http://blog.csdn.net/qq_31753145/article/details/50899119</p>
  </li>
  <li>*/</li>
</ul>

<p>public class cachedThreadExecutorTest{</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static void main(String[] args) {
  
    ExecutorService pool=Executors.newCachedThreadPool();
    
    //åˆ›å»ºå®ç°äº†Runnableæ¥å£å¯¹è±¡ï¼ŒThreadå¯¹è±¡å½“ç„¶ä¹Ÿå®ç°äº†Runnableæ¥å£;
    Thread t1=new MyThread();    
    Thread t2=new MyThread();  
    Thread t3=new MyThread();    
    Thread t4=new MyThread();   
    Thread t5=new MyThread();
    
    //å°†çº¿ç¨‹æ”¾åˆ°æ± ä¸­æ‰§è¡Œï¼›      
    pool.execute(t1);
    pool.execute(t2);
    pool.execute(t3);
    pool.execute(t4);
    pool.execute(t5);
    
    //å…³é—­çº¿ç¨‹æ±      
   pool.shutdown();
}
</code></pre></div></div>

<p>}
ç»“æœï¼š</p>

<p>pool-1-thread-2æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-1æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-3æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-4æ­£åœ¨æ‰§è¡Œâ€¦.
pool-1-thread-5æ­£åœ¨æ‰§è¡Œâ€¦.
4ï¼šnewScheduledThreadPool</p>

<p>package com.thread;</p>

<p>import java.util.concurrent.ScheduledThreadPoolExecutor;
import java.util.concurrent.TimeUnit;</p>

<p>/*</p>
<ul>
  <li>é€šè¿‡å®ç°Runnableæ¥å£ï¼Œå®ç°å¤šçº¿ç¨‹</li>
  <li>Runnableç±»æ˜¯æœ‰run()æ–¹æ³•çš„ï¼›</li>
  <li>ä½†æ˜¯æ²¡æœ‰startæ–¹æ³•</li>
  <li>å‚è€ƒï¼š</li>
  <li>
    <p>http://blog.csdn.net/qq_31753145/article/details/50899119</p>
  </li>
  <li>*/</li>
</ul>

<p>public class scheduledThreadExecutorTest{</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static void main(String[] args) {
    // TODO Auto-generated method stub

   ScheduledThreadPoolExecutor exec =new ScheduledThreadPoolExecutor(1);
   exec.scheduleAtFixedRate(new Runnable(){//æ¯éš”ä¸€æ®µæ—¶é—´å°±è§¦å‘å¼‚å¸¸

    @Override
    public void run() {
        // TODO Auto-generated method stub
        //throw new RuntimeException();
        System.out.println("===================");
        
    }}, 1000, 5000, TimeUnit.MILLISECONDS);  
   
   exec.scheduleAtFixedRate(new Runnable(){//æ¯éš”ä¸€æ®µæ—¶é—´æ‰“å°ç³»ç»Ÿæ—¶é—´ï¼Œè¯æ˜ä¸¤è€…æ˜¯äº’ä¸å½±å“çš„

    @Override
    public void run() {
        // TODO Auto-generated method stub
        System.out.println(System.nanoTime());
        
    }}, 1000, 2000, TimeUnit.MILLISECONDS);
} } ç»“æœï¼š
</code></pre></div></div>

<p>===================
23119318857491
23121319071841
23123319007891
===================
23125318176937
23127318190359
===================
23129318176148
23131318344312
23133318465896
===================
23135319645812
ä¸‰ï¼šThreadPoolExecutorè¯¦è§£
ThreadPoolExecutorçš„å®Œæ•´æ„é€ æ–¹æ³•çš„ç­¾åæ˜¯ï¼šThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue<Runnable> workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) .</Runnable></p>

<p>corePoolSize - æ± ä¸­æ‰€ä¿å­˜çš„çº¿ç¨‹æ•°ï¼ŒåŒ…æ‹¬ç©ºé—²çº¿ç¨‹ã€‚</p>

<p>maximumPoolSize-æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚</p>

<p>keepAliveTime - å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒæ—¶ï¼Œæ­¤ä¸ºç»ˆæ­¢å‰å¤šä½™çš„ç©ºé—²çº¿ç¨‹ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ã€‚</p>

<p>unit - keepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ã€‚</p>

<p>workQueue - æ‰§è¡Œå‰ç”¨äºä¿æŒä»»åŠ¡çš„é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—ä»…ä¿æŒç”± executeæ–¹æ³•æäº¤çš„ Runnableä»»åŠ¡ã€‚</p>

<p>threadFactory - æ‰§è¡Œç¨‹åºåˆ›å»ºæ–°çº¿ç¨‹æ—¶ä½¿ç”¨çš„å·¥å‚ã€‚</p>

<p>handler - ç”±äºè¶…å‡ºçº¿ç¨‹èŒƒå›´å’Œé˜Ÿåˆ—å®¹é‡è€Œä½¿æ‰§è¡Œè¢«é˜»å¡æ—¶æ‰€ä½¿ç”¨çš„å¤„ç†ç¨‹åºã€‚</p>

<p>ThreadPoolExecutoræ˜¯Executorsç±»çš„åº•å±‚å®ç°ã€‚</p>

<p>åœ¨JDKå¸®åŠ©æ–‡æ¡£ä¸­ï¼Œæœ‰å¦‚æ­¤ä¸€æ®µè¯ï¼š</p>

<p>â€œå¼ºçƒˆå»ºè®®ç¨‹åºå‘˜ä½¿ç”¨è¾ƒä¸ºæ–¹ä¾¿çš„Executorså·¥å‚æ–¹æ³•Executors.newCachedThreadPool()ï¼ˆæ— ç•Œçº¿ç¨‹æ± ï¼Œå¯ä»¥è¿›è¡Œè‡ªåŠ¨çº¿ç¨‹å›æ”¶ï¼‰ã€Executors.newFixedThreadPool(int)ï¼ˆå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼‰Executors.newSingleThreadExecutor()ï¼ˆå•ä¸ªåå°çº¿ç¨‹ï¼‰</p>

<p>å®ƒä»¬å‡ä¸ºå¤§å¤šæ•°ä½¿ç”¨åœºæ™¯é¢„å®šä¹‰äº†è®¾ç½®ã€‚â€</p>

<p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹å‡ ä¸ªç±»çš„æºç ï¼š</p>

<p>ExecutorService  newFixedThreadPool (int nThreads):å›ºå®šå¤§å°çº¿ç¨‹æ± ã€‚</p>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒcorePoolSizeå’ŒmaximumPoolSizeçš„å¤§å°æ˜¯ä¸€æ ·çš„ï¼ˆå®é™…ä¸Šï¼Œåé¢ä¼šä»‹ç»ï¼Œå¦‚æœä½¿ç”¨æ— ç•Œqueueçš„è¯maximumPoolSizeå‚æ•°æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼‰ï¼ŒkeepAliveTimeå’Œunitçš„è®¾å€¼è¡¨åä»€ä¹ˆï¼Ÿ-å°±æ˜¯è¯¥å®ç°ä¸æƒ³keep aliveï¼æœ€åçš„BlockingQueueé€‰æ‹©äº†LinkedBlockingQueueï¼Œè¯¥queueæœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œä»–æ˜¯æ— ç•Œçš„ã€‚</p>

<p>public static ExecutorService newFixedThreadPool(int nThreads) { <br />
           return new ThreadPoolExecutor(nThreads, nThreads, <br />
                                        0L, TimeUnit.MILLISECONDS, <br />
                                        new LinkedBlockingQueue<Runnable>());   
      }
ExecutorService  newSingleThreadExecutor()ï¼šå•çº¿ç¨‹</Runnable></p>

<p>public static ExecutorService newSingleThreadExecutor() { <br />
            return new FinalizableDelegatedExecutorService <br />
                 (new ThreadPoolExecutor(1, 1, <br />
                                       0L, TimeUnit.MILLISECONDS, <br />
                                      new LinkedBlockingQueue<Runnable>()));   
       }
 ExecutorService newCachedThreadPool()ï¼šæ— ç•Œçº¿ç¨‹æ± ï¼Œå¯ä»¥è¿›è¡Œè‡ªåŠ¨çº¿ç¨‹å›æ”¶</Runnable></p>

<p>è¿™ä¸ªå®ç°å°±æœ‰æ„æ€äº†ã€‚é¦–å…ˆæ˜¯æ— ç•Œçš„çº¿ç¨‹æ± ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‘ç°maximumPoolSizeä¸ºbig bigã€‚å…¶æ¬¡BlockingQueueçš„é€‰æ‹©ä¸Šä½¿ç”¨SynchronousQueueã€‚å¯èƒ½å¯¹äºè¯¥BlockingQueueæœ‰äº›é™Œç”Ÿï¼Œç®€å•è¯´ï¼šè¯¥QUEUEä¸­ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„å¯¹åº”ç§»é™¤æ“ä½œã€‚</p>

<p>public static ExecutorService newCachedThreadPool() { <br />
             return new ThreadPoolExecutor(0, Integer.MAX_VALUE, <br />
                                         60L, TimeUnit.SECONDS, <br />
                                        new SynchronousQueue<Runnable>());   
    }
å…ˆä»BlockingQueue<Runnable> workQueueè¿™ä¸ªå…¥å‚å¼€å§‹è¯´èµ·ã€‚åœ¨JDKä¸­ï¼Œå…¶å®å·²ç»è¯´å¾—å¾ˆæ¸…æ¥šäº†ï¼Œä¸€å…±æœ‰ä¸‰ç§ç±»å‹çš„queueã€‚</Runnable></Runnable></p>

<p>æ‰€æœ‰BlockingQueue éƒ½å¯ç”¨äºä¼ è¾“å’Œä¿æŒæäº¤çš„ä»»åŠ¡ã€‚å¯ä»¥ä½¿ç”¨æ­¤é˜Ÿåˆ—ä¸æ± å¤§å°è¿›è¡Œäº¤äº’ï¼š</p>

<p>å¦‚æœè¿è¡Œçš„çº¿ç¨‹å°‘äº corePoolSizeï¼Œåˆ™ Executorå§‹ç»ˆé¦–é€‰æ·»åŠ æ–°çš„çº¿ç¨‹ï¼Œè€Œä¸è¿›è¡Œæ’é˜Ÿã€‚ï¼ˆå¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹å°äºcorePoolSizeï¼Œåˆ™ä»»åŠ¡æ ¹æœ¬ä¸ä¼šå­˜æ”¾ï¼Œæ·»åŠ åˆ°queueä¸­ï¼Œè€Œæ˜¯ç›´æ¥æŠ„å®¶ä¼™ï¼ˆthreadï¼‰å¼€å§‹è¿è¡Œï¼‰</p>

<p>å¦‚æœè¿è¡Œçš„çº¿ç¨‹ç­‰äºæˆ–å¤šäº corePoolSizeï¼Œåˆ™ Executorå§‹ç»ˆé¦–é€‰å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œè€Œä¸æ·»åŠ æ–°çš„çº¿ç¨‹ã€‚</p>

<p>å¦‚æœæ— æ³•å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œé™¤éåˆ›å»ºæ­¤çº¿ç¨‹è¶…å‡º maximumPoolSizeï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»»åŠ¡å°†è¢«æ‹’ç»ã€‚</p>

<p>æ’é˜Ÿæœ‰ä¸‰ç§é€šç”¨ç­–ç•¥ï¼š</p>

<p>ç›´æ¥æäº¤ã€‚å·¥ä½œé˜Ÿåˆ—çš„é»˜è®¤é€‰é¡¹æ˜¯ SynchronousQueueï¼Œå®ƒå°†ä»»åŠ¡ç›´æ¥æäº¤ç»™çº¿ç¨‹è€Œä¸ä¿æŒå®ƒä»¬ã€‚åœ¨æ­¤ï¼Œå¦‚æœä¸å­˜åœ¨å¯ç”¨äºç«‹å³è¿è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼Œåˆ™è¯•å›¾æŠŠä»»åŠ¡åŠ å…¥é˜Ÿåˆ—å°†å¤±è´¥ï¼Œå› æ­¤ä¼šæ„é€ ä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚æ­¤ç­–ç•¥å¯ä»¥é¿å…åœ¨å¤„ç†å¯èƒ½å…·æœ‰å†…éƒ¨ä¾èµ–æ€§çš„è¯·æ±‚é›†æ—¶å‡ºç°é”ã€‚ç›´æ¥æäº¤é€šå¸¸è¦æ±‚æ— ç•Œ maximumPoolSizes ä»¥é¿å…æ‹’ç»æ–°æäº¤çš„ä»»åŠ¡ã€‚å½“å‘½ä»¤ä»¥è¶…è¿‡é˜Ÿåˆ—æ‰€èƒ½å¤„ç†çš„å¹³å‡æ•°è¿ç»­åˆ°è¾¾æ—¶ï¼Œæ­¤ç­–ç•¥å…è®¸æ— ç•Œçº¿ç¨‹å…·æœ‰å¢é•¿çš„å¯èƒ½æ€§ã€‚</p>

<p>æ— ç•Œé˜Ÿåˆ—ã€‚ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼ˆä¾‹å¦‚ï¼Œä¸å…·æœ‰é¢„å®šä¹‰å®¹é‡çš„ LinkedBlockingQueueï¼‰å°†å¯¼è‡´åœ¨æ‰€æœ‰corePoolSize çº¿ç¨‹éƒ½å¿™æ—¶æ–°ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚è¿™æ ·ï¼Œåˆ›å»ºçš„çº¿ç¨‹å°±ä¸ä¼šè¶…è¿‡ corePoolSizeã€‚ï¼ˆå› æ­¤ï¼ŒmaximumPoolSizeçš„å€¼ä¹Ÿå°±æ— æ•ˆäº†ã€‚ï¼‰å½“æ¯ä¸ªä»»åŠ¡å®Œå…¨ç‹¬ç«‹äºå…¶ä»–ä»»åŠ¡ï¼Œå³ä»»åŠ¡æ‰§è¡Œäº’ä¸å½±å“æ—¶ï¼Œé€‚åˆäºä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼›ä¾‹å¦‚ï¼Œåœ¨ Webé¡µæœåŠ¡å™¨ä¸­ã€‚è¿™ç§æ’é˜Ÿå¯ç”¨äºå¤„ç†ç¬æ€çªå‘è¯·æ±‚ï¼Œå½“å‘½ä»¤ä»¥è¶…è¿‡é˜Ÿåˆ—æ‰€èƒ½å¤„ç†çš„å¹³å‡æ•°è¿ç»­åˆ°è¾¾æ—¶ï¼Œæ­¤ç­–ç•¥å…è®¸æ— ç•Œçº¿ç¨‹å…·æœ‰å¢é•¿çš„å¯èƒ½æ€§ã€‚</p>

<p>æœ‰ç•Œé˜Ÿåˆ—ã€‚å½“ä½¿ç”¨æœ‰é™çš„ maximumPoolSizesæ—¶ï¼Œæœ‰ç•Œé˜Ÿåˆ—ï¼ˆå¦‚ ArrayBlockingQueueï¼‰æœ‰åŠ©äºé˜²æ­¢èµ„æºè€—å°½ï¼Œä½†æ˜¯å¯èƒ½è¾ƒéš¾è°ƒæ•´å’Œæ§åˆ¶ã€‚é˜Ÿåˆ—å¤§å°å’Œæœ€å¤§æ± å¤§å°å¯èƒ½éœ€è¦ç›¸äº’æŠ˜è¡·ï¼šä½¿ç”¨å¤§å‹é˜Ÿåˆ—å’Œå°å‹æ± å¯ä»¥æœ€å¤§é™åº¦åœ°é™ä½ CPU ä½¿ç”¨ç‡ã€æ“ä½œç³»ç»Ÿèµ„æºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œä½†æ˜¯å¯èƒ½å¯¼è‡´äººå·¥é™ä½ååé‡ã€‚å¦‚æœä»»åŠ¡é¢‘ç¹é˜»å¡ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå®ƒä»¬æ˜¯ I/Oè¾¹ç•Œï¼‰ï¼Œåˆ™ç³»ç»Ÿå¯èƒ½ä¸ºè¶…è¿‡æ‚¨è®¸å¯çš„æ›´å¤šçº¿ç¨‹å®‰æ’æ—¶é—´ã€‚ä½¿ç”¨å°å‹é˜Ÿåˆ—é€šå¸¸è¦æ±‚è¾ƒå¤§çš„æ± å¤§å°ï¼ŒCPUä½¿ç”¨ç‡è¾ƒé«˜ï¼Œä½†æ˜¯å¯èƒ½é‡åˆ°ä¸å¯æ¥å—çš„è°ƒåº¦å¼€é”€ï¼Œè¿™æ ·ä¹Ÿä¼šé™ä½ååé‡ã€‚</p>

<p>BlockingQueueçš„é€‰æ‹©ã€‚</p>

<p>ä¾‹å­ä¸€ï¼šä½¿ç”¨ç›´æ¥æäº¤ç­–ç•¥ï¼Œä¹Ÿå³SynchronousQueueã€‚</p>

<p>é¦–å…ˆSynchronousQueueæ˜¯æ— ç•Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–å­˜æ•°ä»»åŠ¡çš„èƒ½åŠ›æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œä½†æ˜¯ç”±äºè¯¥Queueæœ¬èº«çš„ç‰¹æ€§ï¼Œåœ¨æŸæ¬¡æ·»åŠ å…ƒç´ åå¿…é¡»ç­‰å¾…å…¶ä»–çº¿ç¨‹å–èµ°åæ‰èƒ½ç»§ç»­æ·»åŠ ã€‚åœ¨è¿™é‡Œä¸æ˜¯æ ¸å¿ƒçº¿ç¨‹ä¾¿æ˜¯æ–°åˆ›å»ºçš„çº¿ç¨‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¯•æƒ³ä¸€æ ·ä¸‹ï¼Œä¸‹é¢çš„åœºæ™¯ã€‚</p>

<p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸‹å‚æ•°æ„é€ ThreadPoolExecutorï¼š</p>

<p>new ThreadPoolExecutor( <br />
               2, 3, 30, TimeUnit.SECONDS,  <br />
               new  SynchronousQueue<Runnable>(),    
               new RecorderThreadFactory("CookieRecorderPool"),    
            new ThreadPoolExecutor.CallerRunsPolicy());
 å½“æ ¸å¿ƒçº¿ç¨‹å·²ç»æœ‰2ä¸ªæ­£åœ¨è¿è¡Œ.</Runnable></p>

<p>æ­¤æ—¶ç»§ç»­æ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼ˆAï¼‰ï¼Œæ ¹æ®å‰é¢ä»‹ç»çš„â€œå¦‚æœè¿è¡Œçš„çº¿ç¨‹ç­‰äºæˆ–å¤šäº corePoolSizeï¼Œåˆ™Executorå§‹ç»ˆé¦–é€‰å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œè€Œä¸æ·»åŠ æ–°çš„çº¿ç¨‹ã€‚â€,æ‰€ä»¥Aè¢«æ·»åŠ åˆ°queueä¸­ã€‚
åˆæ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼ˆBï¼‰ï¼Œä¸”æ ¸å¿ƒ2ä¸ªçº¿ç¨‹è¿˜æ²¡æœ‰å¿™å®Œï¼ŒOKï¼Œæ¥ä¸‹æ¥é¦–å…ˆå°è¯•1ä¸­æè¿°ï¼Œä½†æ˜¯ç”±äºä½¿ç”¨çš„SynchronousQueueï¼Œæ‰€ä»¥ä¸€å®šæ— æ³•åŠ å…¥è¿›å»ã€‚
æ­¤æ—¶ä¾¿æ»¡è¶³äº†ä¸Šé¢æåˆ°çš„â€œå¦‚æœæ— æ³•å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œé™¤éåˆ›å»ºæ­¤çº¿ç¨‹è¶…å‡ºmaximumPoolSizeï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»»åŠ¡å°†è¢«æ‹’ç»ã€‚â€ï¼Œæ‰€ä»¥å¿…ç„¶ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥è¿è¡Œè¿™ä¸ªä»»åŠ¡ã€‚
æš‚æ—¶è¿˜å¯ä»¥ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸‰ä¸ªä»»åŠ¡éƒ½è¿˜æ²¡å®Œæˆï¼Œè¿ç»­æ¥äº†ä¸¤ä¸ªä»»åŠ¡ï¼Œç¬¬ä¸€ä¸ªæ·»åŠ å…¥queueä¸­ï¼Œåä¸€ä¸ªå‘¢ï¼Ÿqueueä¸­æ— æ³•æ’å…¥ï¼Œè€Œçº¿ç¨‹æ•°è¾¾åˆ°äº†maximumPoolSizeï¼Œæ‰€ä»¥åªå¥½æ‰§è¡Œå¼‚å¸¸ç­–ç•¥äº†ã€‚
æ‰€ä»¥åœ¨ä½¿ç”¨SynchronousQueueé€šå¸¸è¦æ±‚maximumPoolSizeæ˜¯æ— ç•Œçš„ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ä¸Šè¿°æƒ…å†µå‘ç”Ÿï¼ˆå¦‚æœå¸Œæœ›é™åˆ¶å°±ç›´æ¥ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼‰ã€‚å¯¹äºä½¿ç”¨SynchronousQueueçš„ä½œç”¨jdkä¸­å†™çš„å¾ˆæ¸…æ¥šï¼šæ­¤ç­–ç•¥å¯ä»¥é¿å…åœ¨å¤„ç†å¯èƒ½å…·æœ‰å†…éƒ¨ä¾èµ–æ€§çš„è¯·æ±‚é›†æ—¶å‡ºç°é”ã€‚</p>

<p>ä»€ä¹ˆæ„æ€ï¼Ÿå¦‚æœä½ çš„ä»»åŠ¡A1ï¼ŒA2æœ‰å†…éƒ¨å…³è”ï¼ŒA1éœ€è¦å…ˆè¿è¡Œï¼Œé‚£ä¹ˆå…ˆæäº¤A1ï¼Œå†æäº¤A2ï¼Œå½“ä½¿ç”¨SynchronousQueueæˆ‘ä»¬å¯ä»¥ä¿è¯ï¼ŒA1å¿…å®šå…ˆè¢«æ‰§è¡Œï¼Œåœ¨A1ä¹ˆæœ‰è¢«æ‰§è¡Œå‰ï¼ŒA2ä¸å¯èƒ½æ·»åŠ å…¥queueä¸­ã€‚</p>

<p>ä¾‹å­äºŒï¼šä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ç­–ç•¥ï¼Œå³LinkedBlockingQueue</p>

<p>è¿™ä¸ªå°±æ‹¿newFixedThreadPoolæ¥è¯´ï¼Œæ ¹æ®å‰æ–‡æåˆ°çš„è§„åˆ™ï¼š</p>

<p>å¦‚æœè¿è¡Œçš„çº¿ç¨‹å°‘äº corePoolSizeï¼Œåˆ™ Executor å§‹ç»ˆé¦–é€‰æ·»åŠ æ–°çš„çº¿ç¨‹ï¼Œè€Œä¸è¿›è¡Œæ’é˜Ÿã€‚é‚£ä¹ˆå½“ä»»åŠ¡ç»§ç»­å¢åŠ ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>

<p>å¦‚æœè¿è¡Œçš„çº¿ç¨‹ç­‰äºæˆ–å¤šäº corePoolSizeï¼Œåˆ™ Executor å§‹ç»ˆé¦–é€‰å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œè€Œä¸æ·»åŠ æ–°çš„çº¿ç¨‹ã€‚OKï¼Œæ­¤æ—¶ä»»åŠ¡å˜åŠ å…¥é˜Ÿåˆ—ä¹‹ä¸­äº†ï¼Œé‚£ä»€ä¹ˆæ—¶å€™æ‰ä¼šæ·»åŠ æ–°çº¿ç¨‹å‘¢ï¼Ÿ</p>

<p>å¦‚æœæ— æ³•å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œé™¤éåˆ›å»ºæ­¤çº¿ç¨‹è¶…å‡º maximumPoolSizeï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»»åŠ¡å°†è¢«æ‹’ç»ã€‚è¿™é‡Œå°±å¾ˆæœ‰æ„æ€äº†ï¼Œå¯èƒ½ä¼šå‡ºç°æ— æ³•åŠ å…¥é˜Ÿåˆ—å—ï¼Ÿä¸åƒSynchronousQueueé‚£æ ·æœ‰å…¶è‡ªèº«çš„ç‰¹ç‚¹ï¼Œå¯¹äºæ— ç•Œé˜Ÿåˆ—æ¥è¯´ï¼Œæ€»æ˜¯å¯ä»¥åŠ å…¥çš„ï¼ˆèµ„æºè€—å°½ï¼Œå½“ç„¶å¦å½“åˆ«è®ºï¼‰ã€‚æ¢å¥è¯´ï¼Œæ°¸è¿œä¹Ÿä¸ä¼šè§¦å‘äº§ç”Ÿæ–°çš„çº¿ç¨‹ï¼corePoolSizeå¤§å°çš„çº¿ç¨‹æ•°ä¼šä¸€ç›´è¿è¡Œï¼Œå¿™å®Œå½“å‰çš„ï¼Œå°±ä»é˜Ÿåˆ—ä¸­æ‹¿ä»»åŠ¡å¼€å§‹è¿è¡Œã€‚æ‰€ä»¥è¦é˜²æ­¢ä»»åŠ¡ç–¯é•¿ï¼Œæ¯”å¦‚ä»»åŠ¡è¿è¡Œçš„å®è¡Œæ¯”è¾ƒé•¿ï¼Œè€Œæ·»åŠ ä»»åŠ¡çš„é€Ÿåº¦è¿œè¿œè¶…è¿‡å¤„ç†ä»»åŠ¡çš„æ—¶é—´ï¼Œè€Œä¸”è¿˜ä¸æ–­å¢åŠ ï¼Œä¸ä¸€ä¼šå„¿å°±çˆ†äº†ã€‚</p>

<p>ä¾‹å­ä¸‰ï¼šæœ‰ç•Œé˜Ÿåˆ—ï¼Œä½¿ç”¨ArrayBlockingQueueã€‚</p>

<p>è¿™ä¸ªæ˜¯æœ€ä¸ºå¤æ‚çš„ä½¿ç”¨ï¼Œæ‰€ä»¥JDKä¸æ¨èä½¿ç”¨ä¹Ÿæœ‰äº›é“ç†ã€‚ä¸ä¸Šé¢çš„ç›¸æ¯”ï¼Œæœ€å¤§çš„ç‰¹ç‚¹ä¾¿æ˜¯å¯ä»¥é˜²æ­¢èµ„æºè€—å°½çš„æƒ…å†µå‘ç”Ÿã€‚</p>

<p>ä¸¾ä¾‹æ¥è¯´ï¼Œè¯·çœ‹å¦‚ä¸‹æ„é€ æ–¹æ³•ï¼š</p>

<p>new ThreadPoolExecutor( <br />
                2, 4, 30, TimeUnit.SECONDS,  <br />
              new ArrayBlockingQueue<Runnable>(2),    
                new RecorderThreadFactory("CookieRecorderPool"),    
               new ThreadPoolExecutor.CallerRunsPolicy());
å‡è®¾ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½æ°¸è¿œæ— æ³•æ‰§è¡Œå®Œã€‚</Runnable></p>

<p>å¯¹äºé¦–å…ˆæ¥çš„A,Bæ¥è¯´ç›´æ¥è¿è¡Œï¼Œæ¥ä¸‹æ¥ï¼Œå¦‚æœæ¥äº†C,Dï¼Œä»–ä»¬ä¼šè¢«æ”¾åˆ°queueä¸­ï¼Œå¦‚æœæ¥ä¸‹æ¥å†æ¥E,Fï¼Œåˆ™å¢åŠ çº¿ç¨‹è¿è¡ŒEï¼ŒFã€‚ä½†æ˜¯å¦‚æœå†æ¥ä»»åŠ¡ï¼Œé˜Ÿåˆ—æ— æ³•å†æ¥å—äº†ï¼Œçº¿ç¨‹æ•°ä¹Ÿåˆ°è¾¾æœ€å¤§çš„é™åˆ¶äº†ï¼Œæ‰€ä»¥å°±ä¼šä½¿ç”¨æ‹’ç»ç­–ç•¥æ¥å¤„ç†ã€‚</p>

<p>keepAliveTime</p>

<p>jdkä¸­çš„è§£é‡Šæ˜¯ï¼šå½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒæ—¶ï¼Œæ­¤ä¸ºç»ˆæ­¢å‰å¤šä½™çš„ç©ºé—²çº¿ç¨‹ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ã€‚</p>

<p>æœ‰ç‚¹æ‹—å£ï¼Œå…¶å®è¿™ä¸ªä¸éš¾ç†è§£ï¼Œåœ¨ä½¿ç”¨äº†â€œæ± â€çš„åº”ç”¨ä¸­ï¼Œå¤§å¤šéƒ½æœ‰ç±»ä¼¼çš„å‚æ•°éœ€è¦é…ç½®ã€‚æ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ï¼ŒDBCPä¸­çš„maxIdleï¼ŒminIdleå‚æ•°ã€‚</p>

<p>ä»€ä¹ˆæ„æ€ï¼Ÿæ¥ç€ä¸Šé¢çš„è§£é‡Šï¼Œåæ¥å‘è€æ¿æ´¾æ¥çš„å·¥äººå§‹ç»ˆæ˜¯â€œå€Ÿæ¥çš„â€ï¼Œä¿—è¯è¯´â€œæœ‰å€Ÿå°±æœ‰è¿˜â€ï¼Œä½†è¿™é‡Œçš„é—®é¢˜å°±æ˜¯ä»€ä¹ˆæ—¶å€™è¿˜äº†ï¼Œå¦‚æœå€Ÿæ¥çš„å·¥äººåˆšå®Œæˆä¸€ä¸ªä»»åŠ¡å°±è¿˜å›å»ï¼Œåæ¥å‘ç°ä»»åŠ¡è¿˜æœ‰ï¼Œé‚£å²‚ä¸æ˜¯åˆè¦å»å€Ÿï¼Ÿè¿™ä¸€æ¥ä¸€å¾€ï¼Œè€æ¿è‚¯å®šå¤´ä¹Ÿå¤§æ­»äº†ã€‚</p>

<p>åˆç†çš„ç­–ç•¥ï¼šæ—¢ç„¶å€Ÿäº†ï¼Œé‚£å°±å¤šå€Ÿä¸€ä¼šå„¿ã€‚ç›´åˆ°â€œæŸä¸€æ®µâ€æ—¶é—´åï¼Œå‘ç°å†ä¹Ÿç”¨ä¸åˆ°è¿™äº›å·¥äººæ—¶ï¼Œä¾¿å¯ä»¥è¿˜å›å»äº†ã€‚è¿™é‡Œçš„æŸä¸€æ®µæ—¶é—´ä¾¿æ˜¯keepAliveTimeçš„å«ä¹‰ï¼ŒTimeUnitä¸ºkeepAliveTimeå€¼çš„åº¦é‡ã€‚</p>

<p>RejectedExecutionHandler</p>

<p>å¦ä¸€ç§æƒ…å†µä¾¿æ˜¯ï¼Œå³ä½¿å‘è€æ¿å€Ÿäº†å·¥äººï¼Œä½†æ˜¯ä»»åŠ¡è¿˜æ˜¯ç»§ç»­è¿‡æ¥ï¼Œè¿˜æ˜¯å¿™ä¸è¿‡æ¥ï¼Œè¿™æ—¶æ•´ä¸ªé˜Ÿä¼åªå¥½æ‹’ç»æ¥å—äº†ã€‚</p>

<p>RejectedExecutionHandleræ¥å£æä¾›äº†å¯¹äºæ‹’ç»ä»»åŠ¡çš„å¤„ç†çš„è‡ªå®šæ–¹æ³•çš„æœºä¼šã€‚åœ¨ThreadPoolExecutorä¸­å·²ç»é»˜è®¤åŒ…å«äº†4ä¸­ç­–ç•¥ï¼Œå› ä¸ºæºç éå¸¸ç®€å•ï¼Œè¿™é‡Œç›´æ¥è´´å‡ºæ¥ã€‚</p>

<p>CallerRunsPolicyï¼šçº¿ç¨‹è°ƒç”¨è¿è¡Œè¯¥ä»»åŠ¡çš„ execute æœ¬èº«ã€‚æ­¤ç­–ç•¥æä¾›ç®€å•çš„åé¦ˆæ§åˆ¶æœºåˆ¶ï¼Œèƒ½å¤Ÿå‡ç¼“æ–°ä»»åŠ¡çš„æäº¤é€Ÿåº¦ã€‚</p>

<p>public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {
           if (!e.isShutdown()) {
               r.run();
           }
       }
è¿™ä¸ªç­–ç•¥æ˜¾ç„¶ä¸æƒ³æ”¾å¼ƒæ‰§è¡Œä»»åŠ¡ã€‚ä½†æ˜¯ç”±äºæ± ä¸­å·²ç»æ²¡æœ‰ä»»ä½•èµ„æºäº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä½¿ç”¨è°ƒç”¨è¯¥executeçš„çº¿ç¨‹æœ¬èº«æ¥æ‰§è¡Œã€‚</p>

<p>AbortPolicyï¼šå¤„ç†ç¨‹åºé­åˆ°æ‹’ç»å°†æŠ›å‡ºè¿è¡Œæ—¶RejectedExecutionException</p>

<p>public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {
           throw new RejectedExecutionException();
       }
 è¿™ç§ç­–ç•¥ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œä¸¢å¼ƒä»»åŠ¡ã€‚</p>

<p>DiscardPolicyï¼šä¸èƒ½æ‰§è¡Œçš„ä»»åŠ¡å°†è¢«åˆ é™¤</p>

<p>public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {
       }
 è¿™ç§ç­–ç•¥å’ŒAbortPolicyå‡ ä¹ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œåªä¸è¿‡ä»–ä¸æŠ›å‡ºå¼‚å¸¸ã€‚</p>

<p>DiscardOldestPolicyï¼šå¦‚æœæ‰§è¡Œç¨‹åºå°šæœªå…³é—­ï¼Œåˆ™ä½äºå·¥ä½œé˜Ÿåˆ—å¤´éƒ¨çš„ä»»åŠ¡å°†è¢«åˆ é™¤ï¼Œç„¶åé‡è¯•æ‰§è¡Œç¨‹åºï¼ˆå¦‚æœå†æ¬¡å¤±è´¥ï¼Œåˆ™é‡å¤æ­¤è¿‡ç¨‹ï¼‰</p>

<p>public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {
           if (!e.isShutdown()) {
               e.getQueue().poll();
               e.execute(r);
           }
       }
è¯¥ç­–ç•¥å°±ç¨å¾®å¤æ‚ä¸€äº›ï¼Œåœ¨poolæ²¡æœ‰å…³é—­çš„å‰æä¸‹é¦–å…ˆä¸¢æ‰ç¼“å­˜åœ¨é˜Ÿåˆ—ä¸­çš„æœ€æ—©çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•è¿è¡Œè¯¥ä»»åŠ¡ã€‚è¿™ä¸ªç­–ç•¥éœ€è¦é€‚å½“å°å¿ƒã€‚</p>

<p>è®¾æƒ³:å¦‚æœå…¶ä»–çº¿ç¨‹éƒ½è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆæ–°æ¥ä»»åŠ¡è¸¢æ‰æ—§ä»»åŠ¡ï¼Œç¼“å­˜åœ¨queueä¸­ï¼Œå†æ¥ä¸€ä¸ªä»»åŠ¡åˆä¼šè¸¢æ‰queueä¸­æœ€è€ä»»åŠ¡ã€‚</p>

<p>æ€»ç»“ï¼š</p>

<p>keepAliveTimeå’ŒmaximumPoolSizeåŠBlockingQueueçš„ç±»å‹å‡æœ‰å…³ç³»ã€‚å¦‚æœBlockingQueueæ˜¯æ— ç•Œçš„ï¼Œé‚£ä¹ˆæ°¸è¿œä¸ä¼šè§¦å‘maximumPoolSizeï¼Œè‡ªç„¶keepAliveTimeä¹Ÿå°±æ²¡æœ‰äº†æ„ä¹‰ã€‚</p>

<p>åä¹‹ï¼Œå¦‚æœæ ¸å¿ƒæ•°è¾ƒå°ï¼Œæœ‰ç•ŒBlockingQueueæ•°å€¼åˆè¾ƒå°ï¼ŒåŒæ—¶keepAliveTimeåˆè®¾çš„å¾ˆå°ï¼Œå¦‚æœä»»åŠ¡é¢‘ç¹ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šé¢‘ç¹çš„ç”³è¯·å›æ”¶çº¿ç¨‹ã€‚</p>

<p>public static ExecutorService newFixedThreadPool(int nThreads) {
       return new ThreadPoolExecutor(nThreads, nThreads,
                                     0L, TimeUnit.MILLISECONDS,
                                     new LinkedBlockingQueue<Runnable>());
   }</Runnable></p>
:ET