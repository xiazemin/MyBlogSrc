I"!<p>åœ¨linuxä¸­æ¯ä¸ªè¿›ç¨‹æœ‰ä¸‰ä¸ª[å®é™…ä¸Šæœ‰ç¬¬4ä¸ª]ç”¨æˆ·æ ‡è¯†ç¬¦.
real uid : çœŸå®ç”¨æˆ·ID.  saved uid : å·²ä¿å­˜ç”¨æˆ·ID , effective uid : æœ‰æ•ˆç”¨æˆ·ID
çœŸå®ç”¨æˆ·ID(real uid)æ˜¯loginæ—¶çš„ç”¨æˆ·.è€Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­,ç”¨äºæ‰€æœ‰çš„å®‰å…¨æ£€æŸ¥çš„æ˜¯æœ‰æ•ˆç”¨æˆ·ID(effective uid).
ä¸€èˆ¬æƒ…å†µä¸‹:real uid = saved uid = effective uidåœ¨æŸäº›åœºåˆä¸‹,ä½¿ç”¨ç”¨setuid,setruidå‡½æ•°å¯ä»¥æ”¹å˜effective uid,ä»è€Œä½¿å¾—ç¨‹åºè¿è¡Œæ—¶å…·æœ‰ç‰¹æ®Šçš„æƒé™.å¸¸è§çš„ä¾‹å­æ˜¯linuxç³»ç»Ÿä¸­çš„passwdå‘½ä»¤,ç”±äºæ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯åŒ…æ‹¬ç”¨æˆ·å¯†ç éƒ½ä¿å­˜åœ¨/etc/passwdæ–‡ä»¶ä¸­,è€Œ/etc/passwdæ–‡ä»¶åªæœ‰rootæƒé™å¯ä»¥è¯»å†™,è‹¥æƒ³è®©æ¯ä¸ªç”¨æˆ·éƒ½åªå¯ä»¥ä¿®æ”¹è‡ªå·±çš„å¯†ç ,å°±å¿…é¡»è®©æ™®é€šç”¨æˆ·æš‚æ—¶è·å¾—æœ‰é™çš„è¯»å†™/etc/passwdçš„æƒé™.ç”¨setuidå°±å¯ä»¥è§£å†³è¿™ä¸ª
é—®é¢˜.
Linux setuid(uid)å‡½æ•°:
(1)å¦‚æœç”±æ™®é€šç”¨æˆ·è°ƒç”¨,å°†å½“å‰è¿›ç¨‹çš„æœ‰æ•ˆIDè®¾ç½®ä¸ºuid.
(2)å¦‚æœç”±æœ‰æ•ˆç”¨æˆ·IDç¬¦ä¸º0çš„è¿›ç¨‹è°ƒç”¨,åˆ™å°†çœŸå®,æœ‰æ•ˆå’Œå·²ä¿å­˜ç”¨æˆ·IDéƒ½è®¾
ç½®ä¸ºuid.</p>

<p>Linuxçš„setuidå‡½æ•°å’ŒUnixä¸­çš„setuidå‡½æ•°çš„è¡Œä¸ºæ˜¯ä¸åŒçš„.
Unixä¸­.setuid(uid)å‡½æ•°çš„è¡Œä¸º:
(1)å¦‚æœè¿›ç¨‹æ²¡æœ‰è¶…çº§ç”¨æˆ·ç‰¹æƒ,ä¸”uidç­‰äºå®é™…ç”¨æˆ·IDæˆ–å·²ä¿å­˜ç”¨æˆ·ID,åˆ™åªå°†æœ‰æ•ˆçš„ç”¨æˆ·IDè®¾ç½®ä¸ºuid.å¦åˆ™è¿”å›é”™è¯¯.
(2)å¦‚æœè¿›ç¨‹æ˜¯æœ‰è¶…çº§ç”¨æˆ·ç‰¹æƒ,åˆ™å°†çœŸå®,æœ‰æ•ˆå’Œå·²ä¿å­˜ç”¨æˆ·è¡¨ç¤ºç¬¦éƒ½è®¾ç½®ä¸ºuid.</p>

<p>è¿™é‡Œä¸»è¦çš„åŒºåˆ«åœ¨äºæ™®é€šç”¨æˆ·è°ƒç”¨æ—¶çš„è¡Œä¸º.äº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯POSIXå’ŒBSDçš„å®ç°å·®å¼‚,è€Œlinuxå´åŒæ—¶æ”¯æŒè¿™ä¸¤è€….BSDä¸­ä½¿ç”¨setreuid(uid_truid, uid_t euid)æ¥è®¾å®šçœŸå®ç”¨æˆ·ID(real uid)å’Œæœ‰æ•ˆç”¨æˆ·ID(effective uid).è¿™ä¸ªå‡½æ•°åœ¨ç”±æœ‰æ•ˆç”¨æˆ·IDç¬¦ä¸º0çš„è¿›ç¨‹è°ƒç”¨æ—¶,ä¸ä¼šæ”¹å˜å·²ä¿å­˜ç”¨æˆ·ID.å‡½æ•°seteuid(uid_t uid)ç­‰ä»·äºsetreuid(-1,uid),åªæ”¹å˜æœ‰æ•ˆç”¨æˆ·ID(effective uid).</p>

<p>å‡½æ•°å£°æ˜ï¼š</p>

<p>#include <unistd.h></unistd.h></p>

<p>#include &lt;sys/types.h&gt;</p>

<p>uid_t getuid(void);</p>

<p>uid_t geteuid(void);</p>

<p>è¯´æ˜ï¼š</p>

<p>ä¸¤ä¸ªå‡½æ•°åˆ†åˆ«è·å¾—ç”¨æˆ· UIDå€¼( getuid() ) ä¸ ç”¨æˆ·æœ‰æ•ˆ UID å€¼ ( geteuid())ã€‚</p>

<p>æµ‹è¯•ç¨‹åº(ç”¨ root ç”¨æˆ·åˆ›å»ºç¼–è¯‘å¹¶åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶)ï¼š</p>

<p>#include <stdio.h></stdio.h></p>

<p>#include <unistd.h></unistd.h></p>

<p>#include <fcntl.h></fcntl.h></p>

<p>#include <errno.h></errno.h></p>

<p>#include <stdlib.h></stdlib.h></p>

<p>int main()</p>

<p>{</p>

<p>int fd;</p>

<p>printf(â€œuid study: \nâ€);</p>

<p>printf(â€œProcessâ€™s uid = %d, euid = %d â€œ, getuid(), geteuid());</p>

<p>if( (fd =open(â€œtest.txtâ€, O_RDWR)) == -1 )</p>

<p>{</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   printf("Open failure, errno is %d :%s \n",errno,strerror(errno));

   exit(1);
</code></pre></div></div>

<p>}</p>

<p>Else</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{

   printf("Open successfully!\n");

}
</code></pre></div></div>

<p>close(fd);</p>

<p>exit(0);</p>

<p>}
<!-- more -->
geteuid()ç”¨æ¥å–å¾—æ‰§è¡Œç›®å‰è¿›ç¨‹æœ‰æ•ˆçš„ç”¨æˆ·è¯†åˆ«ç ã€‚æœ‰æ•ˆçš„ç”¨æˆ·è¯†åˆ«ç ç”¨æ¥å†³å®šè¿›ç¨‹æ‰§è¡Œçš„æƒé™ï¼Œå€Ÿç”±æ­¤æ”¹å˜æ­¤å€¼ï¼Œè¿›ç¨‹å¯ä»¥è·å¾—é¢å¤–çš„æƒé™ã€‚å€˜è‹¥æ‰§è¡Œæ–‡ä»¶çš„setIDä½å·²è¢«è®¾ç½®ï¼Œè¯¥æ–‡ä»¶æ‰§è¡Œæ—¶ï¼Œå…¶è¿›ç¨‹çš„euidå€¼ä¾¿ä¼šè®¾æˆè¯¥æ–‡ä»¶æ‰€æœ‰è€…çš„uidã€‚ä¾‹å¦‚ï¼Œæ‰§è¡Œæ–‡ä»¶/usr/bin/passwdçš„æƒé™ä¸º-r-sâ€“xâ€“xï¼Œå…¶sä½å³ä¸ºsetIDï¼ˆSUIDï¼‰ä½ï¼Œè€Œå½“ä»»ä½•ç”¨æˆ·åœ¨æ‰§è¡Œpasswdæ—¶å…¶æœ‰æ•ˆçš„ç”¨æˆ·è¯†åˆ«ç ä¼šè¢«è®¾æˆpasswdæ‰€æœ‰è€…çš„uidå€¼ï¼Œå³rootçš„uidå€¼ï¼ˆ0ï¼‰ã€‚è¿”å›æœ‰æ•ˆçš„ç”¨æˆ·è¯†åˆ«ç ã€‚</p>
:ET