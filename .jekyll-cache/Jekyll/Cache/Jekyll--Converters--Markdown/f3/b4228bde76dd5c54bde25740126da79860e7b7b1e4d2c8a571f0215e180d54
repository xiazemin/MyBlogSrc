I"¾<p>https://gocn.vip/topics/10265
<!-- more -->
ç›¸ä¿¡å„ä½å¼€å‘è€…å¯¹äºGraphQLå¸¦æ¥çš„å¥½å¤„å·²ç»éå¸¸æ¸…æ¥šï¼Œå¦‚æœå¯¹GraphQLå¾ˆé™Œç”Ÿçš„æœ‹å‹ä»¬ï¼Œå¯ä»¥ç›´æ¥å‚è€ƒä¹‹å‰ä½œè€…å†™çš„ä¸€ç¯‡ã€Goè¯­è¨€å®æˆ˜GraphQLã€ï¼Œå†…å®¹ä¼šè®²åˆ°ç”¨Goè¯­è¨€å®æˆ˜GraphQLæ¶æ„ï¼Œæ•™å¼€å‘è€…å¦‚ä½•æ’°å†™GraphQLæµ‹è¯•åŠä¸€äº›å¼€å‘å°æŠ€å·§ï¼Œä¸è¿‡å†…å®¹éƒ½æ˜¯ä»¥graphql-goæ¡†æ¶ä¸ºä¸»ã€‚è€Œæœ¬ç¯‡ä¸»é¢˜ä¼šè®²ä¸ºä»€ä¹ˆæˆ‘ä»graphql-goæ¡†æ¶è½¬æ¢åˆ°gqlgenã€‚</p>

<p>å‰è¨€
æˆ‘è‡ªå·±ç”¨graphql-goå†™äº†ä¸€äº›ä¸“æ¡ˆï¼Œä½†æ˜¯ç¢°åˆ°çš„é—®é¢˜å…¶å®ä¹Ÿä¸å°‘ï¼Œå¾ˆå¤šé—®é¢˜éƒ½å¯ä»¥åœ¨graphql-goä¸“æ¡ˆçš„Issueåˆ—è¡¨å†…éƒ½å¯ä»¥æ‰¾åˆ°ï¼Œè™½ç„¶æ­¤ä¸“æ¡ˆçš„Staræ•°é‡æ˜¯æœ€é«˜ï¼Œè®¨è®ºåº¦ä¹Ÿæ˜¯æœ€é«˜ï¼Œå¦‚æœåˆšå…¥é—¨GraphQLï¼Œéœ€è¦ç»ƒä¹ ï¼Œç”¨è¿™å¥—è§æ²¡å•¥é—®é¢˜ï¼Œæ¯”è¾ƒèµ„æ·±çš„å¼€å‘è€…ï¼Œå°±ä¸å»ºè®®é€‰è¿™å¥—äº†ï¼Œå…ˆæ¥çœ‹çœ‹åŠŸèƒ½æ¯”è¾ƒå›¾</p>

<p>å…¶ä¸­æœ‰å‡ é¡¹ç—›ç‚¹æ˜¯è®©æˆ‘ä¸»è¦è½¬æ¢çš„åŸå› :</p>

<p>æ•ˆèƒ½è€ƒé‡
åŠŸèƒ½å·®å¼‚
æ¶æ„ä¼˜å…ˆ
å¼ºå‹åˆ«
è‡ªåŠ¨äº§ç”Ÿç¨‹å¼ç 
åº•ä¸‹ä¸€ä¸€ä»‹ç»ä¸Šè¿°ç‰¹æ€§</p>

<p>æ•ˆèƒ½è€ƒé‡
æˆ‘è‡ªå·±å»ºç«‹æ•ˆèƒ½Benchamrkæ¥æ¯”è¾ƒå¸‚é¢ä¸Šå‡ å¥—GraphQLå¥—ä»¶golang-graphql-benchmark</p>

<p>graphql-go / graphqlç‰ˆæœ¬ï¼š v0.7.9
playlyfe / go-graphqlç‰ˆæœ¬ï¼šv0.0.0-20191219091308-23c3f22218ef
graph-gophers / graphql-goç‰ˆæœ¬ï¼šv0.0.0-20200200002002730-8334863f2c8b
samsarahq / thunderç‰ˆæœ¬ï¼šv0.5.0
99designs / gqlgenç‰ˆæœ¬ï¼š v0.11.3
è¯·æ±‚/ç§’
graphql-go	19004.92
å›¾çƒ	44308.44
é›·	40994.33
Gqlgen	49925.73
ç”±ä¸Šé¢å¯ä»¥çœ‹åˆ°å…‰æ˜¯ä¸€ä¸ªHello WorldèŒƒä¾‹ï¼Œæœ€åçš„ç»“æœç”±gqlgenèƒœå‡ºï¼Œç°åœ¨è®¨è®ºåº¦æ¯”è¾ƒé«˜çš„ä¹Ÿåªæœ‰gqlgenè·Ÿgrapgql-goï¼Œæ•ˆèƒ½ä¸Šé¢å·®å¼‚é¢‡å¤§ã€‚è¿™ç®—æ˜¯æˆ‘è½¬è¿‡å»çš„æœ€ä¸»è¦åŸå› ä¹‹ä¸€ã€‚</p>

<p>åŠŸèƒ½å·®å¼‚
å‡ ä¸ªé‡ç‚¹å·®å¼‚ï¼Œåº•ä¸‹çœ‹çœ‹æ¯”è¾ƒå›¾:</p>

<p>ç±»å‹å®‰å…¨
ç±»å‹ç»‘å®š
ä¸Šä¼ æ–‡ä»¶
ç­‰è›®å¤šç»†éƒ¨å·®å¼‚ï¼Œgraphql-goç›®å‰ä¸æ”¯æŒæ¡£æ¡ˆä¸Šä¼ ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦é€è¿‡RESTFul APIæ–¹å¼ä¸Šä¼ ï¼Œä½†æ˜¯å·²ç»æœ‰äººæè¿‡Issueä¸”å‘äº†PRï¼Œä½œè€…çœ‹èµ·æ¥æ²¡æœ‰æƒ³å¤„ç†è¿™é¢˜ã€‚å°±æ‹¿ä¸Šä¼ æ¡£æ¡ˆå½“åšä¾‹å­ï¼Œåœ¨gqlgenå†™æ¡£æ¡ˆä¸Šä¼ ç›¸å½“å®¹æ˜“ï¼Œå…ˆå†™schema</p>

<p>â€œThe <code class="language-plaintext highlighter-rouge">Upload</code> scalar type represents a multipart file upload.â€
scalar Upload</p>

<p>â€œThe <code class="language-plaintext highlighter-rouge">File</code> type, represents the response of uploading a file.â€
type File {
  name: String!
  contentType: String!
  size: Int!
  url: String!
}
å°±å¯ä»¥ç›´æ¥åœ¨ resolver ä½¿ç”¨:</p>

<p>type File struct {
    Name        string
    Size        int
    Content     []byte
    ContentType string
}</p>

<p>func (r <em>mutationResolver) getFile(file graphql.Upload) (</em>File, error) {
    content, err := ioutil.ReadAll(file.File)
    if err != nil {
        return nil, errors.EBadRequest(errorUploadFile, err)
    }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>contentType := ""
kind, _ := filetype.Match(content)
if kind != filetype.Unknown {
    contentType = kind.MIME.Value
}

if contentType == "" {
    contentType = http.DetectContentType(content)
}

return &amp;File{
    Name:        file.Filename,
    Size:        int(file.Size),
    Content:     content,
    ContentType: contentType,
}, nil } æ¶æ„ä¼˜å…ˆ åç«¯è®¾è®¡APIæ—¶éœ€è¦é’ˆå¯¹ä½¿ç”¨è€…æƒ…å¢ƒåŠDatabaseæ¶æ„æ¥è®¾è®¡GraphQL Schemaï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒSchema Definition Languageã€‚åº•ä¸‹å¯ä»¥æ‹¿ä½¿ç”¨è€…æ³¨å†Œæ¥å½“åšä¾‹å­:
</code></pre></div></div>

<p>enum EnumGender {
  MAN
  WOMAN
}</p>

<h1 id="input-types">Input Types</h1>
<p>input createUserInput {
  email: String!
  password: String!
  doctorCode: String
}</p>

<p>type createUserPayload {
  user: User
  actCode: String
  digitalCode: String
}</p>

<h1 id="types">Types</h1>
<p>type User {
  id: ID
  email: String!
  nickname: String
  isActive: Boolean
  isFirstLogin: Boolean
  avatarURL: String
  gender: EnumGender
}</p>

<p>type Mutation {
  createUser(input: createUserInput!): createUserPayload
}
é™¤äº†å¯ä»¥å…ˆå†™Schema ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ ¹æ®ä¸åŒæƒ…å¢ƒçš„åšåˆ†ç±»ï¼Œå°†ä¸€ä¸ªå®Œæ•´çš„Schema æ‹†æˆä¸åŒæ¨¡ç»„ï¼Œè¿™ä¸ªåœ¨gqlgen éƒ½å¯ä»¥å¾ˆå®¹æ˜“åšåˆ°ã€‚</p>

<p>resolver:
  layout: follow-schema
  dir: graph
ä¹‹ågqlgen ä¼šå°†ç›®å½•ç»“æ„äº§ç”Ÿå¦‚ä¸‹</p>

<p>user.graphql
user.resolver.go
cart.graphql
cart.resolver.go
å¼€å‘è€…åªè¦å°†ç›¸å¯¹åº”çš„resolver method å®ç°å‡ºæ¥å°±å¯ä»¥äº†ã€‚</p>

<p>å¼ºå‹åˆ«
å¦‚æœæœ‰åœ¨å†™graphql-goå°±å¯ä»¥çŸ¥é“è¯¥å¦‚ä½•å–å¾—ä½¿ç”¨è€…inputå‚æ•°ï¼Œåœ¨graphql-goä½¿ç”¨çš„æ˜¯map[string]interface{}å‹æ€ï¼Œè¦æ­£ç¡®æ‹¿åˆ°å‚æ•°å€¼ï¼Œå°±å¿…é¡»è¦è½¬æ¢å‹æ€</p>

<p>username := strings.ToLower(p.Args[â€œusernameâ€].(string))
password := p.Args[â€œpasswordâ€].(string)
å¤šäº†ä¸€å±‚è½¬æ¢ç›¸å½“å¤æ‚ï¼Œè€Œgqlgen åˆ™æ˜¯ç›´æ¥å¸®å¿™è½¬æˆstruct å¼ºå‹åˆ«</p>

<p>CreateUser(ctx context.Context, input model.CreateUserInput)
å…¶ä¸­model.CreateUserInputå°±æ˜¯å®Œæ•´çš„structï¼Œè€Œå¹¶éæ˜¯map[string]interface{}ï¼Œåœ¨ä¼ é€’å‚æ•°æ—¶ï¼Œå°±ä¸ç”¨å¤šå†™å¤ªå¤šinterfaceè½¬æ¢ï¼Œå®Œæ•´çš„æ³¨å†Œæµç¨‹å¯ä»¥å‚è€ƒåº•ä¸‹:</p>

<p>func (r <em>mutationResolver) CreateUser(ctx context.Context, input model.CreateUserInput) (</em>model.CreateUserPayload, error) {
    resp, err := api.CreateUser(r.Config, api.ReqCreateUser{
        Email:      input.Email,
        Password:   input.Password,
    })</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if err != nil {
    return nil, err
}

return &amp;model.CreateUserPayload{
    User:        resp.User,
    DigitalCode: convert.String(resp.DigitalCode),
    ActCode:     convert.String(resp.ActCode),
}, nil } è‡ªåŠ¨äº§ç”Ÿä»£ç  è¦ç»´æŠ¤æ ä½éå¸¸å¤šçš„Schema ç›¸å½“ä¸å®¹æ˜“ï¼Œåœ¨graphql-go æ¯æ¬¡æ”¹åŠ¨æ ä½ï¼Œéƒ½éœ€è¦å¼€å‘è€…è‡ªè¡Œä¿®æ”¹ï¼Œåº•ä¸‹æ˜¯user type èŒƒä¾‹:
</code></pre></div></div>

<p>var userType = graphql.NewObject(graphql.ObjectConfig{
    Name:        â€œUserTypeâ€,
    Description: â€œUser Typeâ€,
    Fields: graphql.Fields{
        â€œidâ€: &amp;graphql.Field{
            Type: graphql.ID,
        },
        â€œemailâ€: &amp;graphql.Field{
            Type: graphql.String,
        },
        â€œusernameâ€: &amp;graphql.Field{
            Type: graphql.String,
        },
        â€œnameâ€: &amp;graphql.Field{
            Type: graphql.String,
        },
        â€œisAdminâ€: &amp;graphql.Field{
            Type: graphql.Boolean,
            Resolve: func(p graphql.ResolveParams) (interface{}, error) {
                source := p.Source
                o, ok := source.(*model.User)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            if !ok {
                return false, nil
            }

            return o.CheckAdmin(), nil
        },
    },
    "isNewcomer": &amp;graphql.Field{
        Type: graphql.Boolean,
    },
    "createdAt": &amp;graphql.Field{
        Type: graphql.DateTime,
    },
    "updatedAt": &amp;graphql.Field{
        Type: graphql.DateTime,
    },
}, }) ä¸Šé¢è¿™æ®µç¨‹å¼ç æ˜¯è¦é å¼€å‘è€…è‡ªè¡Œç»´æŠ¤ï¼Œåªè¦æœ‰ä»»ä½•å¼‚åŠ¨ï¼Œéƒ½éœ€è¦æ‰‹åŠ¨è‡ªè¡Œä¿®æ”¹ï¼Œä½†æ˜¯åœ¨gqlgen å°±ä¸éœ€è¦äº†ï¼Œä½ åªè¦æŠŠschema å®šä¹‰å®Œæ•´åï¼Œå¦‚ä¸‹:
</code></pre></div></div>

<p>type User {
  id: ID
  email: String!
  username: String
  isAdmin: Boolean
  isNewcomer: Boolean
  createdAt: Time
  updatedAt: Time
}
åœ¨consoleç«¯ä¸‹go run github.com/99designs/gqlgenï¼Œå°±ä¼šè‡ªåŠ¨å°†ä»£ç ç”Ÿæˆå®Œæ¯•ã€‚ä½ ä¹Ÿå¯ä»¥å°†Userç»‘å®šåœ¨å¼€å‘è€…è‡ªå·±å®šä¹‰çš„Modelå±‚çº§ã€‚</p>

<p>models:
  User:
    model: pkg/model.User
ä¹‹åéœ€è¦æ–°å¢ä»»ä½•æ ä½ï¼Œåªè¦åœ¨pkg/model.Useræä¾›ç›¸å¯¹åº”çš„æ ä½æˆ–methodï¼Œé‡è·‘ä¸€æ¬¡gqlgenå°±å®Œæˆäº†ã€‚çœä¸‹è¶…å¤šå¼€å‘æ—¶é—´ã€‚</p>

<p>å¿ƒå¾—
å…¶å®graphql-go é›·çš„åœ°æ–¹ä¸åªæœ‰è¿™äº›ï¼Œè¿˜æœ‰å¾ˆå¤šåœ°æ–¹æ²¡æœ‰åˆ—å‡ºï¼Œä½†æ˜¯ä¸Šé¢çš„gqlgen ä¼˜åŠ¿ï¼Œå·²ç»è¶³ä»¥è®©æˆ‘è½¬æ¢åˆ°æ–°çš„æ¶æ„ä¸Šã€‚è€Œåœ¨ä¸“æ¡ˆæ–°çš„æ¶æ„ä¸Šï¼Œä¹ŸåŒæ—¶å…·å¤‡RESTFul API + GraphQL è®¾è®¡ï¼Œå¦‚æœæœ‰æ—¶é—´å†è·Ÿå¤§å®¶åˆ†äº«è¿™éƒ¨åˆ†ã€‚</p>

<p>https://blog.wu-boy.com/2020/04/switch-graphql-go-to-gqlgen-in-golang/</p>
:ET