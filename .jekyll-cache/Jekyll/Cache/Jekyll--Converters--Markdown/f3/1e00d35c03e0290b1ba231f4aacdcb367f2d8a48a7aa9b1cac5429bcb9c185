I"¸~<p>ä¸€ã€gflagsæ˜¯ä»€ä¹ˆ</p>

<p>gflagsæ˜¯googleçš„ä¸€ä¸ªå¼€æºçš„å¤„ç†å‘½ä»¤è¡Œå‚æ•°çš„åº“ï¼Œä½¿ç”¨c++å¼€å‘ï¼Œå…·å¤‡pythonæ¥å£ã€‚</p>

<p>äºŒã€ä¸‹è½½å®‰è£…</p>

<p>1.ä¸‹è½½ï¼šhttps://gflags.github.io/gflags/</p>

<p>2.è§£å‹å®‰è£…</p>

<p>tar zxvf gflags-2.0.tar.gz &amp;&amp; cd gflags-2.0 &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install</p>

<p>è¿™æ—¶ gflags åº“ä¼šé»˜è®¤å®‰è£…åœ¨ /usr/local/lib/ ä¸‹ï¼Œå¤´æ–‡ä»¶æ”¾åœ¨ /usr/local/include/gflags/ ä¸­ã€‚</p>

<p>ä¸‰ã€gflagsæ”¯æŒä»¥ä¸‹ç±»å‹</p>

<p>å°†éœ€è¦çš„å‘½ä»¤è¡Œå‚æ•°ä½¿ç”¨gflagsçš„å®ï¼ŒDEFINE_xxxxx(å˜é‡åï¼Œé»˜è®¤å€¼ï¼Œhelp-string) å®šä¹‰åœ¨æ–‡ä»¶å½“ä¸­ã€‚</p>

<p>DEFINE_bool: boolean
DEFINE_int32: 32-bit integer
DEFINE_int64: 64-bit integer
DEFINE_uint64: unsigned 64-bit integer
DEFINE_double: double
DEFINE_string: C++ string</p>

<p>å››ã€è‹¥éœ€è¦åœ¨å…¶å®ƒæ–‡ä»¶ä¸­ä½¿ç”¨gflagsçš„å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨å®å®šä¹‰å£°æ˜ä¸‹ï¼šDECLARE_xxx(å˜é‡å)ï¼Œä¹‹ååœ¨ä»£ç ä¸­ä¾¿å¯ä»¥ä½¿ç”¨FLAGS_XXXæ ¼å¼ä½¿ç”¨å‘½ä»¤è¡Œçš„å‚æ•°äº†ã€‚</p>

<p>äº”ã€å®šåˆ¶è‡ªå·±çš„helpå’Œversionä¿¡æ¯</p>

<p>versionä¿¡æ¯ï¼šä½¿ç”¨google::SetVersionString(const std::string&amp; usage)è®¾å®šï¼Œä½¿ç”¨google::VersionStringè®¿é—®
helpä¿¡æ¯ï¼šä½¿ç”¨google::SetUsageMessage(const std::string&amp; usage)è®¾å®šï¼Œä½¿ç”¨google::ProgramUsageè®¿é—®
æ³¨æ„ï¼šgoogle::SetUsageMessageå’Œgoogle::SetVersionStringå¿…é¡»åœ¨google::ParseCommandLineFlagsä¹‹å‰æ‰§è¡Œ
     ä¸€èˆ¬åœ¨mainå‡½æ•°çš„å¤´å‡ è¡Œç¼–å†™è¿™äº›ä¿¡æ¯ã€‚</p>

<p>å…­ã€ç‰¹æ®Šçš„flags</p>

<p>â€“flagfileï¼šâ€“flagfile=f å‘Šè¯‰commandlineflagsä»è¿™ä¸ªæ–‡ä»¶ä¸­è¯»å–å‡ºæ‰€æœ‰çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œfæ–‡ä»¶åº”è¯¥æœ‰ç‰¹æ®Šçš„æ ¼å¼è¦æ±‚ï¼Œæ˜¯ä¸€ä¸ªå‚æ•°çš„listï¼Œæ¯è¡Œä¸€ä¸ªå‚æ•°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>

<p>â€“languages=english</p>

<p>ï¼ˆæ›´è¯¦ç»†çš„ä»‹ç»è¯·å‚è€ƒå®˜ç½‘ https://gflags.github.io/gflags/ï¼‰
<!-- more -->
#include <iostream>
#include &lt;gflags/gflags.h&gt;
using namespace std;
using namespace google;</iostream></p>

<p>DEFINE_string(host, â€œ127.0.0.1â€, â€œthe server portâ€); 
DEFINE_int32(port, 9090, â€œprogram listen portâ€);
DEFINE_bool(sign, true, â€œswitch modeâ€);</p>

<p>static std::string g_version;
static std::string g_help;</p>

<p>std::string&amp; getVersion() {
    g_version = â€œ0.1â€;
    return g_version;
}</p>

<p>std::string&amp; getHelp() {
    g_help = â€œhelp infoâ€;
    return g_help;
}</p>

<p>int main(int argc, char** argv) {
    google::SetVersionString(getVersion());
    google::SetUsageMessage(getHelp());
    google::ParseCommandLineFlags(&amp;argc, &amp;argv, true);
    cout Â«Â â€œhost = â€œ Â«Â FLAGS_host Â«Â endl;
    cout Â«Â â€œport = â€œ Â«Â FLAGS_port Â«Â endl;
    if (FLAGS_sign) {
      cout Â«Â â€œsign is true â€¦â€ Â«Â endl;
    } <br />
    else {
      cout Â«Â â€œsign is false â€¦â€ Â«Â endl;
    } <br />
    google::ShutDownCommandLineFlags();
    return 0;
}</p>

<p>ç¼–è¯‘ï¼Œä½¿ç”¨makefile</p>

<p>GFLAGS_DIR = /usr/local/include/gflags/
LIB_DIR = /usr/local/lib/
a.out: simple_flags.cpp
        g++ -I${GFLAGS_DIR} -L${LIB_DIR} simple_flags.cpp -lgflags
clean:
        $(RM) -r a.out
æ‰§è¡Œï¼Œä¸ç»™å‚æ•°ï¼š</p>

<p>./a.out</p>

<p>host = 127.0.0.1
port = 9090
sign is true â€¦
ç»™å‚æ•°ï¼š</p>

<p>./a.out -host 172.168.16.8 -port 2356</p>

<p>host = 172.168.16.8
port = 2356
sign is true â€¦
ä½¿ç”¨æ–‡ä»¶file,æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>

<p>â€“host=172.16.12.10
â€“port=8955
â€“sign=false
 æ‰§è¡Œï¼š
./a.out â€“flagfile=flag</p>

<p>host = 172.16.12.10
port = 8955
sign is false â€¦
æŸ¥çœ‹versionå’Œhelpä¿¡æ¯ï¼š
./a.out -version</p>

<p>a.out version 0.1</p>

<p>./a.out -help</p>

<p>a.out: help info</p>

<p>Flags from simple_flags.cpp:
    -host (the server port) type: string default: â€œ127.0.0.1â€
    -port (program listen port) type: int32 default: 9090
    -sign (switch mode) type: bool default: true</p>

<p>Flags from src/gflags.cc:
    -flagfile (load flags from file) type: string default: â€œâ€
    -fromenv (set flags from the environment [use â€˜export FLAGS_flag1=valueâ€™])
      type: string default: â€œâ€
    -tryfromenv (set flags from the environment if present) type: string
      default: â€œâ€
    -undefok (comma-separated list of flag names that it is okay to specify on
      the command line even if the program does not define a flag with that
      name.  IMPORTANT: flags in this list that have arguments MUST use the
      flag=value format) type: string default: â€œâ€</p>

<p>Flags from src/gflags_completions.cc:
    -tab_completion_columns (Number of columns to use in output for tab
      completion) type: int32 default: 80
    -tab_completion_word (If non-empty, HandleCommandLineCompletions() will
      hijack the process and attempt to do bash-style command line flag
      completion on this value.) type: string default: â€œâ€</p>

<p>Flags from src/gflags_reporting.cc:
    -help (show help on all flags [tip: all flags can have two dashes])
      type: bool default: false currently: true
    -helpfull (show help on all flags â€“ same as -help) type: bool
      default: false
    -helpmatch (show help on modules whose name contains the specified substr)
      type: string default: â€œâ€
    -helpon (show help on the modules named by this flag value) type: string
      default: â€œâ€
    -helppackage (show help on all modules in the main package) type: bool
      default: false
    -helpshort (show help on only the main module for this program) type: bool
      default: false
    -helpxml (produce an xml version of help) type: bool default: false
    -version (show version and build info and exit) type: bool default: false</p>

<p>å…«ã€å¤šæ–‡ä»¶å¼•ç”¨ï¼ˆDECLARE_XXXä½¿ç”¨ï¼‰</p>

<p>gflagdef.hæ–‡ä»¶</p>

<p>å¤åˆ¶ä»£ç 
1 #ifndef <em>GFLAG_DEF_H</em>
2 #define <em>GFLAG_DEF_H</em>
3 #include &lt;gflags/gflags.h&gt;
4 
5 DECLARE_int32(port);
6 DECLARE_string(host);
7 DECLARE_bool(sign);
8 
9 #endif
å¤åˆ¶ä»£ç </p>

<p>gflagdef.cppæ–‡ä»¶</p>

<p>#include &lt;gflags/gflags.h&gt;
DEFINE_int32(port, 9001, â€œThe server portâ€);
DEFINE_string(host, â€œ127.0.0.1â€, â€œlisten portâ€);
DEFINE_bool(sign, true, â€œswitch modeâ€);</p>

<p>main.cppæ–‡ä»¶</p>

<p>å¤åˆ¶ä»£ç 
#include <iostream>
#include "gflagdef.h"
using namespace std;
int main(int argc, char** argv) {
    google::ParseCommandLineFlags(&amp;argc, &amp;argv, true);
    cout &lt;&lt; "host = " &lt;&lt; FLAGS_host &lt;&lt; endl;
    cout &lt;&lt; "port = " &lt;&lt; FLAGS_port &lt;&lt; endl;
    if (FLAGS_sign) {
        cout &lt;&lt; "sign is true ..." &lt;&lt; endl;
    }   
    else {
        cout &lt;&lt; "sign is false ..." &lt;&lt; endl;
    }   
    google::ShutDownCommandLineFlags();
    return 0;
}
å¤åˆ¶ä»£ç </iostream></p>

<p>makefileæ–‡ä»¶
GFLAGS_DIR = /usr/local/include/gflags/
LIB_DIR = /usr/local/lib/
main: main.o flag.o
        g++ main.o flag.o -o main -lgflags
main.o: main.cpp
        g++ -c -I${GFLAGS_DIR} -L${LIB_DIR} main.cpp -lgflags -o main.o
flag.o: gflagdef.cpp
        g++ -c -I${GFLAGS_DIR} -L${LIB_DIR} gflagdef.cpp -lgflags -o flag.o
clean:
        $(RM) -r main *.o</p>

<p>ç¼–è¯‘&amp;&amp;æ‰§è¡Œï¼šmake&amp;&amp;./main</p>

<p>host = 127.0.0.1
port = 9001
sign is true .
googleå¼€æºçš„gflagsæ˜¯å¾ˆå¥½çš„å¯é…ç½®å‚æ•°é€‰é¡¹ï¼Œä¸ä½†å¯ä»¥ä»£æ›¿ä¼ ç»Ÿçš„getopt ï¼Œä¸ªäººè§‰å¾—æœ€å¥½çš„åœ°æ–¹åœ¨äºå®šä¹‰ä¸€æ¬¡å‚æ•°é€‰é¡¹ï¼Œå…¶å®ƒéœ€è¦ä½¿ç”¨gflagsçš„ç¨‹åºæ¨¡å—å¯ä»¥ç›´æ¥å¼•ç”¨ï¼Œ</p>

<p>è€Œå¼•ç”¨çš„æ–¹å¼åªéœ€è¦å£°æ˜ä¸€ä¸‹å¯¹åº”çš„å‚æ•°å³å¯</p>

<p>ç®€å•çš„ä¾‹å­å¦‚ä¸‹,å…¶ä¸­æ ‡çº¢çš„å°±æ˜¯ç¨‹åºä½¿ç”¨æŸä¸ªå‚æ•°å˜é‡çš„å¼•ç”¨æ–¹æ³•</p>

<p>(a.cpp)</p>

<p>#include &lt;gflags/gflags.h&gt;</p>

<p>#include â€¦â€¦.</p>

<p>DEFINE_string(log_path, â€œ../logs/â€,â€log pathâ€);</p>

<p>int main(int argc, char **argv) {</p>

<p>Â Â Â Â Â Â Â  ::google::ParseCommandLineFlags(&amp;argc, &amp;argv, true);
Â Â Â 
Â Â Â Â Â Â Â  std::string log_error = FLAGS_log_path + â€œ/error.â€;
Â Â Â Â Â 
Â Â Â Â Â Â Â  ::google::SetLogDestination(::google::ERROR, (FLAGS_log_path + â€œ/error.â€).c_str());
Â Â Â 
Â Â Â Â Â Â Â  LOG(INFO) Â«Â â€œstart process â€œ Â«Â argv[0];
Â Â Â Â Â Â Â  std::tr1::shared_ptr<CLS_PROC> pCLS_PROC(new CLS_PROC());
Â Â Â Â Â Â Â  bool ret_init = pCLS_PROC-&gt;_init();
Â Â Â Â Â Â Â  if(!ret_init){
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  LOG(INFO) &lt;&lt; "service break down!" &lt;&lt; argv[0];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return EXIT_FAILURE;
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  usleep(100);</CLS_PROC></p>

<p>Â Â Â Â Â Â Â  LOG(INFO) Â«Â â€œservice runningâ€¦â€;</p>

<p>Â Â Â Â Â Â Â  pCLS_PROC-&gt;_start();</p>

<p>Â Â Â Â Â Â Â  LOG(INFO) Â«Â â€œexit processâ€ Â«Â argv[0];
Â Â Â Â Â Â Â  return EXIT_SUCCESS;
}</p>

<p>(b.cpp)</p>

<p>è¿™é‡Œb.cppä¹Ÿéœ€è¦ä½¿ç”¨log_pathè¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥åªéœ€è¦ä¸€ä¸ªå£°æ˜å³å¯</p>

<p>#include &lt;gflags/gflags.h&gt;
#include â€¦..</p>

<p>DECLARE_string(log_path);</p>

<p>/*</p>

<p>è¿™é‡Œå¯ä»¥ç›´æ¥åƒa.cppä¸­ä¸€æ ·ç”¨FLAGS_log_pathæ¥å¼•ç”¨è¿™ä¸ªå‚æ•°</p>

<p>*/</p>

<p>googleå¼€æºçš„gflagsæ˜¯ä¸€å¥—å‘½ä»¤è¡Œå‚æ•°è§£æå·¥å…·ï¼Œæ¯”getoptåŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼Œgflagsè¿˜æ”¯æŒä»ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶è¯»å–å‚æ•°ï¼ˆå¯ç”¨gflagsä»£æ›¿é…ç½®æ–‡ä»¶ï¼‰ã€‚æœ¬æ–‡ç®€å•ä»‹ç»gflagsçš„ä½¿ç”¨ï¼Œå†…å®¹ä¸»è¦è¯‘è‡ªhttp://gflags.googlecode.com/svn/trunk/doc/gflags.html ã€‚</p>

<p>å®šä¹‰å‚æ•° 
ä½¿ç”¨flagséœ€è¦åŒ…å«å¤´æ–‡ä»¶  #include &lt;gflags/gflags.h&gt;
gflagsä¸»è¦æ”¯æŒçš„å‚æ•°ç±»å‹åŒ…æ‹¬boolï¼Œint32, int64, uint64, double, stringç­‰ï¼Œå®šä¹‰å‚æ•°é€šè¿‡DEFINE_typeå®å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œåˆ†åˆ«å®šä¹‰äº†ä¸€ä¸ªboolå’Œä¸€ä¸ªstringç±»å‹çš„å‚æ•°ï¼Œè¯¥å®çš„ä¸‰ä¸ªå‚æ•°å«ä¹‰åˆ†åˆ«ä¸ºå‘½ä»¤è¡Œå‚æ•°åï¼Œå‚æ•°é»˜è®¤å€¼ï¼Œä»¥åŠå‚æ•°çš„å¸®åŠ©ä¿¡æ¯ã€‚</p>

<p>DEFINE_bool(big_menu, true, â€œInclude â€˜advancedâ€™ options in the menu listingâ€); 
DEFINE_string(languages, â€œenglish,french,germanâ€, 
                 â€œcomma-separated list of languages to offer in the â€˜langâ€™ menuâ€); 
gflagä¸æ”¯æŒåˆ—è¡¨ï¼Œç”¨æˆ·é€šè¿‡çµæ´»å€ŸåŠ©stringå‚æ•°å®ç°ï¼Œæ¯”å¦‚ä¸Šè¿°çš„languageså‚æ•°ï¼Œå¯ä»¥ç±»å‹ä¸ºstringï¼Œä½†å¯çœ‹ä½œæ˜¯ä»¥é€—å·åˆ†å‰²çš„å‚æ•°åˆ—è¡¨ã€‚</p>

<p>è®¿é—®å‚æ•° 
å½“å‚æ•°è¢«å®šä¹‰åï¼Œé€šè¿‡FLAGS_nameå°±å¯è®¿é—®åˆ°å¯¹åº”çš„å‚æ•°ï¼Œæ¯”å¦‚ä¸Šè¿°å®šä¹‰çš„big_menuã€languagesä¸¤ä¸ªå‚æ•°å°±å¯é€šè¿‡FLAGS_big_menuã€FLAGS_languagesè®¿é—®ã€‚</p>

<p>if (FLAGS_languages.find(â€œenglishâ€) != string::npos) 
     HandleEnglish();</p>

<p>ä»¥ä¸Šçš„è®¿é—®æ–¹å¼ï¼Œä»…åœ¨å‚æ•°å®šä¹‰å’Œè®¿é—®åœ¨åŒä¸€ä¸ªæ–‡ä»¶ï¼ˆæˆ–æ˜¯é€šè¿‡å¤´æ–‡ä»¶åŒ…å«ï¼‰æ—¶ï¼ŒFLAGS_nameæ‰èƒ½è®¿é—®åˆ°å‚æ•°ï¼Œå¦‚æœè¦è®¿é—®å…¶ä»–æ–‡ä»¶é‡Œå®šä¹‰çš„å‚æ•°ï¼Œåˆ™éœ€è¦ä½¿ç”¨DECLARE_typeã€‚æ¯”å¦‚åœ¨foo.ccä¸­DEFINE_string(color, â€œredâ€, â€œthe color you want to useâ€); è¿™æ˜¯å¦‚æœä½ éœ€è¦åœ¨foo_test.ccä¸­ä½¿ç”¨colorè¿™ä¸ªå‚æ•°ï¼Œä½ éœ€è¦åŠ å…¥DECLARE_string(color, â€œredâ€, â€œthe color you want to useâ€);</p>

<p>å‚æ•°æ£€æŸ¥ 
å®šä¹‰å‚æ•°åï¼Œå¯ä»¥ç»™å‚æ•°æ³¨å†Œä¸€ä¸ªæ£€æŸ¥å‡½æ•°ï¼ˆvalidatorï¼‰ï¼Œå½“ä»å‘½ä»¤è¡ŒæŒ‡å®šå‚æ•°æˆ–é€šè¿‡SetCommandLineOption()æŒ‡å®šå‚æ•°æ—¶ï¼Œæ£€æŸ¥å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸ºå‘½ä»¤è¡Œå‚æ•°åï¼Œä»¥åŠè®¾ç½®çš„å‚æ•°å€¼ã€‚ 
static bool ValidatePort(const char* flagname, int32 value) { 
   if (value &gt; 0 &amp;&amp; value &lt; 32768)   // value is ok 
     return true; 
   printf(â€œInvalid value for â€“%s: %d\nâ€, flagname, (int)value); 
   return false; 
} 
DEFINE_int32(port, 0, â€œWhat port to listen onâ€); 
static const bool port_dummy = RegisterFlagValidator(&amp;FLAGS_port, &amp;ValidatePort); 
å»ºè®®åœ¨å®šä¹‰å‚æ•°åï¼Œç«‹å³æ³¨å†Œæ£€æŸ¥å‡½æ•°ã€‚RegisterFlagValidator()åœ¨æ£€æŸ¥å‡½æ•°æ³¨å†ŒæˆåŠŸæ—¶è¿”å›trueï¼›å¦‚æœå‚æ•°å·²ç»æ³¨å†Œäº†æ£€æŸ¥å‡½æ•°ï¼Œæˆ–è€…æ£€æŸ¥å‡½æ•°ç±»å‹ä¸åŒ¹é…ï¼Œè¿”å›falseã€‚</p>

<p>åˆå§‹åŒ–å‚æ•° 
åœ¨å¼•ç”¨ç¨‹åºçš„main()é‡Œé€šè¿‡ google::ParseCommandLineFlags(&amp;argc, &amp;argv, true); å³å®Œæˆå¯¹gflagså‚æ•°çš„åˆå§‹ï¼Œå…¶ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºremove_flagï¼Œå¦‚æœä¸ºtrueï¼Œgflagsä¼šç§»é™¤parseè¿‡çš„å‚æ•°ï¼Œå¦åˆ™gflagså°±ä¼šä¿ç•™è¿™äº›å‚æ•°ï¼Œä½†å¯èƒ½ä¼šå¯¹å‚æ•°é¡ºåºè¿›è¡Œè°ƒæ•´ã€‚ æ¯”å¦‚ â€œ/bin/fooâ€ â€œarg1â€ â€œ-qâ€ â€œarg2â€  ä¼šè¢«è°ƒæ•´ä¸º â€œ/bin/fooâ€, â€œ-qâ€, â€œarg1â€, â€œarg2â€ï¼Œè¿™æ ·æ›´å¥½ç†è§£ã€‚</p>

<p>åœ¨å‘½ä»¤è¡ŒæŒ‡å®šå‚æ•° 
æ¯”å¦‚è¦åœ¨å‘½ä»¤è¡ŒæŒ‡å®šlanguageså‚æ•°çš„å€¼ï¼Œå¯é€šè¿‡å¦‚ä¸‹4ç§æ–¹å¼ï¼Œint32, int64ç­‰ç±»å‹ä¸stringç±»ä¼¼ã€‚</p>

<p>app_containing_foo â€“languages=â€chinese,japanese,koreanâ€
app_containing_foo -languages=â€chinese,japanese,koreanâ€
app_containing_foo â€“languages â€œchinese,japanese,koreanâ€
app_containing_foo -languages â€œchinese,japanese,koreanâ€
å¯¹äºboolç±»å‹ï¼Œåˆ™å¯é€šè¿‡å¦‚ä¸‹å‡ ç§æ–¹å¼æŒ‡å®šå‚æ•°</p>

<p>app_containing_foo â€“big_menu
app_containing_foo â€“nobig_menu
app_containing_foo â€“big_menu=true
app_containing_foo â€“big_menu=false</p>

<p>ç‰¹æ®Šå‚æ•°</p>

<p>â€“help æ‰“å°å®šä¹‰è¿‡çš„æ‰€æœ‰å‚æ•°çš„å¸®åŠ©ä¿¡æ¯
â€“version æ‰“å°ç‰ˆæœ¬ä¿¡æ¯ é€šè¿‡google::SetVersionString()æŒ‡å®š
â€“nodefok  ä½†å‘½ä»¤è¡Œä¸­å‡ºç°æ²¡æœ‰å®šä¹‰çš„å‚æ•°æ—¶ï¼Œå¹¶ä¸é€€å‡ºï¼ˆerror-exitï¼‰
â€“fromenv ä»ç¯å¢ƒå˜é‡è¯»å–å‚æ•°å€¼ â€“fromenv=foo,barè¡¨æ˜è¦ä»ç¯å¢ƒå˜é‡è¯»å–fooï¼Œbarä¸¤ä¸ªå‚æ•°çš„å€¼ã€‚é€šè¿‡export FLAGS_foo=xxx; export FLAGS_bar=yyy ç¨‹åºå°±å¯è¯»åˆ°fooï¼Œbarçš„å€¼åˆ†åˆ«ä¸ºxxxï¼Œyyyã€‚
â€“tryfromenv ä¸â€“fromenvç±»ä¼¼ï¼Œå½“å‚æ•°çš„æ²¡æœ‰åœ¨ç¯å¢ƒå˜é‡å®šä¹‰æ—¶ï¼Œä¸é€€å‡ºï¼ˆfatal-exitï¼‰
â€“flagfile ä»æ–‡ä»¶è¯»å–å‚æ•°å€¼ï¼Œâ€“flagfile=my.confè¡¨æ˜è¦ä»my.confæ–‡ä»¶è¯»å–å‚æ•°çš„å€¼ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå‚æ•°å€¼ä¸åœ¨å‘½ä»¤è¡Œæ–¹å¼ç±»ä¼¼ï¼Œå¦å¤–åœ¨flagfileé‡Œå¯è¿›ä¸€æ­¥é€šè¿‡â€“flagfileæ¥åŒ…å«å…¶ä»–çš„æ–‡ä»¶ã€‚</p>

<p>ä¸€ã€ç®€ä»‹
gflagsæ˜¯Googleçš„ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°å¤„ç†çš„å¼€æºåº“ï¼Œä½¿ç”¨C++å¼€å‘ï¼Œå…·å¤‡Pythonæ¥å£ï¼Œå¯ä»¥æ›¿ä»£getoptã€‚gflagsæ”¯æŒä»ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶è¯»å–å‚æ•°ã€‚gflagsä½¿ç”¨èµ·æ¥æ¯”getoptæ–¹ä¾¿ï¼Œä½†æ˜¯ä¸æ”¯æŒå‚æ•°ç¼©å†™ï¼ˆä¾‹å¦‚getoptæ”¯æŒâ€“listç¼©å†™æˆ-lï¼Œgflagsä¸æ”¯æŒï¼‰ã€‚</p>

<p>gflagsä¸æ”¯æŒåˆ—è¡¨ï¼Œç”¨æˆ·å¯é€šè¿‡å€ŸåŠ©stringå‚æ•°å®ç°ï¼šå¯çœ‹ä½œä»¥é€—å·åˆ†éš”çš„å‚æ•°åˆ—è¡¨ï¼š</p>

<p>DEFINE_string(languages, â€œenglish, french, german, chineseâ€, â€œcomma-separated list of languages to offer in the â€˜langâ€™ menuâ€);
äºŒã€æºç è·å–
å¯ä»¥è®¿é—®å®˜ç½‘ä¸‹è½½å®‰è£…æœ€æ–°ç‰ˆæœ¬gflagsï¼š</p>

<p>https://code.google.com/p/gflags/</p>

<p>ä¹Ÿå¯ä»¥ä¸Šgithubè·å–ï¼ˆå¯¹äºå›½å†…è®¿é—®æ›´åŠ æ–¹ä¾¿ï¼‰ï¼š</p>

<p>https://github.com/gflags/gflags</p>

<p>å®‰è£…ä½¿ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼ˆæ‘˜è‡ªINSTALL.mdï¼‰ï¼š</p>

<p>è·å–å¹¶è§£å‹æºç ï¼›
åˆ›å»ºbuildç›®å½•å¹¶è¿›å…¥è¯¥ç›®å½•ï¼›
è¿è¡Œcmakeé…ç½®æ„å»ºæ ‘ï¼›
ä½¿ç”¨ç¼–è¯‘å·¥å…·ç¼–è¯‘æºç ï¼›
éªŒè¯ç¼–è¯‘åçš„åº“ï¼›
å®‰è£…å¹¶ä½¿ç”¨ã€‚
å¦‚æºç ç›®å½•ä¸‹INSTALL.mdæ‰€è¿°ï¼š</p>

<h1 id="compiling-the-source-code-with-cmake">Compiling the source code with CMake</h1>

<p>The build system of gflags is since version 2.1 based on <a href="http://cmake.org">CMake</a>.
The common steps to build, test, and install software are therefore:</p>

<ol>
  <li>Extract source files.</li>
  <li>Create build directory and change to it.</li>
  <li>Run CMake to configure the build tree.</li>
  <li>Build the software using selected build tool.</li>
  <li>Test the built software.</li>
  <li>Install the built files.</li>
</ol>

<p>On Unix-like systems with GNU Make as build tool, these build steps can be
summarized by the following sequence of commands executed in a shell,
where <code class="language-plaintext highlighter-rouge">$package</code> and <code class="language-plaintext highlighter-rouge">$version</code> are shell variables which represent
the name of this package and the obtained version of the software.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ tar xzf gflags-$version-source.tar.gz
$ cd gflags-$version
$ mkdir build &amp;&amp; cd build
$ ccmake ..

  - Press 'c' to configure the build system and 'e' to ignore warnings.
  - Set CMAKE_INSTALL_PREFIX and other CMake variables and options.
  - Continue pressing 'c' until the option 'g' is available.
  - Then press 'g' to generate the configuration files for GNU Make.

$ make
$ make test    (optional)
$ make install (optional)
</code></pre></div></div>

<p>ç¼–è¯‘çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ccmakeæ¥å¯è§†åŒ–çš„ä¿®æ”¹ç¼–è¯‘é€‰é¡¹å’Œå·¥å…·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡cmake â€“Dçš„æ–¹å¼æŒ‡å®šç¼–è¯‘é€‰é¡¹ã€‚å¸¸è§å¯ç”¨çš„ç¼–è¯‘é€‰é¡¹å¦‚ä¸‹ï¼š</p>

<p>CMake Option	Description
CMAKE_INSTALL_PREFIX	Installation directory, e.g., â€œ/usr/localâ€ on Unix and â€œC:\Program Files\gflagsâ€ on Windows.
BUILD_SHARED_LIBS	Request build of dynamic link libraries.
BUILD_STATIC_LIBS	Request build of static link libraries. Implied if BUILD_SHARED_LIBS is OFF.
BUILD_PACKAGING	Enable binary package generation using CPack.
BUILD_TESTING	Build tests for execution by CTest.
BUILD_NC_TESTS	Request inclusion of negative compilation tests (requires Python).
BUILD_CONFIG_TESTS	Request inclusion of package configuration tests (requires Python).
BUILD_gflags_LIBS	Request build of multi-threaded gflags libraries (if threading library found).
BUILD_gflags_nothreads_LIBS	Request build of single-threaded gflags libraries.
GFLAGS_NAMESPACE	Name of the C++ namespace to be used by the gflags library. Note that the public source header files are installed in a subdirectory named after this namespace. To maintain backwards compatibility with th
e Google Commandline Flags, set this variable to â€œgoogleâ€. The default is â€œgflagsâ€.
GFLAGS_INTTYPES_FORMAT | String identifying format of built-in integer types.
GFLAGS_INCLUDE_DIR | Name of headers installation directory relative to CMAKE_INSTALL_PREFIX.
LIBRARY_INSTALL_DIR | Name of library installation directory relative to CMAKE_INSTALL_PREFIX.
INSTALL_HEADERS | Request installation of public header files.</p>

<p>ä¸‰ã€ä½¿ç”¨æ–¹æ³•
3.1 åŒ…å«å¤´æ–‡ä»¶
åœ¨ä½¿ç”¨çš„æºä»£ç ä¸­ï¼ŒåŒ…å«å¦‚ä¸‹å¤´æ–‡ä»¶ï¼š</p>

<p>#include &lt;gflags/gflags.h&gt;
3.2 å‚æ•°å®šä¹‰
å°†éœ€è¦ä½¿ç”¨çš„å‘½ä»¤è¡Œå‚æ•°ä½¿ç”¨gflagsçš„å¦‚ä¸‹å®å®šä¹‰çš„å½¢å¼å…¨å±€å®šä¹‰åœ¨æ–‡æ¡£ä¸­ï¼Œæ³¨æ„æ˜¯å…¨å±€åŸŸï¼š</p>

<p>DEFINE_type(å˜é‡å, é»˜è®¤å€¼, help-string)
gflagsæ”¯æŒå¦‚ä¸‹ç±»å‹ï¼ˆå¦‚ä¸Štypeéƒ¨åˆ†ï¼‰ï¼š</p>

<p>DEFINE_bool: Boolean
DEFINE_int32: 32-bit integer
DEFINE_int64: 64-bit integer
DEFINE_uint64: unsigned 64-bit integer
DEFINE_double: double
DEFINE_string: C++ string
æ¯”å¦‚åˆ†åˆ«å®šä¹‰äº†ä¸€ä¸ªboolå’Œä¸€ä¸ªstringç±»å‹çš„å‚æ•°ï¼š</p>

<p>DEFINE_bool(big_menu, true, â€œInclude â€˜advancedâ€™ options in the menu listingâ€);
DEFINE_string(languages, â€œenglish, french, german, chineseâ€, â€œcomma-separated list of languages to offer in the â€˜langâ€™ menuâ€);
gflagsä¸æ”¯æŒåˆ—è¡¨ï¼Œç”¨æˆ·å¯é€šè¿‡å€ŸåŠ©stringå‚æ•°å®ç°ï¼Œæ¯”å¦‚ä¸Šé¢çš„languageså‚æ•°ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä»¥é€—å·åˆ†å‰²çš„å‚æ•°åˆ—è¡¨ã€‚</p>

<p>3.3 å‚æ•°å£°æ˜
å½“æˆ‘ä»¬éœ€è¦åœ¨å…¶ä»–æ–‡ä»¶ä¸­ä½¿ç”¨å‘½ä»¤è¡Œå®šä¹‰çš„flagså˜é‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨gflagsçš„å¦‚ä¸‹å®å®šä¹‰å£°æ˜ä¸€ä¸‹ï¼ˆå°±å’ŒC++ä¸­å…¨å±€å˜é‡ä½¿ç”¨externå£°æ˜ä¸€æ ·ï¼‰ï¼š</p>

<p>DELCARE_type(å˜é‡å)
typeéƒ¨åˆ†ä¸å‰é¢gflagsæ”¯æŒçš„ç±»å‹å¯¹åº”ã€‚æ¨èåœ¨å¯¹åº”çš„*.hæ–‡ä»¶ä¸­è¿›è¡ŒDECLARE_typeå£°æ˜ï¼Œéœ€è¦ä½¿ç”¨çš„æ–‡ä»¶ç›´æ¥includeå³å¯ã€‚</p>

<p>3.4 å‚æ•°è§£æ
å‚æ•°è§£æï¼Œä¹Ÿå«å‚æ•°åˆå§‹åŒ–ã€‚åœ¨mainå‡½æ•°å¤´å‡ è¡ŒåŠ å…¥å¦‚ä¸‹è¯­å¥ï¼ˆè¶Šæ—©äº†è§£ç”¨æˆ·éœ€æ±‚è¶Šå¥½ä¹ˆï¼‰ï¼š</p>

<p>google::ParseCommandLineFlags(&amp;argc, &amp;argv, true);
argcå’Œargvå°±æ˜¯mainä¸»å‡½æ•°ä¼ å…¥çš„å‚æ•°ï¼Œæƒ³å¿…å¤§å®¶éƒ½å¾ˆäº†è§£ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦é‡Šæ”¾argvä»¥èŠ‚çº¦å†…å­˜ï¼š</p>

<p>å¦‚æœä¸ºtrueï¼Œåˆ™è¯¥å‡½æ•°å¤„ç†å®Œæˆåï¼Œargvä¸­åªä¿ç•™argv[0]ç¨‹åºåï¼Œargcä¼šè¢«è®¾ç½®ä¸º1ï¼›
å¦‚æœä¸ºfalseï¼Œåˆ™argvå’Œargcéƒ½ä¼šè¢«ä¿ç•™ï¼Œä½†è§£æå‡½æ•°ä¼šè°ƒæ•´argvä¸­çš„é¡ºåºï¼›
ç¬¬ä¸‰ä¸ªå‚æ•°çš„çœŸæ­£å«ä¹‰æ˜¯remove_flagï¼šå¦‚æœä¸ºtrueï¼Œåˆ™gflagsä¼šç§»é™¤parseè¿‡çš„å‚æ•°ï¼Œå¦åˆ™gflagså°±ä¼šä¿ç•™è¿™äº›å‚æ•°ï¼Œä½†å¯èƒ½ä¼šå¯¹å‚æ•°é¡ºåºè¿›è¡Œè°ƒæ•´ã€‚</p>

<p>3.5 å‚æ•°è®¿é—®
å½“å‚æ•°è¢«å®šä¹‰åï¼Œåœ¨ç¨‹åºä¸­å°±å¯ä»¥é€šè¿‡FLAGS_nameçš„å½¢å¼è®¿é—®å¯¹åº”çš„flagså‚æ•°äº†ã€‚FLAGS_æ˜¯å›ºå®šçš„å‰ç¼€ï¼Œnameä¸ºå®å®šä¹‰ä¸­ä½¿ç”¨çš„åå­—ã€‚æ¯”å¦‚å‰é¢å®šä¹‰çš„ä¸¤ä¸ªå‚æ•°ï¼š</p>

<p>printf(â€œbig_menu=%d\nâ€, FLAGS_big_menu);
if(FLAGS_languages.find(â€œenglishâ€) != string::npos)
    HandleEnglish();
3.6 å‚æ•°æ£€æŸ¥
gflagsåº“æ”¯æŒå®šåˆ¶è‡ªå·±çš„è¾“å…¥å‚æ•°èŒƒå›´æ£€æŸ¥å‡½æ•°ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<p>static bool ValidatePort(const char *flagname, int32 value)
{
    if(value &gt; 0 &amp;&amp; value &lt; 32768)
        return true;
    printf(â€œInvalid value for â€“%s:%d\nâ€, flagname, (int) value);
    return false;
}
DEFINE_int32(port, 0, â€œWhat port to listen onâ€);
static const bool port_dummy = RegisterFlagValidator(&amp;FLAGS_port, &amp;ValidatePort);
å»ºè®®åœ¨å‚æ•°å®šä¹‰ä¹‹åï¼Œç«‹å³æ³¨å†Œæ£€æŸ¥å‡½æ•°ã€‚RegisterFlagValidator()åœ¨æ£€æŸ¥å‡½æ•°æ³¨å†ŒæˆåŠŸæ—¶è¿”å›trueï¼›å¦‚æœå‚æ•°å·²ç»æ³¨å†Œäº†æ£€æŸ¥å‡½æ•°ï¼Œæˆ–è€…æ£€æŸ¥å‡½æ•°ç±»å‹ä¸åŒ¹é…ï¼Œè¿”å›falseã€‚</p>

<p>3.7 å‚æ•°ä¼ é€’â€”â€”å‘½ä»¤è¡Œ
æœ€åï¼Œå°†æºç ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ä¹‹åï¼ˆç¼–è¯‘çš„æ—¶å€™æŒ‡å®š-lgflagsï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å½¢å¼æ¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°å¯¹flagså˜é‡èµ‹å€¼ï¼š</p>

<p>executable â€“å‚æ•°1=å€¼1 â€“å‚æ•°2=å€¼2 . . .
å…¶ä¸­çš„â€˜=â€™ä¹Ÿå¯ä»¥ä½¿ç”¨ç©ºæ ¼â€˜ â€™ä»£æ›¿ã€‚å¦‚æœflagså˜é‡ç±»å‹ä¸ºboolï¼Œé‚£ä¹ˆé™¤äº†ä½¿ç”¨â€“xxx=true/falseçš„å½¢å¼å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨â€“xxxå’Œâ€“noxxxåé¢ä¸åŠ ç­‰å·çš„æ–¹å¼æŒ‡å®štrueå’Œfalseã€‚æ¯”å¦‚ï¼š</p>

<p>app_containing_foo â€“languages=â€chinese, japanese, koreanâ€
app_containing_foo -languages=â€ chinese, japanese, koreanâ€
app_containing_foo â€“languages â€chinese, japanese, koreanâ€
app_containing_foo -languages â€chinese, japanese, koreanâ€
app_containing_foo â€“big_menu
app_containing_foo â€“nobig_menu
app_containing_foo â€“big_menu=true
app_containing_foo â€“big_menu=false
app_containing_foo â€“big_menu true
app_containing_foo â€“big_menu false
==ä½¿ç”¨â€“nodefokå‚æ•°==ï¼Œå¯ç›´æŒ‡å®šå½“å‘½ä»¤è¡Œä¸­å‡ºç°æ²¡æœ‰å®šä¹‰çš„å‚æ•°æ—¶ï¼Œå¹¶ä¸é€€å‡ºï¼ˆerror-exitï¼‰ã€‚</p>

<p>3.8 å‚æ•°ä¼ é€’â€”â€”é…ç½®æ–‡ä»¶
å¦‚æœå‚æ•°æ¯”è¾ƒå¤šï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼Œä¼šæ˜¾å¾—éå¸¸çš„å†—ä½™ã€‚å¯ä»¥==ä½¿ç”¨â€“flagfile==æ¥æŒ‡å®šä»æ–‡ä»¶ä¸­è¯»å–å‚æ•°å€¼ã€‚æ¯”å¦‚â€“flagfile=my.confè¡¨æ˜è¦ä»my.confæ–‡ä»¶è¯»å–å‚æ•°çš„å€¼ã€‚</p>

<p>åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå‚æ•°å€¼ä¸åœ¨å‘½ä»¤è¡Œæ–¹å¼ç±»ä¼¼ï¼Œå¦å¤–åœ¨flagfileé‡Œå¯è¿›ä¸€æ­¥é€šè¿‡â€“flagfileæ¥åŒ…å«å…¶ä»–çš„æ–‡ä»¶ã€‚</p>

<p>3.9 å‚æ•°ä¼ é€’â€”â€”ç¯å¢ƒå˜é‡
å¦‚æœæˆ‘ä»¬æƒ³è®©ç¨‹åºç›´æ¥ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–å‚æ•°å€¼ï¼Œå¯ä»¥==ä½¿ç”¨â€“formenv==æ¥æŒ‡å®šã€‚æ¯”å¦‚ï¼šâ€“fromenv=foo,barè¡¨æ˜è¦ä»ç¯å¢ƒå˜é‡è¯»å–fooï¼Œbarä¸¤ä¸ªå‚æ•°çš„å€¼ã€‚</p>

<p>é€šè¿‡export FLAGS_foo=xxx; export FLAGS_bar=yyyç¨‹åºå°±å¯è¯»åˆ°fooï¼Œbarçš„å€¼åˆ†åˆ«ä¸ºxxxï¼Œyyyã€‚</p>

<p>==å‚æ•°â€“tryfromenv==ä¸â€“fromenvç±»ä¼¼ï¼Œå½“å‚æ•°çš„æ²¡æœ‰åœ¨ç¯å¢ƒå˜é‡å®šä¹‰æ—¶ï¼Œä¸é€€å‡ºï¼ˆfatal-exitï¼‰ã€‚</p>

<p>å››ã€é«˜é˜¶ç”¨æ³•
4.1 æ·»åŠ è‡ªå·±çš„helpä¿¡æ¯
å¯ä»¥ä½¿ç”¨google::SetUsageMessageæ¥è®¾å®šå¸®åŠ©ä¿¡æ¯ã€‚ç„¶ååœ¨ç¨‹åºä¸­å¯ä»¥ä½¿ç”¨google::ProgramUsageè®¿é—®å¸®åŠ©ä¿¡æ¯ï¼Œä¹Ÿå¯åœ¨ç¨‹åºå¤–ï¼ˆå‘½ä»¤è¡Œï¼‰é€šè¿‡â€“helpæ¥è·å–ã€‚</p>

<p>ã€æ³¨æ„ã€‘ï¼šgoogle::SetUsageMessageå¿…é¡»åœ¨google::ParseCommandLineFlagsä¹‹å‰æ‰§è¡Œã€‚</p>

<p>æ·»åŠ è‡ªå·±çš„versionä¿¡æ¯
å¯ä»¥ä½¿ç”¨google::SetVersionStringæ¥è®¾å®šç‰ˆæœ¬ä¿¡æ¯ã€‚ç„¶ååœ¨ç¨‹åºä¸­å¯ä»¥ä½¿ç”¨google::VersionStringæ¥è®¿é—®ï¼Œåœ¨ç¨‹åºå¤–ï¼ˆå‘½ä»¤è¡Œï¼‰å¯ä»¥é€šè¿‡â€“versionå‚æ•°æ¥è·å–ã€‚</p>

<p>googleå¼€æºçš„gflagsæ˜¯ä¸€å¥—å‘½ä»¤è¡Œå‚æ•°è§£æå·¥å…·ï¼Œæ¯”getoptåŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼Œgflagsè¿˜æ”¯æŒä»ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶è¯»å–å‚æ•°ï¼ˆå¯ç”¨gflagsä»£æ›¿é…ç½®æ–‡ä»¶ï¼‰ã€‚æœ¬æ–‡ç®€å•ä»‹ç»gflagsçš„ä½¿ç”¨ï¼Œå†…å®¹ä¸»è¦è¯‘è‡ª http://gflags.googlecode.com/svn/trunk/doc/gflags.html ã€‚</p>

<p>å®šä¹‰å‚æ•°
ä½¿ç”¨flagséœ€è¦åŒ…å«å¤´æ–‡ä»¶  #include
gflagsä¸»è¦æ”¯æŒçš„å‚æ•°ç±»å‹åŒ…æ‹¬boolï¼Œint32, int64, uint64, double, stringç­‰ï¼Œå®šä¹‰å‚æ•°é€šè¿‡DEFINE_typeå®å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œåˆ†åˆ«å®šä¹‰äº†ä¸€ä¸ªboolå’Œä¸€ä¸ªstringç±»å‹çš„å‚æ•°ï¼Œè¯¥å®çš„ä¸‰ä¸ªå‚æ•°å«ä¹‰åˆ†åˆ«ä¸ºå‘½ä»¤è¡Œå‚æ•°åï¼Œå‚æ•°é»˜è®¤å€¼ï¼Œä»¥åŠå‚æ•°çš„å¸®åŠ©ä¿¡æ¯ã€‚</p>

<p>DEFINE_bool(big_menu, true, â€œInclude â€˜advancedâ€™ options in the menu listingâ€);
DEFINE_string(languages, â€œenglish,french,germanâ€,
                 â€œcomma-separated list of languages to offer in the â€˜langâ€™ menuâ€);
gflagä¸æ”¯æŒåˆ—è¡¨ï¼Œç”¨æˆ·é€šè¿‡çµæ´»å€ŸåŠ©stringå‚æ•°å®ç°ï¼Œæ¯”å¦‚ä¸Šè¿°çš„languageså‚æ•°ï¼Œå¯ä»¥ç±»å‹ä¸ºstringï¼Œä½†å¯çœ‹ä½œæ˜¯ä»¥é€—å·åˆ†å‰²çš„å‚æ•°åˆ—è¡¨ã€‚</p>

<p>è®¿é—®å‚æ•°
å½“å‚æ•°è¢«å®šä¹‰åï¼Œé€šè¿‡FLAGS_nameå°±å¯è®¿é—®åˆ°å¯¹åº”çš„å‚æ•°ï¼Œæ¯”å¦‚ä¸Šè¿°å®šä¹‰çš„big_menuã€languagesä¸¤ä¸ªå‚æ•°å°±å¯é€šè¿‡FLAGS_big_menuã€FLAGS_languagesè®¿é—®ã€‚</p>

<p>if (FLAGS_languages.find(â€œenglishâ€) != string::npos)
     HandleEnglish();</p>

<p>ä»¥ä¸Šçš„è®¿é—®æ–¹å¼ï¼Œä»…åœ¨å‚æ•°å®šä¹‰å’Œè®¿é—®åœ¨åŒä¸€ä¸ªæ–‡ä»¶ï¼ˆæˆ–æ˜¯é€šè¿‡å¤´æ–‡ä»¶åŒ…å«ï¼‰æ—¶ï¼ŒFLAGS_nameæ‰èƒ½è®¿é—®åˆ°å‚æ•°ï¼Œå¦‚æœè¦è®¿é—®å…¶ä»–æ–‡ä»¶é‡Œå®šä¹‰çš„å‚æ•°ï¼Œåˆ™éœ€è¦ä½¿ç”¨DECLARE_typeã€‚æ¯”å¦‚åœ¨foo.ccä¸­DEFINE_string(color, â€œredâ€, â€œthe color you want to useâ€); è¿™æ˜¯å¦‚æœä½ éœ€è¦åœ¨foo_test.ccä¸­ä½¿ç”¨colorè¿™ä¸ªå‚æ•°ï¼Œä½ éœ€è¦åŠ å…¥DECLARE_string(color, â€œredâ€, â€œthe color you want to useâ€);</p>

<p>å‚æ•°æ£€æŸ¥
å®šä¹‰å‚æ•°åï¼Œå¯ä»¥ç»™å‚æ•°æ³¨å†Œä¸€ä¸ªæ£€æŸ¥å‡½æ•°ï¼ˆvalidatorï¼‰ï¼Œå½“ä»å‘½ä»¤è¡ŒæŒ‡å®šå‚æ•°æˆ–é€šè¿‡SetCommandLineOption()æŒ‡å®šå‚æ•°æ—¶ï¼Œæ£€æŸ¥å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸ºå‘½ä»¤è¡Œå‚æ•°åï¼Œä»¥åŠè®¾ç½®çš„å‚æ•°å€¼ã€‚
static bool ValidatePort(const char* flagname, int32 value) {
   if (value &gt; 0 &amp;&amp; value &lt; 32768)   // value is ok
     return true;
   printf(â€œInvalid value for â€“%s: %d\nâ€, flagname, (int)value);
   return false;
}
DEFINE_int32(port, 0, â€œWhat port to listen onâ€);
static const bool port_dummy = RegisterFlagValidator(&amp;FLAGS_port, &amp;ValidatePort);
å»ºè®®åœ¨å®šä¹‰å‚æ•°åï¼Œç«‹å³æ³¨å†Œæ£€æŸ¥å‡½æ•°ã€‚RegisterFlagValidator()åœ¨æ£€æŸ¥å‡½æ•°æ³¨å†ŒæˆåŠŸæ—¶è¿”å›trueï¼›å¦‚æœå‚æ•°å·²ç»æ³¨å†Œäº†æ£€æŸ¥å‡½æ•°ï¼Œæˆ–è€…æ£€æŸ¥å‡½æ•°ç±»å‹ä¸åŒ¹é…ï¼Œè¿”å›falseã€‚</p>

<p>åˆå§‹åŒ–å‚æ•°
åœ¨å¼•ç”¨ç¨‹åºçš„main()é‡Œé€šè¿‡ google::ParseCommandLineFlags(&amp;argc, &amp;argv, true); å³å®Œæˆå¯¹gflagså‚æ•°çš„åˆå§‹ï¼Œå…¶ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºremove_flagï¼Œå¦‚æœä¸ºtrueï¼Œgflagsä¼šç§»é™¤parseè¿‡çš„å‚æ•°ï¼Œå¦åˆ™gflagså°±ä¼šä¿ç•™è¿™äº›å‚æ•°ï¼Œä½†å¯èƒ½ä¼šå¯¹å‚æ•°é¡ºåºè¿›è¡Œè°ƒæ•´ã€‚ æ¯”å¦‚ â€œ/bin/fooâ€ â€œarg1â€ â€œ-qâ€ â€œarg2â€  ä¼šè¢«è°ƒæ•´ä¸º â€œ/bin/fooâ€, â€œ-qâ€, â€œarg1â€, â€œarg2â€ï¼Œè¿™æ ·æ›´å¥½ç†è§£ã€‚</p>

<p>åœ¨å‘½ä»¤è¡ŒæŒ‡å®šå‚æ•°
æ¯”å¦‚è¦åœ¨å‘½ä»¤è¡ŒæŒ‡å®šlanguageså‚æ•°çš„å€¼ï¼Œå¯é€šè¿‡å¦‚ä¸‹4ç§æ–¹å¼ï¼Œint32, int64ç­‰ç±»å‹ä¸stringç±»ä¼¼ã€‚</p>

<p>app_containing_foo â€“languages=â€chinese,japanese,koreanâ€
app_containing_foo -languages=â€chinese,japanese,koreanâ€
app_containing_foo â€“languages â€œchinese,japanese,koreanâ€
app_containing_foo -languages â€œchinese,japanese,koreanâ€
å¯¹äºboolç±»å‹ï¼Œåˆ™å¯é€šè¿‡å¦‚ä¸‹å‡ ç§æ–¹å¼æŒ‡å®šå‚æ•°</p>

<p>app_containing_foo â€“big_menu
app_containing_foo â€“nobig_menu
app_containing_foo â€“big_menu=true
app_containing_foo â€“big_menu=false</p>

<p>ç‰¹æ®Šå‚æ•°</p>

<p>â€“help æ‰“å°å®šä¹‰è¿‡çš„æ‰€æœ‰å‚æ•°çš„å¸®åŠ©ä¿¡æ¯
â€“version æ‰“å°ç‰ˆæœ¬ä¿¡æ¯ é€šè¿‡google::SetVersionString()æŒ‡å®š
â€“nodefok  ä½†å‘½ä»¤è¡Œä¸­å‡ºç°æ²¡æœ‰å®šä¹‰çš„å‚æ•°æ—¶ï¼Œå¹¶ä¸é€€å‡ºï¼ˆerror-exitï¼‰
â€“fromenv ä»ç¯å¢ƒå˜é‡è¯»å–å‚æ•°å€¼ â€“fromenv=foo,barè¡¨æ˜è¦ä»ç¯å¢ƒå˜é‡è¯»å–fooï¼Œbarä¸¤ä¸ªå‚æ•°çš„å€¼ã€‚é€šè¿‡export FLAGS_foo=xxx; export FLAGS_bar=yyy ç¨‹åºå°±å¯è¯»åˆ°fooï¼Œbarçš„å€¼åˆ†åˆ«ä¸ºxxxï¼Œyyyã€‚
â€“tryfromenv ä¸â€“fromenvç±»ä¼¼ï¼Œå½“å‚æ•°çš„æ²¡æœ‰åœ¨ç¯å¢ƒå˜é‡å®šä¹‰æ—¶ï¼Œä¸é€€å‡ºï¼ˆfatal-exitï¼‰
â€“flagfile ä»æ–‡ä»¶è¯»å–å‚æ•°å€¼ï¼Œâ€“flagfile=my.confè¡¨æ˜è¦ä»my.confæ–‡ä»¶è¯»å–å‚æ•°çš„å€¼ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå‚æ•°å€¼ä¸åœ¨å‘½ä»¤è¡Œæ–¹å¼ç±»ä¼¼ï¼Œå¦å¤–åœ¨flagfileé‡Œå¯è¿›ä¸€æ­¥é€šè¿‡â€“flagfileæ¥åŒ…å«å…¶ä»–çš„æ–‡ä»¶ã€‚</p>

<p>gflags
git clone https://github.com/gflags/gflags.git
cd gflags
mkdir build; cd build
CXXFLAGS=â€-fPICâ€ cmake ..
make
sudo make install
åœ¨windowsä¸‹é“¾æ¥ä¼šæŠ¥é”™
gflags_static.lib(gflags.obj) : error LNK2001: æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· __imp_PathMatchSpecA
#pragma comment(lib, â€œshlwapi.libâ€) å¯ä»¥è§£å†³</p>

<p>glog
git clone https://github.com/google/glog
cd glog
./autogen.sh
./configure â€“with-gflags=/usr/local/include  å¦‚æœå…ˆå®‰è£…äº†gflagsè¿™ä¸ªä¼šè‡ªåŠ¨æŸ¥æ‰¾
./configure
make &amp;&amp; make install
int main(int argc, char* argv[]) {
    FLAGS_log_dir = â€œ./â€;  //å…ˆç»™ä¸ªé»˜è®¤ä½ç½®
    google::ParseCommandLineFlags(&amp;argc, &amp;argv, false); //ä¸€å®šè¦å…ˆè§£æå‚æ•°ã€‚ falseè¡¨ç¤ºä¸åˆ é™¤æ•°ç»„å…ƒç´ .
    google::InitGoogleLogging(argv[0]);
    //google::SetLogDestination(google::GLOG_INFO, â€œlog/out.logâ€);  //ä¹Ÿå¯ç”¨è¿™ä¸ªè®¾ç½®
    LOG(INFO) Â«Â â€œhello world!â€ Â«Â std::endl;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>google::ShutdownGoogleLogging();  //è¦å…³é—­
return 0; } ./test --log_dir=xxxx å³å¯ï¼Œä¸å†™å°±é»˜è®¤åœ¨å½“å‰ç›®å½•ä¸‹
</code></pre></div></div>

<p>https://github.com/gflags/gflags
http://gflags.github.io/gflags/
0ã€ç³»ç»Ÿç¯å¢ƒ
Ubuntu 16.04
GCC 5.4</p>

<p>1ã€å®‰è£…æ­¥éª¤
1ï¼‰å®‰è£… GFlags
è¿è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š
git clone https://github.com/gflags/gflags.git
cd gflags
mkdir build &amp;&amp; cd build
cmake .. -DGFLAGS_NAMESPACE=google -DCMAKE_CXX_FLAGS=-fPIC ..
make -j4
sudo make install
1
2
3
4
5
6
git clone https://github.com/gflags/gflags.git
cd gflags
mkdir build &amp;&amp; cd build
cmake .. -DGFLAGS_NAMESPACE=google -DCMAKE_CXX_FLAGS=-fPIC ..
make -j4
sudo make install
2ï¼‰å®‰è£… GLogï¼š
å®‰è£…ç¼–è¯‘å·¥å…·ï¼š
sudo apt-get install autoconf automake libtool
1
sudo apt-get install autoconf automake libtool
è¿è¡Œå¦‚ä¸‹æŒ‡ä»¤å®‰è£…ï¼š
git clone https://github.com/google/glog
./autogen.sh
./configure
make -j8
sudo make install
1
2
3
4
5
git clone https://github.com/google/glog
./autogen.sh
./configure
make -j8
sudo make install
å¸¸è§é—®é¢˜
1ã€ä½¿ç”¨ GLog æŠ¥é”™ï¼šlibglog.a: error adding symbols: Bad value
åœ¨ä½¿ç”¨ GLog çš„å·¥ç¨‹ä¸­é‡åˆ°äº†å¦‚ä¸‹é”™è¯¯ï¼š
/usr/bin/ld: /usr/local/lib/libglog.a(libglog_la-logging.o): relocation R_X86_64_32 against <code class="language-plaintext highlighter-rouge">.rodata.str1.1' can not be used when making a shared object; recompile with -fPIC
/usr/local/lib/libglog.a: error adding symbols: Bad value
collect2: error: ld returned 1 exit status
1
2
3
/usr/bin/ld: /usr/local/lib/libglog.a(libglog_la-logging.o): relocation R_X86_64_32 against </code>.rodata.str1.1â€™ can not be used when making a shared object; recompile with -fPIC
/usr/local/lib/libglog.a: error adding symbols: Bad value
collect2: error: ld returned 1 exit status
äº§ç”Ÿè¯¥é—®é¢˜çš„å¯èƒ½åŸå› æ˜¯åœ¨ 64ä½ç³»ç»Ÿä¸­ï¼Œä¸èƒ½é“¾æ¥ GLog ç”ŸæˆåŠ¨æ€åº“ã€‚ä¿®æ”¹æ–¹æ³•æ˜¯ GLog éœ€è¦ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ç¼–è¯‘ï¼ŒåŠ å…¥ -fPIC ç¼–è¯‘é€‰é¡¹ï¼š
./configure CPPFLAGS=â€-I/usr/local/include -fPICâ€ LDFLAGS=â€-L/usr/local/libâ€
1
./configure CPPFLAGS=â€-I/usr/local/include -fPICâ€ LDFLAGS=â€-L/usr/local/libâ€
ä»£æ›¿ï¼š
./configure
1
./configure
2ã€é”™è¯¯ï¼šundefined reference to `google::FlagRegisterer::FlagRegisterer
å¦‚æœä½ åœ¨ç¼–è¯‘ GLog æ—¶é‡åˆ°å¦‚ä¸‹é”™è¯¯ï¼š
undefined reference to â€˜google::FlagRegisterer::FlagRegistererâ€™
1
undefined reference to â€˜google::FlagRegisterer::FlagRegistererâ€™
å¯ä»¥å°è¯•å…ˆå¸è½½ GFlagsï¼š
sudo apt-get purge libgflags-dev
1
sudo apt-get purge libgflags-dev
ç„¶åé‡æ–°ç¼–è¯‘
å¦ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œåœ¨ç¼–è¯‘ GLog æ—¶è¯·ä½¿ç”¨ï¼š
./configure CPPFLAGS=â€-I/usr/local/includeâ€ LDFLAGS=â€-L/usr/local/libâ€
1
./configure CPPFLAGS=â€-I/usr/local/includeâ€ LDFLAGS=â€-L/usr/local/libâ€
ä»£æ›¿ï¼š
./configure
1
./configure
3ã€é”™è¯¯ï¼šMake error: failed to link with libgflags.a
äº§ç”Ÿè¯¥é—®é¢˜çš„åŸå› æœ‰å¯èƒ½æ˜¯éœ€è¦ä½¿ç”¨åŠ¨æ€åº“æ–¹å¼ç¼–è¯‘ GFlags
å°† GFlags ç¼–è¯‘æ—¶é€‰é¡¹æ”¹æˆåŠ¨æ€åº“ï¼š
cmake .. -DBUILD_SHARED_LIBS=ON
1
cmake .. -DBUILD_SHARED_LIBS=ON
å¹¶é‡æ–°ç¼–è¯‘ GFlags å’Œ GLogã€‚</p>

<p>4ã€é”™è¯¯ï¼šsomething wrong with flag â€˜flagfileâ€™ in file â€˜XXX.ccâ€™
è¯·å‚ç…§ 3 ä¸­çš„è§£å†³æ–¹æ¡ˆé‡æ–°ç¼–è¯‘ GFlags å’Œ GLogã€‚</p>

:ET