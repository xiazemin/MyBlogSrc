I"®ë<p>https://github.com/lxc/lxc
LXCæ˜¯Linux containersçš„ç®€ç§°ï¼Œæ“ä½œç³»ç»Ÿçº§åˆ«çš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚å®ƒå¯ä»¥åœ¨æ“ä½œç³»ç»Ÿå±‚æ¬¡ä¸Šä¸ºè¿›ç¨‹æä¾›çš„è™šæ‹Ÿçš„æ‰§è¡Œç¯å¢ƒã€‚ä¸€ä¸ªè™šæ‹Ÿçš„æ‰§è¡Œç¯å¢ƒè¢«ç§°ä¸ºä¸€ä¸ªå®¹å™¨(container)ã€‚å¯ä»¥ä¸ºå®¹å™¨ç»‘å®šç‰¹å®šçš„cpuå’ŒmemoryèŠ‚ç‚¹ï¼Œåˆ†é…ç‰¹å®šæ¯”ä¾‹çš„cpuæ—¶é—´ã€IOæ—¶é—´ï¼Œé™åˆ¶å¯ä»¥ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼ˆåŒ…æ‹¬å†…å­˜å’Œæ˜¯swapç©ºé—´ï¼‰ï¼Œæä¾›deviceè®¿é—®æ§åˆ¶ï¼Œæä¾›ç‹¬ç«‹çš„namespaceï¼ˆç½‘ç»œã€pidã€ipcã€mntã€utsï¼‰ã€‚
å®¹å™¨æœ‰æ•ˆåœ°å°†ç”±å•ä¸ªæ“ä½œç³»ç»Ÿç®¡ç†çš„èµ„æºåˆ’åˆ†åˆ°å­¤ç«‹çš„ç»„ä¸­ï¼Œä»¥æ›´å¥½åœ°åœ¨å­¤ç«‹çš„ç»„ä¹‹é—´å¹³è¡¡æœ‰å†²çªçš„èµ„æºä½¿ç”¨éœ€æ±‚ã€‚ä¸è™šæ‹ŸåŒ–ç›¸æ¯”ï¼Œè¿™æ ·æ—¢ä¸éœ€è¦æŒ‡ä»¤çº§æ¨¡æ‹Ÿï¼Œä¹Ÿä¸éœ€è¦å³æ—¶ç¼–è¯‘ã€‚å®¹å™¨å¯ä»¥åœ¨æ ¸å¿ƒ CPU æœ¬åœ°è¿è¡ŒæŒ‡ä»¤ï¼Œè€Œä¸éœ€è¦ä»»ä½•ä¸“é—¨çš„è§£é‡Šæœºåˆ¶ã€‚æ­¤å¤–ï¼Œä¹Ÿé¿å…äº†å‡†è™šæ‹ŸåŒ–ï¼ˆparavirtualizationï¼‰å’Œç³»ç»Ÿè°ƒç”¨æ›¿æ¢ä¸­çš„å¤æ‚æ€§ã€‚</p>

<p>lxc-version ç”¨äºæ˜¾ç¤ºç³»ç»ŸLXCçš„ç‰ˆæœ¬å·ï¼ˆå¯ä»¥é€šè¿‡æ­¤å‘½ä»¤åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å®‰è£…äº†lxcï¼‰</p>

<p>ç”¨æ³•ï¼šlxc-version</p>

<p>ä¾‹å¦‚:lxc-version</p>

<p>lxc-checkconfig ç”¨äºåˆ¤æ–­linuxå†…æ ¸æ˜¯å¦æ”¯æŒLXC</p>

<p>ç”¨æ³•ï¼šlxc-checkconfig</p>

<p>ä¾‹å¦‚ï¼šlxc-checkconfig</p>

<p>lxc-createç”¨äºåˆ›å»ºä¸€ä¸ªå®¹å™¨</p>

<p>ç”¨æ³•ï¼šlxc-create -n name [-f config_file]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     -n åé¢è·Ÿè¦åˆ›å»ºçš„å®¹å™¨åå­— ä¾‹å¦‚ï¼š-n foo

     -f åé¢è·Ÿå®¹å™¨é…ç½®æ–‡ä»¶çš„è·¯å¾„
</code></pre></div></div>

<p>æ³¨ï¼š1.é‡‡ç”¨lxc-createåˆ›å»ºçš„å®¹å™¨ï¼Œåœ¨åœæ­¢è¿è¡Œåï¼Œä¸ä¼šè¢«é”€æ¯ï¼Œè¦é‡‡ç”¨lxc-destroyå‘½ä»¤æ‰èƒ½é”€æ¯</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   2.å®¹å™¨å‘½ä»¤ç©ºé—´æ˜¯å…¨å±€çš„ï¼Œç³»ç»Ÿä¸­ä¸å…è®¸å­˜åœ¨é‡åçš„å®¹å™¨ï¼Œå¦‚æœ-n åé¢è·Ÿä¸€ä¸ªå·²ç»å­˜åœ¨çš„å®¹å™¨åï¼Œåˆ›å»ºä¼šå¤±è´¥
</code></pre></div></div>

<p>ä¾‹å¦‚ï¼šlxc-create â€“n foo â€“f foo.conf</p>

<p>lxc-execute ç”¨äºåœ¨ä¸€ä¸ªå®¹å™¨æ‰§è¡Œåº”ç”¨ç¨‹åº</p>

<p>ç”¨æ³•ï¼š lxc-execute -n name [-f config_file] [ -s KEY=VAL ]command</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       -n åé¢è·Ÿå®¹å™¨åå­—ï¼ˆå®¹å™¨åå­—ç”¨äºç®¡ç†å®¹å™¨ï¼‰ä¾‹å¦‚ï¼š-n foo

       -f åé¢è·Ÿå®¹å™¨é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼ˆå¦‚æœæ²¡æœ‰é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ç”¨-sæŒ‡å®šé…ç½®é€‰é¡¹ï¼Œå¦‚æœä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œç³»ç»Ÿé‡‡ç”¨é»˜è®¤ç­–ç•¥ï¼‰ä¾‹å¦‚ï¼š-f foo.conf

       -s åé¢è·Ÿé…ç½®é”®å€¼å¯¹ ä¾‹å¦‚ï¼šlxc.cgroup.cpu.shares=512

   command ä¸ºè¦æ‰§è¡Œçš„å‘½ä»¤ ä¾‹å¦‚ï¼š/bin/bash
</code></pre></div></div>

<p>æ³¨ï¼š1.å¦‚æœå®¹å™¨è¿˜ä¸å­˜åœ¨ï¼Œlxc-executeä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª,å®¹å™¨åœæ­¢è¿è¡Œåä¼šè¢«è‡ªåŠ¨é”€æ¯</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    2.ç”¨lxc-executeå¯åŠ¨åº”ç”¨ç¨‹åºï¼Œé…ç½®ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š

      å¦‚æœæŒ‡å®š-fé€‰é¡¹ï¼Œé‚£ä¹ˆä¹‹å‰åˆ›å»ºå®¹å™¨ï¼ˆå¦‚æœå®¹å™¨æ˜¯å·²å­˜åœ¨çš„ï¼‰çš„é…ç½®æ–‡ä»¶ä¸ä¼šè¢«ä½¿ç”¨

      å¦‚æœæ²¡æœ‰æŒ‡å®š-fé€‰é¡¹ï¼Œé‚£ä¹ˆå°†é‡‡ç”¨ä¹‹å‰åˆ›å»ºå®¹å™¨ï¼ˆå¦‚æœå®¹å™¨å·²å­˜åœ¨ï¼‰çš„é…ç½®æ–‡ä»¶

      å¦‚æœæŒ‡å®š-sé€‰é¡¹ï¼Œåˆ™åœ¨å‘½ä»¤è¡Œä¸­çš„é…ç½®é”®å€¼å¯¹ä¼šè¦†ç›–é…ç½®æ–‡ä»¶ï¼ˆæ— è®ºä¹‹å‰çš„è¿˜æ˜¯-fæŒ‡å®šçš„ï¼‰ç›¸åŒé…ç½®
</code></pre></div></div>

<p>ä¾‹å¦‚ï¼šlxc-execute â€“n foo â€“s lxc.cgroup.cpu.shares=512 /bin/bash</p>

<p>lxc-start ç”¨äºåœ¨å®¹å™¨ä¸­æ‰§è¡Œç»™å®šå‘½ä»¤</p>

<p>ç”¨æ³•ï¼šlxc-start  -n name [-f config_file] [-c console_file] [-d] [-s KEY=VAL]
          [command]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  -d å°†å®¹å™¨å½“åšå®ˆæŠ¤è¿›ç¨‹æ‰§è¡Œ

 -f  åé¢è·Ÿé…ç½®æ–‡ä»¶

 -c æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ä½œä¸ºå®¹å™¨consoleçš„è¾“å‡ºï¼Œå¦‚æœä¸æŒ‡å®šï¼Œå°†è¾“å‡ºåˆ°ç»ˆç«¯

-s æŒ‡å®šé…ç½®
</code></pre></div></div>

<p>ä¾‹å¦‚ï¼šlxc-start -n foo -f foo.conf -d /bin/bash</p>

<p>æ³¨ï¼š1.å¦‚æœå®¹å™¨è¿˜ä¸å­˜åœ¨ï¼Œlxc-startä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª,å®¹å™¨åœæ­¢è¿è¡Œåä¼šè¢«è‡ªåŠ¨é”€æ¯</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   2.lxc-starté…ç½®ä¼˜å…ˆçº§ä¸lxc-executeç›¸åŒ

   3.lxc-start ä¸lxc.executeçš„å¼‚åŒï¼š

    lxc-start å’Œ lxc-executeéƒ½å¯ä»¥åœ¨å®¹å™¨ä¸­å¯åŠ¨è¿›ç¨‹ï¼ŒåŒºåˆ«åœ¨äºlxc-startç›´æ¥åˆ›å»ºè¿›ç¨‹ï¼Œlxc-executeå…ˆåˆ›å»ºlxc-initè¿›ç¨‹ï¼Œç„¶ååœ¨lxc-initä¸­forkä¸€ä¸ªè¿›ç¨‹æ¥æ‰§è¡Œã€‚

   The orphan process group and daemon are not supported by this  command,
   use the lxc-execute command instead.

   If no command is specified, lxc-start will use the default "/sbin/init"
    command to run a system container.

  4.lxc-startç”¨äºåœ¨å®¹å™¨å¯åŠ¨systemï¼Œlxc-executeç”¨äºåœ¨å®¹å™¨æ‰§è¡Œåº”ç”¨ç¨‹åº
</code></pre></div></div>

<p>lxc-kill å‘é€ä¿¡å·ç»™å®¹å™¨ä¸­çš„ç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ï¼ˆå®¹å™¨å†…éƒ¨è¿›ç¨‹å·ä¸º2çš„è¿›ç¨‹ï¼‰</p>

<p>ç”¨æ³•ï¼šlxc-kil -n name SIGNUM</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  -n åé¢è·Ÿå®¹å™¨å

  SIGNUM  ä¿¡å· ï¼ˆæ­¤å‚æ•°å¯é€‰ï¼Œé»˜è®¤SIGKILLï¼‰
</code></pre></div></div>

<p>ä¾‹å¦‚ï¼šlxc-kill -n foo</p>

<p>lxc-stop ç”¨äºåœæ­¢å®¹å™¨ä¸­æ‰€æœ‰çš„è¿›ç¨‹</p>

<p>ç”¨æ³•ï¼šlxc-stop -n name</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   -nåé¢è·Ÿè¦åœæ­¢çš„å®¹å™¨å
</code></pre></div></div>

<p>ä¾‹å¦‚:lxc-stop â€“n foo</p>

<p>lxc-destroy ç”¨äºé”€æ¯å®¹å™¨</p>

<p>ç”¨æ³•ï¼šlxc-destroy -n name</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   -nåé¢è·Ÿè¦åœæ­¢çš„å®¹å™¨å
</code></pre></div></div>

<p>ä¾‹å¦‚: lxc-destroy â€“n foo</p>

<p>lxc-cgroup ç”¨äºè·å–æˆ–è°ƒæ•´ä¸cgroupç›¸å…³çš„å‚æ•°</p>

<p>ç”¨æ³•ï¼šlxc-cgroup -n name subsystem value</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    -n åé¢è·Ÿè¦è°ƒæ•´çš„å®¹å™¨å
</code></pre></div></div>

<p>ä¾‹å¦‚ï¼š lxc-cgroup -n foo devices.list</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       lxc-cgroup -n foo cpuset.cpus "0,3"
</code></pre></div></div>

<p>lxc-info ç”¨æˆ·è·å–ä¸€ä¸ªå®¹å™¨çš„çŠ¶æ€</p>

<p>ç”¨æ³•:lxc-info -n name</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   -nåé¢è·Ÿæ“ä½œçš„å®¹å™¨å
</code></pre></div></div>

<p>ä¾‹å¦‚: lxc-info â€“n foo</p>

<p>æ³¨ï¼šå®¹å™¨çš„çŠ¶æ€æœ‰ï¼šSTARTING RUNNING STOPPING STOPPED ABORTING</p>

<p>lxc-monitor ç›‘æ§ä¸€ä¸ªå®¹å™¨çŠ¶æ€çš„å˜æ¢ï¼Œå½“ä¸€ä¸ªå®¹å™¨çš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œæ­¤å‘½ä»¤ä¼šåœ¨å±å¹•ä¸Šæ‰“å°å‡ºå®¹å™¨çš„çŠ¶æ€</p>

<p>ç”¨æ³•:lxc-monitor -n name</p>

<p>ä¾‹å¦‚ï¼šlxc-monitor -n foo</p>

<p>lxc-ls åˆ—å‡ºå½“å‰ç³»ç»Ÿæ‰€æœ‰çš„å®¹å™¨</p>

<p>ç”¨æ³•ï¼šlxc-ls</p>

<p>ä¾‹å¦‚ï¼šlxc-ls</p>

<p>lxc-ps åˆ—å‡ºç‰¹å®šå®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹</p>

<p>ç”¨æ³•:lxc-ps</p>

<p>ä¾‹å¦‚:lxc-ps -n foo</p>

<p>æ›´å¤šçš„å‘½ä»¤ä»‹ç»å¯ä»¥å†man pageè·å¾—</p>

<p>http://manpages.ubuntu.com/manpages/lucid/man7/lxc.7.html
<!-- more -->
å®‰è£…
sudo apt-get install lxc
æŸ¥çœ‹ç³»ç»Ÿæ¨¡æ¿
ls /usr/share/lxc/templates/</p>

<p>lxc-alpine     lxc-centos    lxc-fedora        lxc-oracle
lxc-altlinux   lxc-cirros    lxc-gentoo        lxc-plamo
lxc-archlinux  lxc-debian    lxc-openmandriva  lxc-sshd
lxc-busybox    lxc-download  lxc-opensuse      lxc-ubuntu</p>

<p>åˆ›å»ºç³»ç»Ÿ
è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´
sudo lxc-create -t ubuntu -n zqw</p>
<h1 id="-n-æ˜¯-name-ç¼©å†™">-n æ˜¯ name ç¼©å†™</h1>

<p>å¯åŠ¨
sudo lxc-start -n zqw -d
æ˜¾ç¤ºlxcåˆ›å»ºçš„ç³»ç»Ÿ
sudo lxc-ls
é€šè¿‡æ§åˆ¶å°è¿›å…¥ç³»ç»Ÿ
sudo lxc-console -n zqw, å°±å¯ä»¥åœ¨ç³»ç»Ÿå†…æ‰§è¡Œshellå•¦
åœæ­¢
lxc-stop -n zqw
é€šè¿‡é…ç½®æ–‡ä»¶è¿›å…¥ç³»ç»Ÿ</p>
<h1 id="gitiançš„é…ç½®æ–‡ä»¶">gitiançš„é…ç½®æ–‡ä»¶</h1>
<h1 id="httpsgithubcomdevrandomgitian-builderblobmasteretclxcconfigin">https://github.com/devrandom/gitian-builder/blob/master/etc/lxc.config.in</h1>

<p>lxc.tty = 4
lxc.pts = 1024
lxc.rootfs = ROOTFS
lxc.arch = ARCH
lxc.cgroup.devices.deny = a</p>
<h1 id="devnull-and-zero">/dev/null and zero</h1>
<p>lxc.cgroup.devices.allow = c 1:3 rwm
lxc.cgroup.devices.allow = c 1:5 rwm</p>
<h1 id="consoles">consoles</h1>
<p>lxc.cgroup.devices.allow = c 5:1 rwm
lxc.cgroup.devices.allow = c 5:0 rwm
lxc.cgroup.devices.allow = c 4:0 rwm
lxc.cgroup.devices.allow = c 4:1 rwm</p>
<h1 id="devurandom">/dev/{,u}random</h1>
<p>lxc.cgroup.devices.allow = c 1:9 rwm
lxc.cgroup.devices.allow = c 1:8 rwm
lxc.cgroup.devices.allow = c 136:* rwm
lxc.cgroup.devices.allow = c 5:2 rwm</p>
<h1 id="rtc">rtc</h1>
<p>lxc.cgroup.devices.allow = c 254:0 rwm</p>

<h1 id="mounts-points">mounts points</h1>
<p>lxc.mount.entry=proc ROOTFS/proc proc nodev,noexec,nosuid 0 0
lxc.mount.entry=sysfs ROOTFS/sys sysfs defaults  0 0</p>

<h1 id="container-with-network-virtualized-using-a-pre-configured-bridge-named-br0-and">Container with network virtualized using a pre-configured bridge named br0 and</h1>
<h1 id="veth-pair-virtual-network-devices">veth pair virtual network devices</h1>
<h1 id="on-the-host-run-ifconfig-br0-up-10022">On the host, run: ifconfig br0 up 10.0.2.2</h1>
<h1 id="alternatively-you-can-use-another-ip-range-for-the-bridge-interface-in-this-case-set">Alternatively, you can use another IP range for the bridge interface, in this case set</h1>
<h1 id="the-environment-variables-gitian_host_ip-and-lxc_guest_ip-appropriately">the environment variables GITIAN_HOST_IP and LXC_GUEST_IP appropriately.</h1>
<p>lxc.network.type = veth
lxc.network.flags = up
lxc.network.link = GUESTLINK
lxc.network.ipv4 = GUESTIP/24
lxc.network.ipv4.gateway = auto</p>

<p>lxc.utsname = gitian</p>

<p>sudo lxc-start -n gitian -f gitian-builder/var/lxc.config
sudo lxc-attach -n gitian -f gitian-builder/var/lxc.config</p>

<h1 id="-n-nameç¼©å†™">-n nameç¼©å†™</h1>
<h1 id="-f-fileç¼©å†™-è¾“å…¥é…ç½®æ–‡ä»¶è·¯å¾„">-f fileç¼©å†™, è¾“å…¥é…ç½®æ–‡ä»¶è·¯å¾„</h1>

<p>) å®‰è£…lxcå·¥å…·åŒ…</p>
<h1 id="yum-install-lxc">yum install lxc</h1>
<p>2) æ£€æŸ¥å†…æ ¸æ˜¯å¦æ”¯æŒlxcå®¹å™¨</p>
<h1 id="lxc-checkconfig">lxc-checkconfig</h1>
<p>å¦‚æœè¾“å‡ºæ‰€æœ‰é¡¹å‡ä¸ºenbaleçŠ¶æ€ï¼Œåˆ™è¡¨æ˜å†…æ ¸æ”¯æŒlxcå®¹å™¨ï¼Œå¦åˆ™éœ€é‡æ–°ç¼–è¯‘å†…æ ¸æ‰“å¼€ç›¸åº”åŠŸèƒ½é¡¹ã€‚ 
3) é€šè¿‡shellåœ¨å®¹å™¨ä¸­è¿è¡Œä¸€ä¸ªç¨‹åº(è¶…çº§ç”¨æˆ·ä¸‹) 
a) åœ¨å½“å‰ç›®å½•ä¸‹ç¼–è¯‘é…ç½®æ–‡ä»¶conf.txtï¼Œå…¶å†…å®¹ä¸ºï¼š 
#Simplest lxc configuration 
lxc.utsname = name 
b) æŒ‚è½½cgroup</p>
<h1 id="mkdir-cgroup">mkdir /cgroup</h1>
<h1 id="mount-t-cgroup-cgroup-cgroup">mount â€“t cgroup cgroup /cgroup</h1>
<p>c) è¾“å…¥å¦‚ä¸‹shellå‘½ä»¤</p>
<h1 id="lxc-execute---n-test---f-conftxt-binecho-hello-world">lxc-execute  -n test  -f conf.txt /bin/echo â€œhello worldâ€</h1>
<p>d) è¾“å‡ºç»“æœä¸º 
hello world 
4) ç¼–è¾‘/etc/fstabï¼Œä½¿å¾—åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½cgroup</p>
<h1 id="binecho-cgroup-cgroup-cgroup-defaults-0-0-etcfstab">/bin/echo â€œcgroup /cgroup cgroup defaults 0 0â€Â Â» /etc/fstab</h1>
<p>3  lxcå·¥å…·é›† 
3.1 åˆ›å»ºå’Œé”€æ¯å®¹å™¨ 
3.1.1 lxc-create 
lxc-create  -n name [-f config_file] [ -t template] 
åˆ›å»ºä¸€ä¸ªç³»ç»Ÿå¯¹è±¡æ¥å­˜å‚¨é…ç½®å’Œç”¨æˆ·ä¿¡æ¯ï¼Œè¯¥å¯¹è±¡ä¿å­˜/usr/local/var/lib/lxcï¼ˆæ³¨æ„è¯¥ç›®å½•ä¸ºç‰ˆæœ¬ç›¸å…³çš„ï¼Œä¸åŒç‰ˆæœ¬çš„lxcå¯èƒ½ä¸åŒï¼‰ç›®å½•ä¸‹ï¼Œnameä¸ºå…¶æ ‡ç¤ºç¬¦ã€‚å¦‚æœé…ç½®æ–‡ä»¶æœªæŒ‡å®šï¼Œåˆ™ç³»ç»Ÿä¼šæ”¯æŒé»˜è®¤çš„èµ„æºéš”ç¦»ï¼šPIDï¼Œsysv IPCå’ŒæŒ‚è½½ç‚¹ã€‚ 
ä¾‹å¦‚ï¼š</p>
<h1 id="lxc-create---n-test">lxc-create  -n test</h1>
<p>åˆ›å»ºå®¹å™¨test,å¯åœ¨/usr/local/var/lib/lxcç›®å½•ä¸‹å‘ç°åˆ›å»ºäº†ç›®å½•testï¼Œè¯¥æ–‡ä»¶ä¸­åŒ…å«äº†é»˜è®¤çš„é…ç½®æ–‡ä»¶config 
3.1.2  lxc-destroy 
lxc-destroy  -n name 
é”€æ¯ä¸€ä¸ªåç§°ä¸ºnameçš„å®¹å™¨ï¼Œä¸»è¦åˆ é™¤åœ¨/usr/local/var/lib/lxcä¸­ç›¸åº”çš„æ–‡ä»¶ï¼Œæ³¨æ„ä¸€å®šè¦åœ¨å®¹å™¨å¤„äºSTOPPEDçŠ¶æ€æ—¶æ‰èƒ½é”€æ¯å®¹å™¨. 
ä¾‹å¦‚ï¼š</p>
<h1 id="lxc-destroy---n-test">lxc-destroy  -n test</h1>
<p>é”€æ¯å®¹å™¨test. 
3.2 åœ¨å®¹å™¨ä¸­è¿è¡Œä¸ç»“æŸåº”ç”¨ 
3.2.1 lxc-executeå’Œlxc-start 
a)  lxc-execute  -n  name [-f config_file] [-s EKY=VAL] command 
åœ¨æŒ‡å®šçš„å®¹å™¨nameä¸­è¿è¡Œç”±commandæŒ‡å®šçš„å‘½ä»¤ã€‚å¦‚æœå®¹å™¨nameæœªåˆ›å»ºï¼Œåˆ™lxc-executeä½¿ç”¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶åˆ›å»ºå®¹å™¨nameã€‚è¯¥å‘½ä»¤é€šè¿‡ä¸­é—´è¿›ç¨‹lxc-initæ¥å¯åŠ¨éœ€è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”lxc-initåœ¨åˆ›å»ºå‘½ä»¤åä¼šç­‰å¾…è¯¥å‘½ä»¤æ‰§è¡Œç»“æŸã€‚å› æ­¤lxc-initè¿›ç¨‹çš„pidä¸º1ï¼Œè¿è¡Œçš„å‘½ä»¤çš„pidä¸º2ã€‚ 
b)  lxc-start  -n name [-f config_file] [-s KEY=VAL] command 
lxc-startåœ¨æŒ‡å®šå®¹å™¨nameä¸­è¿è¡ŒcommandæŒ‡å®šçš„å‘½ä»¤ã€‚æ³¨æ„lxc-startä¸æ”¯æŒå­¤å„¿è¿›ç¨‹ç»„å’Œå®ˆæŠ¤è¿›ç¨‹ï¼Œä¸”å¦‚æœcommandæœªæŒ‡å®šï¼Œåˆ™ä¼šè¿è¡Œ/sbin/initå‘½ä»¤ã€‚ 
ä¾‹å¦‚ï¼š</p>
<h1 id="lxc-create---n-test-f-conftxt-binbash-è¿è¡Œbash">lxc-create  -n test â€“f conf.txt /bin/bash #è¿è¡Œbash</h1>
<h1 id="lxc-start---n-test-binbash-è¿è¡Œbash">lxc-start  -n test /bin/bash #è¿è¡Œbash</h1>
<p>æ³¨æ„ï¼Œlxc-createç”¨äºåœ¨å®¹å™¨ä¸­è¿è¡Œä¸€ä¸ªåº”ç”¨ï¼Œè€Œlxc-startåˆ™ç”¨äºåœ¨å®¹å™¨ä¸­è¿è¡Œä¸€ä¸ªç³»ç»Ÿã€‚ 
3.2.2 lxc-stop 
lxc-stop  -n name 
ç»ˆæ­¢å®¹å™¨nameçš„è¿è¡Œã€‚ 
ä¾‹å¦‚ï¼š</p>
<h1 id="lxc-stop---n-test-ç»ˆæ­¢å®¹å™¨testçš„è¿è¡Œ">lxc-stop  -n test #ç»ˆæ­¢å®¹å™¨testçš„è¿è¡Œ</h1>
<p>3.3  lxc-console 
å¦‚æœåˆ›å»ºå®¹å™¨æ—¶å€™é…ç½®äº†ttyï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿æ¥åˆ°tty 
lxc-console  -n test   -t 3 #è¿æ¥åˆ°å®¹å™¨testçš„3å·ttyä¸Šã€‚ 
3.4 å†»ç»“å’Œè§£å†»å®¹å™¨ 
3.4.1  lxc-freeze 
lxc-freeze  -n name 
å†»ç»“æ‰€æœ‰åœ¨å®¹å™¨nameä¸­è¿è¡Œçš„ç¨‹åºï¼Œæ­¤å¤„å†»ç»“æ˜¯æŒ‡æŒ‚èµ·æ‰€æœ‰åœ¨æŒ‡å®šå®¹å™¨ä¸­è¿è¡Œçš„ç¨‹åºã€‚å¿…é¡»æ˜¾å¼çš„ä½¿ç”¨lxc-ufreezeå‘½ä»¤è§£é™¤å†»ç»“ã€‚ 
#lxc-freeze  -n  foo  #å†»ç»“å®¹å™¨fooä¸­è¿è¡Œçš„æ‰€æœ‰ç¨‹åº 
3.4.2  lxc-unfreeze 
lxc-unfreeze  -n  name 
è§£é™¤å®¹å™¨nameçš„å†»ç»“çŠ¶æ€. 
#lxc-ufreeze  -n  foo  #å°†fooä¸­å†»ç»“çš„ç¨‹åºæ¢å¤è¿è¡Œã€‚ 
æ³¨æ„ï¼šè¯¥åŠŸèƒ½éœ€è¦å†…æ ¸æ‰“å¼€ç›¸åº”çš„åŠŸèƒ½ï¼ 
3.5 è·å–å®¹å™¨çš„ä¿¡æ¯ 
3.5.1  lxc-ls 
åˆ—å‡ºç³»ç»Ÿä¸­å­˜åœ¨çš„æ‰€æœ‰å®¹å™¨ï¼Œé€‰é¡¹å’Œlså‘½ä»¤ç›¸åŒã€‚ 
3.5.2  lxc-info 
lxc-info  -n name 
åˆ—å‡ºå®¹å™¨nameçš„è¿è¡Œä¿¡æ¯ï¼šè¾“å‡ºæ ¼å¼å¦‚ä¸‹ï¼š 
name is stopped 
name is running 
3.5.3  lxc-ps 
æ˜¾ç¤ºç‰¹å®šå®¹å™¨çš„pidsï¼Œé€‰é¡¹å’Œpsç›¸åŒï¼Œä¸ºå†…ç½®çš„ps 
3.5.4  lxc-netstat 
æ˜¾ç¤ºæŒ‡å®šå®¹å™¨çš„ç½‘ç»œçŠ¶æ€ï¼Œè¯¥å‘½ä»¤å»ºç«‹åœ¨å‘½ä»¤netstatä¹‹ä¸Šï¼Œå› æ­¤æ¥å—äºnetstatç›¸åŒçš„å‚æ•°ã€‚ 
3.5.5  lxc-cgroup 
lxc-cgroup  -n name subsystem [value] 
æ˜¾ç¤ºæˆ–è€…è®¾ç½®ä¸æ§åˆ¶ç»„ç›¸å…³è”çš„å­ç³»ç»Ÿçš„å€¼ï¼Œå¦‚æœvalueæœªæŒ‡å®šåˆ™æ˜¾ç¤ºå…¶å€¼ï¼Œå¦åˆ™è®¾å®šç›¸åº”å­ç³»ç»Ÿçš„å€¼ã€‚ 
ä¾‹å¦‚ï¼š 
lxc-cgroup  -n foo devices.list   #æ˜¾ç¤ºå…è®¸å®¹å™¨fooä½¿ç”¨çš„è®¾å¤‡åˆ—è¡¨ 
lxc-cgroup  -n foo cpuset.cpus â€œ0,3â€  #å°†å¤„ç†å™¨0å’Œ3åˆ†é…ç»™å®¹å™¨foo 
3.6ç›‘æ§å®¹å™¨ 
3.6.1 lxc-monitor 
lxc-monitor  -n name 
ç›‘æ§æŒ‡å®šå®¹å™¨çš„çŠ¶æ€ï¼Œå…¶ä¸­åç§°ä¸ºæ­£åˆ™è¡¨è¾¾å¼ã€‚ 
ä¾‹å¦‚ï¼š 
lxc-monitor  -n  â€˜foo|barâ€™ #ç›‘æ§å®¹å™¨fooå’Œbar 
lxc-monitor  -n  â€˜.<em>â€™ #ç›‘æ§æ‰€æœ‰å®¹å™¨ 
lxc-monitor  -n  â€˜[f|b].</em>â€™  #ç›‘æ§æ‰€æœ‰åç§°ä»¥fæˆ–bå¼€å§‹çš„å®¹å™¨ 
3.6.2 lxc-wait 
lxc-wait  -n name  -s states 
ç­‰å¾…å®¹å™¨åˆ°è¾¾æŸä¸€çŠ¶æ€ï¼Œç„¶åé€€å‡ºï¼Œå…¶ä¸­stateså¯ä¸ºè‹¥å¹²çŠ¶æ€. 
ä¾‹å¦‚ï¼š 
lxc-wait  -n foo â€˜RUNNINGâ€™  #ç­‰å¾…å®¹å™¨åˆ°RUNNINGçŠ¶æ€ 
lxc-wait  -n foo â€˜RUNNING|STOPPEDâ€™  #ç­‰å¾…å®¹å™¨åˆ°è¾¾RUNNINGæˆ–è€…STOPPEDçŠ¶æ€ 
æ³¨æ„ï¼šå®¹å™¨çš„çŠ¶æ€åˆ†ä¸ºï¼šSTOPPED, STARTING ,RUNNING, STOPPING, ABORTING. 
3.6.3 lxc-kill 
lxc-kill  -n  name  SIGNUM 
lxc-killå°†ä¿¡å·SIGNUMå‘é€ç»™å®¹å™¨ä¸­çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ã€‚ 
ä¾‹å¦‚ï¼š 
lxc-kill  -n  foo 2 #å‘fooä¸­ç¬¬ä¸€ä¸ªè¿›ç¨‹å‘é€SIGINTä¿¡å· 
æ³¨æ„ï¼šå¦‚æœä½¿ç”¨lxc-executeè¿è¡Œçš„å‘½ä»¤ï¼Œä¿¡å·é¦–å…ˆå‘é€ç»™lxc-init,ç„¶ålxc-initå°†è¯¥ä¿¡å·ä¼ é€’ç»™è¿è¡Œçš„ç¬¬äºŒä¸ªè¿›ç¨‹ã€‚å¦‚æœå‘é€çš„ä¿¡å·ä½¿å¾—lxc-initè¿›ç¨‹ç»ˆæ­¢ï¼Œé‚£ä¹ˆè¯¥ä¿¡å·ä¸ä¼šä¼ é€’ç»™è¿è¡Œçš„ç¬¬äºŒä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸”å¯¼è‡´å®¹å™¨ä¸­å¾—åº”ç”¨ç»“æŸè¿è¡Œã€‚ 
4  lxcé…ç½® 
æ¯ä¸ªlxcå®¹å™¨éƒ½å¯¹åº”äºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯åœ¨ä½¿ç”¨lxc-createã€lxc-executeå’Œlxc-startå‘½ä»¤æ—¶æŒ‡å®šï¼Œå¦‚æœé€šè¿‡lxc-createåˆ›å»ºçš„å®¹å™¨ï¼Œåˆ™ä¼šåœ¨/var/lib/lxc/container-name/configä¸­ä¿å­˜è¯¥é…ç½®ã€‚é…ç½®ä¿¡æ¯åŒ…æ‹¬ï¼šä¸»æœºåã€ç½‘ç»œã€cgroupä¿¡æ¯ç­‰ã€‚lxcé…ç½®æ–‡ä»¶ä¸­æ¯ä¸€è¡Œé‡‡ç”¨key=valçš„å½¢å¼ï¼Œæ¯è¡Œä¿å­˜ä¸€ä¸ªé…ç½®é¡¹ã€‚æ³¨é‡Šä»¥#å¼€å¤´ã€‚ 
4.1 é…ç½®ä¸»æœºå 
lxc.utsname = foo #é…ç½®ä¸»æœºåä¸ºfoo 
4.2 é…ç½®å®¹å™¨ä½¿ç”¨çš„è™šæ‹ŸåŒ–ç½‘ç»œ 
lxc.network.type: æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„è™šæ‹ŸåŒ–ç½‘ç»œç±»å‹ï¼Œè¯¥åŸŸä¸€èˆ¬ä¸ºæ–°çš„ç½‘ç»œé…ç½®çš„å¼€å§‹ï¼Œå…¶å¯èƒ½å€¼ä¸ºï¼š 
å€¼	ç±»å‹ 
empty	åˆ›å»ºä»…æœ‰å›è·¯æ¥å£çš„ç½‘ç»œ 
veth	åˆ›å»ºä¸€ä¸ªå¯¹ç­‰ç½‘ç»œï¼Œè¯¥ç½‘ç»œçš„ä¸€ç«¯åˆ†é…ç»™å®¹å™¨ï¼Œå¦ä¸€ç«¯ä¸lxc.network.linkæŒ‡å®šçš„ç½‘æ¡¥è¿æ¥ã€‚å¦‚æœæœªæŒ‡å®šç½‘æ¡¥ï¼Œç«¯è®¾å¤‡ä¼šè¢«åˆ›å»ºä½†æ˜¯ä¸ä¼šè¿æ¥åˆ°ä»»ä½•ç½‘æ¡¥ä¸Šã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹lxcä¼šå¯¹å®¹å™¨å¤–çš„ç½‘ç»œè®¾å¤‡é€‰æ‹©ä¸€ä¸ªåå­—ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡lxc.network.veth.pairé€‰é¡¹æ¥æŒ‡å®šã€‚ 
vlan	åˆ›å»ºä¸€ä¸ªç”±lxc.network.linkæŒ‡å®šçš„è™šæ‹Ÿå±€åŸŸç½‘æ¥å£ï¼ˆç½‘å¡ï¼‰åˆ†é…ç»™å®¹å™¨ï¼Œvlançš„æ ‡è¯†ç¬¦å¯ç”±lxc.network.vlan.idæŒ‡å®šã€‚ 
phys	å°†ç”±lxc.network.linkæŒ‡å®šçš„å·²ç»å­˜åœ¨çš„æ¥å£ï¼ˆç½‘å¡ï¼‰åˆ†é…ç»™å®¹å™¨ã€‚ 
macvlan	åˆ›å»ºä¸€ä¸ªmacvlanæ¥å£ï¼Œè¯¥æ¥å£å’Œç”±lxc.network.linkæŒ‡å®šçš„æ¥å£ç›¸è¿æ¥ã€‚</p>

<p>lxc.network.flags:æŒ‡å®šç½‘ç»œå°†è¦æ‰§è¡Œçš„åŠ¨ä½œï¼Œå¯é€‰å€¼ä¸ºï¼š 
on:æ¿€æ´»æ¥å£ 
down:å…³é—­æ¥å£</p>

<p>lxc.network.link:æŒ‡å®šç”¨äºè¿›è¡ŒçœŸå®ç½‘ç»œé€šä¿¡çš„æ¥å£ï¼ˆç½‘å¡ï¼‰ã€‚</p>

<p>lxc.network.name:æŒ‡å®šç½‘ç»œæ¥å£çš„åç§°ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¥å£åç§°æ˜¯åŠ¨æ€åˆ†é…çš„ã€‚</p>

<p>lxc.network.hwaddr:æŒ‡å®šè™šæ‹Ÿç½‘ç»œæ¥å£ï¼ˆè™šæ‹Ÿç½‘å¡ï¼‰çš„MACåœ°å€ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å€¼è‡ªåŠ¨åˆ†é…ã€‚</p>

<p>lxc.network.ipv4:æŒ‡å®šåˆ†é…ç»™è™šæ‹Ÿç½‘å¡çš„ipv4åœ°å€ã€‚</p>

<p>lxc.network.ipv6:æŒ‡å®šåˆ†é…ç»™è™šæ‹Ÿç½‘å¡çš„ipv6åœ°å€ã€‚</p>

<p>4.3 å®¹å™¨ä¼ªç»ˆç«¯å’Œç³»ç»Ÿæ§åˆ¶å° 
lxc.pts:å¦‚æœè¯¥é¡¹è¢«è®¾ç½®ï¼Œå®¹å™¨å°†è¦æ‹¥æœ‰ä¸€ä¸ªæ–°çš„ä¼ªç»ˆç«¯ï¼Œå¹¶ä¸”è¯¥ç»ˆç«¯ä¸ºå®¹å™¨æ‰€ç§æœ‰ã€‚è¯¥å€¼æŒ‡å®šäº†è¯¥ä¼ªç»ˆç«¯å¯æ‹¥æœ‰çš„æœ€å¤§å®ä¾‹æ•°ã€‚</p>

<p>lxc.console:æŒ‡å®šæ§åˆ¶å°è¾“å‡ºæ–‡ä»¶çš„è·¯å¾„</p>

<p>lxc.tty:æŒ‡å®šå®¹å™¨å¯å¾—åˆ°çš„ttyæ•°é‡ï¼Œæ³¨æ„åœ¨inittabä¸­gettyçš„æ•°é‡ä¸èƒ½è¶…è¿‡æŒ‡å®šçš„å€¼ã€‚</p>

<p>4.4 æŒ‚è½½ç‚¹ 
lxc.mount:æŒ‡å®šåŒ…å«æŒ‚è½½ä¿¡æ¯çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…å®¹é‡‡ç”¨fstabæ ¼å¼ã€‚fstabæ ¼å¼å¦‚ä¸‹ï¼š 
spec    file    type    options    dump    pass 
spec:æ‰€éœ€åŠ è½½æ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨çš„è®¾å¤‡æˆ–è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿã€‚ 
file:æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç‚¹ã€‚ 
type:æ–‡ä»¶ç³»ç»Ÿç±»å‹. 
options:åŠ è½½æ–‡ä»¶ç³»ç»Ÿçš„å‚æ•°ã€‚ 
dump:æ–‡ä»¶ç³»ç»Ÿè½¬å‚¨é¢‘ç‡ï¼Œè‹¥ä¸éœ€è½¬å‚¨åˆ™ä¸º0. 
pass:å¯åŠ¨æ—¶æ‰«ææ–‡ä»¶ç³»ç»Ÿçš„é¡ºåºã€‚æ ¹æ–‡ä»¶ç³»ç»Ÿä¸º1,å…¶ä»–ä¸º2ï¼Œè‹¥å¯åŠ¨æ—¶æ— éœ€æ‰«æåˆ™ä¸º0. 
å¦‚ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„fstabæ–‡ä»¶ï¼š 
none  /lxc/rootfs.fedora/dev/pts  devpts defaults 0 0 
none  /lxc/rootfs.fedora/proc     proc  defaults 0 0 
none  /lxc/rootfs.fedora/sys      sysfs  defaults 0 0 
lxc.mount.entry: æŒ‡å®šä¸€ä¸ªæŒ‚è½½ç‚¹ï¼Œè¯¥è¡Œé‡‡ç”¨fstabæ ¼å¼ã€‚ 
4.5 æ ¹æ–‡ä»¶ç³»ç»Ÿ 
lxc.rootfs:æŒ‡å®šå®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œè‹¥è¯¥é¡¹æœªæŒ‡å®šï¼Œåˆ™é‡‡ç”¨å’Œä¸»æœºç›¸åŒçš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚ 
ä¾‹å¦‚ï¼š 
lxc.rootfs=/lxc/test/rootfs</p>

<p>lxc.rootfs.mount:æŒ‡å®šè°ƒç”¨pivot_rootå‰lxc.rootfsç»‘å®šç‚¹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚ 
å¤‡æ³¨ï¼špivot_rootæ”¹å˜æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œæ ¼å¼ä¸ºï¼špivot_root  new_root  put_oldã€‚pivot_rootå°†å½“å‰è¿›ç¨‹çš„æ ¹æ–‡ä»¶ç³»ç»Ÿç§»åŠ¨åˆ°ç›®å½•put_oldä¸‹ï¼Œå¹¶ä½¿å¾—new_rootä½œä¸ºæ–°çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚</p>

<p>lxc.pivotdir:æŒ‡å®šåŸå§‹æ ¹æ–‡ä»¶ç³»ç»Ÿåœ¨lxc.rootfsä¸‹çš„æ”¯ç‚¹ï¼ˆpivotï¼‰ã€‚ 
4.6 æ§åˆ¶ç»„é…ç½® 
4.6.1 æ§åˆ¶ç»„CPUé…ç½® 
lxc.cgroup.cpu.shares:è¯¥ç»„çš„CPUæ—¶é—´ä»½é¢ï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥å€¼ä¸º1024ã€‚é€šè¿‡å°†è¯¥å€¼ä¿®æ”¹ä¸ºè¾ƒå¤§å€¼ï¼Œåˆ™è¯¥ç»„ä¼šè·å¾—æ›´å¤šçš„CPUæ—¶é—´ï¼Œå¦åˆ™ï¼Œè¯¥ç»„è·å¾—çš„CPUæ—¶é—´ä¼šç›¸å¯¹è¾ƒå°‘ã€‚æ¯”å¦‚ç³»ç»Ÿä¸­ä»…å­˜åœ¨æ§åˆ¶ç»„Aå’ŒB ï¼Œè¿™ä¸¤ä¸ªç»„ä¸­cpu.sharesçš„å€¼åˆ†åˆ«ä¸º1024å’Œ2048ï¼Œåˆ™Aè·å¾—1/3çš„CPUæ—¶é—´ï¼ŒBè·å¾—2/3çš„æ—¶é—´ã€‚æ³¨æ„ï¼Œå­æ§åˆ¶ç»„è·å¾—CPUæ—¶é—´ä»½é¢ä¸èƒ½è¶…è¿‡å…¶çˆ¶æ§åˆ¶ç»„çš„CPUæ—¶é—´ä»½é¢ã€‚</p>

<p>lxc.cgroup.cpu.rt_period_us:è¯¥é¡¹æŒ‡å®šäº†æ§åˆ¶ç»„CUPèµ„æºåˆ†é…çš„å‘¨æœŸï¼Œä»¥é˜²æ­¢æŸäº›ä»»åŠ¡ä¸€ç›´å ç”¨CPUèµ„æºã€‚è¯¥é¡¹ä»¥å¾®ç§’ä¸ºå•ä½ã€‚ 
lxc.cgroup.cpu.rt_runtime_us :å®šä¹‰äº†åœ¨CUPèµ„æºåˆ†é…å‘¨æœŸå†…æ§åˆ¶ç»„ä¸­è¿ç»­å ç”¨çš„CPUèµ„æºçš„æ—¶é—´é•¿åº¦ï¼Œæ—¶é—´ä»¥å¾®ç§’ä¸ºå•ä½ã€‚æ¯”å¦‚CUPèµ„æºåˆ†é…å‘¨æœŸä¸º5sï¼Œæ§åˆ¶ç»„è¿ç»­å ç”¨æœ€é•¿æ—¶é—´ä¸º4sï¼Œåˆ™rt_period_us = 5000000ï¼Œrt_runtime_us=4000000ã€‚</p>

<p>4.6.2 å—è®¾å¤‡é…ç½® 
lxc.cgroup.blkio.weight:æŒ‡å®šå½“å‰ç»„å—è®¾å¤‡ä¼˜å…ˆçº§æƒé‡ï¼Œæƒé‡å…è®¸çš„èŒƒå›´ä¸º100~1000.</p>

<p>åœ¨æ§åˆ¶ç»„ä¸­å¦å¤–åªè¯»çš„é¡¹ï¼š 
blkio.time:æ§åˆ¶ç»„ä¸­æŒ‡å®šä½¿ç”¨å—è®¾å¤‡çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œæ ¼å¼ä¸ºï¼šmajor:minor timesï¼Œå…¶ä¸­å‰ä¸¤ä¸ªåŸŸä¸ºä¸»ä»è®¾å¤‡å·ï¼Œç¬¬ä¸‰ä¸ªåŸŸä¸ºæ—¶é—´ã€‚ 
blkio.sectors:ç»„ä¼ è¾“çš„æ‰‡åŒºæ•°ï¼Œæ ¼å¼ä¸ºï¼šmajor:minor sectorsï¼Œå…¶ä¸­å‰ä¸¤ä¸ªåŸŸä¸ºä¸»ä»è®¾å¤‡å·ï¼Œç¬¬ä¸‰ä¸ªåŸŸä¸ºä¼ è¾“çš„æ‰‡åŒºæ•°ã€‚</p>

<p>4.6.3 CUPè®¡æ•°ä¿¡æ¯ï¼ˆéé…ç½®ä¿¡æ¯ï¼‰ 
åœ¨æ§åˆ¶ç»„ä¸­cpuæ—¶é—´ç»Ÿè®¡ä¿¡æ¯é¡¹ï¼š 
cpuacct.stat:æ˜¾ç¤ºCPUæ—¶é—´ä¿¡æ¯ï¼Œæ˜¾ç¤ºä¿¡æ¯åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šuserå’Œsystemï¼Œåˆ†åˆ«ä¸ºç”¨æˆ·æ€å’Œå†…æ ¸æ€è¿è¡Œçš„æ—¶é—´ã€‚ 
cpuacct.usage:æ˜¾ç¤ºæ§åˆ¶ç»„ä¸­è¿›ç¨‹æ¶ˆè€—çš„cpuæ—¶é—´ç»Ÿè®¡ã€‚å¯é€šè¿‡å‘è¯¥æ–‡ä»¶ä¸­å†™å…¥0æ¥æ¸…ç©ºæ—¶é—´è®¡æ•°ã€‚ 
cpuacct.usage_percpu:æ˜¾ç¤ºæ§åˆ¶ç»„ä¸­æ¯ä¸ªcpuæ—¶é—´ç»Ÿè®¡ã€‚</p>

<p>4.6.4 CPUé›†åˆé…ç½® 
lxc.cgroup.cpuset.cpus:åœ¨cpusetä¸­å¾—cpuåˆ—è¡¨ã€‚åˆ—è¡¨ä¸­cpuä»0å¼€å§‹ç¼–å·ï¼Œå¦‚æœç³»ç»Ÿä¸­å­˜åœ¨100ä¸ªcpué‚£ä¹ˆcpuçš„ç¼–å·ä¸º0~99. 
ä¾‹å¦‚ï¼š 
lxc.cgroup.cpuset.cpus = 0-9  #å°†0åˆ°9å·CPUåˆ†é…ç»™è¯¥ç»„ 
lxc.cgroup.cpuset.cpus = 0,3,4-6 #å°†0,3,4,5,6å·CPUåˆ†é…ç»™è¯¥ç»„ 
æ³¨æ„ï¼šè¯¥é¡¹æŒ‡å®šçš„CPUé›†åˆå¿…é¡»ä¸ºçˆ¶cpué›†åˆçš„å­é›†ã€‚</p>

<p>lxc.cgroup.cpuset.mems:åˆ†é…ç»™è¯¥cpusetçš„å†…å­˜èŠ‚ç‚¹åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š 
lxc.cgroup.cpuset.mems = 0,1 #å°†å†…å­˜èŠ‚ç‚¹0å’Œ1åˆ†é…ç»™è¯¥ç»„</p>

<p>lxc.cgroup.cpuset.memory_migrate: å¦‚æœè¯¥é¡¹è®¾ç½®ä¸ºçœŸï¼Œå½“å°†ä¸€ä¸ªä»»åŠ¡è¿æ¥åˆ°æ–°çš„cpusetæ—¶ï¼Œä»»åŠ¡æ‰€åœ¨å‰cpusetä¸­åˆ†é…ç»™è¯¥ä»»åŠ¡çš„é¡µä¹Ÿè¢«è¿ç§»åˆ°æ–°çš„cpusetä¸­ï¼Œå¹¶ä¸”å°è¯•ç¡®ä¿é¡µæ‰€åœ¨èŠ‚ç‚¹åˆ—è¡¨çš„ç›¸å¯¹ä½ç½®ä¸å˜ã€‚æ¯”å¦‚ï¼Œåˆ†é…ç»™ä»»åŠ¡çš„æŸä¸€é¡µåœ¨å‰cpusetå†…å­˜èŠ‚ç‚¹ä¸­çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹ä¸­ï¼Œåˆ™è¿ç§»æ—¶ä¼šå°è¯•å°†å…¶æ”¾åˆ°æ–°çš„cpusetå†…å­˜èŠ‚ç‚¹åˆ—è¡¨ä¸­ç¬¬äºŒä¸ªå†…å­˜èŠ‚ç‚¹ä¸­ã€‚æ­¤å¤–ï¼Œå¦‚æœè®¾å®šäº†è¯¥é¡¹ï¼Œå½“cpusetä¸­çš„å†…å­˜èŠ‚ç‚¹åˆ—è¡¨ï¼ˆcpuset.memsï¼‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåˆ†é…ç»™ä»»åŠ¡çš„é¡µè¢«è¿ç§»åˆ°æ–°çš„å†…å­˜èŠ‚ç‚¹åˆ—è¡¨çš„èŠ‚ç‚¹ä¸­ã€‚</p>

<p>lxc.cgroup.cpuset.cpu_exclusive:cpusetä¸­cpuç‹¬å æ ‡è®°ï¼Œåªæœ‰åœ¨çˆ¶cpusetè®¾å®šè¯¥é¡¹åï¼Œå­cpusetæ‰å¯è®¾ç½®è¯¥é¡¹ã€‚å½“è®¾å®šè¯¥é¡¹åï¼Œé™¤äº†ç¥–å…ˆå’Œåä»£cpusetå¤–ï¼Œlxc.cgroup.cpuset.cpusæŒ‡å®šçš„cpuä¸å…è®¸å‡ºç°åœ¨ä»»ä½•å…¶ä»–cpusetçš„cpuåˆ—è¡¨ä¸­ã€‚</p>

<p>lxc.cgroup.cpuset.mem_exclusive:cpusetä¸­å†…å­˜èŠ‚ç‚¹ç‹¬å æ ‡è®°ã€‚é…ç½®è§„åˆ™å’Œlxc.cgroup.cpuset.cpu_exclusiveç›¸åŒã€‚</p>

<p>lxc.cgroup.cpuset.memory_hadwall:è¯¥é¡¹æŒ‡å®šå†…æ ¸åˆ†é…å†…å­˜é¡µå’Œç¼“å­˜æ•°æ®æ—¶æ˜¯å¦ä»…é™äºä»åˆ†é…ç»™cpusetçš„å†…å­˜èŠ‚ç‚¹ä¸­åˆ†é…ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥é¡¹æ˜¯å…³é—­çš„ï¼Œå†…æ ¸åˆ†é…çš„å†…å­˜é¡µå’Œç¼“å­˜ç”±å¤šä¸ªç”¨æˆ·æ‰€å…±äº«ã€‚</p>

<p>lxc.cgroup.cpuset.memory_spread_pageå’Œlxc.cgroup.cpuset.memory_spread_slab:è¿™ä¸¤é¡¹æ§åˆ¶å†…æ ¸åº”è¯¥ä»ä»€ä¹ˆåœ°æ–¹åˆ†é…æ–‡ä»¶ç³»ç»Ÿå’Œç›¸å…³å†…æ ¸æ•°æ®ç»“æ„æ‰€éœ€çš„é¡µã€‚å¦‚æœlxc.cgroup.cpuset.memory_spread_pageé¡¹ä¸ºçœŸï¼Œé‚£ä¹ˆå†…æ ¸å€¾å‘äºåœ¨å‘ç”Ÿç¼ºé¡µçš„ä»»åŠ¡å…è®¸ä½¿ç”¨çš„æ‰€æœ‰å†…å­˜èŠ‚ç‚¹ä¸­å‡åŒ€çš„åˆ†é…å†…å­˜ï¼›å¦åˆ™ï¼Œä¼šå€¾å‘äºåœ¨ä»»åŠ¡è¿è¡Œçš„èŠ‚ç‚¹ä¸Šåˆ†é…å†…å­˜ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸¤é¡¹æ˜¯å…³é—­çš„ã€‚ 
ä¾‹å¦‚ï¼š 
lxc.cgroup.cpuset.memory_spread_page = 1 # æ‰“å¼€spread page cacheåŠŸèƒ½ 
lxc.cgroup.cpuset.memory_spread_slab = 0 # å…³é—­spread slab cacheåŠŸèƒ½</p>

<p>lxc.cgroup.cpuset.sched_load_balance:å¦‚æœè®¾å®šè¯¥é¡¹ä¸ºçœŸï¼Œå†…æ ¸ä¼šå¯¹æ•´ä¸ªcpusetä¸­å¾—æ‰€æœ‰CPUè¿›è¡Œè´Ÿè½½å¹³è¡¡è°ƒåº¦ã€‚ 
æ³¨æ„ï¼šå¦‚æœä¸¤ä¸ªé‡å çš„cpusetå‡æ‰“å¼€äº†è¯¥é¡¹ï¼Œé‚£ä¹ˆå®ƒä»¬å¿…é¡»åœ¨åŒä¸€ä¸ªè°ƒåº¦åŸŸä¸­ã€‚</p>

<p>lxc.cgroup.cpuset.sched_relax_domain_level:è¯·æ±‚å†…æ ¸æ”¹å˜è¿›è¡Œè´Ÿè½½å¹³è¡¡æ—¶çš„CPUæœç´¢èŒƒå›´ï¼Œå¦‚æœlxc.cgroup.cpuset.sched_load_balanceä¸ºå‡ï¼Œåˆ™è¯¥é¡¹ä¸èµ·ä½œç”¨ã€‚å…¶å¯é€‰ç­‰çº§å¦‚ä¸‹ï¼š 
-1  : no request. use system default or follow request of others. 
   0  : no search. 
   1  : search siblings (hyperthreads in a core). 
   2  : search cores in a package. 
   3  : search cpus in a node [= system wide on non-NUMA system] 
( 4  : search nodes in a chunk of node [on NUMA system] ) 
( 5  : search system wide [on NUMA system] ) 
4.6.5 è®¾å¤‡ç™½åå• 
lxc.cgroup.devices.allow:å°†è®¾å¤‡æ·»åŠ åˆ°ç™½åå•ä¸­ã€‚ 
lxc.cgroup.devices.deny:å°†è®¾å¤‡ä»ç™½åå•ä¸­åˆ é™¤ã€‚ 
å½“å‰æ§åˆ¶ç»„ä¸­çš„ç™½åå•åˆ—è¡¨å¯ä»devices.listä¸­å¾—åˆ°ï¼Œç™½åå•åˆ—è¡¨çš„æ¯ä¸ªå…¥å£åŒ…å«å››ä¸ªåŸŸï¼Œå…¶å½¢å¼å¦‚ä¸‹ï¼š 
type    major:minor  access 
å…¶ä¸­typeå¯é€‰å€¼ä¸ºï¼ša , c , b ï¼Œaè¡¨ç¤ºæ‰€æœ‰è®¾å¤‡ï¼Œcä¸ºå­—ç¬¦è®¾å¤‡ï¼Œbä¸ºå—è®¾å¤‡ã€‚ 
majorå’Œminorä¸ºè®¾å¤‡çš„ä¸»ä»è®¾å¤‡å·ï¼Œç”¨æ•´æ•°æˆ–è€…<em>è¡¨ç¤ºæ‰€æœ‰è®¾å¤‡ã€‚ 
accessä¸ºè®¿é—®æƒé™çš„ç»“åˆr(è¯»)ï¼Œw(å†™)å’Œm(mknod)ã€‚ 
ä¾‹å¦‚ï¼š 
c   1:3   mr #å…è®¸å¯¹/dev/nullè¿›è¡Œè¯»å’Œmknodeæ“ä½œã€‚ 
a   *:</em>   rwm  #å…è®¸å¯¹æ‰€æœ‰è®¾å¤‡è¿›è¡Œè¯»å†™å’Œmknodeæ“ä½œã€‚</p>

<p>4.6.6 å†…å­˜é…ç½® 
lxc.cgroup.memory.limit_in_bytes:å½“å‰ç»„çš„å†…å­˜ä½¿ç”¨çš„æœ€å¤§æ•°ã€‚ 
ä¾‹å¦‚ï¼š 
lxc.cgroup.memory.limit_in_bytes = 4096  #è®¾å®šå†…å­˜é™åˆ¶ä¸º4094å­—èŠ‚ 
lxc.cgroup.memory.limit_in_bytes = 4K #è®¾å®šå†…å­˜é™åˆ¶ä¸º4K 
lxc.cgroup.memory.limit_in_bytes = 256M #è®¾å®šå†…å­˜é™åˆ¶ä¸º256M 
lxc.cgroup.memory.limit_in_bytes = 1G #è®¾å®šå†…å­˜é™åˆ¶ä¸º1Gå­—èŠ‚ 
lxc.cgroup.memory.limit_in_bytes = -1 #è®¾å®šå†…å­˜ä¸ºæ— é™åˆ¶</p>

<p>lxc.cgroup.memory.memsw.limit_in_bytes:è®¾å®šå½“å‰ç»„ä¸­å†…å­˜+å¯¹æ¢ç©ºé—´çš„é™åˆ¶ï¼Œè®¾å®šæ–¹å¼å’Œlxc.cgroup.memory.limit_in_bytesç›¸åŒï¼Œä½†éœ€ä¿è¯lxc.cgroup.memory.limit_in_bytes &lt;= lxc.cgroup.memory.memsw.limit_in_bytes.</p>

<p>lxc.cgroup.memory.soft_limit_in_bytes:è®¾å®šå†…å­˜è½¯é™åˆ¶ï¼Œè¿™ä½¿å¾—ç³»ç»Ÿæ›´å¤§ç¨‹åº¦ä¸Šçš„å…±äº«å†…å­˜ï¼Œå½“ç³»ç»Ÿæ£€æµ‹åˆ°å†…å­˜äº‰ç”¨å’ŒçŸ­ç¼ºæ—¶ï¼Œæ§åˆ¶ç»„çš„å†…å­˜é™åˆ¶è¢«é€€å›åˆ°è½¯é™åˆ¶ï¼Œé˜²æ­¢å¯¼è‡´å…¶ä»–æ§åˆ¶ç»„é¥¥é¥¿çš„å‘ç”Ÿã€‚è®¾å®šè¯¥å€¼æ—¶ä¸€èˆ¬è¦å°äºç¡¬é™åˆ¶ï¼Œå¦åˆ™è¯¥å€¼ä¼šè¢«ç¡¬é™åˆ¶æ‰€è¦†ç›–ã€‚</p>

<p>lxc.cgroup.memory.use_hierarchy:æ‰“å¼€å†…å­˜çš„å±‚æ¬¡è®°è´¦åŠŸèƒ½,æ³¨æ„å¦‚æœçˆ¶æ§åˆ¶ç»„å·²ç»æ‰“å¼€è¯¥åŠŸèƒ½ï¼Œåˆ™å­æ§åˆ¶ç»„å¯¹è¯¥é¡¹çš„è®¾ç½®å°†ä¸èµ·ä½œç”¨ã€‚</p>

<p>lxc.cgroup.memory.swappiness:è®¾å®šæ§åˆ¶ç»„çš„å¯¹æ¢åŒºçš„å¤§å°ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ä¸º60ã€‚å¯é€‰å€¼ä¸º0~100ã€‚</p>

<p>å†…å­˜å­ç³»ç»Ÿå…¶ä»–æŠ¥å‘Šä¿¡æ¯é¡¹ï¼š 
memory.stat:æ˜¾ç¤ºå†…å­˜ä½¿ç”¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ 
memory.usage_in_bytes:æŠ¥å‘Šå½“å‰å®¹å™¨ä¸­åº”ç”¨ä½¿ç”¨çš„å†…å­˜é‡(å­—èŠ‚)ã€‚ 
memory.memsw.usage_in_bytes:æŠ¥å‘Šå½“å‰å®¹å™¨ä½¿ç”¨çš„å†…å­˜+å¯¹æ¢ç©ºé—´çš„æ€»é‡ã€‚ 
memory.max_usage_in_bytes:æŠ¥å‘Šå®¹å™¨ä¸­å†…å­˜ä½¿ç”¨é‡çš„æœ€å¤§å€¼ã€‚ 
memory.memsw.max_usage_in_bytes:æŠ¥å‘Šå†…å­˜+å¯¹æ¢ç©ºé—´çš„æœ€å¤§ä½¿ç”¨é‡ã€‚ 
memory.failcnt:åº”ç”¨ä½¿ç”¨å†…å­˜æ•°é‡è¾¾åˆ°memory.limit_in_bytesçš„æ¬¡æ•°ã€‚ 
memory.memsw_failcnt:åº”ç”¨ä½¿ç”¨å†…å­˜+å¯¹æ¢ç©ºé—´æ•°é‡è¾¾åˆ°memory.memsw.limit_in_bytesçš„æ¬¡æ•°ã€‚</p>

<p>4.6.7 å†·å†»é…ç½® 
lxc.cgroup.freezer.state:æŒ‚èµ·æˆ–è€…æ¢å¤æ§åˆ¶ç»„ä¸­çš„ä»»åŠ¡ï¼Œå…¶å¯é€‰å€¼å¦‚ä¸‹ï¼š 
FROZEN:æŒ‚èµ·æ§åˆ¶ç»„ä¸­å¾—ä»»åŠ¡ 
THAWED:æ¢å¤æ§åˆ¶ç»„ä¸­ä»»åŠ¡çš„è¿è¡Œã€‚ 
åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®è¯¥é¡¹ä¸ºFROZENå¯ä½¿å¾—åº”ç”¨åœ¨å®¹å™¨å¼€å§‹è¿è¡Œçš„çŠ¶æ€ä¸ºæŒ‚èµ·çŠ¶æ€ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹è¯¥å€¼è®¾å®šä¸ºTHAWEDã€‚æ³¨æ„ï¼Œæ— æ³•å‘å¤„äºå†·å†»çŠ¶æ€çš„æ§åˆ¶ç»„ä¸­æ·»åŠ ä»»åŠ¡ã€‚</p>

<p>4.6.8 ç½‘ç»œé€šä¿¡é…ç½® 
net_clså­ç³»ç»Ÿé€šè¿‡å¯¹ç½‘ç»œåŒ…è¿›è¡Œæ ‡è®°ä»è€Œä½¿å¾—linuxæµé‡æ§åˆ¶å™¨(tc)è¯†åˆ«ç½‘ç»œæŠ¥æ¥è‡ªäºé‚£ä¸ªç‰¹å®šçš„æ§åˆ¶ç»„ï¼Œä»è€Œè·å¾—è¯¥ç½‘ç»œåŒ…çš„ä¼˜å…ˆçº§ã€‚ 
lxc.cgroup.net_cls.classid:è¯¥å€¼æŒ‡ç¤ºäº†å½“å‰æ§åˆ¶ç»„çš„ç±»åˆ«å¥æŸ„ï¼ˆhandleï¼‰,è¯¥å€¼é‡‡ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºã€‚å¥æŸ„çš„æ ¼å¼å¦‚ä¸‹ï¼š0xAAAABBBBå…¶ä¸­AAAAæ˜¯åå…­è¿›åˆ¶ä¸»IDå·ï¼ŒBBBBæ˜¯åå…­è¿›åˆ¶ä»IDå·ï¼Œæ¯”å¦‚0x100001è¡¨ç¤º10:1(iproute2å·¥å…·é›†ä½¿ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºå¥æŸ„ID)ã€‚æ­¤å¤„è®¾å®šçš„ä¸ºlinuxæµé‡æ§åˆ¶å™¨ä¸­çš„ç±»æ ‡è¯†ç¬¦ã€‚å…·ä½“å¯å‚è€ƒTCç›¸å…³ä¿¡æ¯ã€‚</p>

<p>4.6.9 æƒé™é…ç½® 
å¦‚æœå®¹å™¨ä½œä¸ºè¶…çº§ç”¨æˆ·è¿è¡Œï¼ŒæŒ‡å®šå…¶å¯æ”¾å¼ƒçš„æƒé™ã€‚ 
lxc.cap.drop:æŒ‡å®šå®¹å™¨æ”¾å¼ƒçš„æƒé™ã€‚è¯¥è¡ŒæŒ‡å®šäº†ä¸€äº›ç”¨ç©ºæ ¼åˆ†éš”çš„æƒé™ã€‚æƒé™çš„æ ¼å¼ä¸ºç›¸åº”æƒé™å®šä¹‰é™¤å»CAP_å‰ç¼€åçš„å°å†™å½¢å¼ï¼Œæ¯”å¦‚CAP_SYS_MODULEä½¿ç”¨sys_moduleæŒ‡å®šï¼Œé€šè¿‡æŒ‡å®šsys_chrootå¯å‰¥å¤ºå®¹å™¨ä¸­æ‰€æœ‰è¿›ç¨‹è¿›è¡Œchrootçš„æƒé™ï¼Œé™„å½•7.3ä¸­æ˜¾ç¤ºå®¹å™¨æ”¾å¼ƒçš„æ‰§è¡Œæƒé™ï¼Œæ³¨æ„ï¼Œè¢«å‰¥å¤ºçš„æƒé™ä¸èƒ½è¢«æ¢å¤ï¼Œå³ä½¿rootä¹Ÿæ²¡æœ‰æƒé™æ¥æ¢å¤è¢«å‰¥å¤ºçš„æƒé™ï¼Œåªèƒ½é‡å¯ç³»ç»Ÿæˆ–è€…é‡æ–°è¿è¡Œå®¹å™¨å¹¶å°†ç›¸åº”é…ç½®é€‰é¡¹ç§»é™¤ã€‚ 
ä¾‹ï¼š 
lxc.cap.drop = sys_module mknod setuid net_raw 
lxc.cap.drop = mac_override 
lxc.cap.drop = sys_chroot</p>

<p>4.6.10 å…¶ä»–é…ç½®é¡¹ 
notify_on_release:å½“è¯¥é¡¹è¢«æ‰“å¼€æ—¶ï¼Œåœ¨æ§åˆ¶ç»„æœ€åä¸€ä¸ªç¨‹åºç»“æŸæ—¶ï¼Œå†…æ ¸æ‰§è¡Œç”±release_agentæŒ‡å®šçš„ç¨‹åºã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹è¯¥é¡¹æ˜¯å…³é—­çš„ã€‚</p>

<p>release_agent:ä¿å­˜æ§åˆ¶ç»„ä¸­æœ€åä¸€ä¸ªç¨‹åºç»“æŸè¿è¡Œæ—¶æ‰§è¡Œçš„ç¨‹åºçš„è·¯å¾„ï¼Œè¯¥é¡¹åªåœ¨æ ¹æ§åˆ¶ç»„ä¸­å‡ºç°ã€‚</p>

<p>5 è¿æ¥å®¹å™¨å®ä¾‹ 
5.1 è¿è¡ŒFedoraåŸºæœ¬å®‰è£…è™šæ‹Ÿæœº 
1ï¼‰å®‰è£…febootstrapå·¥å…· 
yum install febootstrap 
2) ç”ŸæˆfedoraåŸºæœ¬å®‰è£…ç³»ç»Ÿ 
mkdir  /lxc 
cd  /lxc 
febootstrap   fedora-13  rootfs.fedora 
åœ¨rootfs.fedoraç›®å½•ä¸‹ç”Ÿæˆäº†åŸºæœ¬å®‰è£…çš„fedora13ç³»ç»Ÿã€‚ 
3) åŸºæœ¬å®‰è£…æ–‡ä»¶ä¸èƒ½ç›´æ¥åœ¨linuxå®¹å™¨ä½¿ç”¨ï¼Œéœ€åšå¦‚ä¸‹ä¿®æ”¹ï¼š 
1ã€ç”±äºudevä¸åœ¨lxcå®¹å™¨ä¸­è¿è¡Œï¼Œé¦–å…ˆéœ€è¦äººå·¥åˆ›å»ºéœ€è¦çš„è®¾å¤‡ï¼Œç¼–å†™è„šæœ¬å¦‚ä¸‹ï¼š 
#!/bin/bash</p>

<p>ROOT=$(pwd) 
DEV=${ROOT}/dev 
if [ $ROOT = â€˜/â€™ ]; then 
printf â€œ\033[22;35m\nDO NOT RUN ON THE HOST NODE\n\nâ€ 
tput sgr0 
exit 1 
fi 
if [ ! -d $DEV ]; then 
printf â€œ\033[01;33m\nRun this script in rootfs\n\nâ€ 
tput sgr0 
exit 1 
fi 
rm -rf ${DEV} 
mkdir ${DEV} 
mknod -m 666 ${DEV}/null c 1 3 
mknod -m 666 ${DEV}/zero c 1 5 
mknod -m 666 ${DEV}/random c 1 8 
mknod -m 666 ${DEV}/urandom c 1 9 
mkdir -m 755 ${DEV}/pts 
mkdir -m 1777 ${DEV}/shm 
mknod -m 666 ${DEV}/tty c 5 0 
mknod -m 666 ${DEV}/tty0 c 4 0 
mknod -m 666 ${DEV}/tty1 c 4 1 
mknod -m 666 ${DEV}/tty2 c 4 2 
mknod -m 666 ${DEV}/tty3 c 4 3 
mknod -m 666 ${DEV}/tty4 c 4 4 
mknod -m 600 ${DEV}/console c 5 1 
mknod -m 666 ${DEV}/full c 1 7 
mknod -m 600 ${DEV}/initctl p 
mknod -m 666 ${DEV}/ptmx c 5 2</p>

<p>exit 0 
ä¿å­˜åˆ°/usr/local/bin/lxc-configä¸­ï¼Œå¹¶æ·»åŠ å¯æ‰§è¡Œæƒé™ã€‚ 
chmod u+x /usr/local/bin/lxc-config</p>

<p>åˆ‡æ¢åˆ°rootfs.fedoraä¸‹è¿è¡Œè¯¥è„šæœ¬ï¼š 
cd  /lxc/rootfs.fedora 
/usr/local/bin/lxc-config</p>

<p>2ã€é…ç½®rootfs.fedora 
cp /etc/resolv.conf /lxc/rootfs.fedora/etc 
chroot  /lxc/rootfs.fedora  /bin/bash 
#æŒ‚è½½proc , sys, /dev/pts 
mount  -t proc none /proc 
mount  -t sysfs none /sys 
mount  -t devpts none /dev/pts 
#æ·»åŠ ä¸€äº›åº”ç”¨ 
yum update 
yum  -y  reinstall  glibc-common 
yum  install  httpd  php-mysql  mysql-server  nano openssh-clients vim 
#åœ¨/ä¸‹æ·»åŠ ä¸€äº›å¿…è¦çš„æ–‡ä»¶ 
touch  /etc/fstab 
rm  /etc/mtab 
ln  -s  /proc/mounts   /etc/mtab 
#å¸è½½proc ,syså’Œ/dev/pts 
umount  -t proc none /proc 
umount  -t sysfs none /sys 
umount  -t devpts none  /dev/pts 
#è®¾å®šæ ¹å¯†ç  
passwd 
3ã€æ ¹æ–‡ä»¶ç³»ç»Ÿé…ç½® 
ç¼–è¾‘/lxc/rootfs.feodar/etc/sysconfig/initæ–‡ä»¶ï¼Œå°†æœ€åä¸€è¡Œæ”¹ä¸ºï¼š 
ACTIVE_CONSOLES = /dev/tty[1-4] 
ç¼–è¾‘/lxc/rootfs.fedora/etc/rc.sysinitå°†ä¸‹è¡Œæ³¨é‡Šæ‰ï¼š 
/sbin/start_udev 
ç¼–è¾‘/lxc/rootfs.fedora/etc/sysconfig/networkæ·»åŠ å¦‚ä¸‹ä¸¤è¡Œï¼š 
NETWORKING=yes 
HOSTNAME=fedora 
4ã€åˆ›å»ºlxcé…ç½®æ–‡ä»¶/lxc/config.fedora 
lxc.utsname = fedora 
lxc.tty = 4 
lxc.network.type = veth 
lxc.network.flags = up 
lxc.network.link = br0 
lxc.network.name = eth0 
lxc.network.mtu = 1500 
lxc.network.ipv4 = 192.168.0.65/24 
lxc.rootfs = /lxc/rootfs.fedora 
lxc.mount = /lxc/fstab.fedora 
lxc.cgroup.devices.deny = a</p>
<h1 id="devnull-and-zero-1">/dev/null and zero</h1>
<p>lxc.cgroup.devices.allow = c 1:3 rwm 
lxc.cgroup.devices.allow = c 1:5 rwm</p>
<h1 id="consoles-1">consoles</h1>
<p>lxc.cgroup.devices.allow = c 5:1 rwm 
lxc.cgroup.devices.allow = c 5:0 rwm 
lxc.cgroup.devices.allow = c 4:0 rwm 
lxc.cgroup.devices.allow = c 4:1 rwm</p>
<h1 id="devurandom-1">/dev/{,u}random</h1>
<p>lxc.cgroup.devices.allow = c 1:9 rwm 
lxc.cgroup.devices.allow = c 1:8 rwm</p>
<h1 id="devpts---pts-namespaces-are-coming-soon">/dev/pts/* - pts namespaces are â€œcoming soonâ€</h1>
<p>lxc.cgroup.devices.allow = c 136:* rwm 
lxc.cgroup.devices.allow = c 5:2 rwm</p>
<h1 id="rtc-1">rtc</h1>
<p>lxc.cgroup.devices.allow = c 254:0 rwm</p>

<p>5ã€åˆ›å»ºfstabæ–‡ä»¶/lxc/fstab.fedora 
none /lxc/rootfs.fedora/dev/pts devpts defaults 0 0 
none /lxc/rootfs.fedora/proc proc defaults 0 0 
none /lxc/rootfs.fedora/sys sysfs defaults 0 0 
/etc/resolv.conf /lxc/rootfs.fedora/etc/resolv.conf none bind 0 0</p>

<p>6ã€åˆ é™¤ä¸å¿…è¦çš„initè„šæœ¬ 
åˆ é™¤/lxc/rootfs.fedora/etc/initç›®å½•ä¸‹ï¼Œé™¤ä¸‹è¿°æ–‡ä»¶å¤–çš„æ‰€æœ‰æ–‡ä»¶ï¼š 
rc.conf 
start-ttys.conf 
tty.conf 
å°†rc.confå’Œstart-ttys.confç¬¬ä¸€è¡Œä¿®æ”¹ä¸º 
start  on  startup 
å°†rc.confä¸­æœ€åä¸€è¡Œçš„ 
exec  /etc/rc.d/rc  $RUNLEVEL 
ä¿®æ”¹ä¸ºï¼š 
exec  /etc/rc.d/rc.fedora 
åˆ›å»º/lxc/rootfs.fedora/etc/rc.d/rc.fedora 
#!/bin/bash 
route  add default  gw 192.168.1.1 
/etc/init.d/rsyslog  start  &amp; 
/etc/init.d/iptables  start  &amp; 
/etc/init.d/sshd  start  &amp; 
/etc/init.d/mysqld  start  &amp; 
/etc/init.d/httpd  start &amp; 
å°†å…¶å±æ€§è®¾ç½®ä¸ºå¯æ‰§è¡Œï¼š 
chmod  u+x  /lxc/rootfs.fedora/etc/rc.d/rc.fedora</p>

<p>åˆ é™¤/lxc/rootfs.fedora/etc/init.dç›®å½•ä¸‹é™¤ä¸‹è¿°æ–‡ä»¶å¤–çš„æ‰€æœ‰æ–‡ä»¶ï¼š 
httpd 
iptables 
mysqld 
rsyslog 
sshd</p>

<p>4) åˆ›å»ºlinuxå®¹å™¨ 
åˆ›å»ºç½‘æ¡¥: 
brctl add br0 
brctl setfd br0 0 
brctl addif br0 eth0 
ifconfig br0 192.168.74.130 up  #æ­¤å¤„åº”ä¸ºæœ¬æœºIPåœ°å€ 
ifconfig eth0 0.0.0.0 up 
route add -net default gw 192.168.74.2 br0  #è®¾ç½®ç½‘å…³</p>

<p>åˆ›å»ºå®¹å™¨ 
lxc-create  -f /lxc/config.fedora  -n fedora 
è¿è¡Œå®¹å™¨ 
lxc-start  -n  fedora   #lxc-startåœ¨æœªæŒ‡å®šè¿è¡Œçš„å‘½ä»¤çš„æƒ…å†µä¸‹é»˜è®¤æ‰§è¡Œinitç¨‹åº 
è¿æ¥åˆ°è¯¥å®¹å™¨ï¼Œä½ ä¼šçœ‹åˆ°ç™»é™†ç•Œé¢: 
lxc-console  -n fedora</p>

<p>æ³¨æ„ï¼šåœ¨ç™»é™†åéœ€ç”¨æ ¹ç”¨æˆ·æ·»åŠ ç½‘å…³æ‰èƒ½è”ç½‘ï¼š 
route add -net default gw 192.168.74.2 eth0</p>

<p>6 ç½‘ç»œæµé‡é…ç½® 
6.1  lxcè¿è¡Œè™šæ‹Ÿæœºç½‘ç»œæµé‡é…ç½® 
linuxå®¹å™¨é€šè¿‡å†…æ ¸æµé‡æ§åˆ¶å­ç³»ç»Ÿï¼ˆtraffic control subsystemï¼‰å¯¹æµé‡è¿›è¡Œé™åˆ¶ï¼Œé…ç½®æ–‡ä»¶ä¸­lxc.net_cls.classidæŒ‡ç¤ºäº†æµé‡æ§åˆ¶å™¨ä¸­ç±»çš„æ ‡ç¤ºã€‚ç°åœ¨é‡‡ç”¨åŸºäºå®¹å™¨IPåœ°å€çš„æ–¹æ³•ï¼Œä½¿ç”¨å¦‚ä¸‹è„šæœ¬åˆ©ç”¨TCå·¥å…·åˆ›å»ºHTBé˜Ÿåˆ—è§„åˆ™ï¼Œtcå‘½ä»¤çš„ä½¿ç”¨å¯å‚è€ƒé™„å½•å’Œå‚è€ƒéƒ¨åˆ†ï¼š 
Shellä»£ç   æ”¶è—ä»£ç 
#!/bin/bash</p>

<p>#remove all classful qdisc first<br />
tc qdisc del dev eth0 root</p>

<p>#create root htb qdisc, specify all unclassified packet into subclass 4<br />
tc qdisc add dev eth0 root handle 1:0 htb default 4</p>

<p>#create subclasses<br />
tc class add dev eth0 parent 1:0 classid 1:2 htb rate 256kbps ceil 512kbps prio 0<br />
tc class add dev eth0 parent 1:0 classid 1:3 htb rate 128kbps ceil 256kbps prio 1<br />
tc class add dev eth0 parent 1:0 classid 1:4 htb rate 64kbps  ceil 128kbps prio 2</p>

<p>#attach a sfq qdisc for each leaf class<br />
tc qdisc add dev eth0 parent 1:2 handle 2: sfq perturb 5<br />
tc qdisc add dev eth0 parent 1:3 handle 3: sfq perturb 5<br />
tc qdisc add dev eth0 parent 1:4 handle 4: sfq perturb 5</p>

<p>#attach filters to root htb qdisc<br />
tc filter add dev eth0 protocol ip parent 1:0 u32 match ip src 192.168.74.10  flowid 1:2<br />
tc filter add dev eth0 protocol ip parent 1:0 u32 match ip src 192.168.74.30  flowid 1:3<br />
tc filter add dev eth0 protocol ip parent 1:0 u32 match ip src 192.168.74.130 flowid 1:4</p>

<p>æ³¨æ„ï¼Œæ­¤å¤„æ ¹æ®IPåœ°å€å°†æ•°æ®åŒ…æ”¾ç½®åˆ°ä¸åŒçš„classä¸­ï¼Œä¹Ÿå¯é‡‡ç”¨å…¶ä»–çš„filteræ¥å®ç°ä¸åŒçš„åˆ†ç±»è§„åˆ™ã€‚u32è¿‡æ»¤å™¨å¯æ ¹æ®æ•°æ®åŒ…çš„ä¿¡æ¯å¯¹æ•°æ®åŒ…è¿›è¡Œå½’ç±»ã€‚æ­¤å¤–ï¼Œæœ¬ç« ä¸­å®¹å™¨é€šè¿‡é…ç½®æ¡¥æ¥æ¥è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œå¯¹äºå…¶ä»–çš„é“¾æ¥ç½‘ç»œçš„å½¢å¼å°šæœªè¿›è¡Œæµ‹è¯•ã€‚</p>

<p>6.2 åˆ©ç”¨classidè¿›è¡Œæµé‡æ§åˆ¶ 
åœ¨linuxæ§åˆ¶ç»„ä¸­net_clså­ç³»ç»Ÿé€šè¿‡å¯¹ç½‘ç»œåŒ…æ‰“æ ‡è®°classidæ¥è¡¨ç¤ºå±äºä¸åŒæ§åˆ¶ç»„çš„ç½‘ç»œåŒ…ã€‚linuxç³»ç»Ÿä¸­æµé‡æ§åˆ¶ç³»ç»Ÿå¯æ ¹æ®è¯¥æ ‡è®°æ¥å¯¹æ§åˆ¶ç»„çš„ç½‘ç»œåŒ…è¿›è¡Œæ§åˆ¶ã€‚æ³¨æ„ï¼Œnet_clså­ç³»ç»Ÿå¹¶ä¸æ˜¯é€šè¿‡ä¿®æ”¹ç½‘ç»œåŒ…æ¥æ‰“æ ‡è®°çš„ï¼Œå½“ç½‘ç»œåŒ…é€šè¿‡åè®®æ ˆçš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡å½“å‰çš„è¿›ç¨‹ä¸Šä¸‹æ–‡æ¥çš„åˆ°æ§åˆ¶ç»„ä¿¡æ¯ï¼Œè¿›è€Œè·å¾—å½“å‰ç½‘ç»œåŒ…çš„classidï¼Œå› æ­¤ï¼Œå¦‚æœç½‘ç»œåŒ…è¢«åŒ…è¿‡æ»¤å™¨å¤„ç†ä¹‹å‰è¢«é‡æ–°è°ƒåº¦ï¼Œé‚£ä¹ˆå°±æ— æ³•è·å¾—è¯¥åŒ…çš„classidï¼å› æ­¤ï¼Œå¯¹äºé‡‡ç”¨6.1ä¸­ç½‘æ¡¥æ–¹å¼è¿›è¡Œç½‘ç»œé€šä¿¡çš„æ–¹å¼ï¼Œè¿è¡Œfedoraè™šæ‹Ÿæœºæ—¶æ— æ³•é‡‡ç”¨classidå¯¹ç½‘ç»œåŒ…è¿›è¡Œåˆ†ç±»ç®¡ç†ã€‚ä¸‹é¢ç»™å‡ºäº†ä¸€ä¸ªç®€å•çš„åˆ©ç”¨classidè¿›è¡Œç½‘ç»œæµé‡é™åˆ¶çš„é…ç½®è„šæœ¬ï¼Œä½¿ç”¨çš„cgroupè¿‡æ»¤å™¨ï¼Œæ ¹æ®ç½‘ç»œåŒ…è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­å¾—åˆ°çš„classidå¯¹ç½‘ç»œåŒ…è¿›è¡Œåˆ†ç±»ã€‚ 
Shellä»£ç   æ”¶è—ä»£ç 
#!/bin/bash</p>

<p>dev=eth0<br />
tc qdisc del dev $dev root</p>
<h1 id="set-qdisc-as-htb">set qdisc as htb</h1>

<p>tc qdisc add dev $dev parent root handle 10: htb</p>

<h1 id="create-some-claess-for-root-qdisc">create some claess for root qdisc</h1>

<p>tc class add dev $dev parent 10: classid 10:1 htb rate 1mbps ceil 1mbps<br />
tc class add dev $dev parent 10:1 classid 10:2 htb rate 256kbps ceil 256kbps <br />
tc class add dev $dev parent 10:1 classid 10:3 htb rate 256kbps ceil 256kbps <br />
tc class add dev $dev parent 10:1 classid 10:4 htb rate 512kbps ceil 1mbps</p>

<h1 id="add-sfq-qdisc-for-every-leaf-class">add sfq qdisc for every leaf class</h1>
<p>tc qdisc add dev $dev parent 10:2 handle 2:0 pfifo<br />
tc qdisc add dev $dev parent 10:3 handle 3:0 pfifo<br />
tc qdisc add dev $dev parent 10:4 handle 4:0 pfifo</p>

<h1 id="add-filter-for-root-qdisc">add filter for root qdisc</h1>

<p>tc filter add dev $dev parent 10: protocol ip prio 1 handle 10: cgroup</p>

<p>7 é™„å½•å’Œå‚è€ƒ 
7.1 brctlå‘½ä»¤ç®€ä»‹ 
è¯¥å‘½ä»¤ç”¨äºå»ºç«‹ã€ç»´æŠ¤å’Œæ£€æŸ¥Ethernetç½‘æ¡¥åœ¨Linuxå†…æ ¸ä¸­çš„é…ç½®ï¼Œå¦‚ä¸‹æ˜¯è¯¥å‘½ä»¤çš„ç®€è¦ä½¿ç”¨ï¼š 
brctl  addbr  <name>ï¼šæ·»åŠ ä¸€ä¸ªåç§°ä¸ºnameçš„ç½‘æ¡¥ã€‚ 
brctl  delbr  <name>ï¼šåˆ é™¤åç§°ä¸ºnameçš„ç½‘æ¡¥ã€‚ 
brctl   addif  <name>  <device>:å°†æ¥å£deviceè¿æ¥åˆ°ç½‘æ¡¥nameä¸Šã€‚ 
brctl   delif  <name>  <device>:å°†æ¥å£deviceä»ç½‘æ¡¥nameä¸Šç§»é™¤ã€‚ 
brctl   setfd  <name>  <time>:è®¾å®šç½‘æ¡¥nameçš„è½¬é€å»¶æ—¶ã€‚ 
æ›´å¤šä¿¡æ¯å¯å‚è€ƒhttp://linux.die.net/man/8/brctlã€‚ 
7.2 tcå‘½ä»¤ç®€ä»‹ 
è¯¥å‘½ä»¤ç”¨äºlinuxå†…æ ¸çš„ç½‘ç»œæµé‡æ§åˆ¶ï¼Œåœ¨æœ¬æ–‡æ¡£ä¸­ä½¿ç”¨æœ‰ç±»å‹çš„é˜Ÿåˆ—è§„åˆ™ï¼ˆclassful qdiscï¼‰ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªé…ç½®å®ä¾‹ï¼Œæ›´å¤šä¿¡æ¯å¯å‚è€ƒhttp://linux.die.net/man/8/tcã€‚ 
1ï¼‰å‡è®¾ç”±å¦ä¸ªå®¢æˆ·Aå’ŒBé€šè¿‡æ¥å£eth0è¿æ¥åˆ°ç½‘ç»œï¼Œæˆ‘ä»¬ç³»ç»Ÿåˆ†é…ç»™ç”¨æˆ·Bçš„å¸¦å®½ä¸º60kbpsï¼Œåˆ†é…ç»™ç”¨æˆ·Açš„å¸¦å®½ä¸º40kbpsã€‚æ­¤å¤–ï¼Œå¸Œæœ›å°†Aç”¨æˆ·çš„30kbpsçš„å¸¦å®½æŒ‰ç…§å¦‚ä¸‹åˆ’åˆ†ï¼šwwwå ç”¨å…¶ä¸­çš„30kbpsï¼Œå‰©ä½™çš„10kbpsç”¨äºå…¶ä»–åº”ç”¨ã€‚ç³»ç»Ÿä¸­ä»»ä½•æœªä½¿ç”¨çš„å¸¦å®½å‡å¯å…è®¸Aæˆ–è€…Bä½¿ç”¨ã€‚</time></name></device></name></device></name></name></name></p>

<p>a)åœ¨æ¥å£eth0ä¸Šåˆ›å»ºä¸€ä¸ªhtb qdisc,å…¶å¥æŸ„ä¸º1:0ï¼Œæœªåˆ†ç±»æ•°æ®åŒ…å‘é€ç»™ç±»1:12 
tc qdisc add dev eth0 root handle 1:  htb  default 12 
b)ä¸ºqdiscåˆ›å»ºhtbç±»ä»¥åŠå­ç±» 
tc class add dev eth0 parent 1:  classid 1:1  htb rate 100kbps ceil 100kbps 
tc class add dev eth0 parent 1:1 classid 1:10 htb rate 30kbps ceil 100kbps 
tc class add dev eth0 parent 1:1 classid 1:11 htb rate 10kbps ceil 100kbps 
tc class add dev eth0 parent 1:1 classid 1:12 htb rate 60kbps ceil 100kbps 
c)ä¸ºqdiscæ·»åŠ filter,å‡è®¾Aç”¨æˆ·çš„IPåœ°å€ä¸º1.2.3.4 
tc filter add  dev eth0 protocol ip parent 1:0 prio 1 u32 match ip src 1.2.3.4 ip dprot 80 0xFFFF flowid 1:10 
tc filter add  dev eth0 protocol ip parent 1:0 prio 1 u32 match ip src 1.2.3.4 flowid 1:11 
ä¸Šé¢ç¬¬ä¸€è¡ŒæŒ‡å®šAçš„wwwæœåŠ¡çš„åŒ…å‘åˆ°ç±»1:10ï¼Œç¬¬äºŒè¡ŒæŒ‡å®šå…¶ä»–åŒ…å‘ç»™ç±»1:11 
d)ä¸ºæ¯ä¸ªleaf classæ·»åŠ é˜Ÿåˆ—ï¼ˆå¯é€‰ï¼‰ 
tc qdisc add dev eth0 parent 1:10 handle 20:  pfifo  limit 5 
tc qdisc add dev eth0 parent 1:11 handle 30:  pfifo  limit 5 
tc qdisc add dev eth0 parent 1:12 handle 40:  pfifo  limit 10</p>

<p>7.3 è¶…çº§ç”¨æˆ·æƒé™ 
åœ¨linux2.2å†…æ ¸å¼€å§‹å°†è¶…çº§ç”¨æˆ·çš„æƒé™åˆ†ä¸ºè‹¥å¹²ç‹¬ç«‹çš„å­æƒé™ï¼Œæ¯ä¸ªå­æƒé™å¯ç‹¬ç«‹çš„ç¦æ­¢æˆ–è€…æ‰“å¼€ï¼Œæ³¨æ„ï¼Œä¸€æ—¦å‰¥å¤ºäº†æ ¹ç”¨æˆ·çš„æŸä¸€æƒé™ï¼Œé‚£ä¹ˆé™¤éé‡å¯ç³»ç»Ÿï¼Œå¦åˆ™æ— æ³•æ¢å¤è¯¥æƒé™ã€‚ä¸‹é¢å¯¹è¿™äº›æƒé™è¿›è¡Œç®€å•çš„ä»‹ç»ï¼š</p>

<p>CAP_CHOWNï¼šå…è®¸æ”¹å˜æ–‡ä»¶çš„æ‰€æœ‰æƒ 
CAP_DAC_OVERRIDEï¼šå¿½ç•¥å¯¹æ–‡ä»¶çš„æ‰€æœ‰DACè®¿é—®é™åˆ¶ 
CAP_DAC_READ_SEARCHï¼šå¿½ç•¥æ‰€æœ‰å¯¹è¯»ã€æœç´¢æ“ä½œçš„é™åˆ¶ 
CAP_FOWNERï¼šå¦‚æœæ–‡ä»¶å±äºè¿›ç¨‹çš„UIDï¼Œå°±å–æ¶ˆå¯¹æ–‡ä»¶çš„é™åˆ¶ 
CAP_FSETID ï¼šå…è®¸è®¾ç½®setuidä½ 
CAP_KILL ï¼šå…è®¸å¯¹ä¸å±äºè‡ªå·±çš„è¿›ç¨‹å‘é€ä¿¡å· 
CAP_SETGID ï¼šå…è®¸æ”¹å˜ç»„ID 
CAP_SETUID ï¼šå…è®¸æ”¹å˜ç”¨æˆ·ID 
CAP_SETPCAP ï¼šå…è®¸å‘å…¶å®ƒè¿›ç¨‹è½¬ç§»èƒ½åŠ›ä»¥åŠåˆ é™¤å…¶å®ƒè¿›ç¨‹çš„ä»»æ„èƒ½åŠ› 
CAP_LINUX_IMMUTABLE ï¼šå…è®¸ä¿®æ”¹æ–‡ä»¶çš„ä¸å¯ä¿®æ”¹(IMMUTABLE)å’Œåªæ·»åŠ (APPEND-ONLY)å±æ€§ 
CAP_NET_BIND_SERVICEï¼š å…è®¸ç»‘å®šåˆ°å°äº1024çš„ç«¯å£ 
CAP_NET_BROADCASTï¼šå…è®¸ç½‘ç»œå¹¿æ’­å’Œå¤šæ’­è®¿é—® 
CAP_NET_ADMINï¼šå…è®¸æ‰§è¡Œç½‘ç»œç®¡ç†ä»»åŠ¡ï¼šæ¥å£ã€é˜²ç«å¢™å’Œè·¯ç”±ç­‰ã€‚ 
CAP_NET_RAW ï¼šå…è®¸ä½¿ç”¨åŸå§‹(raw)å¥—æ¥å­— 
CAP_IPC_LOCK ï¼šå…è®¸é”å®šå…±äº«å†…å­˜ç‰‡æ®µ 
CAP_IPC_OWNERï¼š å¿½ç•¥IPCæ‰€æœ‰æƒæ£€æŸ¥ 
CAP_SYS_MODULEï¼š æ’å…¥å’Œåˆ é™¤å†…æ ¸æ¨¡å— 
CAP_SYS_RAWIOï¼šå…è®¸å¯¹ioperm/ioplçš„è®¿é—® 
CAP_SYS_CHROOTï¼šå…è®¸ä½¿ç”¨chroot()ç³»ç»Ÿè°ƒç”¨ 
CAP_SYS_PTRACEï¼šå…è®¸è·Ÿè¸ªä»»ä½•è¿›ç¨‹ 
CAP_SYS_PACCTï¼šå…è®¸é…ç½®è¿›ç¨‹è®°å¸(process accounting) 
CAP_SYS_ADMINï¼šå…è®¸æ‰§è¡Œç³»ç»Ÿç®¡ç†ä»»åŠ¡ï¼šåŠ è½½/å¸è½½æ–‡ä»¶ç³»ç»Ÿã€è®¾ç½®ç£ç›˜é…é¢ã€å¼€/å…³äº¤æ¢è®¾å¤‡å’Œæ–‡ä»¶ç­‰ã€‚ 
CAP_SYS_BOOTï¼šå…è®¸é‡æ–°å¯åŠ¨ç³»ç»Ÿ 
CAP_SYS_NICEï¼šå…è®¸æå‡ä¼˜å…ˆçº§ï¼Œè®¾ç½®å…¶å®ƒè¿›ç¨‹çš„ä¼˜å…ˆçº§ 
CAP_SYS_RESOURCEï¼šå¿½ç•¥èµ„æºé™åˆ¶ 
CAP_SYS_TIMEï¼šå…è®¸æ”¹å˜ç³»ç»Ÿæ—¶é’Ÿ 
CAP_SYS_TTY_CONFIGï¼šå…è®¸é…ç½®TTYè®¾å¤‡ 
CAP_MKNODï¼šå…è®¸ä½¿ç”¨mknod()ç³»ç»Ÿè°ƒç”¨ 
CAP_LEASEï¼šAllow taking of leases on files</p>

<p>7.4 cgroupæ¨¡å—ç¼–å†™ 
lxcå»ºç«‹åœ¨cgroupçš„åŸºç¡€ä¸Šï¼Œåœ¨2.6.35ä»¥ä¸Šå†…æ ¸ä¸­æ”¯æŒå°†æ§åˆ¶ç»„å­ç³»ç»Ÿé€šè¿‡æ¨¡å—çš„å½¢å¼åŠ å…¥åˆ°å†…æ ¸ä¸­ï¼Œæœ¬èŠ‚æ¼”ç¤ºäº†å¦‚ä½•ç¼–å†™ä¸€ä¸ªæ§åˆ¶ç»„å­ç³»ç»Ÿæ¨¡å—ã€‚åœ¨å½“å‰çš„å†…æ ¸ä¸­æ”¯æŒçš„å­ç³»ç»Ÿçš„æœ€å¤§ä¸ªæ•°ä¸ºunsigned longç±»å‹çš„bitä½æ•°ï¼Œå½“å‰çš„å­ç³»ç»Ÿä¸ªæ•°ä¸º8ä¸ªã€‚ç¼–å†™ç®€å•è¿‡ç¨‹å¦‚ä¸‹ï¼š 
1) å®šä¹‰struct cgroup_subsysç»“æ„ 
Cä»£ç   æ”¶è—ä»£ç 
struct cgroup_subsys  sample = {<br />
    .create = sample_create,<br />
    .destroy = sample_destroy,<br />
    .populate = sample_populate,<br />
    .module = THIS_MODULE,<br />
};</p>

<p>struct cgroup_subsysç»“æ„å®šä¹‰äº†æ§åˆ¶ç»„å­ç³»ç»Ÿç»“æ„ï¼Œå…¶ä¸­ä¸»è¦åŒ…å«äº†ä¸€äº›æ§åˆ¶ç»„å­ç³»ç»Ÿæ¥å£å’Œä¸€äº›å±æ€§ä¿¡æ¯ï¼Œå…¶ä¸­createå’Œdestoryæ¥å£å¿…é¡»å®šä¹‰ï¼Œè¿™ä¸¤ä¸ªæ¥å£å®ç°äº†åˆ›å»ºå’Œé”€æ¯æ§åˆ¶ç»„å­ç³»ç»ŸçŠ¶æ€å¯¹è±¡ã€‚ 
2) å®šä¹‰å­ç³»ç»ŸçŠ¶æ€ç»“æ„ï¼Œè¯¥ç»“æ„ä¸­å¿…é¡»è¦åŒ…å«struct cgroup_subsys_stateç»“æ„å·²ä¾¿äºç¼–ç¨‹å¤„ç†. 
Cä»£ç   æ”¶è—ä»£ç 
struct  cgroup_hello_state {<br />
    struct cgroup_subsys_state  css;<br />
    int  helloid;<br />
    /<em>å…¶ä»–ç›¸å…³ä¿¡æ¯</em>/<br />
};</p>

<p>3) å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡åªæ˜¯helloå­ç³»ç»Ÿçš„idï¼Œè®°å½•ç³»ç»Ÿåˆ†é…ç»™å­ç³»ç»Ÿçš„ç¼–å·ï¼Œä»¥ä¾¿äºåé¢ç¼–ç¨‹å¤„ç†. 
int  hello_subsys_id ; 
4) å®šä¹‰å­ç³»ç»Ÿåœ¨æ§åˆ¶ç»„ç›®å½•ä¸­çš„æ§åˆ¶æ–‡ä»¶æ¥å£. 
Cä»£ç   æ”¶è—ä»£ç 
struct  cftype cft[]={<br />
    {<br />
        .name = â€œhelloâ€,<br />
        .read_u64 = sample_read_u64,<br />
        .write_u64 = sample_write_u64,<br />
    },<br />
}</p>

<p>struct cftypeç»“æ„å®šä¹‰äº†æ§åˆ¶æ–‡ä»¶çš„å¤„ç†å¥æŸ„ä»¥åŠç›¸å…³åç§°å’Œå±æ€§ä¿¡æ¯ï¼Œåœ¨è¿™é‡Œä»…ä»…å®ç°æ–‡ä»¶çš„è¯»å†™å¥æŸ„. 
5) å®ç°æ¥å£ã€‚ 
å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š 
Cä»£ç   æ”¶è—ä»£ç 
#include &lt;linux/module.h&gt;<br />
#include &lt;linux/slab.h&gt;<br />
#include &lt;linux/types.h&gt;<br />
#include &lt;linux/cgroup.h&gt;<br />
MODULE_LICENSE(â€œDual BSD/GPLâ€);<br />
/<em>æ§åˆ¶ç»„å­ç³»ç»Ÿç»“æ„</em>/<br />
struct cgroup_hello_state{<br />
    struct cgroup_subsys_state css;<br />
    int helloid;<br />
    /<em>å…¶ä»–çŠ¶æ€ä¿¡æ¯</em>/<br />
};</p>

<p>int  hello_subsys_id;</p>

<p>static struct cgroup_subsys_state <em>cgrp_create(struct cgroup_subsys *ss,struct cgroup *cgrp);<br />
static void cgrp_destroy(struct cgroup_subsys *ss,struct cgroup * cgrp);<br />
static int cgrp_populate(struct cgroup_subsys *ss,struct cgroup * cgrp);<br />
static void cgrp_attach(struct cgroup_subsys *ss,struct cgroup * cgrp,struct cgroup *old_cgrp,struct task_struct *task);<br />
/</em>å®šä¹‰æ§åˆ¶ç»„å­ç³»ç»Ÿç»“æ„*/<br />
struct cgroup_subsys cgroup_hello_subsys ={<br />
    .name = â€œhelloâ€,<br />
    .create = cgrp_create,<br />
    .destroy = cgrp_destroy,<br />
    .populate = cgrp_populate,<br />
    .attach = cgrp_attach,<br />
    .module = THIS_MODULE,<br />
};</p>

<p>static void cgrp_attach(struct cgroup_subsys *ss,struct cgroup * cgrp,struct cgroup *old_cgrp,struct task_struct *task){<br />
    printk(KERN_ALERT â€œ%s:%d\nâ€,<strong>func</strong>,task-&gt;pid);<br />
}<br />
static inline struct cgroup_hello_state *cgrp_hello_state(struct cgroup *cgrp){<br />
    return container_of(cgroup_subsys_state(cgrp,hello_subsys_id),struct cgroup_hello_state,css);<br />
}</p>

<p>static struct cgroup_subsys_state <em>cgrp_create(struct cgroup_subsys *ss,struct cgroup *cgrp){<br />
    struct cgroup_hello_state *cs;<br />
    cs = kmalloc(sizeof(</em>cs),GFP_KERNEL);<br />
    if(!cs)<br />
        return ERR_PTR(-ENOMEM);<br />
    printk(KERN_ALERT â€œ%s\nâ€,<strong>func</strong>);<br />
    return &amp;cs-&gt;css;<br />
}</p>

<p>static void cgrp_destroy(struct cgroup_subsys *ss,struct cgroup * cgrp){<br />
    kfree(cgrp_hello_state(cgrp));<br />
}</p>

<p>static u64 read_helloid(struct cgroup <em>cgrp,struct cftype *cft);<br />
static int write_helloid(struct cgroup *cgrp,struct cftype *cft, u64 val);<br />
/</em>æ§åˆ¶æ–‡ä»¶æ“ä½œå¯¹è±¡ç»“æ„<em>/<br />
struct cftype ss_files[]={<br />
    {<br />
        .name = â€œhelloâ€,<br />
        .read_u64 = read_helloid,<br />
        .write_u64 = write_helloid,<br />
    },<br />
};<br />
/</em>åˆ›å»ºæœ¬å­ç³»ç»Ÿçš„æ§åˆ¶æ–‡ä»¶*/<br />
static int cgrp_populate(struct cgroup_subsys *ss,struct cgroup *cgrp){<br />
    return cgroup_add_files(cgrp,ss,ss_files,ARRAY_SIZE(ss_files));<br />
}</p>

<p>static u64 read_helloid(struct cgroup *cgrp, struct cftype *cft){<br />
    printk(KERN_ALERT â€œ%s:%s\nâ€,<strong>func</strong>,cft-&gt;name);<br />
    return cgrp_hello_state(cgrp)-&gt;helloid;<br />
}<br />
static int write_helloid(struct cgroup *cgrp,struct cftype *cft,u64 val){<br />
    printk(KERN_ALERT â€œ%s:%s\nâ€,<strong>func</strong>,cft-&gt;name);<br />
    cgrp_hello_state(cgrp)-&gt;helloid = (int)val;<br />
    return 0;<br />
}</p>

<p>static int hello_init(void){<br />
    int ret;<br />
    printk(KERN_ALERT â€œHello,world\nâ€);<br />
    ret = cgroup_load_subsys(&amp;cgroup_hello_subsys);<br />
    if(ret)<br />
        goto out;<br />
    hello_subsys_id = cgroup_hello_subsys.subsys_id;<br />
    printk(KERN_ALERT â€œsubsys id:%d\nâ€,hello_subsys_id);<br />
out:<br />
    return ret;<br />
}</p>

<p>static void hello_exit(void){<br />
    cgroup_unload_subsys(&amp;cgroup_hello_subsys);<br />
    printk(KERN_ALERT â€œGoodbye, cruel world\nâ€);<br />
}<br />
module_init(hello_init);<br />
module_exit(hello_exit);</p>

<p>LXCçš„å®‰è£…åŒ…åœ¨CentOSçš„epelæºæœ‰æä¾›çš„ï¼Œä½¿ç”¨å®˜ç½‘çš„epelæºéœ€è¦å®‰è£…ä¸€ä¸ªè½¯ä»¶åŒ…
yum -y install epel-release        #è¿™ä¸ªè½¯ä»¶åŒ…é‡ŒåŒ…å«epelyumæºå’ŒGPGçš„é…ç½®
1
å®‰è£…LXCè½¯ä»¶åŒ…å’Œä¾èµ–åŒ…
yum -y install lxc lxc-templates bridge-utils lxc-libs libcgroup libvirt
lxc           #ä¸»ç¨‹åºåŒ…
lxc-templates #lxcçš„é…ç½®æ¨¡æ¿
bridge-utils  #ç½‘æ¡¥ç®¡ç†å·¥å…·
lxc-libs      #lxcæ‰€éœ€çš„åº“æ–‡ä»¶
libcgroup     #cgroupæ˜¯ä¸ºLinuxå†…æ ¸æä¾›ä»»åŠ¡èšé›†å’Œåˆ’åˆ†çš„æœºåˆ¶ï¼Œé€šè¿‡ä¸€ç»„å‚æ•°é›†åˆå°†ä¸€äº›ä»»åŠ¡ç»„ç»‡æˆä¸€ä¸ªæˆ–å¤šä¸ªå­ç³»ç»Ÿã€‚
libvirt       #ç®¡ç†Linuxçš„è™šæ‹ŸåŒ–åŠŸèƒ½æ‰€éœ€çš„æœåŠ¡å™¨ç«¯å®ˆæŠ¤ç¨‹åºã€‚ éœ€è¦é’ˆå¯¹ç‰¹å®šé©±åŠ¨ç¨‹åºçš„ç®¡ç†ç¨‹åºã€‚
æ³¨ï¼šå¦‚æœè¦åˆ›å»ºdebianç³»åˆ—çš„ä¸»æœºéœ€è¦å†å®‰è£…ä¸€ä¸ªè½¯ä»¶åŒ…ï¼šdebootstrap</p>

<ol>
  <li>é™åˆ¶LXCå¯ä»¥ä½¿ç”¨çš„ç³»ç»Ÿèµ„æº
åœ¨configæ–‡ä»¶å†…ï¼Œå†™å…¥é™å®šè§„åˆ™ã€‚æ³¨æ„ï¼Œä½¿ç”¨å†…å­˜é™å®šçš„è¯ï¼Œéœ€è¦åœ¨å†…æ ¸å‚æ•°ä¸­åŠ å…¥cgroup_enable=memoryã€‚</li>
</ol>

<p>å¯ä»¥ä¿®æ”¹/etc/default/grubæ–‡ä»¶ï¼Œä½¿ç”¨update-grubé‡æ–°ç”Ÿæˆè§„åˆ™ã€‚</p>

<p>GRUB_CMDLINE_LINUX_DEFAULT=â€cgroup_enable=memory quietâ€</p>

<p>åœ¨configæ–‡ä»¶ä¸­å¯ä»¥å¦‚ä¸‹é™å®š:</p>

<p>lxc.cgroup.memory.limit_in_bytes = 512M                 #é™å®šå†…å­˜
lxc.cgroup.cpuset.cpus = 0                              #é™å®šå¯ä»¥ä½¿ç”¨çš„æ ¸
lxc.cgroup.blkio.throttle.read_bps_device = 8:0 100     #è¯»å–é€Ÿç‡é™å®š
lxc.cgroup.blkio.throttle.write_bps_device = 8:0 100    #å†™å…¥é€Ÿç‡é™å®š
lxc.cgroup.blkio.throttle.read_iops_device = 8:0 100    #è¯»å–é¢‘ç‡é™å®š
lxc.cgroup.blkio.throttle.write_iops_device = 8:0 100   #å†™å…¥é¢‘ç‡é™å®š</p>

<ol>
  <li>æŸ¥çœ‹ä¸»æœºçš„è¿è¡ŒçŠ¶æ€
lxc-info -n myhost1          #ä½¿ç”¨è¿™æ¡lxc-infoå‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸»æœºçš„çŠ¶æ€ä¿¡æ¯
Name:           myhost1                 #ä¸»æœºå
State:          RUNNING                 #å½“å‰çŠ¶æ€ï¼ŒRUNNINGè¡¨ç¤ºå¯åŠ¨ï¼ŒSTOPPEDè¡¨ç¤ºå…³é—­ã€‚
PID:            4409                    #lxcä¸»æœºå½“å‰åœ¨ç‰©ç†æœºä¸Šçš„è¿›ç¨‹å·
IP:             192.168.122.53          #ä¸»æœºçš„IPåœ°å€
CPU use:        0.19 seconds            #cpuå ç”¨æ—¶é—´
BlkIO use:      3.35 MiB                #å ç”¨BLKIOèµ„æºçš„å¤§å°
Memory use:     4.40 MiB                #å ç”¨ç‰©ç†å†…å­˜å¤§å°
KMem use:       0 bytes                 #å†…æ ¸è™šæ‹Ÿå†…å­˜
Link:           veth2DSU4I
 TX bytes:      1.76 KiB                #æµé‡ç›¸å…³çš„ä¿¡æ¯
 RX bytes:      35.69 KiB
 Total bytes:   37.45 KiB</li>
  <li>åœæ­¢lxcä¸»æœº
lxc-stop -n myhost1
1</li>
  <li>åˆ é™¤ä¸»æœº
lxc-destroy -n myhost2
1</li>
  <li>lxcå¯ä»¥ä½¿ç”¨lxc-cloneå‘½ä»¤å¯¹ä¸»æœºè¿›è¡Œå…‹éš†
[root@CentOS7.3 ~]#lxc-clone -o myhost1 -n myhost2  #æŠŠmyhost1å…‹éš†ä¸€ä»½å‘½åä¸ºmyhost2
Created container myhost2 as copy of myhost1
[root@CentOS7.3 ~]#lxc-start -n myhost2             #å¯åŠ¨myhost2
systemd 219 running in system mode. (+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ -LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN)
Detected virtualization lxc.
â€¦â€¦
CentOS Linux 7 (Core)
Kernel 3.10.0-514.el7.x86_64 on an x86_64</li>
</ol>

<p>myhost2 login: root                                 #ä½¿ç”¨é»˜è®¤ç”¨æˆ·root
Password:                                           #å¯†ç å’Œmyhost1çš„ç›¸åŒ</p>
<ol>
  <li>LXCå‘½ä»¤è¯¦è§£
lxc-create åˆ›å»ºä¸€ä¸ªç³»ç»Ÿå¯¹è±¡
ç”¨æ³•ï¼š lxc-create {-n name} [-f config_file] {-t template} [-B backingstore] [â€“ template-options]
é€‰é¡¹</li>
</ol>

<p>-n,â€“name               #å®¹å™¨çš„ä¸»æœºå
-fï¼Œâ€“config            #æŒ‡å®šé…ç½®æ–‡ä»¶ä»¥é…ç½®å®¹å™¨çš„è™šæ‹ŸåŒ–å’Œéš”ç¦»åŠŸèƒ½
-t template             #è°ƒç”¨æ¨¡æ¿è„šæœ¬ï¼Œå¯æ‰§è¡Œæ¨¡æ¿è„šæœ¬çš„å®Œæ•´è·¯å¾„ä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ã€‚ â€œnoneâ€å¯ç”¨äºå¼ºåˆ¶lxc-createè·³è¿‡rootfsåˆ›å»ºã€‚
-B backingstore         #æŒ‡å®šæ ¹æ–‡ä»¶å‚¨å­˜è·¯å¾„çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¯é€‰ï¼šdirã€lvmã€loopã€btrfsã€zfsã€best   ï¼Œé»˜è®¤ä¸ºdirï¼Œå¦‚æœæ˜¯dirå¯ä»¥ä½¿ç”¨â€“diræŒ‡å®šlxcä¸»æœºçš„æ ¹åœ¨å®¿ä¸»æœºçš„å­˜å‚¨è·¯å¾„ã€‚<br />
-P, â€“lxcpath           #è‡ªå®šä¹‰å®¹å™¨è·¯å¾„ã€‚é»˜è®¤å€¼ä¸º/var/lib/lxcã€‚
-o, â€“logfile           #è¾“å‡ºåˆ›å»ºè¿‡ç¨‹åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ã€‚
-l, â€“logpriority       #å°†æ—¥å¿—ä¼˜å…ˆçº§è®¾ç½®ä¸ºLEVELï¼Œé»˜è®¤ä¼˜å…ˆçº§ä¸ºERROR
â€“                      #å‘templateä¼ é€’å‚æ•°æŸ¥çœ‹å¯é€‰å‚æ•°ï¼šlxc-create -t TEMPLATE -hï¼Œå¸¸ç”¨å‚æ•°å¦‚ä¸‹
        -n,â€“name       #å®¹å™¨æ ‡è¯†ç¬¦
        -p,â€“path       #æŒ‡å®šå®¹å™¨æ ¹çš„åˆ›å»ºè·¯å¾„ï¼Œé»˜è®¤/var/lib/lxc/å®¹å™¨å/
        -c,â€“clean      #æ¸…é™¤ç¼“å­˜
        -R,â€“release    #æŒ‡å®šCentosçš„å‘è¡Œç‰ˆæœ¬
           â€“fqdn       #ç”¨äºDNSå’Œç³»ç»Ÿå‘½åçš„å®Œå…¨åŸŸåï¼ˆFQDNï¼‰
           â€“repo       #æŒ‡å®šåˆ›å»ºå®¹å™¨æ˜¯ä½¿ç”¨çš„yumæºï¼Œè¿™ä¸ªæ˜¯redhatç³»ç»Ÿçš„å‚æ•°
        -a,â€“arch       #æŒ‡å®šå®¹å™¨çš„æ¶æ„ï¼Œå¯é€‰i686,x86_64
lxc-destroy
ç”¨æ³•ï¼šlxc-destroy {-n name} [-f]
é€‰é¡¹:-f, â€“force        #å¼ºåˆ¶åˆ é™¤
lxc-start
ç”¨æ³•ï¼šlxc-start {-n name} [-f config_file] [-c console_device] [-L console_logfile] [-d] [-F] [-p pid_file] [-s KEY=VAL] [-C] [â€“share-[net|ipc|uts] name|pid] [command]
é€‰é¡¹ï¼š</p>

<p>-n                      #æŒ‡å®šå®¹å™¨å
-d, â€“daemon            #åå°è¿è¡Œ
-F                      #å‰å°è¿è¡Œï¼Œé»˜è®¤é€‰é¡¹
-p, â€“pidfile           #åˆ›å»ºä¸€ä¸ªä¿å­˜äº†pidçš„æ–‡ä»¶
-f, â€“rcfile            #æŒ‡å®šé…ç½®æ–‡ä»¶ä»¥é…ç½®å®¹å™¨çš„è™šæ‹ŸåŒ–å’Œéš”ç¦»åŠŸèƒ½ã€‚è¦†ç›–ç°æœ‰é…ç½®æ–‡ä»¶ã€‚
c, â€“console            #æŒ‡å®šä¸€ä¸ªå‰å°è¿è¡Œå®¹å™¨çš„ç»ˆç«¯ã€‚ä¸æŒ‡å®šé»˜è®¤ä¸ºå½“å‰ç»ˆç«¯ã€‚
-L, â€“console-log       #æŠŠå®¹å™¨æ§åˆ¶å°è¾“å…¥ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚
-C, â€“close-all-fds     #å¦‚æœä»»ä½•æ–‡ä»¶æè¿°ç¬¦è¢«ç»§æ‰¿ï¼Œå…³é—­å®ƒä»¬ã€‚ å¦‚æœæœªæŒ‡å®šæ­¤é€‰é¡¹ï¼Œåˆ™lxc-startå°†é€€å‡ºè€Œå¤±è´¥ã€‚ æ³¨æ„ï¼šâ€“daemonæ„å‘³ç€â€“close-all-fdsã€‚
â€“share-net name|pid    #ä»å…¶ä»–å®¹å™¨ç»§æ‰¿ç½‘ç»œåç§°ç©ºé—´ã€‚
â€“share-ipc             #ä»å…¶ä»–å®¹å™¨ç»§æ‰¿IPCå‘½åç©ºé—´ã€‚
â€“share-uts             #ä»å…¶ä»–å®¹å™¨ç»§æ‰¿UTSå‘½åç©ºé—´ã€‚
lxc-autostart
é€‰é¡¹ï¼š</p>

<p>-r,â€“reboot             #é‡å¯å®¹å™¨
-s,â€“shutdown           #è®¾ç½®å®šæ—¶å…³é—­å®¹å™¨ï¼Œä½¿ç”¨-t è®¾ç½®å…³é—­æ—¶é—´ã€‚
-k,â€“kill               #å…³é—­å®¹å™¨
lxc-stop
é€‰é¡¹ï¼š</p>

<p>-r,â€“reboot             #é‡å¯å®¹å™¨
-k,â€“kill               #å…³é—­å®¹å™¨ï¼Œé»˜è®¤é€‰é¡¹
â€“nokill                #æŒ‚èµ·å®¹å™¨
â€“nolock                #æ­¤é€‰é¡¹é¿å…ä½¿ç”¨ä»»ä½•API lxcé”å®šã€‚
lxc-info
é€‰é¡¹ï¼š</p>

<p>-s                      #æ˜¾ç¤ºçŠ¶æ€
-p                      #æ˜¾ç¤ºpid
-i                      #æ˜¾ç¤ºIPåœ°å€
-S                      #æ˜¾ç¤ºå†…å­˜ä½¿ç”¨
-H                      #æ˜¾ç¤ºåŸå§‹æ•°å€¼
lxc-console
-t #æŒ‡å®šè¿æ¥çš„tty</p>

<p>lxc-clone
-oï¼Œâ€“orig              #è¦å…‹éš†çš„åŸå§‹å®¹å™¨çš„åç§°
-n                      #æ–°å®¹å™¨çš„åç§°
-p, â€“lxcpath           #åŸå§‹å®¹å™¨çš„ç³»ç»Ÿæ–‡ä»¶è·¯å¾„ï¼Œä¸é€‰ä½¿ç”¨ç³»ç»Ÿé»˜è®¤è·¯å¾„
-P, â€“newpath           #æ–°å®¹å™¨çš„ç³»ç»Ÿæ–‡ä»¶è·¯å¾„
-K, â€“keepname          #ä¿ç•™åŸå®¹å™¨çš„ä¸»æœºå
-M, â€“keepmac           #ä½¿ç”¨å’ŒåŸå®¹å™¨ç›¸åŒçš„macåœ°å€
lxc-checkconfig         #æ£€æŸ¥å½“å‰å†…æ ¸lxcæ”¯æŒ
lxc-config
lxc-monitor
lxc-top                 #å®¹å™¨ç»Ÿè®¡ä¿¡æ¯
lxc-usernsexec          #ä»¥rootç”¨æˆ·èº«ä»½åœ¨å®¹å™¨å†…è¿è¡Œä»»åŠ¡
    å¯ä»¥ä½¿ç”¨-m é€‰é¡¹æŒ‡å®šç”¨æˆ·çš„uidä»¥è¯¥ç”¨æˆ·çš„èº«ä»½è¿è¡Œå‘½ä»¤
lxc-freeze              #å†»ç»“å®¹å™¨å†…è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ã€‚
lxc-unfreeze            #è§£å†»å®¹å™¨å†…è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ã€‚
lxc-execute             #åœ¨æŒ‡å®šçš„å®¹å™¨å†…è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚ 
lxc-wait
lxc-snapshot #åˆ›å»ºï¼Œåˆ—å‡ºå’Œè¿˜åŸå®¹å™¨å¿«ç…§ã€‚
å¿«ç…§æ–‡ä»¶é»˜è®¤ä¿å­˜åœ¨var /lib/lxc-snaps/å®¹å™¨å
1
-c,â€“comment file       #å°†æ–‡ä»¶ä¸­çš„æ³¨é‡Šä¿¡æ¯å’Œå¿«ç…§å…³è”
-d,â€“destroy            #åˆ é™¤å¿«ç…§
-L,â€“list               #åˆ—å‡ºæ‰€æœ‰å¿«ç…§
-C                      #æ˜¾ç¤ºå¿«ç…§æ³¨é‡Šä¿¡æ¯
-r                      #æ¢å¤å¿«ç…§
newname                 #æ¢å¤å¿«ç…§æ—¶ç”¨äºæŒ‡å®šå®¹å™¨çš„åç§°ã€‚å¯é€‰å‚æ•° ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºä»»ä½•åç§°ï¼Œåˆ™åŸå§‹å®¹å™¨å°†è¢«ç ´åï¼Œå¹¶ä¸”æ¢å¤çš„å®¹å™¨å°†å æ®å…¶ä½ç½®ã€‚
æ³¨æ„:åœ¨aufsï¼Œoverlayfsæˆ–zfsæ”¯æŒçš„å¿«ç…§çš„æƒ…å†µä¸‹ï¼Œåˆ é™¤åŸå§‹å¿«ç…§æ˜¯ä¸å¯èƒ½çš„ã€‚</p>

<p>lxc-cgroup
lxc-cgroupåœ¨ç›¸åº”å­ç³»ç»Ÿçš„å®¹å™¨cgroupä¸­è·å–æˆ–è®¾ç½®çŠ¶æ€å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œâ€™cpuset.cpusâ€™ï¼‰çš„å€¼ï¼ˆä¾‹å¦‚ï¼Œâ€™cpusetâ€™ï¼‰ã€‚ å¦‚æœæ²¡æœ‰æŒ‡å®š[value]ï¼Œåˆ™æ˜¾ç¤ºçŠ¶æ€å¯¹è±¡çš„å½“å‰å€¼; å¦åˆ™è®¾ç½®ã€‚æ³¨æ„lxc-cgroupä¸ä¼šæ£€æŸ¥çŠ¶æ€å¯¹è±¡æ˜¯å¦å¯¹è¿è¡Œçš„å†…æ ¸æœ‰æ•ˆï¼Œæˆ–è€…å¯¹åº”çš„å­ç³»ç»ŸåŒ…å«åœ¨ä»»ä½•å·²å®‰è£…çš„cgroupå±‚æ¬¡ç»“æ„ä¸­
lxc-cgroup {-n name} {state-object} [value]
lxc-unshare
å¯ç”¨äºåœ¨ä¸€ç»„å…‹éš†çš„å‘½åç©ºé—´ä¸­è¿è¡Œä»»åŠ¡ã€‚ æ­¤å‘½ä»¤ä¸»è¦ç”¨äºæµ‹è¯•ç›®çš„ã€‚ å°½ç®¡å®ƒçš„åå­—ï¼Œå®ƒå§‹ç»ˆä½¿ç”¨å…‹éš†è€Œä¸æ˜¯éå…±äº«åˆ›å»ºæ–°çš„ä»»åŠ¡ä¸æ–°çš„å‘½åç©ºé—´ã€‚ é™¤äº†æµ‹è¯•å†…æ ¸å›å½’ä¹‹å¤–ï¼Œè¿™åº”è¯¥æ²¡æœ‰åŒºåˆ«ã€‚</p>

<p>-s namespaces           #æŒ‡å®šè¦é™„åŠ åˆ°çš„å‘½åç©ºé—´
-u user                 #æŒ‡å®šæ–°ä»»åŠ¡åº”è¯¥æˆä¸ºçš„ç”¨æˆ·æ ‡è¯†
-H hostname             #åœ¨æ–°å®¹å™¨ä¸­è®¾ç½®ä¸»æœºåã€‚åªæœ‰è®¾ç½®äº†UTSNAMEå‘½åç©ºé—´æ‰å…è®¸ã€‚
-i interfacename        #å°†å‘½åçš„ç•Œé¢ç§»åŠ¨åˆ°å®¹å™¨ä¸­ã€‚ä»…å½“NETWORKå‘½åç©ºé—´è¢«è®¾ç½®æ—¶æ‰å…è®¸ã€‚æ‚¨å¯ä»¥å¤šæ¬¡æŒ‡å®šæ­¤å‚æ•°ä»¥å°†å¤šä¸ªæ¥å£ç§»åŠ¨åˆ°å®¹å™¨ä¸­ã€‚
-d                      #å®ˆæŠ¤ç¨‹åºï¼Œé€€å‡ºå‰ä¸è¦ç­‰å¾…å®¹å™¨é€€å‡º
-M                      #åœ¨å®¹å™¨ä¸­æŒ‚è½½é»˜è®¤æ–‡ä»¶ç³»ç»Ÿï¼ˆ/ proc / dev / shmå’Œ/ dev / mqueueï¼‰ã€‚å¦‚æœè®¾ç½®MOUNTå‘½åç©ºé—´ï¼Œåˆ™åªæœ‰al-lowedã€‚
lxc-attach
lxc-attachåœ¨ç”±nameæŒ‡å®šçš„å®¹å™¨å†…è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚ å®¹å™¨lxc-attachåœ¨åç§°æŒ‡å®šçš„å®¹å™¨å†…è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚ å®¹å™¨å¿…é¡»å·²ç»è¿è¡Œã€‚ å¦‚æœæœªæŒ‡å®šå‘½ä»¤ï¼Œåˆ™å°†åœ¨å®¹å™¨å†…æŸ¥æ‰¾è¿è¡Œlxc-attachçš„ç”¨æˆ·çš„å½“å‰é»˜è®¤shellï¼Œç„¶åæ‰§è¡Œã€‚ å¦‚æœå®¹å™¨å†…æ²¡æœ‰è¿™æ ·çš„ç”¨æˆ·ï¼Œæˆ–å®¹å™¨æ²¡æœ‰å·¥ä½œçš„nsswitchæœºåˆ¶è¿™å°†å¤±è´¥ã€‚</p>

<p>é€‰é¡¹ï¼š</p>

<p>-nï¼Œâ€“name                      #å®¹å™¨çš„åç§°
-a, â€“arch                      #æŒ‡å®šå†…æ ¸è¿è¡Œçš„æ¶æ„</p>
<ol>
  <li>ç½‘ç»œç®¡ç†
é…ç½®Linuxè™šæ‹Ÿç½‘æ¡¥ä¸ºæ¡¥æ¥æ¨¡å¼
[root@CentOS7.3 ~]#cat ifcfg-eth0</li>
</ol>

<p>DEVICE=â€eth0â€
BOOTPROTO=â€staticâ€
HWADDR=â€â€
NM_CONTROLLED=â€yesâ€
ONBOOT=â€yesâ€
TYPE=â€Ethernetâ€
IPADDR=â€â€
NETMASK=â€â€
GATEWAY=â€â€
DNS1=â€â€
BRIDGE=â€br0â€                #æŠŠeth0æ·»åŠ åˆ°br0</p>

<p>åˆ›å»ºé…ç½®æ–‡ä»¶ifcfg-br0,å¹¶é‡å¯ç½‘ç»œ
[root@CentOS7.3 ~]#cat ifcfg-br0</p>

<p>DEVICE=â€br0â€                    #è®¾å¤‡åå­—ï¼Œå¿…é¡»å’ŒBRIDGE=â€œâ€é‡Œçš„ç›¸åŒ
TYPE=â€Bridgeâ€                   #æŒ‡å®šç±»å‹ä¸ºç½‘æ¡¥
NOBOOT=â€yesâ€
BOOTPROTO=â€staticâ€
IPADDR=â€â€                       #ç½‘æ¡¥çš„ç®¡ç†åœ°å€
NETMASK=â€255.255.255.0â€
GATEWAY=â€â€
DNS1=â€â€
DELAY=â€0â€                    #ç›‘æ§æµé‡é‡Œçš„macåœ°å€</p>

<p>æŸ¥çœ‹æ‰€æœ‰ç½‘æ¡¥
[root@CentOS7.3 ~]# brctl  show
bridge name    bridge id        STP enabled    interfaces
br0        8000.5404a6a7ff6c    no        eth0                        <br />
é€šè¿‡å‘½ä»¤é…ç½®,ä¸´æ—¶ç”Ÿæ•ˆã€‚
[root@CentOS7.3 ~]#brctl addbr br0
[root@CentOS7.3 ~]#brctl addif br0 eth1
[root@CentOS7.3 app]#ifconfig  br0 172.16.200.33/16 up
[root@CentOS7.3 app]#ip add del dev eth1 172.16.252.71/16</p>
<ol>
  <li>lxcçš„webç®¡ç†é…ç½®
åŸºäºpython-flask Webæ¡†æ¶å¼€å‘ï¼Œä¸ºlxcæä¾›ä¸€ä¸ªwebç®¡ç†é¡µé¢</li>
</ol>

<p>ç›‘å¬ç«¯å£    ï¼štcp/5000
é»˜è®¤ç”¨æˆ·å  ï¼šadmin
å¯†ç         ï¼šadmin
yum -y install python-flask git             #å®‰è£…è½¯ä»¶åŒ…
git clone https://github.com/lxc-webpanel/LXC-Web-Panel.git #å…‹éš†è½¯ä»¶åŒ…
cd LXC-Web-Panel                            #è¿›å…¥è½¯ä»¶ç›®å½•
python lwp.py                               #ä½¿ç”¨pythonè¿è¡Œ
https://linuxcontainers.org/lxc/manpages/man1/lxc-start.1.html</p>

<p>XENå’ŒKVMå®ç°äº†çœŸæ­£çš„è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼›LXCç¡®åˆ‡æ¥è¯´åº”è¯¥æ˜¯èµ„æºéš”ç¦»ï¼ˆnamespaceï¼‰ï¼Œå¹¶ä¸èƒ½æä¾›å®Œæ•´çš„ç‰©ç†éš”ç¦»åŠŸèƒ½ã€‚</p>

<p>XENè™šæ‹ŸåŒ–æ˜¯ç›¸å¯¹äºKVMæ¥è¯´æ›´åŠ æˆç†Ÿçš„è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼ŒåƒAWSã€Azureç­‰å…¬æœ‰äº‘éƒ½æ˜¯ä½¿ç”¨çš„XENä½œä¸ºè™šæ‹ŸåŒ–æ–¹æ¡ˆï¼›è€Œéšç€æœ€è¿‘å‡ å¹´KVMçš„å‘å±•ä»¥åŠKVMè¾ƒå¥½çš„æ€§èƒ½ï¼Œå›½å†…çš„éƒ¨åˆ†è™šæ‹ŸåŒ–å‚å•†å¼€å§‹é€‰æ‹©KVMä½œä¸ºæ–°çš„è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼Œåƒç™¾åº¦ã€Intelä¸­å›½ã€é˜¿é‡Œäº‘ç­‰å¼€å§‹é€æ­¥å‘KVMè¿ç§»ã€‚</p>

<p>LXCé€šè¿‡èµ„æºéš”ç¦»å’Œå‘½åç©ºé—´å®ç°äº†ä¼ªè™šæ‹ŸåŒ–åŠŸèƒ½ï¼Œç”±äºLXCè¾ƒé«˜çš„æ€§èƒ½å’Œä¸å½»åº•çš„éš”ç¦»ï¼Œè¶Šæ¥è¶Šå¤šçš„åº”ç”¨åˆ°ç§æœ‰äº‘ä¸Šã€‚</p>

:ET