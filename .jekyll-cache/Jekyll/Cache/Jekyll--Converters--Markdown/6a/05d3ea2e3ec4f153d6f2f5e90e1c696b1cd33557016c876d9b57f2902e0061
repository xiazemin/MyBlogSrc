I"Ú<p>æˆ‘ä»¬å¯ä»¥åœ¨Edit Configurationä¸­è¿›è¡Œé…ç½®
ç„¶åæˆ‘ä»¬åœ¨è¿™ä¸ªçª—å£å»é…ç½®å½“å‰Goç¨‹åºçš„å‚æ•°
é…ç½®å¥½ä¹‹åç‚¹å‡»Debugå³å¯ã€‚
<!-- more -->
<img src="https://xiazemin.github.io/MyBlog/img/debug_easyjson.png" /></p>

<p>err := p.Parse(fname, fInfo.IsDir()); 
ä¼šè§£ææˆ‘ä»¬è¾“å…¥çš„æ–‡ä»¶example.go
package example
type AutoGenerated struct {
	Name  string <code class="language-plaintext highlighter-rouge">json:"name"</code>
	Value int    <code class="language-plaintext highlighter-rouge">json:"value"</code>
}</p>

<p>è§£æè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨
f, err := parser.ParseFile(fset, fname, nil, parser.ParseComments)
è·å–ast
ç„¶åè·å–è¯­æ³•æ ‘ä¸­æˆ‘ä»¬æ„Ÿå…´è¶£çš„éƒ¨åˆ†
ast.Walk(&amp;visitor{Parser: p}, f)</p>

<p>é‡ç‚¹æ˜¯
func (v *visitor) Visit(n ast.Node) (w ast.Visitor) {
	switch n := n.(type) {
	case *ast.Package:
		return v
	case *ast.File:
		v.PkgName = n.Name.String()
		return v</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>case *ast.GenDecl:
	v.explicit = v.needType(n.Doc.Text())

	if !v.explicit &amp;&amp; !v.AllStructs {
		return nil
	}
	return v
case *ast.TypeSpec:
	v.name = n.Name.String()

	// Allow to specify non-structs explicitly independent of '-all' flag.
	if v.explicit {
		v.StructNames = append(v.StructNames, v.name)
		return nil
	}
	return v
case *ast.StructType:
	v.StructNames = append(v.StructNames, v.name)
	return nil
}
return nil } è§£ææˆ‘ä»¬æ„Ÿå…´è¶£çš„åŒ…ï¼Œç»“æ„ä½“å£°æ˜ç­‰ä¿¡æ¯
</code></pre></div></div>

<p>g.writeStub();
ç”Ÿæˆæ–‡ä»¶
/Users/didi/goLang/src/github.com/xiazemin/go-json/json2go/example_easyjson.go</p>

<p>// TEMPORARY AUTOGENERATED FILE: easyjson stub code to make the package
// compilable during generation.</p>

<p>package  example</p>

<p>import (
  â€œgithub.com/mailru/easyjson/jwriterâ€
  â€œgithub.com/mailru/easyjson/jlexerâ€
)</p>

<p>func ( AutoGenerated ) MarshalJSON() ([]byte, error) { return nil, nil }
func (* AutoGenerated ) UnmarshalJSON([]byte) error { return nil }
func ( AutoGenerated ) MarshalEasyJSON(w <em>jwriter.Writer) {}
func (</em> AutoGenerated ) UnmarshalEasyJSON(l *jlexer.Lexer) {}</p>

<p>type EasyJSON_exporter_AutoGenerated *AutoGenerated</p>

<p>g.writeMain()
ç”Ÿæˆä¸´æ—¶æ–‡ä»¶  /Users/didi/goLang/src/github.com/xiazemin/go-json/json2go/easyjson-bootstrap501241316.go</p>

<p>// +build ignore</p>

<p>// TEMPORARY AUTOGENERATED FILE: easyjson bootstapping code to launch
// the actual generator.</p>

<p>package main</p>

<p>import (
  â€œfmtâ€
  â€œosâ€</p>

<p>â€œgithub.com/mailru/easyjson/genâ€</p>

<p>pkg â€œgithub.com/xiazemin/go-json/json2goâ€
)</p>

<p>func main() {
  g := gen.NewGenerator(â€œexample_easyjson.goâ€)
  g.SetPkg(â€œexampleâ€, â€œgithub.com/xiazemin/go-json/json2goâ€)
  g.Add(pkg.EasyJSON_exporter_AutoGenerated(nil))
  if err := g.Run(os.Stdout); err != nil {
    fmt.Fprintln(os.Stderr, err)
    os.Exit(1)
  }
}</p>

<p>åˆ›å»ºå¦ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶
/Users/didi/goLang/src/github.com/xiazemin/go-json/json2go/example_easyjson.go.tmp</p>

<p>æ‰§è¡Œå‘½ä»¤
go run -tags â€œâ€ easyjson-bootstrap501241316.go
å°†std out æŒ‡å®šä¸ºexample_easyjson.go.tmp</p>

<p>å†…å®¹ä¸º
// Code generated by easyjson for marshaling/unmarshaling. DO NOT EDIT.</p>

<p>package  example</p>

<p>import (
  easyjson â€œgithub.com/mailru/easyjsonâ€
  jlexer â€œgithub.com/mailru/easyjson/jlexerâ€
  json â€œencoding/jsonâ€
  jwriter â€œgithub.com/mailru/easyjson/jwriterâ€
)</p>

<p>// suppress unused package warning
var (
   _ *json.RawMessage
   _ *jlexer.Lexer
   _ *jwriter.Writer
   _ easyjson.Marshaler
)</p>

<p>func easyjsonEeca4a30DecodeGithubComXiazeminGoJsonJson2go(in *jlexer.Lexer, out *AutoGenerated) {
  isTopLevel := in.IsStart()
  if in.IsNull() {
    if isTopLevel {
      in.Consumed()
    }
    in.Skip()
    return
  }
  in.Delim(â€˜{â€˜)
  for !in.IsDelim(â€˜}â€™) {
    key := in.UnsafeString()
    in.WantColon()
    if in.IsNull() {
       in.Skip()
       in.WantComma()
       continue
    }
    switch key {
    case â€œnameâ€:
      out.Name = string(in.String())
    case â€œvalueâ€:
      out.Value = int(in.Int())
    default:
      in.SkipRecursive()
    }
    in.WantComma()
  }
  in.Delim(â€˜}â€™)
  if isTopLevel {
    in.Consumed()
  }
}
func easyjsonEeca4a30EncodeGithubComXiazeminGoJsonJson2go(out *jwriter.Writer, in AutoGenerated) {
  out.RawByte(â€˜{â€˜)
  first := true
  _ = first
  {
    const prefix string = â€œ,"name":â€
      out.RawString(prefix[1:])
    out.String(string(in.Name))
  }
  {
    const prefix string = â€œ,"value":â€
    out.RawString(prefix)
    out.Int(int(in.Value))
  }
  out.RawByte(â€˜}â€™)
}
// MarshalJSON supports json.Marshaler interface
func (v AutoGenerated) MarshalJSON() ([]byte, error) {
  w := jwriter.Writer{}
  easyjsonEeca4a30EncodeGithubComXiazeminGoJsonJson2go(&amp;w, v)
  return w.Buffer.BuildBytes(), w.Error
}
// MarshalEasyJSON supports easyjson.Marshaler interface
func (v AutoGenerated) MarshalEasyJSON(w *jwriter.Writer) {
  easyjsonEeca4a30EncodeGithubComXiazeminGoJsonJson2go(w, v)
}
// UnmarshalJSON supports json.Unmarshaler interface
func (v *AutoGenerated) UnmarshalJSON(data []byte) error {
  r := jlexer.Lexer{Data: data}
  easyjsonEeca4a30DecodeGithubComXiazeminGoJsonJson2go(&amp;r, v)
  return r.Error()
}
// UnmarshalEasyJSON supports easyjson.Unmarshaler interface
func (v *AutoGenerated) UnmarshalEasyJSON(l *jlexer.Lexer) {
  easyjsonEeca4a30DecodeGithubComXiazeminGoJsonJson2go(l, v)
}</p>

<p>é‡å‘½å
<img src="https://xiazemin.github.io/MyBlog/img/easyjson.png" /></p>
:ET