I"µ6<p>PHP-Parseræ˜¯ä¸€æ¬¾PHPæºä»£ç åˆ†æå™¨ï¼Œå¯ä»¥å°†PHPæºä»£ç è§£æä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚
é¡¹ç›®ä¸»é¡µæ˜¯https://github.com/nikic/PHP-Parserã€‚</p>

<p>å®‰è£…
git â€“clone https://github.com/nikic/PHP-Parser.git
è¿›å…¥ æºä»£ç ç›®å½• PHP-Parserï¼Œ
é€šè¿‡PHPåŒ…ç®¡ç†å™¨composer.pharæ¥å®‰è£…ï¼ˆPHPç‰ˆæœ¬5.6ä»¥ä¸Šï¼‰ï¼š
$php composer.phar require</p>

<p>å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæŠ¥ä¸€ä¸‹é”™è¯¯ï¼š
error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE Composer</p>

<p>ä¸‹è½½æ—¶ï¼Œä½¿ç”¨çš„è¯ä¹¦ä¸å¯¹ï¼Œè§£å†³åŠæ³•ï¼š
curl https://curl.haxx.se/ca/cacert.pem -o cacert.pem</p>

<p>é…ç½®php.iniæ–‡ä»¶ï¼Œå¢åŠ ï¼š
[openssl]
openssl.cafile=xxx/cacert.pem</p>

<p>ç”¨æ³•
$php bin/php-parse test.php
<!-- more -->
PHP-Parser æ˜¯ä¸€ä¸ªç”¨æ¥æ ¼å¼åŒ– PHP ä»£ç çš„å¥½å·¥å…·ï¼Œæ¯”å¦‚è¢«æ··æ·†è¿‡çš„ PHP ä»£ç ï¼Œå¯ä»¥é€šè¿‡ PHP-Parser å¿«é€Ÿæ ¼å¼åŒ–ã€‚</p>

<p>PHP-Parser å¯ä»¥åœ¨https://github.com/nikic/PHP-Parser/releasesè¿™é‡Œè·å–åˆ°ï¼Œæ¯”å¦‚æˆ‘è¿™æ¬¡ä¸‹è½½çš„ 4.1.0 çš„ç‰ˆæœ¬ã€‚</p>

<p>ä¸è¿‡è¦è®°ä½ï¼Œå¿…é¡»å®‰è£… PHP7.0 ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰æ»¡è¶³ä½¿ç”¨æ¡ä»¶ï¼Œå¯ä»¥ä» composer.json æ–‡ä»¶çœ‹åˆ°è¿™ä¸ªæ¡ä»¶ã€‚ï¼ˆå¦‚æœä¸‹è½½çš„ PHP-Parser æ˜¯ä»¥å‰è¾ƒä½çš„ç‰ˆæœ¬ï¼Œå¯èƒ½ PHP5 çš„ç¯å¢ƒä¹Ÿèƒ½æ»¡è¶³ï¼Œä¸»è¦çœ‹ composer.json è¿™ä¸ªæ–‡ä»¶çš„è¦æ±‚ã€‚å¯ä»¥æ ¹æ®è‡ªå·±å½“å‰çš„ PHP ç‰ˆæœ¬å†³å®šä¸‹è½½å“ªä¸ªç‰ˆæœ¬çš„ PHP-Parserï¼‰</p>

<p>å¯ä»¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ php -v æŸ¥çœ‹å½“å‰ç¯å¢ƒçš„ php ç‰ˆæœ¬ã€‚å¦‚æœ windows ä¸‹ php è¿è¡Œçš„æ˜¯ php7ï¼Œä½† php -v çœ‹åˆ°çš„æ˜¯ php5ï¼Œåˆ™éœ€è¦ä¿®æ”¹ç¯å¢ƒå˜é‡å…³äº php çš„è·¯å¾„ã€‚</p>

<p>æ¥ä¸‹æ¥ï¼Œä¿è¯ç”µè„‘å®‰è£…äº† composerï¼Œå¦‚æœæ˜¯ windows éœ€è¦ä¸‹è½½ composer å¹¶å®‰è£…ï¼Œlinux ç¯å¢ƒä¸€èˆ¬å¯èƒ½è‡ªå¸¦äº†ã€‚ï¼ˆå…¶å®ä¸å®‰è£… composer ä¹Ÿå¯ä»¥ï¼Œå› ä¸ºåé¢é€šè¿‡ php å‘½ä»¤è¡Œä¸‹è½½äº†ä¸€ä¸ª composer.phar çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥å……å½“ composer çš„åŠŸèƒ½ï¼‰</p>

<p>ç„¶åè¿›å…¥ PHP-Parser ç›®å½•ï¼Œå¦‚æœæ˜¯ windows åˆ™ä½¿ç”¨ cmd å‘½ä»¤ï¼ˆç®¡ç†å‘˜è¿è¡Œï¼‰åˆ° PHP-Parser ç›®å½•ï¼Œæ‰§è¡Œï¼š</p>

<p>php -r â€ eval(â€˜?&gt;â€™ .file_get_contents(â€˜https://getcomposer.org/installerâ€™));â€</p>

<p>è¿™æ¡å‘½ä»¤å…¶å®å°±æ˜¯ä»
https://getcomposer.org/installer è¿™é‡Œä¸‹è½½ composer.phar åˆ°å½“å‰ç›®å½•ã€‚</p>

<p>å¦‚æœå‘ç°å¤±è´¥ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰å¯ç”¨ openssl æ‰©å±•ï¼Œå¯ä»¥å» php7 ç›®å½•æ‰“å¼€ php.ini å¯ç”¨ openssl æ‰©å±•ï¼Œå†é‡å¯ php å³å¯ã€‚</p>

<p>ç„¶åå†æ‰§è¡Œï¼š</p>

<p>php composer.phar require nikic/php-parser</p>

<p>å°±å¯ä»¥å®‰è£…å¥½ PHP-Parser çš„ä¾èµ–ç¯å¢ƒã€‚è¿™æ˜¯æŒ‰å®˜æ–¹çš„æ–¹æ³•ã€‚</p>

<p>ä½†é—®é¢˜æ˜¯ï¼Œæ‰§è¡Œ php composer.phar require nikic/php-parser æ—¶ï¼Œå‡ºäº†é—®é¢˜ã€‚</p>

<p>æç¤ºï¼š</p>

<p>Using version ^4.1@dev for nikic/php-parser
./composer.json has been updated
Loading composer repositories with package information
Updating dependencies (including require-dev)
Your requirements could not be resolved to an installable set of packages.</p>

<p>Problem 1
â€“ The requested package nikic/php-parser No version set (parsed as 1.0.0) is satisfiable by nikic/php-parser[No version set (parsed as 1.0.0)] but these conflict with your requirements or minimum-stability.</p>

<p>Installation failed, reverting ./composer.json to its original content.</p>

<p>è¿™ä¸ªæ„æ€æ˜¯æ²¡æœ‰è®¾ç½® nikic/php-parser çš„ç‰ˆæœ¬å·ï¼Œè¢«é»˜è®¤ç†è§£ä¸ºä½¿ç”¨ 1.0.0 çš„ç‰ˆæœ¬ï¼Œä½†è¿™å’Œè¦æ±‚çš„æœ€ä½ç¨³å®šæ€§ç›¸å†²çªã€‚</p>

<p>æ‰€ä»¥è¿™æ ·åšï¼Œæ‰“å¼€ composer.jsonï¼Œåœ¨â€nameâ€: â€œnikic/php-parserâ€,è¿™è¡Œä¸‹é¢å¢åŠ ä¸€è¡Œï¼šâ€versionâ€: â€œ4.1.0â€,</p>

<p>ä¸ºä»€ä¹ˆæˆ‘çŸ¥é“æ˜¯ä½¿ç”¨ 4.1.0 çš„ç‰ˆæœ¬å‘¢ï¼Ÿ</p>

<p>å…¶å®å¯ä»¥æ‰§è¡Œï¼šcomposer show -all nikic/php-parserï¼Œè¿™æ¡å‘½ä»¤çœ‹åˆ° nikic/php-parser çš„å…¨éƒ¨ç‰ˆæœ¬ã€‚</p>

<p>æ³¨ï¼šå¦‚æœä¸‹è½½ PHP-Parser æ—©æœŸçš„ç‰ˆæœ¬ï¼Œå¯èƒ½ä¿®æ”¹ composer.json æ—¶ï¼Œ
â€œversionâ€: â€œ4.1.0â€,</p>

<p>è¿™è¡Œè§†å…·ä½“æƒ…å†µä¿®æ”¹å¯¹åº”çš„ç‰ˆæœ¬å·ã€‚</p>

<p>ä¿®æ”¹å®Œ composer.json åï¼Œå†æ‰§è¡Œ
php composer.phar require nikic/php-parser è¿™æ¡å‘½ä»¤ï¼Œå°±å®‰è£…æˆåŠŸäº†ã€‚</p>

<p>åé¢å°±å¯ä»¥ä½¿ç”¨ PHP-Parser äº†ã€‚</p>

<p>å‰ä¸€é˜µå’Œå‰åŒäº‹äº¤æµåœ¨æ£€æµ‹webshellæ–¹é¢çš„ç›¸å…³æ–¹æ³•ï¼Œå…¶ä¸­æå‡ºäº†ä½¿ç”¨lex yaccåšä¸€å¥—è¯­æ³•è§£ææ¥è§£æå­—èŠ‚ç æ®µæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨webshellã€‚</p>

<p>åæ¥åœ¨æŸ¥æ‰¾ç›¸å…³èµ„æ–™ä¸­ï¼Œæ‰¾åˆ°äº†githubå¼€æºçš„ä¸€ä¸ªå·¥å…·ï¼šPHP-Parserã€‚èƒ½å¤ŸæŠŠphpæ–‡ä»¶è§£æASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰</p>

<p>Project: https://github.com/nikic/PHP-Parser</p>

<p>å®‰è£…ï¼š</p>

<p>php composer.phar require nikic/php-parser
ä¾‹å¦‚ï¼š</p>

<p>&lt;?php
use PhpParser\Error;
use PhpParser\NodeDumper;
use PhpParser\ParserFactory;</p>

<p>$code = Â«&lt;â€™CODEâ€™
&lt;?php</p>

<p>function test($foo)
{
    var_dump($foo);
}
CODE;</p>

<p>$parser = (new ParserFactory)-&gt;create(ParserFactory::PREFER_PHP7);
try {
    $ast = $parser-&gt;parse($code);
} catch (Error $error) {
    echo â€œParse error: {$error-&gt;getMessage()}\nâ€;
    return;
}</p>

<p>$dumper = new NodeDumper;
echo $dumper-&gt;dump($ast) . â€œ\nâ€;
è½¬å‚¨ASTä¸ºï¼š</p>

<p>array(
    0: Stmt_Function(
        byRef: false
        name: Identifier(
            name: test
        )
        params: array(
            0: Param(
                type: null
                byRef: false
                variadic: false
                var: Expr_Variable(
                    name: foo
                )
                default: null
            )
        )
        returnType: null
        stmts: array(
            0: Stmt_Expression(
                expr: Expr_FuncCall(
                    name: Name(
                        parts: array(
                            0: var_dump
                        )
                    )
                    args: array(
                        0: Arg(
                            value: Expr_Variable(
                                name: foo
                            )
                            byRef: false
                            unpack: false
                        )
                    )
                )
            )
        )
    )
)
å¯ä»¥çœ‹åˆ°å„ä¸ªèŠ‚ç‚¹çš„å«ä¹‰ï¼Œç›¸æ¯”è¾ƒæŸ¥çœ‹opcodeç„¶åå†å»è§£æå®¹æ˜“çš„å¤šï¼Œopcodeæ¯”è¾ƒæ™¦æ¶©éš¾æ‡‚ã€‚</p>

<p>å¦‚æœåšå¾—å¥½ï¼Œå†è¿›è¡Œå›å½’æˆåŸå§‹çš„ä»£ç ï¼Œä¾‹å¦‚webshellä¸­å­˜åœ¨å¾ˆå¤šå­—ç¬¦ä¸²æ‹¼æ¥ã€å‡½æ•°æ‹¼æ¥ç­‰æ“ä½œã€‚å›å½’æœ€ç»ˆåŸå§‹ä»£ç ï¼Œå†å»æ£€æµ‹ä¼šå˜å¾—å®¹æ˜“çš„å¤šã€‚</p>

<p>å…³äºphp-parserçš„æ–‡æ¡£ä¹Ÿæœ‰å¾ˆå¤šï¼š</p>

<p>https://github.com/nikic/PHP-Parser/tree/master/doc</p>

<p>æˆ‘ä¸ªäººçš„ç›®å‰æ€è·¯ï¼š</p>

<p>1ã€è·å–webç›®å½•</p>

<p>2ã€å¯¹æ¯ä¸ªphpæ–‡ä»¶ç”ŸæˆAST</p>

<p>3ã€è§£æASTï¼Œè¿›è¡Œè¯­æ³•å›å½’ï¼Œè½¬å‚¨åŸå§‹ä»£ç  // è¿™ä¸ªåœ°æ–¹æ¯”è¾ƒæœ‰éš¾åº¦</p>

<p>4ã€ä½¿ç”¨å¤šå¼•æ“ï¼ˆæ­£åˆ™ã€æœºå™¨å­¦ä¹ ã€ç¬¬ä¸‰æ–¹æ¥å£ï¼‰è¿›è¡Œåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¼‚å¸¸</p>

<p>ç”±äºè¦åšåŸºäºæ•°æ®æµåˆ†æçš„é™æ€ä»£ç åˆ†æï¼Œæ‰€ä»¥å‰ç«¯çš„å·¥ä½œå¦‚ï¼šè¯æ³•åˆ†æã€è¯­æ³•åˆ†æå¿…ä¸å¯å°‘ã€‚Yaccå’ŒLexä»€ä¹ˆçš„å°±ä¸å†è€ƒè™‘äº†ï¼ŒæŸ¥äº†ä¸€å¤©çš„èµ„æ–™ï¼Œå‘ç°ä¸¤æ¬¾æ¯”è¾ƒé€‚åˆï¼Œä¸€æ¬¾æ˜¯Javaä¸‹çš„ANTLRï¼Œå¦ä¸€æ¬¾æ˜¯ä¸“é—¨åšPHPÂ ASTç”Ÿæˆçš„PHP-Parserã€‚</p>

<p>ANTLRæ˜¯ç¼–è¯‘åŸç†é¢†åŸŸæ¯”è¾ƒè‘—åçš„å·¥å…·äº†ï¼Œç›¸å¯¹äºYaccå’ŒLexï¼Œæ›´åŠ å®ç”¨ã€‚ä½†æ˜¯å¯¹PHPçš„è¯­æ³•æ–‡ä»¶åªæœ‰ä¸€ä¸ªï¼ŒæŠ˜è…¾äº†åŠå¤©æ‰ç”Ÿæˆè°ƒé€šï¼Œå‘ç°ä¸å¤ªé€‚åˆï¼Œå¯¹äºâ€$a=1â€ç”Ÿæˆtokensç«Ÿç„¶æ˜¯[$,a,=,1]ï¼Œæ— æ³•è¯†åˆ«assignmentï¼Œåšå¾—è¿‡äºç²—ç³™ï¼Œä»¤äººæ— æ¯”å¤±æœ›ã€‚</p>

<p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒPHP-Parseræ›´åŠ ä¸“ä¸šä¸€äº›ï¼Œæ¯•ç«Ÿä¸“æ³¨PHPçš„è¯æ³•ã€è¯­æ³•åˆ†æå·¥ä½œã€‚</p>

<p>Â </p>

<p>1ã€ä»‹ç»</p>

<p>PHP-Parserçš„é¡¹ç›®ä¸»é¡µæ˜¯https://github.com/nikic/PHP-Parserã€‚å¯ä»¥å¯¹å¤šç‰ˆæœ¬çš„PHPè¿›è¡Œå®Œç¾è§£æï¼Œç”Ÿæˆä¸€é¢—æŠ½è±¡è¯­æ³•æ ‘ã€‚</p>

<p>å¯¹äºè¯æ³•åˆ†æï¼ŒPHPæœ‰ä¸ªå†…ç½®å‡½æ•°token_get_all()å¯ä»¥ç”¨æ¥è·å–TOKENSï¼Œä½œä¸ºè¯­æ³•åˆ†æçš„è¾“å…¥ï¼Œè¿™ä¸ªå¼€æºé¡¹ç›®ä¹Ÿæ˜¯ç”¨çš„token_get_all()ç”Ÿæˆçš„tokenæµã€‚</p>

<p>Â </p>

<p>2ã€å®‰è£…</p>

<p>å®‰è£…ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œæˆ‘æ˜¯ä½¿ç”¨çš„PHPä¸­çš„åŒ…ç®¡ç†å·¥å…·composeræ·»åŠ çš„ï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š</p>

<p>phpÂ composer.pharÂ requireÂ nikic/php-parser</p>

<p>å¦‚æœæ²¡æœ‰ä¸‹è½½Composerï¼Œåº”è¯¥å…ˆæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>

<table>
  <tbody>
    <tr>
      <td>CurlÂ -sÂ http://getcomposer.org/installerÂ </td>
      <td>Â phpÂ Â </td>
    </tr>
  </tbody>
</table>

<p>Â </p>

<p>3ã€ç”ŸæˆAST</p>

<p>ä½¿ç”¨composeræ·»åŠ php-parserä¹‹åï¼Œå°±å¯ä»¥æ–¹ä¾¿ä½¿ç”¨ã€‚</p>

<p>é¦–å…ˆä»‹ç»ä¸€ä¸‹PHP-Parserä¸­å®šä¹‰çš„ä¸€äº›èŠ‚ç‚¹ç±»å‹ï¼š</p>

<p>ï¼ˆ1ï¼‰PhpParser\Node\Stmtæ˜¯è¯­å¥èŠ‚ç‚¹ï¼Œä¸å¸¦ä»»ä½•è¿”å›ä¿¡æ¯ï¼ˆreturnï¼‰çš„ç»“æ„ï¼Œå¦‚èµ‹å€¼è¯­å¥â€$aÂ =Â $bâ€Â ;</p>

<p>ï¼ˆ2ï¼‰PhpParser\Node\Expræ˜¯è¡¨è¾¾å¼èŠ‚ç‚¹ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªå€¼çš„è¯­è¨€ç»“æ„ï¼Œå¦‚$varå’Œfunc()ã€‚</p>

<p>ï¼ˆ3ï¼‰PhpParser\Node\Scalaræ˜¯å¸¸é‡èŠ‚ç‚¹ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»ä½•å¸¸é‡å€¼ã€‚å¦‚â€™stringâ€™,0,ä»¥åŠå¸¸é‡è¡¨è¾¾å¼ã€‚</p>

<p>ï¼ˆ4ï¼‰è¿˜æœ‰ä¸€äº›èŠ‚ç‚¹æ²¡æœ‰åŒ…æ‹¬è¿›å»ï¼Œå¦‚å‚æ•°èŠ‚ç‚¹(PhpParser\Node\Arg)ã€‚</p>

<p>ä¸€äº›èŠ‚ç‚¹ç±»çš„åç§°ä½¿ç”¨äº†ä¸‹åˆ’çº¿ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å’ŒPHPå…³é”®å­—å†²çªã€‚</p>

<p>PHP-parserçš„HelloWorldç¨‹åºå¦‚ä¸‹ï¼Œè¯¥ä»£ç ç‰‡æ®µä¼šç”ŸæˆASTï¼š</p>

<p>è¾“å‡ºç»“æœä¸ºï¼š</p>

<p><span style="font-size:12px;">Array
(
    [0] =&gt; PhpParser\Node\Stmt\Echo_ Object
    (
            [subNodes:protected] =&gt; Array
                (
                    [exprs] =&gt; Array
                        (
                            [0] =&gt; PhpParser\Node\Scalar\String Object
                                (
                                    [subNodes:protected] =&gt; Array
                                        (
                                            [value] =&gt; 1+2
                                        )</span></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                [attributes:protected] =&gt; Array
                                    (
                                        [startLine] =&gt; 1
                                        [endLine] =&gt; 1
                                    )
 
                            )
 
                        [1] =&gt; PhpParser\Node\Scalar\String Object
                            (
                                [subNodes:protected] =&gt; Array
                                    (
                                        [value] =&gt; chongrui
                                    )
 
                                [attributes:protected] =&gt; Array
                                    (
                                        [startLine] =&gt; 1
                                        [endLine] =&gt; 1
                                    )
 
                            )
 
                    )
 
            )
 
        [attributes:protected] =&gt; Array
            (
                [startLine] =&gt; 1
                [endLine] =&gt; 1
            )
 
    )
</code></pre></div></div>

<p>)&lt;/span&gt;
å¯ä»¥çœ‹åˆ°ï¼Œè¿™è¯¾ASTåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹Echo_ï¼Œæ­¤èŠ‚ç‚¹æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹exprsï¼Œå¯ä»¥ä½¿ç”¨$stmts[0]-&gt;exprsè¿›è¡Œè®¿é—®ã€‚</p>

<p>å¯¹äºèŠ‚ç‚¹ä¸­çš„attributesä¿¡æ¯æ˜¯ç”¨æ¥å­˜å‚¨startLineå’ŒendLineä»¥åŠcommentsçš„ã€‚å¯ä»¥ä½¿ç”¨getAttributes(),getAttribute(â€˜startLineâ€™),setAttribute(),hasAttribute()æ–¹æ³•è¿›è¡Œè®¿é—®ã€‚</p>

<p>å¼€å§‹è¡Œå·startLineå¯ä»¥é€šè¿‡getLine()/setLine()æ–¹æ³•è¿›è¡Œè®¿é—®ï¼ˆä¹Ÿå¯ä»¥getAttribute(â€˜startLineâ€™)ï¼‰ã€‚æ³¨é‡Šä¿¡æ¯å¯ä»¥ä½¿ç”¨getDocComment()è·å–ã€‚</p>

<p>è®¿é—®èŠ‚ç‚¹ä¸Šçš„å€¼ï¼šå¦‚è®¿é—®å€¼â€œchongruiâ€ï¼Œä½¿ç”¨$stmts[0]-&gt;exprs[1]-&gt;value;å³å¯ã€‚</p>

<p>Â </p>

<p>Â </p>

<p>4ã€èŠ‚ç‚¹éå†</p>

<p>å¯¹æŠ½è±¡è¯­æ³•æ ‘çš„éå†éå¸¸æ–¹ä¾¿ï¼Œä½¿ç”¨PhpParser\NodeTraverserç±»å³å¯ã€‚åŒæ—¶ï¼Œæ”¯æŒè‡ªå®šä¹‰çš„Visitorå¯¹è±¡ã€‚å› ä¸ºåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯¹PHPæºç è¿›è¡Œåˆ†æï¼Œå¾€å¾€æ˜¯ä¸çŸ¥é“ASTçš„å…·ä½“ç»“æ„ï¼Œè¿™æ—¶éœ€è¦åŠ¨æ€çš„å»åˆ¤æ–­æ¯ä¸ªèŠ‚ç‚¹çš„ç±»å‹ä¿¡æ¯ã€‚</p>

<p>è¿™äº›åˆ¤æ–­ç»Ÿä¸€å†™åˆ°MyNodeVisitorä¸­ï¼Œè¯¥ç±»ç»§æ‰¿äº†ä¸€ä¸ªçˆ¶ç±»NodeVisitorAbstractï¼Œè¿™ä¸ªç±»ä¸­æœ‰ä¸€äº›æ–¹æ³•ï¼š</p>

<p>ï¼ˆ1ï¼‰beforeTraverse()æ–¹æ³•ç”¨äºéå†ä¹‹å‰ï¼Œé€šå¸¸ç”¨æ¥åœ¨éå†å‰å¯¹å€¼è¿›è¡Œé‡ç½®ã€‚</p>

<p>ï¼ˆ2ï¼‰afterTraverse()æ–¹æ³•å’Œï¼ˆ1ï¼‰ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„åœ°æ–¹æ˜¯éå†ä¹‹åæ‰è§¦å‘ã€‚</p>

<p>ï¼ˆ3ï¼‰enterNode()å’ŒleaveNode()æ–¹æ³•åœ¨å¯¹æ¯ä¸ªèŠ‚ç‚¹è®¿é—®æ—¶è§¦å‘ã€‚</p>

<p>enterNodeåœ¨è¿›å…¥èŠ‚ç‚¹æ—¶è§¦å‘ï¼Œæ¯”å¦‚åœ¨è®¿é—®èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¹‹å‰ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›NodeTraverser::DONT_TRAVERSER_CHILDRENï¼Œç”¨æ¥è·³è¿‡è¯¥èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹ã€‚</p>

<p>leaveNodeåœ¨éå†èŠ‚ç‚¹å®Œæˆä¹‹åè§¦å‘ã€‚å®ƒå¯ä»¥è¿”å›</p>

<p>NodeTraverser::REMOVE_NODEï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰èŠ‚ç‚¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¿”å›ä¸€ä¸ªèŠ‚ç‚¹çš„é›†åˆï¼Œé‚£ä¹ˆè¿™äº›èŠ‚ç‚¹ä¼šå¹¶å…¥åˆ°çˆ¶èŠ‚ç‚¹çš„arrayä¸­ï¼Œæ¯”å¦‚array(A,B,C),BèŠ‚ç‚¹è¢«array(X,Y,Z)æ›¿æ¢ï¼Œå˜æˆarray(A,X,Y,Z,C)Â .</p>

<p>ä¸‹é¢çš„ä»£ç ç‰‡æ®µå¯¹$codeè¿›è¡Œè§£æï¼Œç”ŸæˆASTï¼Œå¹¶ä¸”åœ¨éå†æ—¶ï¼Œå½“å‘ç°éå†èŠ‚ç‚¹æ—¶Stringç±»å‹æ—¶ï¼Œå°±è¿›è¡Œè¾“å‡ºã€‚</p>

<p>ç»“æœä¼šè¾“å‡º1,2ã€‚</p>

<p>5ã€å…¶ä»–ASTè¡¨ç¤º</p>

<p>æœ‰æ—¶å€™ä¼šå°†ASTè¿›è¡Œæ–‡æœ¬åŒ–æŒä¹…ä¿å­˜ï¼Œè¿™ä¸ªåŠŸèƒ½PHP-Parserä¹Ÿæ”¯æŒã€‚</p>

<p>ï¼ˆ1ï¼‰ç®€å•çš„è¿›è¡Œåºåˆ—åŒ–</p>

<p>ä½¿ç”¨serialize()å’Œunserialize()è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œï¼Œå¯ä»¥å¯¹ASTè¿›è¡ŒæŒä¹…ä¿å­˜ã€‚Â </p>

<p>ï¼ˆ2ï¼‰æ˜“äºé˜…è¯»çš„ä¿å­˜å½¢å¼</p>

<p>åˆ†åˆ«æ˜¯å®Œç¾æ‰“å°å’ŒXMLæŒä¹…å­˜å‚¨ï¼Œåœ¨è¿™é‡Œä¸åšè¯¦ç»†ä»‹ç»ï¼Œæœ‰éœ€è¦çš„æ—¶å€™å¯ä»¥çœ‹é¡¹ç›®çš„æ–‡æ¡£ï¼š</p>

<p>https://github.com/nikic/PHP-Parser/blob/master/doc/3_Other_node_tree_representations.markdown</p>

<p>Â </p>

<p>Â </p>

<p>6ã€æ€»ç»“</p>

<p>è‡³å°‘åœ¨PHPé™æ€åˆ†ææ–¹é¢ï¼ŒPHP-Parseråœ¨åŠŸèƒ½æ–¹é¢å¤§å¤§ä¼˜äºANTLRã€‚å¦‚ä½•æ„å»ºä¸€ä¸ªPHPè‡ªåŠ¨åŒ–å®¡è®¡ç³»ç»Ÿï¼Œè¿™ä¸ªPHP-Parserè‚¯å®šä¼šå‘æŒ¥ä¸å°çš„ä½œç”¨ï¼šï¼‰~</p>

<p>https://github.com/topics/php</p>

<p>é‡‡é›†ç½‘é¡µç”¨åˆ°çš„domå·¥å…· ç»„ä»¶sunra/php-simple-html-dom-parser</p>

<p>PHP Parser written in Go</p>

<p>https://github.com/z7zmey/php-parser</p>

<p>https://github.com/phalcon/php-zephir-parser</p>
:ET