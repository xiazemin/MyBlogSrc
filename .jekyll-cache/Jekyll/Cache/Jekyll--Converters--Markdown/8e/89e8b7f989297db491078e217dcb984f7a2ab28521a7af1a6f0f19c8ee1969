I"œw<p>https://www.php.net/manual/zh/migration53.new-features.php
ç›¸å¯¹äºè€ç‰ˆæœ¬çš„ 5.x æ¥è¯´ï¼ŒPHP 7.4 éå¸¸æ–°ï¼Œå¹¶ä¸”å¢åŠ äº†å¾ˆå¤šä»¤äººæƒŠå–œçš„ æ–°ç‰¹æ€§ ã€‚ç”±äºåº•å±‚å¼•æ“å¤§éƒ¨åˆ†è¢«é‡å†™äº†ï¼Œç°åœ¨æ–°ç‰ˆæœ¬çš„ PHP æ¯”è€ç‰ˆæœ¬è¿è¡Œå¾—æ›´å¿«ã€‚</p>

<p>é€šå¸¸ä½ ä¼šåœ¨å°†æ¥çš„å·¥ä½œä¸­é‡åˆ°è¿˜åœ¨ä½¿ç”¨ PHP 5.x çš„æƒ…å†µï¼Œ5.x ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 5.6ã€‚
<!-- more -->
php7 æ–°ç‰¹æ€§https://www.php.net/manual/zh/migration70.new-features.php</p>

<p>æ ‡é‡ç±»å‹å£°æ˜</p>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„PHPæ–‡ä»¶éƒ½å¤„äºå¼±ç±»å‹æ ¡éªŒæ¨¡å¼ã€‚</p>

<p>PHP 7 å¢åŠ äº†æ ‡é‡ç±»å‹å£°æ˜çš„ç‰¹æ€§ï¼Œæ ‡é‡ç±»å‹å£°æ˜æœ‰ä¸¤ç§æ¨¡å¼:</p>

<p>å¼ºåˆ¶æ¨¡å¼ (é»˜è®¤)
ä¸¥æ ¼æ¨¡å¼
æ ‡é‡ç±»å‹å£°æ˜è¯­æ³•æ ¼å¼ï¼š</p>

<p>declare(strict_types=1); 
ä»£ç ä¸­é€šè¿‡æŒ‡å®š strict_typesçš„å€¼ï¼ˆ1æˆ–è€…0ï¼‰ï¼Œ1è¡¨ç¤ºä¸¥æ ¼ç±»å‹æ ¡éªŒæ¨¡å¼ï¼Œä½œç”¨äºå‡½æ•°è°ƒç”¨å’Œè¿”å›è¯­å¥ï¼›0è¡¨ç¤ºå¼±ç±»å‹æ ¡éªŒæ¨¡å¼ã€‚</p>

<p>å¯ä»¥ä½¿ç”¨çš„ç±»å‹å‚æ•°æœ‰ï¼š</p>

<p>int</p>

<p>float</p>

<p>bool</p>

<p>string</p>

<p>interfaces</p>

<p>array</p>

<p>callable</p>

<p>å¼ºåˆ¶æ¨¡å¼å®ä¾‹</p>

<p>æ ‡é‡ç±»å‹å£°æ˜ æœ‰ä¸¤ç§æ¨¡å¼: å¼ºåˆ¶ (é»˜è®¤) å’Œ ä¸¥æ ¼æ¨¡å¼ã€‚ ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸‹åˆ—ç±»å‹å‚æ•°ï¼ˆæ— è®ºç”¨å¼ºåˆ¶æ¨¡å¼è¿˜æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼‰ï¼š å­—ç¬¦ä¸²(string), æ•´æ•° (int), æµ®ç‚¹æ•° (float), ä»¥åŠå¸ƒå°”å€¼ (bool)ã€‚å®ƒä»¬æ‰©å……äº†PHP5ä¸­å¼•å…¥çš„å…¶ä»–ç±»å‹ï¼šç±»åï¼Œæ¥å£ï¼Œæ•°ç»„å’Œ å›è°ƒç±»å‹ã€‚</p>

<p>&lt;?php
// Coercive mode
function sumOfInts(int â€¦$ints)
{
    return array_sum($ints);
}</p>

<p>var_dump(sumOfInts(2, â€˜3â€™, 4.1));
ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</p>

<p>int(9)
è¦ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œä¸€ä¸ª declare å£°æ˜æŒ‡ä»¤å¿…é¡»æ”¾åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ã€‚è¿™æ„å‘³ç€ä¸¥æ ¼å£°æ˜æ ‡é‡æ˜¯åŸºäºæ–‡ä»¶å¯é…çš„ã€‚ è¿™ä¸ªæŒ‡ä»¤ä¸ä»…å½±å“å‚æ•°çš„ç±»å‹å£°æ˜ï¼Œä¹Ÿå½±å“åˆ°å‡½æ•°çš„è¿”å›å€¼å£°æ˜ï¼ˆå‚è§ è¿”å›å€¼ç±»å‹å£°æ˜, å†…ç½®çš„PHPå‡½æ•°ä»¥åŠæ‰©å±•ä¸­åŠ è½½çš„PHPå‡½æ•°ï¼‰</p>

<p>ä»¥ä¸Šç¨‹åºç”±äºé‡‡ç”¨äº†ä¸¥æ ¼æ¨¡å¼ï¼Œæ‰€ä»¥å¦‚æœå‚æ•°ä¸­å‡ºç°ä¸é€‚æ•´æ•°çš„ç±»å‹ä¼šæŠ¥é”™ï¼Œæ‰§è¡Œè¾“å‡ºç»“æœä¸ºï¼š</p>

<p>PHP Fatal error:  Uncaught TypeError: Argument 2 passed to sum() must be of the type integer, string given, called inâ€¦â€¦</p>

<p>è¿”å›å€¼ç±»å‹å£°æ˜
PHP 7 å¢åŠ äº†å¯¹è¿”å›ç±»å‹å£°æ˜çš„æ”¯æŒã€‚ ç±»ä¼¼äºå‚æ•°ç±»å‹å£°æ˜ï¼Œè¿”å›ç±»å‹å£°æ˜æŒ‡æ˜äº†å‡½æ•°è¿”å›å€¼çš„ç±»å‹ã€‚å¯ç”¨çš„ç±»å‹ä¸å‚æ•°å£°æ˜ä¸­å¯ç”¨çš„ç±»å‹ç›¸åŒã€‚</p>

<p>&lt;?php</p>

<p>function arraysSum(array â€¦$arrays): array
{
    return array_map(function(array $array): int {
        return array_sum($array);
    }, $arrays);
}</p>

<p>print_r(arraysSum([1,2,3], [4,5,6], [7,8,9]));
ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</p>

<p>Array
(
    [0] =&gt; 6
    [1] =&gt; 15
    [2] =&gt; 24
)</p>

<p>nullåˆå¹¶è¿ç®—ç¬¦
ç”±äºæ—¥å¸¸ä½¿ç”¨ä¸­å­˜åœ¨å¤§é‡åŒæ—¶ä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼å’Œ isset()çš„æƒ…å†µï¼Œ æˆ‘ä»¬æ·»åŠ äº†nullåˆå¹¶è¿ç®—ç¬¦ (??) è¿™ä¸ªè¯­æ³•ç³–ã€‚å¦‚æœå˜é‡å­˜åœ¨ä¸”å€¼ä¸ä¸ºNULLï¼Œ å®ƒå°±ä¼šè¿”å›è‡ªèº«çš„å€¼ï¼Œå¦åˆ™è¿”å›å®ƒçš„ç¬¬äºŒä¸ªæ“ä½œæ•°ã€‚</p>

<p>&lt;?php
// Fetches the value of $_GET[â€˜userâ€™] and returns â€˜nobodyâ€™
// if it does not exist.
$username = $_GET[â€˜userâ€™] ?? â€˜nobodyâ€™;
// This is equivalent to:
$username = isset($_GET[â€˜userâ€™]) ? $_GET[â€˜userâ€™] : â€˜nobodyâ€™;</p>

<p>// Coalesces can be chained: this will return the first
// defined value out of $_GET[â€˜userâ€™], $_POST[â€˜userâ€™], and
// â€˜nobodyâ€™.
$username = $_GET[â€˜userâ€™] ?? $_POST[â€˜userâ€™] ?? â€˜nobodyâ€™;
?&gt;
å¤ªç©ºèˆ¹æ“ä½œç¬¦ï¼ˆç»„åˆæ¯”è¾ƒç¬¦ï¼‰
å¤ªç©ºèˆ¹æ“ä½œç¬¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªè¡¨è¾¾å¼ã€‚å½“$aå°äºã€ç­‰äºæˆ–å¤§äº$bæ—¶å®ƒåˆ†åˆ«è¿”å›-1ã€0æˆ–1ã€‚ æ¯”è¾ƒçš„åŸåˆ™æ˜¯æ²¿ç”¨ PHP çš„å¸¸è§„æ¯”è¾ƒè§„åˆ™è¿›è¡Œçš„ã€‚</p>

<p>&lt;?php
// æ•´æ•°
echo 1 &lt;=&gt; 1; // 0
echo 1 &lt;=&gt; 2; // -1
echo 2 &lt;=&gt; 1; // 1</p>

<p>// æµ®ç‚¹æ•°
echo 1.5 &lt;=&gt; 1.5; // 0
echo 1.5 &lt;=&gt; 2.5; // -1
echo 2.5 &lt;=&gt; 1.5; // 1</p>

<p>é€šè¿‡ define() å®šä¹‰å¸¸é‡æ•°ç»„
Array ç±»å‹çš„å¸¸é‡ç°åœ¨å¯ä»¥é€šè¿‡ define() æ¥å®šä¹‰ã€‚åœ¨ PHP5.6 ä¸­ä»…èƒ½é€šè¿‡ const å®šä¹‰ã€‚</p>

<p>&lt;?php
define(â€˜ANIMALSâ€™, [
    â€˜dogâ€™,
    â€˜catâ€™,
    â€˜birdâ€™
]);</p>

<p>echo ANIMALS[1]; // è¾“å‡º â€œcatâ€
?&gt;
åŒ¿åç±»
ç°åœ¨æ”¯æŒé€šè¿‡new class æ¥å®ä¾‹åŒ–ä¸€ä¸ªåŒ¿åç±»ï¼Œè¿™å¯ä»¥ç”¨æ¥æ›¿ä»£ä¸€äº›â€œç”¨åå³ç„šâ€çš„å®Œæ•´ç±»å®šä¹‰ã€‚</p>

<p>&lt;?php
interface Logger {
    public function log(string $msg);
}</p>

<p>class Application {
    private $logger;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public function getLogger(): Logger {
     return $this-&gt;logger;
}

public function setLogger(Logger $logger) {
     $this-&gt;logger = $logger;
} }
</code></pre></div></div>

<p>$app = new Application;
$app-&gt;setLogger(new class implements Logger {
    public function log(string $msg) {
        echo $msg;
    }
});</p>

<p>var_dump($app-&gt;getLogger());
?&gt;
ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</p>

<p>object(class@anonymous)#2 (0) {
}</p>

<p>PHP 7 æ”¯æŒé€šè¿‡ new class æ¥å®ä¾‹åŒ–ä¸€ä¸ªåŒ¿åç±»ï¼Œè¿™å¯ä»¥ç”¨æ¥æ›¿ä»£ä¸€äº›â€ç”¨åå³ç„šâ€çš„å®Œæ•´ç±»å®šä¹‰ã€‚</p>

<p>Unicode codepoint è½¬è¯‘è¯­æ³•
è¿™æ¥å—ä¸€ä¸ªä»¥16è¿›åˆ¶å½¢å¼çš„ Unicode codepointï¼Œå¹¶æ‰“å°å‡ºä¸€ä¸ªåŒå¼•å·æˆ–heredocåŒ…å›´çš„ UTF-8 ç¼–ç æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ å¯ä»¥æ¥å—ä»»ä½•æœ‰æ•ˆçš„ codepointï¼Œå¹¶ä¸”å¼€å¤´çš„ 0 æ˜¯å¯ä»¥çœç•¥çš„ã€‚</p>

<p>echo â€œ\u{aa}â€;
echo â€œ\u{0000aa}â€;
echo â€œ\u{9999}â€;
ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</p>

<p>Âª
Âª (same as before but with optional leading 0â€™s)
é¦™
Closure::call()
Closure::call() ç°åœ¨æœ‰ç€æ›´å¥½çš„æ€§èƒ½ï¼Œç®€çŸ­å¹²ç»ƒçš„æš‚æ—¶ç»‘å®šä¸€ä¸ªæ–¹æ³•åˆ°å¯¹è±¡ä¸Šé—­åŒ…å¹¶è°ƒç”¨å®ƒã€‚</p>

<p>&lt;?php
class A {private $x = 1;}</p>

<p>// PHP 7 ä¹‹å‰ç‰ˆæœ¬çš„ä»£ç 
$getXCB = function() {return $this-&gt;x;};
$getX = $getXCB-&gt;bindTo(new A, â€˜Aâ€™); // ä¸­é—´å±‚é—­åŒ…
echo $getX();</p>

<p>// PHP 7+ åŠæ›´é«˜ç‰ˆæœ¬çš„ä»£ç 
$getX = function() {return $this-&gt;x;};
echo $getX-&gt;call(new A);</p>

<p>ä¸ºunserialize()æä¾›è¿‡æ»¤
è¿™ä¸ªç‰¹æ€§æ—¨åœ¨æä¾›æ›´å®‰å…¨çš„æ–¹å¼è§£åŒ…ä¸å¯é çš„æ•°æ®ã€‚å®ƒé€šè¿‡ç™½åå•çš„æ–¹å¼æ¥é˜²æ­¢æ½œåœ¨çš„ä»£ç æ³¨å…¥ã€‚</p>

<p>&lt;?php</p>

<p>// å°†æ‰€æœ‰çš„å¯¹è±¡éƒ½è½¬æ¢ä¸º __PHP_Incomplete_Class å¯¹è±¡
$data = unserialize($foo, [â€œallowed_classesâ€ =&gt; false]);</p>

<p>// å°†é™¤ MyClass å’Œ MyClass2 ä¹‹å¤–çš„æ‰€æœ‰å¯¹è±¡éƒ½è½¬æ¢ä¸º __PHP_Incomplete_Class å¯¹è±¡
$data = unserialize($foo, [â€œallowed_classesâ€ =&gt; [â€œMyClassâ€, â€œMyClass2â€]);</p>

<p>// é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„ç±»éƒ½æ˜¯å¯æ¥å—çš„ï¼Œç­‰åŒäºçœç•¥ç¬¬äºŒä¸ªå‚æ•°
$data = unserialize($foo, [â€œallowed_classesâ€ =&gt; true]);
IntlChar
æ–°å¢åŠ çš„ IntlChar ç±»æ—¨åœ¨æš´éœ²å‡ºæ›´å¤šçš„ ICU åŠŸèƒ½ã€‚è¿™ä¸ªç±»è‡ªèº«å®šä¹‰äº†è®¸å¤šé™æ€æ–¹æ³•ç”¨äºæ“ä½œå¤šå­—ç¬¦é›†çš„ unicode å­—ç¬¦ã€‚</p>

<p>&lt;?php</p>

<p>printf(â€˜%xâ€™, IntlChar::CODEPOINT_MAX);
echo IntlChar::charName(â€˜@â€™);
var_dump(IntlChar::ispunct(â€˜!â€™));
ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</p>

<p>10ffff
COMMERCIAL AT
bool(true)
è‹¥è¦ä½¿ç”¨æ­¤ç±»ï¼Œè¯·å…ˆå®‰è£…Intlæ‰©å±•</p>

<p>é¢„æœŸ
é¢„æœŸæ˜¯å‘åå…¼ç”¨å¹¶å¢å¼ºä¹‹å‰çš„ assert() çš„æ–¹æ³•ã€‚ å®ƒä½¿å¾—åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨æ–­è¨€ä¸ºé›¶æˆæœ¬ï¼Œå¹¶ä¸”æä¾›å½“æ–­è¨€å¤±è´¥æ—¶æŠ›å‡ºç‰¹å®šå¼‚å¸¸çš„èƒ½åŠ›ã€‚</p>

<p>è€ç‰ˆæœ¬çš„APIå‡ºäºå…¼å®¹ç›®çš„å°†ç»§ç»­è¢«ç»´æŠ¤ï¼Œassert()ç°åœ¨æ˜¯ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼Œå®ƒå…è®¸ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªå¾…è®¡ç®—çš„ stringæˆ–ä¸€ä¸ªå¾…æµ‹è¯•çš„booleanã€‚</p>

<p>&lt;?php
ini_set(â€˜assert.exceptionâ€™, 1);</p>

<p>class CustomError extends AssertionError {}</p>

<p>assert(false, new CustomError(â€˜Some error messageâ€™));
?&gt;
ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</p>

<p>Fatal error: Uncaught CustomError: Some error message
å…³äºè¿™ä¸ªç‰¹æ€§çš„å®Œæ•´è¯´æ˜ï¼ŒåŒ…æ‹¬å¦‚ä½•åœ¨å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸­é…ç½®å®ƒï¼Œå¯ä»¥åœ¨assert()çš„ expectations sectionç« èŠ‚æ‰¾åˆ°ã€‚</p>

<p>Group use declarations
ä»åŒä¸€ namespace å¯¼å…¥çš„ç±»ã€å‡½æ•°å’Œå¸¸é‡ç°åœ¨å¯ä»¥é€šè¿‡å•ä¸ª use è¯­å¥ ä¸€æ¬¡æ€§å¯¼å…¥äº†ã€‚</p>

<p>&lt;?php</p>

<p>// PHP 7 ä¹‹å‰çš„ä»£ç 
use some\namespace\ClassA;
use some\namespace\ClassB;
use some\namespace\ClassC as C;</p>

<p>use function some\namespace\fn_a;
use function some\namespace\fn_b;
use function some\namespace\fn_c;</p>

<p>use const some\namespace\ConstA;
use const some\namespace\ConstB;
use const some\namespace\ConstC;</p>

<p>// PHP 7+ åŠæ›´é«˜ç‰ˆæœ¬çš„ä»£ç 
use some\namespace{ClassA, ClassB, ClassC as C};
use function some\namespace{fn_a, fn_b, fn_c};
use const some\namespace{ConstA, ConstB, ConstC};
?&gt;
ç”Ÿæˆå™¨å¯ä»¥è¿”å›è¡¨è¾¾å¼
æ­¤ç‰¹æ€§åŸºäº PHP 5.5 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ç”Ÿæˆå™¨ç‰¹æ€§æ„å»ºçš„ã€‚ å®ƒå…è®¸åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­é€šè¿‡ä½¿ç”¨ return è¯­æ³•æ¥è¿”å›ä¸€ä¸ªè¡¨è¾¾å¼ ï¼ˆä½†æ˜¯ä¸å…è®¸è¿”å›å¼•ç”¨å€¼ï¼‰ï¼Œ å¯ä»¥é€šè¿‡è°ƒç”¨ Generator::getReturn() æ–¹æ³•æ¥è·å–ç”Ÿæˆå™¨çš„è¿”å›å€¼ï¼Œ ä½†æ˜¯è¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨ç”Ÿæˆå™¨å®Œæˆäº§ç”Ÿå·¥ä½œä»¥åè°ƒç”¨ä¸€æ¬¡ã€‚</p>

<p>&lt;?php</p>

<p>$gen = (function() {
    yield 1;
    yield 2;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>return 3; })();
</code></pre></div></div>

<p>foreach ($gen as $val) {
    echo $val, PHP_EOL;
}</p>

<p>echo $gen-&gt;getReturn(), PHP_EOL;
ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</p>

<p>1
2
3
åœ¨ç”Ÿæˆå™¨ä¸­èƒ½å¤Ÿè¿”å›æœ€ç»ˆçš„å€¼æ˜¯ä¸€ä¸ªéå¸¸ä¾¿åˆ©çš„ç‰¹æ€§ï¼Œ å› ä¸ºå®ƒä½¿å¾—è°ƒç”¨ç”Ÿæˆå™¨çš„å®¢æˆ·ç«¯ä»£ç å¯ä»¥ç›´æ¥å¾—åˆ°ç”Ÿæˆå™¨ï¼ˆæˆ–è€…å…¶ä»–ååŒè®¡ç®—ï¼‰çš„è¿”å›å€¼ï¼Œ ç›¸å¯¹äºä¹‹å‰ç‰ˆæœ¬ä¸­å®¢æˆ·ç«¯ä»£ç å¿…é¡»å…ˆæ£€æŸ¥ç”Ÿæˆå™¨æ˜¯å¦äº§ç”Ÿäº†æœ€ç»ˆçš„å€¼ç„¶åå†è¿›è¡Œå“åº”å¤„ç† æ¥å¾—æ–¹ä¾¿å¤šäº†ã€‚</p>

<p>Generator delegation
ç°åœ¨ï¼Œåªéœ€åœ¨æœ€å¤–å±‚ç”Ÿæˆå…¶ä¸­ä½¿ç”¨ yield fromï¼Œ å°±å¯ä»¥æŠŠä¸€ä¸ªç”Ÿæˆå™¨è‡ªåŠ¨å§”æ´¾ç»™å…¶ä»–çš„ç”Ÿæˆå™¨ï¼Œ Traversable å¯¹è±¡æˆ–è€… arrayã€‚</p>

<p>&lt;?php</p>

<p>function gen()
{
    yield 1;
    yield 2;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yield from gen2(); }
</code></pre></div></div>

<p>function gen2()
{
    yield 3;
    yield 4;
}</p>

<p>foreach (gen() as $val)
{
    echo $val, PHP_EOL;
}</p>

<p>?&gt;
ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</p>

<p>1
2
3
4
æ•´æ•°é™¤æ³•å‡½æ•° intdiv()
æ–°åŠ çš„å‡½æ•° intdiv() ç”¨æ¥è¿›è¡Œ æ•´æ•°çš„é™¤æ³•è¿ç®—ã€‚</p>

<p>&lt;?php</p>

<p>var_dump(intdiv(10, 3));
?&gt;
ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</p>

<p>int(3)
ä¼šè¯é€‰é¡¹
session_start() å¯ä»¥æ¥å—ä¸€ä¸ª array ä½œä¸ºå‚æ•°ï¼Œ ç”¨æ¥è¦†ç›– php.ini æ–‡ä»¶ä¸­è®¾ç½®çš„ ä¼šè¯é…ç½®é€‰é¡¹ã€‚</p>

<p>åœ¨è°ƒç”¨ session_start() çš„æ—¶å€™ï¼Œ ä¼ å…¥çš„é€‰é¡¹å‚æ•°ä¸­ä¹Ÿæ”¯æŒ session.lazy_write è¡Œä¸ºï¼Œ é»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªé…ç½®é¡¹æ˜¯æ‰“å¼€çš„ã€‚å®ƒçš„ä½œç”¨æ˜¯æ§åˆ¶ PHP åªæœ‰åœ¨ä¼šè¯ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰ å†™å…¥ä¼šè¯å­˜å‚¨æ–‡ä»¶ï¼Œå¦‚æœä¼šè¯ä¸­çš„æ•°æ®æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆ PHP ä¼šåœ¨è¯»å–å®Œä¼šè¯æ•°æ®ä¹‹åï¼Œ ç«‹å³å…³é—­ä¼šè¯å­˜å‚¨æ–‡ä»¶ï¼Œä¸åšä»»ä½•ä¿®æ”¹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® read_and_close æ¥å®ç°ã€‚</p>

<p>ä¾‹å¦‚ï¼Œä¸‹åˆ—ä»£ç è®¾ç½® session.cache_limiter ä¸º privateï¼Œå¹¶ä¸”åœ¨è¯»å–å®Œæ¯•ä¼šè¯æ•°æ®ä¹‹åé©¬ä¸Šå…³é—­ä¼šè¯å­˜å‚¨æ–‡ä»¶ã€‚</p>

<p>&lt;?php
session_start([
    â€˜cache_limiterâ€™ =&gt; â€˜privateâ€™,
    â€˜read_and_closeâ€™ =&gt; true,
]);
?&gt;
preg_replace_callback_array()
åœ¨ PHP 7 ä¹‹å‰ï¼Œå½“ä½¿ç”¨ preg_replace_callback() å‡½æ•°çš„æ—¶å€™ï¼Œ ç”±äºé’ˆå¯¹æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼éƒ½è¦æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå¯èƒ½å¯¼è‡´è¿‡å¤šçš„åˆ†æ”¯ä»£ç ã€‚ è€Œä½¿ç”¨æ–°åŠ çš„ preg_replace_callback_array() å‡½æ•°ï¼Œ å¯ä»¥ä½¿å¾—ä»£ç æ›´åŠ ç®€æ´ã€‚</p>

<p>ç°åœ¨ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå…³è”æ•°ç»„æ¥å¯¹æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œ æ­£åˆ™è¡¨è¾¾å¼æœ¬èº«ä½œä¸ºå…³è”æ•°ç»„çš„é”®ï¼Œ è€Œå¯¹åº”çš„å›è°ƒå‡½æ•°å°±æ˜¯å…³è”æ•°ç»„çš„å€¼ã€‚</p>

<p>CSPRNG Functions
æ–°åŠ å…¥ä¸¤ä¸ªè·¨å¹³å°çš„å‡½æ•°ï¼š random_bytes() å’Œ random_int() ç”¨æ¥äº§ç”Ÿé«˜å®‰å…¨çº§åˆ«çš„éšæœºå­—ç¬¦ä¸²å’Œéšæœºæ•´æ•°ã€‚</p>

<p>å¯ä»¥ä½¿ç”¨ list() å‡½æ•°æ¥å±•å¼€å®ç°äº† ArrayAccess æ¥å£çš„å¯¹è±¡
åœ¨ä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œlist() å‡½æ•°ä¸èƒ½ä¿è¯ æ­£ç¡®çš„å±•å¼€å®ç°äº† ArrayAccess æ¥å£çš„å¯¹è±¡ï¼Œ ç°åœ¨è¿™ä¸ªé—®é¢˜å·²ç»è¢«ä¿®å¤ã€‚</p>

<p>å…¶ä»–ç‰¹æ€§
å…è®¸åœ¨å…‹éš†è¡¨è¾¾å¼ä¸Šè®¿é—®å¯¹è±¡æˆå‘˜ï¼Œä¾‹å¦‚ï¼š (clone $foo)-&gt;bar()ã€‚
add a note add a note
User Contributed Notes 2 notes
up
down
130PawelD Â¶3 years ago
&lt;?php
class foo { static $bar = â€˜bazâ€™; }
var_dump(â€˜fooâ€™::$bar);
?&gt;</p>

<p>if &lt; php7.0</p>

<p>then we will receive a syntax error, unexpected â€˜::â€™ (T_PAAMAYIM_NEKUDOTAYIM)</p>

<p>but php7 returns string(3) â€œbazâ€</p>

<p>I think itâ€™s not documented anywhere
up
down
7TerryE Â¶2 years ago
$a = â€˜â€™; // or 0 or false</p>

<p>$b = $a ?? â€˜aâ€™; 
// $b is â€˜â€™ or 0 or false</p>

<p>$c = $a ?: â€˜aâ€™;
// $c is â€˜aâ€™</p>

<p>PHP 7 session_start() å‡½æ•°å¯ä»¥æ¥æ”¶ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå¯ä»¥è¦†ç›– php.ini ä¸­ session çš„é…ç½®é¡¹ã€‚</p>

<p>è¿™ä¸ªç‰¹æ€§ä¹Ÿå¼•å…¥äº†ä¸€ä¸ªæ–°çš„ php.ini è®¾ç½®ï¼ˆsession.lazy_writeï¼‰, é»˜è®¤æƒ…å†µä¸‹è®¾ç½®ä¸º trueï¼Œæ„å‘³ç€ session æ•°æ®åªåœ¨å‘ç”Ÿå˜åŒ–æ—¶æ‰å†™å…¥ã€‚</p>

<p>é™¤äº†å¸¸è§„çš„ä¼šè¯é…ç½®æŒ‡ç¤ºé¡¹ï¼Œ è¿˜å¯ä»¥åœ¨æ­¤æ•°ç»„ä¸­åŒ…å« read_and_close é€‰é¡¹ã€‚å¦‚æœå°†æ­¤é€‰é¡¹çš„å€¼è®¾ç½®ä¸º TRUEï¼Œ é‚£ä¹ˆä¼šè¯æ–‡ä»¶ä¼šåœ¨è¯»å–å®Œæ¯•ä¹‹åé©¬ä¸Šå…³é—­ï¼Œ å› æ­¤ï¼Œå¯ä»¥åœ¨ä¼šè¯æ•°æ®æ²¡æœ‰å˜åŠ¨çš„æ—¶å€™ï¼Œé¿å…ä¸å¿…è¦çš„æ–‡ä»¶é”ã€‚</p>

<p>å®ä¾‹
æŠŠ cache_limiter è®¾ç½®ä¸ºç§æœ‰çš„ï¼ŒåŒæ—¶åœ¨é˜…è¯»å®Œ session åç«‹å³å…³é—­ã€‚</p>

<p>å®ä¾‹
&lt;?php
session_start([
   â€˜cache_limiterâ€™ =&gt; â€˜privateâ€™,
   â€˜read_and_closeâ€™ =&gt; true,
]);
?&gt;</p>

<p>PHP4 é£æ ¼çš„æ„é€ å‡½æ•°
åœ¨ PHP4 ä¸­ç±»ä¸­çš„å‡½æ•°å¯ä»¥ä¸ç±»ååŒåï¼Œè¿™ä¸€ç‰¹æ€§åœ¨ PHP7 ä¸­è¢«åºŸå¼ƒï¼ŒåŒæ—¶ä¼šå‘å‡ºä¸€ä¸ª E_DEPRECATED é”™è¯¯ã€‚å½“æ–¹æ³•åä¸ç±»åç›¸åŒï¼Œä¸”ç±»ä¸åœ¨å‘½åç©ºé—´ä¸­ï¼ŒåŒæ—¶PHP5çš„æ„é€ å‡½æ•°ï¼ˆ__constructï¼‰ä¸å­˜åœ¨æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ª E_DEPRECATED é”™è¯¯ã€‚</p>

<p>å®ä¾‹
å®ä¾‹
&lt;?php
class A {
   function A() {
      print(â€˜Style Constructorâ€™);
   }
}
?&gt;
ä»¥ä¸Šç¨‹åºæ‰§è¡Œè¾“å‡ºç»“æœä¸ºï¼š</p>

<p>Deprecated: Methods with the same name as their class will not be constructors in a future version of PHP; A has a deprecated constructor inâ€¦
ä»¥é™æ€çš„æ–¹å¼è°ƒç”¨éé™æ€æ–¹æ³•
ä»¥é™æ€çš„æ–¹å¼è°ƒç”¨éé™æ€æ–¹æ³•ï¼Œä¸å†æ”¯æŒï¼š</p>

<p>å®ä¾‹
å®ä¾‹
&lt;?php
class A {
   function b() {
      print(â€˜Non-static callâ€™);
   }
}
A::b();
?&gt;
ä»¥ä¸Šç¨‹åºæ‰§è¡Œè¾“å‡ºç»“æœä¸ºï¼š</p>

<p>Deprecated: Non-static method A::b() should not be called statically inâ€¦
Non-static call
password_hash() éšæœºå› å­é€‰é¡¹
å‡½æ•°åŸ salt é‡ä¸å†éœ€è¦ç”±å¼€å‘è€…æä¾›äº†ã€‚å‡½æ•°å†…éƒ¨é»˜è®¤å¸¦æœ‰ salt èƒ½åŠ›ï¼Œæ— éœ€å¼€å‘è€…æä¾› salt å€¼ã€‚</p>

<p>capture_session_meta SSL ä¸Šä¸‹æ–‡é€‰é¡¹
åºŸå¼ƒäº† â€œcapture_session_metaâ€ SSL ä¸Šä¸‹æ–‡é€‰é¡¹ã€‚ åœ¨æµèµ„æºä¸Šæ´»åŠ¨çš„åŠ å¯†ç›¸å…³çš„å…ƒæ•°æ®å¯ä»¥é€šè¿‡ stream_get_meta_data() çš„è¿”å›å€¼è®¿é—®ã€‚</p>

<p>PHP 7+ ç‰ˆæœ¬ç§»é™¤äº†ä»¥ä¸‹æ‰©å±•ï¼š</p>

<p>ereg</p>

<p>mssql</p>

<p>mysql</p>

<p>sybase_ct</p>

<p>PHP 7+ ç‰ˆæœ¬ç§»é™¤äº†ä»¥ä¸‹ SAPIï¼š</p>

<p>aolserver</p>

<p>apache</p>

<p>apache_hooks</p>

<p>apache2filter</p>

<p>caudium</p>

<p>continuity</p>

<p>isapi</p>

<p>milter</p>

<p>nsapi</p>

<p>phttpd</p>

<p>pi3web</p>

<p>roxen</p>

<p>thttpd</p>

<p>tux</p>

<p>webjames</p>

<p>PHP7.0
PHP7.0æ–°ç‰¹æ€§</p>
<ol>
  <li>ç»„åˆæ¯”è¾ƒç¬¦ (&lt;=&gt;)
ç»„åˆæ¯”è¾ƒç¬¦å·ç”¨äºæ¯”è¾ƒä¸¤ä¸ªè¡¨è¾¾å¼ã€‚å½“$aå°äºã€ç­‰äºæˆ–å¤§äº$bæ—¶å®ƒåˆ†åˆ«è¿”å›-1ã€0æˆ–1ï¼Œæ¯”è¾ƒè§„åˆ™å»¶ç»­å¸¸è§„æ¯”è¾ƒè§„åˆ™ã€‚å¯¹è±¡ä¸èƒ½è¿›è¡Œæ¯”è¾ƒ</li>
</ol>

<p>var_dump(â€˜PHPâ€™ &lt;=&gt; â€˜Nodeâ€™); // int(1)
var_dump(123 &lt;=&gt; 456); // int(-1)
var_dump([â€˜aâ€™, â€˜bâ€™] &lt;=&gt; [â€˜aâ€™, â€˜bâ€™]); // int(0)</p>
<ol>
  <li>nullåˆå¹¶è¿ç®—ç¬¦
ç”±äºæ—¥å¸¸ä½¿ç”¨ä¸­å­˜åœ¨å¤§é‡åŒæ—¶ä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼å’Œissetæ“ä½œã€‚ä½¿ç”¨nullåˆå¹¶è¿ç®—ç¬¦å¯ä»¥ç®€åŒ–æ“ä½œ</li>
</ol>

<h1 id="php7ä»¥å‰">php7ä»¥å‰</h1>
<p>if(isset($_GET[â€˜aâ€™])) {
  $a = $_GET[â€˜aâ€™];
}</p>
<h1 id="php7ä»¥å‰-1">php7ä»¥å‰</h1>
<p>$a = isset($_GET[â€˜aâ€™]) ? $_GET[â€˜aâ€™] : â€˜noneâ€™;</p>

<p>#PHP 7
$a = isset($_GET[â€˜aâ€™]) ?? â€˜noneâ€™;</p>
<ol>
  <li>å˜é‡ç±»å‹å£°æ˜
å˜é‡ç±»å‹å£°æ˜æœ‰ä¸¤ç§æ¨¡å¼ã€‚ä¸€ç§æ˜¯å¼ºåˆ¶çš„ï¼Œå’Œä¸¥æ ¼çš„ã€‚å…è®¸ä½¿ç”¨ä¸‹åˆ—ç±»å‹å‚æ•°intã€stringã€floatã€bool</li>
</ol>

<p>åŒæ—¶ä¸èƒ½å†ä½¿ç”¨intã€stringã€floatã€boolä½œä¸ºç±»çš„åå­—äº†</p>

<p>function sumOfInts(int â€¦$ints)
{
    return array_sum($ints);
}
ar_dump(sumOfInts(2, â€˜3â€™, 4.1)); // int(9)</p>
<h1 id="ä¸¥æ ¼æ¨¡å¼">ä¸¥æ ¼æ¨¡å¼</h1>
<p>declare(strict_types=1);</p>

<p>function add(int $x, int $y)
{
    return $x + $y;
}
var_dump(add(â€˜2â€™, 3)); // Fatal error: Argument 1 passed to add() must be of the type integer</p>
<ol>
  <li>è¿”å›å€¼ç±»å‹å£°æ˜
å¢åŠ äº†è¿”å›ç±»å‹å£°æ˜ï¼Œç±»ä¼¼å‚æ•°ç±»å‹ã€‚è¿™æ ·æ›´æ–¹ä¾¿çš„æ§åˆ¶å‡½æ•°çš„è¿”å›å€¼.åœ¨å‡½æ•°å®šä¹‰çš„åé¢åŠ ä¸Š:ç±»å‹åå³å¯</li>
</ol>

<p>function fun(int $a): array
{
  return $a;
}
fun(3);//Fatal error</p>
<ol>
  <li>åŒ¿åç±»
php7å…è®¸new class {} åˆ›å»ºä¸€ä¸ªåŒ¿åçš„å¯¹è±¡ã€‚</li>
</ol>

<p>//php7ä»¥å‰
class Logger
{
    public function log($msg)
    {
        echo $msg;
    }
}</p>

<p>$util-&gt;setLogger(new Logger());</p>

<p>// php7+
$util-&gt;setLogger(new class {
    public function log($msg)
    {
        echo $msg;
    }
});</p>
<ol>
  <li>Unicode codepoint è½¬è¯‘è¯­æ³•
è¿™æ¥å—ä¸€ä¸ªä»¥16è¿›åˆ¶å½¢å¼çš„ Unicode codepointï¼Œå¹¶æ‰“å°å‡ºä¸€ä¸ªåŒå¼•å·æˆ–heredocåŒ…å›´çš„ UTF-8 ç¼–ç æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ å¯ä»¥æ¥å—ä»»ä½•æœ‰æ•ˆçš„ codepointï¼Œå¹¶ä¸”å¼€å¤´çš„ 0 æ˜¯å¯ä»¥çœç•¥çš„</li>
</ol>

<p>echo â€œ\u{aa}â€;// Âª
echo â€œ\u{0000aa}â€;// Âª
echo â€œ\u{9999}â€;// é¦™</p>
<ol>
  <li>Closure::call
é—­åŒ…ç»‘å®š ç®€çŸ­å¹²ç»ƒçš„æš‚æ—¶ç»‘å®šä¸€ä¸ªæ–¹æ³•åˆ°å¯¹è±¡ä¸Šé—­åŒ…å¹¶è°ƒç”¨å®ƒã€‚</li>
</ol>

<p>class A {private $x = 1;}</p>

<p>// PHP 7 ä¹‹å‰ç‰ˆæœ¬çš„ä»£ç 
$getXCB = function() {return $this-&gt;x;};
$getX = $getXCB-&gt;bindTo(new A, â€˜Aâ€™); // ä¸­é—´å±‚é—­åŒ…
echo $getX();</p>

<p>// PHP 7+ åŠæ›´é«˜ç‰ˆæœ¬çš„ä»£ç 
$getX = function() {return $this-&gt;x;};
echo $getX-&gt;call(new A);</p>
<ol>
  <li>å¸¦è¿‡æ»¤çš„unserialize
æä¾›æ›´å®‰å…¨çš„æ–¹å¼è§£åŒ…ä¸å¯é çš„æ•°æ®ã€‚å®ƒé€šè¿‡ç™½åå•çš„æ–¹å¼æ¥é˜²æ­¢æ½œåœ¨çš„ä»£ç æ³¨å…¥</li>
</ol>

<p>// å°†æ‰€æœ‰çš„å¯¹è±¡éƒ½è½¬æ¢ä¸º __PHP_Incomplete_Class å¯¹è±¡
$data = unserialize($foo, [â€œallowed_classesâ€ =&gt; false]);</p>

<p>// å°†é™¤ MyClass å’Œ MyClass2 ä¹‹å¤–çš„æ‰€æœ‰å¯¹è±¡éƒ½è½¬æ¢ä¸º __PHP_Incomplete_Class å¯¹è±¡
$data = unserialize($foo, [â€œallowed_classesâ€ =&gt; [â€œMyClassâ€, â€œMyClass2â€]);</p>

<p>// é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„ç±»éƒ½æ˜¯å¯æ¥å—çš„ï¼Œç­‰åŒäºçœç•¥ç¬¬äºŒä¸ªå‚æ•°
$data = unserialize($foo, [â€œallowed_classesâ€ =&gt; true]);</p>
<ol>
  <li>IntlCharç±»
è¿™ä¸ªç±»è‡ªèº«å®šä¹‰äº†è®¸å¤šé™æ€æ–¹æ³•ç”¨äºæ“ä½œå¤šå­—ç¬¦é›†çš„ unicode å­—ç¬¦ã€‚éœ€è¦å®‰è£…intlæ‹“å±•</li>
</ol>

<p>printf(â€˜%xâ€™, IntlChar::CODEPOINT_MAX);
echo IntlChar::charName(â€˜@â€™);
var_dump(IntlChar::ispunct(â€˜!â€™));</p>
<ol>
  <li>é¢„æœŸ
å®ƒä½¿å¾—åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨æ–­è¨€ä¸ºé›¶æˆæœ¬ï¼Œå¹¶ä¸”æä¾›å½“æ–­è¨€å¤±è´¥æ—¶æŠ›å‡ºç‰¹å®šå¼‚å¸¸çš„èƒ½åŠ›ã€‚ä»¥åå¯ä»¥ä½¿ç”¨è¿™ä¸ªè¿™ä¸ªè¿›è¡Œæ–­è¨€æµ‹è¯•</li>
</ol>

<p>ini_set(â€˜assert.exceptionâ€™, 1);</p>

<p>class CustomError extends AssertionError {}</p>

<p>assert(false, new CustomError(â€˜Some error messageâ€™));</p>
<ol>
  <li>å‘½åç©ºé—´æŒ‰ç»„å¯¼å…¥
ä»åŒä¸€ä¸ªå‘½åç©ºé—´ä¸‹å¯¼å…¥çš„ç±»ã€å‡½æ•°ã€å¸¸é‡æ”¯æŒæŒ‰ç»„ä¸€æ¬¡å¯¼å…¥</li>
</ol>

<p>#php7ä»¥å‰
use app\model\A;
use app\model\B;
#php7+
use app\model{A,B}
13.ç”Ÿæˆå™¨æ”¯æŒè¿”å›è¡¨è¾¾å¼
å®ƒå…è®¸åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­é€šè¿‡ä½¿ç”¨ return è¯­æ³•æ¥è¿”å›ä¸€ä¸ªè¡¨è¾¾å¼ ï¼ˆä½†æ˜¯ä¸å…è®¸è¿”å›å¼•ç”¨å€¼ï¼‰ï¼Œ å¯ä»¥é€šè¿‡è°ƒç”¨ Generator::getReturn() æ–¹æ³•æ¥è·å–ç”Ÿæˆå™¨çš„è¿”å›å€¼ï¼Œ ä½†æ˜¯è¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨ç”Ÿæˆå™¨å®Œæˆäº§ç”Ÿå·¥ä½œä»¥åè°ƒç”¨ä¸€æ¬¡ã€‚</p>

<p>$gen = (function() {
    yield 1;
    yield 2;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>return 3; })();
</code></pre></div></div>

<p>foreach ($gen as $val) {
    echo $val, PHP_EOL;
}</p>

<p>echo $gen-&gt;getReturn(), PHP_EOL;</p>
<h1 id="output">output</h1>
<p>//1
//2
//3
14.ç”Ÿæˆå™¨å§”æ´¾
ç°åœ¨ï¼Œåªéœ€åœ¨æœ€å¤–å±‚ç”Ÿæˆå…¶ä¸­ä½¿ç”¨yield fromï¼Œå°±å¯ä»¥æŠŠä¸€ä¸ªç”Ÿæˆå™¨è‡ªåŠ¨å§”æ´¾ç»™å…¶ä»–çš„ç”Ÿæˆå™¨</p>

<p>function gen()
{
    yield 1;
    yield 2;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yield from gen2(); }
</code></pre></div></div>

<p>function gen2()
{
    yield 3;
    yield 4;
}</p>

<p>foreach (gen() as $val)
{
    echo $val, PHP_EOL;
}
15.æ•´æ•°é™¤æ³•å‡½æ•°intdiv
var_dump(intdiv(10,3)) //3
16.ä¼šè¯é€‰é¡¹è®¾ç½®
session_start() å¯ä»¥åŠ å…¥ä¸€ä¸ªæ•°ç»„è¦†ç›–php.iniçš„é…ç½®</p>

<p>session_start([
    â€˜cache_limiterâ€™ =&gt; â€˜privateâ€™,
    â€˜read_and_closeâ€™ =&gt; true,
]);</p>
<ol>
  <li>preg_replace_callback_array
å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå…³è”æ•°ç»„æ¥å¯¹æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œ æ­£åˆ™è¡¨è¾¾å¼æœ¬èº«ä½œä¸ºå…³è”æ•°ç»„çš„é”®ï¼Œ è€Œå¯¹åº”çš„å›è°ƒå‡½æ•°å°±æ˜¯å…³è”æ•°ç»„çš„å€¼</li>
</ol>

<p>string preg_replace_callback_array(array $regexesAndCallbacks, string $input);
$tokenStream = []; // [tokenName, lexeme] pairs</p>

<p>$input = Â«&lt;â€™endâ€™
$a = 3; // variable initialisation
end;</p>

<p>// Pre PHP 7 code
preg_replace_callback(
    [
        â€˜~$[a-z_][a-z\d_]<em>~iâ€™,
        â€˜~=~â€™,
        â€˜~[\d]+~â€™,
        â€˜~;~â€™,
        â€˜~//.</em>~â€™
    ],
    function ($match) use (&amp;$tokenStream) {
        if (strpos($match[0], â€˜$â€™) === 0) {
            $tokenStream[] = [â€˜T_VARIABLEâ€™, $match[0]];
        } elseif (strpos($match[0], â€˜=â€™) === 0) {
            $tokenStream[] = [â€˜T_ASSIGNâ€™, $match[0]];
        } elseif (ctype_digit($match[0])) {
            $tokenStream[] = [â€˜T_NUMâ€™, $match[0]];
        } elseif (strpos($match[0], â€˜;â€™) === 0) {
            $tokenStream[] = [â€˜T_TERMINATE_STMTâ€™, $match[0]];
        } elseif (strpos($match[0], â€˜//â€™) === 0) {
            $tokenStream[] = [â€˜T_COMMENTâ€™, $match[0]];
        }
    },
    $input
);</p>

<p>// PHP 7+ code
preg_replace_callback_array(
    [
        â€˜~$[a-z_][a-z\d_]<em>~iâ€™ =&gt; function ($match) use (&amp;$tokenStream) {
            $tokenStream[] = [â€˜T_VARIABLEâ€™, $match[0]];
        },
        â€˜~=~â€™ =&gt; function ($match) use (&amp;$tokenStream) {
            $tokenStream[] = [â€˜T_ASSIGNâ€™, $match[0]];
        },
        â€˜~[\d]+~â€™ =&gt; function ($match) use (&amp;$tokenStream) {
            $tokenStream[] = [â€˜T_NUMâ€™, $match[0]];
        },
        â€˜~;~â€™ =&gt; function ($match) use (&amp;$tokenStream) {
            $tokenStream[] = [â€˜T_TERMINATE_STMTâ€™, $match[0]];
        },
        â€˜~//.</em>~â€™ =&gt; function ($match) use (&amp;$tokenStream) {
            $tokenStream[] = [â€˜T_COMMENTâ€™, $match[0]];
        }
    ],
    $input
);</p>
<ol>
  <li>éšæœºæ•°ã€éšæœºå­—ç¬¦å‡½æ•°
string random_bytes(int length);
int random_int(int min, int max);</li>
  <li>define æ”¯æŒå®šä¹‰æ•°ç»„
#php7+
define(â€˜ALLOWED_IMAGE_EXTENSIONSâ€™, [â€˜jpgâ€™, â€˜jpegâ€™, â€˜gifâ€™, â€˜pngâ€™]);
PHP7.0 å˜åŒ–</li>
  <li>é”™è¯¯å’Œå¼‚å¸¸å¤„ç†ç›¸å…³å˜æ›´
PHP 7 æ”¹å˜äº†å¤§å¤šæ•°é”™è¯¯çš„æŠ¥å‘Šæ–¹å¼ã€‚ä¸åŒäºä¼ ç»Ÿï¼ˆPHP 5ï¼‰çš„é”™è¯¯æŠ¥å‘Šæœºåˆ¶ï¼Œç°åœ¨å¤§å¤šæ•°é”™è¯¯è¢«ä½œä¸º Error å¼‚å¸¸æŠ›å‡ºã€‚</li>
</ol>

<p>è¿™ä¹Ÿæ„å‘³ç€ï¼Œå½“å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ï¼Œä»¥å‰ä»£ç ä¸­çš„ä¸€äº›é”™è¯¯å¤„ç†çš„ä»£ç å°†æ— æ³•è¢«è§¦å‘ã€‚ å› ä¸ºåœ¨ PHP 7 ç‰ˆæœ¬ä¸­ï¼Œå·²ç»ä½¿ç”¨æŠ›å‡ºå¼‚å¸¸çš„é”™è¯¯å¤„ç†æœºåˆ¶äº†ã€‚ ï¼ˆå¦‚æœä»£ç ä¸­æ²¡æœ‰æ•è· Error å¼‚å¸¸ï¼Œé‚£ä¹ˆä¼šå¼•å‘è‡´å‘½é”™è¯¯ï¼‰ã€‚set_error_handleä¸ä¸€å®šæ¥æ”¶çš„æ˜¯å¼‚å¸¸ï¼Œæœ‰å¯èƒ½æ˜¯é”™è¯¯ã€‚</p>

<p>ERRORå±‚çº§ç»“æ„</p>

<p>interface Throwable
    |- Exception implements Throwable
        |- â€¦
    |- Error implements Throwable
        |- TypeError extends Error
        |- ParseError extends Error
        |- AssertionError extends Error
        |- ArithmeticError extends Error
            |- DivisionByZeroError extends ArithmeticError
function handler(Exception $e) { â€¦ }
set_exception_handler(â€˜handlerâ€™);</p>

<p>// å…¼å®¹ PHP 5 å’Œ 7
function handler($e) { â€¦ }</p>

<p>// ä»…æ”¯æŒ PHP 7
function handler(Throwable $e) { â€¦ }</p>
<ol>
  <li>list
list ä¼šæŒ‰ç…§åŸæ¥çš„é¡ºåºè¿›è¡Œèµ‹å€¼ã€‚ä¸å†æ˜¯é€†åºäº†</li>
</ol>

<p>list($a,$b,$c) = [1,2,3];
var_dump($a);//1
var_dump($b);//2
var_dump($c);//3
listä¸å†æ”¯æŒè§£å¼€å­—ç¬¦ä¸²ã€</p>

<ol>
  <li>foreachä¸å†æ”¹å˜å†…éƒ¨æ•°ç»„æŒ‡é’ˆ
&lt;?php
$array = [0, 1, 2];
foreach ($array as &amp;$val) {
 var_dump(current($array));
}
?&gt;
#php 5
int(1)
int(2)
bool(false)
#php7
int(0)
int(0)
int(0)</li>
  <li>åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸å†è¢«è®¤ä¸ºæ˜¯æ•°å­—
var_dump(â€œ0x123â€ == â€œ291â€);
#php5
true
#php7
false</li>
</ol>

<p>5.$HTTP_RAW_POST_DATA è¢«ç§»
$HTTP_RAW_POST_DATA è¢«ç§» ä½¿ç”¨php://inputä»£æ›¿</p>

<ol>
  <li>ç§»é™¤äº† ASP å’Œ script PHP æ ‡ç­¾
å¼€æ ‡ç­¾	é—­æ ‡ç­¾
&lt;%	%&gt;
&lt;%=	%&gt;
<script language="php">	</script>
PHP7.1
PHP7.1æ–°ç‰¹æ€§</li>
  <li>å¯ä¸ºç©ºï¼ˆNullableï¼‰ç±»å‹
å‚æ•°ä»¥åŠè¿”å›å€¼çš„ç±»å‹ç°åœ¨å¯ä»¥é€šè¿‡åœ¨ç±»å‹å‰åŠ ä¸Šä¸€ä¸ªé—®å·ä½¿ä¹‹å…è®¸ä¸ºç©ºã€‚å½“å¯ç”¨è¿™ä¸ªç‰¹æ€§æ—¶ï¼Œä¼ å…¥çš„å‚æ•°æˆ–è€…å‡½æ•°è¿”å›çš„ç»“æœè¦ä¹ˆæ˜¯ç»™å®šçš„ç±»å‹ï¼Œè¦ä¹ˆæ˜¯null</li>
</ol>

<p>#php5
function($a = null){
  if($a===null) {
    return null;
  }
  return $a;
}
#php7+
function fun() :?string
{
  return null;
}</p>

<p>function fun1(?$a)
{
  var_dump($a);
}
fun1(null);//null
fun1(â€˜1â€™);//1</p>
<ol>
  <li>void ç±»å‹
è¿”å›å€¼å£°æ˜ä¸º void ç±»å‹çš„æ–¹æ³•è¦ä¹ˆå¹²è„†çœå» return è¯­å¥ã€‚å¯¹äº voidæ¥è¯´ï¼ŒNULL ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„è¿”å›å€¼ã€‚</li>
</ol>

<p>function fun() :void
{
  echo â€œhello worldâ€;
}</p>
<ol>
  <li>ç±»å¸¸é‡å¯è§æ€§
class Something
{
 const PUBLIC_CONST_A = 1;
 public const PUBLIC_CONST_B = 2;
 protected const PROTECTED_CONST = 3;
 private const PRIVATE_CONST = 4;
}</li>
  <li>iterable ä¼ªç±»
è¿™å¯ä»¥è¢«ç”¨åœ¨å‚æ•°æˆ–è€…è¿”å›å€¼ç±»å‹ä¸­ï¼Œå®ƒä»£è¡¨æ¥å—æ•°ç»„æˆ–è€…å®ç°äº†Traversableæ¥å£çš„å¯¹è±¡.</li>
</ol>

<p>function iterator(iterable $iter)
{
    foreach ($iter as $val) {
        //
    }
}</p>
<ol>
  <li>å¤šå¼‚å¸¸æ•è·å¤„ç†
ä¸€ä¸ªcatchè¯­å¥å—ç°åœ¨å¯ä»¥é€šè¿‡ç®¡é“å­—ç¬¦(|)æ¥å®ç°å¤šä¸ªå¼‚å¸¸çš„æ•è·ã€‚ è¿™å¯¹äºéœ€è¦åŒæ—¶å¤„ç†æ¥è‡ªä¸åŒç±»çš„ä¸åŒå¼‚å¸¸æ—¶å¾ˆæœ‰ç”¨</li>
</ol>

<p>try {
    // some code
} catch (FirstException | SecondException $e) {
    // handle first and second exceptions
}</p>
<ol>
  <li>listæ”¯æŒé”®å
$data = [
 [â€œidâ€ =&gt; 1, â€œnameâ€ =&gt; â€˜Tomâ€™],
 [â€œidâ€ =&gt; 2, â€œnameâ€ =&gt; â€˜Fredâ€™],
];</li>
</ol>

<p>// list() style
list(â€œidâ€ =&gt; $id1, â€œnameâ€ =&gt; $name1) = $data[0];
var_dump($id1);//1</p>
<ol>
  <li>å­—ç¬¦ä¸²æ”¯æŒè´Ÿå‘
$a= â€œhelloâ€;
$a[-2];//l</li>
  <li>å°†callback è½¬é—­åŒ…
Closureæ–°å¢äº†ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºå°†callableå¿«é€Ÿåœ° è½¬ä¸ºä¸€ä¸ªClosure å¯¹è±¡ã€‚</li>
</ol>

<p>&lt;?php
class Test
{
    public function exposeFunction()
    {
        return Closure::fromCallable([$this, â€˜privateFunctionâ€™]);
    }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private function privateFunction($param)
{
    var_dump($param);
} }
</code></pre></div></div>

<p>$privFunc = (new Test)-&gt;exposeFunction();
$privFunc(â€˜some valueâ€™);</p>
<ol>
  <li>http2 æœåŠ¡æ¨é€
å¯¹http2æœåŠ¡å™¨æ¨é€çš„æ”¯æŒç°åœ¨å·²ç»è¢«åŠ å…¥åˆ° CURL æ‰©å±•</li>
</ol>

<p>PHP7.1å˜æ›´</p>
<ol>
  <li>
    <p>ä¼ é€’å‚æ•°è¿‡å°‘æ—¶å°†æŠ›å‡ºé”™è¯¯
è¿‡å»æˆ‘ä»¬ä¼ é€’å‚æ•°è¿‡å°‘ ä¼šäº§ç”Ÿwarningã€‚php7.1å¼€å§‹ä¼šæŠ›å‡ºerror</p>
  </li>
  <li>ç§»é™¤äº†ext/mcryptæ‹“å±•
PHP7.2
PHP7.2æ–°ç‰¹æ€§</li>
  <li>å¢åŠ æ–°çš„ç±»å‹object
function test(object $obj) : object
{
 return new SplQueue();
}</li>
</ol>

<p>test(new StdClass());</p>
<ol>
  <li>é€šè¿‡åç§°åŠ è½½æ‰©å±•
æ‰©å±•æ–‡ä»¶ä¸å†éœ€è¦é€šè¿‡æ–‡ä»¶åŠ è½½ (Unixä¸‹ä»¥.soä¸ºæ–‡ä»¶æ‰©å±•åï¼Œåœ¨Windowsä¸‹ä»¥ .dll ä¸ºæ–‡ä»¶æ‰©å±•å) è¿›è¡ŒæŒ‡å®šã€‚å¯ä»¥åœ¨php.inié…ç½®æ–‡ä»¶è¿›è¡Œå¯ç”¨</li>
</ol>

<p>; ini file
extension=php-ast
zend_extension=opcache
3.å…è®¸é‡å†™æŠ½è±¡æ–¹æ³•
å½“ä¸€ä¸ªæŠ½è±¡ç±»ç»§æ‰¿äºå¦å¤–ä¸€ä¸ªæŠ½è±¡ç±»çš„æ—¶å€™ï¼Œç»§æ‰¿åçš„æŠ½è±¡ç±»å¯ä»¥é‡å†™è¢«ç»§æ‰¿çš„æŠ½è±¡ç±»çš„æŠ½è±¡æ–¹æ³•ã€‚</p>

<p>&lt;?php</p>

<p>abstract class A
{
    abstract function test(string $s);
}
abstract class B extends A
{
    // overridden - still maintaining contravariance for parameters and covariance for return
    abstract function test($s) : int;
}</p>
<ol>
  <li>
    <p>ä½¿ç”¨Argon2ç®—æ³•ç”Ÿæˆå¯†ç æ•£åˆ—
Argon2 å·²ç»è¢«åŠ å…¥åˆ°å¯†ç æ•£åˆ—ï¼ˆpassword hashingï¼‰ API (è¿™äº›å‡½æ•°ä»¥ password_ å¼€å¤´), ä»¥ä¸‹æ˜¯æš´éœ²å‡ºæ¥çš„å¸¸é‡</p>
  </li>
  <li>
    <p>æ–°å¢ PDO å­—ç¬¦ä¸²æ‰©å±•ç±»å‹
å½“ä½ å‡†å¤‡æ”¯æŒå¤šè¯­è¨€å­—ç¬¦é›†ï¼ŒPDOçš„å­—ç¬¦ä¸²ç±»å‹å·²ç»æ‰©å±•æ”¯æŒå›½é™…åŒ–çš„å­—ç¬¦é›†ã€‚ä»¥ä¸‹æ˜¯æ‰©å±•çš„å¸¸é‡ï¼š</p>
  </li>
</ol>

<p>PDO::PARAM_STR_NATL
PDO::PARAM_STR_CHAR
PDO::ATTR_DEFAULT_STR_PARAM
$db-&gt;quote(â€˜Ã¼berâ€™, PDO::PARAM_STR | PDO::PARAM_STR_NATL);</p>
<ol>
  <li>å‘½ååˆ†ç»„å‘½åç©ºé—´æ”¯æŒå°¾éƒ¨é€—å·
use Foo\Bar{
 Foo,
 Bar,
 Baz,
};
PHP7.2 å˜æ›´</li>
  <li>number_format è¿”å›å€¼
var_dump(number_format(-0.01)); // now outputs string(1) â€œ0â€ instead of string(2) â€œ-0â€</li>
  <li>get_class()ä¸å†å…è®¸nullã€‚
var_dump(get_class(null))// warning</li>
  <li>count ä½œç”¨åœ¨ä¸æ˜¯ Countable Types å°†å‘ç”Ÿwarning
count(1), // integers are not countable</li>
  <li>ä¸å¸¦å¼•å·çš„å­—ç¬¦ä¸²
åœ¨ä¹‹å‰ä¸å¸¦å¼•å·çš„å­—ç¬¦ä¸²æ˜¯ä¸å­˜åœ¨çš„å…¨å±€å¸¸é‡ï¼Œè½¬åŒ–æˆä»–ä»¬è‡ªèº«çš„å­—ç¬¦ä¸²ã€‚ç°åœ¨å°†ä¼šäº§ç”Ÿwaringã€‚</li>
</ol>

<p>var_dump(HEELLO);</p>
<ol>
  <li>
    <p>__autoload è¢«åºŸå¼ƒ
__autoloadæ–¹æ³•å·²è¢«åºŸå¼ƒ</p>
  </li>
  <li>
    <p>each è¢«åºŸå¼ƒ
ä½¿ç”¨æ­¤å‡½æ•°éå†æ—¶ï¼Œæ¯”æ™®é€šçš„ foreach æ›´æ…¢ï¼Œ å¹¶ä¸”ç»™æ–°è¯­æ³•çš„å˜åŒ–å¸¦æ¥å®ç°é—®é¢˜ã€‚å› æ­¤å®ƒè¢«åºŸå¼ƒäº†ã€‚</p>
  </li>
  <li>
    <p>is_objectã€gettypeä¿®æ­£
is_object ä½œç”¨åœ¨<strong>__PHP_Incomplete_Class</strong> å°†åæ­£ true</p>
  </li>
</ol>

<p>gettypeä½œç”¨åœ¨é—­åŒ…åœ¨å°†æ­£ç¡®è¿”å›resource</p>

<ol>
  <li>Convert Numeric Keys in Object/Array Casts
æŠŠæ•°ç»„è½¬å¯¹è±¡çš„æ—¶å€™ï¼Œå¯ä»¥è®¿é—®åˆ°æ•´å‹é”®çš„å€¼ã€‚</li>
</ol>

<p>// array to object
$arr = [0 =&gt; 1];
$obj = (object)$arr;
var_dump(
    $obj,
    $obj-&gt;{â€˜0â€™}, // now accessible
    $obj-&gt;{0} // now accessible
);</p>
:ET