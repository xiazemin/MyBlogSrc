I"™İ<p>æœ‰é‚£ä¹ˆä¸ªç»„ç»‡å«freedesktopï¼Œå®ƒæ˜¯ä¸“é—¨ä¸ºlinuxæ¡Œé¢åˆ¶å®šæ ‡å‡†çš„ã€‚ä»€ä¹ˆKDEï¼ŒGNOMEéƒ½æ˜¯æŒ‰ä»–çš„æ ‡å‡†æ¥çš„ã€‚è€Œdbusæ˜¯å…¶ä¸­çš„æ¡Œé¢æ¶ˆæ¯æœºåˆ¶çš„ä¸€ä¸ªæ ‡å‡†ã€‚</p>

<p>dbusæ˜¯ä¸€ä¸ªIPCçš„ç®¡ç†ç³»ç»Ÿï¼Œå…¶å®å°±åº•å±‚æ¥è¯´å°±æ˜¯æœ¬åœ°socketé€šä¿¡ã€‚ä½†æ˜¯ä»–æ˜¯å°†æ‰€æœ‰çš„æ¶ˆæ¯éƒ½é€šè¿‡æ€»çº¿çš„æ–¹å¼æ¥ç®¡ç†åˆ†å‘ï¼Œæ˜“äºç®¡ç†å’Œå®‰å…¨ã€‚</p>

<p>dbusä¸€èˆ¬å°±æ˜¯3å±‚ç»“æ„ï¼š</p>

<ol>
  <li>libdbusåº“ï¼Œå…è®¸ä¸¤ä¸ªåº”ç”¨ç›¸äº’è¿æ¥äº¤æ¢æ¶ˆæ¯</li>
  <li>ä¸€ä¸ªå»ºç«‹åœ¨libdbusä¸Šçš„æ¶ˆæ¯æ€»çº¿å®ˆæŠ¤ç¨‹åºï¼Œè¿™ä¸ªå®ˆæŠ¤ç¨‹åºå¯ä»¥è·¯ç”±æ¶ˆæ¯</li>
  <li>å°è£…åº“ï¼Œæ¯”å¦‚libdbus-glibæˆ–libdbus-qtã€‚ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨å°è£…åº“æ¥ç®€åŒ–ä½¿ç”¨dbusçš„ç»†èŠ‚ã€‚
<!-- more -->
ä¸€èˆ¬gtkï¼ˆcè¯­è¨€ï¼‰å¼€å‘çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨gobject-dbusåº“ï¼Œqtï¼ˆc++ï¼‰çš„è¯å¯ä»¥ä½¿ç”¨dbus-qtåº“ï¼Œè€Œpythonä½¿ç”¨python-dbusæ¨¡å—ã€‚</li>
</ol>

<p>è¿˜æœ‰nodejsçš„è¯ï¼Œæˆ‘æ¨èä½¿ç”¨node-nativeæ¨¡å—ï¼ˆé…åˆnodewebkitè¿˜æ˜¯æ¯”è¾ƒå¥½ç”¨çš„ï¼‰ã€‚</p>

<p>è¿˜æœ‰åšdbusç›¸å…³å¼€å‘çš„è¯ï¼Œä½¿ç”¨ä¸€ä¸ªå«d-feetå·¥å…·ï¼Œå°±å¯ä»¥æŸ¥çœ‹å½“å‰æ‰€æœ‰åœ¨ä½¿ç”¨ä¸­çš„dbusåç§°åŠå…¶ä»–å±æ€§ã€‚</p>

<p>dbusåˆ†ä¸ºä¸¤ç§æ€»çº¿ï¼Œä¸€ç§å«SystemBusï¼Œä¸€ç§å«SessionBusã€‚SystemBuså°±åªæœ‰ä¸€æ¡ï¼ŒSessionBusæ˜¯ä¸€ä¸ªç”¨æˆ·ä¼šè¯æ—¶ä¼šäº§ç”Ÿä¸€æ¡ã€‚è‡³äºè¿™ä¸¤ç§çš„åŒºåˆ«ï¼ŒSystemBusä¸€èˆ¬æ˜¯ç”¨äºæƒé™è¾ƒé«˜çš„ç³»ç»Ÿçº§ï¼ˆrootï¼‰è¿›ç¨‹ä¸å…¶ä»–è¿›ç¨‹ï¼ˆå¯ä»¥æ˜¯æ™®é€šè¿›ç¨‹ï¼‰çš„é€šä¿¡ï¼Œè€ŒSessionBusæ˜¯ç”¨äºæ™®é€šçš„ç”¨æˆ·è¿›ç¨‹ä¹‹é—´çš„äº¤æµã€‚</p>

<p>dbusæ˜¯å•å¯¹å•çš„é€šä¿¡ï¼Œå…¶å®å’ŒC/Sæ¶æ„å·®ä¸å¤šï¼Œä¸€ä¸ªserverç«¯æ¥æ”¶æ¶ˆæ¯å’Œå‘å¸ƒä¿¡å·ï¼Œå¤šä¸ªclientç«¯å‘é€æ¶ˆæ¯å’Œæ¥æ”¶ä¿¡å·ã€‚</p>

<p>dbusé€šä¿¡çš„è¯æœ‰5ä¸ªå€¼éœ€è¦æ³¨æ„ï¼š</p>

<ol>
  <li>
    <p>Addressï¼šå› ä¸ºdbusä¹Ÿæ˜¯é€šè¿‡æœ¬åœ°socketæ¥é€šä¿¡ï¼Œæ‰€æœ‰ä¼šæœ‰socketæ–‡ä»¶ã€‚ä½ å¯ä»¥ç›´æ¥è¿æ¥è¿™ä¸ªsokcetæ–‡ä»¶çš„åœ°å€æ¥é€šä¿¡ï¼Œä½†è¿™ä¸ªæˆ‘å‡ ä¹ä¸ç”¨ã€‚</p>
  </li>
  <li>
    <p>Bus Nameï¼šå½“ä½ ä½¿ç”¨æ€»çº¿å®ˆæŠ¤è¿›ç¨‹æ—¶ï¼ˆä½ çœ‹è¿›ç¨‹è¡¨é‡Œä¸æ˜¯æœ‰å¾ˆå¤šdbus-daemonå˜›ï¼Œ3å±‚ç»“æ„çš„ç¬¬äºŒå±‚ï¼‰ï¼Œä½ åªç”¨é€šè¿‡ä¸€ä¸ªBus Nameå°±å¯ä»¥ç›´æ¥å°†æ¶ˆæ¯è·¯ç”±åˆ°ä½ æƒ³è¦çš„åœ°å€ã€‚æ‰€ä»¥è¿™ä¹ˆæ–¹ä¾¿ï¼Œå¹²å˜›ç”¨ä¸Šé¢çš„ã€‚serverç«¯æƒ³è¦Bus Nameéœ€è¦å‘SystemBusæˆ–SessionBusç”³è¯·ã€‚å¦‚æœä¸ç”³è¯·è¿æ¥åˆ°dbusï¼Œå®ƒä¼šè‡ªåŠ¨è¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„åå­—ï¼Œå°±æ˜¯1.45ä¹‹ç±»çš„ï¼Œè¿™æ•°å­—æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œåªæ˜¯ä¸ºäº†åå­—å”¯ä¸€ã€‚åå­—é™¤äº†è·¯ç”±æ¶ˆæ¯è¿˜æœ‰ç¬¬äºŒç§ç”¨é€”ï¼Œå°±æ˜¯å½“ä¸€ä¸ªç¨‹åºé€€å‡ºï¼Œæ–­å¼€è¿æ¥ï¼Œæ¶ˆæ¯æ€»çº¿å°±ä¼šæé†’å…¶ä»–è¿æ¥ç¨‹åºè¯¥åå­—å¤±å»äº†æ‰€æœ‰è€…ã€‚è¿™æ ·å°±å®¹æ˜“ç®¡ç†å…¶ä»–ç¨‹åºäº†</p>
  </li>
  <li>
    <p>Pathï¼šè¿™ä¸ªè·¯å¾„æ˜¯æŒ‡ä½ åœ¨è¿›ç¨‹é‡Œçš„è·¯å¾„ï¼Œä½ å¯ä»¥æŒ‰æ¨¡å—æ¥åˆ’åˆ†ï¼Œæ¯”å¦‚NetwrokManager æœ‰ æ— çº¿å’Œæœ‰çº¿è¿™ä¸¤æ¨¡å—ã€‚</p>
  </li>
  <li>
    <p>Interfaceï¼šä»–å°±åƒæ˜¯ä¸€ç»„åŠŸèƒ½çš„é›†åˆåå­—ï¼Œä½ å¯ä»¥æŒ‰åŠŸèƒ½æ¥åˆ’åˆ†ã€‚</p>
  </li>
  <li>
    <p>Method/Signalsï¼šæ–¹æ³•å’Œä¿¡å·ï¼Œæ–¹æ³•å…¶å®å°±æ˜¯è¿›ç¨‹é‡Œçš„å‡½æ•°åï¼Œä½ å‘æ¶ˆæ¯ç»™è¿™ä¸ªå‡½æ•°åï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œå¹¶è¿”å›ç»“æœã€‚ä¿¡å·å°±æ˜¯å½“serverç«¯ä¸»åŠ¨è°ƒç”¨è¿™ä¸ªä¿¡å·å‡½æ•°çš„æ—¶å€™ï¼Œä¾¿ä¼šå‘å‡ºè¿™ä¸ªä¿¡å·ï¼ˆä¿¡å·åå°±æ˜¯å‡½æ•°åï¼‰ï¼Œå…¶ä»–è¿æ¥åœ¨åŒä¸€æ€»çº¿ä¸Šçš„ç¨‹åºï¼Œå¦‚æœè°æ„Ÿå…´è¶£å°±ä¼šæ¥æ”¶å¤„ç†ã€‚</p>
  </li>
</ol>

<p>æ‰€ä»¥æ€»çš„æ¥è¯´ï¼Œå…¶å®å¯ä»¥è¿™æ ·ç†è§£ï¼ŒAddresså’ŒBus Nameå°±ç›¸å½“äºä½ å®¶çš„åŸå¸‚åœ°å€ï¼ŒPathå°±ç›¸å½“äºä½ å®¶ä½å“ªä¸ªå¿å“ªä¸ªåŒºï¼ŒInterfaceå°±ç›¸å½“äºä½ å®¶å“ªä¸ªæ‘å“ªä¸ªè·¯ï¼ŒMethodå°±ç›¸å½“äºä½ å®¶å“ªä¸ªäººã€‚dbusåˆ™å……å½“äº†é‚®å±€çš„èº«ä»½ã€‚</p>

<p>é‚£å…ˆå°è¯•ä¸‹å‘é€ä¸ªæ¶ˆæ¯çœ‹çœ‹ï¼š</p>

<p>d-feetåœ¨SystemBusä¸‹å¯ä»¥æ‰¾åˆ°org.freedesktop.DBusè¿™ä¸ªBus Nameï¼Œå®ƒæœ‰ä¸ªPathå« â€œ / â€ï¼Œâ€œ / â€ä¸‹é¢æœ‰org.freedesktop.DBusè¿™ä¸ªInterfaceï¼Œé‡Œé¢æœ‰ä¸ªå«GetIdçš„Methodsï¼Œå¯ä»¥è·Ÿå®ƒé€šä¿¡ä¸€ä¸‹ã€‚è¿™é‡Œä½¿ç”¨dbus-sendå‘½ä»¤æ¥å‘é€ã€‚dbus-sendæ˜¯dbusæä¾›çš„ä¸€ä¸ªå‘½ä»¤ï¼Œå¯ç›´æ¥å‘ç›®æ ‡å‘é€æ¶ˆæ¯ã€‚</p>

<p>~ dbus-send â€“system â€“print-reply â€“dest=org.freedesktop.DBus / org.freedesktop.DBus.GetId</p>

<p>è¿”å›æ‰“å°å‡ºäº†ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å°±æ˜¯GetIdå‡½æ•°çš„æ‰§è¡Œç»“æœã€‚</p>

<p>dbus-sendä½¿ç”¨æ–¹æ³•ï¼š â€“systemè¡¨ç¤ºæ˜¯System Busï¼Œâ€“print-replyè¡¨ç¤ºæ‰“å°å›å¤ä¿¡æ¯ï¼Œ â€“desk=[Bus Name] [Path] [Interface].[Method] è¡¨ç¤ºåœ°å€ï¼Œæ³¨æ„Methodæ˜¯æ¥åœ¨Interfaceåé¢çš„ã€‚</p>

<p>dbus pythonç¤ºä¾‹å¯ä»¥çœ‹http://dbus.freedesktop.org/doc/dbus-python/doc/tutorial.html Â æ¯”è¾ƒè¯¦ç»†</p>

<p>dbuså®˜æ–¹wikiï¼šhttp://www.freedesktop.org/wiki/Software/dbus/</p>

<p>è¿›ç¨‹é—´ä½¿ç”¨D-Busé€šä¿¡
D-Busæ˜¯ä¸€ç§é«˜çº§çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œå®ƒç”±freedesktop.orgé¡¹ç›®æä¾›ï¼Œä½¿ç”¨GPLè®¸å¯è¯å‘è¡Œã€‚D-Busæœ€ä¸»è¦çš„ç”¨é€”æ˜¯åœ¨Linuxæ¡Œé¢ç¯å¢ƒä¸ºè¿›ç¨‹æä¾›é€šä¿¡ï¼ŒåŒæ—¶èƒ½å°†Linuxæ¡Œé¢ç¯å¢ƒå’ŒLinuxå†…æ ¸äº‹ä»¶ä½œä¸ºæ¶ˆæ¯ä¼ é€’åˆ°è¿›ç¨‹ã€‚D-Busçš„ä¸»è¦æ¦‚ç‡ä¸ºæ€»çº¿ï¼Œæ³¨å†Œåçš„è¿›ç¨‹å¯é€šè¿‡æ€»çº¿æ¥æ”¶æˆ–ä¼ é€’æ¶ˆæ¯ï¼Œè¿›ç¨‹ä¹Ÿå¯æ³¨å†Œåç­‰å¾…å†…æ ¸äº‹ä»¶å“åº”ï¼Œä¾‹å¦‚ç­‰å¾…ç½‘ç»œçŠ¶æ€çš„è½¬å˜æˆ–è€…è®¡ç®—æœºå‘å‡ºå…³æœºæŒ‡ä»¤ã€‚ç›®å‰ï¼ŒD-Buså·²è¢«å¤§å¤šæ•°Linuxå‘è¡Œç‰ˆæ‰€é‡‡ç”¨ï¼Œå¼€å‘è€…å¯ä½¿ç”¨D-Buså®ç°å„ç§å¤æ‚çš„è¿›ç¨‹é—´é€šä¿¡ä»»åŠ¡ã€‚</p>

<p>D-Busçš„åŸºæœ¬æ¦‚å¿µ
D-Busæ˜¯ä¸€ä¸ªæ¶ˆæ¯æ€»çº¿ç³»ç»Ÿï¼Œå…¶åŠŸèƒ½å·²æ¶µç›–è¿›ç¨‹é—´é€šä¿¡çš„æ‰€æœ‰éœ€æ±‚ï¼Œå¹¶å…·å¤‡ä¸€äº›ç‰¹æ®Šçš„ç”¨é€”ã€‚D-Busæ˜¯ä¸‰å±‚æ¶æ„çš„è¿›ç¨‹é—´é€šä¿¡ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p>

<p>æ¥å£å±‚ï¼šæ¥å£å±‚ç”±å‡½æ•°åº“libdbusæä¾›ï¼Œè¿›ç¨‹å¯é€šè¿‡è¯¥åº“ä½¿ç”¨D-Busçš„èƒ½åŠ›ã€‚</p>

<p>æ€»çº¿å±‚ï¼šæ€»çº¿å±‚å®é™…ä¸Šæ˜¯ç”±D-Busæ€»çº¿å®ˆæŠ¤è¿›ç¨‹æä¾›çš„ã€‚å®ƒåœ¨Linuxç³»ç»Ÿå¯åŠ¨æ—¶è¿è¡Œï¼Œè´Ÿè´£è¿›ç¨‹é—´çš„æ¶ˆæ¯è·¯ç”±å’Œä¼ é€’ï¼Œå…¶ä¸­åŒ…æ‹¬Linuxå†…æ ¸å’ŒLinuxæ¡Œé¢ç¯å¢ƒçš„æ¶ˆæ¯ä¼ é€’ã€‚</p>

<p>åŒ…è£…å±‚ï¼šåŒ…è£…å±‚ä¸€ç³»åˆ—åŸºäºç‰¹å®šåº”ç”¨ç¨‹åºæ¡†æ¶çš„Wrapperåº“ã€‚</p>

<p>D-Buså…·å¤‡è‡ªèº«çš„åè®®ï¼Œåè®®åŸºäºäºŒè¿›åˆ¶æ•°æ®è®¾è®¡ï¼Œä¸æ•°æ®ç»“æ„å’Œç¼–ç æ–¹å¼æ— å…³ã€‚è¯¥åè®®æ— éœ€å¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–ï¼Œä¿è¯äº†ä¿¡æ¯ä¼ é€’çš„é«˜æ•ˆæ€§ã€‚æ— è®ºæ˜¯libdbusï¼Œè¿˜æ˜¯D-Busæ€»çº¿å®ˆæŠ¤è¿›ç¨‹ï¼Œå‡ä¸éœ€è¦å¤ªå¤§çš„ç³»ç»Ÿå¼€é”€ã€‚</p>

<p>æ€»çº¿æ˜¯D-Busçš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œä¸€ä¸ªç³»ç»Ÿä¸­é€šå¸¸å­˜åœ¨å¤šæ¡æ€»çº¿ï¼Œè¿™äº›æ€»çº¿ç”±D-Busæ€»çº¿å®ˆæŠ¤è¿›ç¨‹ç®¡ç†ã€‚æœ€é‡è¦çš„æ€»çº¿ä¸ºç³»ç»Ÿæ€»çº¿ï¼ˆSystem Busï¼‰ï¼ŒLinuxå†…æ ¸å¼•å¯¼æ—¶ï¼Œè¯¥æ€»çº¿å°±å·²è¢«è£…å…¥å†…å­˜ã€‚åªæœ‰Linuxå†…æ ¸ã€Linuxæ¡Œé¢ç¯å¢ƒå’Œæƒé™è¾ƒé«˜çš„ç¨‹åºæ‰èƒ½å‘è¯¥æ€»çº¿å†™å…¥æ¶ˆæ¯ï¼Œä»¥æ­¤ä¿éšœç³»ç»Ÿå®‰å…¨æ€§ï¼Œé˜²æ­¢æœ‰æ¶æ„è¿›ç¨‹å‡å†’Linuxå‘é€æ¶ˆæ¯ã€‚</p>

<p>ä¼šè¯æ€»çº¿ï¼ˆSession Busesï¼‰ç”±æ™®é€šè¿›ç¨‹åˆ›å»ºï¼Œå¯åŒæ—¶å­˜åœ¨å¤šæ¡ã€‚ä¼šè¯æ€»çº¿å±äºæŸä¸ªè¿›ç¨‹ç§æœ‰ï¼Œå®ƒç”¨äºè¿›ç¨‹é—´ä¼ é€’æ¶ˆæ¯ã€‚</p>

<p>è¿›ç¨‹å¿…é¡»æ³¨å†Œåæ‰èƒ½æ”¶åˆ°æ€»çº¿ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”å¯åŒæ—¶è¿æ¥åˆ°å¤šæ¡æ€»çº¿ä¸­ã€‚D-Busæä¾›äº†åŒ¹é…å™¨ï¼ˆMatchersï¼‰ä½¿è¿›ç¨‹å¯ä»¥æœ‰é€‰æ‹©æ€§çš„æ¥æ”¶æ¶ˆæ¯ï¼Œå¦å¤–è¿è¡Œè¿›ç¨‹æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œåœ¨æ”¶åˆ°æŒ‡å®šæ¶ˆæ¯æ—¶è¿›è¡Œå¤„ç†ã€‚åŒ¹é…å™¨çš„åŠŸèƒ½ç­‰åŒä¸è·¯ç”±ï¼Œç”¨äºé¿å…å¤„ç†æ— å…³æ¶ˆæ¯é€ æˆè¿›ç¨‹çš„æ€§èƒ½ä¸‹é™ã€‚é™¤æ­¤ä»¥å¤–ï¼ŒD-Busæœºåˆ¶çš„é‡è¦æ¦‚å¿µæœ‰ä»¥ä¸‹å‡ ä¸ªã€‚</p>

<p>å¯¹è±¡ï¼šå¯¹è±¡æ˜¯å°è£…åçš„åŒ¹é…å™¨ä¸å›è°ƒå‡½æ•°ï¼Œå®ƒä»¥å¯¹ç­‰ï¼ˆpeer-to-peerï¼‰åè®®ä½¿æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªæºåœ°å€å’Œä¸€ä¸ªç›®çš„åœ°å€ã€‚è¿™äº›åœ°å€åˆç§°ä¸ºå¯¹è±¡è·¯å¾„ï¼Œæˆ–è€…ç§°ä¹‹ä¸ºæ€»çº¿åç§°ã€‚å¯¹è±¡çš„æ¥å£æ˜¯å›è°ƒå‡½æ•°ï¼Œå®ƒä»¥ç±»ä¼¼C++çš„è™šæ‹Ÿå‡½æ•°å®ç°ã€‚å½“ä¸€ä¸ªè¿›ç¨‹æ³¨å†Œåˆ°æŸä¸ªæ€»çº¿æ—¶ï¼Œéƒ½è¦åˆ›å»ºç›¸åº”çš„æ¶ˆæ¯å¯¹è±¡ã€‚</p>

<p>æ¶ˆæ¯ï¼šD-Busçš„æ¶ˆæ¯åˆ†ä¸ºä¿¡å·ï¼ˆsignalsï¼‰ã€æ–¹æ³•è°ƒç”¨ï¼ˆmethod callsï¼‰ã€æ–¹æ³•è¿”å›ï¼ˆmethod returnsï¼‰å’Œé”™è¯¯ï¼ˆerrorsï¼‰ã€‚ä¿¡å·æ˜¯æœ€åŸºæœ¬çš„æ¶ˆæ¯ï¼Œæ³¨å†Œçš„è¿›ç¨‹å¯ç®€å•åœ°å‘é€ä¿¡å·åˆ°æ€»çº¿ä¸Šï¼Œå…¶ä»–è¿›ç¨‹é€šè¿‡æ€»çº¿è¯»å–æ¶ˆæ¯ã€‚æ–¹æ³•è°ƒç”¨æ˜¯é€šè¿‡æ€»çº¿ä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œå¦ä¸€ä¸ªè¿›ç¨‹æ¥å£å‡½æ•°çš„æœºåˆ¶ï¼Œç”¨äºæŸä¸ªè¿›ç¨‹æ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹ã€‚æ–¹æ³•è¿”å›æ˜¯æ³¨å†Œçš„è¿›ç¨‹åœ¨æ”¶åˆ°ç›¸å…³ä¿¡æ¯åï¼Œè‡ªåŠ¨åšå‡ºååº”çš„æœºåˆ¶ï¼Œç”±å›è°ƒå‡½æ•°å®ç°ã€‚é”™è¯¯æ˜¯ä¿¡å·çš„ä¸€ç§ï¼Œæ˜¯æ³¨å†Œè¿›ç¨‹é”™è¯¯å¤„ç†æœºåˆ¶ä¹‹ä¸€ã€‚</p>

<p>æœåŠ¡ï¼šæœåŠ¡ï¼ˆServicesï¼‰æ˜¯è¿›ç¨‹æ³¨å†Œçš„æŠ½è±¡ã€‚è¿›ç¨‹æ³¨å†ŒæŸä¸ªåœ°å€åï¼Œå³å¯è·å¾—å¯¹åº”æ€»çº¿çš„æœåŠ¡ã€‚D-Busæä¾›äº†æœåŠ¡æŸ¥è¯¢æ¥å£ï¼Œè¿›ç¨‹å¯é€šè¿‡è¯¥æ¥å£æŸ¥è¯¢æŸä¸ªæœåŠ¡æ˜¯å¦å­˜åœ¨ã€‚æˆ–è€…åœ¨æœåŠ¡ç»“æŸæ—¶è‡ªåŠ¨æ”¶åˆ°æ¥è‡ªç³»ç»Ÿçš„æ¶ˆæ¯ã€‚</p>

<p>å»ºç«‹æœåŠ¡çš„æµç¨‹:
å»ºç«‹ä¸€ä¸ªdbusè¿æ¥ä¹‹å â€“ dbus_bus_get()ï¼Œä¸ºè¿™ä¸ªdbusè¿æ¥(DbusConnection)èµ·å â€“ dbus_bus_request_name()ï¼Œè¿™ä¸ªåå­—å°†ä¼šæˆä¸ºæˆ‘ä»¬åœ¨åç»­è¿›è¡Œè¿œç¨‹è°ƒç”¨çš„æ—¶å€™çš„æœåŠ¡åï¼Œç„¶åæˆ‘ä»¬è¿›å…¥ç›‘å¬å¾ªç¯ â€“ dbus_connection_read_write()ã€‚åœ¨å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬ä»æ€»çº¿ä¸Šå–å‡ºæ¶ˆæ¯ â€“ dbus_connection_pop_message()ï¼Œå¹¶é€šè¿‡æ¯”å¯¹æ¶ˆæ¯ä¸­çš„æ–¹æ³•æ¥å£åå’Œæ–¹æ³•å â€“ dbus_message_is_method_call()ï¼Œå¦‚æœä¸€è‡´ï¼Œé‚£ä¹ˆæˆ‘ä»¬è·³è½¬åˆ°ç›¸åº”çš„å¤„ç†ä¸­å»ã€‚åœ¨ç›¸åº”çš„å¤„ç†ä¸­ï¼Œæˆ‘ä»¬ä¼šä»æ¶ˆæ¯ä¸­å–å‡ºè¿œç¨‹è°ƒç”¨çš„å‚æ•°ã€‚å¹¶ä¸”å»ºç«‹èµ·å›ä¼ ç»“æœçš„é€šè·¯ â€“ reply_to_method_call()ã€‚å›ä¼ åŠ¨ä½œæœ¬èº«ç­‰åŒäºä¸€æ¬¡ä¸éœ€è¦ç­‰å¾…ç»“æœçš„è¿œç¨‹è°ƒç”¨ã€‚
å‘é€ä¿¡å·çš„æµç¨‹:
å»ºç«‹ä¸€ä¸ªdbusè¿æ¥ä¹‹åï¼Œä¸ºè¿™ä¸ªdbusè¿æ¥èµ·åï¼Œå»ºç«‹ä¸€ä¸ªå‘é€ä¿¡å·çš„é€šé“ï¼Œæ³¨æ„ï¼Œåœ¨å»ºç«‹é€šé“çš„å‡½æ•°ä¸­ï¼Œéœ€è¦æˆ‘ä»¬å¡«å†™è¯¥ä¿¡å·çš„æ¥å£åå’Œä¿¡å·å â€“ dbus_message_new_signal()ã€‚ç„¶åæˆ‘ä»¬æŠŠä¿¡å·å¯¹åº”çš„ç›¸å…³å‚æ•°å‹è¿›å» â€“ dbus_message_iter_init_append(); dbus_message_iter_append_basic()ã€‚ç„¶åå°±å¯ä»¥å¯åŠ¨å‘é€äº† â€“ dbus_connection_send(); dbus_connection_flushã€‚
è¿›è¡Œä¸€æ¬¡è¿œç¨‹è°ƒç”¨çš„æµç¨‹:
å»ºç«‹å¥½dbusè¿æ¥ä¹‹åï¼Œä¸ºè¿™dbusè¿æ¥å‘½åï¼Œç”³è¯·ä¸€ä¸ªè¿œç¨‹è°ƒç”¨é€šé“ â€“ dbus_message_new_method_call()ï¼Œæ³¨æ„ï¼Œåœ¨ç”³è¯·è¿œç¨‹è°ƒç”¨é€šé“çš„æ—¶å€™ï¼Œéœ€è¦å¡«å†™æœåŠ¡å™¨åï¼Œæœ¬æ¬¡è°ƒç”¨çš„æ¥å£åï¼Œå’Œæœ¬æ¬¡è°ƒç”¨å(æ–¹æ³•å)ã€‚å‹å…¥æœ¬æ¬¡è°ƒç”¨çš„å‚æ•° â€“ dbus_message_iter_init_append(); dbus_message_iter_append_basic()ï¼Œå®é™…ä¸Šæ˜¯ç”³è¯·äº†ä¸€ä¸ªé¦–åœ°å€ï¼Œæˆ‘ä»¬å°±æ˜¯æŠŠæˆ‘ä»¬çœŸæ­£è¦ä¼ çš„å‚æ•°ï¼Œå¾€è¿™ä¸ªé¦–åœ°å€é‡Œé¢é€(é€å®Œä¹‹åä¸€èˆ¬éƒ½ä¼šåˆ¤æ–­æ˜¯å¦å†…å­˜è¶Šç•Œäº†)ã€‚ç„¶åå°±æ˜¯å¯åŠ¨å‘é€è°ƒç”¨å¹¶é‡Šæ”¾å‘é€ç›¸å…³çš„æ¶ˆæ¯ç»“æ„ â€“ dbus_connection_send_with_reply()ã€‚è¿™ä¸ªå¯åŠ¨å‡½æ•°ä¸­å¸¦æœ‰ä¸€ä¸ªå¥æŸ„ã€‚æˆ‘ä»¬é©¬ä¸Šä¼šé˜»å¡ç­‰å¾…è¿™ä¸ªå¥æŸ„ç»™æˆ‘ä»¬å¸¦å›æ€»çº¿ä¸Šå›ä¼ çš„æ¶ˆæ¯ã€‚å½“è¿™ä¸ªå¥æŸ„å›ä¼ æ¶ˆæ¯ä¹‹åï¼Œæˆ‘ä»¬ä»æ¶ˆæ¯ç»“æ„ä¸­åˆ†ç¦»å‡ºå‚æ•°ã€‚ç”¨dbusæä¾›çš„å‡½æ•°æå–å‚æ•°çš„ç±»å‹å’Œå‚æ•° â€“ dbus_message_iter_init(); dbus_message_iter_next(); dbus_message_iter_get_arg_type(); dbus_message_iter_get_basic()ã€‚ä¹Ÿå°±è¾¾æˆäº†æˆ‘ä»¬è¿›è¡Œæœ¬æ¬¡è¿œç¨‹è°ƒç”¨çš„ç›®çš„äº†ã€‚
ä¿¡å·æ¥æ”¶æµç¨‹:
å»ºç«‹ä¸€ä¸ªdbusè¿æ¥ä¹‹åï¼Œä¸ºè¿™ä¸ªdbusè¿æ¥èµ·åï¼Œä¸ºæˆ‘ä»¬å°†è¦è¿›è¡Œçš„æ¶ˆæ¯å¾ªç¯æ·»åŠ åŒ¹é…æ¡ä»¶(å°±æ˜¯é€šè¿‡ä¿¡å·åå’Œä¿¡å·æ¥å£åæ¥è¿›è¡ŒåŒ¹é…æ§åˆ¶çš„) â€“ dbus_bus_add_match()ã€‚æˆ‘ä»¬è¿›å…¥ç­‰å¾…å¾ªç¯åï¼Œåªéœ€è¦å¯¹ä¿¡å·åï¼Œä¿¡å·æ¥å£åè¿›è¡Œåˆ¤æ–­å°±å¯ä»¥åˆ†åˆ«å¤„ç†å„ç§ä¿¡å·äº†ã€‚åœ¨å„ä¸ªå¤„ç†åˆ†æ”¯ä¸Šã€‚æˆ‘ä»¬å¯ä»¥åˆ†ç¦»å‡ºæ¶ˆæ¯ä¸­çš„å‚æ•°ã€‚å¯¹å‚æ•°ç±»å‹è¿›è¡Œåˆ¤æ–­å’Œå…¶ä»–çš„å¤„ç†ã€‚
dbus_connection_read_write()
As long as the connection is open, this function will block until it can read or write, then read or write, then return #TRUE.
If the connection is closed, the function returns #FALSE.
dbus_connection_pop_message()
Returns the first-received message from the incoming message queue, removing it from the queue. The caller owns a reference to the returned message. If the queue is empty, returns #NULL.
dbus_connection_send()
Adds a message to the outgoing message queue. Does not block to write the message to the network; that happens asynchronously. To force the message to be written, call dbus_connection_flush(). Because this only queues the message, the only reason it can
fail is lack of memory. Even if the connection is disconnected, no error will be returned.
@param connection the connection.
@param message the message to write.
@param serial return location for message serial, or #NULL if you donâ€™t care
@returns #TRUE on success.
dbus_connection_send_with_reply()</p>

<p>Queues a message to send, as with dbus_connection_send(), but also returns a #DBusPendingCall used to receive a reply to the message. If no reply is received in the given timeout_milliseconds, this function expires the pending reply and generates a synthetic error reply (generated in-process, not by the remote application) indicating that a timeout occurred.
A #DBusPendingCall will see a reply message before any filters or registered object path handlers. See dbus_connection_dispatch() for details on when handlers are run.
A #DBusPendingCall will always see exactly one reply message, unless itâ€™s cancelled with dbus_pending_call_cancel().
If #NULL is passed for the pending_return, the #DBusPendingCall will still be generated internally, and used to track the message reply timeout. This means a timeout error will occur if no reply arrives, unlike with dbus_connection_send().
If -1 is passed for the timeout, a sane default timeout is used. -1 is typically the best value for the timeout for this reason, unless you want a very short or very long timeout. There is no way to avoid a timeout entirely, other than passing INT_MAX for the
timeout to mean â€œvery long timeout.â€ libdbus clamps an INT_MAX timeout down to a few hours timeout though.
@warning if the connection is disconnected, the #DBusPendingCall will be set to #NULL, so be careful with this.
@param connection the connection
@param message the message to send
@param pending_return return location for a #DBusPendingCall object, or #NULL if connection is disconnected
@param timeout_milliseconds timeout in milliseconds or -1 for default
@returns #FALSE if no memory, #TRUE otherwise.
dbus_message_is_signal()</p>

<p>Checks whether the message is a signal with the given interface and member fields. If the message is not #DBUS_MESSAGE_TYPE_SIGNAL, or has a different interface or member field, returns #FALSE.
dbus_message_iter_init()
Initializes a #DBusMessageIter for reading the arguments of the message passed in.
dbus_message_iter_next()
Moves the iterator to the next field, if any. If thereâ€™s no next field, returns #FALSE. If the iterator moves forward, returns #TRUE.
dbus_message_iter_get_arg_type()
Returns the argument type of the argument that the message iterator points to. If the iterator is at the end of the message, returns #DBUS_TYPE_INVALID. 
dbus_message_iter_get_basic()
Reads a basic-typed value from the message iterator. Basic types are the non-containers such as integer and string.
dbus_message_new_signal()
Constructs a new message representing a signal emission. Returns #NULL if memory canâ€™t be allocated for the message. A signal is identified by its originating object path, interface, and the name of the signal.
Path, interface, and signal name must all be valid (the D-Bus specification defines the syntax of these fields).
@param path the path to the object emitting the signal
@param interface the interface the signal is emitted from
@param name name of the signal
@returns a new DBusMessage, free with dbus_message_unref()
dbus_message_iter_init_append()
Initializes a #DBusMessageIter for appending arguments to the end of a message.
@param message the message
@param iter pointer to an iterator to initialize
dbus_message_iter_append_basic()
Appends a basic-typed value to the message. The basic types are the non-container types such as integer and string.
@param iter the append iterator
@param type the type of the value
@param value the address of the value
@returns #FALSE if not enough memory
dbus_message_new_method_call()
Constructs a new message to invoke a method on a remote object. Returns #NULL if memory canâ€™t be allocated for the message. The destination may be #NULL in which case no destination is set; this is appropriate when using D-Bus in a peer-to-peer context (no message bus). The interface may be #NULL, which means that if multiple methods with the given name exist it is undefined which one will be invoked.
The path and method names may not be #NULL.
Destination, path, interface, and method name canâ€™t contain any invalid characters (see the D-Bus specification).
@param destination name that the message should be sent to or #NULL
@param path object path the message should be sent to
@param interface interface to invoke method on, or #NULL
@param method method to invoke
@returns a new DBusMessage, free with dbus_message_unref()
dbus_bus_get()
Connects to a bus daemon and registers the client with it. If a connection to the bus already exists, then that connection is returned. The caller of this function owns a reference to the bus.
@param type bus type
@param error address where an error can be returned.
@returns a #DBusConnection with new ref
dbus_bus_request_name()
Asks the bus to assign the given name to this connection by invoking the RequestName method on the bus.
First you should know that for each bus name, the bus stores a queue of connections that would like to own it. Only one owns it at a time - called the primary owner. If the primary owner releases the name or disconnects, then the next owner in the queue atomically takes over.
So for example if you have an application org.freedesktop.TextEditor and multiple instances of it can be run, you can have all of them sitting in the queue. The first one to start up will receive messages sent to org.freedesktop.TextEditor, but if that one exits another will become the primary owner and receive messages.
The queue means you donâ€™t need to manually watch for the current owner to disappear and then request the name again.
@param connection the connection
@param name the name to request
@param flags flags
@param error location to store the error
@returns a result code, -1 if error is set
ç»™DBusConnectionèµ·åå­—(å‘½å) â€“ ä¸¤ä¸ªç›¸äº’é€šä¿¡çš„è¿æ¥(connection)ä¸èƒ½åŒå
å‘½åè§„åˆ™: xxx.xxx (zeng.xiaolong)
dbus_bus_add_match()
Adds a match rule to match messages going through the message bus. The â€œruleâ€ argument is the string form of a match rule.
@param connection connection to the message bus
@param rule textual form of match rule
@param error location to store any errors
dbus_pending_call_block()
Block until the pending call is completed. The blocking is as with dbus_connection_send_with_reply_and_block(); it does not enter the main loop or process other messages, it simply waits for the reply in question.
If the pending call is already completed, this function returns immediately.
@todo when you start blocking, the timeout is reset, but it should really only use time remaining since the pending call was created. This requires storing timestamps instead of intervals in the timeout
@param pending the pending call
dbus_pending_call_steal_reply()
Gets the reply, or returns #NULL if none has been received yet. Ownership of the reply message passes to the caller. This function can only be called once per pending call, since the reply message is tranferred to the caller.
@param pending the pending call
@returns the reply message or #NULL.
å®‰è£…D-Buså¯åœ¨å…¶å®˜æ–¹ç½‘ç«™ä¸‹è½½æºç ç¼–è¯‘ï¼Œåœ°å€ä¸ºhttp://dbus.freedesktop.orgã€‚æˆ–è€…åœ¨ç»ˆç«¯ä¸Šè¾“å…¥ä¸‹åˆ—æŒ‡ä»¤ï¼š</p>

<p>yum install dbus dbus-devel dbus-doc
å®‰è£…åï¼Œå¤´æ–‡ä»¶ä½äºâ€/usr/include/dbus-<ç‰ˆæœ¬å·>/dbus"ç›®å½•ä¸­ï¼Œç¼–è¯‘ä½¿ç”¨D-Busçš„ç¨‹åºæ—¶éœ€åŠ å…¥ç¼–è¯‘æŒ‡ä»¤"pkg-config --cflags --libs dbus-1"ã€‚</ç‰ˆæœ¬å·></p>

<p>D-Busçš„ç”¨ä¾‹
åœ¨ä½¿ç”¨GNOMEæ¡Œé¢ç¯å¢ƒçš„Linuxç³»ç»Ÿä¸­ï¼Œé€šå¸¸ç”¨GLibåº“æä¾›çš„å‡½æ•°æ¥ç®¡ç†æ€»çº¿ã€‚åœ¨æµ‹è¯•ä¸‹åˆ—ç”¨ä¾‹å‰ï¼Œé¦–å…ˆéœ€è¦å®‰è£…GTK+å¼€å‘åŒ…ï¼ˆè§22.3èŠ‚ï¼‰å¹¶é…ç½®ç¼–è¯‘ç¯å¢ƒã€‚è¯¥ç”¨ä¾‹ä¸€å…±åŒ…å«ä¸¤ä¸ªç¨‹åºæ–‡ä»¶ï¼Œæ¯ä¸ªç¨‹åºæ–‡ä»¶éœ€å•ç‹¬ç¼–è¯‘æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>

<p>1ï¼æ¶ˆæ¯å‘é€ç¨‹åº</p>

<p>â€œdbus-ding-send.câ€ç¨‹åºæ¯ç§’é€šè¿‡ä¼šè¯æ€»çº¿å‘é€ä¸€ä¸ªå‚æ•°ä¸ºå­—ç¬¦ä¸²Ding!çš„ä¿¡å·ã€‚è¯¥ç¨‹åºçš„æºä»£ç å¦‚ä¸‹ï¼š</p>

<p>include <glib.h> // åŒ…å«glibåº“
include &lt;dbus/dbus-glib.h&gt; // åŒ…å«
glibåº“ä¸­D-Busç®¡ç†åº“</glib.h></p>

<p>include <stdio.h>
static gboolean send_ding(DBusConnection *bus);// å®šä¹‰å‘é€æ¶ˆæ¯å‡½æ•°çš„åŸå‹
int main ()
{
GMainLoop *loop; // å®šä¹‰ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¯¹è±¡çš„æŒ‡é’ˆ
DBusConnection *bus; // å®šä¹‰æ€»çº¿è¿æ¥å¯¹è±¡çš„æŒ‡é’ˆ
DBusError error; // å®šä¹‰D-Busé”™è¯¯æ¶ˆæ¯å¯¹è±¡
loop = g_main_loop_new(NULL, FALSE); // åˆ›å»ºæ–°äº‹ä»¶å¾ªç¯å¯¹è±¡
dbus_error_init (&amp;error); // å°†é”™è¯¯æ¶ˆæ¯å¯¹è±¡è¿æ¥åˆ°D-Bus
// é”™è¯¯æ¶ˆæ¯å¯¹è±¡
bus = dbus_bus_get(DBUS_BUS_SESSION, &amp;error);// è¿æ¥åˆ°æ€»çº¿
if (!bus) { // åˆ¤æ–­æ˜¯å¦è¿æ¥é”™è¯¯
g_warning("è¿æ¥åˆ°D-Buså¤±è´¥: %s", error.message);
// ä½¿ç”¨GLibè¾“å‡ºé”™è¯¯è­¦å‘Šä¿¡æ¯
dbus_error_free(&amp;error); // æ¸…é™¤é”™è¯¯æ¶ˆæ¯
return 1;
}
dbus_connection_setup_with_g_main(bus, NULL);
// å°†æ€»çº¿è®¾ä¸ºæ¥æ”¶GLibäº‹ä»¶å¾ªç¯
g_timeout_add(1000, (GSourceFunc)send_ding, bus);
// æ¯éš”1000msè°ƒç”¨ä¸€æ¬¡send_ding()å‡½æ•°
// å°†æ€»çº¿æŒ‡é’ˆä½œä¸ºå‚æ•°
g_main_loop_run(loop); // å¯åŠ¨äº‹ä»¶å¾ªç¯
return 0;
}
static gboolean send_ding(DBusConnection *bus) // å®šä¹‰å‘
é€æ¶ˆæ¯å‡½æ•°çš„ç»†èŠ‚
{
DBusMessage *message; // åˆ›å»ºæ¶ˆæ¯å¯¹è±¡æŒ‡é’ˆ
message = dbus_message_new_signal("/com/burtonini/dbus/ding",
"com.burtonini.dbus.Signal",
"ding"); // åˆ›å»ºæ¶ˆæ¯å¯¹è±¡å¹¶æ ‡è¯†è·¯å¾„
dbus_message_append_args(message,
DBUS_TYPE_STRING, "ding!",
DBUS_TYPE_INVALID); //å°†å­—ç¬¦ä¸²Ding!å®šä¹‰ä¸ºæ¶ˆæ¯
dbus_connection_send(bus, message, NULL); // å‘é€è¯¥æ¶ˆæ¯
dbus_message_unref(message); // é‡Šæ”¾æ¶ˆæ¯å¯¹è±¡
g_print("ding!\n"); // è¯¥å‡½æ•°ç­‰åŒä¸æ ‡å‡†è¾“å…¥è¾“å‡º
return TRUE;
}
main()å‡½æ•°åˆ›å»ºä¸€ä¸ªGLibäº‹ä»¶å¾ªç¯ï¼Œè·å¾—ä¼šè¯æ€»çº¿çš„ä¸€ä¸ªè¿æ¥ï¼Œå¹¶å°†D-Busäº‹ä»¶å¤„ç†é›†æˆåˆ°GLibäº‹ä»¶å¾ªç¯ä¹‹ä¸­ã€‚ç„¶åå®ƒåˆ›å»ºäº†ä¸€ä¸ªåä¸ºsend_ding()å‡½æ•°ä½œä¸ºé—´éš”ä¸ºä¸€ç§’çš„è®¡æ—¶å™¨ï¼Œå¹¶å¯åŠ¨äº‹ä»¶å¾ªç¯ã€‚send_ding()å‡½æ•°æ„é€ ä¸€ä¸ªæ¥è‡ªäºå¯¹è±¡è·¯å¾„"/com/burtonini/dbus/ding"å’Œæ¥å£"com.burtonini.dbus.Signal"çš„æ–°çš„Dingä¿¡å·ã€‚ç„¶åï¼Œå­—ç¬¦ä¸²Ding!ä½œä¸ºå‚æ•°æ·»åŠ åˆ°ä¿¡å·ä¸­å¹¶é€šè¿‡æ€»çº¿å‘é€ã€‚åœ¨æ ‡å‡†è¾“å‡ºä¸­ä¼šæ‰“å°ä¸€æ¡æ¶ˆæ¯ä»¥è®©ç”¨æˆ·çŸ¥é“å‘é€äº†ä¸€ä¸ªä¿¡å·ã€‚</stdio.h></p>

<p>2ï¼æ¶ˆæ¯æ¥æ”¶ç¨‹åº</p>

<p>dbus-ding-listen.cç¨‹åºé€šè¿‡ä¼šè¯æ€»çº¿æ¥æ”¶dbus-ding-send.cç¨‹åºå‘é€åˆ°æ¶ˆæ¯ã€‚è¯¥ç¨‹åºçš„æºä»£ç å¦‚ä¸‹ï¼š</p>

<p>include <glib.h> // åŒ…å«glibåº“
include &lt;dbus/dbus-glib.h&gt; // åŒ…å«glibåº“ä¸­D-Busç®¡ç†åº“
static DBusHandlerResult signal_filter // å®šä¹‰æ¥æ”¶æ¶ˆæ¯å‡½æ•°çš„åŸå‹
(DBusConnection *connection, DBusMessage *message, void *user_data);
int main()
{
GMainLoop *loop; // å®šä¹‰ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¯¹è±¡çš„æŒ‡é’ˆ
DBusConnection *bus; // å®šä¹‰æ€»çº¿è¿æ¥å¯¹è±¡çš„æŒ‡é’ˆ
DBusError error; // å®šä¹‰D-Busé”™è¯¯æ¶ˆæ¯å¯¹è±¡
loop = g_main_loop_new(NULL, FALSE); // åˆ›å»ºæ–°äº‹ä»¶å¾ªç¯å¯¹è±¡
dbus_error_init(&amp;error); // å°†é”™è¯¯æ¶ˆæ¯å¯¹è±¡è¿æ¥åˆ°D-Bus
// é”™è¯¯æ¶ˆæ¯å¯¹è±¡
bus = dbus_bus_get(DBUS_BUS_SESSION, &amp;error); // è¿æ¥åˆ°æ€»çº¿
if (!bus) { // åˆ¤æ–­æ˜¯å¦è¿æ¥é”™è¯¯
g_warning("è¿æ¥åˆ°D-Buså¤±è´¥: %s", error.message);
// ä½¿ç”¨GLibè¾“å‡ºé”™è¯¯è­¦å‘Šä¿¡æ¯
dbus_error_free(&amp;error); // æ¸…é™¤é”™è¯¯æ¶ˆæ¯
return 1;
}
dbus_connection_setup_with_g_main(bus, NULL);
// å°†æ€»çº¿è®¾ä¸ºæ¥æ”¶GLibäº‹ä»¶å¾ªç¯
dbus_bus_add_match(bus, "type='signal',interface
='com.burtonini.dbus.Signal'"); // å®šä¹‰åŒ¹é…å™¨
dbus_connection_add_filter(bus, signal_filter, loop, NULL);
// è°ƒç”¨å‡½æ•°æ¥æ”¶æ¶ˆæ¯
g_main_loop_run(loop); // å¯åŠ¨äº‹ä»¶å¾ªç¯
return 0;
}
static DBusHandlerResult // å®šä¹‰æ¥æ”¶æ¶ˆæ¯å‡½æ•°çš„ç»†èŠ‚
signal_filter (DBusConnection *connection,
DBusMessage *message, void *user_data)
{
GMainLoop *loop = user_data; // å®šä¹‰äº‹ä»¶å¾ªç¯å¯¹è±¡çš„æŒ‡é’ˆï¼Œå¹¶ä¸ä¸»å‡½æ•°ä¸­çš„åŒæ­¥
if (dbus_message_is_signal // æ¥æ”¶è¿æ¥æˆåŠŸæ¶ˆæ¯ï¼Œåˆ¤æ–­æ˜¯å¦è¿æ¥å¤±è´¥
(message, DBUS_INTERFACE_ORG_FREEDESKTOP_LOCAL,
"Disconnected")) {
g_main_loop_quit (loop); // é€€å‡ºä¸»å¾ªç¯
return DBUS_HANDLER_RESULT_HANDLED;
}
if (dbus_message_is_signal(message, "com.burtonini.dbus.Signal",
"Ping")) {
// æŒ‡å®šæ¶ˆæ¯å¯¹è±¡è·¯å¾„ï¼Œåˆ¤æ–­æ˜¯å¦æˆåŠŸ
DBusError error; // å®šä¹‰é”™è¯¯å¯¹è±¡
char *s;
dbus_error_init(&amp;error); // å°†é”™è¯¯æ¶ˆæ¯å¯¹è±¡è¿æ¥åˆ°D-Busé”™è¯¯
// æ¶ˆæ¯å¯¹è±¡
if (dbus_message_get_args // æ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æœ‰é”™è¯¯
(message, &amp;error, DBUS_TYPE_STRING, &amp;s,
DBUS_TYPE_INVALID)) {
g_print("æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯: %s\n", s); // è¾“å‡ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯
dbus_free (s); // æ¸…é™¤è¯¥æ¶ˆæ¯
}
else { // æœ‰é”™è¯¯æ—¶æ‰§è¡Œä¸‹åˆ—è¯­å¥
g_print("æ¶ˆæ¯å·²æ”¶åˆ°ï¼Œä½†æœ‰é”™è¯¯æç¤º: %s\n", error.message);
dbus_error_free (&amp;error);
}
return DBUS_HANDLER_RESULT_HANDLED;
}
return DBUS_HANDLER_RESULT_NOT_YET_HANDLED;
}
è¯¥ç¨‹åºä¾¦å¬dbus-ping-send.cç¨‹åºæ­£åœ¨å‘å‡ºçš„ä¿¡å·ã€‚main()å‡½æ•°å’Œå‰é¢ä¸€æ ·å¯åŠ¨ï¼Œåˆ›å»ºä¸€ä¸ªåˆ°æ€»çº¿çš„è¿æ¥ã€‚ç„¶åå®ƒå£°æ˜æ„¿æ„åœ¨ä½¿ç”¨com.burtonini.dbus.Signalæ¥å£çš„ä¿¡å·è¢«å‘é€æ—¶å¾—åˆ°é€šçŸ¥ï¼Œå°†signal_filter()å‡½æ•°è®¾ç½®ä¸ºé€šçŸ¥å‡½æ•°ï¼Œç„¶åè¿›å…¥äº‹ä»¶å¾ªç¯ã€‚å½“æ»¡è¶³åŒ¹é…çš„æ¶ˆæ¯è¢«å‘é€æ—¶ï¼Œsignal_func()å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚</glib.h></p>

<p>å¦‚æœéœ€è¦ç¡®å®šåœ¨æ¥æ”¶æ¶ˆæ¯æ—¶å¦‚ä½•å¤„ç†ï¼Œå¯é€šè¿‡æ£€æµ‹æ¶ˆæ¯å¤´å®ç°ã€‚è‹¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºæ€»çº¿æ–­å¼€ä¿¡å·ï¼Œåˆ™ä¸»äº‹ä»¶å¾ªç¯å°†è¢«ç»ˆæ­¢ï¼Œå› ä¸ºç›‘å¬çš„æ€»çº¿å·²ç»ä¸å­˜åœ¨äº†ã€‚è‹¥æ”¶åˆ°å…¶ä»–çš„æ¶ˆæ¯ï¼Œé¦–å…ˆå°†æ”¶åˆ°çš„æ¶ˆæ¯ä¸æœŸå¾…çš„æ¶ˆæ¯è¿›è¡Œæ¯”è¾ƒï¼Œä¸¤è€…ç›¸åŒåˆ™è¾“å‡ºå…¶ä¸­å‚æ•°ï¼Œå¹¶é€€å‡ºç¨‹åºã€‚ä¸¤è€…ä¸ç›¸åŒåˆ™å‘ŠçŸ¥æ€»çº¿å¹¶æ²¡æœ‰å¤„ç†è¯¥æ¶ˆæ¯ï¼Œè¿™æ ·æ¶ˆæ¯ä¼šç»§ç»­ä¿ç•™åœ¨æ€»çº¿ä¸­ä¾›åˆ«çš„ç¨‹åºå¤„ç†ã€‚
åŸæ–‡ç½‘å€: http://www.cnblogs.com/wzh206/archive/2010/05/13/1734901.html</p>

<p>[DBUS èµ„æº]
(http://www.cnblogs.com/wzh206/archive/2010/05/13/1734910.html)
ï¼ˆ1ï¼‰Connect desktop apps using D-BUS:http://www-128.ibm.com/developerworks/linux/library/l-dbus.html?ca=dgr-lnxw95D-BUS.
ä¸€ä¸ªå¤–å›½ç‰›äººå†™çš„æœ‰å…³DBUSçš„ç®€ä»‹ï¼Œé™„æœ‰ç®€å•çš„ä¾‹ç¨‹ï¼Œä½†ä¾‹ç¨‹éœ€è¦ç¨åšä¿®æ”¹æ‰èƒ½ç¼–è¯‘é€šè¿‡ï¼Œä¿®æ”¹åçš„å‡½æ•°signal_filterå’Œsend_pingå¦‚ä¸‹:
ï¼ˆ2ï¼‰http://hi.baidu.com/zengzhaonong/blog/item/670b98d6e63ae42c07088bae.html
è¿™é‡Œçš„ä¾‹å­ç»™å‡ºäº†DBusä¸Šå‡ ç§æ¶ˆæ¯çš„å‘é€ã€æ¥æ”¶ç¨‹åºæ¡†æ¶ï¼Œä¾‹å­å¾ˆå®¹æ˜“çœ‹æ˜ç™½ï¼Œä¸€èˆ¬åœ¨æ­¤æ¡†æ¶ä¸Šåšäº›ä¿®æ”¹å³å¯å¾—åˆ°è‡ªå·±éœ€è¦çš„ä»£ç ã€‚
ï¼ˆ3ï¼‰http://blog.csdn.net/fmddlmyy/archive/2008/12/23/3585730.aspx
è¿™ä¸ªåšå®¢çš„åšä¸»æ­£å‡†å¤‡è¯¦ç»†æ·±å…¥çš„ä»‹ç»DBusçš„æ–¹æ–¹é¢é¢ï¼Œåšä¸»åˆšå¼€å§‹è®¨è®ºDBusä¸ä¹…ï¼Œåšå®¢è¿˜åœ¨æŒç»­æ›´æ–°ä¸­ï¼Œä¼°è®¡åšä¸»å·²ç»åœ¨DBusä¸Šå·²ç»æœ‰æ·±åšçš„åŠŸåº•ï¼Œè¯·ç‰¹åˆ«å…³æ³¨ ï¼šã€‹
ï¼ˆ4ï¼‰http://blog.chinaunix.net/u1/58649/showart_462468.html
è¿™é‡Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå…¨çš„ä¾‹å­ï¼Œ600å¤šè¡Œçš„ç¨‹åºæ¶‰åŠäº†DBusçš„æ–¹æ–¹é¢é¢ï¼Œæœ‰æé«˜çš„å‚è€ƒä»·å€¼ã€‚
ï¼ˆ5ï¼‰http://blog.csdn.net/cuijpus
è¿™ä¸ªåšå®¢çš„åšä¸»æ˜¯åšæ‰‹æœºå¼€å‘çš„ï¼Œåœ¨DBusä¸Šä¹Ÿæœ‰å¾ˆæ·±çš„åŠŸåº•ï¼Œä¸€äº›ä¾‹ç¨‹å¾ˆå€¼å¾—å­¦ä¹ ã€‚
ï¼ˆ6ï¼‰freedesktop.org - Software-dbus.url
DBus Homeï¼Œè¿™ä¸ªæ˜¯æœ€é‡è¦ä¹Ÿæ˜¯æœ€æœ‰ä»·å€¼çš„å‚è€ƒèµ„æ–™ï¼ŒDBusçš„ç›¸å…³æºä»£ç å’Œæ–‡æ¡£éƒ½åœ¨è¿™é‡Œï¼Œå¦å¤–ç½‘ç«™è¿˜ç»™å‡ºäº†ä¸€äº›ä½¿ç”¨DBusçš„å¼€æ”¾æºä»£ç é¡¹ç›®åˆ—è¡¨ï¼Œå¦‚æœä½ ç¼–å†™DBusæŸä¸€æ–¹é¢çš„ä»£ç æ—¶é‡åˆ°å›°æƒ‘ï¼Œç½‘ä¸Šåˆæ‰¾ä¸åˆ°å¯ä¾›å‚è€ƒçš„ä¾‹å­ï¼Œåˆ°è¿™äº›open sourceä¸­å»serchç›¸å…³æºä»£ç æˆ–è®¸æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ•ˆçš„æ–¹æ³•ã€‚
åŸæ–‡åœ°å€ http://cid-121d380d29ebce85.spaces.live.com/Blog/cns!121D380D29EBCE85!422.entry?fl=cat</p>

<p>DBUSæ˜¯å®è´¨ä¸Šä¸€ä¸ªé€‚ç”¨äºæ¡Œé¢åº”ç”¨çš„è¿›ç¨‹é—´çš„é€šè®¯æœºåˆ¶ï¼Œå³æ‰€è°“çš„IPCæœºåˆ¶ã€‚é€‚åˆåœ¨åŒä¸€å°æœºå™¨ï¼Œä¸é€‚åˆäºINTERNETçš„IPCæœºåˆ¶ã€‚DBUSä¸æ˜¯ä¸€ä¸ªä¸ºæ‰€æœ‰å¯èƒ½çš„åº”ç”¨çš„é€šç”¨çš„IPCæœºåˆ¶ï¼Œä¸æ”¯æŒå…¶ä»–IPCæœºåˆ¶çš„å¾ˆå¤šç‰¹æ€§ã€‚DBUSæä¾›äº†ä¸€ä¸ªä½æ—¶å»¶ã€ä½æ¶ˆè€—çš„IPCé€šè®¯ï¼Œå› ä¸ºå®ƒé‡‡ç”¨äº†äºŒè¿›åˆ¶çš„æ•°æ®äº¤æ¢åè®®ï¼Œä¸éœ€è¦è½¬æ¢æˆæ–‡æœ¬åŒ–çš„æ•°æ®è¿›è¡Œäº¤æ¢ï¼ŒDBUSæä¾›äº†é¢å‘å¤šé‡å¯¹è±¡ç³»ç»Ÿçš„åŒ…è£…ï¼Œå¯ä»¥åœ¨åŸæœ‰çš„é¢å‘å¯¹è±¡çš„åº”ç”¨æ¡†æ¶ä¸‹ä½¿ç”¨DBUSï¼Œä¸éœ€è¦å­¦ä¹ æ–°çš„æ¦‚å¿µå’Œè§„èŒƒç­‰ã€‚</p>

<p>DBUSæ˜¯æ”¯æŒä¸€å¯¹ä¸€å’Œå¤šå¯¹å¤šçš„å¯¹ç­‰é€šè®¯ï¼Œåœ¨ä¸€å¯¹ä¸€çš„ç›´æ¥é€šè®¯æ—¶ï¼Œä¸¤ä¸ªåº”ç”¨ç¨‹åºè¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™æ˜¯æœ€ç®€å•çš„å·¥ä½œæ–¹å¼ã€‚åœ¨å¤šå¯¹å¤šçš„é€šè®¯æ—¶ï¼Œè¿™å°±éœ€è¦ä¸€ä¸ªå«DBUSåå°çš„è§’è‰²å»åˆ†è½¬ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå‘æ¶ˆæ¯ç»™å¦å¤–ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå…ˆåˆ°è¾¾åå°ï¼Œå†è®©åå°å°†ä¿¡æ¯å‘é€åˆ°ç›®çš„åº”ç”¨ç¨‹åºã€‚åœ¨è¿™é‡ŒDBUSåå°å°±å……å½“ç€ä¸€ä¸ªè·¯ç”±å™¨çš„è§’è‰²ã€‚</p>

<p>DBUSåŒ…å«äº†ç³»ç»Ÿæ›´æ–°é€šçŸ¥ï¼Œå¦‚æ’å…¥æ–°è®¾å¤‡é€šçŸ¥ã€æ–°è½¯ä»¶å®‰è£…é€šçŸ¥ç­‰ï¼Œå’Œæ¡Œé¢åº”ç”¨çš„äº¤äº’åä½œèƒ½åŠ›ï¼Œå¯ä»¥ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿç›‘æ§å™¨å’Œé…ç½®æœåŠ¡å™¨ã€‚</p>

<p>Dbusç”±å¯¹è±¡ã€æ¶ˆæ¯ã€è¿æ¥ã€Dbusåå°å‡ éƒ¨åˆ†ç»„æˆã€‚</p>

<p>å¯¹è±¡æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¤„ç†æ¶ˆæ¯çš„å®ä½“ã€‚å¯¹è±¡æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ï¼Œåœ¨æ¯ä¸ªæ¥å£æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªçš„æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•å®ç°äº†å…·ä½“çš„æ¶ˆæ¯å¤„ç†ã€‚åœ¨ä¸€å¯¹ä¸€çš„é€šè®¯ä¸­ï¼Œå¯¹è±¡é€šè¿‡ä¸€ä¸ªè¿æ¥ç›´æ¥å’Œå¦ä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè¿æ¥èµ·æ¥ã€‚åœ¨å¤šå¯¹å¤šçš„é€šè®¯ä¸­ï¼Œå¯¹è±¡é€šè¿‡ä¸€ä¸ªè¿æ¥å’ŒDbusåå°è¿›ç¨‹è¿æ¥èµ·æ¥ã€‚å¯¹è±¡æœ‰ä¸€ä¸ªè·¯å¾„ç”¨äºæŒ‡æ˜è¯¥å¯¹è±¡çš„å­˜æ”¾ä½ç½®ï¼Œæ¶ˆæ¯ä¼ é€’æ—¶é€šè¿‡è¯¥è·¯å¾„æ‰¾åˆ°è¯¥å¯¹è±¡ã€‚</p>

<p>å®¢æˆ·ç«¯åº”ç”¨æ˜¯ä¸€ä¸ªæ¡Œé¢åº”ç”¨ç¨‹åºï¼Œæ˜¯è¯·æ±‚æ¶ˆæ¯çš„å‘èµ·è€…ã€‚å®¢æˆ·ç«¯åº”ç”¨é€šè¿‡å’Œè‡ªèº«çš„ç›¸è¿çš„ä¸€ä¸ªè¿æ¥å°†è¯·æ±‚æ¶ˆæ¯å‘é€å‡ºå»ï¼Œä¹Ÿé€šè¿‡è¯¥è¿æ¥æ¥æ”¶å›åº”çš„æ¶ˆæ¯ã€é”™è¯¯æ¶ˆæ¯ã€ç³»ç»Ÿæ›´æ–°æ¶ˆæ¯ç­‰ã€‚åœ¨ä¸€å¯¹ä¸€çš„é€šè®¯ä¸­ï¼Œè¯·æ±‚æ¶ˆæ¯ç›´æ¥åˆ°è¾¾å¯¹è±¡ã€‚åœ¨å¤šå¯¹å¤šçš„é€šè®¯ä¸­ï¼Œè¯·æ±‚æ¶ˆæ¯å…ˆåˆ°è¾¾Dbusåå°ï¼ŒDbusåå°å°†æ¶ˆæ¯è½¬å‘åˆ°ç›®çš„å¯¹è±¡ã€‚</p>

<p>è¿æ¥æ˜¯ä¸€ä¸ªåŒå‘çš„æ¶ˆæ¯ä¼ é€’é€šé“ã€‚ä¸€ä¸ªè¿æ¥å°†å¯¹è±¡å’ŒDbusåå°æˆ–å®¢æˆ·ç«¯åº”ç”¨è¿æ¥èµ·æ¥ï¼Œè¿æ¥æ”¯æŒéé˜»å¡å¼çš„å¼‚æ­¥æ¶ˆæ¯å‘é€å’Œé˜»å¡å¼çš„åŒæ­¥æ¶ˆæ¯å‘é€ã€‚æ¶ˆæ¯é€šè¿‡è¿æ¥åˆ°è¾¾ç›®çš„ç«¯åï¼Œè¿æ¥ä¼šå°†æŒ‚èµ·åœ¨è¯¥è¿æ¥ä¸Šçš„è¿›ç¨‹å”¤é†’ï¼Œç”±è¯¥è¿›ç¨‹å°†æ¶ˆæ¯å–èµ°ã€‚æ¯ä¸ªè¿æ¥éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åå­—å’Œå¯é€‰çš„å…¶ä»–å¤šä¸ªåå­—ï¼Œç”¨äºåœ¨å¤šå¯¹å¤šé€šè®¯æ—¶æŒ‡æ˜æ¶ˆæ¯çš„å‘é€è€…å’Œæ¥æ”¶è€…ã€‚</p>

<p>è¿æ¥åŸºäºæ“ä½œç³»ç»Ÿæä¾›çš„é€šè®¯ç«¯å£å®ç°æ¶ˆæ¯çš„äº¤æ¢ï¼Œç°åœ¨åŸºäºçš„é€šè®¯ç«¯å£æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯UNIXçš„socketã€TCP/IPã€ç®¡é“ï¼ˆè°ƒè¯•æ—¶ç”¨ï¼‰ã€‚é€šè®¯ç«¯å£æ‹¥æœ‰ä¸€ä¸ªåœ°å€ï¼ŒæœåŠ¡å™¨åœ¨è¿™ä¸ªåœ°å€ä¸Šç›‘å¬ï¼Œå®¢æˆ·ç«¯åˆ™è¿æ¥åˆ°è¿™ä¸ªåœ°å€ä¸Šã€‚</p>

<p>æ¶ˆæ¯æ˜¯Dbusçš„IPCæœºåˆ¶ä¸­çš„ä¸€ä¸ªä¿¡æ¯ä¼ é€’åª’ä»‹ã€‚è°ƒç”¨è€…å°†è°ƒç”¨çš„æ–¹æ³•ã€æ–¹æ³•çš„å‚æ•°æ‰“åŒ…è¿›ä¸€ä¸ªæ¶ˆæ¯ï¼Œæ¥æ”¶è€…å°†æ–¹æ³•å’Œå‚æ•°ä»æ¶ˆæ¯ä¸­è§£åŒ…å‡ºæ¥ï¼Œæ‰§è¡Œè¿™ä¸ªæ–¹æ³•è°ƒç”¨ã€‚æ‰§è¡Œå®Œåï¼Œå°†ç»“æœæ‰“åŒ…è¿›è¿”å›æ¶ˆæ¯ä¸­ï¼Œè¿”å›ç»™è°ƒç”¨è€…ã€‚æ¶ˆæ¯æœ‰å››ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯æ–¹æ³•è°ƒç”¨æ¶ˆæ¯ã€ç»“æœè¿”å›æ¶ˆæ¯ã€é”™è¯¯æ¶ˆæ¯ã€ä¿¡å·æ¶ˆæ¯ã€‚è¿™é‡Œçš„ä¿¡å·æ¶ˆæ¯æ˜¯ä¸»åŠ¨å‘é€çš„äº‹ä»¶ï¼Œå¦‚æ–°è®¾å¤‡æ’å…¥ã€æ–‡ä»¶æ›´æ”¹çš„äº‹ä»¶ç­‰ã€‚</p>

<p>Dbusåå°æ˜¯åœ¨å¤šå¯¹å¤šé€šè®¯æ—¶ç”¨æ¥è½¬å‘æ¶ˆæ¯ï¼Œç®¡ç†è¿æ¥çš„ä¸€ä¸ªåå°è¿›ç¨‹ã€‚æ¯ä¸ªDbusåå°éƒ½å’Œå¤šä¸ªè¿æ¥å…³è”ï¼Œå…¶å†…éƒ¨ç»´æŠ¤äº†è¿æ¥åå’Œè¿æ¥å®ä½“çš„æ˜ å°„å…³ç³»ã€‚Dbusåå°å°±è±¡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œå°†ä»å‘é€è€…è¿æ¥å¾—åˆ°çš„æ¶ˆæ¯è½¬å‘åˆ°ç”±æ¶ˆæ¯ä¸­çš„æ¥æ”¶è€…è¿æ¥åæŒ‡å®šçš„æ¥æ”¶è€…è¿æ¥ä¸­ã€‚</p>

<p>Dbusåå°æœ‰å¤šä¸ªã€‚æœ‰ä¸€ä¸ªç”¨äºå’Œç³»ç»Ÿé€šè®¯ï¼Œç›‘æ§ç³»ç»Ÿæ›´æ–°äº‹ä»¶ï¼Œå…¶ç±»å‹ä¸ºDBUS_BUS_SYSTEMçš„Dbusåå°ã€‚æ¯ä¸ªæ¡Œé¢ä¼šè¯ï¼ˆsessionï¼‰æœ‰ä¸€ä¸ªç”¨äºå¤šä¸ªæ¡Œé¢åº”ç”¨ä¹‹é—´ç›¸äº’é€šè®¯ï¼Œå…¶ç±»å‹ä¸ºDBUS_BUS_SESSIONçš„Dbusåå°ã€‚ä¸€èˆ¬è‡³å°‘æœ‰ä¸¤ä¸ªDbusåå°ï¼Œä¸€ä¸ªç³»ç»Ÿç”¨ï¼Œä¸€ä¸ªæ¡Œé¢ä¼šè¯ç”¨ã€‚ç³»ç»Ÿç”¨çš„Dbusåå°åªèƒ½å¤„ç†ç³»ç»Ÿçš„æ¶ˆæ¯ï¼Œæ¡Œé¢ä¼šè¯ç”¨çš„Dbusåå°åªèƒ½å¤„ç†æ¡Œé¢ä¼šè¯åº”ç”¨çš„æ¶ˆæ¯ã€‚</p>

<p>1ã€å®¢æˆ·ç«¯ã€‚</p>

<p>åœ¨å®¢æˆ·ç«¯ä½¿ç”¨DBUSæ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆï¼Œä»DBUS_BUS_SESSIONç±»å‹çš„DBUSåå°è·å¾—ä¸€ä¸ªè¿æ¥ï¼Œå†ä»è¿™ä¸ªè¿æ¥åˆ›å»ºå¾—åˆ°ä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»¥åå¯¹å¯¹è±¡çš„æ‰€æœ‰æ“ä½œéƒ½å°†é€šè¿‡è¿™ä¸ªä»£ç†æ¥å®Œæˆã€‚</p>

<p>å¾—åˆ°æœåŠ¡ä»£ç†åï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„å„ä¸ªåœ°æ–¹é€šè¿‡å¯¹è±¡ä»£ç†çš„æ–¹æ³•ä½¿ç”¨å‡½æ•°æƒ³å¯¹è±¡å‘å‡ºä¸€ä¸ªæ–¹æ³•è°ƒç”¨çš„æ¶ˆæ¯ã€‚è¯·æ±‚å¯¹è±¡çš„æœåŠ¡ï¼Œå¯ä»¥å‘é€å¼‚æ­¥çš„æ–¹æ³•ï¼ˆå¼‚æ­¥æœåŠ¡ï¼‰ï¼Œä¹Ÿå¯ä»¥å‘é€åŒæ­¥æ–¹æ³•ï¼ˆåŒæ­¥æœåŠ¡ï¼‰ï¼Œæ–¹æ³•æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥æœ‰å¯¹è±¡å®šä¹‰ã€‚</p>

<p>2ã€æœåŠ¡ç«¯ã€‚</p>

<p>åœ¨æœåŠ¡å™¨è¿›ç¨‹å¯åŠ¨åï¼Œè°ƒç”¨å‡½æ•°dbus_g_object_type_install_infoå°†å¯¹è±¡çš„å®‰è£…ä¿¡æ¯ç»“æ„å‘Šè¯‰DBUSï¼Œéšåï¼Œä»DBUS_BUS_SESSIONç±»å‹çš„DBUSè·å¾—ä¸€ä¸ªè¿æ¥ï¼Œå†ä»è¿™ä¸ªè¿æ¥å¾—åˆ°ä¸€ä¸ªDBUSå¯¹è±¡çš„ä»£ç†ã€‚é€šè¿‡è¿™ä¸ªDBUSä»£ç†è°ƒç”¨æ–¹æ³•RequestNameä¸ºè¿™ä¸ªè¿æ¥å¾—åˆ°ä¸€ä¸ªå‘½åï¼Œå®¢æˆ·ç«¯åº”ç”¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªåå­—å°†è¯·æ±‚æ¶ˆæ¯å‘é€åˆ°è¿æ¥ã€‚æ¥ç€ï¼ŒæœåŠ¡å™¨è¿›ç¨‹åˆ›å»ºä¸€ä¸ªæŒ‡å®šç±»å‹çš„å¯¹è±¡ï¼ˆglibå¯¹è±¡ï¼‰ã€‚</p>

<p>å…¶ä¸­å®‰è£…ä¿¡æ¯ç”±XMLæ–‡ä»¶ï¼Œé€šè¿‡dbus-binding-toolè½¬æ¢æˆå¯¹è±¡çš„å¤´æ–‡ä»¶ã€‚</p>

<p>3ã€æ¶ˆæ¯ã€‚</p>

<p>æ¶ˆæ¯ç”±æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ç»„æˆã€‚æ¶ˆæ¯å¤´ç”±æ¶ˆæ¯çš„å›ºæœ‰å­—æ®µä¿¡æ¯ç»„æˆã€‚æ¶ˆæ¯ä½“ç”±ä¸€ä¸²å­—ç¬¦ä¸²å€¼ç»„æˆã€‚æ¶ˆæ¯ä½“çš„æ¯ä¸ªå­—ç¬¦ä¸²å€¼çš„æ„ä¹‰ç”±æ¶ˆæ¯å¤´ä¸­çš„æè¿°æŒ‡å®šï¼Œæ¶ˆæ¯å¤´çš„é•¿åº¦å¿…é¡»æ˜¯8çš„å€æ•°ï¼Œç›¸åº”çš„ï¼Œæ¶ˆæ¯ä½“ç”±8çš„å€æ•°å¤„å¼€å§‹ã€‚</p>

<p>============================================================</p>

<p>D-Busä½“ç³»</p>

<p>æœ‰å¾ˆå¤šç§IPCæˆ–è€…ç½‘ç»œé€šä¿¡ç³»ç»Ÿï¼Œå¦‚ï¼šCORBA, DCE, DCOM, DCOP, XML-RPC, SOAP, MBUS, Internet Communications Engine (ICE)ç­‰ç­‰ï¼Œå¯èƒ½ä¼šæœ‰æ•°ç™¾ç§ï¼Œdbusçš„ç›®çš„ä¸»è¦æ˜¯ä¸‹é¢ä¸¤ç‚¹ï¼š
1.åœ¨åŒä¸€ä¸ªæ¡Œé¢ä¼šè¯ä¸­ï¼Œè¿›è¡Œæ¡Œé¢åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šè®¯
2.æ¡Œé¢ç¨‹åºä¸å†…æ ¸æˆ–è€…å®ˆæŠ¤è¿›ç¨‹çš„é€šä¿¡ã€‚</p>

<p>Dbusæ˜¯ä¸€å¥—è¿›ç¨‹é€šä¿¡ä½“ç³»ï¼Œå®ƒæœ‰ä»¥ä¸‹å‡ å±‚ï¼š
1.libdbusåº“ï¼Œæä¾›ç»™å„ä¸ªåº”ç”¨ç¨‹åºè°ƒç”¨ï¼Œä½¿åº”ç”¨ç¨‹åºå…·æœ‰é€šä¿¡å’Œæ•°æ®äº¤æ¢çš„èƒ½åŠ›ï¼Œä¸¤ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥è¿›è¡Œé€šä¿¡ï¼Œå°±åƒæ˜¯ä¸€æ¡socketé€šé“ï¼Œä¸¤ä¸ªç¨‹åºä¹‹é—´å»ºç«‹é€šé“ä¹‹åï¼Œå°±å¯ä»¥é€šè®¯äº†ã€‚
2.æ¶ˆæ¯å®ˆæŠ¤è¿›ç¨‹ï¼Œåœ¨libdbusçš„åŸºç¡€ä¸Šåˆ›å»ºï¼Œå¯ä»¥ç®¡ç†å¤šä¸ªåº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½å’Œæ¶ˆæ¯å®ˆæŠ¤è¿›ç¨‹å»ºç«‹dbusçš„é“¾æ¥ï¼Œç„¶åç”±æ¶ˆæ¯å®ˆæŠ¤è¿›ç¨‹è¿›è¡Œæ¶ˆæ¯çš„åˆ†æ´¾ã€‚
3.å„ç§åŒ…è£…åº“ï¼Œæœ‰libdbus-glibï¼Œlibdbus-qtç­‰ç­‰ï¼Œç›®çš„æ˜¯å°†dbusçš„åº•å±‚apiè¿›è¡Œä¸€ä¸‹å°è£…ã€‚</p>

<p>ä¸‹é¢æœ‰ä¸€å¼ å›¾å¯ä»¥å¾ˆæ–¹ä¾¿è¯´æ˜dbusçš„ä½“ç³»ç»“æ„ã€‚
dbus</p>

<p>dbusä¸­çš„æ¶ˆæ¯ç”±ä¸€ä¸ªæ¶ˆæ¯å¤´ï¼ˆæ ‡è¯†æ˜¯å“ªä¸€ç§æ¶ˆæ¯ï¼‰å’Œæ¶ˆæ¯æ•°æ®ç»„æˆï¼Œæ¯”socketçš„æµå¼æ•°æ®æ›´æ–¹ä¾¿ä¸€äº›ã€‚bus daemon å°±åƒæ˜¯ä¸€ä¸ªè·¯ç”±å™¨ï¼Œä¸å„ä¸ªåº”ç”¨ç¨‹åºè¿›è¡Œè¿æ¥ï¼Œåˆ†æ´¾è¿™äº›æ¶ˆæ¯ã€‚bus daemon åœ¨ä¸€å°æœºå™¨ä¸Šæœ‰å¤šä¸ªå®ä¾‹ï¼Œç¬¬ä¸€ä¸ªå®ä¾‹æ˜¯å…¨å±€çš„å®ä¾‹ï¼Œç±»ä¼¼äºsendmailå’Œæˆ–è€…apacheï¼Œè¿™ä¸ªå®ä¾‹æœ‰å¾ˆä¸¥æ ¼çš„å®‰å…¨é™åˆ¶ï¼Œåªæ¥å—ä¸€äº›ç‰¹å®šçš„ç³»ç»Ÿæ¶ˆæ¯ï¼Œç”¨äºç³»ç»Ÿé€šä¿¡ã€‚å…¶ä»–bus daemonæ˜¯ä¸€äº›ä¼šè¯ï¼Œç”¨äºç”¨æˆ·ç™»å½•ä¹‹åï¼Œåœ¨å½“å‰ä¼šè¯(session)ä¸­è¿›è¡Œçš„é€šè®¯ã€‚ç³»ç»Ÿçš„bus daemon å’Œä¼šè¯çš„bus daemon æ˜¯åˆ†å¼€çš„ï¼Œå½¼æ­¤ä¸ä¼šäº’ç›¸å½±å“ï¼Œä¼šè¯bus daemon ä¸ä¼šå»è°ƒç”¨ç³»ç»Ÿçš„bus daemon ã€‚</p>

<p>Native Objects and Object Paths
åœ¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œéƒ½å®šä¹‰äº†ä¸€äº›â€œå¯¹è±¡â€ï¼Œå¦‚javaä¸­çš„java.lang.Objectï¼ŒGLIBä¸­çš„GObjectï¼ŒQTä¸­çš„QObjectç­‰ç­‰ã€‚D-BUSçš„åº•å±‚æ¥å£ï¼Œå’Œlibdbus APIç›¸å…³ï¼Œæ˜¯æ²¡æœ‰è¿™äº›å¯¹è±¡çš„æ¦‚å¿µçš„ï¼Œå®ƒæä¾›çš„æ˜¯ä¸€ç§å«å¯¹è±¡è·¯å¾„ï¼ˆobject pathï¼‰ï¼Œç”¨äºè®©é«˜å±‚æ¥å£ç»‘å®šåˆ°å„ä¸ªå¯¹è±¡ä¸­å»ï¼Œå…è®¸è¿œç«¯åº”ç”¨ç¨‹åºæŒ‡å‘å®ƒä»¬ã€‚object pathå°±åƒæ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥å«åš/org/kde/kspread/sheets/3/cells/4/5ç­‰ã€‚</p>

<p>Methods and Signals
æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€äº›æˆå‘˜ï¼Œä¸¤ç§æˆå‘˜:æ–¹æ³•(methods)å’Œä¿¡å·(signals)ï¼Œåœ¨å¯¹è±¡ä¸­ï¼Œæ–¹æ³•å¯ä»¥è¢«è°ƒç”¨ã€‚ä¿¡å·ä¼šè¢«å¹¿æ’­ï¼Œæ„Ÿå…´è¶£çš„å¯¹è±¡å¯ä»¥å¤„ç†è¿™ä¸ªä¿¡å·ï¼ŒåŒæ—¶ä¿¡å·ä¸­ä¹Ÿå¯ä»¥å¸¦æœ‰ç›¸å…³çš„æ•°æ®ã€‚æ¯ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¿¡å·éƒ½å¯ä»¥ç”¨ä¸€ä¸ªåå­—æ¥å‘½åï¼Œå¦‚â€Frobateâ€ æˆ–è€… â€œOnClickedâ€ã€‚</p>

<p>Interfaces
æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ¥å£ï¼Œä¸€ä¸ªæ¥å£å°±æ˜¯å¤šä¸ªæ–¹æ³•å’Œä¿¡å·çš„é›†åˆã€‚dbusä½¿ç”¨ç®€å•çš„å‘½åç©ºé—´å­—ç¬¦ä¸²æ¥è¡¨ç¤ºæ¥å£ï¼Œå¦‚org.freedesktop.Introspectableã€‚å¯ä»¥è¯´dbusæ¥å£ç›¸å½“äºC++ä¸­çš„çº¯è™šç±»ã€‚</p>

<p>Proxies
ä»£ç†å¯¹è±¡ç”¨äºæ¨¡æ‹Ÿåœ¨å¦å¤–çš„è¿›ç¨‹ä¸­çš„è¿œç«¯å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡åƒæ˜¯ä¸€ä¸ªæ­£å¸¸çš„æ™®é€šå¯¹è±¡ã€‚d-busçš„åº•å±‚æ¥å£å¿…é¡»æ‰‹åŠ¨åˆ›å»ºæ–¹æ³•è°ƒç”¨çš„æ¶ˆæ¯ï¼Œç„¶åå‘é€ï¼ŒåŒæ—¶å¿…é¡»æ‰‹åŠ¨æ¥å—å’Œå¤„ç†è¿”å›çš„æ¶ˆæ¯ã€‚é«˜å±‚æ¥å£å¯ä»¥ä½¿ç”¨ä»£ç†æ¥æ›¿æ¢è¿™äº›ï¼Œå½“è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä»£ç†å†…éƒ¨ä¼šè½¬æ¢æˆdbusçš„æ–¹æ³•è°ƒç”¨ï¼Œç­‰å¾…æ¶ˆæ¯è¿”å›ï¼Œå¯¹è¿”å›ç»“æœè§£åŒ…ï¼Œè¿”å›ç»™ç›¸åº”çš„æ–¹æ³•ã€‚å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œä½¿ç”¨dbusåº•å±‚æ¥å£ç¼–å†™çš„ä»£ç ï¼š
Message message = new Message(â€œ/remote/object/pathâ€, â€œMethodNameâ€, arg1, arg2);
Connection connection = getBusConnection();
connection.send(message);
Message reply = connection.waitForReply(message);
if (reply.isError()) {</p>

<p>} else {
Object returnValue = reply.getReturnValue();
}
ä½¿ç”¨ä»£ç†å¯¹è±¡ç¼–å†™çš„ä»£ç ï¼š
Proxy proxy = new Proxy(getBusConnection(), â€œ/remote/object/pathâ€);
Object returnValue = proxy.MethodName(arg1, arg2);
å®¢æˆ·ç«¯ä»£ç å‡å°‘å¾ˆå¤šã€‚</p>

<p>Bus Names
å½“ä¸€ä¸ªåº”ç”¨ç¨‹åºè¿æ¥ä¸Šbus daemonæ—¶ï¼Œdaemonä¼šåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„åå­—ç»™å®ƒã€‚ä»¥å†’å·ï¼ˆ:ï¼‰å¼€å§‹ï¼Œè¿™äº›åå­—åœ¨daemonçš„ç”Ÿå‘½å‘¨æœŸä¸­æ˜¯ä¸ä¼šæ”¹å˜çš„ï¼Œå¯ä»¥è®¤ä¸ºè¿™äº›åå­—å°±æ˜¯ä¸€ä¸ªIPåœ°å€ã€‚å½“è¿™ä¸ªåå­—æ˜ å°„åˆ°åº”ç”¨ç¨‹åºçš„è¿æ¥ä¸Šæ—¶ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥è¯´æ‹¥æœ‰è¿™ä¸ªåå­—ã€‚åŒæ—¶åº”ç”¨å¯ä»¥å£°æ˜é¢å¤–çš„å®¹æ˜“ç†è§£çš„åå­—ï¼Œæ¯”å¦‚å¯ä»¥å–ä¸€ä¸ªåå­—com.mycompany.TextEditorï¼Œå¯ä»¥è®¤ä¸ºè¿™äº›åå­—å°±æ˜¯ä¸€ä¸ªåŸŸåã€‚å…¶ä»–åº”ç”¨ç¨‹åºå¯ä»¥å¾€è¿™ä¸ªåå­—å‘é€æ¶ˆæ¯ï¼Œæ‰§è¡Œå„ç§æ–¹æ³•ã€‚</p>

<p>åå­—è¿˜æœ‰ç¬¬äºŒä¸ªé‡è¦çš„ç”¨é€”ï¼Œå¯ä»¥ç”¨äºè·Ÿè¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸã€‚å½“åº”ç”¨é€€å‡ºï¼ˆæˆ–è€…å´©æºƒï¼‰æ—¶ï¼Œä¸busçš„è¿æ¥å°†è¢«OSå†…æ ¸å…³æ‰ï¼Œbuså°†ä¼šå‘é€é€šçŸ¥ï¼Œå‘Šè¯‰å‰©ä½™çš„åº”ç”¨ç¨‹åºï¼Œè¯¥ç¨‹åºå·²ç»ä¸¢å¤±äº†å®ƒçš„åå­—ã€‚åå­—è¿˜å¯ä»¥æ£€æµ‹åº”ç”¨æ˜¯å¦å·²ç»å¯åŠ¨ï¼Œè¿™å¾€å¾€ç”¨äºåªèƒ½å¯åŠ¨ä¸€ä¸ªå®ä¾‹çš„åº”ç”¨ã€‚</p>

<p>Addresses
ä½¿ç”¨d-busçš„åº”ç”¨ç¨‹åºæ—¢å¯ä»¥æ˜¯serverä¹Ÿå¯ä»¥æ˜¯clientï¼Œserverç›‘å¬åˆ°æ¥çš„è¿æ¥ï¼Œclientè¿æ¥åˆ°serverï¼Œä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œæ¶ˆæ¯å°±å¯ä»¥æµè½¬ã€‚å¦‚æœä½¿ç”¨dbus daemonï¼Œæ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯clientï¼Œdaemonç›‘å¬æ‰€æœ‰çš„è¿æ¥ï¼Œåº”ç”¨ç¨‹åºåˆå§‹åŒ–è¿æ¥åˆ°daemonã€‚</p>

<p>dbusåœ°å€æŒ‡æ˜serverå°†è¦ç›‘å¬çš„åœ°æ–¹ï¼Œclientå°†è¦è¿æ¥çš„åœ°æ–¹ï¼Œä¾‹å¦‚ï¼Œåœ°å€ï¼šunix:path=/tmp/abcdefè¡¨æ˜serverå°†åœ¨/tmp/abcdefè·¯å¾„ä¸‹ç›‘å¬unixåŸŸçš„socketï¼Œclientä¹Ÿå°†è¿æ¥åˆ°è¿™ä¸ªsocketã€‚ä¸€ä¸ªåœ°å€ä¹Ÿå¯ä»¥æŒ‡æ˜æ˜¯TCP/IPçš„socketï¼Œæˆ–è€…æ˜¯å…¶ä»–çš„ã€‚</p>

<p>å½“ä½¿ç”¨bus daemonæ—¶ï¼Œlibdbusä¼šä»ç¯å¢ƒå˜é‡ä¸­ï¼ˆDBUS_SESSION_BUS_ADDRESSï¼‰è‡ªåŠ¨è®¤è¯†â€œä¼šè¯daemonâ€çš„åœ°å€ã€‚å¦‚æœæ˜¯ç³»ç»Ÿdaemonï¼Œå®ƒä¼šæ£€æŸ¥æŒ‡å®šçš„socketè·¯å¾„è·å¾—åœ°å€ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆDBUS_SESSION_BUS_ADDRESSï¼‰è¿›è¡Œè®¾å®šã€‚</p>

<p>å½“dbusä¸­ä¸ä½¿ç”¨daemonæ—¶ï¼Œéœ€è¦å®šä¹‰å“ªä¸€ä¸ªåº”ç”¨æ˜¯serverï¼Œå“ªä¸€ä¸ªåº”ç”¨æ˜¯clientï¼ŒåŒæ—¶è¦æŒ‡æ˜serverçš„åœ°å€ï¼Œè¿™ä¸æ˜¯å¾ˆé€šå¸¸çš„åšæ³•ã€‚</p>

<p>Big Conceptual Picture
è¦åœ¨æŒ‡å®šçš„å¯¹è±¡ä¸­è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•ï¼Œéœ€è¦çŸ¥é“çš„å‚æ•°å¦‚ä¸‹ï¼š
Address -&gt; [Bus Name] -&gt; Path -&gt; Interface -&gt; Method
bus nameæ˜¯å¯é€‰çš„ï¼Œé™¤éæ˜¯å¸Œæœ›æŠŠæ¶ˆæ¯é€åˆ°ç‰¹å®šçš„åº”ç”¨ä¸­æ‰éœ€è¦ã€‚interfaceä¹Ÿæ˜¯å¯é€‰çš„ï¼Œæœ‰ä¸€äº›å†å²åŸå› ï¼ŒDCOPä¸éœ€è¦æŒ‡å®šæ¥å£ï¼Œå› ä¸ºDCOPåœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸­ç¦æ­¢åŒåçš„æ–¹æ³•ã€‚</p>

<p>Messages - Behind the Scenes
å¦‚æœä½¿ç”¨dbusçš„é«˜å±‚æ¥å£ï¼Œå°±å¯ä»¥ä¸ç”¨ç›´æ¥æ“ä½œè¿™äº›æ¶ˆæ¯ã€‚DBUSæœ‰å››ç§ç±»å‹çš„æ¶ˆæ¯ï¼š
1.æ–¹æ³•è°ƒç”¨ï¼ˆmethod callï¼‰ åœ¨å¯¹è±¡ä¸Šæ‰§è¡Œä¸€ä¸ªæ–¹æ³•
2.æ–¹æ³•è¿”å›ï¼ˆmethod returnï¼‰è¿”å›æ–¹æ³•æ‰§è¡Œçš„ç»“æœ
3.é”™è¯¯ï¼ˆerrorï¼‰è°ƒç”¨æ–¹æ³•äº§ç”Ÿçš„å¼‚å¸¸
4.ä¿¡å·ï¼ˆsignalï¼‰é€šçŸ¥æŒ‡å®šçš„ä¿¡å·å‘ç”Ÿäº†ï¼Œå¯ä»¥æƒ³è±¡æˆâ€œäº‹ä»¶â€ã€‚</p>

<p>è¦æ‰§è¡Œ D-BUS å¯¹è±¡çš„æ–¹æ³•ï¼Œéœ€è¦å‘å¯¹è±¡å‘é€ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æ¶ˆæ¯ã€‚å®ƒå°†å®Œæˆä¸€äº›å¤„ç†å¹¶è¿”å›ä¸€ä¸ªæ–¹æ³•è¿”å›æ¶ˆæ¯æˆ–è€…é”™è¯¯æ¶ˆæ¯ã€‚ä¿¡å·çš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒä»¬ä¸è¿”å›ä»»ä½•å†…å®¹ï¼šæ—¢æ²¡æœ‰â€œä¿¡å·è¿”å›â€æ¶ˆæ¯ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•ç±»å‹çš„é”™è¯¯æ¶ˆæ¯ã€‚</p>

<p>æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªæ¶ˆæ¯å¤´ï¼ŒåŒ…å«å¤šä¸ªå­—æ®µï¼Œæœ‰ä¸€ä¸ªæ¶ˆæ¯ä½“ï¼ŒåŒ…å«å¤šä¸ªå‚æ•°ã€‚å¯ä»¥è®¤ä¸ºæ¶ˆæ¯å¤´æ˜¯æ¶ˆæ¯çš„è·¯ç”±ä¿¡æ¯ï¼Œæ¶ˆæ¯ä½“ä½œä¸ºä¸€ä¸ªè½½ä½“ã€‚æ¶ˆæ¯å¤´é‡Œé¢çš„å­—æ®µåŒ…å«å‘é€çš„bus nameï¼Œç›®æ ‡bus nameï¼Œæ–¹æ³•æˆ–è€…ä¿¡å·åå­—ç­‰ï¼ŒåŒæ—¶æ¶ˆæ¯å¤´é‡Œé¢å®šä¹‰çš„å­—æ®µç±»å‹è§„å®šäº†æ¶ˆæ¯ä½“é‡Œé¢çš„æ•°æ®æ ¼å¼ã€‚ä¾‹å¦‚ï¼šå­—ç¬¦â€œiâ€ä»£è¡¨äº†â€32-bit integerâ€ï¼Œâ€œiiâ€å°±ä»£è¡¨äº†æ¶ˆæ¯ä½“é‡Œé¢æœ‰ä¸¤ä¸ªâ€32-bit integerâ€ã€‚</p>

<p>Calling a Method - Behind the Scenes
åœ¨dbusä¸­è°ƒç”¨ä¸€ä¸ªæ–¹æ³•åŒ…å«äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œè¿›ç¨‹Aå‘è¿›ç¨‹Bå‘é€æ–¹æ³•è°ƒç”¨æ¶ˆæ¯ï¼Œè¿›ç¨‹Bå‘è¿›ç¨‹Aå‘é€åº”ç­”æ¶ˆæ¯ã€‚æ‰€æœ‰çš„æ¶ˆæ¯éƒ½ç”±daemonè¿›è¡Œåˆ†æ´¾ï¼Œæ¯ä¸ªè°ƒç”¨çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªä¸åŒçš„åºåˆ—å·ï¼Œè¿”å›æ¶ˆæ¯åŒ…å«è¿™ä¸ªåºåˆ—å·ï¼Œä»¥æ–¹ä¾¿è°ƒç”¨è€…åŒ¹é…è°ƒç”¨æ¶ˆæ¯ä¸åº”ç­”æ¶ˆæ¯ã€‚è°ƒç”¨æ¶ˆæ¯åŒ…å«ä¸€äº›å‚æ•°ï¼Œåº”ç­”æ¶ˆæ¯å¯èƒ½åŒ…å«é”™è¯¯æ ‡è¯†ï¼Œæˆ–è€…åŒ…å«æ–¹æ³•çš„è¿”å›æ•°æ®ã€‚</p>

<p>æ–¹æ³•è°ƒç”¨çš„ä¸€èˆ¬æµç¨‹ï¼š
1.ä½¿ç”¨ä¸åŒè¯­è¨€ç»‘å®šçš„dbusé«˜å±‚æ¥å£ï¼Œéƒ½æä¾›äº†ä¸€äº›ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨å…¶ä»–è¿›ç¨‹é‡Œé¢çš„è¿œç«¯å¯¹è±¡å°±åƒæ˜¯åœ¨æœ¬åœ°è¿›ç¨‹ä¸­çš„è°ƒç”¨ä¸€æ ·ã€‚åº”ç”¨è°ƒç”¨ä»£ç†ä¸Šçš„æ–¹æ³•ï¼Œä»£ç†å°†æ„é€ ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æ¶ˆæ¯ç»™è¿œç«¯çš„è¿›ç¨‹ã€‚
2.åœ¨DBUSçš„åº•å±‚æ¥å£ä¸­ï¼Œåº”ç”¨éœ€è¦è‡ªå·±æ„é€ æ–¹æ³•è°ƒç”¨æ¶ˆæ¯ï¼ˆmethod call messageï¼‰ï¼Œè€Œä¸èƒ½ä½¿ç”¨ä»£ç†ã€‚
3.æ–¹æ³•è°ƒç”¨æ¶ˆæ¯é‡Œé¢çš„å†…å®¹æœ‰ï¼šç›®çš„è¿›ç¨‹çš„bus nameï¼Œæ–¹æ³•çš„åå­—ï¼Œæ–¹æ³•çš„å‚æ•°ï¼Œç›®çš„è¿›ç¨‹çš„å¯¹è±¡è·¯å¾„ï¼Œä»¥åŠå¯é€‰çš„æ¥å£åç§°ã€‚
4.æ–¹æ³•è°ƒç”¨æ¶ˆæ¯æ˜¯å‘é€åˆ°bus daemonä¸­çš„ã€‚
5.bus daemonæŸ¥æ‰¾ç›®æ ‡çš„bus nameï¼Œå¦‚æœæ‰¾åˆ°ï¼Œå°±æŠŠè¿™ä¸ªæ–¹æ³•å‘é€åˆ°è¯¥è¿›ç¨‹ä¸­ï¼Œå¦åˆ™ï¼Œdaemonä¼šäº§ç”Ÿé”™è¯¯æ¶ˆæ¯ï¼Œä½œä¸ºåº”ç­”æ¶ˆæ¯ç»™å‘é€è¿›ç¨‹ã€‚
6.ç›®æ ‡è¿›ç¨‹è§£å¼€æ¶ˆæ¯ï¼Œåœ¨dbusåº•å±‚æ¥å£ä¸­ï¼Œä¼šç«‹å³è°ƒç”¨æ–¹æ³•ï¼Œç„¶åå‘é€æ–¹æ³•çš„åº”ç­”æ¶ˆæ¯ç»™daemonã€‚åœ¨dbusé«˜å±‚æ¥å£ä¸­ï¼Œä¼šå…ˆæ£€æµ‹å¯¹è±¡è·¯å¾„ï¼Œæ¥å£ï¼Œæ–¹æ³•åç§°ï¼Œç„¶åæŠŠå®ƒè½¬æ¢æˆå¯¹åº”çš„å¯¹è±¡ï¼ˆå¦‚GObjectï¼ŒQTä¸­çš„QObjectç­‰ï¼‰çš„æ–¹æ³•ï¼Œç„¶åå†å°†åº”ç­”ç»“æœè½¬æ¢æˆåº”ç­”æ¶ˆæ¯å‘ç»™daemonã€‚
7.bus daemonæ¥å—åˆ°åº”ç­”æ¶ˆæ¯ï¼Œå°†æŠŠåº”ç­”æ¶ˆæ¯ç›´æ¥å‘ç»™å‘å‡ºè°ƒç”¨æ¶ˆæ¯çš„è¿›ç¨‹ã€‚
8.åº”ç­”æ¶ˆæ¯ä¸­å¯ä»¥åŒ…å®¹å¾ˆå¤šè¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥æ ‡è¯†ä¸€ä¸ªé”™è¯¯å‘ç”Ÿï¼Œå½“ä½¿ç”¨ç»‘å®šæ—¶ï¼Œåº”ç­”æ¶ˆæ¯å°†è½¬æ¢ä¸ºä»£ç†å¯¹è±¡çš„è¿”å›å€¼ï¼Œæˆ–è€…è¿›å…¥å¼‚å¸¸ã€‚</p>

<p>bus daemonä¸å¯¹æ¶ˆæ¯é‡æ–°æ’åºï¼Œå¦‚æœå‘é€äº†ä¸¤æ¡æ¶ˆæ¯åˆ°åŒä¸€ä¸ªè¿›ç¨‹ï¼Œä»–ä»¬å°†æŒ‰ç…§å‘é€é¡ºåºæ¥å—åˆ°ã€‚æ¥å—è¿›ç¨‹å¹¶éœ€è¦æŒ‰ç…§é¡ºåºå‘å‡ºåº”ç­”æ¶ˆæ¯ï¼Œä¾‹å¦‚åœ¨å¤šçº¿ç¨‹ä¸­å¤„ç†è¿™äº›æ¶ˆæ¯ï¼Œåº”ç­”æ¶ˆæ¯çš„å‘å‡ºæ˜¯æ²¡æœ‰é¡ºåºçš„ã€‚æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªåºåˆ—å·å¯ä»¥ä¸åº”ç­”æ¶ˆæ¯è¿›è¡Œé…å¯¹ã€‚</p>

<p>Emitting a Signal - Behind the Scenes
åœ¨dbusä¸­ä¸€ä¸ªä¿¡å·åŒ…å«ä¸€æ¡ä¿¡å·æ¶ˆæ¯ï¼Œä¸€ä¸ªè¿›ç¨‹å‘ç»™å¤šä¸ªè¿›ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¿¡å·æ˜¯å•å‘çš„å¹¿æ’­ã€‚ä¿¡å·å¯ä»¥åŒ…å«ä¸€äº›å‚æ•°ï¼Œä½†æ˜¯ä½œä¸ºå¹¿æ’­ï¼Œå®ƒæ˜¯æ²¡æœ‰è¿”å›å€¼çš„ã€‚</p>

<p>ä¿¡å·è§¦å‘è€…æ˜¯ä¸äº†è§£ä¿¡å·æ¥å—è€…çš„ï¼Œæ¥å—è€…å‘daemonæ³¨å†Œæ„Ÿå…´è¶£çš„ä¿¡å·ï¼Œæ³¨å†Œè§„åˆ™æ˜¯â€match rulesâ€ï¼Œè®°å½•è§¦å‘è€…åå­—å’Œä¿¡å·åå­—ã€‚daemonåªå‘æ³¨å†Œäº†è¿™ä¸ªä¿¡å·çš„è¿›ç¨‹å‘é€ä¿¡å·ã€‚</p>

<p>ä¿¡å·çš„ä¸€èˆ¬æµç¨‹å¦‚ä¸‹ï¼š
1.å½“ä½¿ç”¨dbusåº•å±‚æ¥å£æ—¶ï¼Œä¿¡å·éœ€è¦åº”ç”¨è‡ªå·±åˆ›å»ºå’Œå‘é€åˆ°daemonï¼Œä½¿ç”¨dbusé«˜å±‚æ¥å£æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç›¸å…³å¯¹è±¡è¿›è¡Œå‘é€ï¼Œå¦‚Glibé‡Œé¢æä¾›çš„ä¿¡å·è§¦å‘æœºåˆ¶ã€‚
2.ä¿¡å·åŒ…å«çš„å†…å®¹æœ‰ï¼šä¿¡å·çš„æ¥å£åç§°ï¼Œä¿¡å·åç§°ï¼Œå‘é€è¿›ç¨‹çš„bus nameï¼Œä»¥åŠå…¶ä»–å‚æ•°ã€‚
3.ä»»ä½•è¿›ç¨‹éƒ½å¯ä»¥ä¾æ®â€match rulesâ€æ³¨å†Œç›¸å…³çš„ä¿¡å·ï¼Œdaemonæœ‰ä¸€å¼ æ³¨å†Œçš„åˆ—è¡¨ã€‚
4.daemonæ£€æµ‹ä¿¡å·ï¼Œå†³å®šå“ªäº›è¿›ç¨‹å¯¹è¿™ä¸ªä¿¡å·æ„Ÿå…´è¶£ï¼Œç„¶åæŠŠä¿¡å·å‘é€ç»™è¿™äº›è¿›ç¨‹ã€‚
5.æ¯ä¸ªè¿›ç¨‹æ”¶åˆ°ä¿¡å·åï¼Œå¦‚æœæ˜¯ä½¿ç”¨äº†dbusé«˜å±‚æ¥å£ï¼Œå¯ä»¥é€‰æ‹©è§¦å‘ä»£ç†å¯¹è±¡ä¸Šçš„ä¿¡å·ã€‚å¦‚æœæ˜¯dbusåº•å±‚æ¥å£ï¼Œéœ€è¦æ£€æŸ¥å‘é€è€…åç§°å’Œä¿¡å·åç§°ï¼Œç„¶åå†³å®šæ€ä¹ˆåšã€‚</p>

<p>Glibç»‘å®šæ¥å£åœ¨â€dbus/dbus-glib.hâ€å¤´æ–‡ä»¶ä¸­å®šä¹‰ã€‚
dbuså’Œglibçš„æ•°æ®ç±»å‹æ˜ å°„å¦‚ä¸‹ï¼š</p>

<p>D-Bus basic type	GType	Free function	Notes
BYTE	G_TYPE_UCHAR	 	 
BOOLEAN	G_TYPE_BOOLEAN	 	 
INT16	G_TYPE_INT	 	Will be changed to a G_TYPE_INT16 once
GLib has it
UINT16	G_TYPE_UINT	 	Will be changed to a G_TYPE_UINT16 once
GLib has it
INT32	G_TYPE_INT	 	Will be changed to a G_TYPE_INT32 once
GLib has it
UINT32	G_TYPE_UINT	 	Will be changed to a G_TYPE_UINT32 once
GLib has it
INT64	G_TYPE_GINT64	 	 
UINT64	G_TYPE_GUINT64	 	 
DOUBLE	G_TYPE_DOUBLE	 	 
STRING	G_TYPE_STRING	g_free	 
OBJECT_PATH	DBUS_TYPE_G_PROXY	g_object_unref	The returned proxy does not have an interface set; use
dbus_g_proxy_set_interface to invoke methods
Container type mappings
dbusæ•°æ®ä¹Ÿæœ‰åŒ…å®¹å™¨ç±»å‹ï¼ŒåƒDBUS_TYPE_ARRAY å’Œ DBUS_TYPE_STRUCTï¼Œdbusçš„æ•°æ®ç±»å‹å¯ä»¥æ˜¯åµŒå¥—çš„ï¼Œå¦‚æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œå†…å®¹æ˜¯å­—ç¬¦ä¸²çš„æ•°ç»„é›†åˆã€‚</p>

<p>ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»å‹éƒ½æœ‰æ™®é€šçš„ä½¿ç”¨ï¼ŒDBUS_TYPE_STRUCTåº”è¯¥å¯ä»¥åŒ…å®¹éåŸºæœ¬ç±»å‹çš„æ•°æ®ç±»å‹ã€‚glibç»‘å®šå°è¯•ä½¿ç”¨æ¯”è¾ƒæ˜æ˜¾çš„æ–¹å¼è¿›è¡Œå£°æ˜ã€‚</p>

<p>D-Bus type signature	Description	GType	C typedef	Free function	Notes
as	Array of strings	G_TYPE_STRV	char **	g_strfreev	 
v	Generic value container	G_TYPE_VALUE	GValue *	g_value_unset	The calling conventions for values expect that method callers have
allocated return values; see below.
åŒæ—¶å®šä¹‰äº†æ–°çš„æ•°ç»„ç±»å‹é›†åˆã€‚</p>

<p>D-Bus type signature	Description	GType	C typedef	Free function	Notes
ay	Array of bytes	DBUS_TYPE_G_BYTE_ARRAY	GArray *	g_array_free	 
au	Array of uint	DBUS_TYPE_G_UINT_ARRAY	GArray *	g_array_free	 
ai	Array of int	DBUS_TYPE_G_INT_ARRAY	GArray *	g_array_free	 
ax	Array of int64	DBUS_TYPE_G_INT64_ARRAY	GArray *	g_array_free	 
at	Array of uint64	DBUS_TYPE_G_UINT64_ARRAY	GArray *	g_array_free	 
ad	Array of double	DBUS_TYPE_G_DOUBLE_ARRAY	GArray *	g_array_free	 
ab	Array of boolean	DBUS_TYPE_G_BOOLEAN_ARRAY	GArray *	g_array_free	 
å®šä¹‰äº†å­—å…¸ç±»å‹</p>

<p>D-Bus type signature	Description	GType	C typedef	Free function	Notes
a{ss}	Dictionary mapping strings to strings	DBUS_TYPE_G_STRING_STRING_HASHTABLE	GHashTable *	g_hash_table_destroy	 
clientç«¯ç¼–å†™</p>

<p>æˆ‘ä»¬çš„ç¨‹åºåœ¨ä½¿ç”¨dbusçš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦è¿æ¥ä¸Šdbusï¼Œä½¿ç”¨dbus_g_bus_getè·å¾—dbusè¿æ¥ã€‚ç„¶åå¯ä»¥åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</p>

<p>éœ€è¦è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œå¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼š1.åŒæ­¥è°ƒç”¨ï¼Œä½¿ç”¨dbus_g_proxy_callå‘é€æ–¹æ³•è¯·æ±‚åˆ°è¿œç«¯å¯¹è±¡ï¼Œdbusä¼šé˜»å¡ç­‰å¾…è¿œç«¯å¯¹è±¡çš„å›åº”ï¼Œè¾“å‡ºå‚æ•°é‡Œå°†ä¼šå¸¦æœ‰ç›¸åº”çš„å›åº”æ•°æ®,ä»¥G_TYPE_INVALIDä½œä¸ºç»ˆæ­¢ç¬¦ã€‚2.å¼‚æ­¥è°ƒç”¨ï¼Œä½¿ç”¨dbus_g_proxy_begin_callï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªDBusGPendingCallå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨dbus_g_pending_call_set_notifyè¿æ¥åˆ°è‡ªå·±çš„å¤„ç†å‡½æˆä¸­ã€‚</p>

<p>å¯ä»¥ä½¿ç”¨dbus_g_proxy_add_signal å’Œ dbus_g_proxy_connect_signalæ¥è¿æ¥ä¿¡å·ï¼Œdbus_g_proxy_add_signalç”¨æ¥å£°æ˜ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå±äºå¿…é¡»è¢«è°ƒç”¨çš„æ¥å£ï¼Œdbus_g_proxy_connect_signalå¯ä»¥è°ƒç”¨å¤šæ¬¡ã€‚</p>

<p>Generated Bindings
ä½¿ç”¨å†…ç½®çš„xmlæ–‡ä»¶ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è‡ªåŠ¨åˆ›å»ºå‡ºæ˜“äºä½¿ç”¨çš„dbusä»£ç†å¯¹è±¡ã€‚å¦‚ä¸‹çš„ä¸€ä¸ªxmlæ–‡ä»¶æè¿°äº†äº†ä¸€ä¸ªæ–¹æ³•ï¼š</p>

<p>â€œinâ€æ ‡è¯†è¾“å…¥å‚æ•°ï¼Œâ€œoutâ€æ ‡è¯†è¾“å‡ºå‚æ•°ã€‚
ä½¿ç”¨dbus-binding-toolå·¥å…·æ¥ç”Ÿæˆå¤´æ–‡ä»¶ï¼Œå¦‚dbus-binding-tool â€“mode=glib-client my-object.xml &gt; my-object-bindings.hï¼Œä¼šäº§ç”Ÿå¦‚ä¸‹çš„å†…è”å‡½æ•°åŸå‹ï¼š</p>

<p>gboolean
com_example_MyObject_many_args (DBusGProxy <em>proxy, const guint IN_x,
const char * IN_str, const gdouble IN_trouble,
gdouble</em> OUT_d_ret, char ** OUT_str_ret,
GError **error);</p>

<p>DBusGProxyCall*
com_example_MyObject_many_args_async (DBusGProxy *proxy, const guint IN_x,
const char * IN_str, const gdouble IN_trouble,
com_example_MyObject_many_args_reply callback,
gpointer userdata);</p>

<p>typedef void
(*com_example_MyObject_many_args_reply)
(DBusGProxy *proxy, gdouble OUT_d_ret, char * OUT_str_ret,
GError *error, gpointer userdata);</p>

<p>æ‰€æœ‰å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯DBusGProxyå¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨dbus_g_proxy_new_*å‡½æ•°åˆ›å»ºå‡ºæ¥çš„ã€‚å®¢æˆ·ç«¯å‘é€æ–¹æ³•è¯·æ±‚å¯ä»¥å¢åŠ æ ‡è®°ï¼Œç›®å‰åªæœ‰org.freedesktop.DBus.GLib.NoReplyæ ‡è®°ï¼Œdbuså¯ä»¥ä¸è¦å›åº”æ¶ˆæ¯ï¼Œæ²¡æœ‰â€œoutâ€å‚æ•°ï¼Œè¿™æ ·è¿ç®—é€Ÿåº¦ä¼šå¿«ä¸€ç‚¹ã€‚</p>

<p>serverç«¯çš„ç¼–å†™</p>

<p>åœ¨GLibä¸­ï¼Œé€šè¿‡dbusè¡¨ç°å‡ºGObjectï¼Œå¿…é¡»å†™XMLæ–‡ä»¶æè¿°è¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•ç­‰å±æ€§ã€‚åƒä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°çš„ä¾‹å­ï¼š</p>

<p>ä¸€æ—¦å†™å®ŒXMLï¼Œè¿è¡Œdbus-binding-toolå·¥å…·ï¼Œå¦‚ dbus-binding-tool â€“mode=glib-server my-object.xml &gt; my-object-glue.h.</p>

<p>ç„¶ååœ¨æœ¬åœ°ä»£ç ä¸­includeäº§ç”Ÿçš„å¤´æ–‡ä»¶ï¼Œè°ƒç”¨dbus_g_object_class_install_infoè¿›è¡Œç±»çš„åˆå§‹åŒ–ï¼Œä¼ é€’å¯¹è±¡å’Œå¯¹è±¡ä¿¡æ¯è¿›å»ï¼Œå¦‚ dbus_g_object_type_install_info (COM_FOO_TYPE_MY_OBJECT, &amp;com_foo_my_object_info);æ¯ä¸ªå¯¹è±¡ç±»éƒ½éœ€è¦è¿™æ ·åšã€‚</p>

<p>ä¸ºäº†æ‰§è¡Œæ–¹æ³•ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªCå‡½æ•°ï¼Œå¦‚my_object_many_argsï¼Œéœ€è¦éµå®ˆçš„è§„åˆ™å¦‚ä¸‹ï¼š
1.å‡½æ•°è¿”å›gbooleanï¼Œtrueè¡¨ç¤ºæˆåŠŸï¼Œfalseæ ‡è¯†å¤±è´¥ã€‚
2.ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å¯¹è±¡å®ä¾‹çš„æŒ‡é’ˆã€‚
3.è·Ÿåœ¨å®ä¾‹æŒ‡é’ˆåé¢çš„å‚æ•°æ˜¯æ–¹æ³•çš„è¾“å…¥å‚æ•°ã€‚
4.è¾“å…¥å‚æ•°åé¢æ˜¯è¾“å‡ºå‚æ•°ã€‚
5.æœ€åä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯GError **ï¼Œå¦‚æœå‡½æ•°è¿”å›å¤±è´¥ï¼Œå¿…é¡»ä½¿ç”¨g_set_errorå¡«å……è¯¥é”™è¯¯å‚æ•°ã€‚
å¦‚ä¸‹çš„xmlæ–‡ä»¶</p>

<p>å¯¹åº”çš„å‡½æ•°å®šä¹‰ä¸ºï¼š
gboolean
my_object_increment (MyObject *obj, gint32 x, gint32 *ret, GError **error);</p>

<p>æœ€åå¯ä»¥ä½¿ç”¨dbus_g_connection_register_g_objectè¾“å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚
dbus_g_connection_register_g_object (connection,â€/com/foo/MyObjectâ€, obj);</p>

<p>serverç«¯çš„å£°æ˜ï¼ˆAnnotationsï¼‰ï¼š
org.freedesktop.DBus.GLib.CSymbol
org.freedesktop.DBus.GLib.Async
org.freedesktop.DBus.GLib.Const
org.freedesktop.DBus.GLib.ReturnVal</p>

<p>dbuså¯åŠ¨é—®é¢˜</p>

<p>é¦–å…ˆéœ€è¦å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹
dbus-daemon â€“system â€“print-pid â€“print-address
ç»“æœæç¤º Failed to start message bus: Could not get UID and GID for username â€œmessagebusâ€
dbuséœ€è¦æœ‰ä¸€ä¸ªmessagebusç”¨æˆ·ï¼Œåˆ›å»ºè¯¥ç”¨æˆ·å³å¯ï¼Œuseradd messagebusï¼Œé—®é¢˜è§£å†³ã€‚</p>

<p>æ‰§è¡Œä¸€ä¸ªdbusæµ‹è¯•ç¨‹åºï¼Œæç¤ºï¼šD-Bus library appears to be incorrectly set up; failed to read machine uuid: Failed to open â€œ/usr/var/lib/dbus/machine-idâ€: No such file or directory
æ²¡æœ‰machine-idæ–‡ä»¶ï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼Œéœ€è¦ç»™å®ƒå®šä¹‰ä¸€ä¸ªidï¼Œä½¿ç”¨dbus-uuidgen &gt;/usr/var/lib/dbus/machine-id
äº§ç”Ÿè¿™ä¸ªæ–‡ä»¶ï¼Œè¯¥é—®é¢˜è§£å†³ã€‚</p>

<p>å†æ¬¡æ‰§è¡Œæµ‹è¯•ç¨‹åºï¼Œåˆæœ‰é—®é¢˜ï¼šCouldnâ€™t connect to session bus: Failed to execute dbus-launch to autolaunch D-Bus session,çœ‹äº†å¸®åŠ©http://dbus.freedesktop.org/doc/dbus-launch.1.html
AUTOMATIC LAUNCHINGä¸€èŠ‚ï¼Œéœ€è¦è®¾ç½®DBUS_SESSION_BUS_ADDRESSç¯å¢ƒå˜é‡çš„å€¼ï¼Œå…ˆæ‰§è¡Œdbus-launch,è·å¾—äº†DBUS_SESSION_BUS_ADDRESSå€¼ï¼Œå†exportä¸€ä¸‹ï¼Œæœ€åæ‰§è¡Œæµ‹è¯•ç¨‹åºï¼ŒOKäº†</p>

<p>åœ¨dbuså¸®åŠ©ä¸­æœ‰ä¸€ç¯‡å…³äºdbus-launchçš„æ–‡ç« ï¼Œå¯ä»¥åœ¨è„šæœ¬ä¸­å¯åŠ¨dbus-launchï¼ŒåŒæ—¶è‡ªåŠ¨è®¾ç½®DBUS_SESSION_BUS_ADDRESSç¯å¢ƒå˜é‡ï¼Œè„šæœ¬æ–‡ä»¶rundbuså¦‚ä¸‹ï¼š</p>

<p>if test -z â€œ$DBUS_SESSION_BUS_ADDRESSâ€ ; then</p>
<h2 id="if-not-found-launch-a-new-one">if not found, launch a new one</h2>
<p>eval <code class="language-plaintext highlighter-rouge">dbus-launch --sh-syntax --exit-with-session</code>
echo â€œD-Bus per-session daemon address is: $DBUS_SESSION_BUS_ADDRESSâ€
fi</p>

<p>æ‰§è¡Œ. rundbuså³å¯ã€‚</p>

<p>åŸºäºDBusçš„åº”ç”¨ç¨‹åºå¯ä»¥æ˜¯ä½¿ç”¨DBus Daemonçš„æ€»çº¿å‹ç»“æ„ï¼Œæ¯ä¸ªDBusçš„è¯·æ±‚é€šè¿‡DBus Daemonè½¬å‘ï¼›æˆ–è€…æ˜¯ç‚¹å¯¹ç‚¹çš„æ˜Ÿå‹ç»“æ„ï¼ŒClientä¸Serverä¹‹é—´æ˜¯ç›´æ¥çš„Peer2Peerçš„è¿æ¥ã€‚è¿™ä¿©ç§ç»“æ„å„æœ‰ä¼˜ç¼ºç‚¹ï¼šæ€»çº¿å‹çš„ç»“æ„æ¯”è¾ƒæ¸…æ™°ï¼ŒServeréœ€è¦ç»´æŠ¤çš„è¿æ¥è¾ƒå°‘ï¼Œå®é™…ä¸Šåªæœ‰ä¸€ä¸ªä¸DBus Daemonç›¸è¿çš„è¿æ¥ï¼Œå¹¿æ’­æ¶ˆæ¯å¯ä»¥å¾ˆå®¹æ˜“çš„å‘é€åˆ°å„ä¸ªClientï¼›P2På½¢å¼çš„DBusé€šä¿¡ä¸­é—´å› ä¸ºå°‘äº†DBus Daemonçš„ä¸­è½¬ï¼Œå› æ­¤æ€§èƒ½æ›´å¥½ï¼Œå¤§çº¦æå‡30%ã€‚</p>

<p>åŸºäºGLibæä¾›çš„GBuså®ç°åŸºäºä»¥ä¸Šä¿©ç§å½¢æ€çš„DBusåº”ç”¨è¿˜æ˜¯éå¸¸ç®€å•çš„ï¼š</p>

<ol>
  <li>å‡†å¤‡å·¥ä½œ</li>
</ol>

<p>1.1 æä¾›ä¸€ä¸ªç”¨äºä»£ç ç”Ÿæˆçš„XMLæ–‡ä»¶</p>

<p>è¿™ä»½XMLæ•°æ®åœ¨GDBusä¸­ç§°ä¸ºintrospection dataï¼Œç”¨æ¥æè¿°æä¾›æœåŠ¡çš„GObjectçš„æ¥å£åä¸å‚æ•°ã€‚ç”¨äºgdbus-codegenå¯ä»¥ä½¿ç”¨è¿™ä»½XMLæ–‡ä»¶ç”Ÿæˆåœ¨Clientä¸Serverä¾§ä½¿ç”¨çš„ä»£ç ã€‚å¯¹äºæ€»çº¿å‹DBusåº”ç”¨å’ŒP2På‹DBusåº”ç”¨ï¼Œè¿™ä»½ä»£ç æ˜¯é€šç”¨çš„ã€‚</p>

<p>1.2 ç¼–è¯‘ç”Ÿæˆçš„ä»£ç </p>

<p>ç”Ÿæˆçš„ä»£ç éœ€è¦åˆ†åˆ«é“¾æ¥åˆ°ä¿©ä¸ªè¿›ç¨‹ä¸­ï¼šå¸¦æœ‰Skeletonå­—æ ·çš„ä»£ç ï¼Œè¿è¡Œåœ¨Serverä¾§ï¼›å¸¦æœ‰Proxyå­—æ ·çš„ä»£ç ï¼Œè¿è¡Œåœ¨Clientä¾§ã€‚</p>

<p>gdbus-codegen è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç çš„è§„åˆ™å¯å‚è€ƒï¼šhttp://people.freedesktop.org/~david/gio-gdbus-codegen-20110412/gdbus-codegen.html</p>

<ol>
  <li>æ€»çº¿å‹</li>
</ol>

<p>2.1 Server</p>

<p>2.1.1 æä¾›ä¸€ä¸ªåŸºäºDefault Contextçš„GLib Mainloop</p>

<p>2.1.2 è°ƒç”¨g_bus_own_nameåœ¨æ€»çº¿ä¸Šæ³¨å†Œè¿™ä¸ªServer</p>

<p>2.1.3 æä¾›on_name_acquriedçš„å›è°ƒå‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªskeletonå¯¹è±¡ï¼Œå¹¶è°ƒç”¨g_dbus_interface_skeleton_exportè¾“å‡ºåˆ°æ€»çº¿ä¸Š</p>

<p>2.2 Client</p>

<p>2.2.1 æä¾›ä¸€ä¸ªåŸºäºDefault Contextçš„GLib Mainloop</p>

<p>2.2.2 è°ƒç”¨dbus_proxy_new_syncè·å–ä¸Serverçš„Skeletonå¯¹è±¡ç›¸å¯¹åº”çš„Proxyå¯¹è±¡ï¼Œä½œä¸ºåç»­DBusæ–¹æ³•è°ƒç”¨çš„å‚æ•°</p>

<p>A.Consider the following D-Bus Introspection XML.</p>

<p>å¤åˆ¶ä»£ç 
å¤åˆ¶ä»£ç </p>
<interface name="net.Corp.MyApp.Frobber">
  <method name="HelloWorld">
    <arg name="greeting" direction="in" type="s" />
    <arg name="response" direction="out" type="s" />
  </method>

  <signal name="Notification">
    <arg name="icon_blob" type="ay" />
    <arg name="height" type="i" />
    <arg name="messages" type="as" />
  </signal>

  <property name="Verbose" type="b" access="readwrite" />
</interface>
<p>å¤åˆ¶ä»£ç 
å¤åˆ¶ä»£ç </p>

<p>B.åœ¨serverç«¯</p>

<p>å¤åˆ¶ä»£ç 
å¤åˆ¶ä»£ç 
static gboolean
on_handle_hello_world (MyAppFrobber           *interface,
                       GDBusMethodInvocation  *invocation,
                       const gchar            *greeting,
                       gpointer                user_data)
{
  if (g_strcmp0 (greeting, â€œBooâ€) != 0)
    {
      gchar *response;
      response = g_strdup_printf (â€œWord! You said `%sâ€™.â€, greeting);
      my_app_complete_hello_world (interface, invocation, response);
      g_free (response);
    }
  else
    {
      g_dbus_method_invocation_return_error (MY_APP_ERROR,
                 MY_APP_ERROR_NO_WHINING,
                 â€œHey, %s, there will be no whining!â€,
                 g_dbus_method_invocation_get_sender (invocation));
    }
  return TRUE;
}</p>

<p>[â€¦]</p>

<p>interface = my_app_frobber_skeleton_new ();
  my_app_frobber_set_verbose (interface, TRUE);</p>

<p>g_signal_connect (interface,
                    â€œhandle-hello-worldâ€,
                    G_CALLBACK (on_handle_hello_world),
                    some_user_data);</p>

<p>[â€¦]</p>

<p>error = NULL;
  if (!g_dbus_interface_skeleton_export (G_DBUS_INTERFACE_SKELETON (interface),
                                         connection,
                                         â€œ/path/of/dbus_objectâ€,
                                         &amp;error))
    {
      /* handle error */
    }
å¤åˆ¶ä»£ç 
å¤åˆ¶ä»£ç 
C.client ç«¯</p>

<p>1
2
3
4
5
6
7
8
9
10
11
12
13
MyAppFrobber *proxy;
GError *error;</p>

<p>error = NULL;
proxy = my_app_frobber_proxy_new_for_bus_sync (
            G_BUS_TYPE_SESSION,
            G_DBUS_PROXY_FLAGS_NONE,
            â€œnet.Corp.MyAppâ€,              /* bus name <em>/
            â€œ/net/Corp/MyApp/SomeFrobberâ€, /</em> object <em>/
            NULL,                          /</em> GCancellable* <em>/
            &amp;error);
/</em> do stuff with proxy */
g_object_unref (proxy);</p>

<ol>
  <li>P2På‹</li>
</ol>

<p>3.1 Server</p>

<p>3.1.1 æä¾›ä¸€ä¸ªåŸºäºDefault Contextçš„GLib Mainloop</p>

<p>3.1.2 è°ƒç”¨g_dbus_server_startå¯åŠ¨ä¸€ä¸ªServer</p>

<p>3.1.3 è°ƒç”¨g_signal_connectï¼Œå…³è”callbackåˆ°Serverå¯¹è±¡çš„â€new-connectionâ€ä¿¡å·ä¸Š</p>

<p>3.1.4 æä¾›callbackï¼Œåœ¨callbackä¸­åˆ›å»ºä¸€ä¸ªskeletonå¯¹è±¡ï¼Œå¹¶è°ƒç”¨g_dbus_interface_skeleton_exportè¾“å‡ºåˆ°è¿™ä¸ªæ–°å»ºç«‹çš„è¿æ¥ä¸Š</p>

<p>3.2 Client</p>

<p>3.2.1 æä¾›ä¸€ä¸ªåŸºäºDefault Contextçš„GLib Mainloop</p>

<p>3.2.2 è°ƒç”¨g_dbus_connection_new_for_address_syncå»ºç«‹ä¸€ä¸ªåˆ°Serverçš„è¿æ¥</p>

<p>3.2.3 è°ƒç”¨dbus_proxy_new_syncåˆ›å»ºä¸€ä¸ªä¸Serverä¾§skeletonå¯¹è±¡å¯¹åº”çš„Proxyå¯¹è±¡ï¼Œä½œä¸ºåç»­DBusæ–¹æ³•è°ƒç”¨çš„å‚æ•°</p>
:ET