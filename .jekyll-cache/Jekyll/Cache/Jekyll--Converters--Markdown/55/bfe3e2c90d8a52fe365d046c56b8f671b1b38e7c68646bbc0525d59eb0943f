I"å	<p>https://gocn.vip/topics/10268
OPAå®ç°çš„è½»é‡çº§ç­–ç•¥å¼•æ“ï¼Œä¸€å¼€å§‹å°±æ˜¯ä¸ºäº†äº‘åŸç”Ÿç¯å¢ƒçš„serviceæä¾›è§£è€¦çš„ç­–ç•¥æœåŠ¡ï¼Œåˆ†å¸ƒå¼æ˜¯å¿…ç„¶è¦è€ƒè™‘çš„é—®é¢˜ã€‚</p>

<p>åœ¨Bundle apiçš„è®¾è®¡ä¸­ï¼Œå…¶å®å°±å…¨é¢è€ƒè™‘å¹¶ä½“ç°äº†åœ¨åˆ†å¸ƒå¼åº”ç”¨ä¸­å¦‚ä½•æ›´å¥½çš„è§£è€¦ç­–ç•¥å¼•æ“çš„ç®¡ç†ã€‚</p>

<p>æ¯”å¦‚ï¼š</p>

<p>å¦‚ä½•åšé›†ä¸­é…ç½®ç®¡ç†
å¦‚ä½•åŠ¨æ€æ›´æ–°ç­–ç•¥
å¦‚ä½•ç›‘æ§ç­–ç•¥å¼•æ“èŠ‚ç‚¹çš„çŠ¶æ€ä»¥åŠå†³ç­–æ—¥å¿—æ”¶é›†
æœ‰äº†è¿™äº›åŠŸèƒ½ï¼Œå†åŠ ä¸Šå…¶é«˜æ•ˆçš„ç­–ç•¥æè¿°è¯­è¨€Regoï¼ŒOPAæ‰çœŸæ­£ç§°å¾—ä¸Šæ˜¯äº‘åŸç”Ÿæ—¶ä»£çš„é€šç”¨ç­–ç•¥å¼•æ“ã€‚</p>

<p>æœ¬æ–‡å°†å¸¦å¤§å®¶ç®€å•æ¢³ç†ä¸€éBundleçš„ç»„ç»‡æ–¹å¼ã€ç®¡ç† apiã€åŠç›‘æ§æ–¹å¼ã€‚</p>

<p>è€ƒè™‘åˆ°ä¸€æ¬¡æ€§è¿‡å®Œä¸æ˜“æ¶ˆåŒ–ï¼Œæ–‡æœ«ä¼šæä¾›ä¸€ä¸ªç›´æ¥å¯å®æ“çš„docker-composeç‰ˆæœ¬çš„demoï¼Œå°†å…¨é¢è¦†ç›–æœ¬æ–‡ç»†èŠ‚
<!-- more -->
ä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹Bundleçš„æ–‡ä»¶ç»„ç»‡æ–¹å¼</p>

<p>åœ¨Bundleä¸‹çš„data,åªèƒ½è¢«è¯†åˆ«data.jsonå’Œdata.yamlçš„æ–‡ä»¶, è€Œå…¶ä¸Šè¾¹çš„ç›®å½•ä¼šä½œä¸ºå…¶æ•°æ®å‰ç¼€</p>

<p>å¦‚ä¸‹è¾¹roles/data.json (bundle/exampleä½œä¸ºä¸€ä¸ªbundle)ï¼Œä¼šå°†data.jsonçš„æ•°æ®æŒ‚åœ¨data.rolesèŠ‚ç‚¹ä¸‹</p>

<p>cd bundle/example
tree -a
.
â”œâ”€â”€ .manifest
â”œâ”€â”€ bindings
â”‚   â””â”€â”€ data.json
â”œâ”€â”€ main.rego
â”œâ”€â”€ rbac.rego
â””â”€â”€ roles
    â””â”€â”€ data.json
å…¶ä¸­.manifestæ–‡ä»¶æ˜¯Bundleçš„ä¸€ä¸ªå¯é€‰çš„å…ƒæ•°æ®ï¼ˆmetadataï¼‰é…ç½®æ–‡ä»¶</p>

<p>cat .manifest
{
  â€œrevisionâ€ : â€œ9f160bcd446bf50b1b17b570c322198a68d8e106â€,
  â€œrootsâ€: [â€œrolesâ€, â€œbindingsâ€,â€rbacâ€,â€systemâ€]
}
å®ƒçš„ä½œç”¨æ˜¯å£°æ˜Bundleçš„ç‰ˆæœ¬revisionåŠå…¶ä¸‹çš„è·¯å¾„å‰ç¼€ï¼ˆroots: path prefixï¼‰</p>

<p>rootsä¸ä»…è§„å®šäº†Bundleåº”è¯¥æœ‰çš„è·¯å¾„å‰ç¼€ï¼›åœ¨ç”¨Bundle apiï¼ˆåè¾¹ä¼šæåˆ°ï¼‰æ›´æ–°æ–‡ä»¶æ—¶ï¼Œä¹Ÿä¼šæŒ‰å…¶è§„å®šçš„è·¯å¾„å‰ç¼€æ¥æ›´æ–°æ–‡ä»¶</p>

<p>ç„¶åbundleä¹Ÿæ”¯æŒtarballæ ¼å¼åŠ è½½åˆ°server</p>

<p>ä¾‹å¦‚opa run -bçš„æ–¹å¼æŒ‡å®šBundle</p>

<p>cd bundle/example
tar -czf bundle.tar.gz .
opa run -b bundle.tar.gz
Tips: å…³äºå¦‚ä½•åœ¨äº¤äº’å¼å‘½ä»¤è¡Œé‡Œä¼ é€’inputã€‚ ä¹‹å‰é bundle ä½¿ç”¨ opa run quick-start repl.input:quick-start/input.json åˆ° bundle æ ¼å¼æ—¶ï¼Œå°±éœ€è¦æ„å»º repl/input/data.json æ–‡ä»¶æ ¼å¼ä½œä¸ºè¾“å…¥</p>

<p>https://www.openpolicyagent.org/docs/latest/rest-api/
https://github.com/NewbMiao/opa-koans/tree/master/bundle</p>

<p>https://www.cnblogs.com/uoyo/p/12421553.html
https://www.cnblogs.com/jadeshu/p/10663563.html
https://www.jianshu.com/p/ffc408ae257f
https://www.jianshu.com/p/ef6023357aaf</p>
:ET