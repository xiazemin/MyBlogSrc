I"† <p>https://github.com/dapr/dapr
https://www.cnblogs.com/shanyou/p/11873873.html
<!-- more -->
æ„å»ºäº‹ä»¶é©±åŠ¨ã€æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€çš„åº”ç”¨
ä¾‹å¦‚ï¼Œåœ¨æ„å»ºç”±å¤šä¸ªæœåŠ¡ç»„æˆçš„ç”µå­å•†åŠ¡åº”ç”¨æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨æœ‰çŠ¶æ€çš„è§’è‰²æ¥è¡¨ç¤ºè´­ç‰©è½¦æœåŠ¡ï¼Œå¹¶ä¸ºæ”¯ä»˜å’Œé…é€æœåŠ¡è°ƒç”¨æ— çŠ¶æ€å‡½æ•°ã€‚ç¼–å†™è¿™ä¸ªåº”ç”¨å¯èƒ½æ¶‰åŠåˆ°ä½¿ç”¨å¤šç§è¯­è¨€ã€å¼€å‘æ¡†æ¶å’ŒåŸºç¡€æ¶æ„å¹³å°ï¼Œä»¥åŠä¸å¤–éƒ¨æœåŠ¡é›†æˆã€‚è€Œç†è§£å’Œç®¡ç†å¦‚æ­¤å¤æ‚çš„æŠ€æœ¯æ ˆï¼Œä¼šåˆ†æ•£å¼€å‘äººå‘˜å¯¹æ„å»ºä¸šåŠ¡ä»·å€¼çš„æ³¨æ„åŠ›ã€‚</p>

<p>Dapr æ„å»ºå—çš„ alpha ç‰ˆæœ¬
åœ¨è®¾è®¡å’Œæ„å»ºå¾®æœåŠ¡åº”ç”¨æ—¶éœ€è¦è®¸å¤šåŠŸèƒ½ã€‚åœ¨ Dapr çš„ç¬¬ä¸€ä¸ªå¼€æº alpha ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ç€é‡äºæä¾›ä¸€äº›æœ€å¸¸ç”¨çš„æ„å»ºå—ã€‚</p>

<p>æœåŠ¡è°ƒç”¨ï¼š å¼¹æ€§æœåŠ¡ä¸æœåŠ¡ä¹‹é—´ï¼ˆservice-to-serviceï¼‰è°ƒç”¨å¯ä»¥åœ¨è¿œç¨‹æœåŠ¡ä¸Šå¯ç”¨æ–¹æ³•è°ƒç”¨ï¼ŒåŒ…æ‹¬é‡è¯•ï¼Œæ— è®ºè¿œç¨‹æœåŠ¡åœ¨å—æ”¯æŒçš„æ‰˜ç®¡ç¯å¢ƒä¸­è¿è¡Œåœ¨ä½•å¤„ã€‚
çŠ¶æ€ç®¡ç†ï¼š é€šè¿‡å¯¹é”® / å€¼å¯¹çš„çŠ¶æ€ç®¡ç†ï¼Œå¯ä»¥å¾ˆå®¹æ˜“ç¼–å†™é•¿æ—¶é—´è¿è¡Œã€é«˜å¯ç”¨æ€§çš„æœ‰çŠ¶æ€æœåŠ¡ï¼Œä»¥åŠåŒä¸€ä¸ªåº”ç”¨ä¸­çš„æ— çŠ¶æ€æœåŠ¡ã€‚çŠ¶æ€å­˜å‚¨æ˜¯å¯æ’å…¥çš„ï¼Œå¹¶ä¸”å¯ä»¥åŒ…æ‹¬ Azure Cosmos æˆ– Redisï¼Œä»¥åŠç»„ä»¶è·¯çº¿å›¾ä¸Šçš„å…¶ä»–ç»„ä»¶ï¼Œå¦‚ AWS DynamoDB ç­‰ã€‚
åœ¨æœåŠ¡ä¹‹é—´å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ï¼š ä½¿äº‹ä»¶é©±åŠ¨çš„æ¶æ„èƒ½å¤Ÿç®€åŒ–æ°´å¹³å¯æ‰©å±•æ€§ï¼Œå¹¶ä½¿å…¶å…·å¤‡æ•…éšœæ¢å¤èƒ½åŠ›ã€‚
äº‹ä»¶é©±åŠ¨çš„èµ„æºç»‘å®šï¼š èµ„æºç»‘å®šå’Œè§¦å‘å™¨åœ¨äº‹ä»¶é©±åŠ¨çš„æ¶æ„ä¸Šè¿›ä¸€æ­¥æ„å»ºï¼Œé€šè¿‡ä»ä»»ä½•å¤–éƒ¨èµ„æºï¼ˆå¦‚æ•°æ®åº“ã€é˜Ÿåˆ—ã€æ–‡ä»¶ç³»ç»Ÿã€blob å­˜å‚¨ã€webhooks ç­‰ï¼‰æ¥æ”¶å’Œå‘é€äº‹ä»¶ï¼Œä»è€Œå®ç°å¯æ‰©å±•æ€§å’Œå¼¹æ€§ã€‚ä¾‹å¦‚ï¼Œä½ çš„ä»£ç å¯ä»¥ç”± Azure EventHub æœåŠ¡ä¸Šçš„æ¶ˆæ¯è§¦å‘ï¼Œå¹¶å°†æ•°æ®å†™å…¥ Azure CosmosDBã€‚
è™šæ‹Ÿè§’è‰²ï¼š æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€å¯¹è±¡çš„æ¨¡å¼ï¼Œé€šè¿‡æ–¹æ³•å’ŒçŠ¶æ€å°è£…ä½¿å¹¶å‘å˜å¾—ç®€å•ã€‚Dapr åœ¨å…¶è™šæ‹Ÿè§’è‰²ï¼ˆVirtual Actorsï¼‰è¿è¡Œæ—¶æä¾›äº†è®¸å¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬å¹¶å‘ã€çŠ¶æ€ã€è§’è‰²æ¿€æ´» / åœç”¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä»¥åŠç”¨äºå”¤é†’è§’è‰²çš„è®¡æ—¶å™¨å’Œæé†’ã€‚
æœåŠ¡ä¹‹é—´çš„åˆ†å¸ƒå¼è·Ÿè¸ªï¼š ä½¿ç”¨ W3C è·Ÿè¸ªä¸Šä¸‹æ–‡ï¼ˆW3C Trace Contextï¼‰æ ‡å‡†ï¼Œè½»æ¾è¯Šæ–­å’Œè§‚å¯Ÿç”Ÿäº§ä¸­çš„æœåŠ¡é—´è°ƒç”¨ï¼Œå¹¶å°†äº‹ä»¶æ¨é€åˆ°è·Ÿè¸ªå’Œç›‘è§†ç³»ç»Ÿã€‚
ç”¨äºå¯ç§»æ¤æ€§å’Œå¯æ‰©å±•æ€§çš„æ ‡å‡† API
é‚£ä¹ˆï¼Œå¦‚ä½•ä½¿ç”¨è¿™äº› Dapr æ„å»ºå—å‘¢ï¼Ÿä¾‹å¦‚ï¼Œå‡è®¾ä½ æ­£åœ¨å·²éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­çš„å¾®æœåŠ¡åº”ç”¨ä¸­ä½¿ç”¨ Azure Functions è¿è¡Œæ—¶ï¼Œä½ å¸Œæœ›åˆ©ç”¨ pub/sub æ¨¡å¼åœ¨æœåŠ¡ä¹‹é—´å‘é€æ¶ˆæ¯ã€‚ç°åœ¨ï¼ŒAzure Functions è¿è¡Œæ—¶å°šæœªå†…ç½®è¿™ç§åŠŸèƒ½ï¼Œä½†é€šè¿‡åœ¨ http ä¸Šä½¿ç”¨ Dapr pub/sub æ„å»ºå—ï¼Œä½ å¯ä»¥è½»æ¾æ·»åŠ è¿™ä¸ªæ–°åŠŸèƒ½ã€‚äºæ˜¯ä½ æœ‰äº†æ–°çš„å¼€å‘èƒ½åŠ›ï¼</p>

<p>æ­¤å¤–ï¼ŒDapr pub/sub æ„å»ºå—å…·æœ‰å¯æ’å…¥çš„ç»„ä»¶æ¨¡å‹ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åŠ¨æ€é€‰æ‹©ä¸åŒçš„å®ç°æ¥å‘é€æ¶ˆæ¯ï¼Œè€Œæ— éœ€æ›´æ”¹ä»»ä½•ä»£ç ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½æ¥é€‰æ‹© Redisã€Kafka æˆ– Azure Service Bus pub/sub Dapr ç»„ä»¶ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä»£ç éƒ½ä¿æŒä¸å˜ï¼ŒåŒ…æ‹¬é€šè¿‡ä½¿ç”¨æ ‡å‡† API åœ¨ä¸åŒçš„å—æ”¯æŒçš„åŸºç¡€è®¾æ–½ä¹‹é—´è¿›è¡Œç§»æ¤ã€‚</p>

<p>ä¸ºäº†å®ç°å¯ç§»æ¤æ€§ä¸ç°æœ‰ä»£ç çš„è½»æ¾é›†æˆï¼ŒDapr é€šè¿‡ http æˆ– gRPC æä¾›æ ‡å‡† APIã€‚ä»¥ pub/sub ä¸ºä¾‹ï¼Œä¸‹é¢çš„èŠ‚ç‚¹ä»£ç ç°å®å¦‚ä½•ä½¿ç”¨â€œhttp://<myappaddress>/dapr/subscribeâ€ç«¯ç‚¹è®¢é˜…åä¸ºâ€œAâ€å’Œâ€œBâ€çš„ä¸»é¢˜ï¼Œç„¶ååœ¨æ¶ˆæ¯å‘å¸ƒåˆ°è¿™äº›ä¸»é¢˜æ—¶é€šçŸ¥ä½ çš„åº”ç”¨ã€‚</myappaddress></p>

<p>î™¶å¤åˆ¶ä»£ç 
const express = require(â€˜expressâ€™);
const bodyParser = require(â€˜body-parserâ€™);
const app = express();
app.use(bodyParser.json());
const port = 3000;
app.get( â€˜/dajgr/subscribeâ€™, (_req, res) =&gt; {
    res.json([
        â€˜Aâ€™,
        â€˜Bâ€™
    ]);
});
app.post(â€˜/Aâ€™, (req, res) =&gt; {
    console.log(â€œA:â€, req.body);
    res.sendStatus(200);
});
app.post(â€˜/Bâ€™, (req, res) =&gt; {
    console.log(â€œB:â€, req.body);
    res.sendStatus(200);
});
app.listen(port, () =&gt; console.log(â€˜Node App listening on port ${port}!â€™))
ä¸ºäº†è¿›è¡Œæ¯”è¾ƒï¼Œä¸‹é¢æ˜¯ç”¨ C# ç¼–å†™çš„ç›¸åŒä»£ç ï¼Œä½¿ç”¨çš„æ˜¯ä» ASP.NET Core CreateWebHostBuilder() è°ƒç”¨çš„UseStartup() å¤„ç†ç¨‹åºã€‚</p>

<p>î™¶å¤åˆ¶ä»£ç 
using System.Collections.Generic;
using System.Text.Json;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Http;
using Microsoft.Extensions.Dependencylnjection;
using Microsoft.Extensions.Hosting;
using System.IO;
namespace DaprPubSub
{
    public class Startup
    {
        // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
        public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
        {
            app.UseRouting();
            app.UseEndpoints(endpoints =&gt;
            {
                // Route called by Dapr runtime to get topics this app subscribes to.
                endpoints.MapGet(â€œdagr/subscribeâ€, async context =&gt;
                {
                    // Returns list of topics to subscribe to as json in response.
                    var topicsToSubscribe = new List<string>() { "TopicA", "TopicB" &gt;;
                    await JsonSerializer.SerializeAsync(context.Response.Body, topicsToSubscribe);
                });</string></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            // Route to handle events published to TopicA
            endpoints.MapPost("A", async context =&gt;
            {
                // Read the event form request body.
                using (var streamReader = new StreamReader(context.Request.Body))
                {
                    var json = await streamReader.ReadToEndAsync();
                    Console.WriteLine("Received event for TopicA.");
                    Console.WriteLine($"Event Data: {json}');
                }
            });
            // Route to handle events published to TopicB
            endpoints.MapPost("B", async context =&gt;
            {
                // Read the event form request body.
                using (var streamReader = new StreamReader(context.Request.Body))
                {
                    var json = await streamReader.ReadToEndAsync();
                    Console.WriteLine("Received event for TopicB.");
                    Console.WriteLine($"Event Data: {json}");
                }
            });
        });
    }
} } å‘è®¢é˜…è¿™äº›ä¸»é¢˜çš„æœåŠ¡å‘å¸ƒäº‹ä»¶éå¸¸ç®€å•ï¼Œåªéœ€ä½¿ç”¨ä¸»é¢˜å’Œæœ‰æ•ˆè´Ÿè½½çš„åç§°è°ƒç”¨ Dapr æœ¬åœ° http å‘å¸ƒ API ä¸€æ ·ç®€å•ã€‚ä¸‹é¢çš„ç¤ºä¾‹èŠ‚ç‚¹ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Dapr å‘å¸ƒ APIï¼ˆåœ¨æœ¬åœ°ç«¯å£ 3500 ä¸Šï¼‰ï¼Œè¿™ä¹Ÿå¯ä»¥ä½¿ç”¨ curl å‘½ä»¤æ¥å®Œæˆï¼š
</code></pre></div></div>

<p>î™¶å¤åˆ¶ä»£ç 
curl -X POST http://localhost:3500/vl.0/publish/A \ -H â€œContent-Type: application/jsonâ€ \ -d â€˜{â€œstatusâ€: â€œcompletedâ€}â€™
î™¶å¤åˆ¶ä»£ç 
const express = require(â€˜expressâ€™â€™);
const path = require(â€˜pathâ€™);
const request = require(â€˜requestâ€™);
const bodyParser = require(â€˜body-parserâ€™);
const app = express();
app.use(bodyParser.json());
const port = 8080;
const daprllrl = â€˜http://localhost:${process.env.DAPR_HTTP_PORT || 3500}/vl.0â€™;
app.post(â€˜/publishâ€™, (req, res) =&gt; {
    console.log(â€œPublishing: â€œ, req.body);
    const publishUrl = â€˜${daprUrl}/publish/${req.body.messageType}â€™;
    request( { uri: publishUrl, method: â€™POSTâ€™, json: req.body } );
    res.sendStatus(200);
});
app.listen(process.env.PORT || port, () =&gt; console.log(â€˜Listening on port ${port}!â€™));
å¦‚è¿™äº›ç¤ºä¾‹ä»£ç æ‰€ç¤ºï¼Œåœ¨æœåŠ¡ä¸­ä½¿ç”¨ Dapr å¹¶ä¸éœ€è¦è·å–ç¼–è¯‘æ—¶ä¾èµ–é¡¹ï¼Œåªéœ€ç®€å•åœ°ä½¿ç”¨æ¶ˆæ¯ä½“åˆ›å»º URL å³å¯ã€‚</p>

<p>Sidecar æ¶æ„ä¸æ”¯æŒçš„åŸºç¡€è®¾æ–½
Dapr å°†å®ƒçš„ API ä½œä¸º Sidecar æ¶æ„äºˆä»¥å…¬å¼€ï¼Œæ— è®ºæ˜¯ä½œä¸ºå®¹å™¨è¿˜æ˜¯ä½œä¸ºè¿›ç¨‹ï¼Œéƒ½ä¸éœ€è¦åº”ç”¨ä»£ç åŒ…å«ä»»ä½• Dapr è¿è¡Œæ—¶ä»£ç ã€‚è¿™ä½¿å¾—ä¸ Dapr çš„é›†æˆä»å…¶å®ƒè¿è¡Œæ—¶å˜å¾—å¾ˆå®¹æ˜“ï¼Œå¹¶ä¸”æä¾›äº†åº”ç”¨é€»è¾‘çš„åˆ†ç¦»ï¼Œä»è€Œæé«˜äº†å¯æ”¯æŒæ€§ã€‚</p>

<p>Dapr ä½œä¸º Sidecar è¿›ç¨‹è¿è¡Œã€‚</p>

<p>https://www.infoq.cn/article/ygNxYaTIxdBjejcyjv8Y</p>

<p>https://www.cnblogs.com/Rmean/p/xstone-monkey-share-dapr-1.html</p>
:ET