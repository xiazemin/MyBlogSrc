I"¼
<p>1ã€ä¸‹è½½åŠå®‰è£…libunwindÂ </p>

<p>ä¸‹è½½åœ°å€ï¼šÂ http://download.savannah.gnu.org/releases/libunwind/libunwind-1.1.tar.gzÂ </p>

<p>å®‰è£…ï¼š./configure CFLAGS=-U_FORTRIFY_SOURCE ; make -j8 ; make install</p>

<p>2ã€ä¸‹è½½åŠå®‰è£…gperftoolsÂ </p>

<p>gitåœ°å€ï¼šhttps://github.com/gperftools/gperftoolsÂ </p>

<p>å®‰è£…ï¼š ./configure ; make -j8 ; make install</p>

<p>æˆ–è€…ï¼šyum install gperftools gperftools-devel</p>

<p>3ã€ä½¿ç”¨æ–¹æ³•Â </p>

<p>å‚è€ƒï¼šhttps://dirtysalt.github.io/gperftools.html#orgheadline4Â </p>

<p>ä¸¾ä¾‹ï¼š</p>

<p>LD_PRELOAD=â€/usr/local/lib/libprofiler.soâ€ CPUPROFILE=cpu_perf.prof CPUPROFILE_FREQUENCY=100 ./exe</p>

<p>è¿è¡Œå®Œæˆåä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆcpu_perf.profæ–‡ä»¶ï¼Œç»“åˆpprofå·¥å…·ï¼ˆgperftools/binï¼‰å¯ç”Ÿæˆtxtæˆ–pdfç­‰ï¼Œä¾‹å¦‚ï¼š</p>

<p>pprof â€“pdf ./test cpu_perf.prof &gt; cpu_perf.pdf</p>

<p>pprof â€“txt ./test cpu_perf.prof &gt; cpu_perf.txt
<!-- more -->
è°·æ­Œçš„å·¥å…·é›†ï¼Œå¯æŸ¥çœ‹CPUé‡‡æ ·ç»“æœã€‚pprof (google-perftool)ï¼Œç”¨äºæ¥åˆ†æç¨‹åºï¼Œå¿…é¡»ä¿è¯ç¨‹åºèƒ½æ­£å¸¸é€€å‡ºã€‚ä½¿ç”¨æ­¥éª¤ï¼š</p>

<p>1.å‡†å¤‡å·¥å…·ï¼Œå…ˆå®‰è£…å·¥å…·åŒ…</p>

<p>libunwind-1.1.tar.gz</p>

<p>gperftools-2.1.tar.gz</p>

<p>è§£å‹å configureåˆ°ç³»ç»Ÿé»˜è®¤è·¯å¾„å³å¯ï¼Œä¹‹åç›´æ¥-lprofiler</p>

<p>Â </p>

<p>2.å†å®‰è£…å›¾å½¢å·¥å…·</p>

<p>sudo yum install â€œgraphviz*â€</p>

<p>sudo yum install ghostscript</p>

<p>GPerfTools=â€/home/zhifeng.czf/tools/gperftools-binâ€</p>

<ol>
  <li>è‡ªå·±ç¨‹åºå¢åŠ ç¼–è¯‘é“¾æ¥é€‰é¡¹ï¼š</li>
</ol>

<p>-lprofiler</p>

<p>Â </p>

<p>é™„ï¼š</p>

<p>GPerlToos=/home/zhifeng.czf/tools/gperftools-bin</p>

<p>CCFLAGS=-fno-omit-frame-pointer-g</p>

<p>ALL_BINS=test_gperf</p>

<p>all:$(ALL_BINS)</p>

<p>test_gperf:test_gperf.o</p>

<p>Â Â Â Â Â Â Â Â  g++ $(CCFLAGS) -o $@ $^-L$(GPerfTools)/lib -Wl, -Bdynamic -lprofiler</p>

<p>.cpp.o:</p>

<p>Â Â Â Â Â Â Â Â  g++ $(CCFLAGS) -c -I./-I$(GPerfTools)/include -fPIC -o $@ $&lt;</p>

<p>clean:</p>

<p>Â Â Â Â Â Â Â Â  rm -rf $(ALL_BINS) *.o</p>

<ol>
  <li>è¿è¡Œï¼š</li>
</ol>

<p>CPUPROFILE=./profile CPUPROFILESIGNAL=12 ./xlongsrv</p>

<p>Â </p>

<p>æ­¤å¤–ï¼Œå¯¹äºä¸èƒ½æ­£å¸¸ç»“æŸçš„ç¨‹åºï¼Œå¦‚æœCPUPROFILESIGNALçš„æ–¹å¼ä¸æˆåŠŸï¼Œå¯ä»¥è‡ªå·±è°ƒç”¨ï¼š</p>

<p>ProfilerStart(), ProfilerStop();</p>

<p>Â </p>

<p>5.æŸ¥çœ‹ç»“æœ</p>

<p>pprof â€“pdfÂ ./xlongsrv ./profile.0Â  &gt; Â graph.pdf</p>

<p>pprof â€“gifÂ ./xlongsrv ./profile.0Â  &gt; Â graph.gif</p>

<p>/home/zhifeng.czf/tools/gperf/bin/pprofâ€“callgrind ./XLongSrv.astar.perf ./bs.prof &gt; graph.callgrind</p>

<p>/home/zhifeng.czf/tools/gperf/bin/pprof-text ./XLongSrv.astar.perf ./bs.prof</p>

<p>https://blog.golang.org/profiling-go-programs
https://lrita.github.io/2017/05/26/golang-memory-pprof/</p>
:ET