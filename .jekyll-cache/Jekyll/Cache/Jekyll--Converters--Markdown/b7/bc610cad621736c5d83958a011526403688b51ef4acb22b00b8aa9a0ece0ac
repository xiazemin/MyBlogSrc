I"Ò<p>brew install socat
ssh -U ~/Library/Containers/com.docker.docker/Data/debug-shell.sock
socat -d -d ~/Library/Containers/com.docker.docker/Data/debug-shell.sock pty,rawer
<!-- more -->
https://blog.csdn.net/weixin_34261739/article/details/89050333
The Docker Engine uses Linux-specific kernel features, so to run it on OS X we need to use a lightweight virtual machine (vm). You use the OS X Docker client to control the virtualized Docker Engine to build, run, and manage Docker containers.</p>

<p>https://serverfault.com/questions/603763/is-it-possible-to-do-linux-network-namespaces-netns-on-macos</p>

<p>https://www.unix.com/man-page/osx/8/ip-netns/</p>

<p>https://docs.docker.com/desktop/mac/
ç”¨ Docker for Mac å·²ç»å¾ˆä¹…äº†ï¼Œç”¨å®ƒè·‘æœ¬åœ°å¼€å‘ç¯å¢ƒå¯ä»¥è¯´æ˜¯éå¸¸æ–¹ä¾¿ï¼Œè‡ªæ‰“æœ‰äº†å®ƒï¼Œå°±å†ä¹Ÿæ²¡æ‰“å¼€è¿‡ VMware Fusionã€‚å‰æ®µæ—¶é—´ Docker for Mac åˆåŠ å…¥äº† Kubernetes æ”¯æŒï¼Œèƒ½åœ¨æœ¬åœ°è‡ªåŠ¨èµ·ä¸€ä¸ªå•èŠ‚ç‚¹ Kubernetes é›†ç¾¤ï¼ˆå°±å½“å®ƒæ˜¯é›†ç¾¤ï¼‰ï¼Œè¿™å°±çœå»äº†æ‰‹å·¥æ­å»ºçš„æ­¥éª¤ï¼Œç®€å•å¥½ç”¨ã€‚å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£äº†è§£ä¸€ä¸‹å¦‚ä½•å¼€å¯ Docker for Mac çš„ Kubernetesã€‚</p>

<p>ä½†æ˜¯ Docker for Mac è‡ªè¯ç”Ÿä»¥æ¥å°±ä¸€ç›´æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯åœ¨å®¿ä¸»æœºä¸Šçœ‹ä¸åˆ° docker0ï¼Œæ— æ³•è®¿é—®å®¹å™¨æ‰€åœ¨çš„ç½‘ç»œï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ ping é€š Docker ç»™ Container æ‰€åˆ†é…çš„ IP åœ°å€ã€‚å…³äºè¿™ä¸ªé—®é¢˜ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­æœ‰æè¿°ï¼ŒKnown limitations, use cases, and workaroundsã€‚å¯¹äº docker run å¯åŠ¨çš„ Container æ¥è¯´ï¼Œé€šå¸¸ä¼šé€šè¿‡ -p å‚æ•°æ˜ å°„ç›¸åº”çš„æœåŠ¡ç«¯å£ï¼Œä¸€èˆ¬ä¸ä¼šé‡åˆ°è¦ç›´æ¥è®¿é—®å®¹å™¨ IP çš„æƒ…å†µã€‚ä½†å¯¹äº Kubernetes æ¥è®²ï¼Œå¾ˆå¤šæ—¶å€™éƒ½æƒ³è¦ç›´æ¥è®¿é—® Pod IP æˆ–è€… Service IP è¿›è¡Œè°ƒè¯•ï¼Œåœ¨ Mac ä¸Šå´æ²¡åŠæ³•å®ç°ã€‚</p>

<p>Docker for Mac åŸºæœ¬åŸç†
è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¾—å…ˆææ¸…æ¥š Docker for Macçš„åŸç†ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ Docker æ˜¯åˆ©ç”¨ Linux çš„ Namespace å’Œ Cgroups æ¥å®ç°èµ„æºçš„éš”ç¦»å’Œé™åˆ¶ï¼Œå®¹å™¨å…±äº«å®¿ä¸»æœºå†…æ ¸ï¼Œæ‰€ä»¥ Mac æœ¬èº«æ²¡æ³•è¿è¡Œ Docker å®¹å™¨ã€‚ä¸è¿‡ä¸æ”¯æŒä¸è¦ç´§ï¼Œæˆ‘ä»¬å¯ä»¥è·‘è™šæ‹Ÿæœºï¼Œæœ€æ—©è¿˜æ²¡æœ‰ Docker for Mac çš„æ—¶å€™ï¼Œå°±æ˜¯é€šè¿‡ docker-machine åœ¨ Virtual Box æˆ–è€… VMWare ç›´æ¥èµ·ä¸€ä¸ª Linux çš„è™šæ‹Ÿæœºï¼Œç„¶ååœ¨ä¸»æœºä¸Šç”¨ Docker Client æ“ä½œè™šæ‹Ÿæœºé‡Œçš„ Docker Serverã€‚</p>

<p>Docker for Mac ä¹Ÿæ˜¯åœ¨æœ¬åœ°è·‘äº†ä¸€ä¸ªè™šæ‹Ÿæœºæ¥è¿è¡Œ Dockerï¼Œä¸è¿‡ Hypervisor é‡‡ç”¨çš„æ˜¯ xhyveï¼Œè€Œ xhyve åˆåŸºäº Mac è‡ªå¸¦çš„è™šæ‹ŸåŒ–æ–¹æ¡ˆ Hypervisor.frameworkï¼Œè™šæ‹Ÿæœºé‡Œè¿è¡Œçš„å‘è¡Œç‰ˆæ˜¯ Docker è‡ªå·±æ‰“åŒ…çš„ LinuxKitï¼Œä¹‹å‰ç”¨çš„å‘è¡Œç‰ˆå¥½åƒæ˜¯ Alpine Linuxã€‚æ€»è€Œè¨€ä¹‹å°±æ˜¯ Docker for Mac è·‘çš„è¿™ä¸ªè™šæ‹Ÿæœºéå¸¸è½»é‡çº§ï¼Œæ€§èƒ½ä¹Ÿä¼šæ›´å¥½ã€‚</p>

<p>å¯ä»¥æ‰“å¼€è™šæ‹Ÿæœºçš„ tty çœ‹çœ‹ï¼š
$ screen ~/Library/Containers/com.docker.docker/Data/com.docker.driver.amd64-linux/tty
Linux linuxkit-025000000001 4.9.87-linuxkit-aufs #1 SMP Fri Mar 16 18:16:33 UTC 2018 x86_64 Linux
linuxkit-025000000001:~#
é—®é¢˜è§£å†³æ€è·¯
å¾ˆç®€å•ï¼Œåœ¨ Docker for Mac çš„è™šæ‹Ÿæœºé‡Œè·‘ä¸€ä¸ª OpenVPN Serverï¼Œç„¶åä»æœ¬åœ°è¿è¿‡å»ã€‚é‰´äº Docker for Mac åœ¨é‡å¯çš„æ—¶å€™ä¸ä¼šä¿ç•™è™šæ‹Ÿæœºé‡Œçš„æ”¹åŠ¨ï¼Œæ‰€ä»¥è¿™ä¸ª OpenVPN Server å¿…é¡»è¦è·‘åœ¨å®¹å™¨é‡Œï¼Œå¹¶ä¸”ç½‘ç»œæ¨¡å¼éœ€è¦è®¾ç½®ä¸º hostï¼Œè¿™æ ·æ‰å¯ä»¥è®¿é—®åˆ°æ‰€æœ‰çš„ Docker ç½‘ç»œã€‚</p>

<p>æµç¨‹å¦‚ä¸‹ï¼š
Mac &lt;-&gt; Tunnelblick &lt;-&gt; socat/service &lt;-&gt; OpenVPN Server &lt;-&gt; Containers
Development Toolkit for Kubernetes on Docker for Mac
æ•´ç†äº†äº›é…ç½®å’Œè„šæœ¬ï¼Œåœ¨ Docker for Mac å¼€äº† Kubernetes åŠŸèƒ½åä¼šæ¯”è¾ƒæœ‰ç”¨ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸Šé¢æåˆ°çš„ OpenVPN æœåŠ¡ã€‚</p>

<p>GitHub é“¾æ¥ docker-for-mac-kubernetes-devkitï¼Œä½¿ç”¨æ–¹æ³•åœ¨ README.md é‡Œä¹Ÿæœ‰è¯¦ç»†ä»‹ç»ã€‚</p>

<p>è®¿é—® Pod/Docker ç½‘ç»œ
æä¾›äº†ä¸¤ç§æ–¹å¼ï¼š</p>

<p>å¦‚æœå¼€äº† Kubernetesï¼Œå¯ä»¥ç”¨ helm å®‰è£…ã€‚
å¦‚æœæ²¡å¼€ï¼Œå¯ä»¥ç”¨ docker-compose èµ· OpenVPN æœåŠ¡ã€‚
å‡†å¤‡å·¥ä½œ
é¦–å…ˆå®‰è£… Mac çš„ OpenVPN çš„å®¢æˆ·ç«¯ Tunnelblickã€‚</p>

<p>ç„¶åå°†ä»£ç  clone ä¸‹æ¥ï¼Œå¹¶è¿›å…¥ docker-for-mac-openvpn ç›®å½•ã€‚
$ git clone git@github.com:pengsrc/docker-for-mac-kubernetes-devkit.git
$ cd docker-for-mac-kubernetes-devkit/docker-for-mac-openvpn
ç”¨ Kubernetes è¿è¡Œ
è£… helmã€‚
åœ¨ local/values.yaml åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç”¨äºæŒ‡å®šä¸€äº›æœ¬åœ°ç›®å½•ã€‚Docker for Mac çš„ File Sharing é…ç½®é‡Œå¿…é¡»åŒ…å«è¿™äº›ç›®å½•ï¼Œå¦åˆ™ OpenVPN æ˜¯æ— æ³•å¯åŠ¨çš„ã€‚
dirPaths:
  # é¡¹ç›®ç›®å½•
  data: /tmp/docker-for-mac-kubernetes-devkit/docker-for-mac-openvpn
  # ç”Ÿæˆçš„ OpenVPN Client çš„é…ç½®æ–‡ä»¶ä¼šæ”¾åˆ°è¿™é‡Œ
  local: /tmp/docker-for-mac-kubernetes-devkit/docker-for-mac-openvpn/local
  # ç”Ÿæˆçš„ OpenVPN Server çš„é…ç½®æ–‡ä»¶ä¼šæ”¾åˆ°è¿™é‡Œ
  configs: /tmp/docker-for-mac-kubernetes-devkit/docker-for-mac-openvpn/local/configs
è¿è¡Œ OpenVPN Serverã€‚æ³¨ï¼š-n å‚æ•°ç”¨äºæŒ‡å®šè¦å®‰è£…åˆ°çš„ namespaceã€‚
1
$ helm install -n docker-for-mac -f local/values.yaml .
ç”¨ Docker Compose è¿è¡Œ
ç”¨ docker-compose èµ·æœåŠ¡æ›´ç®€å•äº›ã€‚
$ # å¯åŠ¨
$ docker-compose up -d
$ # çœ‹çœ‹æ—¥å¿—
$ docker-compose logs -f
é…ç½®å®¢æˆ·ç«¯
èµ· Server çš„æ—¶å€™ä¼šç”Ÿæˆ OpenVPN Client çš„é…ç½®æ–‡ä»¶ï¼Œæ”¾åœ¨ ./local/docker-for-mac.ovpnã€‚æœ€åï¼Œåœ¨é…ç½®æ–‡ä»¶æœ«å°¾åŠ ä¸Šè¦è®¿é—®çš„ç½‘æ®µã€‚</p>

<p>ä¾‹å¦‚ï¼š
route 172.16.0.0 255.255.0.0
route 10.96.0.1 255.240.0.0
æµ‹è¯•
è·‘ä¸ª Nginx çœ‹ä¸‹æ•ˆæœã€‚
$ # å¯åŠ¨ Nginx
$ docker run â€“rm -it nginx</p>

<p>$ # æ‰¾åˆ°å®¹å™¨ IP
$ docker inspect <code class="language-plaintext highlighter-rouge">docker ps | grep nginx | awk '{print $1}'</code> | grep â€˜â€œIPAddressâ€â€™
â€œIPAddressâ€: â€œ172.16.0.11â€,</p>

<p>$ # è®¿é—®ä¸‹
$ curl http://172.16.0.11
&lt;!DOCTYPE html&gt;</p>
<html>
<head>
<title>Welcome to nginx!</title>
...
Nginx Ingress Controller
è¿™ä¸€æ®µç®—æ˜¯è·‘é¢˜äº†ï¼Œdocker-for-mac-kubernetes-devkit è¿˜æä¾›äº†åœ¨ Docker for Mac ä¸Šéƒ¨ç½² Nginx Ingress Controller çš„ Kubernetes Objectsï¼Œæ‰¹é‡ Apply ä¸€ä¸‹å°±å¯ä»¥ä½¿ç”¨ã€‚

$ kubectl apply -f ingress-nginx/namespaces
namespace "ingress-nginx" created

$ kubectl apply -f ingress-nginx/configmaps
configmap "nginx-configuration" created
configmap "tcp-services" created
configmap "udp-services" created

$ kubectl apply -f ingress-nginx/deployments
deployment "default-http-backend" created
deployment "nginx-ingress-controller" created

$ kubectl apply -f ingress-nginx/services
service "default-http-backend" created
service "nginx-ssl" created
service "nginx" created

$ curl http://127.0.0.1
default backend - 404
å°¾å·´
ä» Docker å®£å¸ƒè¦é›†æˆ Kubernetes çš„é‚£ä¸€åˆ»å¼€å§‹ï¼Œå°±æ„å‘³ç€ Kubernetes èµ¢å¾—äº†å®¹å™¨ç¼–æ’é¢†åŸŸçš„èƒœåˆ©ï¼Œå°±è¿æœ€è¿‘åˆšå‘å¸ƒçš„ Rancher 2.0 ä¹Ÿæ˜¯å®Œå…¨åŸºäº Kubernetes çš„ã€‚å›å¤´çœ‹ï¼Œä»ç‰©ç†æœºåˆ°è™šæ‹ŸåŒ–ï¼Œå†ä»è™šæ‹ŸåŒ–åˆ°å®¹å™¨ï¼Œå†åˆ°å®¹å™¨ç¼–æ’å’Œé›†ç¾¤è°ƒåº¦ï¼Œäº‘å¹³å°çš„èƒ½åŠ›èŒƒå›´åœ¨å¾€ä¸Šå±‚èµ°ï¼Œåº”ç”¨æ‰€éœ€è¦å…³æ³¨çš„ç‚¹å‡ ä¹åªå‰©ä¸‹ä¸šåŠ¡é€»è¾‘ã€‚å¦‚æœé—®æœªæ¥çš„å¼€å‘æ¨¡å¼ä¼šæ˜¯æ€æ ·ï¼ŒServerless æˆ–è®¸å°±æ˜¯ç­”æ¡ˆã€‚

https://pjw.io/articles/2018/04/25/access-to-the-container-network-of-docker-for-mac/

https://blog.csdn.net/zhou_438/article/details/103671617

</head></html>
:ET