I"%<p>ç¼–è¯‘æºç ç›®å½•ä¸‹åªæœ‰configure.acæ–‡ä»¶å’ŒMakefile.amæ–‡ä»¶çš„å·¥ç¨‹
<!-- more -->
aclocal</p>

<p>autoconf</p>

<p>autoheader</p>

<p>automake â€“add-missing</p>

<p>./configure</p>

<p>make</p>

<p>sudo make install</p>

<p><img src="https://xiazemin.github.io/MyBlog/img/configure_auto.jpg" /></p>

<p>autoscan: æ‰«ææºä»£ç ä»¥æœå¯»æ™®é€šçš„å¯ç§»æ¤æ€§é—®é¢˜ï¼Œæ¯”å¦‚æ£€æŸ¥ç¼–è¯‘å™¨ï¼Œåº“ï¼Œå¤´æ–‡ä»¶ç­‰ï¼Œç”Ÿæˆæ–‡ä»¶configure.scan,å®ƒæ˜¯configure.acçš„ä¸€ä¸ªé›å½¢ã€‚</p>

<p>aclocal:æ ¹æ®å·²ç»å®‰è£…çš„å®ï¼Œç”¨æˆ·å®šä¹‰å®å’Œacinclude.m4æ–‡ä»¶ä¸­çš„å®å°†configure.acæ–‡ä»¶æ‰€éœ€è¦çš„å®é›†ä¸­å®šä¹‰åˆ°æ–‡ä»¶ aclocal.m4ä¸­ã€‚aclocalæ˜¯ä¸€ä¸ªperl è„šæœ¬ç¨‹åºï¼Œå®ƒçš„å®šä¹‰æ˜¯ï¼šâ€œaclocal - create aclocal.m4 by scanning configure.acâ€</p>

<p>automake:å°†Makefile.amä¸­å®šä¹‰çš„ç»“æ„å»ºç«‹Makefile.inï¼Œç„¶åconfigureè„šæœ¬å°†ç”Ÿæˆçš„Makefile.inæ–‡ä»¶è½¬æ¢ ä¸ºMakefileã€‚å¦‚æœåœ¨configure.acä¸­å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šçš„å®ï¼Œæ¯”å¦‚AC_PROG_LIBTOOLï¼Œå®ƒä¼šè°ƒç”¨libtoolizeï¼Œå¦åˆ™å®ƒ ä¼šè‡ªå·±äº§ç”Ÿconfig.guesså’Œconfig.sub</p>

<p>autoconf:å°†configure.acä¸­çš„å®å±•å¼€ï¼Œç”Ÿæˆconfigureè„šæœ¬ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½è¦ç”¨åˆ°aclocal.m4ä¸­å®šä¹‰çš„å®ã€‚</p>

<p>ä¸‰ã€å®ä¾‹
1.æµ‹è¯•ä»£ç (å®šä¹‰ä¸¤ä¸ªæ–‡ä»¶hello.hå’Œhello.c)
å¤åˆ¶ä»£ç 
/<em>hello.c</em>/
#include <iostream>
#include "hello.h"</iostream></p>

<p>using namespace std;</p>

<p>int main()
{
    CHello a;
    return 0;
}
å¤åˆ¶ä»£ç 
å¤åˆ¶ä»£ç 
/<em>hello.h</em>/
#ifndef <strong>HELLO_H</strong>
#define <strong>HELLO_H</strong></p>

<p>#include<iostream>
using namespace std;</iostream></p>

<p>class CHello
{
public:
    CHello(){ coutÂ«â€œHello!â€Â«endl;}
    ~CHello(){ coutÂ«â€œBye!â€Â«endl;}
};</p>

<p>#endif
å¤åˆ¶ä»£ç 
2.æ“ä½œæ­¥éª¤
(1)å®‰è£…ä¾èµ–çš„åŒ…
[root@bogon autoconfig]# yum -y install automake autoconf
automakeåŒ…æ‹¬:aclocalã€automakeç­‰</p>

<p>autoconfåŒ…æ‹¬ï¼šautoscanã€autoconfç­‰</p>

<p>(2)autoscan
å¤åˆ¶ä»£ç 
[root@bogon autoconfig]# ll
-rw-râ€“râ€“ 1 root root 105 Jun  4 hello.cpp
-rw-râ€“râ€“ 1 root root 189 Jun  4 hello.h
[root@bogon autoconfig]# autoscan
[root@bogon autoconfig]# ll
total 12
-rw-râ€“râ€“ 1 root root   0 Jun  4 autoscan.log
-rw-râ€“râ€“ 1 root root 481 Jun  4 configure.scan
-rw-râ€“râ€“ 1 root root 105 Jun  4 hello.cpp
-rw-râ€“râ€“ 1 root root 189 Jun  4 hello.h
å¤åˆ¶ä»£ç 
(3)aclocal
å¤åˆ¶ä»£ç 
[root@bogon autoconfig]# mv configure.scan configure.ac
[root@bogon autoconfig]# vim configure.ac  /<em>å°†ä¸‹é¢çº¢è‰²åŠ ç²—çš„éƒ¨åˆ†ä¿®æ”¹æ‰</em>/</p>
<h1 id="---autoconf---">-<em>- Autoconf -</em>-</h1>
<h1 id="process-this-file-with-autoconf-to-produce-a-configure-script">Process this file with autoconf to produce a configure script.</h1>
<p>AC_PREREQ([2.69])
AC_INIT(hello, 1.0, admin@163.com)
AM_INIT_AUTOMAKE(hello, 1.0)
AC_CONFIG_SRCDIR([hello.cpp])
AC_CONFIG_HEADERS([config.h])</p>

<h1 id="checks-for-programs">Checks for programs.</h1>
<p>AC_PROG_CXX
AC_PROG_CC</p>

<h1 id="checks-for-libraries">Checks for libraries.</h1>
<h1 id="checks-for-header-files">Checks for header files.</h1>
<h1 id="checks-for-typedefs-structures-and-compiler-characteristics">Checks for typedefs, structures, and compiler characteristics.</h1>
<h1 id="checks-for-library-functions">Checks for library functions.</h1>
<p>AC_OUTPUT(Makefile)
[root@bogon autoconfig]# aclocal
[root@bogon autoconfig]# ll
total 52
-rw-râ€“râ€“ 1 root root 37794 Jun  4 aclocal.m4
drwxr-xr-x 2 root root    51 Jun  4 autom4te.cache
-rw-râ€“râ€“ 1 root root     0 Jun  4 autoscan.log
-rw-râ€“râ€“ 1 root root   492 Jun  4 configure.ac
-rw-râ€“râ€“ 1 root root   105 Jun  4 hello.cpp
-rw-râ€“râ€“ 1 root root   189 Jun  4 hello.h
å¤åˆ¶ä»£ç 
ä¸‹é¢ç»™å‡ºæœ¬æ–‡ä»¶çš„ç®€è¦è¯´æ˜ï¼ˆæ‰€æœ‰ä»¥â€#â€å·å¼€å§‹çš„è¡Œä¸ºæ³¨é‡Šï¼‰ï¼š
Â· AC_PREREQ å®å£°æ˜æœ¬æ–‡ä»¶è¦æ±‚çš„autoconfç‰ˆæœ¬ï¼Œæœ¬ä¾‹ä½¿ç”¨çš„ç‰ˆæœ¬ä¸º2.59ã€‚
Â· AC_INIT å®ç”¨æ¥å®šä¹‰è½¯ä»¶çš„åç§°å’Œç‰ˆæœ¬ç­‰ä¿¡æ¯ï¼Œâ€FULL-PACKAGE-NAMEâ€ä¸ºè½¯ä»¶åŒ…åç§°ï¼Œâ€VERSIONâ€ä¸ºè½¯ä»¶ç‰ˆæœ¬å·ï¼Œâ€BUG-REPORT-ADDRESSâ€ä¸ºBUGæŠ¥å‘Šåœ°å€ï¼ˆä¸€èˆ¬ä¸ºè½¯ä»¶ä½œè€…é‚®ä»¶åœ°å€ï¼‰ã€‚
Â·AC_CONFIG_SRCDIR å®ç”¨æ¥ä¾¦æµ‹æ‰€æŒ‡å®šçš„æºç æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæ¥ç¡®å®šæºç ç›®å½•çš„æœ‰æ•ˆæ€§ã€‚æ­¤å¤„ä¸ºå½“å‰ç›®å½•ä¸‹çš„hello.cã€‚
Â·AC_CONFIG_HEADER å®ç”¨äºç”Ÿæˆconfig.hæ–‡ä»¶ï¼Œä»¥ä¾¿autoheaderä½¿ç”¨ã€‚
Â·AC_PROG_CC ç”¨æ¥æŒ‡å®šç¼–è¯‘å™¨ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé€‰ç”¨é»˜è®¤gccã€‚
Â·AC_OUTPUT ç”¨æ¥è®¾å®š configure æ‰€è¦äº§ç”Ÿçš„æ–‡ä»¶ï¼Œå¦‚æœæ˜¯makefileï¼Œconfigureä¼šæŠŠå®ƒæ£€æŸ¥å‡ºæ¥çš„ç»“æœå¸¦å…¥makefile.inæ–‡ä»¶äº§ç”Ÿåˆé€‚çš„makefileã€‚ä½¿ç”¨Automakeæ—¶ï¼Œè¿˜éœ€è¦ä¸€äº›å…¶ä»–çš„å‚æ•°ï¼Œè¿™äº›é¢å¤–çš„å®ç”¨aclocalå·¥å…·äº§ç”Ÿã€‚</p>

<p>(3)autoconf
å¤åˆ¶ä»£ç 
[root@bogon autoconfig]# autoconf
[root@bogon autoconfig]# ll
total 204
-rw-râ€“râ€“ 1 root root  37794 Jun  4 aclocal.m4
drwxr-xr-x 2 root root     81 Jun  4 autom4te.cache
-rw-râ€“râ€“ 1 root root      0 Jun  4 autoscan.log
-rwxr-xr-x 1 root root 154727 Jun  4 configure
-rw-râ€“râ€“ 1 root root    492 Jun  4 configure.ac
-rw-râ€“râ€“ 1 root root    105 Jun  4 hello.cpp
-rw-râ€“râ€“ 1 root root    189 Jun  4 hello.h
å¤åˆ¶ä»£ç 
æ­¤æ—¶å¯ä»¥çœ‹åˆ°å·²ç»ç”Ÿæˆäº†configure</p>

<p>(4)autoheader
å¤åˆ¶ä»£ç 
[root@bogon autoconfig]# autoheader
[root@bogon autoconfig]# ll
total 208
-rw-râ€“râ€“ 1 root root  37794 Jun  4 aclocal.m4
drwxr-xr-x 2 root root     81 Jun  4 autom4te.cache
-rw-râ€“râ€“ 1 root root      0 Jun  4 autoscan.log
-rw-râ€“râ€“ 1 root root    625 Jun  4 config.h.in
-rwxr-xr-x 1 root root 154727 Jun  4 configure
-rw-râ€“râ€“ 1 root root    492 Jun  4 configure.ac
-rw-râ€“râ€“ 1 root root    105 Jun  4 hello.cpp
-rw-râ€“râ€“ 1 root root    189 Jun  4 hello.h
å¤åˆ¶ä»£ç 
autoheaderç”Ÿæˆäº†configure.h.inå¦‚æœåœ¨configure.acä¸­å®šä¹‰äº†AC_CONFIG_HEADERï¼Œé‚£ä¹ˆæ­¤æ–‡ä»¶å°±éœ€è¦ï¼›</p>

<p>(5)Makefile.am
[root@bogon autoconfig]# vim Makefile.am
[root@bogon autoconfig]# cat Makefile.am 
AUTOMAKE_OPTIONS=foreign 
bin_PROGRAMS=hello 
hello_SOURCES=hello.cpp hello.h
Â· AUTOMAKE_OPTIONS ä¸ºè®¾ç½®Automakeçš„é€‰é¡¹ã€‚ç”±äºGNUå¯¹è‡ªå·±å‘å¸ƒçš„è½¯ä»¶æœ‰ä¸¥æ ¼çš„è§„èŒƒï¼Œæ¯”å¦‚å¿…é¡»é™„å¸¦è®¸å¯è¯å£°æ˜æ–‡ä»¶COPYINGç­‰ï¼Œå¦åˆ™Automakeæ‰§è¡Œæ—¶ä¼šæŠ¥é”™ã€‚Automakeæä¾›äº†3ç§è½¯ä»¶ç­‰çº§ï¼šforeignã€gnuå’Œgnitsï¼Œä¾›ç”¨æˆ·é€‰æ‹©ï¼Œé»˜è®¤ç­‰çº§ä¸ºgnuã€‚æœ¬ä¾‹ä½¿éœ€ç”¨foreignç­‰çº§ï¼Œå®ƒåªæ£€æµ‹å¿…é¡»çš„æ–‡ä»¶ã€‚
Â· bin_PROGRAMS å®šä¹‰è¦äº§ç”Ÿçš„æ‰§è¡Œæ–‡ä»¶åã€‚å¦‚æœè¦äº§ç”Ÿå¤šä¸ªæ‰§è¡Œæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶åç”¨ç©ºæ ¼éš”å¼€ã€‚
Â· hello_SOURCES å®šä¹‰â€helloâ€è¿™ä¸ªæ‰§è¡Œç¨‹åºæ‰€éœ€è¦çš„åŸå§‹æ–‡ä»¶ã€‚å¦‚æœâ€helloâ€è¿™ä¸ªç¨‹åºæ˜¯ç”±å¤šä¸ªåŸå§‹æ–‡ä»¶æ‰€äº§ç”Ÿçš„ï¼Œåˆ™å¿…é¡»æŠŠå®ƒæ‰€ç”¨åˆ°çš„æ‰€æœ‰åŸå§‹æ–‡ä»¶éƒ½åˆ—å‡ºæ¥ï¼Œå¹¶ç”¨ç©ºæ ¼éš”å¼€ã€‚ä¾‹å¦‚ï¼šè‹¥ç›®æ ‡ä½“â€helloâ€éœ€è¦â€hello.câ€ã€â€hello.hâ€ä¸¤ä¸ªä¾èµ–æ–‡ä»¶ï¼Œåˆ™å®šä¹‰hello_SOURCES=hello.c hello.hã€‚</p>

<p>(6)automake
å¤åˆ¶ä»£ç 
[root@bogon autoconfig]# automake â€“add-missing
configure.ac:6: warning: AM_INIT_AUTOMAKE: two- and three-arguments forms are deprecated.  For more info, see:
configure.ac:6: http://www.gnu.org/software/automake/manual/automake.html#Modernize-AM_005fINIT_005fAUTOMAKE-invocation
configure.ac:6: installing â€˜./install-shâ€™
configure.ac:6: installing â€˜./missingâ€™
[root@bogon autoconfig]# ll
total 236
-rw-râ€“râ€“ 1 root root  37794 Jun  4  aclocal.m4
drwxr-xr-x 2 root root     81 Jun  4  autom4te.cache
-rw-râ€“râ€“ 1 root root      0 Jun  4  autoscan.log
-rw-râ€“râ€“ 1 root root    625 Jun  4  config.h.in
-rwxr-xr-x 1 root root 154727 Jun  4  configure
-rw-râ€“râ€“ 1 root root    492 Jun  4  configure.ac
-rw-râ€“râ€“ 1 root root    105 Jun  4  hello.cpp
-rw-râ€“râ€“ 1 root root    189 Jun  4  hello.h
lrwxrwxrwx 1 root root     35 Jun  4  install-sh -&gt; /usr/share/automake-1.13/install-sh
-rw-râ€“râ€“ 1 root root     79 Jun  4  Makefile.am
-rw-râ€“râ€“ 1 root root  22227 Jun  4  Makefile.in
lrwxrwxrwx 1 root root     32 Jun  4  missing -&gt; /usr/share/automake-1.13/missing
å¤åˆ¶ä»£ç 
æ­¤æ­¥ä¸»è¦æ˜¯ä¸ºäº†ç”ŸæˆMakefile.inï¼ŒåŠ ä¸Šâ€“add-missingå‚æ•°åï¼Œä¼šè¡¥å…¨ç¼ºå°‘çš„è„šæœ¬ï¼›</p>

<p>(6)æµ‹è¯•
[root@bogon autoconfig]# ./configure
[root@bogon autoconfig]# make
[root@bogon autoconfig]# ./hello
Hello!
Bye!
å’Œå¹³æ—¶å®‰è£…è®¸å¤šå¼€æºè½¯ä»¶ä¸€æ ·æ“ä½œ</p>

<p>(7)æ‰“åŒ…
å¤åˆ¶ä»£ç 
[root@bogon autoconfig]# make dist
[root@bogon autoconfig]# ll
total 436
-rw-râ€“râ€“ 1 root root  37794 Jun  4 aclocal.m4
drwxr-xr-x 2 root root     81 Jun  4 autom4te.cache
-rw-râ€“râ€“ 1 root root      0 Jun  4 autoscan.log
-rw-râ€“râ€“ 1 root root    758 Jun  4 config.h
-rw-râ€“râ€“ 1 root root    625 Jun  4 config.h.in
-rw-râ€“râ€“ 1 root root  11031 Jun  4 config.log
-rwxr-xr-x 1 root root  32557 Jun  4 config.status
-rwxr-xr-x 1 root root 154727 Jun  4 configure
-rw-râ€“râ€“ 1 root root    492 Jun  4 configure.ac
lrwxrwxrwx 1 root root     32 Jun  4 depcomp -&gt; /usr/share/automake-1.13/depcomp
-rwxr-xr-x 1 root root  22250 Jun  4 hello
-rw-râ€“râ€“ 1 root root  72021 Jun  4 hello-1.0.tar.gz
-rw-râ€“râ€“ 1 root root    105 Jun  4 hello.cpp
-rw-râ€“râ€“ 1 root root    189 Jun  4 hello.h
-rw-râ€“râ€“ 1 root root  26008 Jun  4 hello.o
lrwxrwxrwx 1 root root     35 Jun  4 install-sh -&gt; /usr/share/automake-1.13/install-sh
-rw-râ€“râ€“ 1 root root  23564 Jun  4 Makefile
-rw-râ€“râ€“ 1 root root     79 Jun  4 Makefile.am
-rw-râ€“râ€“ 1 root root  23869 Jun  4 Makefile.in
lrwxrwxrwx 1 root root     32 Jun  4 missing -&gt; /usr/share/automake-1.13/missing
-rw-râ€“râ€“ 1 root root     23 Jun  4 stamp-h1
å¤åˆ¶ä»£ç 
å¦‚æœç»†å¿ƒçš„è¯å¯ä»¥å‘ç°ï¼Œäººç¾¤ä¸­å·²ç»å‡ºç°äº†hello-1.0.tar.gzå°±æ˜¯å°†å·²ç»ç¼–è¯‘å¥½çš„æ–‡ä»¶è¿›è¡Œäº†æ‰“åŒ…ã€‚</p>
:ET