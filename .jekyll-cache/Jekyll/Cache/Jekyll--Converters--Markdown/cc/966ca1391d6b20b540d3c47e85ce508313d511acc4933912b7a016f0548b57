I"•Æ<p>å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ä¸»è¦è¦ç‚¹åœ¨äºå€ŸåŠ©å¯„å­˜å™¨å’Œå†…å­˜å¸§æ ˆä¼ é€’å‚æ•°å’Œè¿”å›å€¼ã€‚è™½ç„¶åŒä¸ºç¼–è¯‘å‹è¯­è¨€ï¼ŒGo ç›¸è¾ƒ C å¯¹å¯„å­˜å™¨å’Œæ ˆçš„ä½¿ç”¨æœ‰ä¸€äº›å·®åˆ«ï¼ŒåŒæ—¶ï¼ŒGo è¯­è¨€è‡ªå¸¦åç¨‹å¹¶å¼•å…¥ defer ç­‰è¯­å¥ï¼Œåœ¨è°ƒç”¨è¿‡ç¨‹ä¸Šæ˜¾å¾—æ›´åŠ å¤æ‚ã€‚ ç†è§£Goå‡½æ•°è°ƒç”¨åœ¨CPUæŒ‡ä»¤å±‚çš„è¿‡ç¨‹æœ‰åŠ©äºç¼–å†™é«˜æ•ˆçš„ä»£ç ï¼Œåœ¨æ€§èƒ½ä¼˜åŒ–ã€Bugæ’æŸ¥çš„æ—¶å€™ï¼Œèƒ½æ›´è¿…é€Ÿçš„ç¡®å®šè¦ç‚¹ã€‚æœ¬æ–‡ä»¥ç®€çŸ­çš„ç¤ºä¾‹ä»£ç å’Œå¯¹åº”çš„æ±‡ç¼–ä»£ç æ¼”ç¤ºäº†Goçš„è°ƒç”¨è¿‡ç¨‹ï¼Œå±•ç¤ºäº†ä¸åŒæ•°æ®ç±»å‹çš„å‚æ•°çš„å®é™…ä¼ é€’è¿‡ç¨‹ï¼ŒåŒæ—¶åˆ†æäº†åŒ¿åå‡½æ•°ã€é—­åŒ…ä½œä¸ºå‚æ•°æˆ–è€…è¿”å›å€¼ä¼ é€’æ—¶ï¼Œåœ¨å†…å­˜ä¸Šçš„å®é™…æ•°æ®ç»“æ„ã€‚å¯¹äºåç¨‹å¯¹æ ˆçš„ä½¿ç”¨å’Œå®ç°ç»†èŠ‚ï¼Œæœ¬æ–‡ä¸å±•å¼€ã€‚
<!-- more -->
æœ¯è¯­
æ ˆï¼šæ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹/goroutineæœ‰è‡ªå·±çš„è°ƒç”¨æ ˆï¼Œå‚æ•°å’Œè¿”å›å€¼ä¼ é€’ã€å‡½æ•°çš„å±€éƒ¨å˜é‡å­˜æ”¾é€šå¸¸é€šè¿‡æ ˆè¿›è¡Œã€‚å’Œæ•°æ®ç»“æ„ä¸­çš„æ ˆä¸€æ ·ï¼Œå†…å­˜æ ˆä¹Ÿæ˜¯åè¿›å…ˆå‡ºï¼Œåœ°å€æ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€ç”Ÿé•¿ã€‚
æ ˆå¸§ï¼šï¼ˆstack frameï¼‰åˆå¸¸è¢«ç§°ä¸ºå¸§ï¼ˆframeï¼‰ã€‚ä¸€ä¸ªæ ˆæ˜¯ç”±å¾ˆå¤šå¸§æ„æˆçš„ï¼Œå®ƒæè¿°äº†å‡½æ•°ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚æ¯ä¸€å¸§å°±å¯¹åº”äº†ä¸€æ¬¡å°šæœªè¿”å›çš„å‡½æ•°è°ƒç”¨ï¼Œå¸§æœ¬èº«ä¹Ÿæ˜¯ä»¥æ ˆçš„å½¢å¼å­˜æ”¾æ•°æ®çš„ã€‚
caller è°ƒç”¨è€…
callee è¢«è°ƒç”¨è€…ï¼Œå¦‚åœ¨ å‡½æ•° A é‡Œ è°ƒç”¨ å‡½æ•° Bï¼ŒA æ˜¯ callerï¼ŒB æ˜¯ callee
å¯„å­˜å™¨(X86)</p>

<p>ESPï¼šæ ˆæŒ‡é’ˆå¯„å­˜å™¨(extended stack pointer)ï¼Œå­˜æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘æ ˆæœ€ä¸Šé¢ä¸€ä¸ªæ ˆå¸§(å³å½“å‰æ‰§è¡Œçš„å‡½æ•°çš„æ ˆ)çš„æ ˆé¡¶ã€‚æ³¨æ„ï¼š
ESPæŒ‡å‘çš„æ˜¯å·²ç»å­˜å‚¨äº†å†…å®¹çš„å†…å­˜åœ°å€ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç©ºé—²çš„åœ°å€ã€‚ä¾‹å¦‚ä» 0xC0000000 åˆ° 0xC00000FFæ˜¯å·²ç»ä½¿ç”¨çš„æ ˆç©ºé—´ï¼ŒESPæŒ‡å‘0xC00000FF
EBPï¼šåŸºå€æŒ‡é’ˆå¯„å­˜å™¨(extended base pointer)ï¼Œä¹Ÿå«å¸§æŒ‡é’ˆï¼Œå­˜æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘æ ˆæœ€ä¸Šé¢ä¸€ä¸ªæ ˆå¸§çš„åº•éƒ¨ã€‚
EIPï¼šå¯„å­˜å™¨å­˜æ”¾ä¸‹ä¸€ä¸ªCPUæŒ‡ä»¤å­˜æ”¾çš„å†…å­˜åœ°å€ï¼Œå½“CPUæ‰§è¡Œå®Œå½“å‰çš„æŒ‡ä»¤åï¼Œä»EIPå¯„å­˜å™¨ä¸­è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤çš„å†…å­˜åœ°å€ï¼Œç„¶åç»§ç»­æ‰§è¡Œã€‚
æ³¨æ„ï¼š16ä½å¯„å­˜å™¨æ²¡æœ‰å‰ç¼€(SPã€BPã€IP)ï¼Œ32ä½å‰ç¼€æ˜¯E(ESPã€EBPã€EIP)ï¼Œ64ä½å‰ç¼€æ˜¯R(RSPã€RBPã€RIP)</p>

<p>æ±‡ç¼–æŒ‡ä»¤</p>

<p>PUSHï¼šè¿›æ ˆæŒ‡ä»¤ï¼ŒPUSHæŒ‡ä»¤æ‰§è¡Œæ—¶ä¼šå…ˆå°†ESPå‡4ï¼Œæ¥ç€å°†å†…å®¹å†™å…¥ESPæŒ‡å‘çš„æ ˆå†…å­˜ã€‚
POP ï¼šå‡ºæ ˆæŒ‡ä»¤ï¼ŒPOPæŒ‡ä»¤æ‰§è¡Œæ—¶å…ˆå°†ESPæŒ‡å‘çš„æ ˆå†…å­˜çš„ä¸€ä¸ªå­—é•¿çš„å†…å®¹è¯»å‡ºï¼Œæ¥ç€å°†ESPåŠ 4ã€‚æ³¨æ„ï¼š
ç”¨PUSHæŒ‡ä»¤å’ŒPOPæŒ‡ä»¤æ—¶åªèƒ½æŒ‰å­—è®¿é—®æ ˆï¼Œä¸èƒ½æŒ‰å­—èŠ‚è®¿é—®æ ˆã€‚
CALLï¼šè°ƒç”¨å‡½æ•°æŒ‡ä»¤ï¼Œå°†è¿”å›åœ°å€ï¼ˆcallæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼‰å‹æ ˆï¼Œæ¥ç€è·³è½¬åˆ°å‡½æ•°å…¥å£ã€‚
RETï¼šè¿”å›æŒ‡ä»¤ï¼Œå°†æ ˆé¡¶è¿”å›åœ°å€å¼¹å‡ºåˆ°EIPï¼Œæ¥ç€æ ¹æ®EIPç»§ç»­æ‰§è¡Œã€‚
LEAVEï¼šç­‰ä»·äº mov esp,ebp; pop ebp;
MOVLï¼šåœ¨å†…å­˜ä¸å¯„å­˜å™¨ã€å¯„å­˜å™¨ä¸å¯„å­˜å™¨ä¹‹é—´è½¬ç§»å€¼
LEALï¼šç”¨æ¥å°†ä¸€ä¸ªå†…å­˜åœ°å€ç›´æ¥èµ‹ç»™ç›®çš„æ“ä½œæ•°
æ³¨æ„ï¼š8ä½æŒ‡ä»¤åç¼€æ˜¯Bã€16ä½æ˜¯Sã€32ä½æ˜¯Lã€64ä½æ˜¯Q</p>

<p>è°ƒç”¨æƒ¯ä¾‹
è°ƒç”¨æƒ¯ä¾‹(calling convention)æ˜¯æŒ‡ç¨‹åºé‡Œè°ƒç”¨å‡½æ•°æ—¶å…³äºå¦‚ä½•ä¼ å‚å¦‚ä½•åˆ†é…å’Œæ¸…ç†æ ˆç­‰çš„æ–¹æ¡ˆã€‚ä¸€ä¸ªè°ƒç”¨æƒ¯ä¾‹çš„å†…å®¹åŒ…æ‹¬ï¼š</p>

<p>å‚æ•°æ˜¯é€šè¿‡å¯„å­˜å™¨ä¼ é€’è¿˜æ˜¯æ ˆä¼ é€’æˆ–è€…äºŒè€…æ··åˆ
é€šè¿‡æ ˆä¼ é€’æ—¶å‚æ•°æ˜¯ä»å·¦è‡³å³å‹æ ˆè¿˜æ˜¯ä»å³è‡³å·¦å‹æ ˆ
å‡½æ•°ç»“æœæ˜¯é€šè¿‡å¯„å­˜å™¨ä¼ é€’è¿˜æ˜¯é€šè¿‡æ ˆä¼ é€’
è°ƒç”¨è€…(caller)è¿˜æ˜¯è¢«è°ƒç”¨è€…(callee)æ¸…ç†æ ˆç©ºé—´
è¢«è°ƒç”¨è€…åº”è¯¥ä¸ºè°ƒç”¨è€…ä¿å­˜å“ªäº›å¯„å­˜å™¨
ä¾‹å¦‚ï¼ŒC çš„è°ƒç”¨æƒ¯ä¾‹(cdecl, C declaration)æ˜¯ï¼š</p>

<p>å‡½æ•°å®å‚åœ¨çº¿ç¨‹æ ˆä¸ŠæŒ‰ç…§ä»å³è‡³å·¦çš„é¡ºåºä¾æ¬¡å‹æ ˆã€‚
å‡½æ•°ç»“æœä¿å­˜åœ¨å¯„å­˜å™¨EAX/AX/ALä¸­
æµ®ç‚¹å‹ç»“æœå­˜æ”¾åœ¨å¯„å­˜å™¨ST0ä¸­
ç¼–è¯‘åçš„å‡½æ•°åå‰ç¼€ä»¥ä¸€ä¸ªä¸‹åˆ’çº¿å­—ç¬¦
è°ƒç”¨è€…è´Ÿè´£ä»çº¿ç¨‹æ ˆä¸­å¼¹å‡ºå®å‚ï¼ˆå³æ¸…æ ˆï¼‰
8æ¯”ç‰¹æˆ–è€…16æ¯”ç‰¹é•¿çš„æ•´å½¢å®å‚æå‡ä¸º32æ¯”ç‰¹é•¿ã€‚
å—åˆ°å‡½æ•°è°ƒç”¨å½±å“çš„å¯„å­˜å™¨ï¼ˆvolatile registersï¼‰ï¼šEAX, ECX, EDX, ST0 - ST7, ES, GS
ä¸å—å‡½æ•°è°ƒç”¨å½±å“çš„å¯„å­˜å™¨ï¼š EBX, EBP, ESP, EDI, ESI, CS, DS
RETæŒ‡ä»¤ä»å‡½æ•°è¢«è°ƒç”¨è€…è¿”å›åˆ°è°ƒç”¨è€…ï¼ˆå®è´¨ä¸Šæ˜¯è¯»å–å¯„å­˜å™¨EBPæ‰€æŒ‡çš„çº¿ç¨‹æ ˆä¹‹å¤„ä¿å­˜çš„å‡½æ•°è¿”å›åœ°å€å¹¶åŠ è½½åˆ°IPå¯„å­˜å™¨ï¼‰
cdecl å°†å‡½æ•°è¿”å›å€¼ä¿å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œæ‰€ä»¥ C è¯­è¨€ä¸æ”¯æŒå¤šä¸ªè¿”å›å€¼ã€‚å¦å¤–ï¼Œcdecl æ˜¯è°ƒç”¨è€…è´Ÿè´£æ¸…æ ˆï¼Œå› è€Œå¯ä»¥å®ç°å¯å˜å‚æ•°çš„å‡½æ•°ã€‚å¦‚æœæ˜¯è¢«è°ƒç”¨è€…è´Ÿè´£æ¸…ç†çš„è¯ï¼Œæ— æ³•å®ç°å¯å˜å‚æ•°çš„å‡½æ•°ï¼Œä½†æ˜¯ç¼–è¯‘ä»£ç çš„æ•ˆç‡ä¼šé«˜ä¸€ç‚¹ï¼Œå› ä¸ºæ¸…ç†æ ˆçš„ä»£ç ä¸ç”¨åœ¨æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™(ç¼–è¯‘å™¨è®¡ç®—)ç”Ÿæˆä¸€éã€‚(x86çš„retæŒ‡ä»¤å…è®¸ä¸€ä¸ªå¯é€‰çš„16ä½å‚æ•°è¯´æ˜æ ˆå­—èŠ‚æ•°ï¼Œç”¨æ¥åœ¨è¿”å›ç»™è°ƒç”¨è€…ä¹‹å‰è§£å †æ ˆã€‚ä»£ç ç±»ä¼¼ret 12è¿™æ ·ï¼Œå¦‚æœé‡åˆ°è¿™æ ·çš„æ±‡ç¼–ä»£ç ï¼Œè¯´æ˜æ˜¯è¢«è°ƒç”¨è€…æ¸…æ ˆã€‚)</p>

<p>æ³¨æ„ï¼Œè™½ç„¶ C è¯­è¨€ é‡Œéƒ½æ˜¯å€ŸåŠ©å¯„å­˜å™¨ä¼ é€’è¿”å›å€¼ï¼Œä½†æ˜¯è¿”å›å€¼å¤§å°ä¸åŒæ—¶æœ‰ä¸åŒçš„å¤„ç†æƒ…å½¢ã€‚è‹¥å°äº4å­—èŠ‚ï¼Œè¿”å›å€¼å­˜å…¥eaxå¯„å­˜å™¨ï¼Œç”±å‡½æ•°è°ƒç”¨æ–¹è¯»å–eaxã€‚è‹¥è¿”å›å€¼5åˆ°8å­—èŠ‚ï¼Œé‡‡ç”¨eaxå’Œedxè”åˆè¿”å›ã€‚è‹¥å¤§äº8ä¸ªå­—èŠ‚ï¼Œé¦–å…ˆåœ¨æ ˆä¸Šé¢å¤–å¼€è¾Ÿä¸€éƒ¨åˆ†ç©ºé—´tempï¼Œå°†tempå¯¹è±¡çš„åœ°å€åšä¸ºéšè—å‚æ•°å…¥æ ˆã€‚å‡½æ•°è¿”å›æ—¶å°†æ•°æ®æ‹·è´ç»™tempå¯¹è±¡ï¼Œå¹¶å°†tempå¯¹è±¡çš„åœ°å€ç”¨å¯„å­˜å™¨eaxä¼ å‡ºã€‚è°ƒç”¨æ–¹ä»eaxæŒ‡å‘çš„tempå¯¹è±¡æ‹·è´å†…å®¹ã€‚</p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè®¾è®¡ä¸€ä¸ªç¼–ç¨‹è¯­è¨€çš„ç‰¹æ€§æ—¶ï¼Œéœ€è¦ä¸ºå…¶é€‰æ‹©åˆé€‚è°ƒç”¨æƒ¯ä¾‹æ‰èƒ½åœ¨åº•å±‚å®ç°è¿™äº›ç‰¹æ€§ã€‚(è°ƒç”¨æƒ¯ä¾‹æ˜¯ç¼–ç¨‹è¯­è¨€çš„ç¼–è¯‘å™¨é€‰æ‹©çš„ï¼ŒåŒæ ·çš„è¯­è¨€ä¸åŒçš„ç¼–è¯‘å™¨å¯èƒ½ä¼šé€‰æ‹©å®ç°ä¸åŒçš„è°ƒç”¨æƒ¯ä¾‹ï¼‰</p>

<p>ä¸€æ¬¡å…¸å‹çš„ C å‡½æ•°è°ƒç”¨è¿‡ç¨‹
åœ¨calleré‡Œï¼š</p>

<p>å°†å®å‚ä»å³è‡³å·¦å‹æ ˆ(X86-64ä¸‹æ˜¯ï¼šå°†å®å‚å†™å…¥å¯„å­˜å™¨ï¼Œå¦‚æœå®å‚è¶…è¿‡ 6 ä¸ªï¼Œè¶…å‡ºçš„ä»å³è‡³å·¦å‹æ ˆ)
æ‰§è¡Œ call æŒ‡ä»¤(ä¼šå°†è¿”å›åœ°å€å‹æ ˆï¼Œå¹¶è·³è½¬åˆ° callee å…¥å£)
è¿›å…¥calleeé‡Œï¼š</p>

<p>push ebp; mov ebp,esp; æ­¤æ—¶EBPå’ŒESPå·²ç»åˆ†åˆ«è¡¨ç¤ºcalleeçš„æ ˆåº•å’Œæ ˆé¡¶äº†ã€‚ä¹‹å EBP çš„å€¼ä¼šä¿æŒå›ºå®šã€‚æ­¤åå±€éƒ¨å˜é‡å’Œä¸´æ—¶å­˜å‚¨éƒ½å¯ä»¥é€šè¿‡åŸºå‡†æŒ‡é’ˆEBPåŠ åç§»é‡æ‰¾åˆ°äº†ã€‚
sub xxx, esp; æ ˆé¡¶ä¸‹ç§»ï¼Œä¸ºcalleeåˆ†é…ç©ºé—´ï¼Œç”¨äºå­˜æ”¾å±€éƒ¨å˜é‡ç­‰ã€‚åˆ†é…çš„å†…å­˜å•å…ƒå¯ä»¥é€šè¿‡ EBP - K æˆ–è€… ESP + K å¾—åˆ°åœ°å€è®¿é—®ã€‚
å°†æŸäº›å¯„å­˜å™¨çš„å€¼å‹æ ˆ(å¯èƒ½)
calleeæ‰§è¡Œ
å°†æŸäº›å¯„å­˜å™¨å€¼å¼¹å‡ºæ ˆ(å¯èƒ½)
mov esp,ebp; pop ebp; (è¿™ä¸¤æ¡æŒ‡ä»¤ä¹Ÿå¯ä»¥ç”¨ leave æŒ‡ä»¤æ›¿ä»£)æ­¤æ—¶ EBP å’Œ ESP å›åˆ°äº†è¿›å…¥calleeä¹‹å‰çš„çŠ¶æ€ï¼Œå³åˆ†åˆ«è¡¨ç¤ºcallerçš„æ ˆåº•å’Œæ ˆé¡¶çŠ¶æ€ã€‚
æ‰§è¡Œ ret æŒ‡ä»¤
å›åˆ°äº†calleré‡Œçš„ä»£ç 
	<img src="https://xiazemin.github.io/MyBlog/img/ebp.png" />
	int add(int arg1, int arg2, int arg3, int arg4, int arg5, int arg6, int arg7, int arg8) {
    return arg1 + arg2 + arg3 + arg4 + arg5 + arg6 + arg7 + arg8;
}</p>

<p>int main() {
    int i = add(1, 2, 3 , 4, 5, 6, 7, 8);
}</p>

<p>x86ç‰ˆæ±‡ç¼–
   .section    __TEXT,__text,regular,pure_instructions
    .build_version macos, 10, 14    sdk_version 10, 14
    .globl  _add                    ## â€“ Begin function add
    .p2align    4, 0x90
_add:                                   ## @add
    .cfi_startproc</p>
<h2 id="bb0">%bb.0:</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pushl   %ebp
.cfi_def_cfa_offset 8
.cfi_offset %ebp, -8
movl    %esp, %ebp
.cfi_def_cfa_register %ebp
pushl   %ebx
pushl   %edi
pushl   %esi
subl    $32, %esp
.cfi_offset %esi, -20
.cfi_offset %edi, -16
.cfi_offset %ebx, -12
movl    36(%ebp), %eax
movl    32(%ebp), %ecx
movl    28(%ebp), %edx
movl    24(%ebp), %esi
movl    20(%ebp), %edi
movl    16(%ebp), %ebx
movl    %eax, -16(%ebp)         ## 4-byte Spill
movl    12(%ebp), %eax
movl    %eax, -20(%ebp)         ## 4-byte Spill
movl    8(%ebp), %eax
movl    %eax, -24(%ebp)         ## 4-byte Spill
movl    8(%ebp), %eax
addl    12(%ebp), %eax
addl    16(%ebp), %eax
addl    20(%ebp), %eax
addl    24(%ebp), %eax
addl    28(%ebp), %eax
addl    32(%ebp), %eax
addl    36(%ebp), %eax
movl    %ebx, -28(%ebp)         ## 4-byte Spill
movl    %ecx, -32(%ebp)         ## 4-byte Spill
movl    %edx, -36(%ebp)         ## 4-byte Spill
movl    %esi, -40(%ebp)         ## 4-byte Spill
movl    %edi, -44(%ebp)         ## 4-byte Spill
addl    $32, %esp
popl    %esi
popl    %edi
popl    %ebx
popl    %ebp
retl
.cfi_endproc
                                    ## -- End function
.globl  _main                   ## -- Begin function main
.p2align    4, 0x90 _main:                                  ## @main
.cfi_startproc ## %bb.0:
pushl   %ebp
.cfi_def_cfa_offset 8
.cfi_offset %ebp, -8
movl    %esp, %ebp
.cfi_def_cfa_register %ebp
subl    $40, %esp
movl    $1, (%esp)
movl    $2, 4(%esp)
movl    $3, 8(%esp)
movl    $4, 12(%esp)
movl    $5, 16(%esp)
movl    $6, 20(%esp)
movl    $7, 24(%esp)
movl    $8, 28(%esp)
calll   _add
xorl    %ecx, %ecx
movl    %eax, -4(%ebp)
movl    %ecx, %eax
addl    $40, %esp
popl    %ebp
retl
.cfi_endproc
                                    ## -- End function
</code></pre></div></div>

<p>.subsections_via_symbols</p>

<p>Clang ç¼–è¯‘å‡ºçš„X86ç›®æ ‡ä»£ç å¹¶ä¸ä½¿ç”¨å¯„å­˜å™¨ä¼ é€’å‚æ•°ï¼Œè€ŒX86-64ç›®æ ‡ä»£ç é‡Œï¼Œä½¿ç”¨å¯„å­˜å™¨ä¼ é€’å‰å…­ä¸ªå‚æ•°ã€‚</p>

<p>ä¸€æ¬¡å…¸å‹çš„Goå‡½æ•°è°ƒç”¨è¿‡ç¨‹
Go é€‰æ‹©çš„è°ƒç”¨æƒ¯ä¾‹æ˜¯ï¼š</p>

<p>å‚æ•°å®Œå…¨é€šè¿‡æ ˆä¼ é€’ï¼Œä»å‚æ•°åˆ—è¡¨çš„å³è‡³å·¦å‹æ ˆ
è¿”å›å€¼é€šè¿‡æ ˆä¼ é€’ï¼Œè¿”å›å€¼çš„æ ˆç©ºé—´åœ¨å‚æ•°ä¹‹å‰ï¼Œå³è¿”å›å€¼åœ¨æ›´æ¥è¿‘calleræ ˆåº•çš„ä½ç½®
callerè´Ÿè´£æ¸…ç†æ ˆ</p>

<p>package main</p>

<p>func main() {
    add(1,2)
}</p>

<p>//go:noinline
func add(a , b int) int {
    c := 3
    d := a + b + c
    return d
}</p>

<p>main.main(SB) /Users/user/go/src/test/main.go
  main.go:4     0x104ea20       65488b0c2530000000  MOVQ GS:0x30, CX          <br />
  main.go:4     0x104ea29       483b6110        CMPQ 0x10(CX), SP <br />
  main.go:4     0x104ea2d       762e            JBE 0x104ea5d             <br />
  main.go:4     0x104ea2f       4883ec20        SUBQ $0x20, SP ; å¢åŠ  32 bytes çš„æ ˆç©ºé—´(å››ä¸ª qwordï¼Œ8ä¸ªbytes ä¸ºä¸€ä¸ª qword)             <br />
  main.go:4     0x104ea33       48896c2418      MOVQ BP, 0x18(SP) ; å°† BP çš„å€¼å†™å…¥åˆ°åˆšåˆ†é…çš„æ ˆç©ºé—´çš„ç¬¬ä¸€ä¸ªqword
  main.go:4     0x104ea38       488d6c2418      LEAQ 0x18(SP), BP ; å°†åˆšåˆ†é…çš„æ ˆç©ºé—´çš„ç¬¬ä¸€ä¸ªå­—çš„åœ°å€èµ‹å€¼ç»™BP(å³BPæ­¤æ—¶æŒ‡å‘äº†åˆšæ‰å­˜æ”¾æ—§BPå€¼çš„åœ°å€)        <br />
  main.go:5     0x104ea3d       48c7042401000000    MOVQ $0x1, 0(SP); å°†ç»™addå‡½æ•°çš„ç¬¬ä¸€ä¸ªå®å‚å€¼1 å†™å…¥åˆ°åˆšåˆ†é…æ ˆç©ºé—´çš„æœ€åä¸€ä¸ªqword
  main.go:5     0x104ea45       48c744240802000000  MOVQ $0x2, 0x8(SP); å°†ç»™addå‡½æ•°çš„ç¬¬äºŒä¸ªå®å‚å€¼2 å†™å…¥åˆ°åˆšåˆ†é…æ ˆç©ºé—´çš„ç¬¬ä¸‰ä¸ªqwordã€‚ç¬¬äºŒä¸ª qword æ²¡æœ‰ç”¨åˆ°ï¼Œå®é™…ä¸Šæ˜¯ç»™calleeç”¨æ¥å­˜æ”¾è¿”å›å€¼çš„ã€‚        <br />
  main.go:5     0x104ea4e       e81d000000      CALL main.add(SB); è°ƒç”¨ add å‡½æ•°  <br />
  main.go:6     0x104ea53       488b6c2418      MOVQ 0x18(SP), BP; å°†ä»æ ˆé‡Œç¬¬å››ä¸ªqwordå°†æ—§çš„BPå€¼å–å›èµ‹å€¼åˆ°BP
  main.go:6     0x104ea58       4883c420        ADDQ $0x20, SP; å¢åŠ SPçš„å€¼ï¼Œæ ˆæ”¶ç¼©ï¼Œæ”¶å› 32 bytesçš„æ ˆç©ºé—´            <br />
  main.go:6     0x104ea5c       c3          RET</p>

<p>TEXT main.add(SB) /Users/user/go/src/test/main.go
  main.go:11        0x104ea70       4883ec18        SUBQ $0x18, SP; åˆ†é… 24 bytes çš„æ ˆç©ºé—´ï¼ˆ3 ä¸ª qwordï¼‰ã€‚      <br />
  main.go:11        0x104ea74       48896c2410      MOVQ BP, 0x10(SP); å°† BPå€¼ å†™å…¥ç¬¬ä¸€ä¸ªqword
  main.go:11        0x104ea79       488d6c2410      LEAQ 0x10(SP), BP; å°†åˆšåˆ†é…çš„24 bytes æ ˆç©ºé—´çš„ç¬¬ä¸€ä¸ªå­—çš„åœ°å€èµ‹å€¼ç»™BP(å³BPæ­¤æ—¶æŒ‡å‘äº†åˆšæ‰å­˜æ”¾æ—§BPå€¼çš„åœ°å€)    <br />
  main.go:11        0x104ea7e       48c744243000000000  MOVQ $0x0, 0x30(SP);å°†å­˜æ”¾è¿”å›å€¼çš„åœ°å€æ¸…é›¶ï¼Œ0x30(SP) å¯¹åº”çš„å†…å­˜ä½ç½®æ˜¯ä¸Šä¸€æ®µ main.main é‡Œåˆ†é…çš„æ ˆç©ºé—´çš„ç¬¬äºŒä¸ªqwordã€‚
  main.go:12        0x104ea87       48c744240803000000  MOVQ $0x3, 0x8(SP); å¯¹åº” c := 3 è¿™è¡Œä»£ç ã€‚å±€éƒ¨å˜é‡ c å¯¹åº”çš„æ˜¯æ ˆä¸Šå†…å­˜ã€‚3 è¢«å†™å…¥åˆ°åˆšåˆ†é…çš„ 24 bytes ç©ºé—´çš„ç¬¬äºŒä¸ªqwordã€‚
  main.go:13        0x104ea90       488b442420      MOVQ 0x20(SP), AX; å°†addçš„å®å‚ 1 å†™å…¥åˆ°AX å¯„å­˜å™¨ã€‚
  main.go:13        0x104ea95       4803442428      ADDQ 0x28(SP), AX; å°†addçš„å®å‚ 2 å¢åŠ åˆ° AX å¯„å­˜å™¨ã€‚
  main.go:13        0x104ea9a       4883c003        ADDQ $0x3, AX; å°†å±€éƒ¨å˜é‡å€¼ 3 å¢åŠ åˆ° AX å¯„å­˜å™¨    <br />
  main.go:13        0x104ea9e       48890424        MOVQ AX, 0(SP); å°† AX çš„å€¼(è®¡ç®—ç»“æœ) å†™å…¥åˆ°åˆšåˆ†é…çš„ 24 bytes ç©ºé—´çš„ç¬¬ä¸‰ä¸ªqwordã€‚(å¯¹åº”ä»£ç  d := a + b + c)
  main.go:14        0x104eaa2       4889442430      MOVQ AX, 0x30(SP); å°† AX çš„å€¼å†™å…¥åˆ°mainé‡Œä¸ºè¿”å›å€¼ç•™çš„æ ˆç©ºé—´(mainé‡Œåˆ†é…çš„32 bytes ä¸­çš„ç¬¬äºŒä¸ª qword)
  main.go:14        0x104eaa7       488b6c2410      MOVQ 0x10(SP), BP; æ¢å¤BPçš„å€¼ä¸ºå‡½æ•°å…¥å£å¤„ä¿å­˜çš„æ—§BPçš„å€¼ã€‚
  main.go:14        0x104eaac       4883c418        ADDQ $0x18, SP; å°† SP å¢åŠ ä¸‰ä¸ªå­—ï¼Œæ”¶å›addå…¥å£å¤„åˆ†é…çš„æ ˆç©ºé—´ã€‚<br />
  main.go:14        0x104eab0       c3          RET</p>

<p>å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œæ ˆçš„å˜åŒ–æƒ…å†µå¦‚å›¾ï¼š
åˆå§‹çŠ¶æ€ï¼š
	<img src="https://xiazemin.github.io/MyBlog/img/init_stack.webp" />
call addæ‰§è¡Œå‰æ ˆçŠ¶æ€:
<img src="https://xiazemin.github.io/MyBlog/img/before_call.webp" />
è¿›å…¥addé‡Œä¹‹åæ ˆçŠ¶æ€ï¼š
<img src="https://xiazemin.github.io/MyBlog/img/enter_add.webp" />
addé‡Œretæ‰§è¡Œå‰æ ˆçŠ¶æ€ï¼š
	<img src="https://xiazemin.github.io/MyBlog/img/before_ret.webp" />
mainé‡Œretæ‰§è¡Œå‰æ ˆçŠ¶æ€ï¼š
	<img src="https://xiazemin.github.io/MyBlog/img/before_main_ret.webp" />
	å¯ä»¥çœ‹åˆ° Go çš„è°ƒç”¨è¿‡ç¨‹å’Œ C ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº Go çš„å‚æ•°å®Œå…¨é€šè¿‡æ ˆä¼ é€’ï¼ŒGo çš„è¿”å›å€¼ä¹Ÿæ˜¯é€šè¿‡æ ˆä¼ é€’ã€‚å¯¹äºæ¯ç§æ•°æ®ç±»å‹åœ¨ä½œä¸ºå‚æ•°ä¼ é€’æ—¶çš„è¡¨ç°</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ä¸åŒæ•°æ®ç±»å‹ä½œä¸ºå‚æ•°æ—¶çš„ä¼ é€’æ–¹å¼ Go åŸºç¡€æ•°æ®ç±»å‹çš„å‚æ•°ä¼ é€’ package main
</code></pre></div></div>

<p>import (
    â€œfmtâ€
    â€œruntime/debugâ€
)</p>

<p>func main() {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>str := "hello"
int8 := int8(8)
int64 := int64(64)

boolValue := true

ExampleStr(str)
ExampleBool(boolValue)
ExampleInt8(int8)
ExampleInt64(int64)
ExampleMultiParams(false, 9, 8, 7) }
</code></pre></div></div>

<p>func ExampleStr(str string){
    fmt.Println(string(debug.Stack()))
}</p>

<p>func ExampleBool(boolValue bool){</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>boolValue = false

fmt.Println(string(debug.Stack())) }
</code></pre></div></div>

<p>func ExampleInt64(v int64){
    fmt.Println(string(debug.Stack()))
}</p>

<p>func ExampleInt8(v int8){
    fmt.Println(string(debug.Stack()))
}</p>

<p>func ExampleMultiParams(b bool, x, y, z int8){
    bl := b
    xl := x
    yl := y
    zl := z</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fmt.Println(bl, xl, yl, zl)
fmt.Println(string(debug.Stack()))
</code></pre></div></div>

<p>}</p>

<p>oroutine 1 [running]:
runtime/debug.Stack(0xc000084f38, 0x1057aad, 0x10aeb20)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.ExampleStr(0x10c6c34, 0x5)
    /Users/user/go/src/test/main.go:25 +0x26
main.main()
    /Users/user/go/src/test/main.go:16 +0x36</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x10e0580, 0xc000092000, 0xc000084f58)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.ExampleBool(0x10c6c01)
    /Users/user/go/src/test/main.go:32 +0x26
main.main()
    /Users/user/go/src/test/main.go:17 +0x3f</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x10e0580, 0xc000092000, 0xc000084f58)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.ExampleInt8(0x10c6c08)
    /Users/user/go/src/test/main.go:42 +0x26
main.main()
    /Users/user/go/src/test/main.go:18 +0x48</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x10e0580, 0xc000092000, 0xc000084f58)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.ExampleInt64(0x40)
    /Users/user/go/src/test/main.go:38 +0x26
main.main()
    /Users/user/go/src/test/main.go:19 +0x55</p>

<p>false 9 8 7
goroutine 1 [running]:
runtime/debug.Stack(0x10e0580, 0xc000092000, 0xc000084f28)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.ExampleMultiParams(0x7080900)
    /Users/user/go/src/test/main.go:52 +0xf6
main.main()
    /Users/user/go/src/test/main.go:20 +0x61</p>

<p>å¯ä»¥çœ‹åˆ°ï¼š</p>

<p>stringä¼ é€’æ—¶ï¼Œåˆ†ä¸ºpointerå’Œlengthä¸¤ä¸ªå‚æ•°ä¼ é€’ã€‚
int64ä¼ é€’æ—¶ï¼Œå¤åˆ¶äº†å€¼è¿›è¡Œä¼ é€’ã€‚
çœ‹debug.Stack()æ‰“å°å‡ºçš„è°ƒç”¨æ ˆï¼Œint8å’Œboolä¼ é€’æ—¶ï¼Œä¼ é€’çš„æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè¿™ä¼¼ä¹å®¹æ˜“å¼•èµ·è¯¯è§£ï¼Œéš¾é“ä¼ é€’çš„æ˜¯calleré‡Œå˜é‡çš„å†…å­˜åœ°å€ï¼Ÿé‚£ä¸æ˜¯ä¼šå¯¼è‡´calleeä¿®æ”¹ä¹Ÿå¯¼è‡´calleré‡Œå€¼ä¹Ÿå‘ç”Ÿæ”¹å˜ï¼Ÿå½“ç„¶ä¸æ˜¯è¿™æ ·ï¼intå’Œboolå½“ç„¶éƒ½æ˜¯å€¼ä¼ é€’ã€‚å½“callerä¼ é€’ç»™calleeçš„æ—¶å€™ï¼Œintå’Œbooléƒ½ä¼šè¢«åœ¨callerçš„æ ˆé‡Œå¤åˆ¶ä¸€ä»½ç»™calleeä½¿ç”¨ã€‚(åœ¨calleeç›´æ¥é€šè¿‡å¼•ç”¨å‚æ•°åä¿®æ”¹å‚æ•°å€¼ï¼Œè¿™ä¸ªå‚æ•°çš„å†…å­˜ä½ç½®å®é™…ä¸Šæ˜¯åœ¨callerçš„æ ˆä¸Š)ã€‚
ExampleMultiParamså‡½æ•°è™½ç„¶æœ‰å››ä¸ªå‚æ•°ï¼Œä½†æ˜¯è°ƒç”¨æ ˆæ‰“å°å‡ºæ¥åªä¼ é€’äº†ä¸€ä¸ªå€¼ 0x7080900ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼ŸåŸæ¥è¿™å››ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ä¸ªbyteï¼Œåˆèµ·æ¥æ˜¯ä¸€ä¸ªåŒå­—ã€‚æŸ¥çœ‹æ±‡ç¼–ä»£ç å¯ä»¥å‘ç°ç¼–è¯‘å™¨åšäº†ä¼˜åŒ–ï¼Œç›´æ¥ç»„åˆæˆä¸€ä¸ªå€¼ï¼Œå¹¶åœ¨calleré‡Œç”¨æŒ‡ä»¤MOVL $0x7080900, 0(SP)å†™å…¥æ ˆä¸Šã€‚å½“ç„¶ï¼Œåœ¨calleré‡Œå–å€¼çš„æ—¶å€™ï¼Œè¿˜æ˜¯å€ŸåŠ©MOVBå»ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚å–å€¼çš„ã€‚å½“ç„¶ï¼Œå¦‚æœæ˜¯è¿™å››ä¸ªå‚æ•°æ˜¯mainé‡Œçš„å››ä¸ªå±€éƒ¨å˜é‡ï¼Œè°ƒç”¨ExampleMultiParamsçš„æ—¶å€™é€šè¿‡ä¼ é€’å˜é‡åçš„å½¢å¼è°ƒç”¨(ExampleMultiParams(b, x, y, z)è€Œä¸æ˜¯ ExampleMultiParams(true, 9, 8, 7)çš„å½¢å¼)ï¼Œä½“ç°åœ¨æ±‡ç¼–ä»£ç é‡Œåˆæ˜¯å¦ä¸€ç§å½¢å¼ã€‚
Go ç»„åˆæ•°æ®ç±»å‹çš„å‚æ•°ä¼ é€’</p>

<p>package main</p>

<p>import (
â€œfmtâ€
â€œruntime/debugâ€
)</p>

<p>type MyStruct struct {
    a int
    b string
}</p>

<p>func main() {
    slice := make([]string, 2, 4)
    array := [â€¦]int{9,8,7,6,7,8,9}
    myMap := make(map[string]int)
    myStruct := MyStruct{8, â€œtestâ€}
    myStructPtr := &amp;myStruct
    myChan := make(chan int, 4)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ExampleSlice(slice)

ExampleArray(array)

ExampleMap(myMap)

ExampleStruct(myStruct)

ExamplePtr(myStructPtr)

ExampleChan(myChan) }
</code></pre></div></div>

<p>func ExampleSlice(slice []string){
    fmt.Println(string(debug.Stack()))
}</p>

<p>func ExampleArray(array [7]int){
    fmt.Println(string(debug.Stack()))
}</p>

<p>func ExampleMap(myMap map[string]int){
    fmt.Println(string(debug.Stack()))
}</p>

<p>func ExampleStruct(myStruct MyStruct){
    fmt.Println(string(debug.Stack()))
}</p>

<p>func ExamplePtr(ptr *MyStruct){
    fmt.Println(string(debug.Stack()))
}</p>

<p>func ExampleChan(myChan chan int){
    fmt.Println(string(debug.Stack()))
}</p>

<p>è°ƒç”¨æ ˆ</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x130a568, 0xc00007eda8, 0x1004218)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.ExampleSlice(0xc00007ee78, 0x2, 0x4)
    /Users/user/go/src/test/main.go:62 +0x26
main.main()
    /Users/user/go/src/test/main.go:46 +0x159</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x10e0a80, 0xc00008c000, 0xc00007ed98)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.ExampleArray(0x9, 0x8, 0x7, 0x6, 0x7, 0x8, 0x9)
    /Users/user/go/src/test/main.go:66 +0x26
main.main()
    /Users/user/go/src/test/main.go:48 +0x185</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x10e0a80, 0xc00008c000, 0xc00007ed98)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.ExampleMap(0xc00007ee48)
    /Users/user/go/src/test/main.go:74 +0x26
main.main()
    /Users/user/go/src/test/main.go:52 +0x1af</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x10e0a80, 0xc00008c000, 0xc00007ed98)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.ExampleStruct(0x8, 0x10c6f88, 0x4)
    /Users/user/go/src/test/main.go:78 +0x26
main.main()
    /Users/user/go/src/test/main.go:54 +0x1d7</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x10e0a80, 0xc00008c000, 0xc00007ed98)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.ExamplePtr(0xc00007ee30)
    /Users/user/go/src/test/main.go:82 +0x26
main.main()
    /Users/user/go/src/test/main.go:56 +0x1e5</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x10e0a80, 0xc00008c000, 0xc00007ed98)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.ExampleChan(0xc000092000)
    /Users/user/go/src/test/main.go:86 +0x26
main.main()
    /Users/user/go/src/test/main.go:58 +0x1f3</p>

<p>å¯ä»¥çœ‹åˆ°ï¼š</p>

<p>å¯¹äºæ•°ç»„ã€ç»“æ„ä½“ã€æŒ‡é’ˆï¼Œæ˜¯å¤åˆ¶ä¸€ä»½æ‹·è´ä¼ é€’ç»™calleeã€‚
æ•°ç»„ä½œä¸ºå‚æ•°æ—¶ï¼Œç¼–è¯‘åå‚æ•°çš„æ•°é‡æ˜¯æ•°ç»„å…ƒç´ çš„æ•°é‡ã€‚
ç»“æ„ä½“ä½œä¸ºå‚æ•°æ—¶ï¼Œç¼–è¯‘åå‚æ•°çš„æ•°é‡éœ€è¦å†æ¬¡åˆ†æç»“æ„ä½“é‡Œå…ƒç´ çš„ç±»å‹ã€‚å¦‚ä¸Šè¿°ä»£ç é‡Œç»“æ„ä½“ç”±ä¸€ä¸ªintå’Œä¸€ä¸ªstringç»„æˆï¼Œä¼ é€’å‚æ•°æ—¶æ˜¯intå€¼ã€stringçš„åœ°å€ã€stringçš„é•¿åº¦ä¸‰ä¸ªå‚æ•°ã€‚
sliceä¼ é€’æ—¶ï¼Œä¼šå°†sliceåº•å±‚çš„pointerã€lenã€capä½œä¸ºä¸‰ä¸ªå‚æ•°åˆ†å¼€ä¼ é€’ã€‚(å³ç¼–è¯‘åï¼Œå‚æ•°æ•°é‡ç”±æºä»£ç é‡Œçš„ä¸€ä¸ªå‚æ•°å˜ä¸ºäº†ä¸‰ä¸ªå‚æ•°)ã€‚æ‰€ä»¥sliceå…¶å®ä¹Ÿæ˜¯å€¼ä¼ é€’ã€‚
mapã€chanä¼ é€’æ—¶ï¼Œæ˜¯å°†mapã€chançš„åœ°å€æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ é€’ã€‚
æ–¹æ³•ï¼špointer receiver ä¸ value receiver
åœ¨ Java ä¸­ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå½“ç„¶æ˜¯å¯ä»¥ä¿®æ”¹å¯¹è±¡çš„æˆå‘˜å˜é‡çš„ã€‚ä½†æ˜¯åœ¨ Go ä¸­ï¼Œç»“æœå–å†³äºå®šä¹‰æ–¹æ³•æ—¶æ–¹æ³•çš„æ¥æ”¶è€…æ˜¯å€¼è¿˜æ˜¯æŒ‡é’ˆ(value receiver å’Œ pointer receiver)ã€‚</p>

<p>Go çš„æ–¹æ³•æ¥æ”¶è€…æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å€¼æ¥æ”¶è€…(value receiver)ï¼Œä¸€ç§æ˜¯æŒ‡é’ˆæ¥æ”¶è€…(pointer receiver)ã€‚å€¼æ¥æ”¶è€…ï¼Œæ˜¯æ¥æ”¶è€…çš„ç±»å‹æ˜¯ä¸€ä¸ªå€¼ï¼Œæ˜¯ä¸€ä¸ªå‰¯æœ¬ï¼Œæ–¹æ³•å†…éƒ¨æ— æ³•å¯¹å…¶çœŸæ­£çš„æ¥æ”¶è€…åšæ›´æ”¹ã€‚æŒ‡é’ˆæ¥æ”¶è€…ï¼Œæ¥æ”¶è€…çš„ç±»å‹æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ˜¯æ¥æ”¶è€…çš„å¼•ç”¨ï¼Œå¯¹è¿™ä¸ªå¼•ç”¨çš„ä¿®æ”¹ä¼šå½±å“çœŸæ­£çš„æ¥æ”¶è€…</p>

<p>package main</p>

<p>import â€œfmtâ€</p>

<p>type XAxis int</p>

<p>type Point struct{
    X int
    Y int
}</p>

<p>func (x XAxis)VIncr(offset XAxis){
    x += offset
    fmt.Printf(â€œIn VIncr, new x = %d\nâ€, x)
}</p>

<p>func (x *XAxis)PIncr(offset XAxis){
    *x += offset
    fmt.Printf(â€œIn PIncr, new x = %d\nâ€, *x)
}</p>

<p>func (p Point)VScale(factor int){
    p.X *= factor
    p.Y *= factor</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fmt.Printf("In VScale, new p = %v\n", p) }
</code></pre></div></div>

<p>func (p *Point)PScale(factor int){
    p.X *= factor
    p.Y *= factor</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fmt.Printf("In PScale, new p = %v\n", p) }
</code></pre></div></div>

<p>func main(){
    var x XAxis = 10</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fmt.Printf("In main, before VIncr, x = %v\n", x)
x.VIncr(5)
fmt.Printf("In main, after VIncr, new x = %v\n", x)

fmt.Println()

fmt.Printf("In main, before PIncr, x = %v\n", x)
x.PIncr(5)
fmt.Printf("In main, after PIncr, new x = %v\n", x)

fmt.Println()

p := Point{2, 2}

fmt.Printf("In main, before VScale, p = %v\n", p)
p.VScale(5)
fmt.Printf("In main, after VScale, new p = %v\n", p)

fmt.Println()

fmt.Printf("In main, before PScale, p = %v\n", p)
p.PScale(5)
fmt.Printf("In main, after PScale, new p = %v\n", p) } è¾“å‡ºï¼š
</code></pre></div></div>

<p>In main, before VIncr, x = 10
In VIncr, new x = 15
In main, after VIncr, new x = 10</p>

<p>In main, before PIncr, x = 10
In PIncr, new x = 15
In main, after PIncr, new x = 15</p>

<p>In main, before VScale, p = {2 2}
In VScale, new p = {10 10}
In main, after VScale, new p = {2 2}</p>

<p>In main, before PScale, p = {2 2}
In PScale, new p = &amp;{10 10}
In main, after PScale, new p = {10 10}
åœ¨å®šä¹‰æ–¹æ³•çš„æ—¶å€™ï¼Œreceiver æ˜¯åœ¨æ–¹æ³•åçš„å‰é¢ï¼Œè€Œä¸æ˜¯åœ¨å‚æ•°åˆ—è¡¨é‡Œï¼Œé‚£åœ¨æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œæ–¹æ³•å†…çš„æŒ‡ä»¤æ€ä¹ˆæ‰¾åˆ°receiverçš„å‘¢ï¼Ÿ
æˆ‘ä»¬ç²¾ç®€ä¸€ä¸‹ä»£ç (æ³¨é‡Šæ‰ print ç›¸å…³è¯­å¥)ï¼Œç„¶åæŠŠåç¼–è¯‘ï¼š</p>

<p>TEXT %22%22.XAxis.VIncr(SB) gofile../Users/user/go/src/test/main.go
  main.go:14        0xbb0           488b442408      MOVQ 0x8(SP), AX  <br />
  main.go:14        0xbb5           4803442410      ADDQ 0x10(SP), AX <br />
  main.go:14        0xbba           4889442408      MOVQ AX, 0x8(SP)  <br />
  main.go:16        0xbbf           c3          RET</p>

<p>TEXT %22%22.(*XAxis).PIncr(SB) gofile../Users/user/go/src/test/main.go
  main.go:19        0xbd4           488b442408      MOVQ 0x8(SP), AX  <br />
  main.go:19        0xbd9           8400            TESTB AL, 0(AX)   <br />
  main.go:19        0xbdb           488b4c2408      MOVQ 0x8(SP), CX  <br />
  main.go:19        0xbe0           8401            TESTB AL, 0(CX)   <br />
  main.go:19        0xbe2           488b00          MOVQ 0(AX), AX    <br />
  main.go:19        0xbe5           4803442410      ADDQ 0x10(SP), AX <br />
  main.go:19        0xbea           488901          MOVQ AX, 0(CX)    <br />
  main.go:21        0xbed           c3          RET</p>

<p>TEXT %22%22.Point.VScale(SB) gofile../Users/user/go/src/test/main.go
  main.go:24        0xc0a           488b442408      MOVQ 0x8(SP), AX  <br />
  main.go:24        0xc0f           488b4c2418      MOVQ 0x18(SP), CX <br />
  main.go:24        0xc14           480fafc1        IMULQ CX, AX      <br />
  main.go:24        0xc18           4889442408      MOVQ AX, 0x8(SP)  <br />
  main.go:25        0xc1d           488b442410      MOVQ 0x10(SP), AX <br />
  main.go:25        0xc22           488b4c2418      MOVQ 0x18(SP), CX <br />
  main.go:25        0xc27           480fafc1        IMULQ CX, AX      <br />
  main.go:25        0xc2b           4889442410      MOVQ AX, 0x10(SP) <br />
  main.go:28        0xc30           c3          RET</p>

<p>TEXT %22%22.(*Point).PScale(SB) gofile../Users/user/go/src/test/main.go
  main.go:32        0xc47           488b442408      MOVQ 0x8(SP), AX  <br />
  main.go:32        0xc4c           8400            TESTB AL, 0(AX)   <br />
  main.go:32        0xc4e           488b4c2408      MOVQ 0x8(SP), CX  <br />
  main.go:32        0xc53           8401            TESTB AL, 0(CX)   <br />
  main.go:32        0xc55           488b00          MOVQ 0(AX), AX    <br />
  main.go:32        0xc58           488b542410      MOVQ 0x10(SP), DX <br />
  main.go:32        0xc5d           480fafc2        IMULQ DX, AX      <br />
  main.go:32        0xc61           488901          MOVQ AX, 0(CX)    <br />
  main.go:33        0xc64           488b442408      MOVQ 0x8(SP), AX  <br />
  main.go:33        0xc69           8400            TESTB AL, 0(AX)   <br />
  main.go:33        0xc6b           488b4c2408      MOVQ 0x8(SP), CX  <br />
  main.go:33        0xc70           8401            TESTB AL, 0(CX)   <br />
  main.go:33        0xc72           488b4008        MOVQ 0x8(AX), AX  <br />
  main.go:33        0xc76           488b542410      MOVQ 0x10(SP), DX <br />
  main.go:33        0xc7b           480fafc2        IMULQ DX, AX      <br />
  main.go:33        0xc7f           48894108        MOVQ AX, 0x8(CX)  <br />
  main.go:36        0xc83           c3          RET</p>

<p>TEXT %22%22.main(SB) gofile../Users/user/go/src/test/main.go
  main.go:38        0xcaa           65488b0c2500000000  MOVQ GS:0, CX       [5:9]R_TLS_LE     <br />
  main.go:38        0xcb3           483b6110        CMPQ 0x10(CX), SP <br />
  main.go:38        0xcb7           0f86b3000000        JBE 0xd70     <br />
  main.go:38        0xcbd           4883ec50        SUBQ $0x50, SP    <br />
  main.go:38        0xcc1           48896c2448      MOVQ BP, 0x48(SP) <br />
  main.go:38        0xcc6           488d6c2448      LEAQ 0x48(SP), BP <br />
  main.go:39        0xccb           48c74424300a000000  MOVQ $0xa, 0x30(SP) 
  main.go:42        0xcd4           48c704240a000000    MOVQ $0xa, 0(SP)  <br />
  main.go:42        0xcdc           48c744240805000000  MOVQ $0x5, 0x8(SP)<br />
  main.go:42        0xce5           e800000000      CALL 0xcea      [1:5]R_CALL:%22%22.XAxis.VIncr<br />
  main.go:48        0xcea           488d442430      LEAQ 0x30(SP), AX <br />
  main.go:48        0xcef           48890424        MOVQ AX, 0(SP)    <br />
  main.go:48        0xcf3           48c744240805000000  MOVQ $0x5, 0x8(SP)<br />
  main.go:48        0xcfc           e800000000      CALL 0xd01      [1:5]R_CALL:%22%22.(<em>XAxis).PIncr <br />
  main.go:53        0xd01           0f57c0          XORPS X0, X0      <br />
  main.go:53        0xd04           0f11442438      MOVUPS X0, 0x38(SP) 
  main.go:53        0xd09           48c744243802000000  MOVQ $0x2, 0x38(SP) 
  main.go:53        0xd12           48c744244002000000  MOVQ $0x2, 0x40(SP) 
  main.go:56        0xd1b           48c7042402000000    MOVQ $0x2, 0(SP)  <br />
  main.go:56        0xd23           48c744240802000000  MOVQ $0x2, 0x8(SP)<br />
  main.go:56        0xd2c           48c744241005000000  MOVQ $0x5, 0x10(SP) 
  main.go:56        0xd35           e800000000      CALL 0xd3a      [1:5]R_CALL:%22%22.Point.VScale 
  main.go:62        0xd3a           488d442438      LEAQ 0x38(SP), AX <br />
  main.go:62        0xd3f           48890424        MOVQ AX, 0(SP)    <br />
  main.go:62        0xd43           48c744240805000000  MOVQ $0x5, 0x8(SP)<br />
  main.go:62        0xd4c           e800000000      CALL 0xd51      [1:5]R_CALL:%22%22.(</em>Point).PScale<br />
  main.go:64        0xd51           48c7042400000000    MOVQ $0x0, 0(SP)  <br />
  main.go:64        0xd59           0f57c0          XORPS X0, X0      <br />
  main.go:64        0xd5c           0f11442408      MOVUPS X0, 0x8(SP)<br />
  main.go:64        0xd61           e800000000      CALL 0xd66      [1:5]R_CALL:fmt.Println 
  main.go:65        0xd66           488b6c2448      MOVQ 0x48(SP), BP <br />
  main.go:65        0xd6b           4883c450        ADDQ $0x50, SP    <br />
  main.go:65        0xd6f           c3          RET       <br />
  main.go:38        0xd70           e800000000      CALL 0xd75      [1:5]R_CALL:runtime.morestack_noctxt  <br />
  main.go:38        0xd75           e930ffffff      JMP %22%22.main(SB) 
ä»¥main.go 42è¡Œ x.VIncr(5)ä¸ºä¾‹ï¼Œåœ¨mainé‡Œé¢ï¼Œä¼ é€’å‚æ•°å¯¹åº”çš„æŒ‡ä»¤æ˜¯</p>

<p>main.go:42        0xcd4           48c704240a000000    MOVQ $0xa, 0(SP); å°†å€¼ 10 ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°
  main.go:42        0xcdc           48c744240805000000  MOVQ $0x5, 0x8(SP); å°†å€¼ 5 ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°  <br />
  main.go:42        0xce5           e800000000      CALL 0xcea      [1:5]R_CALL:%22%22.XAxis.VIncr<br />
å†çœ‹ x.VIncr çš„æ±‡ç¼–ä»£ç ï¼š</p>

<p>main.go:14        0xbb0           488b442408      MOVQ 0x8(SP), AX; å–ç¬¬ä¸€ä¸ªå‚æ•°åˆ°å¯„å­˜å™¨AX<br />
  main.go:14        0xbb5           4803442410      ADDQ 0x10(SP), AX; å–ç¬¬äºŒä¸ªå‚æ•°åŠ åˆ°å¯„å­˜å™¨AX
  main.go:14        0xbba           4889442408      MOVQ AX, 0x8(SP); å°†å’Œå†™å…¥åˆ°äº†ç¬¬ä¸€ä¸ªå‚æ•°åœ¨æ ˆä¸Šçš„ä½ç½®
  main.go:16        0xbbf           c3          RET 
å¯ä»¥çœ‹åˆ°ï¼Œæ–¹æ³• VIncr çš„ receiver æ˜¯å€¼ï¼Œåˆ™calleråœ¨è°ƒç”¨VIncrçš„æ—¶å€™ï¼Œå°†è¿™ä¸ªå€¼å¤åˆ¶åˆ°æ ˆä¸Šç»™VIncrçš„å‚æ•°åŒºé‡Œï¼Œåœ¨ VIncr å¯¹receiverçš„ä¿®æ”¹ï¼Œå®é™…ä¸Šæ˜¯ä¿®æ”¹çš„è¿™ä¸ªå‚æ•°åŒºé‡Œçš„å€¼ï¼Œè€Œä¸æ˜¯ caller æ ˆé‡Œä¿å­˜å±€éƒ¨å˜é‡çš„åŒºé‡Œçš„ receiver çš„å€¼ï¼ˆåœ¨è¯­è¨€ä½¿ç”¨è€…è§†è§’ï¼Œå°±æ˜¯ ä¿®æ”¹çš„æ˜¯æ‹·è´è€Œä¸æ˜¯åŸå€¼ï¼‰ã€‚</p>

<p>æ¥ç€æˆ‘ä»¬çœ‹main.goç¬¬48è¡Œ x.PIncr(5)ï¼Œåœ¨mainé‡Œé¢ï¼Œè°ƒç”¨çš„æŒ‡ä»¤æ˜¯ï¼š</p>

<p>main.go:39        0xccb           48c74424300a000000  MOVQ $0xa, 0x30(SP) 
â€¦
  main.go:48        0xcea           488d442430      LEAQ 0x30(SP), AX; å°†SP+0x30è¿™ä¸ªå†…å­˜åœ°å€ä¿å­˜åˆ°AX; SP+0x30è¿™ä¸ªå†…å­˜åœ°å€é‡Œå­˜çš„æ˜¯ 10(æ‰§è¡Œ var x XAxis = 10 æ—¶å®šä¹‰çš„å±€éƒ¨å˜é‡)
  main.go:48        0xcef           48890424        MOVQ AX, 0(SP); å°†AXçš„å€¼ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚     <br />
  main.go:48        0xcf3           48c744240805000000  MOVQ $0x5, 0x8(SP); å°† 5 ä½œä¸ºç¬¬äºŒä¸ªå‚æ•° 
  main.go:48        0xcfc           e800000000      CALL 0xd01      [1:5]R_CALL:%22%22.(*XAxis).PIncr
PIncrçš„æ±‡ç¼–ä»£ç ï¼š</p>

<p>main.go:19        0xbd4           488b442408      MOVQ 0x8(SP), AX; å°†ç¬¬ä¸€ä¸ªå‚æ•°(å³mainçš„å¸§æ ˆä¸Šå±€éƒ¨å˜é‡ x çš„å†…å­˜åœ°å€)è¯»å–åˆ°AX  <br />
  main.go:19        0xbd9           8400            TESTB AL, 0(AX)   <br />
  main.go:19        0xbdb           488b4c2408      MOVQ 0x8(SP), CX; å°†ç¬¬ä¸€ä¸ªå‚æ•°(å³mainçš„å¸§æ ˆä¸Šå±€éƒ¨å˜é‡ x çš„å†…å­˜åœ°å€)è¯»å–åˆ° CX <br />
  main.go:19        0xbe0           8401            TESTB AL, 0(CX)   <br />
  main.go:19        0xbe2           488b00          MOVQ 0(AX), AX; ä» AX é‡Œè¯»åˆ°å†…å­˜åœ°å€ï¼Œä»å†…å­˜åœ°å€é‡Œæ‹¿åˆ°å€¼ï¼Œå†è¯»åˆ°AX(å°±æ˜¯mainçš„å±€éƒ¨å˜é‡ x çš„å€¼)    <br />
  main.go:19        0xbe5           4803442410      ADDQ 0x10(SP), AX; å°† ç¬¬äºŒä¸ªå‚æ•° 5 åŠ åˆ° AX é‡Œ
  main.go:19        0xbea           488901          MOVQ AX, 0(CX); å°†è®¡ç®—ç»“æœå†™å…¥åˆ° CX é‡Œçš„å†…å­˜åœ°å€(å³ mainçš„å¸§æ ˆä¸Šå±€éƒ¨å˜é‡ x çš„å†…å­˜åœ°å€)<br />
  main.go:21        0xbed           c3          RET 
å¯ä»¥çœ‹åˆ°ï¼Œæ–¹æ³• PIncr çš„ receiver æ˜¯æŒ‡é’ˆ(pointer)ï¼Œåˆ™calleråœ¨è°ƒç”¨PIncrçš„æ—¶å€™ï¼Œå°†è¿™ä¸ªpointerå¤åˆ¶åˆ°æ ˆä¸Šç»™PIncrçš„å‚æ•°åŒºé‡Œï¼Œåœ¨ PIncr å¯¹receiverçš„ä¿®æ”¹ï¼Œå®é™…ä¸Šæ˜¯ä¿®æ”¹pointeræŒ‡å‘çš„å†…å­˜åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯mainçš„å±€éƒ¨å˜é‡ xã€‚ï¼ˆåœ¨è¯­è¨€ä½¿ç”¨è€…è§†è§’ï¼Œå°±æ˜¯ ä¿®æ”¹çš„æ˜¯åŸå€¼ï¼‰ã€‚</p>

<p>æ‰“å°è°ƒç”¨æ ˆï¼Œç›¸æ¯”æ±‡ç¼–æ›´æ–¹ä¾¿çš„çœ‹å®é™…ä¼ é€’çš„å‚æ•°ï¼š</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x1036126, 0x10a4360, 0xc000098000)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.XAxis.VIncr(0xa, 0x5)
    /Users/user/go/src/test/main.go:18 +0x26
main.main()
    /Users/user/go/src/test/main.go:47 +0x40</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x10e0480, 0xc000094000, 0xc000080f10)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.(*XAxis).PIncr(0xc000080f70, 0x5)
    /Users/user/go/src/test/main.go:24 +0x33
main.main()
    /Users/user/go/src/test/main.go:53 +0x57</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x10e0480, 0xc000094000, 0xc000080f10)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.Point.VScale(0x2, 0x2, 0x5)
    /Users/user/go/src/test/main.go:31 +0x26
main.main()
    /Users/user/go/src/test/main.go:61 +0x90</p>

<p>goroutine 1 [running]:
runtime/debug.Stack(0x10e0480, 0xc000094000, 0xc000080f10)
    /usr/local/go/src/runtime/debug/stack.go:24 +0x9d
main.(*Point).PScale(0xc000080f78, 0x5)
    /Users/user/go/src/test/main.go:39 +0x46
main.main()
    /Users/user/go/src/test/main.go:67 +0xa7
å½“æ–¹æ³•çš„receiveræ˜¯valueçš„æ—¶å€™ï¼Œè°ƒç”¨æ–¹æ³•æ—¶æ˜¯æŠŠvalueæ‹·è´ä¸€ä»½ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™calleeçš„ï¼Œè¿™æ ·calleré‡Œå¯¹receiverçš„ä¿®æ”¹å®é™…ä¸Šæ˜¯ä¿®æ”¹çš„æ‹·è´ï¼Œä¸å½±å“åŸå€¼ã€‚å½“æ–¹æ³•çš„receiveræ˜¯pointerçš„æ—¶å€™ï¼Œè°ƒç”¨æ–¹æ³•æ—¶æ˜¯æŠŠpointeræ‹·è´ä¸€ä»½ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™callerçš„ï¼Œè¿™æ ·calleeå¯ä»¥é€šè¿‡è¿™ä¸ªpointerä¿®æ”¹åŸå€¼ã€‚</p>

<p>ä¸€ç‚¹è¡¥å……</p>

<p>å¦‚æœåœ¨æ–¹æ³•é‡Œä¿®æ”¹receiverçš„å€¼è¦å¯¹callerç”Ÿæ•ˆï¼Œä½¿ç”¨ pointer receiver
å‡ºäºæ€§èƒ½ä¼˜åŒ–ï¼Œå¦‚æœreceiveræ˜¯ç»“æ„ä½“æˆ–è€…æ•°ç»„è¿™æ ·å ç”¨è¾ƒå¤šå†…å­˜çš„æ•°æ®ç±»å‹ï¼Œä¼˜å…ˆä½¿ç”¨pointer receiver
æ³¨æ„ï¼š</p>

<p>å€¼æ¥æ”¶å™¨æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œè€ŒæŒ‡é’ˆæ¥æ”¶å™¨ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚
è°ƒç”¨è§„åˆ™ï¼š</p>

<p>ç±»å‹ *T çš„å¯è°ƒç”¨æ–¹æ³•é›†åŒ…å«æ¥å—è€…ä¸º *T æˆ– T çš„æ‰€æœ‰æ–¹æ³•é›†
ç±»å‹ T çš„å¯è°ƒç”¨æ–¹æ³•é›†åŒ…å«æ¥å—è€…ä¸º T çš„æ‰€æœ‰æ–¹æ³•
*ç±»å‹ T çš„å¯è°ƒç”¨æ–¹æ³•é›†ä¸åŒ…å«æ¥å—è€…ä¸º T çš„æ–¹æ³•
æ–¹æ³•çš„æ¥æ”¶è€…ä¸å‡½æ•°/æ–¹æ³•çš„å‚æ•°çš„æ¯”è¾ƒï¼š</p>

<p>å‡½æ•°/æ–¹æ³•çš„å®å‚ç±»å‹å’Œå½¢å‚ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œ(åœ¨è¯­æ³•ä¸Š)ä¸èƒ½ä¸€ä¸ªæ˜¯pointerè€Œå¦ä¸€ä¸ªæ˜¯valueã€‚
æ–¹æ³•çš„æ¥æ”¶è€…æ¯”è¾ƒæ™ºèƒ½ï¼Œå¦‚æœæ˜¯ pointer receiverï¼Œåœ¨å€¼ä¸Šä¹Ÿå¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ’å…¥ä»å€¼å–åˆ°æŒ‡é’ˆçš„æŒ‡ä»¤ï¼‰ã€‚å¦‚æœæ˜¯ value receiverï¼Œé‚£ä¹ˆå½“åœ¨pointerä¸Šè°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†pointerè½¬æ¢ä¸ºpointeræ‰€å¯¹åº”çš„å€¼ã€‚
åŒ¿åå‡½æ•°å’Œé—­åŒ…</p>

<p>åŒ¿åå‡½æ•°
åŒ¿åå‡½æ•°ç”±ä¸€ä¸ªä¸å¸¦å‡½æ•°åçš„å‡½æ•°å£°æ˜å’Œå‡½æ•°ä½“ç»„æˆï¼ŒåŒ¿åå‡½æ•°å¯ä»¥èµ‹å€¼ç»™å˜é‡ï¼Œä½œä¸ºç»“æ„ä½“å­—æ®µï¼Œæˆ–è€…åœ¨channelä¸­ä¼ é€’ã€‚åœ¨åº•å±‚å®ç°ä¸­ï¼Œå®é™…ä¸Šä¼ é€’çš„æ˜¯åŒ¿åå‡½æ•°çš„å…¥å£åœ°å€ã€‚</p>

<p>package main</p>

<p>func test() func(int) int {
    return func(x int) int {
        x += x
        return x
    }
}</p>

<p>func main() {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>f := test()
f(100) } TEXT %22%22.test(SB) gofile../Users/user/go/src/test/main.go   main.go:4     0x4e7           48c744240800000000  MOVQ $0x0, 0x8(SP)     main.go:5     0x4f0           488d0500000000      LEAQ 0(IP), AX      [3:7]R_PCREL:%22%22.test.func1Â·f       main.go:5     0x4f7           4889442408      MOVQ AX, 0x8(SP)       main.go:5     0x4fc           c3          RET         
</code></pre></div></div>

<p>TEXT %22%22.main(SB) gofile../Users/user/go/src/test/main.go
  main.go:11        0x517           65488b0c2500000000  MOVQ GS:0, CX       [5:9]R_TLS_LE     <br />
  main.go:11        0x520           483b6110        CMPQ 0x10(CX), SP <br />
  main.go:11        0x524           7633            JBE 0x559     <br />
  main.go:11        0x526           4883ec20        SUBQ $0x20, SP    <br />
  main.go:11        0x52a           48896c2418      MOVQ BP, 0x18(SP) <br />
  main.go:11        0x52f           488d6c2418      LEAQ 0x18(SP), BP <br />
  main.go:12        0x534           e800000000      CALL 0x539      [1:5]R_CALL:%22%22.test 
  main.go:12        0x539           488b1424        MOVQ 0(SP), DX    <br />
  main.go:12        0x53d           4889542410      MOVQ DX, 0x10(SP) <br />
  main.go:13        0x542           48c7042464000000    MOVQ $0x64, 0(SP) <br />
  main.go:13        0x54a           488b02          MOVQ 0(DX), AX    <br />
  main.go:13        0x54d           ffd0            CALL AX         [0:0]R_CALLIND    <br />
  main.go:14        0x54f           488b6c2418      MOVQ 0x18(SP), BP <br />
  main.go:14        0x554           4883c420        ADDQ $0x20, SP    <br />
  main.go:14        0x558           c3          RET       <br />
  main.go:11        0x559           e800000000      CALL 0x55e      [1:5]R_CALL:runtime.morestack_noctxt  <br />
  main.go:11        0x55e           ebb7            JMP %22%22.main(SB)</p>

<p>TEXT %22%22.test.func1(SB) gofile../Users/user/go/src/test/main.go
  main.go:5     0x58a           48c744241000000000  MOVQ $0x0, 0x10(SP) 
  main.go:6     0x593           488b442408      MOVQ 0x8(SP), AX  <br />
  main.go:6     0x598           4803442408      ADDQ 0x8(SP), AX  <br />
  main.go:6     0x59d           4889442408      MOVQ AX, 0x8(SP)  <br />
  main.go:7     0x5a2           4889442410      MOVQ AX, 0x10(SP)
é—­åŒ…
å½“å‡½æ•°å¼•ç”¨å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡æ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºé—­åŒ…ã€‚åœ¨åº•å±‚å®ç°ä¸Šï¼Œé—­åŒ…ç”±å‡½æ•°åœ°å€å’Œå¼•ç”¨åˆ°çš„å˜é‡çš„åœ°å€ç»„æˆï¼Œå¹¶å­˜å‚¨åœ¨ä¸€ä¸ªç»“æ„ä½“é‡Œï¼Œåœ¨é—­åŒ…è¢«ä¼ é€’æ—¶ï¼Œå®é™…æ˜¯è¯¥ç»“æ„ä½“çš„åœ°å€è¢«ä¼ é€’ã€‚å› ä¸ºæ ˆå¸§ä¸Šçš„å€¼åœ¨è¯¥å¸§çš„å‡½æ•°é€€å‡ºåå°±å¤±æ•ˆäº†ï¼Œå› æ­¤é—­åŒ…å¼•ç”¨çš„å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡ä¼šè¢«åˆ†é…åˆ°å †ä¸Šã€‚åœ¨ä»¥ä¸‹çš„å®ç°ä¸­ï¼Œtest()å‡½æ•°è¿”å›ä¸€ä¸ªé—­åŒ…èµ‹å€¼ç»™fï¼Œå®é™…æ˜¯mainé‡Œæ”¶åˆ°é—­åŒ…ç»“æ„ä½“(å †ä¸Š)çš„åœ°å€ï¼Œå¹¶ä¿å­˜åœ¨DXå¯„å­˜å™¨ä¸Šï¼Œåœ°å€å¯¹åº”çš„å†…å­˜å€¼æ˜¯é—­åŒ…å‡½æ•°åœ°å€(å‡½æ•°åœ°å€å–åˆ°å¯„å­˜å™¨ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ call è°ƒç”¨)ï¼Œåœ°å€åç§»8ä¸ªå­—èŠ‚(+8bytes)æ˜¯å˜é‡xçš„çš„åœ°å€ï¼Œåœ¨mainé‡Œè°ƒç”¨é—­åŒ…å‡½æ•°fæ—¶ï¼Œfå†…éƒ¨ä¾ç„¶æ˜¯é€šè¿‡è¯»å–DXçš„å€¼æ¥å¾—åˆ°å˜é‡xçš„åœ°å€ã€‚å³mainè°ƒç”¨fè™½ç„¶æ²¡æœ‰ä¼ é€’å‚æ•°ä¹Ÿæ²¡æœ‰è¿”å›å€¼ï¼Œä½†æ˜¯ä»–ä»¬å´å…±äº«äº†ä¸€ä¸ªå¯„å­˜å™¨DXçš„å€¼</p>

<p>package main</p>

<p>func test() func() {
    x := 100
    return func() {
        x += 100
    }
}</p>

<p>func main() {
    f := test()
    f()
    f()
    f()
}
TEXT %22%22.test(SB) gofile../Users/user/go/src/test/main.go
  main.go:3     0x6ad           65488b0c2500000000  MOVQ GS:0, CX       [5:9]R_TLS_LE     <br />
  main.go:3     0x6b6           483b6110        CMPQ 0x10(CX), SP <br />
  main.go:3     0x6ba           0f869b000000        JBE 0x75b     <br />
  main.go:3     0x6c0           4883ec28        SUBQ $0x28, SP    <br />
  main.go:3     0x6c4           48896c2420      MOVQ BP, 0x20(SP) <br />
  main.go:3     0x6c9           488d6c2420      LEAQ 0x20(SP), BP <br />
  main.go:3     0x6ce           48c744243000000000  MOVQ $0x0, 0x30(SP) 
  main.go:4     0x6d7           488d0500000000      LEAQ 0(IP), AX      [3:7]R_PCREL:type.int <br />
  main.go:4     0x6de           48890424        MOVQ AX, 0(SP)    <br />
  main.go:4     0x6e2           e800000000      CALL 0x6e7      [1:5]R_CALL:runtime.newobject <br />
  main.go:4     0x6e7           488b442408      MOVQ 0x8(SP), AX  <br />
  main.go:4     0x6ec           4889442418      MOVQ AX, 0x18(SP) <br />
  main.go:4     0x6f1           48c70064000000      MOVQ $0x64, 0(AX) <br />
  main.go:5     0x6f8           488d0500000000      LEAQ 0(IP), AX      [3:7]R_PCREL:type.noalg.struct { F uintptr; %22%22.x *int } 
  main.go:5     0x6ff           48890424        MOVQ AX, 0(SP)    <br />
  main.go:5     0x703           e800000000      CALL 0x708      [1:5]R_CALL:runtime.newobject <br />
  main.go:5     0x708           488b442408      MOVQ 0x8(SP), AX  <br />
  main.go:5     0x70d           4889442410      MOVQ AX, 0x10(SP) <br />
  main.go:5     0x712           488d0d00000000      LEAQ 0(IP), CX      [3:7]R_PCREL:%22%22.test.func1<br />
  main.go:5     0x719           488908          MOVQ CX, 0(AX)    <br />
  main.go:5     0x71c           488b442410      MOVQ 0x10(SP), AX <br />
  main.go:5     0x721           8400            TESTB AL, 0(AX)   <br />
  main.go:5     0x723           488b4c2418      MOVQ 0x18(SP), CX <br />
  main.go:5     0x728           488d7808        LEAQ 0x8(AX), DI  <br />
  main.go:5     0x72c           833d0000000000      CMPL $0x0, 0(IP)    [2:6]R_PCREL:runtime.writeBarrier+-1  <br />
  main.go:5     0x733           7402            JE 0x737      <br />
  main.go:5     0x735           eb1a            JMP 0x751     <br />
  main.go:5     0x737           48894808        MOVQ CX, 0x8(AX)  <br />
  main.go:5     0x73b           eb00            JMP 0x73d     <br />
  main.go:5     0x73d           488b442410      MOVQ 0x10(SP), AX <br />
  main.go:5     0x742           4889442430      MOVQ AX, 0x30(SP) <br />
  main.go:5     0x747           488b6c2420      MOVQ 0x20(SP), BP <br />
  main.go:5     0x74c           4883c428        ADDQ $0x28, SP    <br />
  main.go:5     0x750           c3          RET       <br />
  main.go:5     0x751           4889c8          MOVQ CX, AX   <br />
  main.go:5     0x754           e800000000      CALL 0x759      [1:5]R_CALL:runtime.gcWriteBarrier<br />
  main.go:5     0x759           ebe2            JMP 0x73d     <br />
  main.go:3     0x75b           e800000000      CALL 0x760      [1:5]R_CALL:runtime.morestack_noctxt  <br />
  main.go:3     0x760           e948ffffff      JMP %22%22.test(SB)</p>

<p>TEXT %22%22.main(SB) gofile../Users/user/go/src/test/main.go
  main.go:10        0x7bc           65488b0c2500000000  MOVQ GS:0, CX       [5:9]R_TLS_LE     <br />
  main.go:10        0x7c5           483b6110        CMPQ 0x10(CX), SP <br />
  main.go:10        0x7c9           763f            JBE 0x80a     <br />
  main.go:10        0x7cb           4883ec18        SUBQ $0x18, SP    <br />
  main.go:10        0x7cf           48896c2410      MOVQ BP, 0x10(SP) <br />
  main.go:10        0x7d4           488d6c2410      LEAQ 0x10(SP), BP <br />
  main.go:11        0x7d9           e800000000      CALL 0x7de      [1:5]R_CALL:%22%22.test 
  main.go:11        0x7de           488b1424        MOVQ 0(SP), DX    <br />
  main.go:11        0x7e2           4889542408      MOVQ DX, 0x8(SP)  <br />
  main.go:12        0x7e7           488b02          MOVQ 0(DX), AX    <br />
  main.go:12        0x7ea           ffd0            CALL AX         [0:0]R_CALLIND    <br />
  main.go:13        0x7ec           488b542408      MOVQ 0x8(SP), DX  <br />
  main.go:13        0x7f1           488b02          MOVQ 0(DX), AX    <br />
  main.go:13        0x7f4           ffd0            CALL AX         [0:0]R_CALLIND    <br />
  main.go:14        0x7f6           488b542408      MOVQ 0x8(SP), DX  <br />
  main.go:14        0x7fb           488b02          MOVQ 0(DX), AX    <br />
  main.go:14        0x7fe           ffd0            CALL AX         [0:0]R_CALLIND    <br />
  main.go:15        0x800           488b6c2410      MOVQ 0x10(SP), BP <br />
  main.go:15        0x805           4883c418        ADDQ $0x18, SP    <br />
  main.go:15        0x809           c3          RET       <br />
  main.go:10        0x80a           e800000000      CALL 0x80f      [1:5]R_CALL:runtime.morestack_noctxt  <br />
  main.go:10        0x80f           ebab            JMP %22%22.main(SB)</p>

<p>TEXT %22%22.test.func1(SB) gofile../Users/user/go/src/test/main.go
  main.go:5     0x84b           4883ec10        SUBQ $0x10, SP    <br />
  main.go:5     0x84f           48896c2408      MOVQ BP, 0x8(SP)  <br />
  main.go:5     0x854           488d6c2408      LEAQ 0x8(SP), BP  <br />
  main.go:5     0x859           488b4208        MOVQ 0x8(DX), AX  <br />
  main.go:5     0x85d           48890424        MOVQ AX, 0(SP)    <br />
  main.go:6     0x861           48830064        ADDQ $0x64, 0(AX) <br />
  main.go:7     0x865           488b6c2408      MOVQ 0x8(SP), BP  <br />
  main.go:7     0x86a           4883c410        ADDQ $0x10, SP    <br />
  main.go:7     0x86e           c3          RET</p>

<p>é€’å½’å‡½æ•°
ä»æœ¬è´¨ä¸Šè®²é€’å½’å‡½æ•°ä¸æ™®é€šå‡½æ•°å¹¶æ— ç‰¹æ®Šä¹‹å¤„ï¼Œåªæ˜¯ä¸æ–­è°ƒç”¨è‡ªèº«ï¼Œæ ˆä¸æ–­å¢åŠ è€Œå·²ã€‚åœ¨ C é‡Œé¢æ ˆå¤§å°æ˜¯å›ºå®šçš„ï¼Œå› æ­¤éœ€è¦å…³å¿ƒæ ˆæº¢å‡º(Stack overflow)çš„é—®é¢˜ã€‚ä¸è¿‡ Go é‡Œé¢æ ˆæ ¹æ®éœ€è¦è‡ªåŠ¨æ‰©å®¹ï¼Œä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªé—®é¢˜ã€‚</p>

<p>å…³äº defer è¯­å¥
deferä¸return
å¯ä»¥å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢ä¸‰ä¸ªå‡½æ•°ï¼Œå°è¯•æ¨ç†å‡½æ•°çš„è¿”å›å€¼ï¼š</p>

<p>func f() (result int) {
    defer func() {
        result++
    }()
    return 0
}</p>

<p>func f() (r int) {
     t := 5 
     defer func() {
       t = t + 5
     }()
     return t
}</p>

<p>func f() (r int) {
    defer func(r int) {
          r = r + 5
    }(r)
    return 1
}</p>

<p>æ­£ç¡®ç­”æ¡ˆåˆ†åˆ«æ˜¯ï¼š1ï¼Œ5ï¼Œ1ã€‚å¦‚æœä½ çš„ç­”æ¡ˆæ­£ç¡®ï¼Œå¯ä»¥ç•¥è¿‡ä¸‹é¢çš„è§£é‡Šäº† :)</p>

<p>â€œdefer åçš„å‡½æ•°è°ƒç”¨ åœ¨ return è¯­å¥ä¹‹å‰æ‰§è¡Œâ€è¿™å¥è¯å¹¶ä¸å®¹æ˜“ç†è§£æ­£ç¡®ã€‚å®é™…ä¸Š return xxx è¯­å¥ä¸æ˜¯åŸå­çš„ï¼Œè€Œæ˜¯å…ˆå°†xxxå†™å…¥åˆ° caller ä¸ºè¿”å›å€¼åˆ†é…çš„æ ˆç©ºé—´ï¼Œæ¥ç€æ‰§è¡Œ RET æŒ‡ä»¤è¿™ä¸¤æ­¥æ“ä½œã€‚deferå‡½æ•°å°±æ˜¯æ’å…¥åœ¨ RET æŒ‡ä»¤å‰æ‰§è¡Œã€‚</p>

<p>goroutineçš„æ§åˆ¶ç»“æ„é‡Œæœ‰ä¸€å¼ è®°å½•deferè¡¨è¾¾å¼çš„è¡¨ï¼Œç¼–è¯‘å™¨åœ¨deferå‡ºç°çš„åœ°æ–¹æ’å…¥äº†æŒ‡ä»¤ call runtime.deferprocï¼Œå®ƒå°†deferçš„è¡¨è¾¾å¼è®°å½•åœ¨è¡¨ä¸­ã€‚ç„¶ååœ¨å‡½æ•°è¿”å›ä¹‹å‰ä¾æ¬¡ä»deferè¡¨ä¸­å°†è¡¨è¾¾å¼å‡ºæ ˆæ‰§è¡Œï¼Œè¿™æ—¶æ’å…¥çš„æŒ‡ä»¤æ˜¯call runtime.deferreturnã€‚</p>

<p>defer ä¸é—­åŒ…
defer è¯­å¥è°ƒç”¨çš„å‡½æ•°çš„å‚æ•°æ˜¯åœ¨deferæ³¨å†Œæ—¶æ±‚å€¼æˆ–å¤åˆ¶çš„ã€‚å› æ­¤å±€éƒ¨å˜é‡ä½œä¸ºå‚æ•°ä¼ é€’ç»™deferçš„å‡½æ•°è¯­å¥åï¼Œåé¢å¯¹å±€éƒ¨å˜é‡çš„ä¿®æ”¹å°†ä¸å†å½±å“deferå‡½æ•°å†…å¯¹è¯¥å˜é‡å€¼çš„ä½¿ç”¨ã€‚ä½†æ˜¯deferå‡½æ•°é‡Œä½¿ç”¨éå‚æ•°ä¼ å…¥çš„å¤–éƒ¨å‡½æ•°çš„å˜é‡ï¼Œå°†ä½¿ç”¨åˆ°è¯¥å˜é‡åœ¨å¤–éƒ¨å‡½æ•°ç”Ÿå‘½å‘¨æœŸå†…æœ€ç»ˆçš„å€¼ã€‚</p>

<p>package main</p>

<p>import â€œfmtâ€</p>

<p>func test() {
    x, y := 10, 20
    defer func(i int) {
        fmt.Println(â€œdefer:â€, i, y)
    }(x)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x += 10
y += 100
fmt.Println(x, y) }
</code></pre></div></div>

<p>func main(){
    test()
}
è¾“å‡ºï¼š
20 120
defer: 10 120
å¤‡æ³¨ï¼š
å†…å­˜ä¸­æ ˆä»é«˜åœ°å€ç©ºé—´å‘ä½åœ°å€ç©ºé—´å¢é•¿ï¼Œæ ˆé¡¶æ¯”æ ˆåº•çš„å†…å­˜åœ°å€å°ï¼Œåˆ†é…æ ˆç©ºé—´å¯¹åº”çš„æ˜¯ sp å€¼çš„å‡å°ã€‚
å†™å€¼æ˜¯ä»ä½åœ°å€å¾€é«˜åœ°å€å†™ï¼Œæ¯”å¦‚ SP æŒ‡å‘ 0xff00ï¼Œå¾€æ ˆé‡Œå†™å…¥ä¸€ä¸ªå­—(8 å­—èŠ‚)ï¼Œå ç”¨çš„æ˜¯ 0xff00 åˆ° 0xff07 è¿™ 8 ä¸ªå­—èŠ‚ã€‚
intelå­˜å‚¨å­—èŠ‚çš„é¡ºåºä¸ºå°ç«¯ä¼˜å…ˆï¼šå³ä½æœ‰æ•ˆå­—èŠ‚å­˜å‚¨åœ¨å†…å­˜ä½åœ°å€ä¸­ã€‚
åœ¨IA-32å’ŒX86-64ä¸­ï¼Œå­—é•¿å®šä¹‰ä¸º16ä½ï¼Œdwordï¼ˆåŒå€å­—ï¼‰æ˜¯ 32 ä½ï¼Œqwordï¼ˆå››å€å­—ï¼‰æ˜¯64ä½ã€‚
ç”Ÿæˆæ±‡ç¼–æ–‡ä»¶çš„æ–¹æ³•
ä½¿ç”¨ go tool compile -N -l -S go_file.go ç”Ÿæˆ
ä½¿ç”¨ go tool compile -N -l go_file.goç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ¥ç€æ‰§è¡Œ go tool objdump bin_name.oåæ±‡ç¼–å‡ºä»£ç ï¼Œå¯ä»¥é€šè¿‡ -s æŒ‡å®šå‡½æ•°åä»è€Œåªåæ±‡ç¼–ç‰¹å®šå‡½æ•°ï¼šgo tool objdump -s YOUR_FUNC_NAME bin_name.o
ä½¿ç”¨ go build -gcflags -Sç”Ÿæˆ
æ³¨æ„ï¼šgo tool compile å’Œ go build -gcflags -S ç”Ÿæˆçš„æ˜¯è¿‡ç¨‹ä¸­çš„æ±‡ç¼–ï¼Œgo tool objdumpç”Ÿæˆçš„æ˜¯æœ€ç»ˆçš„æœºå™¨ç çš„æ±‡ç¼–ã€‚</p>

<p>æ€»ç»“
Go è¯­è¨€å®Œå…¨ä½¿ç”¨æ ˆæ¥ä¼ é€’å‚æ•°å’Œè¿”å›å€¼å¹¶ç”±è°ƒç”¨è€…è´Ÿè´£æ¸…æ ˆï¼Œé€šè¿‡æ ˆä¼ é€’è¿”å›å€¼ä½¿å¾—Goå‡½æ•°èƒ½æ”¯æŒå¤šè¿”å›å€¼ï¼Œè°ƒç”¨è€…æ¸…æ ˆåˆ™å¯ä»¥å®ç°å¯å˜å‚æ•°çš„å‡½æ•°ã€‚Go ä½¿ç”¨å€¼ä¼ é€’çš„æ¨¡å¼ä¼ é€’å‚æ•°ï¼Œå› æ­¤ä¼ é€’æ•°ç»„å’Œç»“æ„ä½“æ—¶ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨æŒ‡é’ˆä½œä¸ºå‚æ•°æ¥é¿å…å¤§é‡æ•°æ®æ‹·è´ä»è€Œæå‡æ€§èƒ½ã€‚
ã€€ã€€Go æ–¹æ³•è°ƒç”¨çš„æ—¶å€™æ˜¯å°†æ¥æ”¶è€…ä½œä¸ºå‚æ•°ä¼ é€’ç»™äº†calleeï¼Œæ¥æ”¶è€…åˆ†å€¼æ¥æ”¶è€…å’ŒæŒ‡é’ˆæ¥æ”¶è€…ã€‚
ã€€ã€€å½“ä¼ é€’åŒ¿åå‡½æ•°çš„æ—¶å€™ï¼Œä¼ é€’çš„å®é™…ä¸Šæ˜¯å‡½æ•°çš„å…¥å£æŒ‡é’ˆã€‚å½“ä½¿ç”¨é—­åŒ…çš„æ—¶å€™ï¼ŒGo é€šè¿‡é€ƒé€¸åˆ†ææœºåˆ¶å°†å˜é‡åˆ†é…åˆ°å †å†…å­˜ï¼Œå˜é‡åœ°å€å’Œå‡½æ•°å…¥å£åœ°å€ç»„æˆä¸€ä¸ªå­˜åœ¨å †ä¸Šçš„ç»“æ„ä½“ï¼Œä¼ é€’é—­åŒ…çš„æ—¶å€™ï¼Œä¼ é€’çš„å°±æ˜¯è¿™ä¸ªç»“æ„ä½“çš„åœ°å€ã€‚
ã€€ã€€Go çš„æ•°æ®ç±»å‹åˆ†ä¸ºå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹ï¼Œä½† Go çš„å‚æ•°ä¼ é€’æ˜¯å€¼ä¼ é€’ã€‚å½“ä¼ é€’çš„æ˜¯å€¼ç±»å‹çš„æ—¶å€™ï¼Œæ˜¯å®Œå…¨çš„æ‹·è´ï¼Œcalleeé‡Œå¯¹å‚æ•°çš„ä¿®æ”¹ä¸å½±å“åŸå€¼ï¼›å½“ä¼ é€’çš„æ˜¯å¼•ç”¨ç±»å‹çš„æ—¶å€™ï¼Œcalleeé‡Œçš„ä¿®æ”¹ä¼šå½±å“åŸå€¼ã€‚
ã€€ã€€å¸¦è¿”å›å€¼çš„returnè¯­å¥å¯¹åº”çš„æ˜¯å¤šæ¡æœºå™¨æŒ‡ä»¤ï¼Œé¦–å…ˆæ˜¯å°†è¿”å›å€¼å†™å…¥åˆ°calleråœ¨æ ˆä¸Šä¸ºè¿”å›å€¼åˆ†é…çš„ç©ºé—´ï¼Œç„¶åæ‰§è¡ŒretæŒ‡ä»¤ã€‚æœ‰deferè¯­å¥çš„æ—¶å€™ï¼Œdeferè¯­å¥é‡Œçš„å‡½æ•°å°±æ˜¯æ’å…¥åˆ° ret æŒ‡ä»¤ä¹‹å‰æ‰§è¡Œã€‚
ã€€ã€€
ã€€ã€€https://d3s.mff.cuni.cz/legacy/~ceres/sch/osy/text/ch03s02s01.html
ã€€ã€€https://originlee.com/2015/04/05/runtime-memory-model-and-stack-frame/
ã€€ã€€http://xargin.com/plan9-assembly/</p>
:ET