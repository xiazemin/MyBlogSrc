I"²^<p>http://team.jiunile.com/blog/2020/05/go-debug-practice.html
åœºæ™¯1ï¼š å¦‚ä½•åˆ†æç¨‹åºçš„è¿è¡Œæ—¶é—´ä¸CPUåˆ©ç”¨ç‡æƒ…å†µï¼Ÿ
shellå†…ç½®timeæŒ‡ä»¤
è¿™ä¸ªæ–¹æ³•ä¸ç®—æ–°é¢–ï¼Œä½†æ˜¯ç¡®å¾ˆå®ç”¨ã€‚ timeæ˜¯Unix/Linuxå†…ç½®å¤šå‘½ä»¤ï¼Œä½¿ç”¨æ—¶ä¸€èˆ¬ä¸ç”¨ä¼ è¿‡å¤šå‚æ•°ï¼Œç›´æ¥è·Ÿä¸Šéœ€è¦è°ƒè¯•å¤šç¨‹åºå³å¯ã€‚</p>

<p>$ time go run test2.go 
&amp;{{0 0} å¼ ä¸‰ 0}</p>

<p>real    0m0.843s
user    0m0.216s
sys 0m0.389s
ä¸Šé¢æ˜¯ä½¿ç”¨timeå¯¹ go run test2.go å¯¹æ‰§è¡Œç¨‹åºåäº†æ€§èƒ½åˆ†æï¼Œå¾—åˆ°3ä¸ªæŒ‡æ ‡ã€‚</p>

<p>realï¼šä»ç¨‹åºå¼€å§‹åˆ°ç»“æŸï¼Œå®é™…åº¦è¿‡çš„æ—¶é—´ï¼›
userï¼šç¨‹åºåœ¨ç”¨æˆ·æ€åº¦è¿‡çš„æ—¶é—´ï¼›
sysï¼šç¨‹åºåœ¨å†…æ ¸æ€åº¦è¿‡çš„æ—¶é—´
ä¸€èˆ¬æƒ…å†µä¸‹ real &gt;= user + sysï¼Œå› ä¸ºç³»ç»Ÿè¿˜æœ‰å…¶å®ƒè¿›ç¨‹(åˆ‡æ¢å…¶ä»–è¿›ç¨‹ä¸­é—´å¯¹äºæœ¬è¿›ç¨‹å›æœ‰ç©ºç™½æœŸ)ã€‚
<!-- more -->
/usr/bin/timeæŒ‡ä»¤
è¿™ä¸ªæŒ‡ä»¤æ¯”å†…ç½®çš„timeæ›´åŠ è¯¦ç»†ä¸€äº›ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦ç”¨ç»å¯¹è·¯å¾„ï¼Œè€Œä¸”è¦åŠ ä¸Šå‚æ•° -v</p>

<p>$ /usr/bin/time -v go run test2.go</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Command being timed: "go run test2.go"
User time (seconds): 0.12
System time (seconds): 0.06
Percent of CPU this job got: 115%
Elapsed (wall clock) time (h:mm:ss or m:ss): 0:00.16
Average shared text size (kbytes): 0
Average unshared data size (kbytes): 0
Average stack size (kbytes): 0
Average total size (kbytes): 0
Maximum resident set size (kbytes): 41172
Average resident set size (kbytes): 0
Major (requiring I/O) page faults: 1
Minor (reclaiming a frame) page faults: 15880
Voluntary context switches: 897
Involuntary context switches: 183
Swaps: 0
File system inputs: 256
File system outputs: 2664
Socket messages sent: 0
Socket messages received: 0
Signals delivered: 0
Page size (bytes): 4096
Exit status: 0 å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„åŠŸèƒ½è¦å¼ºå¤§å¤šäº†ï¼Œé™¤äº†ä¹‹å‰çš„ä¿¡æ¯å¤–ï¼Œè¿˜åŒ…æ‹¬äº†ï¼š
</code></pre></div></div>

<p>CPUå ç”¨ç‡ï¼›
å†…å­˜ä½¿ç”¨æƒ…å†µï¼›
Page Fault æƒ…å†µï¼›
è¿›ç¨‹åˆ‡æ¢æƒ…å†µï¼›
æ–‡ä»¶ç³»ç»ŸIOï¼›
Socket ä½¿ç”¨æƒ…å†µï¼›
â€¦â€¦
åœºæ™¯2ï¼š å¦‚ä½•åˆ†ægolangç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Ÿ
å†…å­˜å ç”¨æƒ…å†µæŸ¥çœ‹
æˆ‘ä»¬å…ˆå†™ä¸€æ®µdemoä¾‹å­ä»£ç </p>

<p>package main</p>

<p>import (
    â€œlogâ€
    â€œruntimeâ€
    â€œtimeâ€
)</p>

<p>func test() {
    //slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·
    container := make([]int, 8)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>log.Println(" ===&gt; loop begin.")
for i := 0; i &lt; 32*1000*1000; i++ {
    container = append(container, i)
}
log.Println(" ===&gt; loop end.") }
</code></pre></div></div>

<p>func main() {
    log.Println(â€œStart.â€)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test()

log.Println("force gc.")
runtime.GC() //å¼ºåˆ¶è°ƒç”¨gcå›æ”¶

log.Println("Done.")

time.Sleep(3600 * time.Second) //ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º } ç¼–è¯‘
</code></pre></div></div>

<p>$go build -o snippet_mem &amp;&amp; ./snippet_mem
ç„¶ååœ¨./snippet_memè¿›ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œï¼Œæˆ‘ä»¬å†å¼€ä¸€ä¸ªçª—å£ï¼Œé€šè¿‡ top å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜å ç”¨æƒ…å†µ</p>

<p>$top -p $(pidof snippet_mem)
å¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š
go debug top</p>

<p>æˆ‘ä»¬çœ‹å‡ºæ¥ï¼Œæ²¡æœ‰é€€å‡ºçš„snippet_memè¿›ç¨‹æœ‰çº¦830mçš„å†…å­˜è¢«å ç”¨ã€‚</p>

<p>ç›´è§‚ä¸Šæ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºåœ¨ test() å‡½æ•°æ‰§è¡Œå®Œåï¼Œåˆ‡ç‰‡ contaner çš„å†…å­˜åº”è¯¥è¢«é‡Šæ”¾ï¼Œä¸åº”è¯¥å ç”¨830Mé‚£ä¹ˆå¤§ã€‚</p>

<p>ä¸‹é¢è®©æˆ‘ä»¬ä½¿ç”¨GODEBUGæ¥åˆ†æç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p>

<p>GODEBUGä¸gctrace
ç”¨æ³•
æ‰§è¡Œsnippet_memç¨‹åºä¹‹å‰æ·»åŠ ç¯å¢ƒå˜é‡GODEBUG=â€™gctrace=1â€™æ¥è·Ÿè¸ªæ‰“å°åƒåœ¾å›æ”¶å™¨ä¿¡æ¯</p>

<p>$ GODEBUG=â€™gctrace=1â€™ ./snippet_mem
è®¾ç½®gctrace=1ä¼šä½¿å¾—åƒåœ¾å›æ”¶å™¨åœ¨æ¯æ¬¡å›æ”¶æ—¶æ±‡æ€»æ‰€å›æ”¶å†…å­˜çš„å¤§å°ä»¥åŠè€—æ—¶ï¼Œ
å¹¶å°†è¿™äº›å†…å®¹æ±‡æ€»æˆå•è¡Œå†…å®¹æ‰“å°åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºä¸­ã€‚</p>

<p>æ ¼å¼
gc # @#s #%: #+#+# ms clock, #+#/#/#+# ms cpu, #-&gt;#-&gt;# MB, # MB goal, # P
å«ä¹‰</p>

<p>gc #        GCæ¬¡æ•°çš„ç¼–å·ï¼Œæ¯æ¬¡GCæ—¶é€’å¢
@#s         è·ç¦»ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶çš„æ—¶é—´
#%          GCå ç”¨çš„æ‰§è¡Œæ—¶é—´ç™¾åˆ†æ¯”
#+â€¦+#     GCä½¿ç”¨çš„æ—¶é—´
#-&gt;#-&gt;# MB  GCå¼€å§‹ï¼Œç»“æŸï¼Œä»¥åŠå½“å‰æ´»è·ƒå †å†…å­˜çš„å¤§å°ï¼Œå•ä½M</p>
<h1 id="mb-goal---å…¨å±€å †å†…å­˜å¤§å°">MB goal   å…¨å±€å †å†…å­˜å¤§å°</h1>
<h1 id="p---------ä½¿ç”¨processorçš„æ•°é‡">P         ä½¿ç”¨processorçš„æ•°é‡</h1>
<p>å¦‚æœæ¯æ¡ä¿¡æ¯æœ€åï¼Œä»¥(forced)ç»“å°¾ï¼Œé‚£ä¹ˆè¯¥ä¿¡æ¯æ˜¯ç”±runtime.GC()è°ƒç”¨è§¦å‘</p>

<p>æˆ‘ä»¬æ¥é€‰æ‹©å…¶ä¸­ä¸€è¡Œæ¥è§£é‡Šä¸€ä¸‹ï¼š</p>

<p>gc 17 @0.149s 1%: 0.004+36+0.003 ms clock, 0.009+0/0.051/36+0.006 ms cpu, 181-&gt;181-&gt;101 MB, 182 MB goal, 2 P
è¯¥æ¡ä¿¡æ¯å«ä¹‰å¦‚ä¸‹ï¼š</p>

<p>gc 17: Gc è°ƒè¯•ç¼–å·ä¸º17
@0.149s: æ­¤æ—¶ç¨‹åºå·²ç»æ‰§è¡Œäº†0.149s
1%: 0.149sä¸­å…¶ä¸­gcæ¨¡å—å ç”¨äº†1%çš„æ—¶é—´
0.004+36+0.003 ms clock: åƒåœ¾å›æ”¶çš„æ—¶é—´ï¼Œåˆ†åˆ«ä¸ºSTWï¼ˆstop-the-worldï¼‰æ¸…æ‰«çš„æ—¶é—´+å¹¶å‘æ ‡è®°å’Œæ‰«æçš„æ—¶é—´+STWæ ‡è®°çš„æ—¶é—´
0.009+0/0.051/36+0.006 ms cpu: åƒåœ¾å›æ”¶å ç”¨cpuæ—¶é—´
181-&gt;181-&gt;101 MB: GCå¼€å§‹å‰å †å†…å­˜181Mï¼Œ GCç»“æŸåå †å†…å­˜181Mï¼Œå½“å‰æ´»è·ƒçš„å †å†…å­˜101M
182 MB goal: å…¨å±€å †å†…å­˜å¤§å°
2 P: æœ¬æ¬¡GCä½¿ç”¨äº†2ä¸ªP(è°ƒåº¦å™¨ä¸­çš„Processer)
äº†è§£äº†GCçš„è°ƒè¯•ä¿¡æ¯è¯»æ³•åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æœ¬æ¬¡GCçš„ç»“æœã€‚</p>

<p>æˆ‘ä»¬è¿˜æ˜¯æ‰§è¡ŒGODEBUGè°ƒè¯•</p>

<p>$ GODEBUG=â€™gctrace=1â€™ ./snippet_mem
ç»“æœå¦‚ä¸‹:</p>

<p>2020/03/02 11:22:37 Start.
2020/03/02 11:22:37  ===&gt; loop begin.
gc 1 @0.002s 5%: 0.14+0.45+0.002 ms clock, 0.29+0/0.042/0.33+0.005 ms cpu, 4-&gt;4-&gt;0 MB, 5 MB goal, 2 P
gc 2 @0.003s 4%: 0.13+3.7+0.019 ms clock, 0.27+0/0.037/2.8+0.038 ms cpu, 4-&gt;4-&gt;2 MB, 5 MB goal, 2 P
gc 3 @0.008s 3%: 0.002+1.1+0.001 ms clock, 0.005+0/0.083/1.0+0.003 ms cpu, 6-&gt;6-&gt;2 MB, 7 MB goal, 2 P
gc 4 @0.010s 3%: 0.003+0.99+0.002 ms clock, 0.006+0/0.041/0.82+0.004 ms cpu, 5-&gt;5-&gt;2 MB, 6 MB goal, 2 P
gc 5 @0.011s 4%: 0.079+0.80+0.003 ms clock, 0.15+0/0.046/0.51+0.006 ms cpu, 6-&gt;6-&gt;3 MB, 7 MB goal, 2 P
gc 6 @0.013s 4%: 0.15+3.7+0.002 ms clock, 0.31+0/0.061/3.3+0.005 ms cpu, 8-&gt;8-&gt;8 MB, 9 MB goal, 2 P
gc 7 @0.019s 3%: 0.004+2.5+0.005 ms clock, 0.008+0/0.051/2.1+0.010 ms cpu, 20-&gt;20-&gt;6 MB, 21 MB goal, 2 P
gc 8 @0.023s 5%: 0.014+3.7+0.002 ms clock, 0.029+0.040/1.2/0+0.005 ms cpu, 15-&gt;15-&gt;8 MB, 16 MB goal, 2 P
gc 9 @0.031s 4%: 0.003+1.6+0.001 ms clock, 0.007+0.094/0/0+0.003 ms cpu, 19-&gt;19-&gt;10 MB, 20 MB goal, 2 P
gc 10 @0.034s 3%: 0.006+5.2+0.004 ms clock, 0.013+0/0.045/5.0+0.008 ms cpu, 24-&gt;24-&gt;13 MB, 25 MB goal, 2 P
gc 11 @0.040s 3%: 0.12+2.6+0.002 ms clock, 0.24+0/0.043/2.5+0.004 ms cpu, 30-&gt;30-&gt;16 MB, 31 MB goal, 2 P
gc 12 @0.043s 3%: 0.11+4.4+0.002 ms clock, 0.23+0/0.044/4.1+0.005 ms cpu, 38-&gt;38-&gt;21 MB, 39 MB goal, 2 P
gc 13 @0.049s 3%: 0.008+10+0.040 ms clock, 0.017+0/0.045/10+0.080 ms cpu, 47-&gt;47-&gt;47 MB, 48 MB goal, 2 P
gc 14 @0.070s 2%: 0.004+12+0.002 ms clock, 0.008+0/0.062/12+0.005 ms cpu, 122-&gt;122-&gt;41 MB, 123 MB goal, 2 P
gc 15 @0.084s 2%: 0.11+11+0.038 ms clock, 0.22+0/0.064/3.9+0.076 ms cpu, 93-&gt;93-&gt;93 MB, 94 MB goal, 2 P
gc 16 @0.122s 1%: 0.005+25+0.010 ms clock, 0.011+0/0.12/24+0.021 ms cpu, 238-&gt;238-&gt;80 MB, 239 MB goal, 2 P
gc 17 @0.149s 1%: 0.004+36+0.003 ms clock, 0.009+0/0.051/36+0.006 ms cpu, 181-&gt;181-&gt;101 MB, 182 MB goal, 2 P
gc 18 @0.187s 1%: 0.12+19+0.004 ms clock, 0.25+0/0.049/19+0.008 ms cpu, 227-&gt;227-&gt;126 MB, 228 MB goal, 2 P
gc 19 @0.207s 1%: 0.096+27+0.004 ms clock, 0.19+0/0.077/0.73+0.009 ms cpu, 284-&gt;284-&gt;284 MB, 285 MB goal, 2 P
gc 20 @0.287s 0%: 0.005+944+0.040 ms clock, 0.011+0/0.048/1.3+0.081 ms cpu, 728-&gt;728-&gt;444 MB, 729 MB goal, 2 P
2020/03/02 11:22:38  ===&gt; loop end.
2020/03/02 11:22:38 force gc.
gc 21 @1.236s 0%: 0.004+0.099+0.001 ms clock, 0.008+0/0.018/0.071+0.003 ms cpu, 444-&gt;444-&gt;0 MB, 888 MB goal, 2 P (forced)
2020/03/02 11:22:38 Done.
GC forced
gc 22 @122.455s 0%: 0.010+0.15+0.003 ms clock, 0.021+0/0.025/0.093+0.007 ms cpu, 0-&gt;0-&gt;0 MB, 4 MB goal, 2 P
GC forced
gc 23 @242.543s 0%: 0.007+0.075+0.002 ms clock, 0.014+0/0.022/0.085+0.004 ms cpu, 0-&gt;0-&gt;0 MB, 4 MB goal, 2 P
GC forced
gc 24 @362.545s 0%: 0.018+0.19+0.006 ms clock, 0.037+0/0.055/0.15+0.013 ms cpu, 0-&gt;0-&gt;0 MB, 4 MB goal, 2 P
GC forced
gc 25 @482.548s 0%: 0.012+0.25+0.005 ms clock, 0.025+0/0.025/0.11+0.010 ms cpu, 0-&gt;0-&gt;0 MB, 4 MB goal, 2 P
GC forced
gc 26 @602.551s 0%: 0.009+0.10+0.003 ms clock, 0.018+0/0.021/0.075+0.006 ms cpu, 0-&gt;0-&gt;0 MB, 4 MB goal, 2 P
GC forced
gc 27 @722.554s 0%: 0.012+0.30+0.005 ms clock, 0.025+0/0.15/0.22+0.011 ms cpu, 0-&gt;0-&gt;0 MB, 4 MB goal, 2 P
GC forced
gc 28 @842.556s 0%: 0.027+0.18+0.003 ms clock, 0.054+0/0.11/0.14+0.006 ms cpu, 0-&gt;0-&gt;0 MB, 4 MB goal, 2 P
â€¦
åˆ†æ
å…ˆçœ‹åœ¨test()å‡½æ•°æ‰§è¡Œå®Œåç«‹å³æ‰“å°çš„gc 21é‚£è¡Œçš„ä¿¡æ¯ã€‚444-&gt;444-&gt;0 MB, 888 MB goalè¡¨ç¤ºåƒåœ¾å›æ”¶å™¨å·²ç»æŠŠ444Mçš„å†…å­˜æ ‡è®°ä¸ºéæ´»è·ƒçš„å†…å­˜ã€‚</p>

<p>å†çœ‹ä¸‹ä¸€ä¸ªè®°å½•gc 22ã€‚0-&gt;0-&gt;0 MB, 4 MB goalè¡¨ç¤ºåƒåœ¾å›æ”¶å™¨ä¸­çš„å…¨å±€å †å†…å­˜å¤§å°ç”±888Mä¸‹é™ä¸º4Mã€‚</p>

<p>ç»“è®º
åœ¨test()å‡½æ•°æ‰§è¡Œå®Œåï¼Œdemoç¨‹åºä¸­çš„åˆ‡ç‰‡å®¹å™¨æ‰€ç”³è¯·çš„å †ç©ºé—´éƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶äº†ã€‚
å¦‚æœæ­¤æ—¶åœ¨topæŒ‡ä»¤æŸ¥è¯¢å†…å­˜çš„æ—¶å€™ï¼Œå¦‚æœä¾ç„¶å…ˆæ­»800+MBï¼Œè¯´æ˜åƒåœ¾å›æ”¶å™¨å›æ”¶äº†åº”ç”¨å±‚çš„å†…å­˜åï¼Œï¼ˆå¯èƒ½ï¼‰å¹¶ä¸ä¼šç«‹å³å°†å†…å­˜å½’è¿˜ç»™ç³»ç»Ÿã€‚å…·ä½“åˆ†æåŸå› å¯è§ï¼šè¸©å‘è®°ï¼šgoæœåŠ¡å†…å­˜æš´æ¶¨
runtime.ReadMemStats
æ¥ä¸‹æ¥æˆ‘ä¹ˆæ¢å¦ä¸€ç§æ–¹å¼æŸ¥çœ‹å†…å­˜çš„æ–¹å¼ åˆ©ç”¨ runtimeåº“é‡Œçš„ReadMemStats()æ–¹æ³•</p>

<p>// demo2.go</p>

<p>package main</p>

<p>import (
    â€œlogâ€
    â€œruntimeâ€
    â€œtimeâ€
)</p>

<p>func readMemStats() {
    var ms runtime.MemStats
    runtime.ReadMemStats(&amp;ms)
    log.Printf(â€œ ===&gt; Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)â€, ms.Alloc, ms.HeapIdle, ms.HeapReleased)
}</p>

<p>func test() {
    //slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·
    container := make([]int, 8)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>log.Println(" ===&gt; loop begin.")
for i := 0; i &lt; 32*1000*1000; i++ {
    container = append(container, i)
    if ( i == 16*1000*1000) {
        readMemStats()
    }
}

log.Println(" ===&gt; loop end.") }
</code></pre></div></div>

<p>func main() {
    log.Println(â€œ ===&gt; [Start].â€)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>readMemStats()
test()
readMemStats()

log.Println(" ===&gt; [force gc].")
runtime.GC() //å¼ºåˆ¶è°ƒç”¨gcå›æ”¶

log.Println(" ===&gt; [Done].")
readMemStats()

go func() {
    for {
        readMemStats()
        time.Sleep(10 * time.Second)
    }
}()

time.Sleep(3600 * time.Second) //ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º } è¿™é‡Œæˆ‘ä»¬ï¼Œ å°è£…äº†ä¸€ä¸ªå‡½æ•°readMemStats()ï¼Œè¿™é‡Œé¢ä¸»è¦æ˜¯è°ƒç”¨runtimeä¸­çš„ReadMemStats()æ–¹æ³•è·å¾—å†…å­˜ä¿¡æ¯ï¼Œç„¶åé€šè¿‡logæ‰“å°å‡ºæ¥ã€‚
</code></pre></div></div>

<p>æˆ‘ä»¬æ‰§è¡Œä¸€ä¸‹ä»£ç å¹¶è¿è¡Œ:</p>

<p>$ go run demo2.go 
2020/03/02 18:21:17  ===&gt; [Start].
2020/03/02 18:21:17  ===&gt; Alloc:71280(bytes) HeapIdle:66633728(bytes) HeapReleased:66600960(bytes)
2020/03/02 18:21:17  ===&gt; loop begin.
2020/03/02 18:21:18  ===&gt; Alloc:132535744(bytes) HeapIdle:336756736(bytes) HeapReleased:155721728(bytes)
2020/03/02 18:21:38  ===&gt; loop end.
2020/03/02 18:21:38  ===&gt; Alloc:598300600(bytes) HeapIdle:609181696(bytes) HeapReleased:434323456(bytes)
2020/03/02 18:21:38  ===&gt; [force gc].
2020/03/02 18:21:38  ===&gt; [Done].
2020/03/02 18:21:38  ===&gt; Alloc:55840(bytes) HeapIdle:1207427072(bytes) HeapReleased:434266112(bytes)
2020/03/02 18:21:38  ===&gt; Alloc:56656(bytes) HeapIdle:1207394304(bytes) HeapReleased:434266112(bytes)
2020/03/02 18:21:48  ===&gt; Alloc:56912(bytes) HeapIdle:1207394304(bytes) HeapReleased:1206493184(bytes)
2020/03/02 18:21:58  ===&gt; Alloc:57488(bytes) HeapIdle:1207394304(bytes) HeapReleased:1206493184(bytes)
2020/03/02 18:22:08  ===&gt; Alloc:57616(bytes) HeapIdle:1207394304(bytes) HeapReleased:1206493184(bytes)
c2020/03/02 18:22:18  ===&gt; Alloc:57744(bytes) HeapIdle:1207394304(bytes) HeapReleased:1206493184(by
å¯ä»¥çœ‹åˆ°ï¼Œæ‰“å°[Done].ä¹‹åé‚£æ¡traceä¿¡æ¯ï¼ŒAllocå·²ç»ä¸‹é™ï¼Œå³å†…å­˜å·²è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚åœ¨2020/03/02 18:21:38å’Œ2020/03/02 18:21:48çš„ä¸¤æ¡traceä¿¡æ¯ä¸­ï¼ŒHeapReleasedå¼€å§‹ä¸Šå‡ï¼Œå³åƒåœ¾å›æ”¶å™¨æŠŠå†…å­˜å½’è¿˜ç»™ç³»ç»Ÿã€‚</p>

<p>å¦å¤–ï¼ŒMemStatsè¿˜å¯ä»¥è·å–å…¶å®ƒå“ªäº›ä¿¡æ¯ä»¥åŠå­—æ®µçš„å«ä¹‰å¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£ï¼šhttp://golang.org/pkg/runtime/#MemStats</p>

<p>pprofå·¥å…·
pprofå·¥å…·æ”¯æŒç½‘é¡µä¸ŠæŸ¥çœ‹å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œéœ€è¦åœ¨ä»£ç ä¸­æ·»åŠ ä¸€ä¸ªåç¨‹å³å¯ã€‚</p>

<p>import(
    â€œnet/httpâ€
    _ â€œnet/http/pprofâ€
)</p>

<p>go func() {
    log.Println(http.ListenAndServe(â€œ0.0.0.0:10000â€, nil))
}()
å…·ä½“æ·»åŠ çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>

<p>//demo3.go</p>

<p>package main</p>

<p>import (
    â€œlogâ€
    â€œruntimeâ€
    â€œtimeâ€
    â€œnet/httpâ€
    _ â€œnet/http/pprofâ€
)</p>

<p>func readMemStats() {
    var ms runtime.MemStats
    runtime.ReadMemStats(&amp;ms)
    log.Printf(â€œ ===&gt; Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)â€, ms.Alloc, ms.HeapIdle, ms.HeapReleased)
}</p>

<p>func test() {
    //slice ä¼šåŠ¨æ€æ‰©å®¹ï¼Œç”¨sliceæ¥åšå †å†…å­˜ç”³è¯·
    container := make([]int, 8)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>log.Println(" ===&gt; loop begin.")
for i := 0; i &lt; 32*1000*1000; i++ {
    container = append(container, i)
    if ( i == 16*1000*1000) {
        readMemStats()
    }
}

log.Println(" ===&gt; loop end.") }
</code></pre></div></div>

<p>func main() {
    //å¯åŠ¨pprof
    go func() {
        log.Println(http.ListenAndServe(â€œ0.0.0.0:10000â€, nil))
    }()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>log.Println(" ===&gt; [Start].")

readMemStats()
test()
readMemStats()

log.Println(" ===&gt; [force gc].")
runtime.GC() //å¼ºåˆ¶è°ƒç”¨gcå›æ”¶

log.Println(" ===&gt; [Done].")
readMemStats()

go func() {
    for {
        readMemStats()
        time.Sleep(10 * time.Second)
    }
}()

time.Sleep(3600 * time.Second) //ç¡çœ ï¼Œä¿æŒç¨‹åºä¸é€€å‡º } æˆ‘ä»¬æ­£å¸¸è¿è¡Œç¨‹åºï¼Œç„¶ååŒæ—¶æ‰“å¼€æµè§ˆå™¨ï¼Œ
</code></pre></div></div>

<p>è¾“å…¥åœ°å€ï¼šhttp://127.0.0.1:10000/debug/pprof/heap?debug=1</p>

<p>æµè§ˆå™¨çš„å†…å®¹å…¶ä¸­æœ‰ä¸€éƒ¨åˆ†å¦‚ä¸‹ï¼Œè®°å½•äº†ç›®å‰çš„å†…å­˜æƒ…å†µ</p>

<h1>â€¦</h1>

<h1 id="runtimememstats">runtime.MemStats</h1>
<h1 id="alloc--228248">Alloc = 228248</h1>
<h1 id="totalalloc--1293696976">TotalAlloc = 1293696976</h1>
<h1 id="sys--834967896">Sys = 834967896</h1>
<h1 id="lookups--0">Lookups = 0</h1>
<h1 id="mallocs--2018">Mallocs = 2018</h1>
<h1 id="frees--671">Frees = 671</h1>
<h1 id="heapalloc--228248">HeapAlloc = 228248</h1>
<h1 id="heapsys--804913152">HeapSys = 804913152</h1>
<h1 id="heapidle--804102144">HeapIdle = 804102144</h1>
<h1 id="heapinuse--811008">HeapInuse = 811008</h1>
<h1 id="heapreleased--108552192">HeapReleased = 108552192</h1>
<h1 id="heapobjects--1347">HeapObjects = 1347</h1>
<h1 id="stack--360448--360448">Stack = 360448 / 360448</h1>
<h1 id="mspan--28288--32768">MSpan = 28288 / 32768</h1>
<h1 id="mcache--3472--16384">MCache = 3472 / 16384</h1>
<h1 id="buckhashsys--1449617">BuckHashSys = 1449617</h1>
<h1 id="gcsys--27418976">GCSys = 27418976</h1>
<h1 id="othersys--776551">OtherSys = 776551</h1>
<h1 id="nextgc--4194304">NextGC = 4194304</h1>
<h1 id="lastgc--1583203571137891390">LastGC = 1583203571137891390</h1>

<h1 id="-1">â€¦</h1>
<p>åœºæ™¯3: å¦‚ä½•åˆ†æGolangç¨‹åºçš„CPUæ€§èƒ½æƒ…å†µï¼Ÿ
æ€§èƒ½åˆ†ææ³¨æ„äº‹é¡¹
æ€§èƒ½åˆ†æå¿…é¡»åœ¨ä¸€ä¸ªå¯é‡å¤çš„ã€ç¨³å®šçš„ç¯å¢ƒä¸­æ¥è¿›è¡Œã€‚
æœºå™¨å¿…é¡»é—²ç½®
ä¸è¦åœ¨å…±äº«ç¡¬ä»¶ä¸Šè¿›è¡Œæ€§èƒ½åˆ†æ;
ä¸è¦åœ¨æ€§èƒ½åˆ†ææœŸé—´ï¼Œåœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šå»æµè§ˆç½‘é¡µ
æ³¨æ„çœç”µæ¨¡å¼å’Œè¿‡çƒ­ä¿æŠ¤ï¼Œå¦‚æœçªç„¶è¿›å…¥è¿™äº›æ¨¡å¼ï¼Œä¼šå¯¼è‡´åˆ†ææ•°æ®ä¸¥é‡ä¸å‡†ç¡®
ä¸è¦ä½¿ç”¨è™šæ‹Ÿæœºã€å…±äº«çš„äº‘ä¸»æœºï¼Œå¤ªå¤šå¹²æ‰°å› ç´ ï¼Œåˆ†ææ•°æ®ä¼šå¾ˆä¸ä¸€è‡´
ä¸è¦åœ¨ macOS 10.11 åŠä»¥å‰çš„ç‰ˆæœ¬è¿è¡Œæ€§èƒ½åˆ†æï¼Œæœ‰ bugï¼Œä¹‹åçš„ç‰ˆæœ¬ä¿®å¤äº†
å¦‚æœæ‰¿å—å¾—èµ·ï¼Œè´­ä¹°ä¸“ç”¨çš„æ€§èƒ½æµ‹è¯•åˆ†æçš„ç¡¬ä»¶è®¾å¤‡ï¼Œä¸Šæ¶ã€‚</p>

<p>å…³é—­ç”µæºç®¡ç†ã€è¿‡çƒ­ç®¡ç†
ç»ä¸è¦å‡çº§ï¼Œä»¥ä¿è¯æµ‹è¯•çš„ä¸€è‡´æ€§ï¼Œä»¥åŠå…·æœ‰å¯æ¯”æ€§
å¦‚æœæ²¡æœ‰è¿™æ ·çš„ç¯å¢ƒï¼Œé‚£å°±ä¸€å®šè¦åœ¨å¤šä¸ªç¯å¢ƒä¸­ï¼Œæ‰§è¡Œå¤šæ¬¡ï¼Œä»¥å–å¾—å¯å‚è€ƒçš„ã€å…·æœ‰ç›¸å¯¹ä¸€è‡´æ€§çš„æµ‹è¯•ç»“æœã€‚</p>

<p>CPUæ€§èƒ½åˆ†æ
æˆ‘ä»¬æ¥ç”¨ä¸‹é¢çš„ä»£ç è¿›è¡Œæµ‹è¯•</p>

<p>//demo4.go</p>

<p>package main</p>

<p>import (
    â€œbytesâ€
    â€œmath/randâ€
    â€œtimeâ€
    â€œlogâ€
    â€œnet/httpâ€
    _ â€œnet/http/pprofâ€
)</p>

<p>func test() {
    log.Println(â€œ ===&gt; loop begin.â€)
    for i := 0; i &lt; 1000; i++ {
        log.Println(genSomeBytes())
    }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>log.Println(" ===&gt; loop end.") }
</code></pre></div></div>

<p>//ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²
func genSomeBytes() *bytes.Buffer {
    var buff bytes.Buffer
    for i := 1; i &lt; 20000; i++ {
        buff.Write([]byte{â€˜0â€™ + byte(rand.Intn(10))})
    }
    return &amp;buff
}</p>

<p>func main() {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go func() {
    for {
        test()
        time.Sleep(time.Second * 1)
    }
}()

//å¯åŠ¨pprof
http.ListenAndServe("0.0.0.0:10000", nil)
</code></pre></div></div>

<p>}
è¿™é‡Œé¢è¿˜æ˜¯å¯åŠ¨äº†pprofçš„åšæŒº,æœ‰å…³pprofå¯åŠ¨çš„ä»£ç å¦‚ä¸‹:</p>

<p>import (
    â€œnet/httpâ€
    _ â€œnet/http/pprofâ€
)</p>

<p>func main() {
    //â€¦
  //â€¦</p>

<p>//å¯åŠ¨pprof
  http.ListenAndServe(â€œ0.0.0.0:10000â€, nil)
}
main()é‡Œçš„æµç¨‹å¾ˆç®€å•,å¯åŠ¨ä¸€ä¸ªgoroutineå»æ— é™å¾ªç¯è°ƒç”¨test()æ–¹æ³•,ä¼‘çœ 1s.</p>

<p>test()çš„æµç¨‹æ˜¯ç”Ÿæˆ1000ä¸ª20000ä¸ªå­—ç¬¦çš„éšæœºå­—ç¬¦ä¸².å¹¶ä¸”æ‰“å°.</p>

<p>æˆ‘ä»¬å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘æˆå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ demo4(è®°ä½è¿™ä¸ªåå­—,ç¨åæˆ‘ä»¬èƒ½ç”¨åˆ°)</p>

<p>$ go build demo4.go
æ¥ä¸‹æ¥æˆ‘ä»¬å¯åŠ¨ç¨‹åº,ç¨‹åºä¼šæ— é™å¾ªç¯çš„æ‰“å°å­—ç¬¦ä¸².</p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡å‡ ç§æ–¹å¼æ¥æŸ¥çœ‹è¿›ç¨‹çš„cpuæ€§èƒ½æƒ…å†µ.</p>

<p>A. Webç•Œé¢æŸ¥çœ‹
æµè§ˆå™¨è®¿é—®: http://127.0.0.1:10000/debug/pprof/</p>

<p>æˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹ç”»é¢
go pprof web</p>

<p>è¿™é‡Œé¢èƒ½å¤Ÿé€šè¿‡pprofæŸ¥çœ‹åŒ…æ‹¬(é˜»å¡ä¿¡æ¯ã€cpuä¿¡æ¯ã€å†…å­˜å †ä¿¡æ¯ã€é”ä¿¡æ¯ã€goroutineä¿¡æ¯ç­‰ç­‰), æˆ‘ä»¬è¿™é‡Œå…³å¿ƒçš„cpuçš„æ€§èƒ½çš„profileä¿¡æ¯.</p>

<p>æœ‰å…³profileä¸‹é¢çš„è‹±æ–‡è§£é‡Šå¤§è‡´å¦‚ä¸‹:</p>

<p>â€œCPUé…ç½®æ–‡ä»¶ã€‚æ‚¨å¯ä»¥åœ¨ç§’GETå‚æ•°ä¸­æŒ‡å®šæŒç»­æ—¶é—´ã€‚è·å–æ¦‚è¦æ–‡ä»¶åï¼Œè¯·ä½¿ç”¨go tool pprofå‘½ä»¤è°ƒæŸ¥æ¦‚è¦æ–‡ä»¶ã€‚â€</p>

<p>æ‰€ä»¥æˆ‘ä»¬è¦æ˜¯æƒ³å¾—åˆ°cpuæ€§èƒ½,å°±æ˜¯è¦è·å–åˆ°å½“å‰è¿›ç¨‹çš„profileæ–‡ä»¶,è¿™ä¸ªæ–‡ä»¶é»˜è®¤æ˜¯30sç”Ÿæˆä¸€ä¸ª,æ‰€ä»¥ä½ çš„ç¨‹åºè¦è‡³å°‘è¿è¡Œ30sä»¥ä¸Š(è¿™ä¸ªå‚æ•°ä¹Ÿå¯ä»¥ä¿®æ”¹,ç¨åæˆ‘ä»¬ä»‹ç»)</p>

<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ç‚¹å‡»ç½‘é¡µçš„profile,æµè§ˆå™¨ä¼šç»™æˆ‘ä»¬ä¸‹è½½ä¸€ä¸ªprofileæ–‡ä»¶. è®°ä½è¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„, å¯ä»¥æ‹·è´åˆ°ä¸demo4æ‰€åœ¨çš„åŒä¸€æ–‡ä»¶å¤¹ä¸‹.</p>

<p>B. ä½¿ç”¨pprofå·¥å…·æŸ¥çœ‹
pprof çš„æ ¼å¼å¦‚ä¸‹</p>

<p>go tool pprof [binary] [profile]
binary: å¿…é¡»æŒ‡å‘ç”Ÿæˆè¿™ä¸ªæ€§èƒ½åˆ†ææ•°æ®çš„é‚£ä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼›
profile: å¿…é¡»æ˜¯è¯¥äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶æ‰€ç”Ÿæˆçš„æ€§èƒ½åˆ†ææ•°æ®æ–‡ä»¶ã€‚
binary å’Œ profile å¿…é¡»ä¸¥æ ¼åŒ¹é…ã€‚</p>

<p>æˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹:</p>

<p>$ go tool pprof ./demo4 profile</p>

<p>File: demo4
Type: cpu
Time: Mar 3, 2020 at 11:18pm (CST)
Duration: 30.13s, Total samples = 6.27s (20.81%)
Entering interactive mode (type â€œhelpâ€ for commands, â€œoâ€ for options)
(pprof)
helpå¯ä»¥æŸ¥çœ‹ä¸€äº›æŒ‡ä»¤,æˆ‘ä¹ˆå¯ä»¥é€šè¿‡topæ¥æŸ¥çœ‹cpuçš„æ€§èƒ½æƒ…å†µ.</p>

<p>(pprof) top
Showing nodes accounting for 5090ms, 81.18% of 6270ms total
Dropped 80 nodes (cum &lt;= 31.35ms)
Showing top 10 nodes out of 60
      flat  flat%   sum%        cum   cum%
    1060ms 16.91% 16.91%     2170ms 34.61%  math/rand.(<em>lockedSource).Int63
     850ms 13.56% 30.46%      850ms 13.56%  sync.(</em>Mutex).Unlock (inline)
     710ms 11.32% 41.79%     2950ms 47.05%  math/rand.(<em>Rand).Int31n
     570ms  9.09% 50.88%      990ms 15.79%  bytes.(</em>Buffer).Write
     530ms  8.45% 59.33%      540ms  8.61%  syscall.Syscall
     370ms  5.90% 65.23%      370ms  5.90%  runtime.procyield
     270ms  4.31% 69.54%     4490ms 71.61%  main.genSomeBytes
     250ms  3.99% 73.52%     3200ms 51.04%  math/rand.(*Rand).Intn
     250ms  3.99% 77.51%      250ms  3.99%  runtime.memmove
     230ms  3.67% 81.18%      690ms 11.00%  runtime.suspendG
(pprof)
è¿™é‡Œé¢æœ‰å‡ åˆ—æ•°æ®,éœ€è¦è¯´æ˜ä¸€ä¸‹.</p>

<p>flatï¼šå½“å‰å‡½æ•°å ç”¨CPUçš„è€—æ—¶
flat%ï¼š:å½“å‰å‡½æ•°å ç”¨CPUçš„è€—æ—¶ç™¾åˆ†æ¯”
sun%ï¼šå‡½æ•°å ç”¨CPUçš„è€—æ—¶ç´¯è®¡ç™¾åˆ†æ¯”
cumï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨CPUçš„æ€»è€—æ—¶
cum%ï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨CPUçš„æ€»è€—æ—¶ç™¾åˆ†æ¯”
æœ€åä¸€åˆ—ï¼šå‡½æ•°åç§°
é€šè¿‡ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹å‡º, è¯¥ç¨‹åºçš„å¤§éƒ¨åˆ†cpuæ€§èƒ½æ¶ˆè€—åœ¨ main.getSoneBytes()æ–¹æ³•ä¸­,å…¶ä¸­math/randå–éšæœºæ•°æ¶ˆè€—æ¯”è¾ƒå¤§.</p>

<p>C. é€šè¿‡go tool pprofå¾—åˆ°profileæ–‡ä»¶
æˆ‘ä»¬ä¸Šé¢çš„profileæ–‡ä»¶æ˜¯é€šè¿‡webæµè§ˆå™¨ä¸‹è½½çš„,è¿™ä¸ªprofileçš„ç»è¿‡æ—¶é—´æ˜¯30sçš„,é»˜è®¤å€¼æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸Šä¿®æ”¹ä¸äº†,å¦‚æœä½ æƒ³å¾—åˆ°æ—¶é—´æ›´é•¿çš„cpuåˆ©ç”¨ç‡,å¯ä»¥é€šè¿‡go tool pprofæŒ‡ä»¤ä¸ç¨‹åºäº¤äº’æ¥è·å–åˆ°</p>

<p>é¦–å…ˆ,æˆ‘ä»¬å…ˆå¯åŠ¨ç¨‹åº</p>

<p>$ ./demo4
ç„¶åå†æ‰“å¼€ä¸€ä¸ªç»ˆç«¯</p>

<p>go tool pprof http://localhost:10000/debug/pprof/profile?seconds=60
è¿™é‡Œåˆ¶å®šäº†ç”Ÿæˆprofileæ–‡ä»¶çš„æ—¶é—´é—´éš”60s</p>

<p>ç­‰å¾…60sä¹‹å, ç»ˆç«¯å°±ä¼šæœ‰ç»“æœå‡ºæ¥,æˆ‘ä»¬ç»§ç»­ä½¿ç”¨topæ¥æŸ¥çœ‹.</p>

<p>$ go tool pprof http://localhost:10000/debug/pprof/profile?seconds=60
Fetching profile over HTTP from http://localhost:10000/debug/pprof/profile?seconds=60
Saved profile in /home/itheima/pprof/pprof.demo4.samples.cpu.005.pb.gz
File: demo4
Type: cpu
Time: Mar 3, 2020 at 11:59pm (CST)
Duration: 1mins, Total samples = 12.13s (20.22%)
Entering interactive mode (type â€œhelpâ€ for commands, â€œoâ€ for options)
(pprof) top
Showing nodes accounting for 9940ms, 81.95% of 12130ms total
Dropped 110 nodes (cum &lt;= 60.65ms)
Showing top 10 nodes out of 56
      flat  flat%   sum%        cum   cum%
    2350ms 19.37% 19.37%     4690ms 38.66%  math/rand.(<em>lockedSource).Int63
    1770ms 14.59% 33.97%     1770ms 14.59%  sync.(</em>Mutex).Unlock (inline)
    1290ms 10.63% 44.60%     6040ms 49.79%  math/rand.(<em>Rand).Int31n
    1110ms  9.15% 53.75%     1130ms  9.32%  syscall.Syscall
     810ms  6.68% 60.43%     1860ms 15.33%  bytes.(</em>Buffer).Write
     620ms  5.11% 65.54%     6660ms 54.91%  math/rand.(<em>Rand).Intn
     570ms  4.70% 70.24%      570ms  4.70%  runtime.procyield
     500ms  4.12% 74.36%     9170ms 75.60%  main.genSomeBytes
     480ms  3.96% 78.32%      480ms  3.96%  runtime.memmove
     440ms  3.63% 81.95%      440ms  3.63%  math/rand.(</em>rngSource).Uint64
(pprof)
ä¾ç„¶ä¼šå¾—åˆ°cpuæ€§èƒ½çš„ç»“æœ, æˆ‘ä»¬å‘ç°è¿™æ¬¡çš„ç»“æœä¸ä¸Šæ¬¡30sçš„ç»“æœç™¾åˆ†æ¯”ç±»ä¼¼.</p>

<p>D.å¯è§†åŒ–æŸ¥çœ‹
æˆ‘ä»¬è¿˜æ˜¯é€šè¿‡</p>

<p>$ go tool pprof ./demo4 profile
è¿›å…¥profileæ–‡ä»¶æŸ¥çœ‹,ç„¶åæˆ‘ä»¬è¾“å…¥webæŒ‡ä»¤.</p>

<p>$ go tool pprof ./demo4 profileFile: demo4
Type: cpu
Time: Mar 3, 2020 at 11:18pm (CST)
Duration: 30.13s, Total samples = 6.27s (20.81%)
Entering interactive mode (type â€œhelpâ€ for commands, â€œoâ€ for options)
(pprof) web
è¿™é‡Œå¦‚æœæŠ¥æ‰¾ä¸åˆ°graphvizå·¥å…·ï¼Œéœ€è¦å®‰è£…ä¸€ä¸‹ã€‚è¿™é‡Œè‡ªè¡Œç™¾åº¦å¦‚ä½•å®‰è£…</p>

<p>ç„¶åæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªsvgçš„å¯è§†åŒ–æ–‡ä»¶åœ¨/tmpè·¯å¾„ä¸‹
go pprof web</p>

<p>è¿™æ ·æˆ‘ä»¬å°±èƒ½æ¯”è¾ƒæ¸…æ™°çš„çœ‹åˆ°å‡½æ•°ä¹‹é—´çš„è°ƒç”¨å…³ç³»,æ–¹å—è¶Šå¤§çš„è¡¨ç¤ºcpuçš„å ç”¨è¶Šå¤§.</p>

<p>https://segmentfault.com/a/1190000022472459</p>
:ET