I"<p>sync.Mutexçš„åˆå§‹åŒ–æ³¨æ„äº‹é¡¹</p>

<p>type MemProvider struct {
lock Â  Â  <em>sync.Mutex Â  Â  Â  Â  Â  Â  Â //ç”¨æ¥é”
sessions map[string]</em>SessionStore //ç”¨æ¥å­˜å‚¨åœ¨å†…å­˜
}</p>

<p>åˆå§‹åŒ–æ—¶</p>

<p>var lockm *sync.Mutex = new(sync.Mutex)
var memProvider = &amp;MemProvider{sessions: make(map<a href="*SessionStore">string</a>), lock: lockm}
<!-- more -->
ç°åœ¨æœ‰ä¸€ä¸ªstructæ˜¯Engineï¼Œå®ƒç»„åˆäº†sync.RWMutex</p>

<p>type Engine struct {
    sync.RWMutex</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ID     string
IP     string
Addr   string } åœ¨æ„å»ºçš„æ—¶å€™ï¼Œå¯ä»¥ä¸ç”¨ä¼ å…¥sync.RWMutexçš„å¯¹è±¡
</code></pre></div></div>

<p>func main() {
    engine := &amp;Engine {
            ID   : â€œ111â€,
            IP   : â€œ192.168.59.103â€,
            Addr : â€œlocalhostâ€}
}</p>

<p>ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œä¸ç”¨å¯¹äºsyncRWMutexè¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨Docé‡Œçœ‹åˆ°å¦‚æœç»„åˆçš„æ˜¯Pointerçš„åŒ–ï¼Œéœ€è¦åˆå§‹åŒ–ã€‚è¿™ä¸ªä¸ºä»€ä¹ˆå‘¢</p>

<p>golang sync.RWMutex ç›´æ¥å£°æ˜ä¸ç”¨åˆå§‹åŒ–å°±å¯ä»¥ç›´æ¥ç”¨,æ¯”å¦‚</p>

<p>var mutex sync.RWMutex
mutex.Lock()
ä½†æ˜¯å¦‚æœæ˜¯æŒ‡é’ˆçš„è¯ï¼Œä¸å¯¹æŒ‡é’ˆåˆå§‹åŒ–ï¼ŒæŒ‡é’ˆå°±æ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œç©ºæŒ‡é’ˆå½“ç„¶ä¸èƒ½ç›´æ¥ç”¨å•¦</p>

<p>I think you can regard *sync.Mutex as a simple pointer. If you want to use it, you should declare and init it, but if you use sync.Mutex, it has been inited.</p>

<p>ä¸ºä»€ä¹ˆåŠ é”äº†ä»ç„¶ä¼šæŠ¥cuncurrent map wirtesï¼Œ</p>

<p>ä¸»è¦åŸå› æ˜¯golangçš„struct åœ¨èµ‹å€¼çš„æ—¶å€™æ˜¯è¿›è¡Œæµ…æ‹·è´ï¼ŒæŠŠç»“æ„ä½“çš„æˆå‘˜è¿›è¡Œäº†copyï¼ŒNode ç»“æ„ä½“æœ‰ä¸¤ä¸ªæˆå‘˜</p>

<p>type Node struct {
	sync.Mutex
	Data map[string]string
}
æˆ‘ä»¬ä»sliceä¸­æŠŠNodeæ‹¿å‡ºæ¥çš„æ—¶å€™ï¼Œå…¶å®æ˜¯copyäº†ä¸€ä»½Nodeï¼ŒMapæ˜¯æŒ‡é’ˆç±»å‹çš„ï¼Œæ‰€ä»¥å¤šä»½copyå…¶å®æ˜¯æ“ä½œä¸€ä»½mapï¼Œä½†æ˜¯sync.Mutexç±»å‹æ˜¯structï¼Œä»–è¿›è¡Œäº†ä¸€æ¬¡copy
æ‰€ä»¥åœ¨æ¯ä¸ªåç¨‹ä¸­å–å‡ºæ¥çš„æ—¶å€™ï¼ŒMutexéƒ½è¿›è¡Œäº†ä¸€æ¬¡copyï¼ŒLockçš„æ—¶å€™ä¸æ˜¯åŒä¸€ä»½é”ï¼Œæ‰€ä»¥ä¼šå‡ºç°å¹¶å‘mapå†™å…¥ã€‚</p>

<p>è§£å†³æ–¹æ³•1
æŠŠNodeçš„æˆå‘˜Mutex æ”¹æˆæŒ‡é’ˆç±»å‹ï¼Œé‚£ä¹ˆåœ¨copyçš„æ—¶å€™ï¼Œmutex èƒ½ä¿æŒå¯¹åŒä¸€ä»½è¿›è¡ŒLockï¼Œä»£ç å¦‚ä¸‹</p>

<p>package main</p>

<p>import (
	â€œfmtâ€
	â€œstrconvâ€
	â€œsyncâ€
)</p>

<p>type Node struct {
	*sync.Mutex
	Data map[string]string
}</p>

<p>var Cache []Node</p>

<p>è§£å†³æ–¹æ³•2 Cacheä¸­å­˜å‚¨NodeæŒ‡é’ˆ
Cacheä¸­å¦‚æœæ˜¯NodeæŒ‡é’ˆç±»å‹ï¼Œé‚£ä¹ˆindexè®¿é—®çš„æ—¶å€™ï¼Œæ‹¿å‡ºæ¥æ˜¯æŒ‡é’ˆçš„å‰¯æœ¬ï¼ŒæŒ‡å‘çš„ä»ç„¶æ˜¯åŒä¸€ä»½åœ°å€ï¼ŒåŠ é”çš„æ—¶å€™ä»ç„¶è®¿é—®çš„æ˜¯åŒä¸€ä»½èµ„æº
ä»£ç å¦‚ä¸‹</p>

<p>package main</p>

<p>import (
	â€œfmtâ€
	â€œstrconvâ€
	â€œsyncâ€
)</p>

<p>type Node struct {
	sync.Mutex
	Data map[string]string
}</p>

<p>var Cache []*Node</p>

<p>ç»“æ„ä½“ç”¨é”ï¼Œå¯ä»¥åŒ¿åä¹Ÿå¯ä»¥éåŒ¿åï¼Œä¸¤ç§å†™æ³•éƒ½è¡Œï¼Œæ³¨æ„æµ…æ‹·è´é—®é¢˜
type Node struct {
	sync.Mutex
}</p>

<p>type Node struct {
 mu	sync.Mutex
}</p>
:ET