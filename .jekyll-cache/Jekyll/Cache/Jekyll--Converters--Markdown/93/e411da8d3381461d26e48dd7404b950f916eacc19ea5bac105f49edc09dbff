I"å<p>phpunitçš„åšæ³•æ˜¯æŠŠæ‰€æœ‰ç›¸å…³æ–‡ä»¶æ‰“åŒ…å°è£…åˆ°ä¸€ä¸ªpharåŒ…é‡Œå»åˆ†å‘ï¼Œæˆ‘ä¹Ÿå¯ä»¥è¿™ä¹ˆå¹²ã€‚</p>

<p>é¦–å…ˆé…ç½®php.inié‡Œçš„phar.readonly=0ï¼Œé»˜è®¤Phpè§£é‡Šå™¨å¯¹pharæ˜¯åªè¯»è®¿é—®çš„ï¼Œä¸èƒ½ä¿®æ”¹pharçš„å†…å®¹ï¼Œä»¥å…æ„å¤–ä¿®æ”¹æ•´ä½“äº¤ä»˜çš„è½¯ä»¶åŒ…ã€‚ä¿®æ”¹é…ç½®ä¹‹åæ‰å¯ä»¥ç”¨æ¥æ‰“åŒ…ç”Ÿæˆpharã€‚æ”¹å¥½é…ç½®ä¹‹åï¼Œå»ºç«‹ç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>

<p>.
â”œâ”€â”€ bin
â”œâ”€â”€ generate-phar.php
â””â”€â”€ src
    â””â”€â”€ index.php
å…¶ä¸­srcç›®å½•é‡Œæœ‰å®Œæ•´çš„ä»£ç æ–‡ä»¶ï¼ŒåŒ…æ‹¬composerå¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“ã€‚æˆ‘ä»¬ç”¨generate-phar.phpç¨‹åºç”Ÿæˆpharæ–‡ä»¶ï¼Œå¹¶æŠŠå®ƒæ”¾åˆ°binç›®å½•é‡Œå»ã€‚</p>

<p>&lt;?php
//åœ¨binç›®å½•ä¸‹åˆ›å»ºpharæ–‡ä»¶
$phar = new Phar(<strong>DIR</strong> . DIRECTORY_SEPARATOR . â€˜bin/mytool.pharâ€™);</p>

<p>//ä»srcç›®å½•æ„å»ºpharåŒ…
$phar-&gt;buildFromDirectory(â€˜srcâ€™);</p>

<p>//å®šä¹‰é»˜è®¤æ‰§è¡Œå…¥å£ä¸ºindex.php
$defStub = Phar::createDefaultStub(â€˜index.phpâ€™);</p>

<p>//è®¾ç½®phpè§£é‡Šå™¨shellå¤´ï¼Œè®©pharå¯ä»¥è‡ªå·±æ‰§è¡Œ
$phar-&gt;setStub(â€œ#!/usr/bin/env php\n$defStubâ€);</p>

<p>//ç”¨bzip2åº“å‹ç¼©pharåŒ…é‡Œçš„æ–‡ä»¶ï¼ˆæ­¤æ­¥è¦æ±‚PHPå®‰è£…äº†zlibå’Œbz2æ‰©å±•ï¼Œå¯ä»¥è·³è¿‡ï¼‰
$phar-&gt;compressFiles(Phar::BZ2);</p>

<p>//å°†pharåŒ…æ”¹åï¼Œå»æ‰pharæ‰©å±•å
rename(â€˜bin/mytool.pharâ€™, â€˜bin/mytoolâ€™);</p>

<p>//æˆäºˆpharåŒ…å¯æ‰§è¡Œæƒé™
chmod(â€˜bin/mytoolâ€™, 0755);
ç°åœ¨å¯ä»¥ç”¨bin/mytoolç›´æ¥æ‰§è¡ŒåŒ…ä¸­çš„ç¨‹åºäº†ï¼Œpharä¼šè‡ªåŠ¨ä½¿ç”¨ç³»ç»Ÿä¸­å®‰è£…çš„PHPè§£é‡Šå™¨ï¼Œå¦‚æœæƒ³åœ¨ä»»æ„ç›®å½•è¿è¡Œæ­¤ç¨‹åºï¼Œå¯ä»¥æŠŠpharåŒ…æ‹·åˆ°$PATHè·¯å¾„è¦†ç›–çš„ç›®å½•ä¸­ï¼Œæ¯”å¦‚/usr/local/bin
<!-- more --></p>

<p>æŠ¥é”™$./composer.phar
./composer.phar: line 1: ?php: No such file or directory
./composer.phar: line 3: =: command not found
./composer.phar: line 5: syntax error near unexpected token <code class="language-plaintext highlighter-rouge">'phar','
./composer.phar: line 5: </code>if (in_array(â€˜pharâ€™, stream_get_wrappers()) &amp;&amp; class_exists(â€˜Pharâ€™, 0)) {â€˜</p>

<p>åŸå› æ²¡æœ‰è®¾ç½®shell å¤´æ²¡æ³•è¯†åˆ«php æ–‡ä»¶</p>

<p>æ–¹æ³•ä¸€ï¼š
php ./composer.phar</p>

<p>æ–¹æ³•äºŒï¼š
//è®¾ç½®phpè§£é‡Šå™¨shellå¤´ï¼Œè®©pharå¯ä»¥è‡ªå·±æ‰§è¡Œ
$phar-&gt;setStub(â€œ#!/usr/bin/env php\n$defStubâ€);</p>

<p>pharæ–‡ä»¶çš„å‹ç¼©å’Œè§£å‹</p>

<p>è§£å‹
$cat depress.php
&lt;?php
define(â€˜ROOTâ€™,<strong>DIR</strong>);
$dir = ROOT.â€™/extractâ€™;
if(!is_dir($dir)){
@mkdir($dir);
}
$phar = new Phar(ROOT.â€/composer.pharâ€);
$phar-&gt;extractTo($dir,null,true);
echo â€œè§£å‹å®Œæˆâ€.PHP_EOL;</p>

<p>å‹ç¼©
 cat compress.php</p>

<p>&lt;?php
$exts = array(
        â€˜*â€™,
    );
$dir = <strong>DIR</strong>;
$file = â€˜composer.pharâ€™;
$phar = new Phar(<strong>DIR</strong> . â€˜/â€™ . $file, FilesystemIterator::CURRENT_AS_FILEINFO | FilesystemIterator::KEY_AS_FILENAME, $file);
$phar-&gt;startBuffering();
foreach ($exts as $ext) {
$phar-&gt;buildFromDirectory($dir, â€˜/.â€™ . $ext . â€˜$/â€™);
}
$phar-&gt;delete(â€˜compress.phpâ€™);
$phar-&gt;setStub(â€œ#!/usr/bin/env php\nâ€.$phar-&gt;createDefaultStub(â€˜bin/composerâ€™));
//è®¾ç½®phpè§£é‡Šå™¨shellå¤´ï¼Œè®©pharå¯ä»¥è‡ªå·±æ‰§è¡Œ
//$phar-&gt;setStub(â€œ#!/usr/bin/env php\n$defStubâ€);
$phar-&gt;compressFiles(Phar::GZ);
$phar-&gt;stopBuffering();
echo â€œæ‰“åŒ…å®Œæˆâ€.PHP_EOL;</p>

:ET