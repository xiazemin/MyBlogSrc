I"Ï <p>https://github.com/mjibson/esc
https://mattjibson.com/esc/</p>

<p>esc embeds files into go programs and provides http.FileSystem interfaces to them.</p>

<p>It adds all named files or files recursively under named directories at the path specified. The output file provides an http.FileSystem interface with zero dependencies on packages outside the standard library.</p>

<!-- more -->
<p>go-bindata
go-bindata æ˜¯ç›®å‰æˆ‘çš„ç¨‹åº pugo åœ¨ç”¨çš„åµŒå…¥é™æ€èµ„æºçš„å·¥å…·ã€‚å®ƒå¯ä»¥æŠŠé™æ€æ–‡ä»¶åµŒå…¥åˆ°ä¸€ä¸ª go æ–‡ä»¶ä¸­ï¼Œå¹¶æä¾›ä¸€äº›æ“ä½œæ–¹æ³•ã€‚</p>

<p>å®‰è£… go-bindataï¼š</p>

<p>go get -u github.com/jteeuwen/go-bindata/â€¦
æ³¨æ„ go get åœ°å€æœ€åçš„ä¸‰ä¸ªç‚¹ â€¦ã€‚è¿™æ ·ä¼šåˆ†ææ‰€æœ‰å­ç›®å½•å¹¶ä¸‹è½½ä¾èµ–ç¼–è¯‘å­ç›®å½•å†…å®¹ã€‚go-bindata çš„å‘½ä»¤å·¥å…·åœ¨å­ç›®å½•ä¸­ã€‚ï¼ˆè¿˜è¦è®°å¾—æŠŠ $GOPATH/bin åŠ å…¥ç³»ç»Ÿ PATHï¼‰ã€‚</p>

<p>ä½¿ç”¨å‘½ä»¤å·¥å…· go-bindata ï¼ˆ pugo çš„ä¾‹å­ï¼‰ï¼š</p>

<p>go-bindata -o=app/asset/asset.go -pkg=asset source/â€¦ theme/â€¦ doc/source/â€¦ doc/theme/â€¦ 
-o è¾“å‡ºæ–‡ä»¶åˆ° app/asset/asset.goï¼ŒåŒ…å -pkg=assetï¼Œç„¶åæ˜¯éœ€è¦æ‰“åŒ…çš„ç›®å½•ï¼Œä¸‰ä¸ªç‚¹åŒ…æ‹¬æ‰€æœ‰å­ç›®å½•ã€‚è¿™æ ·å°±å¯ä»¥æŠŠæ‰€æœ‰ç›¸å…³æ–‡ä»¶æ‰“åŒ…åˆ° asset.go ä¸”å¼€å¤´æ˜¯ package asset ä¿æŒå’Œç›®å½•ä¸€è‡´ã€‚</p>

<p>pugo é‡Œé‡Šæ”¾é™æ€æ–‡ä»¶çš„ä»£ç ï¼š</p>

<p>dirs := []string{â€œsourceâ€, â€œthemeâ€, â€œdocâ€} // è®¾ç½®éœ€è¦é‡Šæ”¾çš„ç›®å½•</p>

<p>for _, dir := range dirs {
    // è§£å‹dirç›®å½•åˆ°å½“å‰ç›®å½•
    if err := asset.RestoreAssets(â€œ./â€, dir); err != nil {
        isSuccess = false
        break
    }
}
if !isSuccess {
    for _, dir := range dirs {
        os.RemoveAll(filepath.Join(â€œ./â€, dir))
    }
}
asset.go å†…çš„é™æ€å†…å®¹è¿˜æ˜¯æ ¹æ®å®é™…çš„ç›®å½•ä½ç½®ç´¢å¼•ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ç›®å½•æˆ–è€…æ–‡ä»¶åœ°å€å»æ“ä½œã€‚</p>

<p>-debug å¼€å‘æ¨¡å¼
go-bindata æ”¯æŒå¼€å‘æ¨¡å¼ï¼Œå³ä¸åµŒå…¥é™æ€å†…å®¹ï¼Œåªç”Ÿæˆæ“ä½œæ–¹æ³•åˆ°è¾“å‡ºçš„ go ä»£ç ä¸­ï¼Œå¦‚ï¼š</p>

<p>go-bindata -debug -o=app/asset/asset.go -pkg=asset source/â€¦ theme/â€¦ doc/source/â€¦ doc/theme/â€¦ 
-debug å‚æ•°å¼€å¯å¼€å‘æ¨¡å¼ã€‚ç”Ÿæˆçš„ä»£ç ä¼šç›´æ¥å»è¯»å–é™æ€æ–‡ä»¶åˆ°å†…å­˜ï¼Œè€Œä¸æ˜¯ç¼–ç åˆ°ä»£ç ä¸­ã€‚ä»£ç æ–‡ä»¶æ›´å°ï¼Œä½ æ›´å¿«é€Ÿçš„ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚</p>

<p>// -pkg=asset, æ‰“åŒ…çš„åŒ…åæ˜¯ asset
bytes, err := asset.Asset(â€œtheme/default/post.htmlâ€)    // æ ¹æ®åœ°å€è·å–å¯¹åº”å†…å®¹
if err != nil {
    fmt.Println(err)
    return
}
t, err := template.New(â€œtplâ€).Parse(string(bytes))      // æ¯”å¦‚ç”¨äºæ¨¡æ¿å¤„ç†
fmt.Println(t, err)
http.FileSystem
http.FileSystem æ˜¯å®šä¹‰ HTTP é™æ€æ–‡ä»¶æœåŠ¡çš„æ¥å£ã€‚go-bindata çš„ç¬¬ä¸‰æ–¹åŒ… go-bindata-assetfs å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œæ”¯æŒ HTTP è®¿é—®é™æ€æ–‡ä»¶ç›®å½•çš„è¡Œä¸ºã€‚ä»¥æˆ‘ä»¬ä¸Šé¢ç¼–è¯‘å¥½çš„ asset.go ä¸ºä¾‹ï¼š</p>

<p>import (
    â€œnet/httpâ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"github.com/elazarl/go-bindata-assetfs"
"github.com/go-xiaohei/pugo/app/asset" // ç”¨ pugo çš„asset.goè¿›è¡Œæµ‹è¯• )
</code></pre></div></div>

<p>func main() {
    fs := assetfs.AssetFS{
        Asset:     asset.Asset,
        AssetDir:  asset.AssetDir,
        AssetInfo: asset.AssetInfo,
    }
    http.Handle(â€œ/â€, http.FileServer(&amp;fs))
    http.ListenAndServe(â€œ:12345â€, nil)
}
è®¿é—® http://localhost:12345ï¼Œå°±å¯ä»¥çœ‹åˆ°åµŒå…¥çš„ source,theme,doc çš„ç›®å½•åˆ—è¡¨é¡µé¢ï¼Œå’Œ Nginx æŸ¥çœ‹é™æ€æ–‡ä»¶ç›®å½•ä¸€æ ·çš„ã€‚</p>

<p>go.rice
go.rice ä¹Ÿæ”¯æŒæ‰“åŒ…é™æ€æ–‡ä»¶åˆ° go æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯è¡Œä¸ºå’Œ go-bindata å¾ˆä¸ç›¸åŒã€‚ä»ä½¿ç”¨è§’åº¦ï¼Œgo.rice å…¶å®æ˜¯æ›´ä¾¿æ·çš„é™æ€æ–‡ä»¶æ“ä½œåº“ã€‚æ‰“åŒ…é™æ€æ–‡ä»¶åè€Œæ˜¯é¡ºå¸¦çš„åŠŸèƒ½ã€‚</p>

<p>å®‰è£…å’Œ go-bindata ä¸€æ ·ï¼Œæ³¨æ„ ä¸‰ä¸ªç‚¹ï¼š</p>

<p>go get github.com/GeertJohan/go.rice/â€¦
go.rice æŠŠä¸€ä¸ªç›®å½•è®¤ä¸ºæ˜¯ä¸€ä¸ª rice.Box æ“ä½œï¼š</p>

<p>import (
    â€œfmtâ€
    â€œhtml/templateâ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"github.com/GeertJohan/go.rice" )
</code></pre></div></div>

<p>func main() {
    // è¿™é‡Œå†™ç›¸å¯¹äºçš„æ‰§è¡Œæ–‡ä»¶çš„åœ°å€
    box, err := rice.FindBox(â€œtheme/defaultâ€)
    if err != nil {
        println(err.Error())
        return
    }
    // ä»ç›®å½• Box è¯»å–æ–‡ä»¶
    str, err := box.String(â€œpost.htmlâ€)
    if err != nil {
        println(err.Error())
        return
    }
    t, err := template.New(â€œtplâ€).Parse(str)
    fmt.Println(t, err)
}
rice å‘½ä»¤
go.rice çš„æ‰“åŒ…å‘½ä»¤æ˜¯ riceã€‚ç”¨èµ·æ¥éå¸¸ç›´æ¥ï¼šåœ¨æœ‰ä½¿ç”¨ go.rice æ“ä½œçš„ go ä»£ç ç›®å½•ï¼Œç›´æ¥æ‰§è¡Œ rice embed-go:</p>

<p>rice embed-go
rice -i â€œgithub.com/fuxiaohei/xyzâ€ embed-go // -i å¤„ç†æŒ‡å®šåŒ…é‡Œçš„ go.rice æ“ä½œ
ä»–å°±ä¼šç”Ÿæˆå½“å‰åŒ…åä¸‹çš„ã€åµŒå…¥äº†æ–‡ä»¶çš„ä»£ç  rice-box.goã€‚ä½†æ˜¯ï¼Œå®ƒä¸é€’å½’å¤„ç† importã€‚ä»–ä¼šåˆ†æå½“å‰ç›®å½•ä¸‹çš„ go ä»£ç ä¸­ go.rice çš„ä½¿ç”¨ï¼Œæ‰¾åˆ°å¯¹åº”éœ€è¦åµŒå…¥çš„æ–‡ä»¶å¤¹ã€‚ä½†æ˜¯å­ç›®å½•ä¸‹çš„å’Œ import çš„é‡Œé¢çš„ go.rice ä½¿ç”¨ä¸ä¼šåˆ†æï¼Œéœ€è¦ä½ æ‰‹åŠ¨ cd è¿‡å»æˆ–è€… -i æŒ‡å®šè¦å¤„ç†çš„åŒ…æ‰§è¡Œå‘½ä»¤ã€‚è¿™ç‚¹æ¥è¯´éå¸¸çš„ä¸å‹å¥½ã€‚</p>

<p>http.FileSystem
go.rice æ˜¯ç›´æ¥æ”¯æŒ http.FileSystem æ¥å£ï¼š</p>

<p>func main() {
    // MustFindBox å‡ºé”™ç›´æ¥ panic
    http.Handle(â€œ/â€, http.FileServer(rice.MustFindBox(â€œthemeâ€).HTTPBox()))
    http.ListenAndServe(â€œ:12345â€, nil)
}
æœ‰ç‚¹ç•¥ç¹ççš„æ˜¯ rice.FindBox(dir) åªèƒ½åŠ è½½ä¸€ä¸ªç›®å½•ã€‚å› æ­¤éœ€è¦å¤šä¸ªç›®å½•çš„åœºæ™¯ï¼Œä¼šæœ‰ä»£ç ï¼š</p>

<p>func main() {
    http.Handle(â€œ/imgâ€, http.FileServer(rice.MustFindBox(â€œstatic/imgâ€).HTTPBox()))
    http.Handle(â€œ/cssâ€, http.FileServer(rice.MustFindBox(â€œstatic/cssâ€).HTTPBox()))
    http.Handle(â€œ/jsâ€, http.FileServer(rice.MustFindBox(â€œstatic/jsâ€).HTTPBox()))
    http.ListenAndServe(â€œ:12345â€, nil)
}
esc
esc çš„ä½œè€…åœ¨ç ”ç©¶å‡ æ¬¾åµŒå…¥é™æ€èµ„æºçš„å·¥å…·åï¼Œå‘è§‰éƒ½ä¸å¥½ç”¨ï¼Œå°±è‡ªå·±å†™å‡ºäº† escã€‚å®ƒçš„éœ€æ±‚å¾ˆç®€å•ï¼Œå°±æ˜¯åµŒå…¥é™æ€èµ„æº å’Œ æ”¯æŒ http.FileSystemã€‚esc å·¥å…·ä¹Ÿè¿™ä¸¤ä¸ªä¸»è¦åŠŸèƒ½ã€‚</p>

<p>å®‰è£… esc:</p>

<p>go get github.com/mjibson/esc
ä½¿ç”¨æ–¹æ³•å’Œ go-bindata ç±»ä¼¼ï¼š</p>

<p>// æ³¨æ„ esc ä¸æ”¯æŒ source/â€¦ ä¸‰ä¸ªç‚¹è¡¨ç¤ºæ‰€æœ‰å­ç›®å½•
go-bindata -o=asset/asset.go -pkg=asset source theme doc/source doc/theme
ç›´æ¥æ”¯æŒ http.FileSystemï¼š</p>

<p>import (
    â€œnet/httpâ€
    â€œassetâ€ // esc ç”Ÿæˆ asset/asset.go 
)</p>

<p>func main() {
    fmt.Println(asset.FSString(false, â€œ/theme/default/post.htmlâ€))         // è¯»å–å•ä¸ªæ–‡ä»¶
    http.ListenAndServe(â€œ:12345â€, http.FileServer(asset.FS(false)))     // æ”¯æŒ http.FileSystemï¼Œä½†æ˜¯æ²¡æœ‰åšå±•ç¤ºç›®å½•çš„æ”¯æŒ
}
esc æœ‰ä¸ªè¾ƒå¤§çš„é—®é¢˜æ˜¯åªèƒ½ä¸€ä¸ªä¸€ä¸ªæ–‡ä»¶æ“ä½œï¼Œä¸èƒ½æ–‡ä»¶å¤¹æ“ä½œï¼Œæ²¡æœ‰ç±»ä¼¼go-bindata çš„ asset.RestoreDir() æ–¹æ³•ã€‚å¹¶ä¸”æ²¡æœ‰æ–¹æ³•å¯ä»¥åˆ—å‡ºåµŒå…¥çš„æ–‡ä»¶çš„åˆ—è¡¨ï¼Œå¯¼è‡´ä¹Ÿæ— æ³•ä¸€ä¸ªä¸€ä¸ªæ–‡ä»¶æ“ä½œï¼Œé™¤éè‡ªå·±å†™æ­»ã€‚è¿™æ˜¯æˆ‘ä¸ä½¿ç”¨ä»–çš„æœ€å¤§åŸå› ã€‚</p>

<p>go generate
åµŒå…¥é™æ€èµ„æºçš„å·¥å…·æ¨èé…åˆ go generate ä½¿ç”¨ã€‚ä¾‹å¦‚ pugo çš„å…¥å£æ–‡ä»¶å°±æœ‰ï¼š</p>

<p>package main</p>

<p>import (
    â€œosâ€
    â€œtimeâ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"github.com/go-xiaohei/pugo/app/command"
"github.com/go-xiaohei/pugo/app/vars"
"github.com/urfave/cli" )
</code></pre></div></div>

<p>//go:generate go-bindata -o=app/asset/asset.go -pkg=asset source/â€¦ theme/â€¦ doc/source/â€¦ doc/theme/â€¦</p>

<p>// â€¦â€¦
åœ¨ç¼–è¯‘çš„æ—¶å€™æ‰§è¡Œï¼š</p>

<p>go generate &amp;&amp; go build
è¿™ä¸ªæ˜¯ go generate çš„åŸºæœ¬ç”¨æ³•ã€‚æ›´è¯¦ç»†çš„äº†è§£å¯ä»¥çœ‹ å®˜æ–¹åšæ–‡ã€‚</p>

<p>æ€»ç»“
æˆ‘åœ¨å¼€å‘ pugo çš„æ—¶å€™å¯¹è¿™å‡ æ¬¾åµŒå…¥é™æ€èµ„æºçš„ç¨‹åºè¿›è¡Œäº†æµ‹è¯•ã€‚go.rice å¹¶ä¸æ˜¯æˆ‘æƒ³è¦çš„æ¨¡å¼ï¼Œå°±æ²¡æœ‰è€ƒè™‘ã€‚esc æä¾›çš„æ“ä½œæ–¹æ³•å¤ªå°‘ï¼Œæ— æ³•æ»¡è¶³ç¨‹åºå¼€å‘çš„éœ€è¦ã€‚æœ€åé€‰æ‹© go-bindataã€‚ä½†æ˜¯ go-bindata å’Œ go.rice éƒ½æ˜¯å°†çº¯å­—ç¬¦æ•°æ®æˆ– []byte å­—ç¬¦æ•°æ®å†™å…¥ go æ–‡ä»¶ï¼Œå†…å®¹éå¸¸å¤§ã€‚esc æ˜¯å†™å…¥ gzip å‹ç¼©æµçš„ Base64 ç¼–ç ã€‚ç»è¿‡å‹ç¼©å go ä»£ç çš„å¤§å°æ˜æ˜¾æ›´å°‘ï¼ˆæˆ‘åµŒå…¥çš„éƒ½æ˜¯æ¨¡æ¿ç­‰æ–‡æœ¬æ–‡ä»¶ï¼‰ã€‚å¯è§åº“ç±»éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚å€˜è‹¥æœ‰ go-bindata é‚£æ ·ä¸°å¯Œçš„ APIï¼Œåˆæœ‰ esc é‚£æ ·åµŒå…¥å‹ç¼©è¿‡çš„å­—ç¬¦æ•°æ®ï¼Œé‚£è¯¥å¤šå¥½ã€‚</p>
:ET