I"ñ<p>sigsuspendå‡½æ•° ï¼š
sigsuspendå‡½æ•°æ¥å—ä¸€ä¸ªä¿¡å·é›†æŒ‡é’ˆï¼Œå°†ä¿¡å·å±è”½å­—è®¾ç½®ä¸ºä¿¡å·é›†ä¸­çš„å€¼ï¼Œåœ¨è¿›ç¨‹æ¥å—åˆ°ä¸€ä¸ªä¿¡å·ä¹‹å‰ï¼Œè¿›ç¨‹ä¼šæŒ‚èµ·ï¼Œå½“æ•æ‰ä¸€ä¸ªä¿¡</p>

<p>å·ï¼Œé¦–å…ˆæ‰§è¡Œä¿¡å·å¤„ç†ç¨‹åºï¼Œç„¶åä»sigsuspendè¿”å›ï¼Œæœ€åå°†ä¿¡å·å±è”½å­—æ¢å¤ä¸ºè°ƒç”¨sigsuspendä¹‹å‰çš„å€¼ã€‚</p>

<p>#include <signal.h>
int sigsuspend(const sigset_t *sigmask);
                                                            // è¿”å›å€¼ï¼šï¼1ï¼Œå¹¶å°†errnoè®¾ç½®ä¸ºEINTR</signal.h></p>

<p>pauseå‡½æ•°ï¼š</p>

<p>pauseå‡½æ•°ä½¿è°ƒç”¨è¿›ç¨‹æŒ‚èµ·ç›´åˆ°æ•æ‰åˆ°ä¸€ä¸ªä¿¡å·ã€‚åªæœ‰æ‰§è¡Œäº†ä¸€ä¸ªä¿¡å·å¤„ç†ç¨‹åºå¹¶ä»å…¶è¿”å›æ—¶ï¼Œpauseæ‰è¿”å›</p>

<p>int sigsuspend(const sigset_t *sigmask);</p>

<p>æ­¤å‡½æ•°ç”¨äºè¿›ç¨‹çš„æŒ‚èµ·ï¼ŒsigmaskæŒ‡å‘ä¸€ä¸ªä¿¡å·é›†ã€‚å½“æ­¤å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œsigmaskæ‰€æŒ‡å‘çš„ä¿¡å·é›†ä¸­çš„ä¿¡å·å°†èµ‹å€¼ç»™ä¿¡å·æ©ç ã€‚ä¹‹åè¿›ç¨‹æŒ‚èµ·ã€‚ç›´åˆ°è¿›ç¨‹æ•æ‰åˆ°ä¿¡å·ï¼Œå¹¶è°ƒç”¨å¤„ç†å‡½æ•°è¿”å›æ—¶ï¼Œå‡½æ•°sigsuspendè¿”å›ã€‚ä¿¡å·æ©ç æ¢å¤ä¸ºä¿¡å·è°ƒç”¨å‰çš„å€¼ï¼ŒåŒæ—¶å°†errnoè®¾ä¸ºEINTRã€‚è¿›ç¨‹ç»“æŸä¿¡å·å¯å°†å…¶ç«‹å³åœæ­¢ã€‚
<!-- more -->
#include <stdio.h>   
#include <signal.h></signal.h></stdio.h></p>

<p>void checkset();<br />
void func();<br />
void main()<br />
{<br />
     sigset_tblockset,oldblockset,zeroset,pendmask;<br />
     printf(â€œpid:%ld\nâ€,(long)getpid());<br />
     signal(SIGINT,func);</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sigemptyset(&amp;blockset);  
 sigemptyset(&amp;zeroset);  
 sigaddset(&amp;blockset,SIGINT);  
  
 sigprocmask(SIG_SETMASK,&amp;blockset,&amp;oldblockset);  
 checkset();  
 sigpending(&amp;pendmask);  
  
 if(sigismember(&amp;pendmask,SIGINT))  
     printf("SIGINTpending\n");  
  
 if(sigsuspend(&amp;zeroset)!= -1)  
 {  
 printf("sigsuspenderror\n");  
 exit(0);  
 }  
  
 printf("afterreturn\n");  
 sigprocmask(SIG_SETMASK,&amp;oldblockset,NULL);  
  
 printf("SIGINTunblocked\n");   }  
</code></pre></div></div>

<p>void checkset()<br />
{    sigset_tset;<br />
     printf(â€œchecksetstart:\nâ€);<br />
     if(sigprocmask(0,NULL,&amp;set)&lt;0)<br />
     {<br />
     printf(â€œchecksetsigprocmask error!!\nâ€);<br />
     exit(0);<br />
     }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> if(sigismember(&amp;set,SIGINT))  
 printf("sigint\n");  
  
 if(sigismember(&amp;set,SIGTSTP))  
 printf("sigtstp\n");  
  
 if(sigismember(&amp;set,SIGTERM))  
 printf("sigterm\n");  
 printf("checksetend\n");   }  
</code></pre></div></div>

<p>void func()<br />
{<br />
     printf(â€œhellofunc\nâ€);<br />
}</p>

<p>sigsuspend(sigset_t  sigs);åŠŸèƒ½ï¼š å±è”½æ–°çš„ä¿¡å·ï¼ŒåŸæ¥å±è”½çš„ä¿¡å·å¤±æ•ˆã€‚sigsuspendæ˜¯é˜»å¡å‡½æ•°ï¼Œå¯¹å‚æ•°ä¿¡å·å±è”½ï¼Œå¯¹å‚æ•°æ²¡æœ‰æŒ‡å®šçš„ä¿¡å·ä¸å±è”½ï¼Œä½†å½“æ²¡æœ‰å±è”½çš„ä¿¡å·å¤„ç†å‡½æ•°è°ƒç”¨å®Œæ¯•sigsuspendå‡½æ•°è¿”å›ã€‚</p>

<p>sigsuspendè¿”å›æ¡ä»¶ï¼š</p>

<p>ä¿¡å·å‘ç”Ÿï¼Œå¹¶ä¸”ä¿¡å·æ˜¯éå±è”½ä¿¡å·
ä¿¡å·å¿…é¡»è¦å¤„ç†ï¼Œè€Œä¸”å¤„ç†å‡½æ•°è¿”å›åsigsuspendæ‰è¿”å›ã€‚
sigsuspendè®¾ç½®æ–°çš„å±è”½ä¿¡å·ï¼Œä¿å­˜æ—§çš„å±è”½ä¿¡å·ï¼Œè€Œä¸”å½“sigsuspendè¿”å›çš„æ—¶å€™ï¼Œæ¢å¤æ—§çš„å±è”½ä¿¡å·ã€‚</p>

<p>å…¶å®å¯ä»¥è¿™æ ·ç†è§£ï¼šsigsuspend=pause()+æŒ‡å®šå±è”½çš„ä¿¡å·</p>

<p>sigsuspendçš„æ•´ä¸ªåŸå­æ“ä½œè¿‡ç¨‹ä¸ºï¼š
(1) è®¾ç½®æ–°çš„maské˜»å¡å½“å‰è¿›ç¨‹ï¼›
(2) æ”¶åˆ°ä¿¡å·ï¼Œè°ƒç”¨è¯¥è¿›ç¨‹è®¾ç½®çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼›
(3) å¾…ä¿¡å·å¤„ç†å‡½æ•°è¿”å›åï¼Œæ¢å¤åŸå…ˆmaskï¼›
(4) sigsuspendè¿”å›</p>

<ol>
  <li>sigpromask(SIG_UNBLOCK,&amp;newmask,&amp;oldmask)å’Œ
   sigpromask(SIG_SETMASK,&amp;oldmask,NULL)åŒºåˆ«</li>
</ol>

<p>sigpromask(SIG_UNBLOCK,&amp;newmask,&amp;oldmask)
    å®ƒçš„ä½œç”¨æœ‰ä¸¤ä¸ª:ä¸€æ˜¯è®¾ç½®æ–°çš„ä¿¡å·æ©ç (ä¸é˜»å¡newmaskæ‰€æŒ‡çš„ä¿¡å·é›†).äºŒæ˜¯ä¿å­˜åŸæ¥çš„ä¿¡å·æ©ç (æ”¾åœ¨oldmaskæ‰€æŒ‡çš„ä¿¡å·é›†ä¸­)
sigpromask(SIG_SETMASK,&amp;oldmask,NULL)
    å®ƒçš„ä½œç”¨åªæœ‰ä¸€ä¸ª:è®¾ç½®æ–°çš„ä¿¡å·æ©ç (ä¿¡å·æ©ç ä¸ºoldmaskæ‰€æŒ‡çš„ä¿¡å·é›†)</p>

<ol>
  <li>sigsuspend ç”¨å®å‚ sigmask æŒ‡å®šçš„ä¿¡å·é›†ä»£æ›¿è°ƒç”¨è¿›ç¨‹çš„ä¿¡å·å±è”½ï¼Œ ç„¶åæŒ‚èµ·è¯¥è¿›ç¨‹ç›´åˆ°æŸä¸ªä¸å±äº sigmask æˆå‘˜çš„ä¿¡å·åˆ°</li>
</ol>

<p>è¾¾ä¸ºæ­¢ã€‚æ­¤ä¿¡å·çš„åŠ¨ä½œè¦ä¹ˆæ˜¯æ‰§è¡Œä¿¡å·å¥æŸ„ï¼Œè¦ä¹ˆæ˜¯ç»ˆæ­¢è¯¥è¿›ç¨‹ã€‚
å¦‚æœä¿¡å·ç»ˆæ­¢è¿›ç¨‹ï¼Œåˆ™ suspend å‡½æ•°ä¸è¿”å›ã€‚å¦‚æœä¿¡å·çš„åŠ¨ä½œæ˜¯æ‰§è¡Œä¿¡å·å¥æŸ„ï¼Œåˆ™åœ¨ä¿¡å·å¥æŸ„è¿”å›åï¼Œsigsuspend å‡½æ•°è¿”å›ï¼Œå¹¶ä½¿</p>

<p>è¿›ç¨‹çš„ä¿¡å·å±è”½æ¢å¤åˆ° sigsuspend è°ƒç”¨ä¹‹å‰çš„å€¼ã€‚</p>

<ol>
  <li>æ¸…æ™°ä¸”å¯é çš„ç­‰å¾…ä¿¡å·åˆ°è¾¾çš„æ–¹æ³•æ˜¯å…ˆé˜»å¡è¯¥ä¿¡å·ï¼ˆé˜²æ­¢ä¸´ç•ŒåŒºé‡å…¥ï¼Œä¹Ÿå°±æ˜¯åœ¨æ¬¡æœŸé—´æœ‰å¦å¤–ä¸€ä¸ªè¯¥ä¿¡å·åˆ°è¾¾ï¼‰ï¼Œç„¶åä½¿ç”¨</li>
</ol>

<p>sigsuspend æ”¾å¼€æ­¤ä¿¡å·å¹¶ç­‰å¾…å¥æŸ„è®¾ç½®ä¿¡å·åˆ°è¾¾æ ‡å¿—ã€‚å¦‚ä¸‹æ‰€ç¤º, ç­‰å¾… SIGUSR1 ä¿¡å·åˆ°æ¥ï¼š</p>

<p>sigemptyset(&amp;zeromask);
sigaddset(&amp;newmask, SIGUSR1);
â€¦â€¦</p>

<p>sigprocmask(SIG_BLOCK, &amp;newmask, NULL);
while(flag)
      sigsuspend(&amp;zeromask);
flag = 0;
â€¦â€¦
sigprocmask(SIG_UNBLOCK, &amp;newmask, NULL);</p>

<p>å¦‚æœåœ¨ç­‰å¾…ä¿¡å·å‘ç”Ÿæ—¶å¸Œæœ›å»ä¼‘çœ ï¼Œåˆ™ä½¿ç”¨sigsuspendå‡½æ•°æ˜¯éå¸¸åˆé€‚çš„ï¼Œä½†æ˜¯å¦‚æœåœ¨ç­‰å¾…ä¿¡å·æœŸé—´å¸Œæœ›è°ƒç”¨å…¶ä»–ç³»ç»Ÿå‡½æ•°ï¼Œé‚£ä¹ˆå°†ä¼šæ€æ ·å‘¢ï¼Ÿä¸å¹¸çš„æ˜¯ï¼Œåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹å¯¹æ­¤é—®é¢˜æ²¡æœ‰å¦¥å–„çš„è§£å†³æ–¹æ³•ã€‚å¦‚æœå¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œåˆ™å¯ä¸“é—¨å®‰æ’ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¿¡å·ã€‚</p>

<p>å¦‚æœä¸ä½¿ç”¨çº¿ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½å°½åŠ›åšåˆ°æœ€å¥½çš„æ˜¯ï¼Œå½“ä¿¡å·å‘ç”Ÿæ—¶ï¼Œåœ¨ä¿¡å·æ•æ‰ç¨‹åºä¸­å¯¹ä¸€ä¸ªå…¨å±€å˜é‡ç½®1.</p>

:ET