I"â<p>Logstashæ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œå¯ä»¥åŒæ—¶ä»å¤šä¸ªæºè·å–æ•°æ®ã€‚é¢å¯¹æµ·é‡çš„æ—¥å¿—é‡ï¼Œrsyslogå’Œsedï¼Œawkç­‰æ—¥å¿—æ”¶é›†ï¼Œå¤„ç†å·¥å…·å·²ç»æ˜¾çš„åŠ›ä¸ä»å¿ƒã€‚logstashæ˜¯ä¸€ä¸ªæ•´åˆå‹çš„æ¡†æ¶ï¼Œå¯ä»¥ç”¨ä»¥æ—¥å¿—çš„æ”¶é›†ï¼Œå­˜å‚¨ï¼Œç´¢å¼•æ„å»ºï¼ˆä¸€èˆ¬è¿™ä¸ªåŠŸèƒ½è¢«ESå–ä»£ï¼‰ã€‚
<!-- more -->
<img src="https://xiazemin.github.io/MyBlog/img/Logstash_elk.jpeg" />
 logstash çš„æœåŠ¡å™¨ç«¯ä»redis/kafka/rabbitmqç­‰ï¼ˆbrokerï¼‰æ¶ˆæ¯é˜Ÿåˆ—è·å–æ•°æ®ã€‚ä¸€æ¡æ•°æ®ä¸€æ¡æ•°æ®çš„æ¸…æ´—ã€‚æ¸…æ´—å®Œæˆåå‘é€ç»™elasticsearché›†ç¾¤ã€‚å†åœ¨kibanaä¸Šæ˜¾ç¤ºã€‚</p>

<p>logstashä¸‰ç§å¯åŠ¨æ–¹å¼ï¼Œ-e stingç±»å‹å¯åŠ¨ï¼Œ-f æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨ï¼ŒæœåŠ¡å¯åŠ¨ã€‚
1ï¼Œlogstash -e â€˜input{ stdin{} } output{ stdout{} }â€™
2ï¼Œlogstash -f logstash.conf
3ï¼Œservice logstash start</p>

<p>æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
logstash -f file.conf -t
Configuration OK</p>

<p>å¯¹äºlogstashè€Œè¨€ï¼Œä»–çš„æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯åŸºäºæ’ä»¶æ¥å®Œæˆçš„ã€‚input,filter,outputç­‰ç­‰éƒ½æ˜¯è¿™æ ·ã€‚</p>

<p>è¾“å…¥æ’ä»¶ï¼š
    æå–æ‰€æœ‰çš„æ•°æ®ã€‚ æ•°æ®é€šå¸¸ä»¥å¤šç§æ ¼å¼æ•£å¸ƒæˆ–åˆ†å¸ƒåœ¨å„ä¸ªç³»ç»Ÿä¸Šã€‚logstashæ”¯æŒå„ç§è¾“å…¥ã€‚å¯ä»¥ä»å¸¸è§çš„å„ç±»æºä¸­è·å–äº‹ä»¶ã€‚è½»æ¾ä»æ—¥å¿—ï¼ŒæŒ‡æ ‡ï¼Œwebåº”ç”¨ç¨‹åºå’Œå„ç§AWSæœåŠ¡ä¸­è¿›è¡Œé‡‡é›†ï¼Œæ‰€æœ‰çš„è¿™äº›éƒ½æ˜¯ä»¥è¿ç»­æµçš„æ–¹å¼è¿›è¡Œã€‚
 è¿‡æ»¤å™¨ï¼š
    éšç€æ•°æ®ä¼ è¾“è€Œæ¥ã€‚logstashè¿‡æ»¤å™¨è§£ææ¯ä¸€ä¸ªäº‹ä»¶ï¼Œè¯†åˆ«å‘½åå­—æ®µä»¥æ„å»ºç»“æ„ã€‚å°†å®ƒä»¬è½¬æ¢ä¸ºé€šç”¨æ ¼å¼ï¼Œä»è€Œæ›´è½»æ¾ï¼Œæ›´å¿«æ·çš„åˆ†æã€‚å¸¸ç”¨çš„è¿‡æ»¤æ•°æ®æ‰‹æ®µã€‚ï¼ˆ1ï¼‰ã€ç”¨grokä»éç»“æ„åŒ–æ•°æ®å¯¼å‡ºç»“æ„ã€‚ï¼ˆ2ï¼‰ã€ä»IPåœ°å€è§£è¯»åœ°ç†åæ ‡ã€‚ï¼ˆ3ï¼‰ã€åŒ¿åPIIæ•°æ®ï¼Œå®Œå…¨æ’é™¤æ•æ„Ÿå­—æ®µã€‚ ï¼ˆ4ï¼‰ã€ç®€åŒ–æ•°æ®æºï¼Œæ ¼å¼æˆ–æ¨¡å¼ã€‚
 äº§å‡ºï¼š
  å½“ç„¶ï¼Œelasticsearchæ˜¯é¦–é€‰çš„è¾“å‡ºå¯¹è±¡ï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šçš„é€‰é¡¹ã€‚å¯æ ¹æ®éœ€è¦è·¯ç”±ã€‚</p>

<p>æ’ä»¶ä»‹ç»
      å¸¸è§çš„æ’ä»¶ã€‚åœ¨è¯¸å¤šçš„inputæ’ä»¶å½“ä¸­æœ‰fileï¼Œudpï¼Œhttpï¼Œkafkaï¼Œrabbitmqï¼Œbeatsç­‰ç­‰
   fileï¼š
    æ–‡ä»¶æµäº‹ä»¶ã€‚ç±»ä¼¼ä¸ tail -n 1 -f å¼€å§‹é˜…è¯»ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä»å¤´å¼€å§‹é˜…è¯»ã€‚åˆ©ç”¨äº†sincedbè®°å½•æ–‡ä»¶çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬æ–‡ä»¶çš„inodeå·ï¼Œä¸»è®¾å¤‡å·ï¼Œä»è®¾å¤‡å·ï¼Œæ–‡ä»¶å†…å­—èŠ‚åç§»é‡ã€‚æ‰€ä»¥æ–‡ä»¶ä¸èƒ½æ”¹åå­—ã€‚ä¸€æ”¹åå­—å°±ä¼šä½¿ç”¨æ–°çš„sincedbã€‚
 input {
        file {
                path =&gt; [â€œ/var/log/messagesâ€]
                type =&gt; â€œsystemâ€
                start_position =&gt; â€œbeginningâ€
             }
}
 udpï¼š
    é€šè¿‡udpå°†æ¶ˆæ¯ä½œä¸ºäº‹ä»¶é€šè¿‡ç½‘ç»œè¯»å–ã€‚å”¯ä¸€éœ€è¦çš„é…ç½®é¡¹æ˜¯portï¼Œå®ƒæŒ‡å®šudpç«¯å£logstashå°†ç›‘å¬äº‹ä»¶æµã€‚
æ¼”ç¤ºä¸€ä¸‹ã€‚
    å…ˆå®‰è£… collectdï¼ˆepelæºä¸­ï¼‰    yum -y install collectd      collectdæ˜¯ä¸€ä¸ªæ€§èƒ½ç›‘æ§ç¨‹åºã€‚
ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/collectd.conf
å°†æƒ³è¦ç›‘æ§çš„å†…å®¹å–æ¶ˆæ³¨é‡Šã€‚ ï¼ˆä¸€å®šè¦å–æ¶ˆ networkï¼‰
 Hostname    â€œnode-1â€
LoadPlugin syslog
LoadPlugin battery
LoadPlugin cpu
LoadPlugin df
LoadPlugin disk
LoadPlugin interface
LoadPlugin load
LoadPlugin memory
LoadPlugin network</p>
<Plugin network="">
	&lt;Server "192.168.40.133" "25826"&gt; #192.168.40.133 æ˜¯logstashç›‘å¬çš„åœ°å€ï¼Œ25826 æ˜¯logstashç›‘å¬ç«¯å£
 	&lt;/Server&gt;
</Plugin>
<p>Include â€œ/etc/collectd.dâ€</p>

<p>å¯åŠ¨å³å¯ã€‚
systemctl  start   collectd
æ¥ä¸‹æ¥å†™ä¸€ä¸ªudp.conf 
 input {
        udp {
                port =&gt; 25826
                codec =&gt; collectd {}
                type  =&gt; â€œcollectdâ€
        }
}</p>

<p>output {
        stdout {
                codec   =&gt; rubydebug
        }
}
æ‰§è¡Œå‘½ä»¤ã€‚å¼€å§‹æ”¶é›†ã€‚</p>
<h1 id="logstash--f-udpconf">logstash -f udp.conf</h1>

<p>Filteræ’ä»¶ï¼š
    ç”¨äºåœ¨å°†eventå‘å¾€outputä¹‹å‰ï¼Œå¯¹å…¶å®ç°ä¸€å®šçš„å¤„ç†åŠŸèƒ½ã€‚</p>

<p>grokï¼š
    ç”¨äºåˆ†æå¹¶ç»“æ„åŒ–æ–‡æœ¬æ•°æ®ã€‚ç›®å‰æ˜¯logstashä¸­éç»“æ„åŒ–æ•°æ®è½¬åŒ–ä¸ºç»“æ„åŒ–æ•°æ®çš„ä¸äºŒä¹‹é€‰ã€‚å¯å¤„ç† syslogï¼ŒApacheï¼Œnginxæ ¼å¼çš„æ—¥å¿—ã€‚
 Filebeatï¼š
     Filebeatæ˜¯ELKçš„ä¸€éƒ¨åˆ†ã€‚å¯ä»¥ä½¿Logstashï¼ŒElasticsearchå’ŒKibanaæ— ç¼åä½œã€‚filebeatçš„åŠŸèƒ½æ˜¯è½¬å‘å’Œæ±‡æ€»æ—¥å¿—ä¸æ–‡ä»¶ã€‚  filebeatå¯ä»¥è¯»å–å¹¶è½¬å‘æ—¥å¿—è¡Œï¼Œå¦‚æœå‡ºç°ä¸­æ–­ï¼Œè¿˜ä¼šåœ¨ä¸€åˆ‡æ¢å¤æ­£å¸¸åï¼Œä»ä¸­æ–­çš„ä½ç½®ç»§ç»­å¼€å§‹ã€‚</p>

<p>beatæ’ä»¶ï¼ˆè¿™æ˜¯ä¸€ä¸ªinputæ’ä»¶ï¼‰
input {
  beats {
    port =&gt; 5044
  }
}</p>

<p>output {
  elasticsearch {
    hosts =&gt; â€œlocalhost:9200â€
    manage_template =&gt; false
    index =&gt; â€œ%{[@metadata][beat]}-%{+YYYY.MM.dd}â€
    document_type =&gt; â€œ%{[@metadata][type]}â€
  }
}
outputæ’ä»¶ï¼š
     è¿™ä¸€èˆ¬æ˜¯æŠŠæ•°æ®å­˜å‚¨ä¸‹æ¥çš„ï¼Œæœ‰emailï¼Œcsvã€‚å½“ç„¶è¿˜æœ‰å¤§åé¼é¼çš„ Elasticsearch</p>

<p>output {
  elasticsearch {
  if [type] == â€œsqlâ€{
                elasticsearch { 
                         hosts =&gt; [â€œhttp://192.168.33.10:9200â€]
                         index =&gt; â€œcommon-sql-%{+YYYY.MM.dd}â€
                }
       }
    ï½
 ï½</p>

<p>æŸ¥çœ‹æ˜¯å¦æˆåŠŸ
http://localhost:9200/_cat/indices
yellow open common-transaction-2015.05.07          E7KztRgjRsWXIJS4shl0Ig 5 1      5   0 126.7kb 126.7kb
yellow open logstash-common-transaction-2015.05.07 NeqyUy0HQkeE8tMsytm6mA 5 1      1   0    25kb    25kb
yellow open logstash-common-transaction-2018.06.07 KjQydnOxTFGY9NYOSFIFnQ 5 1      3   0  72.7kb  72.7kb</p>

:ET