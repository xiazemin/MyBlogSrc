I"õ<p>å› ä¸ºæœ‰äº† Docker è¿™ä¸ªä¸œè¥¿ã€‚å®ƒä¾èµ–äº LXC(Linux Container)ï¼Œèƒ½ä»ç½‘ç»œä¸Šè·å¾—é…ç½®å¥½çš„ Linux é•œåƒï¼Œéå¸¸å®¹æ˜“åœ¨éš”ç¦»çš„ç³»ç»Ÿä¸­è¿è¡Œè‡ªå·±çš„åº”ç”¨ã€‚ä¹Ÿå› ä¸ºå®ƒçš„åº•å±‚æ ¸å¿ƒæ˜¯ä¸ª LXCï¼Œæ‰€ä»¥åœ¨ Mac OS X ä¸‹éœ€è¦åœ¨ VirtualBox ä¸­è·‘ä¸€ä¸ªç²¾å°çš„ LXC(è¿™é‡Œæ˜¯ä¸€ä¸ª Tiny Core Linuxï¼Œå®Œå…¨åœ¨å†…å­˜ä¸­è¿è¡Œï¼Œä¸ªå¤´åªçº¦ 24MBï¼Œå¯åŠ¨æ—¶é—´å°äº 5 ç§’çš„ boot2docker) è™šæ‹Ÿæœºï¼Œæ„å»ºåœ¨ VirtualBox ä¸­ã€‚ä»¥åçš„é€šä¿¡è¿‡ç¨‹å°±æ˜¯ dockerâ€“&gt; boot2docker â€“&gt; containerï¼Œç«¯å£æˆ–ç£ç›˜æ˜ å°„ä¹Ÿæ˜¯éµç…§è¿™ä¸€å…³ç³»ã€‚
<!-- more -->
Docker å®‰è£…è¿‡ç¨‹</p>

<ol>
  <li>
    <p>å®‰è£… VirtualBox, ä¸å¤šè®², å› è¦åœ¨å®ƒå½“ä¸­åˆ›å»ºä¸€ä¸ª boot2docker-vm è™šæ‹Ÿæœº</p>
  </li>
  <li>
    <p>å®‰è£… boot2docker</p>
  </li>
</ol>

<p>brew install boot2docker</p>

<p>ä½ ä¹Ÿå¯ä»¥æ‰‹å·¥å®‰è£…</p>

<p>curl https://raw.github.com/steeve/boot2docker/master/boot2docker &gt; boot2docker; chmod +x boot2docker; sudo mv boot2docker /usr/local/bin</p>

<ol>
  <li>å®‰è£… Docker</li>
</ol>

<p>brew install docker</p>

<p>ä¹Ÿå¯æ‰‹å·¥å®‰è£…</p>

<p>curl -o docker http://get.docker.io/builds/Darwin/x86_64/docker-latest; chmod +x docker; sudo cp docker /usr/local/bin</p>

<ol>
  <li>é…ç½® Docker å®¢æˆ·ç«¯</li>
</ol>

<p>export DOCKER_HOST=tcp://127.0.0.1:4243</p>

<p>æŠŠå®ƒå†™åˆ° ~/.bash_profile ä¸­ï¼Œå¦‚æœä½ æ˜¯ç”¨çš„ bash çš„è¯ã€‚æˆ‘å·¥ä½œåœ¨ fish ä¸‹ï¼Œæ‰€ä»¥åœ¨ ~/.config/fish/config.fish ä¸­åŠ äº† set -x DOCKER_HOST tcp://127.0.0.1:4243</p>

<ol>
  <li>boot2docker åˆå§‹åŒ–ä¸å¯åŠ¨</li>
</ol>

<p>boot2docker init</p>

<p>å®Œæˆåå°±èƒ½åœ¨ VirtualBox ä¸­çœ‹åˆ°ä¸€ä¸ªå«åš boot2docker-vmçš„è™šæ‹Ÿæœºï¼Œä»¥ååªéœ€ç”¨ boot2docker å‘½ä»¤æ¥æ§åˆ¶è¿™ä¸ªè™šæ‹Ÿæœºçš„è¡Œä¸ºï¼Œå¯åŠ¨ï¼Œåœæ­¢ç­‰ã€‚</p>

<p>boot2docker up</p>

<p>å¯åŠ¨ï¼Œboot2docker-vmè™šæ‹Ÿæœºï¼Œæˆ‘ä»¬èƒ½åœ¨ VirtualBox ä¸­çœ‹åˆ°è¯¥è™šæ‹Ÿæœºå˜æˆ Running çŠ¶æ€</p>

<p>ç›´æ¥æ‰§è¡Œ boot2docker å¯ä»¥çœ‹åˆ°å¯ç”¨çš„å‚æ•°</p>

<table>
  <tbody>
    <tr>
      <td>Usage /usr/local/bin/boot2docker {init</td>
      <td>start</td>
      <td>up</td>
      <td>save</td>
      <td>pause</td>
      <td>stop</td>
      <td>restart</td>
      <td>status</td>
      <td>info</td>
      <td>delete</td>
      <td>ssh</td>
      <td>download}</td>
    </tr>
  </tbody>
</table>

<ol>
  <li>å¯åŠ¨ Docker å®ˆæŠ¤è¿›ç¨‹</li>
</ol>

<p>sudo docker -d</p>

<p>è¿™æ—¶å¯æ‰§è¡Œ</p>

<p>boot2docker sshï¼Œè¾“å…¥å¯†ç   tcuser è¿›åˆ°è¯¥è™šæ‹Ÿæœºçš„æ§åˆ¶å°ä¸‹ï¼Œå¦‚æœè¦ç”¨æˆ·åçš„è¯è¯·è¾“å…¥docker</p>

<p>Mac å¯åŠ¨äº† 4243 ç«¯å£ï¼Œåœ¨ boot2docker è™šæ‹Ÿæœºä¸­ä¹Ÿæœ‰ 4243 ç«¯å£ï¼Œå¹¶åœ¨ /var/run/docker.sock ä¸Šç›‘å¬ã€‚å€Ÿæ­¤å›é¡¾ä¸‹ docker çš„é€šä¿¡è¿‡ç¨‹ï¼Œdock å‘½ä»¤æ˜¯ä¸ Docker daemon åœ¨  Mac ä¸Šå¼€å¯çš„  4243 ç«¯å£é€šä¿¡ï¼Œè¯¥ç«¯å£æ˜ å°„åˆ° boot2docker çš„  4243 ç«¯å£ä¸Šï¼Œè¿›è€Œé€šè¿‡ /var/run/docker.sock ä¸å…¶ä¸­çš„å®¹å™¨è¿›è¡Œé€šä¿¡ã€‚</p>

<p>æ‰€ä»¥åœ¨æ‰§è¡Œ  docker version æ—¶å¦‚æœæ²¡æœ‰å¯åŠ¨ Docker daemon ä¼šæç¤º</p>

<p>2014/05/16 06:52:48 Cannot connect to the Docker daemon. Is â€˜docker -dâ€™ running on this host?</p>

<p>å¦‚æœæ²¡æœ‰å¯åŠ¨ boot2docker ä¼šå¾—åˆ°æç¤º</p>

<p>Get http:///var/run/docker.sock/v1.11/version: dial unix /var/run/docker.sock: no such file or directory</p>

<p>boot2docker, docker éƒ½å‡†å¤‡å°±ç»ªäº†, ç°åœ¨å¼€å§‹è¿›å…¥ dock  çš„æ“ä½œäº†</p>

<p>ç«¯å£æ˜ å°„
æ¯”å¦‚æˆ‘ä»¬ç°åœ¨è¦åšçš„æ˜ å°„å…³ç³»æ˜¯ Mac OS X(50080) â€“&gt; boot2docker(40080) â€“&gt; container(80)ï¼š
å¯ä»¥æœ‰ä¸¤ç§åŠæ³•</p>

<p>1)boot2docker ssh -L 50080:localhost:40080  #è¿™æ¡å‘½ä»¤å¯ä»¥åœ¨  boot2docker-vm  è¿è¡Œæ—¶æ‰§è¡Œï¼Œå»ºç«‹å¤šä¸ªä¸åŒçš„æ˜ å°„å°±æ˜¯æ‰§è¡Œå¤šæ¬¡</p>

<p>docker run -i -t -p 40080:80 learn/tutorial
root@c79b5070a972:/# apachectl start</p>

<p>ç„¶ååœ¨ Mac çš„æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:50080</p>

<p>2)VBoxManage modifyvm â€œboot2docker-vmâ€ â€“natpf1 â€œtcp-port_50080:80,tcp,,50080,,40080â€</p>

<p>docker run -i -t -p 40080:80 learn/tutorial
root@c79b5070a972:/# apachectl start</p>

<p>è¿™æ˜¯ç›´æ¥ä¿®æ”¹äº†  boot2docker-vm çš„é…ç½®ï¼Œå¯ä»¥åœ¨ VirtualBox ä¸­çœ‹åˆ°è¿™æ¡é…ç½®ï¼Œé…ç½® nat å‘½ä»¤è§ http://www.virtualbox.org/manual/ch06.html#natforward. ä¹Ÿèƒ½å»ºç«‹è®¸å¤šçš„ç«¯å£æ˜ å°„</p>

<p>boot2docker ssh -L 50080:localhost:40080  #è¿™æ¡å‘½ä»¤å¯ä»¥åœ¨  boot2docker-vm  è¿è¡Œæ—¶æ‰§è¡Œï¼Œå»ºç«‹å¤šä¸ªä¸åŒçš„æ˜ å°„å°±æ˜¯æ‰§è¡Œå¤šæ¬¡ï¼Œæ˜ å°„æœ¬æœºçš„50080åˆ°vmçš„40080
docker run -i -t -p 40080:80 learn/tutorial bash # æ˜ å°„vmçš„40080åˆ°learn/tutorialå®¹å™¨çš„80ç«¯å£ã€‚</p>

<p>dockerå®¹å™¨ä¸­å®‰è£…sshæœåŠ¡ï¼Œå¹¶å¯åŠ¨ã€‚commitåé€€å‡ºã€‚</p>

<p>boot2docker ssh -L 50080:localhost:40080 -L 50443:localhost:40443 -L50022:localhost:40022 ï¼Œæ˜ å°„å¤šä¸ªipåˆ°localhostï¼Œå¹¶å¯åŠ¨vmã€‚</p>

<p>docker run -i -t -p 40080:80 -p 40443:443 -p 40022:22 daimin/test bash ï¼Œæ˜ å°„ç«¯å£æ–¹å¼å¯åŠ¨dockerå®¹å™¨ï¼Œè¿™ä¸ªæ—¶å€™40022æ˜ å°„åˆ°äº†å®¹å™¨çš„22ç«¯å£ï¼Œä¹Ÿå°±æ˜¯sshç«¯å£ï¼Œç„¶åå¼€å¯sshæœåŠ¡ã€‚</p>

<p>åœ¨æ§åˆ¶å°è¾“å…¥ ssh -p 50022 root@localhost ï¼Œå‘ç°æç¤ºè¾“å…¥ç”¨æˆ·å¯†ç ï¼Œç„¶åæˆåŠŸç™»å½•ã€‚</p>

<p>åœ¨linuxä¸‹æˆ‘ä»¬å¯ä»¥åœ¨dockerä¸­æ–°å»ºå®¹å™¨ï¼Œç„¶åé€šè¿‡ç«¯å£è½¬å‘ç›´æ¥è®¿é—®åˆ°å®¹å™¨ã€‚ä½†æ˜¯åœ¨macä¸‹ä¸­é—´åˆé€šè¿‡äº†ä¸€å±‚è™šæ‹Ÿæœºï¼Œæ‰€ä»¥ç«¯å£è½¬å‘å°±éœ€è¦åœ¨å¤šåšä¸€ç‚¹ã€‚</p>

<p>1 æŠŠæœ¬åœ°ç«¯å£å’Œè™šæ‹Ÿæœºå¯¹åº”èµ·æ¥ï¼šå¯ä»¥é€šè¿‡å‘½ä»¤æ¥åšï¼š
ï¼ƒVBoxManage modifyvm â€œboot2docker-vmâ€ â€“natpf1 â€œcontainerssh,tcp,,2222,,2222â€
2ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨æ·»åŠ ï¼š
é€‰ä¸­è™šæ‹Ÿæœºï¼Œè®¾ç½®ï¼Œç½‘ç»œï¼Œç½‘ç»œåœ°å€è½¬å‘ï¼ˆNATï¼‰ï¼Œç«¯å£è½¬å‘</p>

<p>åœ¨ Mac ä¸‹ä½¿ç”¨ Docker é™¤äº†å¯ç”¨ boot2docker ä½œä¸º LXCï¼Œè¿˜æœ‰ä¸ªæ›¿ä»£å“ VAGRANT ã€‚</p>
:ET