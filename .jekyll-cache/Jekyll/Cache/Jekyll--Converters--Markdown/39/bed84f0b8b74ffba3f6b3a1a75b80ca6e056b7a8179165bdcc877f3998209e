I"à<p>ä¸€ã€ä»€ä¹ˆæ˜¯splåº“ï¼Ÿ
SPLæ˜¯ç”¨äºè§£å†³å…¸å‹é—®é¢˜(standard problems)çš„ä¸€ç»„æ¥å£ä¸ç±»çš„é›†åˆã€‚</p>

<p>æ­¤æ‰©å±•åªèƒ½åœ¨php 5.0ä»¥åä½¿ç”¨ï¼Œä»PHP 5.3.0 ä¸å†è¢«å…³é—­,ä¼šä¸€ç›´æœ‰æ•ˆ.æˆä¸ºphpå†…æ ¸ç»„ä»¶ä¸€éƒ¨ä»½ã€‚</p>

<p>SPLæä¾›äº†ä¸€ç»„æ ‡å‡†æ•°æ®ç»“æ„ã€‚</p>

<p>äºŒã€SPLå¦‚ä½•ä½¿ç”¨ï¼Ÿ
1.æ„å»ºæ­¤æ‰©å±•ä¸éœ€è¦å…¶ä»–æ‰©å±•ã€‚</p>

<p>æ›´è¯¦ç»†çš„æƒ…å†µå¯å‚è€ƒ http://php.net/manual/zh/spl.datastructures.php
<!-- more -->
åŒå‘é“¾è¡¨
åŒé“¾è¡¨æ˜¯ä¸€ç§é‡è¦çš„çº¿æ€§å­˜å‚¨ç»“æ„ï¼Œå¯¹äºåŒé“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œä¸ä»…ä»…å­˜å‚¨è‡ªå·±çš„ä¿¡æ¯ï¼Œè¿˜è¦ä¿å­˜å‰é©±å’Œåç»§èŠ‚ç‚¹çš„åœ°å€ã€‚</p>

<p>SplDoublyLinkedList</p>

<p>SplStackï¼ˆæ ˆï¼‰</p>

<p>SplQueueï¼ˆé˜Ÿåˆ—ï¼‰</p>

<p>SplDoublyLinkedList implements Iterator , ArrayAccess , Countable {    /* æ–¹æ³• */
    public __construct ( void )  <br />
    public void add ( mixed $index , mixed $newval )  <br />
    public mixed bottom ( void )//åŒé“¾è¡¨çš„å°¾éƒ¨èŠ‚ç‚¹
    public int count ( void )//åŒè”è¡¨å…ƒç´ çš„ä¸ªæ•°
    public mixed current ( void )//å½“å‰è®°å½•
    public int getIteratorMode ( void ) //è·å–è¿­ä»£æ¨¡å¼
    public bool isEmpty ( void )//æ£€æµ‹åŒé“¾è¡¨æ˜¯å¦ä¸ºç©º
    public mixed key ( void )//å½“å‰èŠ‚ç‚¹ç´¢å¼•
    public void next ( void )//ç§»åˆ°ä¸‹æ¡è®°å½•
    public bool offsetExists ( mixed $index )//æŒ‡å®šindexå¤„èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨
    public mixed offsetGet ( mixed $index )//è·å–æŒ‡å®šindexå¤„èŠ‚ç‚¹å€¼
    public void offsetSet ( mixed $index , mixed $newval )//è®¾ç½®æŒ‡å®šindexå¤„å€¼
    public void offsetUnset ( mixed $index )//åˆ é™¤æŒ‡å®šindexå¤„èŠ‚ç‚¹
    public mixed pop ( void )//ä»åŒé“¾è¡¨çš„å°¾éƒ¨å¼¹å‡ºå…ƒç´ 
    public void prev ( void )//ç§»åˆ°ä¸Šæ¡è®°å½•
    public void push ( mixed $value )//æ·»åŠ å…ƒç´ åˆ°åŒé“¾è¡¨çš„å°¾éƒ¨
    public void rewind ( void )//å°†æŒ‡é’ˆæŒ‡å‘è¿­ä»£å¼€å§‹å¤„
    public string serialize ( void )//åºåˆ—åŒ–å­˜å‚¨
    public void setIteratorMode ( int $mode )//è®¾ç½®è¿­ä»£æ¨¡å¼
    public mixed shift ( void )//åŒé“¾è¡¨çš„å¤´éƒ¨ç§»é™¤å…ƒç´ 
    public mixed top ( void )//åŒé“¾è¡¨çš„å¤´éƒ¨èŠ‚ç‚¹
    public void unserialize ( string $serialized )//ååºåˆ—åŒ–
    public void unshift ( mixed $value )//åŒé“¾è¡¨çš„å¤´éƒ¨æ·»åŠ å…ƒç´ 
    public bool valid ( void )//æ£€æŸ¥åŒé“¾è¡¨æ˜¯å¦è¿˜æœ‰èŠ‚ç‚¹
}</p>

<p>æ¥ä¸‹æ¥æ˜¯ä½¿ç”¨æ–¹æ³•ï¼š</p>

<p>$list = new SplDoublyLinkedList();
$list-&gt;push(â€˜aâ€™);
$list-&gt;push(â€˜bâ€™);
$list-&gt;push(â€˜câ€™);
$list-&gt;push(â€˜dâ€™);</p>

<p>$list-&gt;unshift(â€˜topâ€™);
$list-&gt;shift();</p>

<p>$list-&gt;rewind();//rewindæ“ä½œç”¨äºæŠŠèŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘Bottomæ‰€åœ¨çš„èŠ‚ç‚¹
echo â€˜curren node:â€™.$list-&gt;current().â€<br />â€;//è·å–å½“å‰èŠ‚ç‚¹</p>

<p>$list-&gt;next();//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
echo â€˜next node:â€™.$list-&gt;current().â€<br />â€;</p>

<p>$list-&gt;next();
$list-&gt;next();
$list-&gt;prev();//æŒ‡é’ˆæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹
echo â€˜next node:â€™.$list-&gt;current().â€<br />â€;</p>

<p>if($list-&gt;current())
    echo â€˜current node is valid<br />â€™;
else
    echo â€˜current node is invalid<br />â€™;</p>

<p>if($list-&gt;valid())//å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯æœ‰æ•ˆèŠ‚ç‚¹ï¼Œvalidè¿”å›true
    echo â€œvalid list<br />â€;
else
  echo â€œinvalid list <br />â€;</p>

<p>var_dump(array(
    â€˜popâ€™ =&gt; $list-&gt;pop(),
    â€˜countâ€™ =&gt; $list-&gt;count(),  <br />
    â€˜isEmptyâ€™ =&gt; $list-&gt;isEmpty(),  <br />
    â€˜bottomâ€™ =&gt; $list-&gt;bottom(),  <br />
    â€˜topâ€™ =&gt; $list-&gt;top()
));</p>

<p>$list-&gt;setIteratorMode(SplDoublyLinkedList::IT_MODE_FIFO);
var_dump($list-&gt;getIteratorMode());</p>

<p>for($list-&gt;rewind(); $list-&gt;valid(); $list-&gt;next()){
    echo $list-&gt;current().PHP_EOL;
}</p>

<p>var_dump($a = $list-&gt;serialize());
//print_r($list-&gt;unserialize($a));</p>

<p>$list-&gt;offsetSet(0,â€™new oneâ€™);
$list-&gt;offsetUnset(0);
var_dump(array(
    â€˜offsetExistsâ€™ =&gt; $list-&gt;offsetExists(4),  <br />
    â€˜offsetGetâ€™ =&gt; $list-&gt;offsetGet(0),
));
var_dump($list);</p>

<p>//å †æ ˆï¼Œå…ˆè¿›åå‡º
$stack = new SplStack();//ç»§æ‰¿è‡ªSplDoublyLinkedListç±»</p>

<p>$stack-&gt;push(â€œa<br />â€);
$stack-&gt;push(â€œb<br />â€);</p>

<p>echo $stack-&gt;pop();
echo $stack-&gt;pop();
echo $stack-&gt;offsetSet(0,â€™Bâ€™);//å †æ ˆçš„offset=0æ˜¯Topæ‰€åœ¨çš„ä½ç½®ï¼Œoffset=1æ˜¯Topä½ç½®èŠ‚ç‚¹é è¿‘bottomä½ç½®çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œä»¥æ­¤ç±»æ¨</p>

<p>$stack-&gt;rewind();//åŒå‘é“¾è¡¨çš„rewindå’Œå †æ ˆçš„rewindç›¸åï¼Œå †æ ˆçš„rewindä½¿å¾—å½“å‰æŒ‡é’ˆæŒ‡å‘Topæ‰€åœ¨çš„ä½ç½®ï¼Œè€ŒåŒå‘é“¾è¡¨è°ƒç”¨ä¹‹åæŒ‡å‘bottomæ‰€åœ¨ä½ç½®
echo â€˜current:â€™.$stack-&gt;current().â€™<br />â€™;
$stack-&gt;next();//å †æ ˆçš„nextæ“ä½œä½¿æŒ‡é’ˆæŒ‡å‘é è¿‘bottomä½ç½®çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€ŒåŒå‘é“¾è¡¨æ˜¯é è¿‘topçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
echo â€˜current:â€™.$stack-&gt;current().â€™<br />â€™;
echo â€˜<br /><br />â€™;</p>

<p>//é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡º
$queue = new SplQueue();//ç»§æ‰¿è‡ªSplDoublyLinkedListç±»
$queue-&gt;enqueue(â€œa<br />â€);//æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹åˆ°é˜Ÿåˆ—é‡Œé¢çš„Topä½ç½®
$queue-&gt;enqueue(â€œb<br />â€);
$queue-&gt;offsetSet(0,â€™Aâ€™);//å †æ ˆçš„offset=0æ˜¯Topæ‰€åœ¨çš„ä½ç½®ï¼Œoffset=1æ˜¯Topä½ç½®èŠ‚ç‚¹é è¿‘bottomä½ç½®çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œä»¥æ­¤ç±»æ¨
echo $queue-&gt;dequeue();
echo $queue-&gt;dequeue();
echo â€œ<br /><br />â€;</p>

<p>å †
å †(Heap)å°±æ˜¯ä¸ºäº†å®ç°ä¼˜å…ˆé˜Ÿåˆ—è€Œè®¾è®¡çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯é€šè¿‡æ„é€ äºŒå‰å †(äºŒå‰æ ‘çš„ä¸€ç§)å®ç°ã€‚æ ¹èŠ‚ç‚¹æœ€å¤§çš„å †å«åšæœ€å¤§å †æˆ–å¤§æ ¹å †ï¼ˆSplMaxHeapï¼‰ï¼Œæ ¹èŠ‚ç‚¹æœ€å°çš„å †å«åšæœ€å°å †æˆ–å°æ ¹å †ï¼ˆSplMinHeapï¼‰ã€‚äºŒå‰å †è¿˜å¸¸ç”¨äºæ’åº(å †æ’åº)</p>

<p>SplHeap</p>

<p>SplMaxHeap</p>

<p>SplMinHeap</p>

<p>SplPriorityQueue</p>

<p>abstract SplHeap implements Iterator , Countable {  <br />
    /* æ–¹æ³• ç”¨æ³•åŒåŒå‘é“¾è¡¨ä¸€è‡´ */
    public __construct ( void )  <br />
    abstract protected int compare ( mixed $value1 , mixed $value2 )  <br />
    public int count ( void )  <br />
    public mixed current ( void )  <br />
    public mixed extract ( void )  <br />
    public void insert ( mixed $value )  <br />
    public bool isEmpty ( void )  <br />
    public mixed key ( void )  <br />
    public void next ( void )  <br />
    public void recoverFromCorruption ( void )  <br />
    public void rewind ( void )  <br />
    public mixed top ( void )  <br />
    public bool valid ( void )
}</p>

<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>

<p>//å †
class MySplHeap extends SplHeap{
    //compare()æ–¹æ³•ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ çš„å¤§å°ï¼Œç»å¯¹ä»–ä»¬åœ¨å †ä¸­çš„ä½ç½®
    public function compare( $value1, $value2 ) {
        return ( $value1 - $value2 );
        }
}</p>

<p>$obj = new MySplHeap();
$obj-&gt;insert(0);
$obj-&gt;insert(1);
$obj-&gt;insert(2);
$obj-&gt;insert(3);
$obj-&gt;insert(4);
echo $obj-&gt;top();//4
echo $obj-&gt;count();//5</p>

<p>foreach ($obj as $item) {
    echo $item.â€<br />â€;
}</p>

<p>é˜µåˆ—
ä¼˜å…ˆé˜Ÿåˆ—ä¹Ÿæ˜¯éå¸¸å®ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯ä»¥é€šè¿‡åŠ æƒå¯¹å€¼è¿›è¡Œæ’åºï¼Œç”±äºæ’åºåœ¨phpå†…éƒ¨å®ç°ï¼Œä¸šåŠ¡ä»£ç ä¸­å°†ç²¾ç®€ä¸å°‘è€Œä¸”æ›´é«˜æ•ˆã€‚é€šè¿‡SplPriorityQueue::setExtractFlags(int  $flag)è®¾ç½®æå–æ–¹å¼å¯ä»¥æå–æ•°æ®ï¼ˆç­‰åŒæœ€å¤§å †ï¼‰ã€ä¼˜å…ˆçº§ã€å’Œä¸¤è€…éƒ½æå–çš„æ–¹å¼ã€‚</p>

<p>SplFixedArray</p>

<p>SplFixedArray implements Iterator , ArrayAccess , Countable {
ã€€ã€€/* æ–¹æ³• */ã€€ã€€
ã€€ã€€public __construct ([ int $size = 0 ] )
ã€€ã€€public int count ( void )
ã€€ã€€public mixed current ( void )
ã€€ã€€public static SplFixedArray fromArray ( array $array [, bool $save_indexes = true ] )
ã€€ã€€public int getSize ( void )
ã€€ã€€public int key ( void )
ã€€ã€€public void next ( void )
ã€€ã€€public bool offsetExists ( int $index )
ã€€ã€€public mixed offsetGet ( int $index )
ã€€ã€€public void offsetSet ( int $index , mixed $newval )
ã€€ã€€public void offsetUnset ( int $index )
ã€€ã€€public void rewind ( void )
ã€€ã€€public int setSize ( int $size )
ã€€ã€€public array toArray ( void )
ã€€ã€€public bool valid ( void )
ã€€ã€€public void __wakeup ( void )
}</p>

<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>

<p>$arr = new SplFixedArray(4);
$arr[0] = â€˜phpâ€™;
$arr[1] = 1;
$arr[3] = â€˜pythonâ€™;//éå†ï¼Œ $arr[2] ä¸ºnull
foreach($arr as $v) {
    echo $v . PHP_EOL;
}</p>

<p>//è·å–æ•°ç»„é•¿åº¦
echo $arr-&gt;getSize(); //4</p>

<p>//å¢åŠ æ•°ç»„é•¿åº¦
$arr-&gt;setSize(5);
$arr[4] = â€˜new oneâ€™;</p>

<p>//æ•è·å¼‚å¸¸
try{
    echo $arr[10];
} catch (RuntimeException $e) {
    echo $e-&gt;getMessage();
}</p>

<p>æ˜ å°„
ç”¨æ¥å­˜å‚¨ä¸€ç»„å¯¹è±¡çš„ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦å”¯ä¸€æ ‡è¯†å¯¹è±¡çš„æ—¶å€™ã€‚</p>

<p>SplObjectStorage</p>

<p>SplObjectStorage implements Countable , Iterator , Serializable , ArrayAccess {
ã€€ã€€/* æ–¹æ³• */ã€€ã€€
ã€€ã€€public void addAll ( SplObjectStorage $storage )
ã€€ã€€public void attach ( object $object [, mixed $data = NULL ] )
ã€€ã€€public bool contains ( object $object )
ã€€ã€€public int count ( void )
ã€€ã€€public object current ( void )
ã€€ã€€public void detach ( object $object )
ã€€ã€€public string getHash ( object $object )
ã€€ã€€public mixed getInfo ( void )
ã€€ã€€public int key ( void )
ã€€ã€€public void next ( void )
ã€€ã€€public bool offsetExists ( object $object )
ã€€ã€€public mixed offsetGet ( object $object )
ã€€ã€€public void offsetSet ( object $object [, mixed $data = NULL ] )
ã€€ã€€public void offsetUnset ( object $object )
ã€€ã€€public void removeAll ( SplObjectStorage $storage )
ã€€ã€€public void removeAllExcept ( SplObjectStorage $storage )
ã€€ã€€public void rewind ( void )
ã€€ã€€public string serialize ( void )
ã€€ã€€public void setInfo ( mixed $data )
ã€€ã€€public void unserialize ( string $serialized )
ã€€ã€€public bool valid ( void )
}</p>

<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>

<p>class A {
    public $i;  <br />
    public function __construct($i) {
        $this-&gt;i = $i;
    }
}</p>

<p>$a1 = new A(1);
$a2 = new A(2);
$a3 = new A(3);
$a4 = new A(4);</p>

<p>$container = new SplObjectStorage();</p>

<p>//SplObjectStorage::attach æ·»åŠ å¯¹è±¡åˆ°Storageä¸­
$container-&gt;attach($a1);
$container-&gt;attach($a2);
$container-&gt;attach($a3);</p>

<p>//SplObjectStorage::detach å°†å¯¹è±¡ä»Storageä¸­ç§»é™¤
$container-&gt;detach($a2);</p>

<p>//SplObjectStorage::containsç”¨äºæ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨Storageä¸­
var_dump($container-&gt;contains($a1)); //true
var_dump($container-&gt;contains($a4)); //false</p>

<p>//éå†
$container-&gt;rewind();
while($container-&gt;valid()) {
    var_dump($container-&gt;current());  <br />
    $container-&gt;next();
}</p>

<p>https://www.w3cschool.cn/doc_php/php-arrayobject-getarraycopy.html
Exports the ArrayObject to an array.</p>

<p>class OrderInfo extends \ArrayObject implements \JsonSerializable {}</p>

<p>https://www.w3cschool.cn/doc_php/php-jsonserializable-jsonserialize.html?lang=en</p>

<p>https://www.php.net/manual/en/arrayiterator.getarraycopy.php</p>

<p>https://www.php.net/manual/de/jsonserializable.jsonserialize.php</p>

<p>https://www.php.net/manual/zh/class.arrayobject.php</p>

<p>https://www.php.net/manual/en/arrayobject.offsetunset.php</p>

<p>https://www.php.net/manual/en/arrayobject.getarraycopy.php</p>

<p>ç¬¬ä¸€éƒ¨åˆ† ç®€ä»‹</p>

<ol>
  <li>
    <p>ä»€ä¹ˆæ˜¯SPLï¼Ÿ</p>
  </li>
  <li>
    <p>ä»€ä¹ˆæ˜¯Iteratorï¼Ÿ</p>
  </li>
</ol>

<p>ç¬¬äºŒéƒ¨åˆ† SPL Interfaces</p>

<ol>
  <li>
    <p>Iteratorç•Œé¢</p>
  </li>
  <li>
    <p>ArrayAccessç•Œé¢</p>
  </li>
  <li>
    <p>IteratorAggregateç•Œé¢</p>
  </li>
  <li>
    <p>RecursiveIteratorç•Œé¢</p>
  </li>
  <li>
    <p>SeekableIteratorç•Œé¢</p>
  </li>
  <li>
    <p>Countableç•Œé¢</p>
  </li>
</ol>

<p>ç¬¬ä¸‰éƒ¨åˆ† SPL Classes</p>

<ol>
  <li>
    <p>SPLçš„å†…ç½®ç±»</p>
  </li>
  <li>
    <p>DirectoryIteratorç±»</p>
  </li>
  <li>
    <p>ArrayObjectç±»</p>
  </li>
  <li>
    <p>ArrayIteratorç±»</p>
  </li>
  <li>
    <p>RecursiveArrayIteratorç±»å’ŒRecursiveIteratorIteratorç±»</p>
  </li>
  <li>
    <p>FilterIteratorç±»</p>
  </li>
  <li>
    <p>SimpleXMLIteratorç±»</p>
  </li>
  <li>
    <p>CachingIteratorç±»</p>
  </li>
  <li>
    <p>LimitIteratorç±»</p>
  </li>
  <li>
    <p>SplFileObjectç±»</p>
  </li>
</ol>

<p>ç¬¬ä¸€éƒ¨ ç®€ä»‹</p>

<ol>
  <li>ä»€ä¹ˆæ˜¯SPLï¼Ÿ
SPLæ˜¯Standard PHP Libraryï¼ˆPHPæ ‡å‡†åº“ï¼‰çš„ç¼©å†™ã€‚</li>
</ol>

<p>æ ¹æ®å®˜æ–¹å®šä¹‰ï¼Œå®ƒæ˜¯â€a collection of interfaces and classes that are meant to solve standard problemsâ€ã€‚ä½†æ˜¯ï¼Œç›®å‰åœ¨ä½¿ç”¨ä¸­ï¼ŒSPLæ›´å¤šåœ°è¢«çœ‹ä½œæ˜¯ä¸€ç§ä½¿objectï¼ˆç‰©ä½“ï¼‰æ¨¡ä»¿arrayï¼ˆæ•°ç»„ï¼‰è¡Œä¸ºçš„interfaceså’Œclassesã€‚</p>

<ol>
  <li>ä»€ä¹ˆæ˜¯Iteratorï¼Ÿ</li>
</ol>

<p>SPLçš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯Iteratorã€‚è¿™æŒ‡çš„æ˜¯ä¸€ç§Design Patternï¼Œæ ¹æ®ã€ŠDesign Patternsã€‹ä¸€ä¹¦çš„å®šä¹‰ï¼ŒIteratorçš„ä½œç”¨æ˜¯â€provide an object which traverses some aggregate structure, abstracting away assumptions about the implementation of that structure.â€</p>

<p>wikipediaä¸­è¯´ï¼Œâ€an iterator is an object which allows a programmer to traverse through all the elements of a collection, regardless of its specific implementationâ€â€¦â€¦.â€the iterator pattern is a design pattern in which iterators are used to access the elements of an aggregate object sequentially without exposing its underlying representationâ€.</p>

<p>é€šä¿—åœ°è¯´ï¼ŒIteratorèƒ½å¤Ÿä½¿è®¸å¤šä¸åŒçš„æ•°æ®ç»“æ„ï¼Œéƒ½èƒ½æœ‰ç»Ÿä¸€çš„æ“ä½œç•Œé¢ï¼Œæ¯”å¦‚ä¸€ä¸ªæ•°æ®åº“çš„ç»“æœé›†ã€åŒä¸€ä¸ªç›®å½•ä¸­çš„æ–‡ä»¶é›†ã€æˆ–è€…ä¸€ä¸ªæ–‡æœ¬ä¸­æ¯ä¸€è¡Œæ„æˆçš„é›†åˆã€‚</p>

<p>å¦‚æœæŒ‰ç…§æ™®é€šæƒ…å†µï¼Œéå†ä¸€ä¸ªMySQLçš„ç»“æœé›†ï¼Œç¨‹åºéœ€è¦è¿™æ ·å†™ï¼š</p>

<p>// Fetch the â€œaggregate structureâ€
$result = mysql_query(â€œSELECT * FROM usersâ€);</p>

<p>// Iterate over the structure
while ( $row = mysql_fetch_array($result) ) {
   // do stuff with the row here
}</p>

<p>è¯»å‡ºä¸€ä¸ªç›®å½•ä¸­çš„å†…å®¹ï¼Œéœ€è¦è¿™æ ·å†™ï¼š</p>

<p>// Fetch the â€œaggregate structureâ€
$dh = opendir(â€˜/home/harryf/filesâ€™);</p>

<p>// Iterate over the structure
while ( $file = readdir($dh) ) {
   // do stuff with the file here
}</p>

<p>è¯»å‡ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹ï¼Œéœ€è¦è¿™æ ·å†™ï¼š</p>

<p>// Fetch the â€œaggregate structureâ€
$fh = fopen(â€œ/home/hfuecks/files/results.txtâ€, â€œrâ€);</p>

<p>// Iterate over the structure
while (!feof($fh)) {</p>

<p>$line = fgets($fh);
   // do stuff with the line here</p>

<p>}</p>

<p>ä¸Šé¢ä¸‰æ®µä»£ç ï¼Œè™½ç„¶å¤„ç†çš„æ˜¯ä¸åŒçš„resourceï¼ˆèµ„æºï¼‰ï¼Œä½†æ˜¯åŠŸèƒ½éƒ½æ˜¯éå†ç»“æœé›†ï¼ˆloop over contentsï¼‰ï¼Œå› æ­¤Iteratorçš„åŸºæœ¬æ€æƒ³ï¼Œå°±æ˜¯å°†è¿™ä¸‰ç§ä¸åŒçš„æ“ä½œç»Ÿä¸€èµ·æ¥ï¼Œç”¨åŒæ ·çš„å‘½ä»¤ç•Œé¢ï¼Œå¤„ç†ä¸åŒçš„èµ„æºã€‚</p>

<p>ç¬¬äºŒéƒ¨åˆ† SPL Interfaces</p>

<ol>
  <li>Iteratorç•Œé¢</li>
</ol>

<p>SPLè§„å®šï¼Œæ‰€æœ‰éƒ¨ç½²äº†Iteratorç•Œé¢çš„classï¼Œéƒ½å¯ä»¥ç”¨åœ¨foreach Loopä¸­ã€‚Iteratorç•Œé¢ä¸­åŒ…å«5ä¸ªå¿…é¡»éƒ¨ç½²çš„æ–¹æ³•ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* current()

  This method returns the current index's value. You are solely
  responsible for tracking what the current index is as the 
 interface does not do this for you.

* key()

  This method returns the value of the current index's key. For 
  foreach loops this is extremely important so that the key 
  value can be populated.

* next()

  This method moves the internal index forward one entry.

* rewind()

  This method should reset the internal index to the first element.

* valid()

  This method should return true or false if there is a current 
  element. It is called after rewind() or next().
</code></pre></div></div>

<p>ä¸‹é¢å°±æ˜¯ä¸€ä¸ªéƒ¨ç½²äº†Iteratorç•Œé¢çš„classç¤ºä¾‹ï¼š</p>

<p>/**</p>
<ul>
  <li>An iterator for native PHP arrays, re-inventing the wheel
*</li>
  <li>
    <p>Notice the â€œimplements Iteratorâ€ - important!
*/
class ArrayReloaded implements Iterator {</p>

    <p>/**</p>
    <ul>
      <li>A native PHP array to iterate over
 */
 private $array = array();</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>A switch to keep track of the end of the array
 */
 private $valid = FALSE;</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>Constructor</li>
      <li>@param array native PHP array to iterate over
 */
 function __construct($array) {
 $this-&gt;array = $array;
 }</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>Return the array â€œpointerâ€ to the first element</li>
      <li>PHPâ€™s reset() returns false if the array has no elements
 */
 function rewind(){
 $this-&gt;valid = (FALSE !== reset($this-&gt;array));
 }</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>Return the current array element
 */
 function current(){
 return current($this-&gt;array);
 }</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>Return the key of the current array element
 */
 function key(){
 return key($this-&gt;array);
 }</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>Move forward by one</li>
      <li>PHPâ€™s next() returns false if there are no more elements
 */
 function next(){
 $this-&gt;valid = (FALSE !== next($this-&gt;array));
 }</li>
    </ul>

    <p>/**</p>
    <ul>
      <li>Is the current element valid?
 */
 function valid(){
 return $this-&gt;valid;
 }
}</li>
    </ul>
  </li>
</ul>

<p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<p>// Create iterator object
$colors = new ArrayReloaded(array (â€˜redâ€™,â€™greenâ€™,â€™blueâ€™,));</p>

<p>// Iterate away!
foreach ( $colors as $color ) {
 echo $color.â€<br />â€;
}</p>

<p>ä½ ä¹Ÿå¯ä»¥åœ¨foreachå¾ªç¯ä¸­ä½¿ç”¨key()æ–¹æ³•ï¼š</p>

<p>// Display the keys as well
foreach ( $colors as $key =&gt; $color ) {
 echo â€œ$key: $color<br />â€;
}</p>

<p>é™¤äº†foreachå¾ªç¯å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨whileå¾ªç¯ï¼Œ</p>

<p>// Reset the iterator - foreach does this automatically
$colors-&gt;rewind();</p>

<p>// Loop while valid
while ( $colors-&gt;valid() ) {</p>

<p>echo $colors-&gt;key().â€: â€œ.$colors-&gt;current().â€
â€œ;
   $colors-&gt;next();</p>

<p>}</p>

<p>æ ¹æ®æµ‹è¯•ï¼Œwhileå¾ªç¯è¦ç¨å¿«äºforeachå¾ªç¯ï¼Œå› ä¸ºè¿è¡Œæ—¶å°‘äº†ä¸€å±‚ä¸­é—´è°ƒç”¨ã€‚</p>

<ol>
  <li>
    <p>ArrayAccessç•Œé¢
éƒ¨ç½²ArrayAccessç•Œé¢ï¼Œå¯ä»¥ä½¿å¾—objectåƒarrayé‚£æ ·æ“ä½œã€‚ArrayAccessç•Œé¢åŒ…å«å››ä¸ªå¿…é¡»éƒ¨ç½²çš„æ–¹æ³•ï¼š</p>

    <ul>
      <li>
        <p>offsetExists($offset)</p>

        <p>This method is used to tell php if there is a value
for the key specified by offset. It should return 
true or false.</p>
      </li>
      <li>
        <p>offsetGet($offset)</p>

        <p>This method is used to return the value specified 
by the key offset.</p>
      </li>
      <li>
        <p>offsetSet($offset, $value)</p>

        <p>This method is used to set a value within the object, 
you can throw an exception from this function for a 
read-only collection.</p>
      </li>
      <li>
        <p>offsetUnset($offset)</p>

        <p>This method is used when a value is removed from 
an array either through unset() or assigning the key 
a value of null. In the case of numerical arrays, this 
offset should not be deleted and the array should 
not be reindexed unless that is specifically the 
behavior you want.</p>
      </li>
    </ul>
  </li>
</ol>

<p>ä¸‹é¢å°±æ˜¯ä¸€ä¸ªéƒ¨ç½²ArrayAccessç•Œé¢çš„å®ä¾‹ï¼š</p>

<p>/**</p>
<ul>
  <li>A class that can be used like an array
*/
class Article implements ArrayAccess {</li>
</ul>

<p>public $title;</p>

<p>public $author;</p>

<p>public $category;</p>

<p>function __construct($title,$author,$category) {
   $this-&gt;title = $title;
   $this-&gt;author = $author;
   $this-&gt;category = $category;
 }</p>

<p>/**</p>
<ul>
  <li>Defined by ArrayAccess interface</li>
  <li>Set a value given itâ€™s key e.g. $A[â€˜titleâ€™] = â€˜fooâ€™;</li>
  <li>@param mixed key (string or integer)</li>
  <li>@param mixed value</li>
  <li>@return void
 */
 function offsetSet($key, $value) {
if ( array_key_exists($key,get_object_vars($this)) ) {
  $this-&gt;{$key} = $value;
}
 }</li>
</ul>

<p>/**</p>
<ul>
  <li>Defined by ArrayAccess interface</li>
  <li>Return a value given itâ€™s key e.g. echo $A[â€˜titleâ€™];</li>
  <li>@param mixed key (string or integer)</li>
  <li>@return mixed value
 */
 function offsetGet($key) {
if ( array_key_exists($key,get_object_vars($this)) ) {
  return $this-&gt;{$key};
}
 }</li>
</ul>

<p>/**</p>
<ul>
  <li>Defined by ArrayAccess interface</li>
  <li>Unset a value by itâ€™s key e.g. unset($A[â€˜titleâ€™]);</li>
  <li>@param mixed key (string or integer)</li>
  <li>@return void
 */
 function offsetUnset($key) {
if ( array_key_exists($key,get_object_vars($this)) ) {
  unset($this-&gt;{$key});
}
 }</li>
</ul>

<p>/**</p>
<ul>
  <li>Defined by ArrayAccess interface</li>
  <li>Check value exists, given itâ€™s key e.g. isset($A[â€˜titleâ€™])</li>
  <li>@param mixed key (string or integer)</li>
  <li>@return boolean
 */
 function offsetExists($offset) {
return array_key_exists($offset,get_object_vars($this));
 }</li>
</ul>

<p>}</p>

<p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<p>// Create the object
$A = new Article(â€˜SPL Rocksâ€™,â€™Joe Bloggsâ€™, â€˜PHPâ€™);</p>

<p>// Check what it looks like
echo â€˜Initial State:&lt;div&gt;â€™;
print_r($A);
echo â€˜&lt;/div&gt;â€™;</p>

<p>// Change the title using array syntax
$A[â€˜titleâ€™] = â€˜SPL <em>really</em> rocksâ€™;</p>

<p>// Try setting a non existent property (ignored)
$A[â€˜not foundâ€™] = 1;</p>

<p>// Unset the author field
unset($A[â€˜authorâ€™]);</p>

<p>// Check what it looks like again
echo â€˜Final State:&lt;div&gt;â€™;
print_r($A);
echo â€˜&lt;/div&gt;â€™;</p>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>

<p>Initial State:</p>

<p>Article Object
(
   [title] =&gt; SPL Rocks
   [author] =&gt; Joe Bloggs
   [category] =&gt; PHP
)</p>

<p>Final State:</p>

<p>Article Object
(
   [title] =&gt; SPL <em>really</em> rocks
   [category] =&gt; PHP
)</p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œ$Aè™½ç„¶æ˜¯ä¸€ä¸ªobjectï¼Œä½†æ˜¯å®Œå…¨å¯ä»¥åƒarrayé‚£æ ·æ“ä½œã€‚</p>

<p>ä½ è¿˜å¯ä»¥åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå¢åŠ ç¨‹åºå†…éƒ¨çš„é€»è¾‘ï¼š</p>

<p>function offsetGet($key) {
   if ( array_key_exists($key,get_object_vars($this)) ) {
     return strtolower($this-&gt;{$key});
   }
 }</p>

<ol>
  <li>IteratorAggregateç•Œé¢</li>
</ol>

<p>ä½†æ˜¯ï¼Œè™½ç„¶$Aå¯ä»¥åƒæ•°ç»„é‚£æ ·æ“ä½œï¼Œå´æ— æ³•ä½¿ç”¨foreachéå†ï¼Œé™¤ééƒ¨ç½²äº†å‰é¢æåˆ°çš„Iteratorç•Œé¢ã€‚</p>

<p>å¦ä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯ï¼Œæœ‰æ—¶ä¼šéœ€è¦å°†æ•°æ®å’Œéå†éƒ¨åˆ†åˆ†å¼€ï¼Œè¿™æ—¶å°±å¯ä»¥éƒ¨ç½²IteratorAggregateç•Œé¢ã€‚å®ƒè§„å®šäº†ä¸€ä¸ªgetIterator()æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªä½¿ç”¨Iteratorç•Œé¢çš„objectã€‚</p>

<p>è¿˜æ˜¯ä»¥ä¸Šä¸€èŠ‚çš„Articleç±»ä¸ºä¾‹ï¼š</p>

<p>class Article implements ArrayAccess, IteratorAggregate {</p>

<p>/**</p>
<ul>
  <li>Defined by IteratorAggregate interface</li>
  <li>Returns an iterator for for this object, for use with foreach</li>
  <li>@return ArrayIterator
 */
 function getIterator() {
return new ArrayIterator($this);
 }</li>
</ul>

<p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<p>$A = new Article(â€˜SPL Rocksâ€™,â€™Joe Bloggsâ€™, â€˜PHPâ€™);</p>

<p>// Loop (getIterator will be called automatically)
echo â€˜Looping with foreach:&lt;div&gt;â€™;
foreach ( $A as $field =&gt; $value ) {
 echo â€œ$field : $value<br />â€;
}
echo â€˜&lt;/div&gt;â€™;</p>

<p>// Get the size of the iterator (see how many properties are left)
echo â€œObject has â€œ.sizeof($A-&gt;getIterator()).â€ elementsâ€;</p>

<p>æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š</p>

<p>Looping with foreach:</p>

<p>title : SPL Rocks
author : Joe Bloggs
category : PHP</p>

<p>Object has 3 elements</p>

<ol>
  <li>RecursiveIteratorç•Œé¢</li>
</ol>

<p>è¿™ä¸ªç•Œé¢ç”¨äºéå†å¤šå±‚æ•°æ®ï¼Œå®ƒç»§æ‰¿äº†Iteratorç•Œé¢ï¼Œå› è€Œä¹Ÿå…·æœ‰æ ‡å‡†çš„current()ã€key()ã€next()ã€ rewind()å’Œvalid()æ–¹æ³•ã€‚åŒæ—¶ï¼Œå®ƒè‡ªå·±è¿˜è§„å®šäº†getChildren()å’ŒhasChildren()æ–¹æ³•ã€‚The getChildren() method must return an object that implements RecursiveIterator.</p>

<ol>
  <li>SeekableIteratorç•Œé¢</li>
</ol>

<p>SeekableIteratorç•Œé¢ä¹Ÿæ˜¯Iteratorç•Œé¢çš„å»¶ä¼¸ï¼Œé™¤äº†Iteratorçš„5ä¸ªæ–¹æ³•ä»¥å¤–ï¼Œè¿˜è§„å®šäº†seek()æ–¹æ³•ï¼Œå‚æ•°æ˜¯å…ƒç´ çš„ä½ç½®ï¼Œè¿”å›è¯¥å…ƒç´ ã€‚å¦‚æœè¯¥ä½ç½®ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºOutOfBoundsExceptionã€‚</p>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ˜¯å®ä¾‹ï¼š</p>

<p>&lt;?php</p>

<p>class PartyMemberIterator implements SeekableIterator
{
    public function __construct(PartyMember $member)
    {
        // Store $member locally for iteration
    }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public function seek($index)
{
    $this-&gt;rewind();
    $position = 0;

    while ($position &lt; $index &amp;&amp; $this-&gt;valid()) {
        $this-&gt;next();
        $position++;
    }

    if (!$this-&gt;valid()) {
        throw new OutOfBoundsException('Invalid position');
    }
}

// Implement current(), key(), next(), rewind()
// and valid() to iterate over data in $member }
</code></pre></div></div>

<p>?&gt;</p>

<ol>
  <li>Countableç•Œé¢</li>
</ol>

<p>è¿™ä¸ªç•Œé¢è§„å®šäº†ä¸€ä¸ªcount()æ–¹æ³•ï¼Œè¿”å›ç»“æœé›†çš„æ•°é‡ã€‚</p>

<p>ç¬¬ä¸‰éƒ¨åˆ† SPL Classes</p>

<ol>
  <li>SPLçš„å†…ç½®ç±»</li>
</ol>

<p>SPLé™¤äº†å®šä¹‰ä¸€ç³»åˆ—Interfacesä»¥å¤–ï¼Œè¿˜æä¾›ä¸€ç³»åˆ—çš„å†…ç½®ç±»ï¼Œå®ƒä»¬å¯¹åº”ä¸åŒçš„ä»»åŠ¡ï¼Œå¤§å¤§ç®€åŒ–äº†ç¼–ç¨‹ã€‚</p>

<p>æŸ¥çœ‹æ‰€æœ‰çš„å†…ç½®ç±»ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼š</p>

<p>&lt;?php
// a simple foreach() to traverse the SPL class names
foreach(spl_classes() as $key=&gt;$value)
        {
        echo $key.â€™ -&gt; â€˜.$value.â€™<br />â€™;
        }
?&gt;</p>

<ol>
  <li>DirectoryIteratorç±»</li>
</ol>

<p>è¿™ä¸ªç±»ç”¨æ¥æŸ¥çœ‹ä¸€ä¸ªç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ï¼š</p>

<p>&lt;?php</p>

<p>try{
  /<strong>* class create new DirectoryIterator Object **<em>/
    foreach ( new DirectoryIterator(â€˜./â€™) as $Item )
        {
        echo $Item.â€™<br />â€™;
        }
    }
/</em></strong> if an exception is thrown, catch it here ***/
catch(Exception $e){
    echo â€˜No files Found!<br />â€™;
}
?&gt;</p>

<p>æŸ¥çœ‹æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>

<table>
<?php

foreach(new DirectoryIterator('./' ) as $file )
    {
    if( $file->getFilename()  == 'foo.txt' )
        {
        echo '<tr><td>getFilename()</td><td> '; var_dump($file->getFilename()); echo '</td></tr>';
    echo '<tr><td>getBasename()</td><td> '; var_dump($file->getBasename()); echo '</td></tr>';
        echo '<tr><td>isDot()</td><td> '; var_dump($file->isDot()); echo '</td></tr>';
        echo '<tr><td>__toString()</td><td> '; var_dump($file->__toString()); echo '</td></tr>';
        echo '<tr><td>getPath()</td><td> '; var_dump($file->getPath()); echo '</td></tr>';
        echo '<tr><td>getPathname()</td><td> '; var_dump($file->getPathname()); echo '</td></tr>';
        echo '<tr><td>getPerms()</td><td> '; var_dump($file->getPerms()); echo '</td></tr>';
        echo '<tr><td>getInode()</td><td> '; var_dump($file->getInode()); echo '</td></tr>';
        echo '<tr><td>getSize()</td><td> '; var_dump($file->getSize()); echo '</td></tr>';
        echo '<tr><td>getOwner()</td><td> '; var_dump($file->getOwner()); echo '</td></tr>';
        echo '<tr><td>$file->getGroup()</td><td> '; var_dump($file->getGroup()); echo '</td></tr>';
        echo '<tr><td>getATime()</td><td> '; var_dump($file->getATime()); echo '</td></tr>';
        echo '<tr><td>getMTime()</td><td> '; var_dump($file->getMTime()); echo '</td></tr>';
        echo '<tr><td>getCTime()</td><td> '; var_dump($file->getCTime()); echo '</td></tr>';
        echo '<tr><td>getType()</td><td> '; var_dump($file->getType()); echo '</td></tr>';
        echo '<tr><td>isWritable()</td><td> '; var_dump($file->isWritable()); echo '</td></tr>';
        echo '<tr><td>isReadable()</td><td> '; var_dump($file->isReadable()); echo '</td></tr>';
        echo '<tr><td>isExecutable(</td><td> '; var_dump($file->isExecutable()); echo '</td></tr>';
        echo '<tr><td>isFile()</td><td> '; var_dump($file->isFile()); echo '</td></tr>';
        echo '<tr><td>isDir()</td><td> '; var_dump($file->isDir()); echo '</td></tr>';
        echo '<tr><td>isLink()</td><td> '; var_dump($file->isLink()); echo '</td></tr>';
        echo '<tr><td>getFileInfo()</td><td> '; var_dump($file->getFileInfo()); echo '</td></tr>';
        echo '<tr><td>getPathInfo()</td><td> '; var_dump($file->getPathInfo()); echo '</td></tr>';
        echo '<tr><td>openFile()</td><td> '; var_dump($file->openFile()); echo '</td></tr>';
        echo '<tr><td>setFileClass()</td><td> '; var_dump($file->setFileClass()); echo '</td></tr>';
        echo '<tr><td>setInfoClass()</td><td> '; var_dump($file->setInfoClass()); echo '</td></tr>';
        }
}
?>
</table>

<p>é™¤äº†foreachå¾ªç¯å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨whileå¾ªç¯ï¼š</p>

<p>&lt;?php
/<em>** create a new iterator object **</em>/
$it = new DirectoryIterator(â€˜./â€™);</p>

<p>/<strong>* loop directly over the object **<em>/
while($it-&gt;valid())
    {
    echo $it-&gt;key().â€™ â€“ â€˜.$it-&gt;current().â€™<br />â€™;
    /</em></strong> move to the next iteration ***/
    $it-&gt;next();
    }
?&gt;</p>

<p>å¦‚æœè¦è¿‡æ»¤æ‰€æœ‰å­ç›®å½•ï¼Œå¯ä»¥åœ¨valid()æ–¹æ³•ä¸­è¿‡æ»¤ï¼š</p>

<p>&lt;?php
/<em>** create a new iterator object **</em>/
$it = new DirectoryIterator(â€˜./â€™);</p>

<p>/<strong>* loop directly over the object **<em>/
while($it-&gt;valid())
        {
        /</em></strong> check if value is a directory <strong><em>/
        if($it-&gt;isDir())
                {
                /</em></strong> echo the key and current value <strong><em>/
                echo $it-&gt;key().â€™ â€“ â€˜.$it-&gt;current().â€™<br />â€™;
                }
        /</em></strong> move to the next iteration ***/
        $it-&gt;next();
        }
?&gt;</p>

<ol>
  <li>ArrayObjectç±»</li>
</ol>

<p>è¿™ä¸ªç±»å¯ä»¥å°†Arrayè½¬åŒ–ä¸ºobjectã€‚</p>

<p>&lt;?php</p>

<p>/<em>** a simple array **</em>/
$array = array(â€˜koalaâ€™, â€˜kangarooâ€™, â€˜wombatâ€™, â€˜wallabyâ€™, â€˜emuâ€™, â€˜kiwiâ€™, â€˜kookaburraâ€™, â€˜platypusâ€™);</p>

<p>/<em>** create the array object **</em>/
$arrayObj = new ArrayObject($array);</p>

<p>/<strong>* iterate over the array **<em>/
for($iterator = $arrayObj-&gt;getIterator();
   /</em></strong> check if valid <strong><em>/
   $iterator-&gt;valid();
   /</em></strong> move to the next array member <strong><em>/
   $iterator-&gt;next())
    {
    /</em></strong> output the key and current array value ***/
    echo $iterator-&gt;key() . â€˜ =&gt; â€˜ . $iterator-&gt;current() . â€˜<br />â€™;
    }
?&gt;</p>

<p>å¢åŠ ä¸€ä¸ªå…ƒç´ ï¼š</p>

<p>$arrayObj-&gt;append(â€˜dingoâ€™);</p>

<p>å¯¹å…ƒç´ æ’åºï¼š</p>

<p>$arrayObj-&gt;natcasesort();</p>

<p>æ˜¾ç¤ºå…ƒç´ çš„æ•°é‡ï¼š</p>

<p>echo $arrayObj-&gt;count();</p>

<p>åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼š</p>

<p>$arrayObj-&gt;offsetUnset(5);</p>

<p>æŸä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ï¼š</p>

<p>if ($arrayObj-&gt;offsetExists(3))
    {
       echo â€˜Offset Exists<br />â€™;
    }</p>

<p>æ›´æ”¹æŸä¸ªä½ç½®çš„å…ƒç´ å€¼ï¼š</p>

<p>$arrayObj-&gt;offsetSet(5, â€œgalahâ€);</p>

<p>æ˜¾ç¤ºæŸä¸ªä½ç½®çš„å…ƒç´ å€¼ï¼š</p>

<p>echo $arrayObj-&gt;offsetGet(4);</p>

<ol>
  <li>ArrayIteratorç±»
è¿™ä¸ªç±»å®é™…ä¸Šæ˜¯å¯¹ArrayObjectç±»çš„è¡¥å……ï¼Œä¸ºåè€…æä¾›éå†åŠŸèƒ½ã€‚</li>
</ol>

<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<p>&lt;?php
/<em>** a simple array **</em>/
$array = array(â€˜koalaâ€™, â€˜kangarooâ€™, â€˜wombatâ€™, â€˜wallabyâ€™, â€˜emuâ€™, â€˜kiwiâ€™, â€˜kookaburraâ€™, â€˜platypusâ€™);</p>

<p>try {
    $object = new ArrayIterator($array);
    foreach($object as $key=&gt;$value)
        {
        echo $key.â€™ =&gt; â€˜.$value.â€™<br />â€™;
        }
    }
catch (Exception $e)
    {
    echo $e-&gt;getMessage();
    }
?&gt;</p>

<p>ArrayIteratorç±»ä¹Ÿæ”¯æŒoffsetç±»æ–¹æ³•å’Œcount()æ–¹æ³•ï¼š</p>

<ul>
<?php
/*** a simple array ***/
$array = array('koala', 'kangaroo', 'wombat', 'wallaby', 'emu', 'kiwi', 'kookaburra', 'platypus');

try {
    $object = new ArrayIterator($array);
    /*** check for the existence of the offset 2 ***/
    if($object->offSetExists(2))
    {
    /*** set the offset of 2 to a new value ***/
    $object->offSetSet(2, 'Goanna');
    }
   /*** unset the kiwi ***/
   foreach($object as $key=>$value)
        {
        /*** check the value of the key ***/
        if($object->offSetGet($key) === 'kiwi')
            {
            /*** unset the current key ***/
            $object->offSetUnset($key);
            }
        echo '<li>'.$key.' - '.$value.'</li>'."\n";
        }
    }
catch (Exception $e)
    {
    echo $e->getMessage();
    }
?>
</ul>

<ol>
  <li>RecursiveArrayIteratorç±»å’ŒRecursiveIteratorIteratorç±»</li>
</ol>

<p>ArrayIteratorç±»å’ŒArrayObjectç±»ï¼Œåªæ”¯æŒéå†ä¸€ç»´æ•°ç»„ã€‚å¦‚æœè¦éå†å¤šç»´æ•°ç»„ï¼Œå¿…é¡»å…ˆç”¨RecursiveIteratorIteratorç”Ÿæˆä¸€ä¸ªIteratorï¼Œç„¶åå†å¯¹è¿™ä¸ªIteratorä½¿ç”¨RecursiveIteratorIteratorã€‚</p>

<p>&lt;?php
$array = array(
    array(â€˜nameâ€™=&gt;â€™butchâ€™, â€˜sexâ€™=&gt;â€™mâ€™, â€˜breedâ€™=&gt;â€™boxerâ€™),
    array(â€˜nameâ€™=&gt;â€™fidoâ€™, â€˜sexâ€™=&gt;â€™mâ€™, â€˜breedâ€™=&gt;â€™dobermanâ€™),
    array(â€˜nameâ€™=&gt;â€™girlyâ€™,â€™sexâ€™=&gt;â€™fâ€™, â€˜breedâ€™=&gt;â€™poodleâ€™)
);</p>

<p>foreach(new RecursiveIteratorIterator(new RecursiveArrayIterator($array)) as $key=&gt;$value)
    {
    echo $key.â€™ â€“ â€˜.$value.â€™<br />â€™;
    }
?&gt;</p>

<ol>
  <li>FilterIteratorç±»</li>
</ol>

<p>FilterIteratorç±»å¯ä»¥å¯¹å…ƒç´ è¿›è¡Œè¿‡æ»¤ï¼Œåªè¦åœ¨accept()æ–¹æ³•ä¸­è®¾ç½®è¿‡æ»¤æ¡ä»¶å°±å¯ä»¥äº†ã€‚</p>

<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<p>&lt;?php
/<em>** a simple array **</em>/
$animals = array(â€˜koalaâ€™, â€˜kangarooâ€™, â€˜wombatâ€™, â€˜wallabyâ€™, â€˜emuâ€™, â€˜NZâ€™=&gt;â€™kiwiâ€™, â€˜kookaburraâ€™, â€˜platypusâ€™);</p>

<p>class CullingIterator extends FilterIterator{</p>

<p>/<em>** The filteriterator takes  a iterator as param: **</em>/
public function __construct( Iterator $it ){
  parent::__construct( $it );
}</p>

<p>/<em>** check if key is numeric **</em>/
function accept(){
  return is_numeric($this-&gt;key());
}</p>

<p>}/<em>** end of class **</em>/
$cull = new CullingIterator(new ArrayIterator($animals));</p>

<p>foreach($cull as $key=&gt;$value)
    {
    echo $key.â€™ == â€˜.$value.â€™<br />â€™;
    }
?&gt;</p>

<p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªè¿”å›è´¨æ•°çš„ä¾‹å­ï¼š</p>

<p>&lt;?php</p>

<p>class PrimeFilter extends FilterIterator{</p>

<p>/<em>** The filteriterator takes  a iterator as param: **</em>/
public function __construct(Iterator $it){
  parent::__construct($it);
}</p>

<p>/<em>** check if current value is prime **</em>/
function accept(){
if($this-&gt;current() % 2 != 1)
    {
    return false;
    }
$d = 3;
$x = sqrt($this-&gt;current());
while ($this-&gt;current() % $d != 0 &amp;&amp; $d &lt; $x)
    {
    $d += 2;
    }
 return (($this-&gt;current() % $d == 0 &amp;&amp; $this-&gt;current() != $d) * 1) == 0 ? true : false;
}</p>

<p>}/<em>** end of class **</em>/</p>

<p>/<em>** an array of numbers **</em>/
$numbers = range(212345,212456);</p>

<p>/<em>** create a new FilterIterator object **</em>/
$primes = new primeFilter(new ArrayIterator($numbers));</p>

<p>foreach($primes as $value)
    {
    echo $value.â€™ is prime.<br />â€™;
    }
?&gt;</p>

<ol>
  <li>SimpleXMLIteratorç±»</li>
</ol>

<p>è¿™ä¸ªç±»ç”¨æ¥éå†xmlæ–‡ä»¶ã€‚</p>

<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<p>&lt;?php</p>

<p>/<em>** a simple xml tree **</em>/
 $xmlstring = Â«&lt;XML
&lt;?xml version = â€œ1.0â€ encoding=â€UTF-8â€ standalone=â€yesâ€?&gt;</p>
<document>
  <animal>
    <category id="26">
      <species>Phascolarctidae</species>
      <type>koala</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="27">
      <species>macropod</species>
      <type>kangaroo</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="28">
      <species>diprotodon</species>
      <type>wombat</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="31">
      <species>macropod</species>
      <type>wallaby</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="21">
      <species>dromaius</species>
      <type>emu</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="22">
      <species>Apteryx</species>
      <type>kiwi</type>
      <name>Troy</name>
    </category>
  </animal>
  <animal>
    <category id="23">
      <species>kingfisher</species>
      <type>kookaburra</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="48">
      <species>monotremes</species>
      <type>platypus</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="4">
      <species>arachnid</species>
      <type>funnel web</type>
      <name>Bruce</name>
      <legs>8</legs>
    </category>
  </animal>
</document>
<p>XML;</p>

<p>/<strong>* a new simpleXML iterator object **<em>/
try    {
       /</em></strong> a new simple xml iterator <strong><em>/
       $it = new SimpleXMLIterator($xmlstring);
       /</em></strong> a new limitIterator object ***/
       foreach(new RecursiveIteratorIterator($it,1) as $name =&gt; $data)
          {
          echo $name.â€™ â€“ â€˜.$data.â€™<br />â€™;
          }
    }
catch(Exception $e)
    {
    echo $e-&gt;getMessage();
    }
?&gt;</p>

<p>new RecursiveIteratorIterator($it,1)è¡¨ç¤ºæ˜¾ç¤ºæ‰€æœ‰åŒ…æ‹¬çˆ¶å…ƒç´ åœ¨å†…çš„å­å…ƒç´ ã€‚</p>

<p>æ˜¾ç¤ºæŸä¸€ä¸ªç‰¹å®šçš„å…ƒç´ å€¼ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>

<p>&lt;?php
try {
    /<em>** a new simpleXML iterator object **</em>/
    $sxi =  new SimpleXMLIterator($xmlstring);</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foreach ( $sxi as $node )
    {
    foreach($node as $k=&gt;$v)
        {
        echo $v-&gt;species.'&lt;br /&gt;';
        }
    }
} catch(Exception $e)
{
echo $e-&gt;getMessage();
} ?&gt;
</code></pre></div></div>

<p>ç›¸å¯¹åº”çš„whileå¾ªç¯å†™æ³•ä¸ºï¼š</p>

<p>&lt;?php</p>

<p>try {
$sxe = simplexml_load_string($xmlstring, â€˜SimpleXMLIteratorâ€™);</p>

<p>for ($sxe-&gt;rewind(); $sxe-&gt;valid(); $sxe-&gt;next())
    {
    if($sxe-&gt;hasChildren())
        {
        foreach($sxe-&gt;getChildren() as $element=&gt;$value)
          {
          echo $value-&gt;species.â€™<br />â€™;
          }
        }
     }
   }
catch(Exception $e)
   {
   echo $e-&gt;getMessage();
   }
?&gt;</p>

<p>æœ€æ–¹ä¾¿çš„å†™æ³•ï¼Œè¿˜æ˜¯ä½¿ç”¨xpathï¼š</p>

<p>&lt;?php
try {
    /<em>** a new simpleXML iterator object **</em>/
    $sxi =  new SimpleXMLIterator($xmlstring);</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*** set the xpath ***/
$foo = $sxi-&gt;xpath('animal/category/species');

/*** iterate over the xpath ***/
foreach ($foo as $k=&gt;$v)
    {
    echo $v.'&lt;br /&gt;';
    }
} catch(Exception $e)
{
echo $e-&gt;getMessage();
} ?&gt;
</code></pre></div></div>

<p>ä¸‹é¢çš„ä¾‹å­ï¼Œæ˜¾ç¤ºæœ‰namespaceçš„æƒ…å†µï¼š</p>

<p>&lt;?php</p>

<p>/<em>** a simple xml tree **</em>/
 $xmlstring = Â«&lt;XML
&lt;?xml version = â€œ1.0â€ encoding=â€UTF-8â€ standalone=â€yesâ€?&gt;</p>
<document xmlns:spec="http://example.org/animal-species">
  <animal>
    <category id="26">
      <species>Phascolarctidae</species>
      <spec:name>Speed Hump</spec:name>
      <type>koala</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="27">
      <species>macropod</species>
      <spec:name>Boonga</spec:name>
      <type>kangaroo</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="28">
      <species>diprotodon</species>
      <spec:name>pot holer</spec:name>
      <type>wombat</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="31">
      <species>macropod</species>
      <spec:name>Target</spec:name>
      <type>wallaby</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="21">
      <species>dromaius</species>
      <spec:name>Road Runner</spec:name>
      <type>emu</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="22">
      <species>Apteryx</species>
      <spec:name>Football</spec:name>
      <type>kiwi</type>
      <name>Troy</name>
    </category>
  </animal>
  <animal>
    <category id="23">
      <species>kingfisher</species>
      <spec:name>snaker</spec:name>
      <type>kookaburra</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="48">
      <species>monotremes</species>
      <spec:name>Swamp Rat</spec:name>
      <type>platypus</type>
      <name>Bruce</name>
    </category>
  </animal>
  <animal>
    <category id="4">
      <species>arachnid</species>
      <spec:name>Killer</spec:name>
      <type>funnel web</type>
      <name>Bruce</name>
      <legs>8</legs>
    </category>
  </animal>
</document>
<p>XML;</p>

<p>/<strong>* a new simpleXML iterator object **<em>/
try {
    /</em></strong> a new simpleXML iterator object ***/
    $sxi =  new SimpleXMLIterator($xmlstring);</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$sxi-&gt; registerXPathNamespace('spec', 'http://www.exampe.org/species-title');

/*** set the xpath ***/
$result = $sxi-&gt;xpath('//spec:name');

/*** get all declared namespaces ***/    foreach($sxi-&gt;getDocNamespaces('animal') as $ns)
    {
    echo $ns.'&lt;br /&gt;';
    }

/*** iterate over the xpath ***/
foreach ($result as $k=&gt;$v)
    {
    echo $v.'&lt;br /&gt;';
    }
} catch(Exception $e)
{
echo $e-&gt;getMessage();
} ?&gt;
</code></pre></div></div>

<p>å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼š</p>

<p>&lt;?php 
 $xmlstring = Â«&lt;XML
&lt;?xml version = â€œ1.0â€ encoding=â€UTF-8â€ standalone=â€yesâ€?&gt;</p>
<document>
  <animal>koala</animal>
  <animal>kangaroo</animal>
  <animal>wombat</animal>
  <animal>wallaby</animal>
  <animal>emu</animal>
  <animal>kiwi</animal>
  <animal>kookaburra</animal>
  <animal>platypus</animal>
  <animal>funnel web</animal>
</document>
<p>XML;</p>

<p>try {
    /<em>** a new simpleXML iterator object **</em>/
    $sxi =  new SimpleXMLIterator($xmlstring);</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*** add a child ***/
$sxi-&gt;addChild('animal', 'Tiger');

/*** a new simpleXML iterator object ***/
$new = new SimpleXmlIterator($sxi-&gt;saveXML());

/*** iterate over the new tree ***/
foreach($new as $val)
    {
    echo $val.'&lt;br /&gt;';
    }
} catch(Exception $e)
{
echo $e-&gt;getMessage();
} ?&gt;
</code></pre></div></div>

<p>å¢åŠ å±æ€§ï¼š</p>

<p>&lt;?php 
$xmlstring =Â«&lt;XML
&lt;?xml version = â€œ1.0â€ encoding=â€UTF-8â€ standalone=â€yesâ€?&gt;</p>
<document>
  <animal>koala</animal>
  <animal>kangaroo</animal>
  <animal>wombat</animal>
  <animal>wallaby</animal>
  <animal>emu</animal>
  <animal>kiwi</animal>
  <animal>kookaburra</animal>
  <animal>platypus</animal>
  <animal>funnel web</animal>
</document>
<p>XML;</p>

<p>try {
    /<em>** a new simpleXML iterator object **</em>/
    $sxi =  new SimpleXMLIterator($xmlstring);</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*** add an attribute with a namespace ***/
$sxi-&gt;addAttribute('id:att1', 'good things', 'urn::test-foo');

/*** add an attribute without a  namespace ***/
$sxi-&gt;addAttribute('att2', 'no-ns');

echo htmlentities($sxi-&gt;saveXML());
} catch(Exception $e)
{
echo $e-&gt;getMessage();
} ?&gt;
</code></pre></div></div>

<ol>
  <li>CachingIteratorç±»</li>
</ol>

<p>è¿™ä¸ªç±»æœ‰ä¸€ä¸ªhasNext()æ–¹æ³•ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p>

<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<p>&lt;?php
/<em>** a simple array **</em>/
$array = array(â€˜koalaâ€™, â€˜kangarooâ€™, â€˜wombatâ€™, â€˜wallabyâ€™, â€˜emuâ€™, â€˜kiwiâ€™, â€˜kookaburraâ€™, â€˜platypusâ€™);</p>

<p>try {
    /<em>** create a new object **</em>/
    $object = new CachingIterator(new ArrayIterator($array));
    foreach($object as $value)
        {
        echo $value;
        if($object-&gt;hasNext())
            {
            echo â€˜,â€™;
            }
        }
    }
catch (Exception $e)
    {
    echo $e-&gt;getMessage();
    }
?&gt;</p>

<ol>
  <li>LimitIteratorç±»</li>
</ol>

<p>è¿™ä¸ªç±»ç”¨æ¥é™å®šè¿”å›ç»“æœé›†çš„æ•°é‡å’Œä½ç½®ï¼Œå¿…é¡»æä¾›offsetå’Œlimitä¸¤ä¸ªå‚æ•°ï¼Œä¸SQLå‘½ä»¤ä¸­limitè¯­å¥ç±»ä¼¼ã€‚</p>

<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<p>&lt;?php
/<em>** the offset value **</em>/
$offset = 3;</p>

<p>/<em>** the limit of records to show **</em>/
$limit = 2;</p>

<p>$array = array(â€˜koalaâ€™, â€˜kangarooâ€™, â€˜wombatâ€™, â€˜wallabyâ€™, â€˜emuâ€™, â€˜kiwiâ€™, â€˜kookaburraâ€™, â€˜platypusâ€™);</p>

<p>$it = new LimitIterator(new ArrayIterator($array), $offset, $limit);</p>

<p>foreach($it as $k=&gt;$v)
    {
    echo $it-&gt;getPosition().â€™<br />â€™;
    }
?&gt;</p>

<p>å¦ä¸€ä¸ªä¾‹å­æ˜¯ï¼š</p>

<p>&lt;?php</p>

<p>/<em>** a simple array **</em>/
$array = array(â€˜koalaâ€™, â€˜kangarooâ€™, â€˜wombatâ€™, â€˜wallabyâ€™, â€˜emuâ€™, â€˜kiwiâ€™, â€˜kookaburraâ€™, â€˜platypusâ€™);</p>

<p>$it = new LimitIterator(new ArrayIterator($array));</p>

<p>try
    {
    $it-&gt;seek(5);
    echo $it-&gt;current();
    }
catch(OutOfBoundsException $e)
    {
    echo $e-&gt;getMessage() . â€œ<br />â€;
    }
?&gt;</p>

<ol>
  <li>SplFileObjectç±»</li>
</ol>

<p>è¿™ä¸ªç±»ç”¨æ¥å¯¹æ–‡æœ¬æ–‡ä»¶è¿›è¡Œéå†ã€‚</p>

<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<p>&lt;?php</p>

<p>try{
    // iterate directly over the object
    foreach( new SplFileObject("/usr/local/apache/logs/access_log") as $line)
    // and echo each line of the file
    echo $line.â€™<br />â€™;
}
catch (Exception $e)
    {
    echo $e-&gt;getMessage();
    }
?&gt;</p>

<p>è¿”å›æ–‡æœ¬æ–‡ä»¶çš„ç¬¬ä¸‰è¡Œï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>

<p>&lt;?php</p>

<p>try{
    $file = new SplFileObject(â€œ/usr/local/apache/logs/access_logâ€);</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$file-&gt;seek(3);

echo $file-&gt;current();
    } catch (Exception $e)
{
echo $e-&gt;getMessage();
} ?&gt;
</code></pre></div></div>

<p>[å‚è€ƒæ–‡çŒ®]</p>

<ol>
  <li>
    <p>Introduction to Standard PHP Library (SPL), By Kevin Waterson</p>
  </li>
  <li>
    <p>Introducing PHP 5â€™s Standard Library, By Harry Fuecks</p>
  </li>
  <li>
    <p>The Standard PHP Library (SPL), By Ben Ramsey</p>
  </li>
  <li>
    <p>SPL - Standard PHP Library Documentation</p>
  </li>
</ol>

<p>http://www.ruanyifeng.com/blog/2008/07/php_spl_notes.html</p>

<p>SPLï¼ŒPHP æ ‡å‡†åº“ï¼ˆStandard PHP Libraryï¼‰ ï¼Œä» PHP 5.0 èµ·å†…ç½®çš„ç»„ä»¶å’Œæ¥å£ï¼Œå¹¶ä¸”ä» PHP5.3 å·²é€æ¸çš„æˆç†Ÿã€‚SPL å…¶å®åœ¨æ‰€æœ‰çš„ PHP5 å¼€å‘ç¯å¢ƒä¸­è¢«å†…ç½®ï¼ŒåŒæ—¶æ— éœ€ä»»ä½•è®¾ç½®ã€‚</p>

<p>ä¼¼ä¹ä¼—å¤šçš„ PHP å¼€å‘äººå‘˜åŸºæœ¬æ²¡æœ‰ä½¿ç”¨å®ƒï¼Œç”šè‡³é—»æ‰€æœªé—»ã€‚ç©¶å…¶åŸå› ï¼Œå¯ä»¥è¿½è¿°åˆ°å®ƒé‚£é˜³æ˜¥ç™½é›ªèˆ¬çš„è¯´æ˜æ–‡æ¡£ï¼Œä½¿ä½ å¿½ç•¥äº†ã€Œå®ƒçš„å­˜åœ¨ã€ã€‚SPL è¿™å—å®çŸ³çŠ¹å¦‚é“è¾¾å°¼çš„ã€Œæµ·æ´‹ä¹‹å¿ƒã€èˆ¬ï¼Œè¢«æ²‰å…¥æµ·åº•ã€‚è€Œç°åœ¨å®ƒåº”è¯¥è¢«æˆ‘ä»¬æèµ·ï¼Œå¹¶å°†å®ƒç©¿æˆ´åœ¨åº”æœ‰çš„ä½ç½® ï¼Œè€Œè¿™ä¹Ÿæ˜¯è¿™ç¯‡æ–‡ç« æ‰€è¦è¡¨è¿°çš„è§‚ç‚¹ã€‚</p>

<p>é‚£ä¹ˆï¼ŒSPL æä¾›äº†ä»€ä¹ˆï¼Ÿ</p>

<p>SPL å¯¹ PHP å¼•æ“è¿›è¡Œäº†æ‰©å±•ï¼Œä¾‹å¦‚ ArrayAccessã€Countable å’Œ SeekableIterator ç­‰æ¥å£ï¼Œå®ƒä»¬ç”¨äºä»¥æ•°ç»„å½¢å¼æ“ä½œå¯¹è±¡ã€‚åŒæ—¶ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ RecursiveIteratorã€ArrayObejcts ç­‰å…¶ä»–è¿­ä»£å™¨è¿›è¡Œæ•°æ®çš„è¿­ä»£æ“ä½œã€‚</p>

<p>å®ƒè¿˜å†…ç½®å‡ ä¸ªçš„å¯¹è±¡ä¾‹å¦‚ Exceptionsã€SplObserverã€Spltorage ä»¥åŠ splautoloadregisterã€splclassesã€iteratorapply ç­‰çš„å¸®åŠ©å‡½æ•°ï¼ˆhelper functionsï¼‰ï¼Œç”¨äºé‡è½½å¯¹åº”çš„åŠŸèƒ½ã€‚</p>

<p>è¿™äº›å·¥å…·èšåˆåœ¨ä¸€èµ·å°±å¥½æ¯”æ˜¯æŠŠå¤šåŠŸèƒ½çš„ç‘å£«å†›åˆ€ï¼Œå–„ç”¨å®ƒä»¬å¯ä»¥ä»è´¨ä¸Šæå‡ PHP çš„ä»£ç æ•ˆç‡ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•å‘æŒ¥å®ƒçš„å¨åŠ›ï¼Ÿ</p>

<p>é‡è½½ autoloader</p>

<p>å¦‚æœä½ æ˜¯ä½ã€Œæ•™ç§‘ä¹¦å¼çš„ç¨‹åºå‘˜ã€ï¼Œé‚£ä¹ˆä½ ä¿è¯äº†è§£å¦‚ä½•ä½¿ç”¨ __autoload å»ä»£æ›¿ includes/requires æ“ä½œæƒ°æ€§è½½å…¥å¯¹åº”çš„ç±»ï¼Œå¯¹ä¸ï¼Ÿ</p>

<p>ä½†ä¹…ä¹‹ï¼Œä½ ä¼šå‘ç°ä½ å·²ç»é™·å…¥äº†å›°å¢ƒï¼Œé¦–å…ˆæ˜¯ä½ è¦ä¿è¯ä½ çš„ç±»æ–‡ä»¶å¿…é¡»åœ¨æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„ä¸­ï¼Œä¾‹å¦‚åœ¨ Zend æ¡†æ¶ä¸­ä½ å¿…é¡»ä½¿ç”¨ã€Œ_ã€æ¥åˆ†å‰²ç±»ã€æ–¹æ³•åç§°ï¼ˆä½ å¦‚ä½•è§£å†³è¿™ä¸€é—®é¢˜ï¼Ÿï¼‰ã€‚</p>

<p>å¦å¤–çš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“é¡¹ç›®å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œ __autoloadå†…çš„é€»è¾‘ä¹Ÿä¼šå˜å¾—ç›¸åº”çš„å¤æ‚ã€‚åˆ°æœ€åï¼Œç”šè‡³ä½ ä¼šåŠ å…¥å¼‚å¸¸åˆ¤æ–­ï¼Œä»¥åŠå°†æ‰€æœ‰çš„è½½å…¥ç±»çš„é€»è¾‘å¦‚æ•°å†™åˆ°å…¶ä¸­ã€‚</p>

<p>å¤§å®¶éƒ½çŸ¥é“ã€Œé¸¡è›‹ä¸èƒ½æ”¾åˆ°ä¸€ä¸ªç¯®å­ä¸­ã€ï¼Œåˆ©ç”¨ SPL å¯ä»¥åˆ†ç¦» __autoloadçš„è½½å…¥é€»è¾‘ã€‚åªéœ€è¦å†™ä¸ªä½ è‡ªå·±çš„ autoload å‡½æ•°ï¼Œç„¶ååˆ©ç”¨ SPL æä¾›çš„å‡½æ•°é‡è½½å®ƒã€‚</p>

<p>ä¾‹å¦‚ä¸Šè¿° Zend æ¡†æ¶çš„é—®é¢˜ï¼Œä½ å¯ä»¥é‡è½½ Zend loader å¯¹åº”çš„æ–¹æ³•ï¼Œå¦‚æœå®ƒæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç±»ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ä½ å…ˆå‰å®šä¹‰çš„å‡½æ•°ã€‚</p>

<p>PHP SPLæ ‡å‡†åº“-æ¥å£
PHP SPLæ ‡å‡†åº“æœ‰ä¸€ä¸‹æ¥å£ï¼š</p>

<p>Countable
OuterIterator 
RecursiveIterator 
SeekableIterator
SplObserver 
SplSubject
ArrayObject
å…¶ä¸­OuterIteratorã€RecursiveIteratorã€SeekableIteratoréƒ½æ˜¯ç»§æ‰¿Iteratorç±»çš„ã€‚</p>

<p>Coutableæ¥å£ï¼š
å®ç°Coutableæ¥å£çš„å¯¹è±¡å¯ç”¨äº count() å‡½æ•°è®¡æ•°ã€‚</p>

<p>class Mycount implements Countable
{
    public function count()
    {
        static $count = 0;
        $count++;
        return $count;
    }
}</p>

<p>$count = new Mycount();
$count-&gt;count();
$count-&gt;count();</p>

<p>echo count($count); //3
echo count($count); //4
è¯´æ˜ï¼š</p>

<p>è°ƒç”¨ count() å‡½æ•°æ—¶ï¼ŒMycount::count() æ–¹æ³•è¢«è°ƒç”¨ï¼Œcount() å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å°†ä¸ä¼šäº§ç”Ÿå½±å“ã€‚</p>

<p>OuterIteratoræ¥å£ï¼š
å®ƒæ˜¯è‡ªå®šä¹‰æˆ–ä¿®æ”¹è¿­ä»£è¿‡ç¨‹ã€‚</p>

<p>// IteratorIteratoræ˜¯OuterIteratorçš„ä¸€ä¸ªå®ç°ç±»
class MyOuterIterator extends  IteratorIterator {
    public function current()
    {
        return parent::current() . â€˜TESTâ€™;
    }
}</p>

<p>foreach(new MyOuterIterator(new ArrayIterator([â€˜bâ€™,â€™aâ€™,â€™câ€™])) as $key =&gt; $value) {
    echo â€œ$key-&gt;$valueâ€.PHP_EOL;
}</p>

<p>/*
ç»“æœï¼š
0-&gt;bTEST
1-&gt;aTEST
2-&gt;cTEST
*/
åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒOuterIteratoréå¸¸æœ‰ç”¨ï¼š</p>

<p>$db = new PDO(â€˜mysql:host=localhost;dbname=testâ€™, â€˜rootâ€™, â€˜mckeeâ€™);
$db-&gt;query(â€˜set names utf8â€™);
$pdoStatement = $db-&gt;query(â€˜SELECT * FROM test1â€™, PDO::FETCH_ASSOC);
$iterator = new IteratorIterator($pdoStatement);
$tenRecordArray = iterator_to_array($iterator);
print_r($tenRecordArray);
RecursiveIteratoræ¥å£ï¼š
ç”¨äºå¾ªç¯è¿­ä»£å¤šå±‚ç»“æ„çš„æ•°æ®ï¼ŒRecursiveIteratorå¦å¤–æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼š</p>

<p>RecursiveIterator::getChildrenï¼šè·å–å½“å‰å…ƒç´ ä¸‹å­è¿­ä»£å™¨</p>

<p>RecursiveIterator::hasChildrenï¼šåˆ¤æ–­å½“å‰å…ƒç´ ä¸‹æ˜¯å¦æœ‰è¿­ä»£å™¨
class MyRecursiveIterator implements RecursiveIterator
{
    private $_data;
    private $_position = 0;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public function __construct(array $data) {
    $this-&gt;_data = $data;
}
  
public function valid() {
    return isset($this-&gt;_data[$this-&gt;_position]);
}
  
public function hasChildren() {
    return is_array($this-&gt;_data[$this-&gt;_position]);
}
  
public function next() {
    $this-&gt;_position++;
}
  
public function current() {
    return $this-&gt;_data[$this-&gt;_position];
}
  
public function getChildren() {
    print_r($this-&gt;_data[$this-&gt;_position]);
}
  
public function rewind() {
    $this-&gt;_position = 0;
}
  
public function key() {
    return $this-&gt;_position;
} }
</code></pre></div></div>

<p>$arr = array(0, 1=&gt; array(10, 20), 2, 3 =&gt; array(1, 2));
$mri = new MyRecursiveIterator($arr);</p>

<p>foreach ($mri as $c =&gt; $v) {
    if ($mri-&gt;hasChildren()) {
        echo â€œ$c has children: â€œ .PHP_EOL;
        $mri-&gt;getChildren();
    } else {
        echo â€œ$vâ€ .PHP_EOL;
    }
}
è¾“å‡ºç»“æœï¼š
0
1 has children:
Array
(
    [0] =&gt; 10
    [1] =&gt; 20
)
2
3 has children:
Array
(
    [0] =&gt; 1
    [1] =&gt; 2
)
SeekableIteratoræ¥å£ï¼š
é€šè¿‡ seek() æ–¹æ³•å®ç°å¯æœç´¢çš„è¿­ä»£å™¨ï¼Œç”¨äºæœç´¢æŸä¸ªä½ç½®ä¸‹çš„å…ƒç´ ã€‚</p>

<p>class  MySeekableIterator  implements  SeekableIterator  {
    private  $position = 0;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private  $array  = array(
    "first element" ,
    "second element" ,
    "third element" ,
    "fourth element"
);
 
public function  seek ( $position ) {
    if (!isset( $this -&gt; array [ $position ])) {
        throw new  OutOfBoundsException ( "invalid seek position ( $position )" );
    }
  
   $this -&gt; position  =  $position ;
}
  
public function  rewind () {
    $this -&gt; position  =  0 ;
}
  
public function  current () {
    return  $this -&gt; array [ $this -&gt; position ];
}
  
public function  key () {
    return  $this -&gt; position ;
}
  
public function  next () {
    ++ $this -&gt; position ;
}
  
public function  valid () {
    return isset( $this -&gt; array [ $this -&gt; position ]);
} }
</code></pre></div></div>

<p>try{
    $it  = new  MySeekableIterator ;
    echo  $it -&gt; current (),  â€œ\nâ€ ;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$it -&gt; seek ( 2 );
echo  $it -&gt; current (),  "\n" ;
  
$it -&gt; seek ( 1 );
echo  $it -&gt; current (),  "\n" ;
  
$it -&gt; seek ( 10 ); }catch( OutOfBoundsException $e ){
echo  $e -&gt; getMessage (); } è¾“å‡ºç»“æœï¼š
</code></pre></div></div>

<p>1
2
3
4
first element
third element
second element
invalid seek position ( 10 )
SplObserverå’ŒSplSubjectæ¥å£ï¼š
SplObserverå’ŒSplSubjectæ¥å£ç”¨æ¥å®ç°è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼ï¼Œè§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼æ˜¯æŒ‡å½“ä¸€ä¸ªç±»çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¾èµ–å®ƒçš„å¯¹è±¡éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶æ›´æ–°ã€‚ä½¿ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚è¯´å½“ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿåï¼Œéœ€è¦æ›´æ–°å¤šä¸ªé€»è¾‘æ“ä½œï¼Œä¼ ç»Ÿæ–¹å¼æ˜¯åœ¨äº‹ä»¶æ·»åŠ åç¼–å†™é€»è¾‘ï¼Œè¿™ç§ä»£ç è€¦åˆå¹¶éš¾ä»¥ç»´æŠ¤ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å¯å®ç°ä½è€¦åˆçš„é€šçŸ¥å’Œæ›´æ–°æœºåˆ¶ã€‚</p>

<p>SplObserverå’ŒSplSubjectçš„æ¥å£ç»“æ„ï¼š
// SplSubjectç»“æ„ è¢«è§‚å¯Ÿçš„å¯¹è±¡
interface SplSubject{
    public function attach(SplObserver $observer); // æ·»åŠ è§‚å¯Ÿè€…
    public function detach(SplObserver $observer); // å‰”é™¤è§‚å¯Ÿè€…
    public function notify(); // é€šçŸ¥è§‚å¯Ÿè€…
}</p>

<p>// SplObserverç»“æ„ ä»£è¡¨è§‚å¯Ÿè€…
interface SplObserver{
    public function update(SplSubject $subject); // æ›´æ–°æ“ä½œ
}
çœ‹ä¸‹é¢ä¸€ä¸ªå®ç°è§‚å¯Ÿè€…çš„ä¾‹å­ï¼š
class Subject implements SplSubject
{
    private $observers = array();</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public function attach(SplObserver  $observer)
{
    $this-&gt;observers[] = $observer;
}
  
public function detach(SplObserver  $observer)
{
    if($index = array_search($observer, $this-&gt;observers, true)) {
        unset($this-&gt;observers[$index]);
    }
}
  
public function notify()
{
    foreach($this-&gt;observers as $observer) {
        $observer-&gt;update($this);
    }
} }
</code></pre></div></div>

<p>class Observer1 implements  SplObserver
{
    public function update(SplSubject  $subject)
    {
        echo â€œé€»è¾‘1ä»£ç â€.PHP_EOL;
    }
}</p>

<p>class Observer2 implements  SplObserver
{
    public function update(SplSubject  $subject)
    {
        echo â€œé€»è¾‘2ä»£ç â€.PHP_EOL;
    }
}</p>

<p>$subject = new Subject();
$subject-&gt;attach(new Observer1());
$subject-&gt;attach(new Observer2());</p>

<p>$subject-&gt;notify();
è¿è¡Œç»“æœï¼š</p>

<p>1
2
é€»è¾‘1ä»£ç 
é€»è¾‘2ä»£ç 
ArrayObjectæ¥å£ï¼š
ArrayObject æ˜¯å°†æ•°ç»„è½¬æ¢ä¸ºæ•°ç»„å¯¹è±¡ã€‚
// è¿”å›å½“å‰æ•°ç»„å…ƒç´ 
ArrayIterator::current( void )</p>

<p>// è¿”å›å½“å‰æ•°ç»„key
ArrayIterator::key(void)</p>

<p>// æŒ‡å‘ä¸‹ä¸ªæ•°ç»„å…ƒç´ 
ArrayIterator::next (void)</p>

<p>// é‡ç½®æ•°ç»„æŒ‡é’ˆåˆ°å¤´
ArrayIterator::rewind(void )</p>

<p>// æŸ¥æ‰¾æ•°ç»„ä¸­æŸä¸€ä½ç½®
ArrayIterator::seek()</p>

<p>// æ£€æŸ¥æ•°ç»„æ˜¯å¦è¿˜åŒ…å«å…¶ä»–å…ƒç´ 
ArrayIterator::valid()</p>

<p>// æ·»åŠ æ–°å…ƒç´ 
ArrayObject::append()</p>

<p>// æ„é€ ä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡
ArrayObject::__construct()</p>

<p>// è¿”å›è¿­ä»£å™¨ä¸­å…ƒç´ ä¸ªæ•°
ArrayObject::count()</p>

<p>// ä»ä¸€ä¸ªæ•°ç»„å¯¹è±¡æ„é€ ä¸€ä¸ªæ–°è¿­ä»£å™¨
ArrayObject::getIterator()</p>

<p>// åˆ¤æ–­æäº¤çš„å€¼æ˜¯å¦å­˜åœ¨
ArrayObject::offsetExists(mixed index )</p>

<p>// æŒ‡å®š name è·å–å€¼
ArrayObject::offsetGet()</p>

<p>// ä¿®æ”¹æŒ‡å®š name çš„å€¼
ArrayObject::offsetSet()</p>

<p>// åˆ é™¤æ•°æ®
ArrayObject::offsetUnset()
å®ç°ä¾‹å­1ï¼š
$array =array(â€˜1â€™=&gt;â€™oneâ€™, â€˜2â€™=&gt;â€™twoâ€™, â€˜3â€™=&gt;â€™threeâ€™);
// æ„é€ ä¸€ä¸ªArrayObjectå¯¹è±¡
$arrayobject = new ArrayObject($array);
for( $iterator= $arrayobject-&gt;getIterator();// æ„é€ ä¸€ä¸ªè¿­ä»£å™¨ <br />
    $iterator-&gt;valid();  // æ£€æŸ¥æ˜¯å¦è¿˜å«æœ‰å…ƒç´  <br />
    $iterator-&gt;next() ){ // æŒ‡å‘ä¸‹ä¸ªå…ƒç´  <br />
    echo $iterator-&gt;key() . â€˜ =&gt; â€˜ . $iterator-&gt;current() . â€œ\nâ€; // æ‰“å°æ•°ç»„å…ƒç´ 
}
è¾“å‡ºç»“æœï¼š</p>

<p>1
1 =&gt; one 2 =&gt; two 3 =&gt; three
å®ç°ä¾‹å­2ï¼š
$arrayobject =new ArrayObject();
$arrayobject[] = â€˜zeroâ€™;
$arrayobject[] = â€˜oneâ€™;
$arrayobject[] = â€˜twoâ€™;
$iterator= $arrayobject-&gt;getIterator();
$iterator-&gt;next();
echo $iterator-&gt;key().â€<br />â€;
// é‡ç½®æŒ‡é’ˆåˆ°å¤´éƒ¨
$iterator-&gt;rewind();
echo $iterator-&gt;key();
è¾“å‡ºç»“æœï¼š
1
0</p>

<p>https://stackoverflow.com/questions/14610307/spl-arrayobject-arrayobjectstd-prop-list/16619183#16619183</p>

<p>http://bobao.360.cn/news/detail/215.html
https://www.anquanke.com/vul/id/1041474</p>

:ET