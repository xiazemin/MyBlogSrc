I"ß<p>è„šæœ¬è¯­æ³•æ˜¯ï¼š</p>

<p>â€œscriptâ€: {
    â€œlangâ€: â€œxxxâ€,
    â€œsourceâ€ | â€œidâ€: â€œxxxâ€,
    â€œparamsâ€: {xxx}
}</p>

<p>langæ˜¯languageçš„æ„æ€ï¼ŒæŒ‡å®šè„šæœ¬æ˜¯ç”¨å“ªç§è¯­è¨€å†™çš„ï¼Œå€¼å¯ä»¥æ˜¯painlessã€expressionï¼Œé»˜è®¤æ˜¯painlessã€‚</p>

<p>sourceç”¨äºæŒ‡å®šè„šæœ¬ï¼Œidç”¨äºæŒ‡å®šæˆ‘ä»¬è‡ªå·±é¢„å®šä¹‰çš„è„šæœ¬ã€‚</p>

<p>paramsç”¨äºæŒ‡å®šåœ¨è„šæœ¬ä¸­ä½¿ç”¨çš„å‚æ•°ã€‚esåœ¨æ¯æ¬¡é‡åˆ°æ–°è„šæœ¬æ—¶ï¼Œä¼šå°†è¯¥è„šæœ¬ç¼–è¯‘å¹¶ç¼“å­˜èµ·æ¥ï¼Œè€Œç¼–è¯‘æ˜¯ä¸€ä¸ªç›¸å¯¹è€—æ—¶çš„æ“ä½œã€‚æ‰€ä»¥ï¼Œå¦‚æœè„šæœ¬åªæ˜¯å‚æ•°å€¼ä¸åŒï¼Œå»ºè®®ä½¿ç”¨paramsï¼Œè€Œä¸æ˜¯æŠŠå‚æ•°å€¼åœ¨è„šæœ¬ä¸­å†™æ­»ã€‚</p>

<p>è„šæœ¬å¯ä»¥ç”¨åœ¨å¾ˆå¤šåœ°æ–¹ï¼Œå¦‚updateã€update_by_queryã€reindexã€script queryã€script-based sortingã€aggregationã€‚
<!-- more -->
https://www.cnblogs.com/koushr/p/5873409.html</p>

<p>Â Â åœ¨ä½¿ç”¨Elasticsearchï¼ˆesï¼‰è¿›è¡ŒDSLæŸ¥è¯¢æ—¶ï¼Œå…ä¸äº†æœ‰å­—æ®µé—´è¿›è¡Œæ¯”è¾ƒã€å››åˆ™è¿ç®—ç­‰ä¸€äº›ç®€å•çš„æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„è®¡ç®—éœ€æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°esæŸ¥è¯¢è¯­æ³•ä¸­çš„scriptå‚æ•°ã€‚é€šç”¨è¿‡ç”¨scriptå‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œä¸€äº›åŸºæœ¬çš„æ¯”è¾ƒå’Œå…¶ä»–çš„è¿ç®—ã€‚</p>

<p>https://www.jianshu.com/p/7d59711b8598</p>

<p>å‚æ•°è¯´æ˜ï¼š
lang:è„šæœ¬ä½¿ç”¨çš„è¯­è¨€ï¼Œé»˜è®¤æ˜¯painlessã€‚
sourceï¼šè„šæœ¬çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œidåº”ç”¨äºï¼šstored scriptã€‚
paramsï¼šä¼ é€’ç»™è„šæœ¬ä½¿ç”¨çš„å˜é‡å‚æ•°ã€‚</p>

<p>åœ¨å­¦ä¹ scriptsæ—¶ï¼Œå‘ç°æœ‰è®¸å¤šåœºæ™¯ä½¿ç”¨ï¼Œæ¯”å¦‚updateã€update-by-queryã€reindexç­‰ï¼Œç»“åˆscriptsè¯­æ³•è¯´ï¼Œlangä¼šæœ‰painlessã€expressionã€mustacheç­‰é€‰æ‹©ï¼›sourceä¸­æœ‰ctxã€doc[â€˜field_nameâ€™]ã€_sourceç­‰æ–¹å¼å–å€¼ã€‚</p>

<p>https://blog.csdn.net/yuyinghua0302/article/details/107635067</p>

<p>åœ¨Elasticsearcä¸­ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªå«åšPainlessçš„è¯­è¨€ã€‚å®ƒæ˜¯ä¸“é—¨ä¸ºElasticsearchè€Œå»ºç«‹çš„ã€‚Painlessæ˜¯ä¸€ç§ç®€å•ï¼Œå®‰å…¨çš„è„šæœ¬è¯­è¨€ï¼Œä¸“ä¸ºä¸Elasticsearchä¸€èµ·ä½¿ç”¨è€Œè®¾è®¡ã€‚ å®ƒæ˜¯Elasticsearchçš„é»˜è®¤è„šæœ¬è¯­è¨€ï¼Œå¯ä»¥å®‰å…¨åœ°ç”¨äºinlineå’Œstoredè„šæœ¬ã€‚å®ƒå…·æœ‰åƒGroovyé‚£æ ·çš„è¯­æ³•ã€‚è‡ªElasticsearch 6.0ä»¥åçš„ç‰ˆæœ¬ä¸å†æ”¯æŒGroovyï¼ŒJavascriptåŠPythonè¯­è¨€ã€‚</p>

<p>https://www.cnblogs.com/sanduzxcvbnm/p/12083590.html</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"script": {
    "lang":   "...",  
    "source" | "id": "...", 
    "params": { ... } 
  } è¿™é‡Œlangé»˜è®¤çš„å€¼ä¸º"painless"ã€‚åœ¨å®é™…çš„ä½¿ç”¨ä¸­å¯ä»¥ä¸è®¾ç½®ï¼Œé™¤éæœ‰ç¬¬äºŒç§è¯­è¨€ä¾›ä½¿ç”¨ sourceå¯ä»¥ä¸ºinlineè„šæœ¬ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªidï¼Œé‚£ä¹ˆè¿™ä¸ªidå¯¹åº”äºä¸€ä¸ªstoredè„šæœ¬ ä»»ä½•æœ‰åå­—çš„å‚æ•°ï¼Œå¯ä»¥è¢«ç”¨äºè„šæœ¬çš„è¾“å…¥å‚æ•°
</code></pre></div></div>

<p>å­˜å‚¨çš„è„šæœ¬ (stored script)
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œscriptså¯ä»¥è¢«å­˜æ”¾äºä¸€ä¸ªé›†ç¾¤çš„çŠ¶æ€ä¸­ã€‚å®ƒä¹‹åå¯ä»¥é€šè¿‡IDè¿›è¡Œè°ƒç”¨ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PUT _scripts/add_age
{
  "script": {
    "lang": "painless",
    "source": "ctx._source.age += params.value"
  }
} åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå«åšadd_ageçš„scriptã€‚å®ƒçš„ä½œç”¨å°±æ˜¯å¸®æˆ‘ä»¬æŠŠsourceé‡Œçš„ageåŠ ä¸Šä¸€ä¸ªæ•°å€¼ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¹‹åè°ƒç”¨å®ƒï¼š

POST twitter/_update/1
{
  "script": {
    "id": "add_age",
    "params": {
      "value": 2
    }
  }
} é€šè¿‡ä¸Šé¢çš„æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œageå°†ä¼šè¢«åŠ ä¸Š2
</code></pre></div></div>

<p>https://zhuanlan.zhihu.com/p/91662802
https://yemilice.com/2020/12/02/elasticsearch%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95(golang%E5%AE%9E%E7%8E%B0)/</p>
:ET