I"Cñ<p>https://github.com/rollup/rollup
http://rollupjs.org/guide/en/</p>

<p>ä¸€ï¼šrollup æ˜¯ä»€ä¹ˆï¼Ÿ
Rollup æ˜¯ä¸€ä¸ª JavaScript æ¨¡å—æ‰“åŒ…å™¨ï¼Œå¯ä»¥å°†å°å—ä»£ç ç¼–è¯‘æˆå¤§å—å¤æ‚çš„ä»£ç .</p>

<p>webpack å’Œ Rollup å¯¹æ¯”ä¸åŒç‚¹ï¼š</p>

<p>webpackæ”¯æŒåœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¯¹é¡¹ç›®è¿›è¡Œæ‰“åŒ…ï¼Œwebpackçš„æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ code-splittingï¼ˆæŒ‰éœ€åŠ è½½jsï¼‰å’Œ static assetsï¼ˆèµ„æºæ–‡ä»¶å¤„ç†ï¼‰ã€‚</p>

<p>rollup é€‚åˆä½¿ç”¨åœ¨ç‹¬ç«‹çš„jsåº“ä¸­è¿›è¡Œæ‰“åŒ…ã€‚ä½†æ˜¯ç›®å‰è¿˜ä¸æ”¯æŒ code-splitting å’Œ çƒ­æ›´æ–°ï¼Œæ›´è¶‹å‘ä¸“æ³¨äºæ„å»ºåˆ†ç±»çš„jsåº“ï¼Œä¹Ÿå°±æ˜¯è¯´å¤§å¤š
åªä¼šç”Ÿæˆä¸€ä¸ªjsæ–‡ä»¶æ¥è¢«å…¶ä»–é¡¹ç›®ä¾èµ–ï¼Œæ›´å¥½åœ°åˆ©ç”¨ es6 modulesçš„ä¼˜åŠ¿æ¥ç¼©å°å’Œä¼˜åŒ–ä»£ç ã€‚</p>

<p>Tree-shaking
åœ¨rollupç¼–è¯‘æ¨¡å—çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡Tree-shakingçš„æ–¹å¼æ¥å»æ‰æ¨¡å—ä¸­æœªä½¿ç”¨åˆ°çš„ä»£ç ï¼Œä»…ä»…ä¿ç•™è¢«æˆ‘ä»¬è°ƒç”¨åˆ°çš„ä»£ç æ¥å‡å°‘æ–‡ä»¶çš„å¤§å°ã€‚</p>

<p>rollupå‘½ä»¤å®‰è£…å¦‚ä¸‹ï¼š
å‘½ä»¤ï¼šnpm install -g rollup è¿›è¡Œå®‰è£…ã€‚
<!-- more -->
æ¯”å¦‚æˆ‘ä»¬çœ‹ä¸€ä¸ªdemoä»£ç å¦‚ä¸‹ï¼š</p>

<p>æ–°å»ºæ–‡ä»¶å¤¹ roll, æ–‡ä»¶å¤¹å†…æœ‰å¦‚ä¸‹æ–‡ä»¶ main.js å’Œ index.jsï¼› åŠ index.htmlæ–‡ä»¶ï¼›</p>

<p>main.js ä»£ç å¦‚ä¸‹ï¼š</p>

<p>æŒ‰ Ctrl+C å¤åˆ¶ä»£ç 
export function aa(x) {
  return x * x;
}</p>

<p>export function bb(y) {
  return y + y;
}
æŒ‰ Ctrl+C å¤åˆ¶ä»£ç 
index.js ä»£ç å¦‚ä¸‹ï¼š</p>

<p>import { bb } from â€˜./main.jsâ€™;</p>

<p>console.log(bb(5)); 
å¦‚ä¸Šä»£ç å¯ä»¥çœ‹åˆ°ï¼Œmain.js å†…æœ‰ä¸¤ä¸ªå‡½æ•° aa, å’Œ bbï¼Œ ä½†æ˜¯åœ¨index.jså†…ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨aaè¿™ä¸ªå‡½æ•°ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ rollupè¿›è¡Œæ¨¡å—æ‰“åŒ…
çš„æ—¶å€™ï¼Œä¼šæŠŠæœªè°ƒç”¨åˆ°çš„å‡½æ•°ä¼šå»æ‰ï¼Œè¿™æ ·çš„è¯ï¼Œå¯ä»¥ä½¿å¤šä½™ä»£ç å»æ‰ï¼Œä½¿å¾—æ–‡ä»¶æ›´å°ã€‚</p>

<p>rollup æ‰“åŒ…æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<ol>
  <li>å¯¹äºæµè§ˆå™¨ å¯ä»¥æœ‰å¦‚ä¸‹å‘½ä»¤ï¼š</li>
</ol>

<p>rollup index.js -o bundle2.js -f iife 
æœ€åç”Ÿæˆ bundle2.js ä»£ç å¦‚ä¸‹æ ·å­ï¼š</p>

<p>å¤åˆ¶ä»£ç 
(function () {
â€˜use strictâ€™;</p>

<p>function bb(y) {
  return y + y;
}</p>

<p>console.log(bb(5));</p>

<p>}());
å¤åˆ¶ä»£ç </p>
<ol>
  <li>å¯¹äºNode.js ä»£ç å¦‚ä¸‹æ ·å­ï¼šï¼ˆç¼–è¯‘æˆCommonJSçš„æ¨¡å—æ ·å­ï¼‰
rollup index.js -o bundle.js -f cjs
å¦‚ä¸Šå‘½ä»¤ -f æ˜¯ (â€“output.formatçš„ç¼©å†™)ï¼ŒæŒ‡å®šäº†æ‰€åˆ›å»ºçš„bundleçš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯CommonJS(åœ¨Node.jsä¸­è¿è¡Œçš„)ã€‚
æœ€åç”Ÿæˆ bundle.js ä»£ç å¦‚ä¸‹æ ·å­ï¼š</li>
</ol>

<p>å¤åˆ¶ä»£ç 
â€˜use strictâ€™;</p>

<p>function bb(y) {
  return y + y;
}</p>

<p>console.log(bb(5));
å¤åˆ¶ä»£ç </p>
<ol>
  <li>å¯¹äºæµè§ˆå™¨å’Œ Node.js(ä½¿ç”¨UMD format requires a bundle name):
rollup index.js -o bundle3.js -f umd â€“name â€˜myBundleâ€™
æœ€åç”Ÿæˆ bundle3.js ä»£ç å¦‚ä¸‹æ ·å­ï¼š</li>
</ol>

<p>å¤åˆ¶ä»£ç 
(function (global, factory) {
  typeof exports === â€˜objectâ€™ &amp;&amp; typeof module !== â€˜undefinedâ€™ ? factory() :
  typeof define === â€˜functionâ€™ &amp;&amp; define.amd ? define(factory) :
  (factory());
}(this, (function () { â€˜use strictâ€™;</p>

<p>function bb(y) {
  return y + y;
}</p>

<p>console.log(bb(5));</p>

<p>})));
å¤åˆ¶ä»£ç 
äºŒï¼šä½¿ç”¨é…ç½®æ–‡ä»¶</p>

<p>rollup ä¹Ÿå¯ä»¥å’Œwebpackä¸€æ ·ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥è¿›è¡Œæ‰“åŒ…äº†ï¼Œrollupçš„é»˜è®¤é…ç½®æ–‡ä»¶å°±å« rollup.config.jsï¼Œ æˆ‘åœ¨rollæ–‡ä»¶å¤¹ä¸‹ æ–°å»ºä¸€ä¸ªroll.config.jsåï¼Œç„¶åæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>

<p>æŒ‰ Ctrl+C å¤åˆ¶ä»£ç 
export default {
  input: â€˜./main.jsâ€™,
  output: {
    file: â€˜bundle4.jsâ€™,
    format: â€˜cjsâ€™
  }
}
æŒ‰ Ctrl+C å¤åˆ¶ä»£ç 
ç„¶ååœ¨rollæ–‡ä»¶å¤¹å†…ï¼Œ è¿è¡Œå‘½ä»¤ rollup -c æ¥ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œå°±ä¼šåœ¨rollé¡¹ç›®æ–‡ä»¶å¤¹å†…ç”Ÿæˆ bundle4.jsæ–‡ä»¶ï¼Œé‡Œé¢ç”Ÿæˆåçš„ä»£ç 
å¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
â€˜use strictâ€™;</p>

<p>Object.defineProperty(exports, â€˜__esModuleâ€™, { value: true });</p>

<p>function aa(x) {
  return x * x;
}</p>

<p>function bb(y) {
  return y + y;
}</p>

<p>exports.aa = aa;
exports.bb = bb;
å¤åˆ¶ä»£ç 
æ³¨æ„ï¼šRollupæœ¬èº«ä¼šå¤„ç†é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ export defaultçš„è¯­æ³•ï¼Œä»£ç ä¸ä¼šç»è¿‡Babelç­‰ç±»ä¼¼å·¥å…·ç¼–è¯‘ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨
æ‰€ç”¨node.jsç‰ˆæœ¬æ”¯æŒes2015è¯­æ³•ã€‚</p>

<p>é»˜è®¤çš„é…ç½®æ–‡ä»¶å« rollup.config.js, æˆ‘ä»¬ä¹Ÿå¯ä»¥å«ä¸åŒçš„åå­—ï¼Œæ¯”å¦‚å« rollup.config.dev.jsæˆ–roll.config.prod.jsï¼Œ
å› æ­¤æˆ‘ä»¬å…è®¸å‘½ä»¤çš„æ—¶å€™å¯ä»¥å¦‚ä¸‹è¿è¡Œï¼š rollup â€“config rollup.config.dev.js</p>

<p>rollup é…ç½®é€‰é¡¹å¦‚ä¸‹ï¼š</p>

<p>input: è¿™ä¸ªåŒ…çš„å…¥å£ç‚¹ æ¯”å¦‚æˆ‘ä¸Šé¢åŒ…çš„å…¥å£ç‚¹ä¸º main.js</p>

<p>output: {
  file: â€˜bundle4.jsâ€™,
  format: â€˜cjsâ€™,
  name: â€˜MyBundleâ€™
}
output.file: è¦å†™å…¥çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨äºç”Ÿæˆçš„sourcemapsã€‚
output.format ç”ŸæˆåŒ…çš„æ ¼å¼ï¼Œæœ‰å¦‚ä¸‹æ ¼å¼ï¼š</p>

<ol>
  <li>amd â€“ å¼‚æ­¥æ¨¡å—å®šä¹‰ï¼Œç”¨äºåƒRequestJSè¿™æ ·çš„æ¨¡å—åŠ è½½å™¨ã€‚</li>
  <li>cjs â€“ CommonJS, é€‚ç”¨äºNodeæˆ–Browserify/webpack</li>
  <li>es â€“ å°†è½¯ä»¶åŒ…ä¿å­˜ä¸ºESæ¨¡å—æ–‡ä»¶ã€‚</li>
  <li>iife â€“ ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œçš„åŠŸèƒ½ï¼Œé€‚åˆä½œä¸º <script>æ ‡ç­¾è¿™æ ·çš„ã€‚</script></li>
  <li>umd â€“ é€šç”¨æ¨¡å—å®šä¹‰ï¼Œä»¥amd, cjs, å’Œ iife ä¸ºä¸€ä½“ã€‚</li>
</ol>

<p>output.nameï¼š ä»£è¡¨iife/umd åŒ…ï¼ŒåŒä¸€é¡µä¸Šçš„å…¶ä»–çš„è„šæœ¬å¯ä»¥è®¿é—®ï¼Œæ¯”å¦‚ï¼šé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
export default {
  input: â€˜./main.jsâ€™,
  output: {
    file: â€˜bundle5.jsâ€™,
    format: â€˜iifeâ€™,
    name: â€˜MyBundle1â€™
  }
}
å¤åˆ¶ä»£ç 
æœ€åç”Ÿæˆ bundle5.js ä»£ç å˜ä¸ºå¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
var MyBundle1 = (function (exports) {
  â€˜use strictâ€™;
  function aa(x) {
    return x * x;
  }
  function bb(y) {
    return y + y;
  }
  exports.aa = aa;
  exports.bb = bb;
  return exports;
}({}));
å¤åˆ¶ä»£ç 
ä¸‹é¢åˆ†åˆ«çœ‹çœ‹ä»¥ amdï¼Œ cjsï¼Œ esï¼Œ iife åŠ umd æ‰“åŒ…ç”Ÿæˆåçš„æ–‡ä»¶è¿›è¡Œå¯¹æ¯”ä¸‹ï¼Œçœ‹çœ‹ä»–ä»¬æ‰“åŒ…åçš„ä»£ç åˆ†åˆ«æ˜¯ä»€ä¹ˆæ ·çš„ï¼š</p>

<p>1-1 amdé…ç½®æ–‡ä»¶å¦‚ä¸‹(rollup.config.js)ï¼š</p>

<p>å¤åˆ¶ä»£ç 
export default {
  input: â€˜./main.jsâ€™,
  output: {
    file: â€˜amd.jsâ€™,
    format: â€˜amdâ€™,
    name: â€˜AMDâ€™
  }
}
å¤åˆ¶ä»£ç 
æ‰“åŒ…åç”Ÿæˆçš„amd.jså¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
define([â€˜exportsâ€™], function (exports) { â€˜use strictâ€™;
  function aa(x) {
    return x * x;
  }
  function bb(y) {
    return y + y;
  }
  exports.aa = aa;
  exports.bb = bb;
  Object.defineProperty(exports, â€˜__esModuleâ€™, { value: true });
});
å¤åˆ¶ä»£ç 
1-2 cjsé…ç½®æ–‡ä»¶å¦‚ä¸‹(rollup.config.js)ï¼š</p>

<p>å¤åˆ¶ä»£ç 
export default {
  input: â€˜./main.jsâ€™,
  output: {
    file: â€˜cjs.jsâ€™,
    format: â€˜cjsâ€™,
    name: â€˜CJSâ€™
  }
}
å¤åˆ¶ä»£ç 
æ‰“åŒ…åç”Ÿæˆçš„cjs.jså¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
â€˜use strictâ€™;</p>

<p>Object.defineProperty(exports, â€˜__esModuleâ€™, { value: true });</p>

<p>function aa(x) {
  return x * x;
}</p>

<p>function bb(y) {
  return y + y;
}</p>

<p>exports.aa = aa;
exports.bb = bb;
å¤åˆ¶ä»£ç 
1-3 esé…ç½®æ–‡ä»¶å¦‚ä¸‹(rollup.config.js)ï¼š</p>

<p>å¤åˆ¶ä»£ç 
export default {
  input: â€˜./main.jsâ€™,
  output: {
    file: â€˜es.jsâ€™,
    format: â€˜esâ€™,
    name: â€˜ESâ€™
  }
}
å¤åˆ¶ä»£ç 
æ‰“åŒ…åç”Ÿæˆçš„es.jså¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
function aa(x) {
  return x * x;
}</p>

<p>function bb(y) {
  return y + y;
}</p>

<p>export { aa, bb };
å¤åˆ¶ä»£ç 
1-4 iifeé…ç½®æ–‡ä»¶å¦‚ä¸‹(rollup.config.js)ï¼š</p>

<p>å¤åˆ¶ä»£ç 
export default {
  input: â€˜./main.jsâ€™,
  output: {
    file: â€˜iife.jsâ€™,
    format: â€˜iifeâ€™,
    name: â€˜IIFEâ€™
  }
}
å¤åˆ¶ä»£ç 
æ‰“åŒ…åç”Ÿæˆçš„iife.jså¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
var IIFE = (function (exports) {
â€˜use strictâ€™;</p>

<p>function aa(x) {
  return x * x;
}</p>

<p>function bb(y) {
  return y + y;
}</p>

<p>exports.aa = aa;
exports.bb = bb;</p>

<p>return exports;</p>

<p>}({}));
å¤åˆ¶ä»£ç 
1-5 umd é…ç½®æ–‡ä»¶å¦‚ä¸‹(rollup.config.js)ï¼š</p>

<p>å¤åˆ¶ä»£ç 
export default {
  input: â€˜./main.jsâ€™,
  output: {
    file: â€˜umd.jsâ€™,
    format: â€˜umdâ€™,
    name: â€˜UMDâ€™
  }
}
å¤åˆ¶ä»£ç 
æ‰“åŒ…åç”Ÿæˆçš„umd.jså¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
(function (global, factory) {
  typeof exports === â€˜objectâ€™ &amp;&amp; typeof module !== â€˜undefinedâ€™ ? factory(exports) :
  typeof define === â€˜functionâ€™ &amp;&amp; define.amd ? define([â€˜exportsâ€™], factory) :
  (factory((global.UMD = {})));
}(this, (function (exports) { 
  â€˜use strictâ€™;
  function aa(x) {
    return x * x;
  }
  function bb(y) {
    return y + y;
  }
  exports.aa = aa;
  exports.bb = bb;
  Object.defineProperty(exports, â€˜__esModuleâ€™, { value: true });
})));
å¤åˆ¶ä»£ç 
æ‰€æœ‰çš„é…ç½®é€‰é¡¹å¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
// rollup.config.js
export default {
  // æ ¸å¿ƒé€‰é¡¹
  input,        // è¦æ‰“åŒ…çš„æ–‡ä»¶
  external,     // å°†æ¨¡å—IDçš„é€—å·åˆ†éš”åˆ—è¡¨æ’é™¤
  plugins,</p>

<p>// é¢å¤–é€‰é¡¹
  onwarn,</p>

<p>// danger zone 
  acorn,
  context,
  moduleContext,
  legacy,</p>

<p>output: {
    // å¦‚æœéœ€è¦è¾“å‡ºå¤šä¸ªï¼Œå¯ä»¥ä¸ºæ•°ç»„</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// æ ¸å¿ƒé€‰é¡¹
file,    // è¾“å‡ºçš„æ–‡ä»¶(å¦‚æœæ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼Œåˆ™ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°)
format,  // è¾“å‡ºçš„æ–‡ä»¶ç±»å‹(amdï¼Œ cjs, es, iife, umd)
name,    // ç”ŸæˆUMDæ¨¡å—çš„åå­—
global,  // ä»¥`module ID:Global` é”®å€¼å¯¹çš„å½¢å¼ï¼Œç”¨é€—å·åˆ†éš”å¼€ ä»»ä½•å®šä¹‰åœ¨è¿™é‡Œæ¨¡å—IDå®šä¹‰æ·»åŠ åˆ°å¤–éƒ¨ä¾èµ–
                          
// é¢å¤–é€‰é¡¹
paths,
banner,  // åœ¨æ‰“åŒ…å¥½çš„æ–‡ä»¶çš„å—çš„å¤–éƒ¨(wrapperå¤–éƒ¨)çš„æœ€é¡¶éƒ¨æ’å…¥ä¸€æ®µå†…å®¹
footer,  // åœ¨æ‰“åŒ…å¥½çš„æ–‡ä»¶çš„å—çš„å¤–éƒ¨(wrapperå¤–éƒ¨)çš„æœ€åº•éƒ¨æ’å…¥ä¸€æ®µå†…å®¹
intro,   // åœ¨æ‰“åŒ…å¥½çš„æ–‡ä»¶çš„å—çš„å†…éƒ¨(wrapperå†…éƒ¨)çš„æœ€é¡¶éƒ¨æ’å…¥ä¸€æ®µå†…å®¹
outro,   // åœ¨æ‰“åŒ…å¥½çš„æ–‡ä»¶çš„å—çš„å†…éƒ¨(wrapperå†…éƒ¨)çš„æœ€åº•éƒ¨æ’å…¥ä¸€æ®µå†…å®¹
sourcemap,
sourcemapFile,
interop,

// é«˜å±é€‰é¡¹
exports,
amd,
indent,
strict   } } å¤åˆ¶ä»£ç  ä¸‰ï¼šä½¿ç”¨æ’ä»¶ ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬é€šè¿‡ç›¸å¯¹è·¯å¾„ï¼Œå°†ä¸€ä¸ªå…¥å£æ–‡ä»¶å’Œä¸€ä¸ªæ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„bundle.jsï¼Œ ä½†æ˜¯å½“æ„å»ºéå¸¸å¤æ‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥npmå®‰è£…æ¨¡å—ï¼Œé€šè¿‡Babelç¼–è¯‘ä»£ç ï¼Œå’ŒJSONæ–‡ä»¶æ‰“äº¤é“ç­‰ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ’ä»¶åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­æ›´æ”¹Rollupçš„è¡Œä¸ºã€‚
</code></pre></div></div>

<p>3-1 rollup-plugin-json ï¼ˆä½¿rollupä»JSONæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼‰
å°† rollup-plugin-json å®‰è£…ä¸ºå¼€å‘ä¾èµ–ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š
npm install â€“save-dev rollup-plugin-json</p>

<p>å®‰è£…ä¹‹å‰ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æ–°å»ºæˆ–å®‰è£…ä¸€ä¸ª package.json; å…·ä½“å®‰è£…ä¸ä»‹ç»(ä½¿ç”¨npm initä¸€ç›´å›è½¦é”®å³å¯)ã€‚</p>

<p>æˆ‘ä»¬å…ˆæ¥æ›´æ”¹ main.jsæ–‡ä»¶ä»£ç ï¼Œä»£ç å˜æˆå¦‚ä¸‹ï¼š</p>

<p>import { version } from â€˜./package.jsonâ€™;</p>

<p>export default function() {
  console.log(â€˜version â€˜ +version);
}
åœ¨ç»§ç»­ç¼–è¾‘ rollup.config.jsæ–‡ä»¶ï¼ŒåŠ å…¥ JSONæ’ä»¶ã€‚
ä»£ç å¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
import json from â€˜rollup-plugin-jsonâ€™;</p>

<p>export default {
  input: â€˜./main.jsâ€™,
  output: {
    file: â€˜pluginjson.jsâ€™,
    format: â€˜cjsâ€™,
  },
  plugins: [ json() ]
}
å¤åˆ¶ä»£ç 
æœ€åä¼šç”Ÿæˆpluginjsonæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š</p>

<p>å¤åˆ¶ä»£ç 
â€˜use strictâ€™;</p>

<p>var version = â€œ1.0.0â€;</p>

<p>function main() {
  console.log(â€˜version â€˜ +version);
}</p>

<p>module.exports = main;
å¤åˆ¶ä»£ç 
3-2 rollup-plugin-node-resolve å’Œ rollup-plugin-commonjs æ’ä»¶
è¿™ä¸¤ä¸ªæ’ä»¶å¯ä»¥è®©ä½ åŠ è½½ Node.jsé‡Œé¢çš„CommonJSæ¨¡å—ã€‚
å…ˆå®‰è£…è¿™ä¸¤ä¸ªæ’ä»¶ï¼š
npm install â€“save-dev rollup-plugin-node-resolve rollup-plugin-commonjs</p>

<p>æ›´å¤šå…³äº rollup å¯ä»¥çœ‹å®˜ç½‘ http://www.rollupjs.com/</p>

<p>ä¸ºé¿å…åå¤è¾“å…¥å‘½ä»¤è¡Œå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ä¿å­˜å‚æ•°ã€‚é…ç½®æ–‡ä»¶ç”¨ JavaScript ç¼–å†™ï¼Œæ¯”å‘½ä»¤è¡Œå‚æ•°æ›´çµæ´»ã€‚</p>

<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º rollup.config.js æ–‡ä»¶ï¼Œå¢åŠ å¦‚ä¸‹ä»£ç ï¼š</p>

<p>export default {
    entry: â€˜src/main.jsâ€™,
    format: â€˜cjsâ€™,
    dest: â€˜bundle.jsâ€™
};
ä¸ºäº†ä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ â€“config æˆ–è€… -c é€‰é¡¹ï¼š</p>

<p>rm bundle.js
rollup -c 
ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°è¦†ç›–é…ç½®æ–‡ä»¶çš„å¯¹åº”é€‰é¡¹ï¼š</p>

<p>rollup -c -o bundle-2.js
è¿˜å¯ä»¥æŒ‡å®šä¸åŒçš„é…ç½®æ–‡ä»¶ï¼š</p>

<p>rollup â€“config rollup.config.dev.js
rollup â€“config rollup.config.prod.js</p>

<p>ollupä¹Ÿæ˜¯ä¸€æ¬¾æ‰“åŒ…å·¥å…·ï¼Œæ¯”webpackè¦è½»é‡è®¸å¤šï¼Œç”¨äºå¼¥è¡¥gulpçš„æ— tree-shakingæ˜¯å¾ˆå¥½çš„é€‰æ‹©ï¼Œæœ€å¤§çš„ç”¨é€”æ˜¯æ‰“åŒ…ç”Ÿäº§ä¸€ä¸ªåº“æ–‡ä»¶ï¼Œæ¯”å¦‚sdk.jsä¹‹ç±»ã€‚è™½ç„¶webpackä¹Ÿå¯ä»¥åšåˆ°ï¼Œä½†æ˜¯webpackè¾ƒé‡ï¼Œæ‰“åŒ…åçš„æ–‡ä»¶æœ‰éƒ¨åˆ†webpackå†…éƒ¨ä»£ç ï¼Œå¦‚__webpack__requireä¹‹ç±»çš„å‡½æ•°å®šä¹‰ï¼Œç»™äººä¸€ç§ä¸å¹²å‡€çš„æ„Ÿè§‰ã€‚è€Œrollupæ‰“å‡ºæ¥çš„åŒ…å°±å¾ˆå¹²å‡€ï¼Œæ²¡æœ‰å…¶ä»–å†—ä½™ä»£ç ã€‚</p>

<p>1ã€ä½¿ç”¨æ–¹å¼
é¦–å…ˆå®‰è£…rollup</p>

<p>npm i rollup
å†çœ‹rollupçš„å‡ ç§è°ƒç”¨å½¢å¼</p>

<p>å‘½ä»¤è¡Œè¿è¡Œ
rollup src/main.js -o rel/bundle.js  -f cjs //å°†main.js(es5)ç¼–è¯‘è¾“å‡ºè‡³bundle.js(commonjs)
é…ç½®æ–‡ä»¶å½¢å¼
//æ–°å»ºä¸€ä¸ªrollup.config.js 
export default {
  entry: â€˜src/main.jsâ€™,
  format: â€˜cjsâ€™,
  dest: â€˜rel/bundle.jsâ€™ // è¾“å‡ºæ–‡ä»¶
};
ç„¶åæ‰§è¡Œ</p>

<p>rollup -c   //å½“ä½ çš„é…ç½®æ–‡ä»¶å¦æœ‰å…¶å(dev),æ‰§è¡Œ rollup -c rollup.config.dev.js
æ¨¡å—å½¢å¼(æ–¹ä¾¿é…åˆgulpç­‰å…¶ä»–å·¥å…·)
å¦‚å°†rollup.config.js å†™å‡ºè¿™æ ·
var rollup = require( â€˜rollupâ€™ );
var babel = require(â€˜rollup-plugin-babelâ€™);</p>

<p>rollup.rollup({
    entry: â€˜src/main.jsâ€™,
    plugins: [ babel() ]
}).then( function ( bundle ) {
    bundle.write({
        format: â€˜umdâ€™,
        moduleName: â€˜mainâ€™, //umdæˆ–iifeæ¨¡å¼ä¸‹ï¼Œè‹¥å…¥å£æ–‡ä»¶å« exportï¼Œå¿…é¡»åŠ ä¸Šè¯¥å±æ€§
        dest: â€˜rel/bundle.jsâ€™
    });
});
å°±å¯ç”¨node rollup.config.dev.js ç›´æ¥æ‰§è¡Œ</p>

<p>2ã€é…ç½®é¡¹
input
å…¥å£æ–‡ä»¶åœ°å€
output
output:{
    file:â€™bundle.jsâ€™, // è¾“å‡ºæ–‡ä»¶
    format: â€˜cjs,  //  äº”ç§è¾“å‡ºæ ¼å¼ï¼šamd /  es6 / iife / umd / cjs
    name:â€™Aâ€™,  //å½“formatä¸ºiifeå’Œumdæ—¶å¿…é¡»æä¾›ï¼Œå°†ä½œä¸ºå…¨å±€å˜é‡æŒ‚åœ¨window(æµè§ˆå™¨ç¯å¢ƒ)ä¸‹ï¼šwindow.A=â€¦
    sourcemap:true  //ç”Ÿæˆbundle.map.jsæ–‡ä»¶ï¼Œæ–¹ä¾¿è°ƒè¯•
}
plugins
æœ€å¸¸ç”¨çš„å°±æ˜¯babelæ’ä»¶äº†,æ¯”è¾ƒä¸çˆ½çš„æ˜¯ï¼Œbabel çš„é¢„è®¾ä¸åƒ webpack å¯ä»¥ç›´æ¥å†™åœ¨é…ç½®æ–‡ä»¶é‡Œï¼Œè€Œè¿˜æ˜¯å¾—ç‹¬ç«‹å†™ä¸ªâ€œsrc/.babelrcâ€ï¼ˆæ³¨æ„æˆ‘ä»¬å¯ä»¥å†™åœ¨ src ä¸‹ï¼Œè€Œä¸æ˜¯éå¾—æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼‰ï¼Œè¿˜å¾—ç¡®ä¿è£…äº†æ’ä»¶ï¼šnpm i rollup-plugin-babel
// import babel from â€˜rollup-plugin-babelâ€™;
plugins:[babel()]</p>

<p>// .babelrc        npm i -D babel-preset-env babel-plugin-external-helpers
{
  â€œpresetsâ€: [
    [â€œenvâ€, {
      â€œmodulesâ€: false
    }]
  ],
  â€œpluginsâ€: [â€œexternal-helpersâ€]     //åªå¼•å…¥ä¸€æ¬¡babelçš„helperå‡½æ•°
}
external
external:[â€˜lodashâ€™] //å‘Šè¯‰rollupä¸è¦å°†æ­¤lodashæ‰“åŒ…ï¼Œè€Œä½œä¸ºå¤–éƒ¨ä¾èµ–
global
global:{
    â€˜jqueryâ€™:â€™$â€™              //å‘Šè¯‰rollup å…¨å±€å˜é‡$å³æ˜¯jquery
}
3ã€æ³¨æ„ç‚¹
rollupæ— æ³•è¯†åˆ«node_modulesä¸­çš„åŒ…ï¼Œéœ€è¦å®‰è£…æ’ä»¶npm install â€“save-dev rollup-plugin-node-resolveï¼Œç„¶ååœ¨pluginsä¸­ä½¿ç”¨ï¼š
import resolve from â€˜rollup-plugin-node-resolveâ€™;
export default {
  input: â€˜src/main.jsâ€™,
  output: {
    file: â€˜bundle.jsâ€™
    format: â€˜cjsâ€™
  },
  plugins: [ resolve() ]
};
node_modulesä¸­çš„åŒ…å¤§éƒ¨åˆ†éƒ½æ˜¯commonjsæ ¼å¼çš„ï¼Œè¦åœ¨rollupä¸­ä½¿ç”¨å¿…é¡»å…ˆè½¬ä¸ºES6è¯­æ³•ï¼Œä¸ºæ­¤éœ€è¦å®‰è£…æ’ä»¶ rollup-plugin-commonjs</p>

<p>rollup.jsç®€ä»‹
rollup.js</p>

<p>é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹rollup.JSã€‚æ ¹æ®å®˜æ–¹çš„ä»‹ç»ï¼Œrollup.jsæ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ ä»ä¸€ä¸ªå…¥å£æ–‡ä»¶å¼€å§‹ï¼Œå°†æ‰€æœ‰ä½¿ç”¨åˆ°çš„æ¨¡å—æ–‡ä»¶éƒ½æ‰“åŒ…åˆ°ä¸€ä¸ªæœ€ç»ˆçš„å‘å¸ƒæ–‡ä»¶ä¸­ï¼ˆæå…¶é€‚åˆæ„å»ºä¸€ä¸ªå·¥å…·åº“ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘é€‰æ‹©ç”¨rollupæ¥æ‰“åŒ…çš„åŸå› ï¼‰ã€‚</p>

<p>rollup.jsæœ‰ä¸¤ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯å®ƒä½¿ç”¨ES6çš„æ¨¡å—æ ‡å‡†ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨importå’Œexportè€Œä¸éœ€è¦å¼•å…¥babelï¼ˆå½“ç„¶ï¼Œåœ¨ç°åœ¨çš„é¡¹ç›®ä¸­ï¼Œbabelå¯ä»¥è¯´æ˜¯å¿…ç”¨çš„å·¥å…·äº†ï¼‰ã€‚</p>

<p>rollup.jsçš„å¦ä¸€ä¸ªé‡è¦ç‰¹æ€§å«åšâ€™tree-shakingâ€™ï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥å¸®åŠ©ä½ å°†æ— ç”¨ä»£ç ï¼ˆå³æ²¡æœ‰ä½¿ç”¨åˆ°çš„ä»£ç ï¼‰ä»æœ€ç»ˆçš„ç”Ÿæˆæ–‡ä»¶ä¸­åˆ å»ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘åœ¨A.jsæ–‡ä»¶ä¸­å®šä¹‰äº†A1å’ŒA2ä¸¤ä¸ªæ–¹æ³•ï¼ŒåŒæ—¶åœ¨Bæ–‡ä»¶ä¸­å¼•å…¥äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯åœ¨Bæ–‡ä»¶ä¸­åªå¼•å…¥äº†Aæ–‡ä»¶ä¸­çš„A1æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨æœ€åæ‰“åŒ…Bæ–‡ä»¶æ—¶ï¼Œrollupå°±ä¸ä¼šå°†A2æ–¹æ³•å¼•å…¥åˆ°æœ€ç»ˆæ–‡ä»¶ä¸­ã€‚ï¼ˆè¿™ä¸ªç‰¹æ€§æ˜¯åŸºäºES6æ¨¡å—çš„é™æ€åˆ†æçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰exportè€Œæ²¡æœ‰importçš„å˜é‡æ˜¯ä¸ä¼šè¢«æ‰“åŒ…åˆ°æœ€ç»ˆä»£ç ä¸­çš„ï¼‰</p>

<p>rollup.jså®ä¾‹
demo0 å¼€å§‹ä½¿ç”¨rollup
åˆå§‹åŒ–ä¸€ä¸ªå·¥ç¨‹ï¼Œåˆ›å»ºä¸€ä¸ªä¾èµ–æ¨¡å—æ–‡ä»¶lib.jså’Œå…¥å£æ–‡ä»¶index.jsã€‚</p>

<p>export function logA() {
    console.log(â€˜function logA calledâ€™)
}</p>

<p>export function logB() {
    console.log(â€˜function logB calledâ€™)
}
import { logA } from â€˜./libâ€™</p>

<p>logA()
ç°åœ¨æˆ‘ä»¬è¦æŠŠlib.jså’Œindex.jsæ‰“åŒ…æˆdist.jsï¼Œé¦–å…ˆè¦åšçš„å°±æ˜¯å®‰è£…rollup.jsã€‚</p>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ç§å®‰è£…æ–¹æ³•ï¼š</p>

<p>å…¨å±€å®‰è£…ï¼š
æ‰“å¼€ä½ çš„å‘½ä»¤è¡Œï¼Œè¾“å…¥npm install rollup -gï¼Œç­‰å¾…rollupå®‰è£…å®Œæ¯•ã€‚å®‰è£…å®Œæˆä¹‹åï¼Œè¯•ç€è¾“å…¥rollup -væ¥æŸ¥çœ‹ä¸€ä¸‹rollupæ˜¯å¦å®‰è£…æˆåŠŸäº†</p>

<p>æŸ¥çœ‹rollupç‰ˆæœ¬</p>

<p>æˆåŠŸå®‰è£…å®Œrollupä¹‹åï¼Œè¿›å…¥åˆ°å·¥ç¨‹ç›®å½•ä¸‹ï¼Œè¾“å…¥æ‰“åŒ…å‘½ä»¤rollup index.js -o dist.jsï¼Œindex.js æ˜¯æˆ‘ä»¬çš„å…¥å£æ–‡ä»¶ï¼Œ -o è¡¨ç¤ºè¾“å‡ºæ–‡ä»¶çš„è·¯å¾„ï¼Œåœ¨ -o åé¢è·Ÿç€çš„ dist.js å°±æ˜¯æˆ‘ä»¬è¦ç”Ÿæˆçš„æœ€ç»ˆæ‰“åŒ…æ–‡ä»¶äº†ã€‚ï¼ˆå…¶å®è¿™é‡Œæœ¬æ¥åº”è¯¥åŠ ä¸Šä¸€ä¸ªå‚æ•°-iï¼Œç”¨æ¥è¡¨ç¤ºå…¥å£æ–‡ä»¶çš„è·¯å¾„ï¼Œä½†rollupæ˜¯ä¼šæŠŠæ²¡æœ‰åŠ å‚æ•°çš„æ–‡ä»¶é»˜è®¤ä¸ºæ˜¯å…¥å£æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è¿™é‡Œçœç•¥äº†è¿™ä¸ªå‚æ•°ï¼‰</p>

<p>ä½¿ç”¨å…¨å±€rollupè¿›è¡Œæ‰“åŒ…</p>

<p>æ˜¾ç¤ºå‡ºè¿™æ¡ä¿¡æ¯ä¹‹åï¼Œæˆ‘ä»¬å‘ç°ç›®å½•ä¸‹å·²ç»å¤šå‡ºäº†ä¸€ä¸ª dist.js æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶ï¼Œæˆ‘ä»¬å‘ç°é‡Œé¢çš„ä»£ç æ˜¯è¿™æ ·çš„</p>

<p>function logA() {
    console.log(â€˜function logA calledâ€™);
}</p>

<p>logA();
æ­¤æ—¶æˆ‘ä»¬å°±å·²ç»å®Œæˆäº†æ‰“åŒ…ä½œä¸šï¼Œå¯ä»¥å°†dist.jså¼•å…¥åˆ°HTMLæ–‡ä»¶æˆ–æ˜¯nodeæ¨¡å—ä¸­äº†</p>

<p>é¡¹ç›®æœ¬åœ°å®‰è£…ï¼š
è¿›å…¥åˆ°é¡¹ç›®ç›®å½•ï¼Œæ‰“å¼€å‘½ä»¤è¡Œè¾“å…¥npm install rollup â€“save-devï¼ŒæŠŠrollupåŠ å…¥åˆ°å¼€å‘ä¾èµ–ä¸­ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥./node_modules/.bin/rollup index.js -o dist.js</p>

<p>ä½¿ç”¨é¡¹ç›®æœ¬åœ°rollupè¿›è¡Œæ‰“åŒ…</p>

<p>æˆ–è€…åœ¨package.jsonæ–‡ä»¶ä¸­æ·»åŠ npm scriptså‘½ä»¤â€buildâ€: â€œrollup index.js -o dist.jsâ€ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥npm run buildæ¥è¿›è¡Œæ‰“åŒ…</p>

<p>ä½¿ç”¨é¡¹ç›®æœ¬åœ°rollupè¿›è¡Œæ‰“åŒ…</p>

<p>åœ¨æ‰“åŒ…å®Œæˆä¹‹åï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æ•ˆæœï¼Œæ–°å»ºä¸€ä¸ªindex.htmlæ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å¼•å…¥æˆ‘ä»¬æ‰“åŒ…å‡ºæ¥çš„dist.jsæ–‡ä»¶</p>

<p>&lt;!DOCTYPE html&gt;</p>
<html lang="en">
    <head>
        <title>rollup æ‰“åŒ…æµ‹è¯•</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body>
        <script src="./dist.js"></script>
    </body>
</html>
<p>ç”¨æµè§ˆå™¨æ‰“å¼€index.htmlæ–‡ä»¶ï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ§åˆ¶å°ä¸Šè¾“å‡ºäº†ä¸€è¡Œæ–‡å­—</p>

<p>rollupæ‰“åŒ…æ–‡ä»¶æµ‹è¯•</p>

<p>ä½¿ç”¨å‘½ä»¤è¡Œè¿è¡Œdist.jsæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°å‘½ä»¤è¡Œä¸­è¾“å‡ºäº†ä¸€è¡Œæ–‡å­—</p>

<p>rollupæ‰“åŒ…æ–‡ä»¶æµ‹è¯•</p>

<p>è¿™è¯´æ˜æˆ‘ä»¬çš„æ‰“åŒ…æ–‡ä»¶dist.jsæ˜¯å¯ä»¥è¿è¡Œçš„ï¼Œæ‰“åŒ…æˆåŠŸã€‚</p>

<p>PSï¼š</p>

<p>æ¥ä¸‹æ¥çš„demoä¸­ï¼Œé»˜è®¤åœ¨é¡¹ç›®å†…å®‰è£…äº†rollup
æ¥ä¸‹æ¥çš„demoä¸­ï¼Œéå¿…è¦æƒ…å†µä¸‹ä¸ä¼šå¯¹æ‰“åŒ…ç»“æœè¿›è¡Œè¿è¡Œç»“æœæµ‹è¯•ï¼Œè¯»è€…è‹¥éœ€è¦éªŒè¯æ‰“åŒ…æ•ˆæœï¼Œè¯·è‡ªå·±ç¼–å†™å…¶ä»–æµ‹è¯•ä»£ç ã€‚
demo1 ä½¿ç”¨rollupè¿›è¡Œæ¨¡å—åŒ–æ‰“åŒ…
åœ¨ä¹‹å‰æ‰“åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œå‘½ä»¤è¡Œä¸­è¾“å‡ºäº†ä¸€è¡ŒNo format option was supplied â€“ defaulting to â€˜esâ€™ï¼Œè¿™è¡¨ç¤ºrollupå¹¶æ²¡æœ‰æ”¶åˆ°ä»»ä½•æ¨¡å—åŒ–çš„æ ¼å¼æŒ‡ä»¤ï¼Œå› æ­¤ä¼šç”¨é»˜è®¤çš„esæ¨¡å—æ ‡å‡†æ¥å¯¹æ–‡ä»¶è¿›è¡Œæ‰“åŒ…ã€‚</p>

<p>å¦‚æœåœ¨demo0ä¸­çš„index.jsæ–‡ä»¶ä¸­æŠŠlogA()æ”¹æˆexport default logA()ï¼Œé‚£ä¹ˆrollupæœ€åçš„æ‰“åŒ…ç»“æœå°±ä¼šæ˜¯</p>

<p>function logA() {
    console.log(â€˜function logA calledâ€™);
}</p>

<p>var index = logA();</p>

<p>export default index;
æ˜¾ç„¶è¿™æ ·çš„ä»£ç æ˜¯ä¸èƒ½ç›´æ¥åœ¨æµè§ˆå™¨ç«¯å’Œnodeç«¯è¿è¡Œçš„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠåŸå…ˆçš„ES6æ¨¡å—è½¬åŒ–æˆæµè§ˆå™¨å’Œnodeæ”¯æŒçš„å½¢å¼ã€‚</p>

<p>é‚£ä¹ˆè¦å»å“ªé‡Œæ‰¾rollupæŠŠES6ä»£ç è½¬åŒ–æˆå…¶ä»–å½¢å¼çš„æ–¹æ³•å‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼Œä¸€æ˜¯å»rollupçš„å®˜ç½‘æ‰¾ç›¸å…³çš„èµ„æ–™ï¼ŒäºŒæ˜¯ä½¿ç”¨rollupå‘½ä»¤è¡Œçš„å¸®åŠ©å‘½ä»¤ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ç›¸å…³çš„å‚æ•°</p>

<p>æˆ‘ä»¬ä½¿ç”¨rollupå‘½ä»¤è¡Œçš„å¸®åŠ©å‘½ä»¤ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥rollup -h</p>

<p>rollupå‘½ä»¤è¡Œå¸®åŠ©</p>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç±»ä¼¼ç‰ˆæœ¬å·ï¼Œå¸®åŠ©ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶ç­‰ä¸€ç³»åˆ—å‚æ•°ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°-fè¿™ä¸ªå‚æ•°ï¼Œä»–çš„è¯´æ˜æ˜¯è¾“å‡ºçš„ç±»å‹ï¼ˆamdï¼Œcjsï¼Œesï¼Œiifeï¼Œumdï¼‰ï¼Œä»æ‹¬å·é‡Œçš„å†…å®¹æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨è¿™ä¸ªå‚æ•°å¯ä»¥ç¡®å®šæ‰“åŒ…å®Œåçš„æ–‡ä»¶çš„æ¨¡å—å¤„ç†æ–¹å¼ã€‚ï¼ˆå¦‚æœä½ è¿˜ä¸çŸ¥é“è¿™å‡ ç§æ¨¡å—ä¹‹é—´çš„åŒºåˆ«ï¼Œå»ºè®®å…ˆå»æ‰¾ä¸€ä¸‹ç›¸å…³çš„èµ„æ–™å­¦ä¹ ä¸€ä¸‹ï¼‰</p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨rollupæ¥æ‰“åŒ…ä¸€ä¸‹ï¼Œåœ¨demo0ä¸­çš„index.jsæ–‡ä»¶é‡Œå°†logA()æ”¹æˆexport default logA()ï¼Œåœ¨package.jsonæ–‡ä»¶ä¸­å†™å¥½ä¸åŒæ¨¡å—çš„æ‰“åŒ…å‘½ä»¤</p>

<p>â€œbuild:amdâ€: â€œrollup index.js -f amd -o ./dist/dist.amd.jsâ€,
â€œbuild:cjsâ€: â€œrollup index.js -f cjs -o ./dist/dist.cjs.jsâ€,
â€œbuild:esâ€: â€œrollup index.js -f es -o ./dist/dist.es.jsâ€,
â€œbuild:iifeâ€: â€œrollup index.js -f iife -n result -o ./dist/dist.iife.jsâ€,
â€œbuild:umdâ€: â€œrollup index.js -f umd -n result -o ./dist/dist.umd.jsâ€,
â€œbuild:allâ€: â€œnpm run build:amd &amp;&amp; npm run build:cjs &amp;&amp; npm run build:es &amp;&amp; npm run build:iife &amp;&amp; npm run build:umdâ€
åœ¨è¿™é‡Œæˆ‘ä»¬å‘ç°åœ¨è®¾ç½®æ¨¡å—ä¸ºiifeï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰å’Œumdæ—¶ï¼Œè¿˜åŠ ä¸Šäº†ä¸€ä¸ªå‚æ•°-nï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬å°†logA()çš„ç»“æœè®¾ç½®ä¸ºæ¨¡å—çš„è¾“å‡ºç»“æœï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨iifeå’Œumdæ—¶ï¼Œéœ€è¦äº‹å…ˆè®¾å®šæ¨¡å—çš„åç§°ï¼Œæ‰èƒ½è®©å…¶ä»–äººé€šè¿‡è¿™ä¸ªæ¨¡å—åç§°å¼•ç”¨åˆ°ä½ çš„æ¨¡å—çš„è¾“å‡ºç»“æœã€‚</p>

<p>åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥npm run build:allï¼Œè¿è¡Œæ‰€æœ‰æ‰“åŒ…å‘½ä»¤ï¼ŒæŸ¥çœ‹æ•ˆæœ</p>

<p>demo1æ‰“åŒ…ç»“æœ</p>

<p>å¯ä»¥çœ‹åˆ°å·²ç»è¾“å‡ºäº†5ç§ä¸åŒæ¨¡å—æ ‡å‡†çš„æ‰“åŒ…æ–‡ä»¶ï¼Œç”±äºå­—æ•°åŸå› ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åªæŸ¥çœ‹ä¸€ä¸ªæ‰“åŒ…æ–‡ä»¶ï¼ˆdist.iife.jsï¼‰çš„å†…å®¹</p>

<p>var result = (function () {
â€˜use strictâ€™;</p>

<p>function logA() {
    console.log(â€˜function logA calledâ€™);
}</p>

<p>var index = logA();</p>

<p>return index;</p>

<p>}());
å¯ä»¥çœ‹åˆ°æ‰€æœ‰ä»£ç éƒ½è¢«æ‰“åŒ…åˆ°äº†ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°ä¸­ï¼Œå¹¶ä¸”å°†å‡½æ•°çš„è¿”å›å€¼ï¼ˆæ¨¡å—çš„è¾“å‡ºå†…å®¹ï¼‰èµ‹å€¼ç»™äº†ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè€Œè¿™ä¸ªå…¨å±€å˜é‡çš„åç§°å°±æ˜¯æˆ‘ä»¬ä¹‹å‰è®¾ç½®çš„æ¨¡å—åç§°ã€‚</p>

<p>PSï¼š ä½¿ç”¨amdæ¨¡å—æ‰“åŒ…æ–¹å¼æ—¶ï¼Œè‹¥ä¸æŒ‡å®šæ¨¡å—åç§°ï¼Œåˆ™ä¼šæ‰“åŒ…æˆåŒ¿åå‡½æ•°ï¼Œè‹¥æƒ³æ‰“åŒ…æˆä¸€ä¸ªå…·åå‡½æ•°ï¼Œåˆ™éœ€è¦ä½¿ç”¨-uæˆ–â€“idæ¥æŒ‡å®šå…·åå‡½æ•°åç§°ã€‚</p>

<p>é™¤äº†-fä¹‹å¤–ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–çš„å‚æ•°å¯ä»¥ä½¿ç”¨ï¼Œçœ‹åˆ°è¿™é‡Œå¯èƒ½æœ‰äº›åŒå­¦ä¼šè§‰å¾—éº»çƒ¦äº†ï¼Œè¿™ä¹ˆå¤šå‚æ•°ç”¨èµ·æ¥å¥½éº»çƒ¦ï¼Œæ¯æ¬¡éƒ½è¦è¾“ä¸€é•¿ä¸²çš„å‘½ä»¤ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•æ¥æ§åˆ¶rollupçš„å‚æ•°é…ç½®å‘¢ï¼Ÿ</p>

<p>å½“ç„¶æœ‰ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å°è¯•ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥æ§åˆ¶rollupæ‰“åŒ…ã€‚</p>

<p>demo2 ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥è¿›è¡Œrollupæ‰“åŒ…
åˆ›å»ºä¸€ä¸ªdemo2ï¼Œæ²¿ç”¨ä¹‹å‰demo1çš„å†…å®¹ï¼Œæˆ‘ä»¬åœ¨demo2çš„é¡¹ç›®ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå–åä¸ºrollup.config.jsï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯rollupçš„é…ç½®æ–‡ä»¶äº†ï¼Œrollupæ ¹æ®é…ç½®æ–‡ä»¶çš„è¾“å‡ºé…ç½®æ¥è¿›è¡Œæ‰“åŒ…ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­è¾“å…¥é…ç½®ä»£ç :</p>

<p>export default {
  entry: â€˜index.jsâ€™,
  format: â€˜cjsâ€™,
  dest: â€˜./dist/dist.jsâ€™
}
entryè¡¨ç¤ºæ‰“åŒ…çš„å…¥å£æ–‡ä»¶ï¼Œformatè¡¨ç¤ºè¦æ‰“åŒ…æˆçš„æ¨¡å—ç±»å‹ï¼Œdestè¡¨ç¤ºè¾“å‡ºæ–‡ä»¶çš„åç§°è·¯å¾„</p>

<p>PSï¼š è‹¥ä½¿ç”¨iifeæˆ–umdæ¨¡å—æ‰“åŒ…ï¼Œéœ€è¦æ·»åŠ å±æ€§moduleNameï¼Œç”¨æ¥è¡¨ç¤ºæ¨¡å—çš„åç§°ï¼›è‹¥ç”¨amdæ¨¡å—æ‰“åŒ…ï¼Œå¯ä»¥é…ç½®amdç›¸å…³çš„å‚æ•°ï¼ˆä½¿ç”¨umdæ¨¡å—æ¨¡å¼æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨åˆ°amdç›¸å…³é…ç½®å‚æ•°ï¼‰ï¼š</p>

<p>amd: {
    id: â€˜amd-nameâ€™,   // amdå…·åå‡½æ•°åç§°
    define: â€˜defâ€™     // ç”¨æ¥ä»£æ›¿defineå‡½æ•°çš„å‡½æ•°åç§°
}
åœ¨è¿™é‡Œæˆ‘ä»¬å‘ç°é…ç½®æ–‡ä»¶ä¹Ÿæ˜¯ä½¿ç”¨äº†ES6è¯­æ³•ï¼Œè¿™æ˜¯å› ä¸ºrollupå¯ä»¥è‡ªå·±å¤„ç†é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥èƒ½å¤Ÿç›´æ¥ç”¨ES6çš„æ¨¡å—è¾“å‡ºï¼ˆå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨nodeçš„module.exportsæ–¹å¼æ¥è¾“å‡ºé…ç½®ã€‚</p>

<p>åœ¨package.jsonæ–‡ä»¶ä¸­ç¼–å†™npm scriptså‘½ä»¤</p>

<p>â€œbuildâ€: â€œrollup -câ€
-cè¿™ä¸ªå‚æ•°è¡¨ç¤ºä½¿ç”¨é…ç½®æ–‡ä»¶æ¥è¿›è¡Œæ‰“åŒ…ï¼Œè‹¥åé¢æ²¡æœ‰æŒ‡å®šä½¿ç”¨çš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„é…ç½®æ–‡ä»¶åç§°rollup.config.jsã€‚</p>

<p>åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥npm run buildï¼Œæ‰§è¡Œæ‰“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†æ‰“åŒ…æ–‡ä»¶dist.js</p>

<p>â€˜use strictâ€™;</p>

<p>function logA() {
    console.log(â€˜function logA calledâ€™);
}</p>

<p>var index = logA();</p>

<p>module.exports = index;
è¿›é˜¶ï¼š å½“rollupé…ç½®æ–‡ä»¶æœ€ç»ˆè¾“å‡ºçš„ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡è€Œæ˜¯ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œrollupä¼šæŠŠæ¯ä¸€ä¸ªæ•°ç»„å…ƒç´ å½“æˆä¸€ä¸ªé…ç½®è¾“å‡ºç»“æœï¼Œå› æ­¤å¯ä»¥åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶å†…è®¾ç½®å¤šç§è¾“å‡ºé…ç½®</p>

<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªindexB.jsæ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æˆ‘ä»¬å°†logAæ›¿æ¢ä¸ºlogBï¼Œå¹¶å°†rollupé…ç½®æ–‡ä»¶æ”¹ä¸ºï¼š</p>

<p>export default [{
  entry: â€˜index.jsâ€™,
  format: â€˜cjsâ€™,
  dest: â€˜./dist/distA.jsâ€™
},{
  entry: â€˜indexB.jsâ€™,
  format: â€˜iifeâ€™,
  moduleName: â€˜indexBâ€™,
  dest: â€˜./dist/distB.jsâ€™
}]
è¿è¡Œæ‰“åŒ…å‘½ä»¤ï¼Œå‘ç°åœ¨distç›®å½•ä¸‹ç”Ÿæˆäº†distA.jså’ŒdistB.jsä¸¤ä¸ªæ–‡ä»¶ï¼Œè¯´æ˜å¤šé¡¹é…ç½®æ‰“åŒ…æˆåŠŸã€‚</p>

<p>é™¤äº†ä¸Šé¢è¿™ç§è¾“å‡ºä¸€ä¸ªé…ç½®æ•°ç»„ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡é…ç½®targetå±æ€§æ¥è¾“å‡ºå¤šä¸ªæ‰“åŒ…æ–‡ä»¶ï¼š</p>

<p>export default {
  entry: â€˜index.jsâ€™,
  targets: [{
      dest: â€˜dist/bundle.cjs.jsâ€™,
      format: â€˜cjsâ€™
    },
    {
      dest: â€˜dist/bundle.umd.jsâ€™,
      moduleName: â€˜resâ€™,
      format: â€˜umdâ€™
    },
    {
      dest: â€˜dist/bundle.es.jsâ€™,
      format: â€˜esâ€™
    },
  ]
}
è¿™æ ·é…ç½®ä¼šåœ¨distç›®å½•ä¸‹é¢è¾“å‡ºbundle.cjs.jsï¼Œbundle.umd.jså’Œbundle.es.jsä¸‰ä¸ªæ‰“åŒ…æ–‡ä»¶ï¼ŒåŒæ—¶umdæ¨¡å—çš„åç§°ä¼šè¢«å®šä¹‰æˆresã€‚</p>

<p>demo3 ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œéšæ—¶æ‰“åŒ…
æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦é¢‘ç¹å¯¹æºæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœæ¯æ¬¡éƒ½è‡ªå·±æ‰‹åŠ¨è¾“ä¸€éæ‰“åŒ…å‘½ä»¤ï¼Œé‚£çœŸçš„æ˜¯è¦çƒ¦æ­»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨rollupæä¾›çš„ç›‘å¬åŠŸèƒ½ï¼Œå®‰è£…rollup-wacthæ¨¡å—ï¼Œå†åœ¨rollupå‘½ä»¤åé¢åŠ ä¸Š-wå‚æ•°ï¼Œå°±èƒ½è®©rollupç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œå³æ—¶æ‰“åŒ…ã€‚</p>

<p>å®‰è£…watchåŒ…ï¼š</p>

<p>npm i rollup-watch â€“save-dev
// or
yarn add rollup-watch â€“dev
ç¼–å†™npm scriptsï¼š</p>

<p>â€œdevâ€: â€œrollup -c -wâ€
æ‰§è¡Œnpm run devï¼Œçœ‹åˆ°ä¸‹é¢çš„æç¤ºï¼š</p>

<p>rollup ç›‘å¬æ–‡ä»¶å˜åŒ–</p>

<p>å¥½äº†ï¼Œè¿™ä¸ªæ—¶å€™ä½ å°±å¯ä»¥éšä¾¿ä¿®æ”¹ä½ çš„æºæ–‡ä»¶äº†ï¼Œrollupä¼šè‡ªåŠ¨ä¸ºä½ æ‰“åŒ…çš„ã€‚</p>

<p>PSï¼š è‹¥æ˜¯ä½ ä¸æƒ³ç›‘å¬æŸäº›æ–‡ä»¶ï¼Œåªè¦åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ ä¸Š</p>

<p>watch: {
    exclude: [â€˜path/to/file/which/you/want/to/ignoreâ€™]
}
å°±è¡Œäº†,å…¶ä¸­çš„excludeè¡¨ç¤ºä½ æƒ³è¦å¿½ç•¥çš„æ–‡ä»¶çš„è·¯å¾„ï¼ˆæ”¯æŒglobæ¨¡å¼åŒ¹é…)</p>

<p>demo4 æ˜¯æ—¶å€™å†™ES6äº†
ES6å¯ä»¥è¯´æ˜¯ç°ä»£JSå¼€å‘100%ä¼šç”¨åˆ°çš„æŠ€æœ¯äº†ï¼Œrollupè™½ç„¶æ”¯æŒäº†è§£æimportå’Œexportä¸¤ç§è¯­æ³•ï¼Œä½†æ˜¯å´ä¸ä¼šå°†å…¶ä»–çš„ES6ä»£ç è½¬åŒ–æˆES5ä»£ç ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç¼–å†™ES6ä»£ç çš„æ—¶å€™ï¼Œéœ€è¦å¼•å…¥æ’ä»¶æ¥æ”¯æŒES6ä»£ç çš„è§£æã€‚</p>

<p>å®‰è£…æ’ä»¶å’Œä½ éœ€è¦çš„babel presetï¼š
npm i rollup-plugin-babel babel-preset-es2015 â€“save-dev
// or
yarn add rollup-plugin-babel babel-preset-es2015 â€“dev
åˆ›å»º.babalrcæ–‡ä»¶ï¼š
{
  â€œpresetsâ€: [
    [â€œes2015â€, {
        â€œmodulesâ€: false
    }]
  ]
}
ä¹‹æ‰€ä»¥ä½¿ç”¨modules:falseè¿™ä¸ªå‚æ•°ï¼Œæ˜¯å› ä¸ºrollupé»˜è®¤æ˜¯é€šè¿‡ES6æ¨¡å—è¯­æ³•æ¥è§£ææ–‡ä»¶é—´çš„ä¾èµ–ï¼Œrollupé»˜è®¤æ˜¯ä¸æ”¯æŒè§£æcommon.jsçš„æ¨¡å—è§„èŒƒçš„ï¼ˆæ€ä¹ˆè®©rollupæ”¯æŒæˆ‘ä¼šåœ¨æ¥ä¸‹æ¥çš„demoä¸­è®²è§£ï¼‰ï¼Œå› æ­¤éœ€è¦è®©babelä¸è½¬åŒ–æ¨¡å—ç›¸å…³çš„è¯­æ³•ï¼Œä¸ç„¶rollupåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šæŠ¥é”™ã€‚</p>

<p>ç¼–å†™rollupé…ç½®æ–‡ä»¶ï¼š
import babel from â€˜rollup-plugin-babelâ€™;</p>

<p>export default [{
  entry: â€˜index.jsâ€™,
  format: â€˜iifeâ€™,
  dest: â€˜./dist/dist.jsâ€™,
  plugins: [
    babel({
      exclude: â€˜node_modules/**â€™
    })
  ]
}]
rollupçš„é…ç½®æ–‡ä»¶çš„pluginså±æ€§å¯ä»¥è®©ä½ æ·»åŠ åœ¨rollupæ‰“åŒ…è¿‡ç¨‹ä¸­æ‰€è¦ç”¨åˆ°çš„æ’ä»¶ï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œæ’ä»¶çš„æ·»åŠ é¡ºåºå†³å®šäº†å®ƒä»¬åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­çš„ä½¿ç”¨é¡ºåºï¼Œå› æ­¤è¦æ³¨æ„é…ç½®æ–‡ä»¶çš„æ’ä»¶ä½¿ç”¨é¡ºåºã€‚</p>

<p>ç¼–å†™ES6ä»£ç 
åœ¨è¿™é‡Œæˆ‘ä»¬æ–°å»ºä¸‰ä¸ªæ–‡ä»¶ï¼Œä¸¤ä¸ªç±»Personå’ŒManå’Œä¸€ä¸ªå…¥å£æ–‡ä»¶index.js</p>

<p>export default class Person {
    constructor (name, gender = â€˜ç”·â€™) {
        this.name = name
        this.gender = gender
    }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>say () {
    console.log(`æˆ‘çš„åå­—æ˜¯${this.name}ï¼Œæ˜¯ä¸€ä¸ª${this.gender}ç”Ÿ`)
} } import Person from './Person'
</code></pre></div></div>

<p>export default class Man extends Person {
    constructor (name) {
        super(name, â€˜ç”·â€™)
    }
}
import Man from â€˜./src/Manâ€™</p>

<p>new Man(â€˜KainStarâ€™).say()
è¿è¡Œæ‰“åŒ…å‘½ä»¤npm run build
rollup babelæ‰“åŒ…1</p>

<p>å¯ä»¥çœ‹åˆ°rollupè¾“å‡ºäº†ä¸€æ®µæç¤ºæ–‡å­—ï¼Œæˆ‘ä»¬å…ˆä¸å»ç®¡å®ƒï¼Œå…ˆçœ‹çœ‹æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶èƒ½ä¸èƒ½è¿è¡Œï¼Œæ‰§è¡Œnode dist/dist.js</p>

<p>rollup babelæ‰“åŒ…2</p>

<p>å¯ä»¥çœ‹åˆ°ä»£ç è¿è¡ŒæˆåŠŸäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å›æ¥ç»§ç»­çœ‹ä¹‹å‰çš„æç¤ºæ–‡å­—ï¼Œå®ƒçš„æ„æ€æ˜¯â€™classCallCheckâ€™è¿™ä¸ªbabel helperå‡½æ•°ä½¿ç”¨äº†å¤šæ¬¡ï¼Œrollupæ¨èæˆ‘ä»¬ä½¿ç”¨external-helpersè¿™ä¸ªæ’ä»¶æˆ–es2015-rollupè¿™ä¸ªbabel-presetæ¥ç®€åŒ–æ‰“åŒ…å‡ºæ¥çš„ä»£ç ã€‚</p>

<p>æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æ‰“åŒ…å‡ºæ¥çš„dist.jsæ–‡ä»¶ï¼Œå‘ç°_classCallCheckè¿™ä¸ªå‡½æ•°è¢«å®šä¹‰äº†ä¸¤æ¬¡ï¼Œåˆ†åˆ«è¢«å–åä¸º_classCallCheckå’Œ_classCallCheck$1ï¼Œè¿™æ ·çš„ä»£ç è‚¯å®šæ˜¯å¯ä»¥ç®€åŒ–çš„ï¼Œå› æ­¤æˆ‘ä»¬å¼•å…¥external-helpersè¿™ä¸ªæ’ä»¶ï¼š</p>

<p>npm i babel-plugin-external-helpers â€“save-dev
// or
yarn add babel-plugin-external-helpers â€“dev
ä¿®æ”¹.babelrcæ–‡ä»¶ä¸º</p>

<p>{
    â€œpresetsâ€: [
        [â€œes2015â€, {
            â€œmodulesâ€: false
        }]
    ],
    â€œpluginsâ€: [
        â€œexternal-helpersâ€
    ]
}
æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨babelé…ç½®</p>

<p>plugins: [
    babel({
        plugins: [â€˜external-helpersâ€™]
    })
]
æ³¨æ„ï¼ åœ¨rollup-plugin-babelçš„å®˜æ–¹githubä»“åº“ä¸­æœ‰ä¸€æ®µé…ç½®æ˜¯è¿™æ ·çš„ï¼š</p>

<p>plugins: [
    babel({
      plugins: [â€˜external-helpersâ€™],
      externalHelpers: true
    })
]
è¿™æ®µé…ç½®çš„ä½¿ç”¨è¦æ±‚æ˜¯ä½ éœ€è¦è®¾ç½®å…¨å±€çš„babelHelperså¯¹è±¡ï¼Œä»¥æ­¤æ¥å°†æ‰“åŒ…æ–‡ä»¶ä¸­çš„babelç›¸å…³ä»£ç åˆ é™¤ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦ä½¿ç”¨externalHelpersè¿™ä¸ªå±æ€§ã€‚</p>

<p>PSï¼š ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨babel-preset-es2015-rollupè¿™ä¸ªåŒ…ï¼ˆæ­é…babel-coreï¼‰ï¼Œå®ƒé›†æˆäº†babel-preset-es2015ï¼Œbabel-plugin-transform-es2015-modules-commonjså’Œbabel-plugin-external-helpersä¸‰ä¸ªæ¨¡å—ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼Œåªè¦å°†.babelrcæ–‡ä»¶ä¿®æ”¹æˆ{ â€œpresetsâ€: [â€œes2015-rollupâ€] }å°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p>

<p>demo5 è§£æcjsï¼Œæ‰“åŒ…ç¬¬ä¸‰æ–¹æ¨¡å—
æœ‰æ—¶å€™æˆ‘ä»¬ä¼šå¼•å…¥ä¸€äº›å…¶ä»–æ¨¡å—çš„æ–‡ä»¶ï¼ˆç¬¬ä¸‰æ–¹çš„æˆ–æ˜¯è‡ªå·±ç¼–å†™çš„ï¼‰ï¼Œä½†æ˜¯è¿™äº›ç¬¬ä¸‰æ–¹çš„æ¨¡å—ä¸ºäº†èƒ½å¤Ÿç›´æ¥ä½¿ç”¨ï¼Œå¾€å¾€ä¸æ˜¯ES6æ¨¡å—è€Œæ˜¯ç”¨commonjsçš„æ¨¡å—æ–¹å¼ç¼–å†™çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å°†commonjsçš„æ¨¡å—è½¬åŒ–ä¸ºES6æ¨¡å—ï¼Œè¿™æ ·æ‰èƒ½è®©rollupè¿›è¡Œæ­£ç¡®çš„è§£æã€‚</p>

<p>è§£æcommonjs
è§£æcommonjséœ€è¦å¼•å…¥ä¸€ä¸ªrollupæ’ä»¶â€”â€”rollup-plugin-commonjs</p>

<p>å®‰è£…æ’ä»¶</p>

<p>npm i rollup-plugin-commonjs â€“save-dev
// or
yarn add rollup-plugin-commonjs â€“dev
åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®æ’ä»¶</p>

<p>import commonjs from â€˜rollup-plugin-commonjsâ€™</p>

<p>export default {
  entry: â€˜index_cjs.jsâ€™,
  format: â€˜iifeâ€™,
  dest: â€˜./js/dist_cjs.jsâ€™,
  plugins: [
    commonjs()
  ]
}
ç¼–å†™cjsæ¨¡å—çš„æ–‡ä»¶</p>

<p>exports.logA = function logA() {
    console.log(â€˜function logA calledâ€™)
}</p>

<p>exports.logB = function logB() {
    console.log(â€˜function logB calledâ€™)
}
æ‰§è¡Œæ‰“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°æ‰“åŒ…æˆåŠŸï¼Œä¹Ÿæ²¡æœ‰è¾“å‡ºä»»ä½•æç¤ºä¿¡æ¯</p>

<p>rollup cjsæ‰“åŒ…</p>

<p>æ‰“åŒ…ç¬¬ä¸‰æ–¹æ¨¡å—
åœ¨æ‰“åŒ…ç¬¬ä¸‰æ–¹æ¨¡å—çš„è¿‡ç¨‹ä¸­ï¼Œrollupæ— æ³•ç›´æ¥è§£ænpmæ¨¡å—ï¼Œå› æ­¤éœ€è¦å¼•å…¥æ’ä»¶rollup-plugin-node-resolveå¹¶é…åˆä¹‹å‰çš„commonjsæ’ä»¶æ¥è§£æè¿™äº›ç¬¬ä¸‰æ–¹æ¨¡å—</p>

<p>å®‰è£…æ’ä»¶å’Œç¬¬ä¸‰æ–¹æ¨¡å—</p>

<p>npm i rollup-plugin-node-resolve lodash â€“save-dev
// or
yarn add rollup-plugin-node-resolve lodash â€“dev
åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®æ’ä»¶</p>

<p>import commonjs from â€˜rollup-plugin-commonjsâ€™
import resolve from â€˜rollup-plugin-node-resolveâ€™</p>

<p>export default {
  entry: â€˜index_module.jsâ€™,
  format: â€˜iifeâ€™,
  dest: â€˜./js/dist_module.jsâ€™,
  plugins: [
    resolve({
      jsnext: true,
      main: true,
      browser: true
    }),
    commonjs()
  ]
}
jsnextè¡¨ç¤ºå°†åŸæ¥çš„nodeæ¨¡å—è½¬åŒ–æˆES6æ¨¡å—ï¼Œmainå’Œbrowseråˆ™å†³å®šäº†è¦å°†ç¬¬ä¸‰æ–¹æ¨¡å—å†…çš„å“ªäº›ä»£ç æ‰“åŒ…åˆ°æœ€ç»ˆæ–‡ä»¶ä¸­ã€‚</p>

<p>ç”±äºcommonjså’Œnode-resolveä¸­çš„é…ç½®å±æ€§å¾ˆå¤šï¼Œå› æ­¤ä¸ä¸€ä¸€è§£é‡Šï¼Œå¸Œæœ›äº†è§£æ›´å¤šçš„åŒå­¦å¯ä»¥å»å®˜æ–¹ä»“åº“æŸ¥çœ‹è¯´æ˜ã€‚</p>

<p>ç¼–å†™å…¥å£æ–‡ä»¶</p>

<p>import compact from â€˜lodash/compactâ€™</p>

<p>const array = [0, 1, false, 2, â€˜â€™, 3]
const compctedArray = compact(array)
console.log(compctedArray)
åœ¨è¿™é‡Œæˆ‘ä»¬åªå¼•ç”¨äº†lodashä¸­çš„compactæ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨æœ€ç»ˆä»£ç é‡Œï¼Œåº”è¯¥ä¹Ÿåªä¼šæ·»åŠ compactæ–¹æ³•çš„ä»£ç ã€‚</p>

<p>æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼ŒæŸ¥çœ‹æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶ï¼š</p>

<p>(function () {
â€˜use strictâ€™;</p>

<p>/**</p>
<ul>
  <li>Creates an array with all falsey values removed. The values <code class="language-plaintext highlighter-rouge">false</code>, <code class="language-plaintext highlighter-rouge">null</code>,</li>
  <li><code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">""</code>, <code class="language-plaintext highlighter-rouge">undefined</code>, and <code class="language-plaintext highlighter-rouge">NaN</code> are falsey.
 *</li>
  <li>@static</li>
  <li>@memberOf _</li>
  <li>@since 0.1.0</li>
  <li>@category Array</li>
  <li>@param {Array} array The array to compact.</li>
  <li>@returns {Array} Returns the new array of filtered values.</li>
  <li>@example
 *</li>
  <li>_.compact([0, 1, false, 2, â€˜â€™, 3]);</li>
  <li>// =&gt; [1, 2, 3]
 */
function compact(array) {
  var index = -1,
   length = array == null ? 0 : array.length,
   resIndex = 0,
   result = [];</li>
</ul>

<p>while (++index &lt; length) {
    var value = array[index];
    if (value) {
      result[resIndex++] = value;
    }
  }
  return result;
}</p>

<p>var compact_1$1 = compact;</p>

<p>const array = [0, 1, false, 2, â€˜â€™, 3];
const compctedArray = compact_1$1(array);
console.log(compctedArray);</p>

<p>}());
ç¡®å®åªæ·»åŠ äº†compactæ–¹æ³•çš„ä»£ç ï¼Œè€Œæ²¡æœ‰å°†lodashå…¨éƒ¨å¼•å…¥ã€‚</p>

<p>demo6 ä¸è¦æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸ºrollupè®¾ç½®å¤–éƒ¨æ¨¡å—å’Œå…¨å±€å˜é‡
åœ¨å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå¼•å…¥å…¶ä»–çš„æ¨¡å—ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆä¸æƒ³æŠŠå®ƒä»¬æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œæƒ³è®©ä»–ä»¬ä½œä¸ºå•ç‹¬çš„æ¨¡å—ï¼ˆæˆ–æ–‡ä»¶ï¼‰æ¥ä½¿ç”¨ï¼Œæ–¹ä¾¿æµè§ˆå™¨ç«¯è¿›è¡Œç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„externalå±æ€§äº†</p>

<p>æˆ‘ä»¬åœ¨demo5çš„åŸºç¡€ä¸Šï¼ŒæŠŠjqueryå®‰è£…åˆ°ç¬¬ä¸‰æ–¹æ¨¡å—ä¸­</p>

<p>npm i jquery â€“save-dev
// or
yarn add jquery â€“dev
å°†é…ç½®æ–‡ä»¶æ”¹æˆ</p>

<p>import commonjs from â€˜rollup-plugin-commonjsâ€™
import resolve from â€˜rollup-plugin-node-resolveâ€™</p>

<p>export default {
  entry: â€˜index.jsâ€™,
  format: â€˜iifeâ€™,
  dest: â€˜./js/dist.jsâ€™,
  external: [â€˜jqueryâ€™],
  plugins: [
    resolve({
      jsnext: true,
      main: true,
      browser: true
    }),
    commonjs()
  ]
}
externalç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ¨¡å—æ˜¯å¦è¦è¢«å½“æˆå¤–éƒ¨æ¨¡å—ä½¿ç”¨ï¼Œå±æ€§çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„æˆ–ä¸€ä¸ªæ–¹æ³•ï¼Œå½“ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„æ—¶ï¼Œæ‰€æœ‰æ•°ç»„å†…çš„æ¨¡å—åç§°éƒ½ä¼šè¢«å½“æˆæ˜¯å¤–éƒ¨æ¨¡å—ï¼Œä¸ä¼šè¢«æ‰“åŒ…åˆ°æœ€ç»ˆæ–‡ä»¶ä¸­</p>

<p>å½“ä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œæ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°idï¼Œè¡¨ç¤ºè§£æçš„æ¨¡å—çš„åç§°ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è§£ææ–¹å¼ï¼Œè‹¥æ˜¯è¦å½“åšå¤–éƒ¨æ¨¡å—ä¸æ‰“åŒ…åˆ°æœ€ç»ˆæ–‡ä»¶ä¸­ï¼Œåˆ™è¿”å›trueï¼Œè‹¥è¦ä¸€èµ·æ‰“åŒ…åˆ°æœ€ç»ˆæ–‡ä»¶ä¸­ï¼Œåˆ™è¿”å›false</p>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬æŠŠjqueryå½“æˆä¸€ä¸ªå¤–éƒ¨æ¨¡å—ï¼Œæ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼š</p>

<p>rollup æ·»åŠ å¤–éƒ¨æ¨¡å—</p>

<p>æ£€æŸ¥æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å‘ç°lodashçš„compactæ–¹æ³•ä¾æ—§è¢«æ‰“åŒ…è¿›äº†æœ€ç»ˆæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯jqueryå´æ²¡æœ‰è¢«æ‰“åŒ…è¿›å»ï¼Œè€Œæ˜¯ä»¥$çš„å…¨å±€å˜é‡å½¢å¼è¢«ä¼ å…¥åˆ°äº†ç«‹å³æ‰§è¡Œå‡½æ•°ä¸­ã€‚</p>

<p>åœ¨è¿™é‡Œrollupåˆç»™æˆ‘ä»¬è¾“å‡ºäº†ä¸€æ¡æç¤ºä¿¡æ¯ï¼Œæ„æ€æ˜¯æˆ‘ä»¬æ²¡æœ‰åœ¨é…ç½®æ–‡ä»¶ä¸­ç»™å¤–éƒ¨æ¨¡å—jqueryè®¾ç½®å…¨å±€å˜é‡åç§°ï¼Œå› æ­¤rollupè‡ªå·±çŒœæµ‹äº†ä¸€ä¸ªåç§°$ï¼Œå½“æˆæ˜¯ä¾èµ–çš„å…¨å±€å˜é‡åã€‚</p>

<p>å¦‚æœç›´æ¥ä½¿ç”¨å…¨å±€çš„
çš„
è¯
ï¼Œ
å¯
èƒ½
ä¼š
å› 
ä¸º
å˜
é‡
è¢«å…¶ä»–å¼•å…¥çš„ä»£ç è¦†ç›–è€ŒæŠ¥é”™ï¼Œå› æ­¤æˆ‘ä»¬è¦å°†$æ›¿æ¢ä¸ºä¸å®¹æ˜“å†²çªçš„jQueryå˜é‡ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ globalså±æ€§ï¼š</p>

<p>globals: {
    jquery: â€˜jQueryâ€™
}
globalsçš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œkeyè¡¨ç¤ºä½¿ç”¨çš„æ¨¡å—åç§°ï¼ˆnpmæ¨¡å—åï¼‰ï¼Œvalueè¡¨ç¤ºåœ¨æ‰“åŒ…æ–‡ä»¶ä¸­å¼•ç”¨çš„å…¨å±€å˜é‡åï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°±æ˜¯æŠŠjqueryæ¨¡å—çš„å…¨å±€å˜é‡åè®¾ç½®ä¸ºjQueryï¼Œé‡æ–°æ‰“åŒ…</p>

<p>åœ¨é‡æ–°æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å‘ç°æœ€åä¼ å…¥çš„å‚æ•°å·²ç»ç”±$å˜ä¸ºäº†jQueryï¼Œè€Œä¸”rollupä¹Ÿæ²¡æœ‰è¾“å‡ºæç¤ºä¿¡æ¯ã€‚</p>

<p>demo7 æ‰“åŒ…nodeå†…ç½®æ¨¡å—
æœ‰æ—¶å€™æˆ‘ä»¬æƒ³è¦åœ¨æµè§ˆå™¨ç«¯ä½¿ç”¨nodeè‡ªå¸¦çš„ä¸€äº›å†…ç½®æ¨¡å—ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šä½¿ç”¨browserifyè¿™ä¸ªå·¥å…·æ¥æ‰“åŒ…ï¼Œä½†æ˜¯browserifyæ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶å®åœ¨å¤ªå¤§ï¼Œå› æ­¤æˆ‘ä»¬ç”¨rollupé€‰æ‹©æ€§åœ°å¯¼å…¥æˆ‘ä»¬éœ€è¦çš„nodeå†…ç½®æ¨¡å—</p>

<p>å®‰è£…æ’ä»¶</p>

<p>npm i rollup-plugin-node-builtins â€“save-dev
// or
yarn add rollup-plugin-node-builtins â€“dev
PSï¼š node-builtinså¯¹ä¸åŒçš„nodeå†…ç½®æ¨¡å—æ”¯æŒä¸åŒï¼Œæœ‰äº›æ¨¡å—å¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–çš„æ’ä»¶ï¼ˆä¾‹å¦‚rollup-plugin-node-globalsï¼‰æ‰èƒ½æ­£å¸¸æ‰“åŒ…ï¼Œå…·ä½“çš„æ”¯æŒæƒ…å†µå¯ä»¥æŸ¥çœ‹node-builtinsçš„å®˜æ–¹ä»“åº“ã€‚</p>

<p>ç¼–å†™é…ç½®æ–‡ä»¶</p>

<p>import builtins from â€˜rollup-plugin-node-builtinsâ€™</p>

<p>export default {
  entry: â€˜index.jsâ€™,
  format: â€˜iifeâ€™,
  dest: â€˜./dist/dist.jsâ€™,
  plugins: [
    builtins()
  ]
}
ç¼–å†™å…¥å£æ–‡ä»¶</p>

<p>import { join } from â€˜pathâ€™</p>

<p>const path_base = â€˜E://nodeâ€™
const path_joined = join(path_basem, â€˜binâ€™)
console.log(path_joined)
åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨nodeå†…ç½®çš„pathæ¨¡å—ï¼Œè¿è¡Œæ‰“åŒ…å‘½ä»¤ï¼Œå‘ç°dist.jsæ–‡ä»¶ä¸­å¼•å…¥äº†é¢å¤–çš„100å¤šè¡Œä»£ç ï¼Œè¿™100å¤šè¡Œä»£ç å°±å®ç°äº†pathæ¨¡å—çš„joinæ–¹æ³•ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚</p>

<p>PSï¼š æˆ‘å»ºè®®ï¼Œå¦‚æœä¸æ˜¯å¿…è¦çš„æƒ…å†µï¼Œæœ€å¥½èƒ½å¤Ÿä½¿ç”¨å…¶ä»–äººç¼–å†™çš„ç¬¬ä¸‰æ–¹å®ç°åº“æˆ–è‡ªå·±é€ è½®å­å®ç°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨nodeå†…ç½®çš„æ¨¡å—ï¼Œå› ä¸ºåœ¨å¼•ç”¨æŸäº›æ¨¡å—æ—¶ï¼Œnode-builtinså¯èƒ½ä¼šå¼•å…¥è¿‡å¤šçš„ä»£ç ï¼Œè¿™æ ·ä¼šå¤§å¤§å¢åŠ æœ€åæ‰“åŒ…çš„æ–‡ä»¶çš„å¤§å°ï¼Œä½¿ç”¨ä»–äººçš„ç¬¬ä¸‰æ–¹åº“æˆ–è‡ªå·±çš„å®ç°å¯æ§æ€§æ›´é«˜</p>

<p>demo8 é…åˆCDNæ¥ä½¿ç”¨rollup
æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨CDNæœåŠ¡å™¨ä¸Šçš„jsæ–‡ä»¶ï¼Œä½†æ˜¯åˆä¸æƒ³åœ¨æœ¬åœ°å®‰è£…ä¸€ä¸ªç›¸åŒçš„æ¨¡å—ï¼ˆä¹Ÿæœ‰å¯èƒ½æ²¡æœ‰å¯¹åº”çš„æ¨¡å—ï¼‰ï¼Œå¯èƒ½åœ¨ç‰ˆæœ¬å‡çº§çš„æ—¶å€™ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨rollupçš„pathså±æ€§äº†ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥å¸®åŠ©ä½ æŠŠä¾èµ–çš„ä»£ç æ–‡ä»¶åœ°å€æ³¨å…¥åˆ°æ‰“åŒ…ä¹‹åçš„æ–‡ä»¶é‡Œã€‚</p>

<p>ç¼–å†™é…ç½®æ–‡ä»¶</p>

<p>export default {
  entry: â€˜index.jsâ€™,
  format: â€˜amdâ€™,
  dest: â€˜./dist/dist.jsâ€™,
  external: [â€˜jqueryâ€™],
  paths: {
    jquery: â€˜https://cdn.bootcss.com/jquery/3.2.1/jquery.jsâ€™
  }
}
åœ¨è¿™é‡Œæˆ‘ä»¬è¦ä½¿ç”¨cdnä¸Šçš„jqueryæ–‡ä»¶ï¼Œpathså±æ€§çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–ç”¨æ³•ä¸externalå±æ€§æ–¹æ³•ç›¸ä¼¼çš„æ–¹æ³•ï¼ˆåªæ˜¯è¿”å›çš„ä¸æ˜¯booleanå€¼è€Œæ˜¯æ–‡ä»¶çš„åœ°å€ï¼‰ã€‚è‹¥ä½¿ç”¨å¯¹è±¡æ¥è¡¨ç¤ºï¼Œåˆ™keyå€¼ä¸ºéœ€è¦å¼•å…¥çš„æ¨¡å—åç§°ï¼Œvalueå€¼ä¸ºå¯¹åº”çš„æ–‡ä»¶åœ°å€</p>

<p>ç¼–å†™æºæ–‡ä»¶</p>

<p>import $ from â€˜jqueryâ€™</p>

<p>$(â€˜#pâ€™).html(â€˜rollup ä½¿ç”¨pathså±æ€§é…åˆCDNâ€™)
æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼Œæœ€åæ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶å†…å®¹æ˜¯ï¼š</p>

<p>define([â€˜https://cdn.bootcss.com/jquery/3.2.1/jquery.jsâ€™], function ($) { â€˜use strictâ€™;</p>

<p>$ = $ &amp;&amp; $.hasOwnProperty(â€˜defaultâ€™) ? $[â€˜defaultâ€™] : $;</p>

<p>$(â€˜#pâ€™).html(â€˜rollup ä½¿ç”¨pathså±æ€§é…åˆCDNâ€™);</p>

<p>});
å¯ä»¥çœ‹åˆ°rollupå·²ç»æŠŠæˆ‘ä»¬éœ€è¦çš„CDNåœ°å€ä½œä¸ºä¾èµ–åŠ å…¥åˆ°äº†æ‰“åŒ…æ–‡ä»¶ä¸­ã€‚</p>

<p>demo9 æœ€å°åŒ–ä½ çš„ä»£ç 
ä»£ç å‘å¸ƒæ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæŠŠè‡ªå·±çš„ä»£ç å‹ç¼©åˆ°æœ€å°ï¼Œä»¥å‡å°‘ç½‘ç»œè¯·æ±‚ä¸­çš„ä¼ è¾“æ–‡ä»¶å¤§å°ã€‚</p>

<p>rollupçš„æ’ä»¶rollup-plugin-uglifyå°±æ˜¯æ¥å¸®åŠ©ä½ å‹ç¼©ä»£ç çš„ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±ç”¨è¿™ä¸ªæ’ä»¶æ¥å‹ç¼©ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç </p>

<p>npm i rollup-plugin-uglify â€“save-dev
// or
yarn add rollup-plugin-uglify â€“dev
ç¼–å†™é…ç½®æ–‡ä»¶</p>

<p>import uglify from â€˜rollup-plugin-uglifyâ€™</p>

<p>export default {
  entry: â€˜index.jsâ€™,
  format: â€˜iifeâ€™,
  dest: â€˜./dist/dist.jsâ€™,
  plugins: [
    uglify()
  ]
}
è¿è¡Œæ‰“åŒ…å‘½ä»¤ï¼ŒæŸ¥çœ‹dist.jsæ–‡ä»¶ï¼Œå‘ç°ä»£ç å·²ç»è¢«å‹ç¼©äº†</p>

<p>ä½†æ˜¯ï¼Œå‹ç¼©è¿‡çš„ä»£ç åœ¨debugæ—¶ä¼šå¸¦æ¥å¾ˆå¤§çš„ä¸ä¾¿ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨å‹ç¼©ä»£ç çš„åŒæ—¶ç”Ÿæˆä¸€ä¸ªsourceMapæ–‡ä»¶</p>

<p>å¹¸è¿çš„æ˜¯ï¼Œrollupè‡ªå·±å°±æ”¯æŒsourceMapæ–‡ä»¶çš„ç”Ÿæˆï¼Œä¸éœ€è¦æˆ‘ä»¬å»å¼•å…¥å…¶ä»–æ’ä»¶ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ ä¸Šï¼š</p>

<p>sourceMap: true
å°±å¯ä»¥äº†ã€‚</p>

<p>é‡æ–°æ‰“åŒ…ï¼Œæˆ‘ä»¬å‘ç°ä¸ä»…ç”Ÿæˆäº†dist.js.mapæ–‡ä»¶ï¼Œè€Œä¸”distæ–‡ä»¶æœ€ååŠ ä¸Šäº†ä¸€è¡Œ//# sourceMappingURL=dist.js.mapï¼Œå¹¶ä¸”åœ¨æµè§ˆå™¨ä¸­å¯ä»¥æ­£ç¡®åŠ è½½æºæ–‡ä»¶</p>

<p>rollup sourceMap</p>

<p>PSï¼š è‹¥æ˜¯å°†sourceMapå±æ€§çš„å€¼è®¾ç½®ä¸ºinlineï¼Œåˆ™ä¼šå°†sourceMapçš„å†…å®¹æ·»åŠ åˆ°æ‰“åŒ…æ–‡ä»¶çš„æœ€åã€‚</p>

<p>demo10 ä¸ºä½ çš„ä»£ç æ·»eslintæ£€æŸ¥
åœ¨å¤§å‹å·¥ç¨‹çš„å›¢é˜Ÿå¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯å›¢é˜Ÿä»£ç é£æ ¼çš„ä¸€è‡´æ€§ï¼Œå› æ­¤éœ€è¦å¼•å…¥eslintï¼Œè€Œä¸”åœ¨æ‰“åŒ…æ—¶éœ€è¦æ£€æµ‹æºæ–‡ä»¶æ˜¯å¦ç¬¦åˆeslintè®¾ç½®çš„è§„èŒƒï¼Œè‹¥æ˜¯ä¸ç¬¦åˆåˆ™æŠ›å‡ºå¼‚å¸¸å¹¶åœæ­¢æ‰“åŒ…ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨rollupçš„eslintæ’ä»¶rollup-plugin-eslint:</p>

<p>å®‰è£…æ’ä»¶</p>

<p>npm i eslint rollup-plugin-eslint â€“save-dev
// or
yarn add eslint rollup-plugin-eslint â€“dev
ç¼–å†™eslinté…ç½®æ–‡ä»¶.eslintrc</p>

<p>{
    â€œenvâ€: {
        â€œbrowserâ€: true,
        â€œcommonjsâ€: true,
        â€œes6â€: true,
        â€œnodeâ€: true
    },
    â€œparserOptionsâ€: {
        â€œecmaFeaturesâ€: {
            â€œjsxâ€: false
        },
        â€œsourceTypeâ€: â€œmoduleâ€
    },
    â€œrulesâ€: {
        â€œsemiâ€: [â€œerrorâ€,â€neverâ€]
    }
}
åœ¨è¿™é‡Œæˆ‘ä»¬å¼ºåˆ¶è¦æ±‚ä¸ä½¿ç”¨åˆ†å·ï¼Œç„¶ååœ¨æºæ–‡ä»¶ä¸­åŠ ä¸Šä¸€ä¸ªåˆ†å·</p>

<p>foo(element);
ç¼–å†™rollupé…ç½®æ–‡ä»¶</p>

<p>import eslint from â€˜rollup-plugin-eslintâ€™;</p>

<p>export default {
  entry: â€˜./src/index.jsâ€™,
  format: â€˜iifeâ€™,
  dest: â€˜./dist/dist.jsâ€™,
  plugins: [
    eslint({
      throwOnError: true,
      throwOnWarning: true,
      include: [â€˜src/<strong>â€™],
      exclude: [â€˜node_modules/</strong>â€™]
    })
  ]
}
eslintæ’ä»¶æœ‰ä¸¤ä¸ªå±æ€§éœ€è¦è¯´æ˜ï¼šthrowOnErrorå’ŒthrowOnWarningè®¾ç½®ä¸ºtrueæ—¶ï¼Œå¦‚æœåœ¨eslintçš„æ£€æŸ¥è¿‡ç¨‹ä¸­å‘ç°äº†erroræˆ–warningï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œé˜»æ­¢æ‰“åŒ…ç»§ç»­æ‰§è¡Œï¼ˆå¦‚æœè®¾ç½®ä¸ºfalseï¼Œå°±åªä¼šè¾“å‡ºeslintæ£€æµ‹ç»“æœï¼Œè€Œä¸ä¼šåœæ­¢æ‰“åŒ…ï¼‰</p>

<p>æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼Œå‘ç°eslintåœ¨è¾“å‡ºäº†æ£€æŸ¥ç»“æœä¹‹åæŠ›å‡ºäº†å¼‚å¸¸ï¼Œè€Œä¸”dist.jsæ–‡ä»¶ä¹Ÿæ²¡æœ‰ç”Ÿæˆ</p>

<p>rollup eslintæŠ›å‡ºå¼‚å¸¸</p>

<p>åˆ é™¤index.jsæ–‡ä»¶ä¸­çš„åˆ†å·ï¼Œé‡æ–°æ‰“åŒ…ï¼Œå‘ç°æ‰“åŒ…æˆåŠŸ</p>

<p>è¿›é˜¶ï¼š åœ¨å¹³æ—¶çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨IDEæˆ–ç¼–è¾‘å™¨çš„eslintæ’ä»¶ï¼Œä»¥ä¾¿ææ—©å‘ç°é—®é¢˜ï¼Œä½†æ˜¯æœ‰æ—¶å€™è¿™äº›æ’ä»¶ä¼šå»æ£€æŸ¥æ‰“åŒ…å®Œçš„æ–‡ä»¶ï¼Œå¯¼è‡´ä½ çš„æç¤ºæ¡†é‡Œä¸€ç›´ä¼šæœ‰eslintæ£€æµ‹åˆ°é”™è¯¯çš„æ¶ˆæ¯</p>

<p>æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œä¸€æ˜¯åˆ›å»ºä¸€ä¸ª.eslintignoreæ–‡ä»¶ï¼Œå°†æ‰“åŒ…æ–‡ä»¶åŠ è¿›å»ï¼Œè®©eslintå¿½ç•¥è¿™ä¸ªæ–‡ä»¶</p>

<p>è¿˜æœ‰ä¸€ç§å°±æ˜¯è®©rollupåœ¨æ‰“åŒ…æ–‡ä»¶çš„å¼€å§‹å’Œæœ€åè‡ªåŠ¨ç”Ÿæˆæ³¨é‡Šæ¥é˜»æ­¢eslintæ£€æµ‹ä»£ç ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•æ—¶ï¼Œéœ€è¦ä½¿ç”¨rollupé…ç½®æ–‡ä»¶çš„ä¸¤ä¸ªå±æ€§ï¼šbannerå’Œfooterï¼Œè¿™ä¸¤ä¸ªå±æ€§ä¼šåœ¨ç”Ÿæˆæ–‡ä»¶çš„å¼€å¤´å’Œç»“å°¾æ’å…¥ä¸€æ®µä½ è‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªå±æ€§ï¼Œåœ¨æ‰“åŒ…æ–‡ä»¶çš„å¼€å¤´æ·»åŠ /*eslint-disable */æ³¨é‡Šï¼Œè®©eslintä¸æ£€æµ‹è¿™ä¸ªæ–‡ä»¶ã€‚</p>

<p>æ·»åŠ bannerå’Œfooterå±æ€§</p>

<p>banner: â€˜/*eslint-disable */â€™
é‡æ–°æ‰“åŒ…ï¼Œæˆ‘ä»¬å‘ç°æ‰“åŒ…æ–‡ä»¶çš„å¼€å¤´è¢«æ’å…¥äº†è¿™æ®µæ³¨é‡Šå­—ç¬¦ä¸²ï¼Œè€Œä¸”eslintæ’ä»¶ä¹Ÿä¸æŠ¥dist.jsæ–‡ä»¶çš„é”™äº†</p>

<p>/*eslint-disable */
(function () {
â€˜use strictâ€™;</p>

<p>// å…·ä½“ä»£ç </p>

<p>}());
demo11 æ§åˆ¶å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¸‹çš„é…ç½®
é…ç½®æ–‡ä»¶çš„å¼€å‘/ç”Ÿäº§ç¯å¢ƒé…ç½®
æœ‰æ—¶å€™æˆ‘ä»¬ä¼šéœ€è¦åŒºåˆ†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼Œé’ˆå¯¹ä¸åŒçš„æ‰“åŒ…è¦æ±‚è¾“å‡ºä¸åŒçš„æ‰“åŒ…é…ç½®ï¼Œä½†æ˜¯æˆ‘ä»¬åˆä¸æƒ³å†™rollup.config.dev.jså’Œrollup.config.prod.jsä¸¤ä¸ªæ–‡ä»¶ï¼Œå› ä¸ºå¯èƒ½ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åªæ˜¯ä¸€ä¸ªuglifyæ’ä»¶ã€‚</p>

<p>å› æ­¤ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨å˜é‡æ¥æ§åˆ¶é…ç½®æ–‡ä»¶çš„è¾“å‡ºå†…å®¹ï¼Œrollupå‘½ä»¤è¡Œç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè®¾ç½®ç¯å¢ƒå˜é‡çš„å‚æ•°â€“environmentï¼Œåœ¨è¿™ä¸ªå‚æ•°åé¢åŠ ä¸Šä½ éœ€è¦è®¾ç½®çš„ç¯å¢ƒå˜é‡ï¼Œä¸åŒå˜é‡é—´ç”¨é€—å·åˆ†éš”ï¼Œç”¨å†’å·åé¢çš„å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹åº”å˜é‡çš„å€¼ï¼ˆè‹¥ä¸åŠ å†’å·ï¼Œåˆ™é»˜è®¤å°†å€¼è®¾ä¸ºå­—ç¬¦ä¸²trueï¼‰ï¼š</p>

<p>åœ¨package.jsonæ–‡ä»¶ä¸­ç¼–å†™å¯¹åº”çš„npm scriptså‘½ä»¤ï¼š</p>

<p>â€œdevâ€: â€œrollup -c â€“environment NODE_ENV:developmentâ€,
â€œbuildâ€: â€œrollup -c â€“environment NODE_ENV:productionâ€
æœ€åä¿®æ”¹æˆ‘ä»¬çš„rollupé…ç½®æ–‡ä»¶</p>

<p>import uglify from â€˜rollup-plugin-uglifyâ€™</p>

<p>let isProd = process.env.NODE_ENV === â€˜productionâ€™</p>

<p>// é€šç”¨çš„æ’ä»¶
const basePlugins = []
// å¼€å‘ç¯å¢ƒéœ€è¦ä½¿ç”¨çš„æ’ä»¶
const devPlugins = []
// ç”Ÿäº§ç¯å¢ƒéœ€è¦ä½¿ç”¨çš„æ’ä»¶
const prodPlugins = [uglify()]</p>

<p>let plugins = [â€¦basePlugins].concat(isProd ? prodPlugins:devPlugins)
let destFilePath = isProd ? â€˜./dist/dist.min.jsâ€™: â€˜./dist/dist.jsâ€™</p>

<p>export default {
  entry: â€˜index.jsâ€™,
  format: â€˜iifeâ€™,
  dest: destFilePath,
  sourceMap: isProd,
  plugins: plugins
}
æˆ‘ä»¬åˆ†åˆ«è¿è¡Œä¸¤ä¸ªnpm scriptså‘½ä»¤ï¼ŒæŸ¥çœ‹æ‰“åŒ…çš„ç»“æœï¼š</p>

<p>rollup å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒæ‰“åŒ…ç»“æœ</p>

<p>æºæ–‡ä»¶å¼€å‘/ç”Ÿäº§ç¯å¢ƒä¿¡æ¯æ³¨å…¥
ä¸Šé¢æ˜¯åœ¨é…ç½®æ–‡ä»¶é‡Œé€šè¿‡å˜é‡æ¥æ”¹å˜è¾“å‡ºçš„é…ç½®ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦å°†ç”Ÿäº§ç¯å¢ƒä¿¡æ¯æ·»åŠ åˆ°æºæ–‡ä»¶é‡Œï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨rollupçš„é…ç½®å±æ€§introå’Œoutroäº†</p>

<p>å¦‚æœè¯´bannerå’Œfooteræ˜¯åœ¨æ–‡ä»¶å¼€å§‹å’Œç»“å°¾æ·»åŠ å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆintroå’Œoutroå°±æ˜¯åœ¨è¢«æ‰“åŒ…çš„ä»£ç å¼€å¤´å’Œç»“å°¾æ·»åŠ å­—ç¬¦ä¸²äº†ï¼Œä»¥iifeæ¨¡å¼æ¥ä¸¾ä¾‹ï¼Œå¦‚æœæˆ‘ä»¬é…ç½®äº†è¿™å››ä¸ªå±æ€§ï¼Œé‚£ä¹ˆè¾“å‡ºç»“æœå°±ä¼šæ˜¯ï¼š</p>

<p>// bannerå­—ç¬¦ä¸²
(function () {
â€˜use strictâ€™;
// introå­—ç¬¦ä¸²</p>

<p>// è¢«æ‰“åŒ…çš„ä»£ç </p>

<p>// outroå­—ç¬¦ä¸²
}());
// footerå­—ç¬¦ä¸²
è¿™æ ·çš„å½¢å¼</p>

<p>ä¸‹é¢æˆ‘ä»¬å®é™…ä½¿ç”¨ä¸€ä¸‹ï¼Œåœ¨index.jsæ–‡ä»¶é‡ŒåŠ ä¸Šä¸€æ®µéœ€è¦ä¾èµ–çš„ä»£ç </p>

<p>if (DEVELOPMENT) {
    console.log(â€˜å¤„äºå¼€å‘ç¯å¢ƒâ€™)
} else {
    console.log(â€˜å¤„äºç”Ÿäº§ç¯å¢ƒâ€™)
}
ç„¶ååœ¨æˆ‘ä»¬çš„rollupé…ç½®æ–‡ä»¶é‡Œæ·»åŠ ï¼š</p>

<p>intro: â€˜var DEVELOPMENT = â€˜ + !isProd,
è¿™æ ·ï¼Œå½“æˆ‘ä»¬æœ€åç”Ÿæˆçš„ä»£ç æ—¶ï¼Œå°±ä¼šè¾“å‡ºå¼€å‘ç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒçš„æç¤ºï¼š</p>

<p>rollup å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¿¡æ¯æ‰“åŒ…ç»“æœ</p>

<p>æºæ–‡ä»¶å¼€å‘/ç”Ÿäº§ç¯å¢ƒä¿¡æ¯æ›¿æ¢
æœ‰æ—¶å€™æˆ‘ä»¬ä¼šæŠŠå¼€å‘/ç”Ÿäº§ç¯å¢ƒçš„ä¿¡æ¯ç›´æ¥å†™åœ¨æºæ–‡ä»¶é‡Œé¢ï¼Œè¿™ä¸ªæ—¶å€™ç”¨introæ¥æ³¨å…¥ä»£ç çš„æ–¹å¼å°±ä¸é€‚åˆäº†ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨rollup-plugin-replaceæ’ä»¶æ¥å¯¹æºä»£ç çš„å˜é‡å€¼è¿›è¡Œæ›¿æ¢ï¼š</p>

<p>å®‰è£…æ’ä»¶</p>

<p>npm i rollup-plugin-replace â€“save-dev
// or
yarn add rollup-plugin-replace â€“dev
ç¼–å†™é…ç½®æ–‡ä»¶</p>

<p>const basePlugins = [replace({
  DEVELOPMENT: !isProd
})]</p>

<p>// å°†introå±æ€§æ³¨é‡Šæ‰
// intro: â€˜var DEVELOPMENT = â€˜ + !isProd,
è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨replaceæ’ä»¶ï¼Œä»¥key-valueå¯¹è±¡çš„å½¢å¼ï¼Œå°†DEVELOPMENTçš„å€¼æ›¿æ¢ä¸º!isProdçš„å€¼</p>

<p>æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼Œå¹¶æ£€æŸ¥æ‰“åŒ…ç»“æœï¼š</p>

<p>rollup å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¿¡æ¯æ‰“åŒ…ç»“æœ</p>

<p>è¿›é˜¶ï¼š replaceé™¤äº†ç›´æ¥ä½¿ç”¨key-valueçš„å½¢å¼æ›¿æ¢å¯¹åº”keyåŒåå˜é‡çš„æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡é…ç½®delimiterså‚æ•°æ¥å®ç°æ¨¡æ¿åŠŸèƒ½ï¼š</p>

<p>é…ç½®replaceæ’ä»¶å‚æ•°</p>

<p>VERSION: â€˜1.0.0â€™,
delimiters: [â€™, â€˜]
é€šè¿‡è¿™ä¸ªé…ç½®ï¼Œåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œä¼šè¢«æ›¿æ¢æˆ1.0.0</p>

<p>åœ¨index.jsæ–‡ä»¶å†…æ·»åŠ ç›¸å…³ä»£ç </p>

<p>var version = â€˜â€™
console.log(â€˜ç‰ˆæœ¬ vâ€™ + version)
æ‰“åŒ…çš„ç»“æœ</p>

<p>var version = â€˜1.0.0â€™;
console.log(â€˜ç‰ˆæœ¬ vâ€™ + version);
demo12 ä½¿ç”¨rollupçš„API
æœ‰æ—¶å€™æˆ‘ä»¬ä¼šéœ€è¦åœ¨æ‰“åŒ…çš„å‰åæ‰§è¡Œä¸€äº›å…¶ä»–çš„ä»£ç ï¼Œä½†æ˜¯åˆä¸æƒ³å¼•å…¥å…¶ä»–æ„å»ºå·¥å…·ï¼ˆä¾‹å¦‚gulpï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨rollupæä¾›çš„node APIæ¥ç¼–å†™ä½ è‡ªå·±çš„æ‰“åŒ…æµç¨‹ã€‚</p>

<p>rollupæ¨¡å—åªæä¾›äº†ä¸€ä¸ªrollupå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°å’Œæˆ‘ä»¬ç¼–å†™é…ç½®æ–‡ä»¶æ—¶å¯¼å‡ºçš„å‚æ•°ä¸åŒï¼Œå‡å°‘äº†å¾ˆå¤šé…ç½®å±æ€§ï¼Œç•™ä¸‹æ¥çš„ä¸»è¦æ˜¯ä¸€äº›è¾“å…¥ç›¸å…³çš„é…ç½®ã€‚ï¼ˆå…·ä½“çš„é…ç½®å±æ€§å¯ä»¥æŸ¥çœ‹rollup wikiçš„javascript APIä¸€èŠ‚ï¼‰</p>

<p>æ‰§è¡Œè¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseï¼Œå¹¶ä¸”åœ¨thenæ–¹æ³•ä¸­æä¾›ä¸€ä¸ªbundleå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå¯¹è±¡ä¿å­˜äº†rollupå¯¹æºæ–‡ä»¶ç¼–è¯‘ä¸€æ¬¡ä¹‹åçš„ç»“æœï¼Œè€Œä¸”æä¾›äº†generateå’Œwriteä¸¤ä¸ªæ–¹æ³•</p>

<p>writeæ–¹æ³•æä¾›äº†ç¼–è¯‘å¹¶å°†æ‰“åŒ…ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶é‡Œçš„åŠŸèƒ½ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„Promiseï¼Œå¯ä»¥è®©ä½ è‡ªå®šä¹‰æ¥ä¸‹æ¥æ‰§è¡Œçš„ä»£ç </p>

<p>generateæ–¹æ³•æ˜¯åªæä¾›äº†ç¼–è¯‘çš„åŠŸèƒ½ï¼Œè¿”å›ä¸€ä¸ªPromiseï¼Œè¿™ä¸ªPromiseæœ‰ä¸€ä¸ªå¯¹è±¡å‚æ•°ï¼ŒåŒ…å«äº†codeï¼ˆç¼–è¯‘å®Œä¹‹åçš„ä»£ç ï¼‰å’Œmapï¼ˆåˆ†æå‡ºæ¥çš„sourceMapå¯¹è±¡ï¼‰ä¸¤ä¸ªå±æ€§ï¼Œä¸€èˆ¬ç”¨åœ¨æ’ä»¶å¼€å‘ä¸­</p>

<p>writeå’Œgengerateæ–¹æ³•éƒ½æ¥å—æœ‰ç¼–è¯‘ç›¸å…³å±æ€§çš„å¯¹è±¡ä½œä¸ºä¼ å…¥çš„ç¼–è¯‘å‚æ•°ï¼Œè€Œwriteæ–¹æ³•è¿˜é¢å¤–æ¥å—dsetå±æ€§ä½œä¸ºå¯¼å‡ºæ–‡ä»¶çš„åç§°ã€‚</p>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬åªä½¿ç”¨writeæ–¹æ³•æ¥ç¼–å†™ä¸€ä¸ªä¸ºæ‰€æœ‰æ¨¡å—ç±»å‹æ‰“åŒ…ï¼Œå¹¶è¾“å‡ºæ‰“åŒ…å®Œæ¯•æç¤ºçš„æ–‡ä»¶ï¼Œè‡³äºgenerateçš„ä½¿ç”¨æ–¹æ³•æˆ‘ä»¬ä¼šæ”¾åœ¨ç¼–å†™æ’ä»¶ä¸€èŠ‚ä¸­ä»‹ç»ã€‚</p>

<p>const rollup = require(â€˜rollupâ€™).rollup</p>

<p>rollup({
    entry: â€˜index.jsâ€™
}).then(bundle =&gt; {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ä¿å­˜æ‰€æœ‰Promiseçš„åˆ—è¡¨
let writePromiseList = []
// å£°æ˜æ‰€æœ‰éœ€è¦æ‰“åŒ…çš„æ¨¡å—ç±»å‹
let moduleTypesList = ['es','cjs','amd','umd','iife']

moduleTypesList.forEach(function(moduleType) {
    writePromiseList.push(bundle.write({
        dest: './dist/dist.' + moduleType + '.js',
        format: moduleType,
        sourceMap: true
    }))
})

return Promise.all(writePromiseList)
</code></pre></div></div>

<p>}).then(() =&gt; {
    console.log(â€˜å…¨éƒ¨æ¨¡å—æ ¼å¼æ‰“åŒ…å®Œæ¯•â€™)
    // å…¶ä»–ä»£ç 
})
å°†package.jsonæ–‡ä»¶å†…çš„npm scriptså‘½ä»¤ä¿®æ”¹ä¸º</p>

<p>â€œbuildâ€: â€œnode rollup.jsâ€
æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼ŒæŸ¥çœ‹æ‰“åŒ…ç»“æœ</p>

<p>rollup è‡ªå®šä¹‰æ‰“åŒ…ç»“æœ1</p>

<p>rollup è‡ªå®šä¹‰æ‰“åŒ…ç»“æœ2</p>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªbundleå¯ä»¥è¢«é‡å¤ä½¿ç”¨å¤šæ¬¡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨Promise.allæ–¹æ³•æ¥ç­‰å¾…æ‰€æœ‰æ¨¡å—æ‰“åŒ…å®Œæˆåå†è¾“å‡ºæ‰“åŒ…å®Œæ¯•çš„æç¤ºã€‚</p>

<p>demo13 é™¤äº†æ‰“åŒ…JSï¼Œæˆ‘ä»¬è¿˜èƒ½â€¦â€¦
ä¸€ä¸ªwebé¡¹ç›®å†…è‚¯å®šä¸ä¼šåªæœ‰jsæ–‡ä»¶ï¼Œè¿˜æœ‰cssã€htmlï¼ˆä¹Ÿå¯èƒ½æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼‰å’Œå…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æ‰“åŒ…çš„æ—¶å€™èƒ½ä¸èƒ½æŠŠè¿™äº›æ–‡ä»¶ä¸€èµ·æ‰“åŒ…å‘¢ï¼Ÿ</p>

<p>æˆ‘ä»¬éœ€è¦åŒºåˆ†ä¸€ä¸‹ï¼Œåœ¨è¿™é‡Œçš„æ‰“åŒ…æœ‰ä¸¤ç§æ„æ€ï¼Œä¸€ç§æ˜¯è®©è¿™äº›æ–‡ä»¶å¯ä»¥åƒJSæ–‡ä»¶ä¸€æ ·ï¼Œåœ¨æºä»£ç ä¸­è¢«importå¹¶ä½¿ç”¨ï¼›è¿˜æœ‰ä¸€ç§æ˜¯é€šè¿‡åœ¨æºæ–‡ä»¶ä¸­importè¿™äº›æ–‡ä»¶ï¼Œæœ€åå°†å®ƒä»¬åˆå¹¶åˆ°ä¸€èµ·å¹¶å¯¼å‡ºåˆ°ä¸€ä¸ªæœ€ç»ˆæ–‡ä»¶å†…ã€‚</p>

<p>ä¸åŒçš„rollupæ’ä»¶æœ‰ä¸åŒçš„æ•ˆæœï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦æŸ¥çœ‹æ’ä»¶çš„ç›¸å…³è¯´æ˜</p>

<p>å®‰è£…æ’ä»¶</p>

<p>npm i rollup-plugin-scss â€“save-dev
// or
yarn add rollup-plugin-scss â€“dev
ç¼–å†™é…ç½®æ–‡ä»¶</p>

<p>import scss from â€˜rollup-plugin-scssâ€™</p>

<p>export default {
  entry: â€˜./src/js/index.jsâ€™,
  format: â€˜iifeâ€™,
  dest: â€˜./dist/js/dist.jsâ€™,
  sourceMap: true,
  plugins: [
    scss({
      output: â€˜./dist/css/style.cssâ€™
    })
  ]
}
åœ¨è¿™é‡Œæˆ‘ä»¬å°è¯•ç¼–è¯‘å’Œæ‰“åŒ…scssæ–‡ä»¶ï¼Œå°†å…¶åˆå¹¶æˆä¸€ä¸ªstyle.cssæ–‡ä»¶ï¼Œå¹¶è¾“å‡ºåˆ°dist/cssç›®å½•ä¸‹</p>

<p>ç¼–å†™scssæ–‡ä»¶</p>

<p>$blue: #69c4eb;</p>

<p>.bg-blue {
    background-color: $blue
}
$white: #fff;</p>

<p>.text-white {
    color: $white;
}
ç„¶ååœ¨æºæ–‡ä»¶ä¸­å¼•ç”¨è¿™ä¸¤ä¸ªscssæ–‡ä»¶</p>

<p>import â€˜../scss/text.scssâ€™
import â€˜../scss/bg.scssâ€™</p>

<p>var html = `
    &lt;div class="bg-blue"&gt;
        &lt;p class="text-white"&gt;æµ‹è¯•æ–‡å­—&lt;/p&gt;
    &lt;/div&gt;
`</p>

<p>document.body.innerHTML = html
æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼ŒæŸ¥çœ‹æ•ˆæœ</p>

<p>rollup æ‰“åŒ…scssæ•ˆæœ</p>

<p>extra ç¼–å†™ä½ è‡ªå·±çš„rollupæ’ä»¶
æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦è‡ªå·±ç¼–å†™rollupæ’ä»¶æ¥å®ç°éœ€æ±‚ï¼Œrollupå®˜æ–¹åœ¨wikiä¸Šæä¾›äº†å…³äºç¼–å†™æ’ä»¶çš„ä¸€äº›ä»‹ç»ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ ¹æ®è¿™äº›ä»‹ç»æ¥å†™ä¸€ä¸ªè‡ªå·±çš„rollupæ’ä»¶ã€‚</p>

<p>æˆ‘ä»¬åœ¨è¿™é‡Œä»¿ç…§scssæ’ä»¶ç¼–å†™ä¸€ä¸ªstylusçš„rollupæ’ä»¶ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥import stylusæ–‡ä»¶ï¼Œå¹¶ç¼–è¯‘æ‰“åŒ…å¯¼å‡ºåˆ°æŒ‡å®šçš„ç›®å½•ä¸‹ï¼ˆä¸ºäº†èŠ‚çœä»£ç é‡ï¼Œåªå†™äº†è¾“å‡ºåˆ°æŒ‡å®šè·¯å¾„çš„åŠŸèƒ½ä»£ç ï¼Œå…¶ä»–çš„åŠŸèƒ½å¯ä»¥å‚è€ƒscssæ’ä»¶çš„å…·ä½“ä»£ç ï¼‰ã€‚</p>

<p>é¦–å…ˆåˆ›å»ºé¡¹ç›®ï¼Œåœ¨package.jsonæ–‡ä»¶ä¸­ï¼Œé™¤äº†ä¸€èˆ¬ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜è¦åŠ ä¸Š</p>

<p>â€œmainâ€: â€œindex.cjs.jsâ€,
â€œmoduleâ€: â€œindex.es.jsâ€,
â€œjsnext:mainâ€: â€œindex.es.jsâ€
è¿™äº›ä¿¡æ¯ç”¨æ¥åŒºåˆ†ä½¿ç”¨ä¸åŒæ¨¡å—è§„èŒƒæ—¶ä½¿ç”¨çš„æ–‡ä»¶</p>

<p>å®‰è£…æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„æ¨¡å—</p>

<p>npm i rollup rollup-plugin-babel babel-preset-es2015-rollup babel-core â€“save-dev
npm i rollup-pluginutils stylus â€“save
// or
yarn add rollup rollup-plugin-babel babel-preset-es2015-rollup babel-core â€“dev
yarn add rollup-pluginutils stylus
rollup-pluginutilså’Œstylusæ˜¯æˆ‘ä»¬è¿è¡Œæ—¶éœ€è¦çš„ä¸¤ä¸ªæ¨¡å—ï¼Œstylusç”¨æ¥è§£æstylusæ–‡ä»¶ï¼Œpluginutilsåˆ™æä¾›ç»™äº†æˆ‘ä»¬ä¸€äº›ç¼–å†™æ’ä»¶å¸¸ç”¨çš„å‡½æ•°</p>

<p>ç¼–å†™rollupé…ç½®æ–‡ä»¶</p>

<p>import babel from â€˜rollup-plugin-babelâ€™</p>

<p>export default {
    entry: â€˜./index.es.jsâ€™,
    dest: â€˜./index.cjs.jsâ€™,
    format: â€˜cjsâ€™,
    plugins: [
        babel()
    ]
}
rollupæ’ä»¶éœ€è¦ä¸€ä¸ªå«æœ‰æŒ‡å®šå±æ€§çš„å¯¹è±¡ä½œä¸ºæ’ä»¶å†…å®¹ï¼Œrollupå®˜æ–¹å»ºè®®æˆ‘ä»¬åœ¨ç¼–å†™æ’ä»¶çš„æ—¶å€™ï¼Œexportä¸€ä¸ªè¿”å›å€¼ä¸ºæ’ä»¶å¯¹è±¡çš„å‡½æ•°ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿ä½¿ç”¨è€…æŒ‡å®šæ’ä»¶çš„å‚æ•°ã€‚</p>

<p>rollupä¼šå°†è§£æçš„éƒ¨åˆ†ç»“æœä½œä¸ºå‚æ•°è°ƒç”¨æ’ä»¶è¿”å›çš„å¯¹è±¡ä¸­çš„ä¸€äº›å‡½æ•°å±æ€§ï¼Œè¿™äº›å‡½æ•°ä¼šåœ¨åˆé€‚çš„æ—¶å€™è¢«rollupè°ƒç”¨ï¼ˆç›¸å½“äºrollupåœ¨æ‰§è¡Œå„ä¸ªæ“ä½œæ—¶çš„é’©å­å‡½æ•°ï¼‰ï¼Œä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸€äº›å¸¸ç”¨çš„å±æ€§ï¼š</p>

<p>nameï¼šæ’ä»¶çš„åç§°ï¼Œæä¾›ç»™rollupè¿›è¡Œç›¸å…³ä¿¡æ¯çš„è¾“å‡º
loadï¼šä¸æŒ‡å®šè¿™ä¸ªå±æ€§æ—¶ï¼Œè§£ææ¨¡å—ä¼šé»˜è®¤å»è¯»å–å¯¹åº”è·¯å¾„æ–‡ä»¶çš„å†…å®¹ï¼›è€Œå½“è¯¥å€¼ä¸ºå‡½æ•°ï¼ˆid =&gt; codeï¼‰æ—¶ï¼Œå¯ä»¥å°†å‡½æ•°æœ€åçš„è¿”å›å€¼ä½œä¸ºæ–‡ä»¶çš„å†…å®¹æä¾›ç»™rollupï¼ˆå¯ä»¥ç”¨æ¥ç”Ÿæˆè‡ªå®šä¹‰æ ¼å¼çš„ä»£ç ï¼‰
resolveIdï¼šä¸€ä¸ªï¼ˆ (importee, importer) =&gt; idï¼‰å½¢å¼çš„å‡½æ•°ï¼Œç”¨æ¥è§£æES6çš„importè¯­å¥ï¼Œæœ€åéœ€è¦è¿”å›ä¸€ä¸ªæ¨¡å—çš„id
transformï¼šæœ€å¸¸ä½¿ç”¨çš„å±æ€§ï¼Œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“rollupè§£æä¸€ä¸ªimportæ—¶ï¼Œä¼šè·å–åˆ°å¯¹åº”è·¯å¾„æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†å†…å®¹å’Œæ¨¡å—çš„åç§°ä½œä¸ºå‚æ•°æä¾›ç»™æˆ‘ä»¬ï¼›è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œéœ€è¦è¿”å›ä¸€ä¸ªä½œä¸ºä»£ç çš„å­—ç¬¦ä¸²æˆ–æ˜¯ç±»ä¼¼{ code, map }ç»“æ„çš„å¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºè§£æå®Œä¹‹åè¯¥æ¨¡å—çš„å®é™…å†…å®¹ï¼ŒmapæŒ‡çš„æ˜¯sourceMapï¼Œè€Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰è¦å¯¼å‡ºçš„sourceMapï¼Œå°±å¯ä»¥å°†è¿”å›çš„mapå€¼è®¾ä¸º{mappings: â€˜â€™}
ongenerateï¼šå½“æˆ‘ä»¬æˆ–rollupè°ƒç”¨generateæ–¹æ³•æ—¶ï¼Œä¼šè¢«è°ƒç”¨çš„ä¸€ä¸ªé’©å­å‡½æ•°ï¼Œæ¥å—generateçš„optionä½œä¸ºå‚æ•°
onwriteï¼šå’Œongenerateä¸€æ ·ï¼Œè°ƒç”¨writeæ–¹æ³•æ—¶ï¼Œä¼šè¢«è°ƒç”¨çš„ä¸€ä¸ªé’©å­å‡½æ•°ï¼Œæ¥å—writeçš„optionä½œä¸ºå‚æ•°
ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡transformå‡½æ•°æ¥è·å–æ–‡ä»¶çš„idå’Œå†…å®¹ï¼Œå¹¶å¯¹å†…å®¹åšä¸€äº›å¤„ç†ï¼Œè‹¥éœ€è¦è¾“å‡ºæ–‡ä»¶åˆ™ä½¿ç”¨ongenerateæˆ–onwriteåœ¨rollupæ‰“åŒ…çš„æœ€åé˜¶æ®µæ¥åšç›¸åº”çš„è¾“å‡ºã€‚</p>

<p>loadå’ŒresolveIdåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šä½¿ç”¨ï¼Œé™¤éä½ æœ‰ç‰¹æ®Šçš„éœ€æ±‚ï¼ˆä¾‹å¦‚å¯¹è·¯å¾„ã€æ¨¡å—idè¿›è¡Œä¿®æ”¹ç­‰)</p>

<p>æ ¹æ®ä¸Šé¢è¿™äº›å†…å®¹ï¼Œæˆ‘ä»¬ç¼–å†™å…·ä½“çš„æ’ä»¶å†…å®¹</p>

<p>import { createFilter } from â€˜rollup-pluginutilsâ€™
import fs from â€˜fsâ€™
import path from â€˜pathâ€™
import stylus from â€˜stylusâ€™</p>

<p>// é€’å½’åˆ›å»ºæ–‡ä»¶å¤¹
function mkdirs(dir) {
    return new Promise((resolve, reject) =&gt; {
        fs.exists(dir, (exist) =&gt; {
            if (exist) {
                resolve()
            } else {
                mkdirs(path.dirname(dir)).then(() =&gt; {
                    fs.mkdir(dir, (err) =&gt; {
                        if (err) {
                            reject()
                        } else {
                            resolve()
                        }
                    })
                })
            }
        })
    })
}</p>

<p>// å¯¼å‡ºä¸€ä¸ªfunction
export default function stylusPlugin(options = {}) {
    // åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤ä»¥cssï¼Œstylç»“å°¾çš„æ–‡ä»¶
    const stylusFilter = createFilter(options.include || [â€˜<em>*/</em>.cssâ€™, â€˜<em>*/</em>.stylâ€™], options.exclude)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// destç”¨æ¥ä¿å­˜æŒ‡å®šçš„è¾“å‡ºè·¯å¾„
let dest = options.output,
// styleNodesç”¨æ¥æš‚å­˜ä¸åŒæ–‡ä»¶çš„cssä»£ç 
    styleNodes = {}

// ç¼–è¯‘stylusæ–‡ä»¶
function complier(str, stylusOpt) {
    return new Promise((resolve, reject) =&gt; {
        stylus.render(str, stylusOpt, (err, css) =&gt; {
            if (err) {
                reject(err)
            } else {
                resolve(css)
            }
        })
    })
}

return {
    // æ’ä»¶åç§°
    name: 'rollup-plugin-stylus',

    // è§£æimportæ—¶è°ƒç”¨ï¼Œè·å–æ–‡ä»¶åç§°å’Œå…·ä½“ä»£ç ï¼Œå°†å®ƒä»¬ä¿å­˜èµ·æ¥
    transform (code, id) {
        if (!stylusFilter(id)) {
            return
        }

        styleNodes[id] = code
        return ''
    },
    // generateæ—¶è°ƒç”¨ï¼Œç”¨stylusè§£æä»£ç ï¼Œå¹¶è¾“å‡ºåˆ°æŒ‡å®šç›®å½•ä¸­
    async ongenerate (genOpt) {
        let css = ''
        for (let id in styleNodes) {
            // åˆå¹¶æ‰€æœ‰cssä»£ç 
            css += styleNodes[id] || ''
        }

        // ç¼–è¯‘stylusä»£ç 
        if (css.length) {
            try {
                css = await complier(css, Object.assign({}, options.stylusOpt))
            } catch (error) {
                console.log(error)
            }
        }

        // æ²¡æœ‰æŒ‡å®šè¾“å‡ºæ–‡ä»¶è·¯å¾„æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªé»˜è®¤æ–‡ä»¶
        if (typeof dest !== 'string') {
            if (!css.length) {
                return
            }

            dest = genOpt.dest || 'bundle.js'
            if (dest.endsWith('.js')) {
                dest = dest.slice(0, -3)
            }
            dest = dest + '.css'
        }

        // åˆ›å»ºç›®å½•ï¼Œå¹¶å°†csså†™å…¥åˆ°ç»“æœæ–‡ä»¶å†…
        await mkdirs(path.dirname(dest))
        return new Promise((resolve, reject) =&gt; {
            fs.writeFile(dest, css, (err) =&gt; {
                if (err) {
                    reject(err)
                } else {
                    resolve()
                }
            })
        })
    }
} } è¿™æ ·ï¼Œä¸€ä¸ªè§£æå¹¶æ‰“åŒ…stylusæ–‡ä»¶çš„rollupæ’ä»¶å°±å†™å¥½äº†ï¼Œä½ å¯ä»¥åœ¨ä½ çš„å·¥ç¨‹ä¸­å¼•ç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å°†å…¶ä½œä¸ºä¸€ä¸ªæ¨¡å—å‘å¸ƒï¼Œä»¥ä¾¿äºåˆ†äº«ç»™å…¶ä»–äººä½¿ç”¨ã€‚
</code></pre></div></div>

<p>æ€»ç»“ and ä¸€ä¸ªå®Œæ•´çš„rollupé¡¹ç›®çš„æ¨¡æ¿
rollupåœ¨æ‰“åŒ…JSä¸Šæ˜¯ä¸€ä¸ªååˆ†å¿«æ·æ–¹ä¾¿çš„å·¥å…·ï¼Œä½†å’Œwebpackç›¸æ¯”ï¼Œä»–çš„ç”Ÿæ€åœˆè¿˜æ˜¯ä¸å¤Ÿå¼ºå¤§ï¼Œå¯¹äºå¤§å‹webå·¥ç¨‹çš„é€‚åº”åº¦ç›¸å¯¹ä¸è¶³</p>

<p>rollupçš„ä¼˜ç‚¹åœ¨äºæ–¹ä¾¿çš„é…ç½®ï¼Œå¤©ç„¶çš„ES6æ¨¡å—æ”¯æŒè®©æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨importå’Œexportè¯­æ³•ï¼Œåœ¨æ‰“åŒ…JSä¸Šï¼Œä¸å®ç°è‡ªå·±çš„æ¨¡å—æœºåˆ¶ï¼Œè€Œæ˜¯ä½¿ç”¨ç›®å‰å¸¸è§çš„æ¨¡å—è§„èŒƒæœ‰åŠ©äºå…¶ä»–å·¥å…·ï¼ˆä¾‹å¦‚requirejsï¼‰æ¥å¼•ç”¨æ‰“åŒ…æ–‡ä»¶ï¼›tree-shakingçš„ç‰¹æ€§ä¹Ÿæœ‰åŠ©äºå‡å°‘ä»£ç é‡ï¼Œå› æ­¤æˆ‘è®¤ä¸ºrollupæ¯”èµ·æ„å»ºåº”ç”¨å·¥ç¨‹é¡¹ç›®ï¼Œæ›´é€‚åˆç”¨æ¥æ„å»ºä¸€ä¸ªJSåº“æˆ–nodeæ¨¡å—</p>

<p>æˆ‘å°†ä¸Šé¢ä»‹ç»çš„æ’ä»¶é›†åˆåˆ°ä¸€èµ·ï¼Œæ·»åŠ äº†æµ‹è¯•çš„æ”¯æŒï¼Œåˆ¶ä½œäº†ä¸€ä¸ªè¾ƒä¸ºå®Œæ•´çš„rollupå·¥ç¨‹æ¨¡æ¿ã€‚æ”¾åœ¨rollup-project-templateç›®å½•ä¸‹ï¼Œéœ€è¦çš„åŒå­¦å¯ä»¥è‡ªå–ï¼ˆä½ ä¹Ÿå¯ä»¥å¢åŠ æˆ–åˆ é™¤ä»»æ„ä½ éœ€è¦çš„æ¨¡å—ï¼Œæ¥ç»„å»ºå±äºä½ è‡ªå·±çš„rollupé¡¹ç›®æ¨¡æ¿ï¼‰</p>

<p>å‚è€ƒèµ„æ–™
rollupå®˜æ–¹wiki
rollupæ’ä»¶åˆé›†
å¦‚ä½•é€šè¿‡ Rollup.js æ‰“åŒ… JavaScript â€”â€” çŸ¥ä¹ä¸“æ </p>
:ET