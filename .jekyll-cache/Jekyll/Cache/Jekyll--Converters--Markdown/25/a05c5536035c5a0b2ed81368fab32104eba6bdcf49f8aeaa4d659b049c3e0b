I"ë
<p>https://php.golaravel.com/mysqlnd-ms.quickstart.sqlhints.html</p>

<p>SQL ä¼˜åŒ–å™¨å¯ä»¥å¼ºè¡ŒæŒ‡å®šè¿æ¥æ± ä¸­ç‰¹å®šçš„é“¾æ¥ã€‚å¯ä»¥ç»™å®šæ’ä»¶ä¸€ä¸ªä¼˜åŒ–å™¨å»ä½¿ç”¨ç‰¹å®šçš„æœåŠ¡å™¨è¿æ¥ï¼Œ è¿™æ ·å¯ä»¥è§£å†³ç”±äºé“¾æ¥åˆ‡æ¢å¼•èµ·çš„é“¾æ¥çŠ¶æ€å˜åŒ–é—®é¢˜ã€‚</p>

<p>SQL hints æ˜¯åŸºäº SQL è¯­å¥çš„ã€‚å› ä¸º SQL æ³¨é‡Šä¼šè¢« SQL æ‰§è¡Œå™¨å¿½ç•¥ï¼Œ ä»–å¹¶ä¸ä¼šå¦¨ç¢ MySQL æœåŠ¡å™¨ã€MySQL proxy æˆ–è€…ä»»ä½•é˜²ç«å¢™çš„å·¥ä½œã€‚</p>

<p>æ’ä»¶æ”¯æŒ SQL hintsï¼ŒMYSQLND_MS_MASTER_SWITCH hints å¯ä»¥æŒ‡å®šè¯­å¥åœ¨ master ä¸Šè¿è¡Œï¼ŒMYSQLND_MS_SLAVE_SWITCH å¯ä»¥æŒ‡å®šåœ¨ slave ä¸Šè¿è¡Œï¼ŒMYSQLND_MS_LAST_USED_SWITCH å¯ä»¥æŒ‡å®šè¯­å¥åœ¨ä¸Šä¸€æ¡è¯­å¥æ‰§è¡Œçš„ slave ä¸Šè¿è¡Œã€‚</p>

<p>æ’ä»¶ä¼šæ‰«æè¯­å¥çš„å†…å®¹ï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰ SQL hintsã€‚ä»–åªèƒ½åœ¨è¯­å¥çš„å¼€å¤´è¢«è¯†åˆ«ã€‚
<!-- more -->
1 é…ç½®ä¸€ä¸ª master å’Œä¸€ä¸ª slave çš„æ’ä»¶</p>

<p>{
    â€œmyappâ€: {
        â€œmasterâ€: {
            â€œmaster_0â€: {
                â€œhostâ€: â€œlocalhostâ€,
                â€œsocketâ€: â€œ\/tmp\/mysql.sockâ€
            }
        },
        â€œslaveâ€: {
            â€œslave_0â€: {
                â€œhostâ€: â€œ192.168.2.27â€,
                â€œportâ€: â€œ3306â€
            }
        }
    }
}</p>

<p>2 SQL hints ç¦æ­¢è¿æ¥åˆ‡æ¢</p>

<p>&lt;?php
$mysqli = new mysqli(â€œmyappâ€, â€œusernameâ€, â€œpasswordâ€, â€œdatabaseâ€);
if (mysqli_connect_errno())
  /* Of course, your error handling is nicerâ€¦ */
  die(sprintf(â€œ[%d] %s\nâ€, mysqli_connect_errno(), mysqli_connect_error()));</p>

<p>/* è¿æ¥ 1ï¼šè®¾ç½®ä¸€ä¸ª SQL ç”¨æˆ·å˜é‡ï¼Œæ²¡æœ‰ SELECT æ‰€ä»¥è¿è¡Œåœ¨ master ä¸Š */
if (!$mysqli-&gt;query(â€œSET @myrole=â€™masterâ€™â€)) {
 printf(â€œ[%d] %s\nâ€, $mysqli-&gt;errno, $mysqli-&gt;error);
}</p>

<p>/* è¿æ¥ 1ï¼šå› ä¸ºæŒ‡å®šäº† SQL hint <em>/
if (!($res = $mysqli-&gt;query(sprintf(â€œ/</em>%s*/SELECT @myrole AS _roleâ€, MYSQLND_MS_LAST_USED_SWITCH)))) {
 printf(â€œ[%d] %s\nâ€, $mysqli-&gt;errno, $mysqli-&gt;error);
} else {
 $row = $res-&gt;fetch_assoc();
 $res-&gt;close();
 printf(â€œ@myrole = â€˜%sâ€™\nâ€, $row[â€˜_roleâ€™]);
}
$mysqli-&gt;close();
?&gt;
ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</p>

<p>@myrole = â€˜masterâ€™
ä¸Šé¢çš„èŒƒä¾‹ä½¿ç”¨ MYSQLND_MS_LASTER_USED_SWITCH æ¥é˜²æ­¢åœ¨ master å’Œ slave ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œå³ä½¿è¿è¡Œäº† SELECT å¼€å¤´çš„è¯­å¥ã€‚</p>

<p>SQL hints ä¹Ÿå¯ä»¥ç”¨äºåœ¨ master ä¸Šè¿è¡Œ SELECT è¯­å¥ã€‚ è¿™ç»å¸¸å‘ç”Ÿäº slave ä¸­çš„æ•°æ®è½åäº masterï¼Œä½†æ˜¯å¸Œæœ›è·å–å½“å‰æ•°æ®çš„æ—¶å€™ã€‚</p>

<p>åœ¨ 1.2.0 ç‰ˆæœ¬ä¸­ï¼Œå¼•å…¥äº†æœåŠ¡çº§åˆ«çš„æ¦‚å¿µï¼Œç”¨äºå¤„ç†å³æ—¶æ•°æ®è·å–çš„é—®é¢˜ã€‚ ä½¿ç”¨æœåŠ¡çº§åˆ«ï¼Œå¯ä»¥é™ä½å¯¹è¿™ä¸ªé—®é¢˜çš„å…³æ³¨ï¼Œæ›¿ä»£ SQL hints çš„ä½¿ç”¨ã€‚ å¯ä»¥åœ¨æœåŠ¡çº§åˆ«å’Œä¸€è‡´æ€§çš„ç« èŠ‚ä¸­æ‰¾åˆ°æ›´å¤šçš„è¯´æ˜ã€‚</p>

:ET