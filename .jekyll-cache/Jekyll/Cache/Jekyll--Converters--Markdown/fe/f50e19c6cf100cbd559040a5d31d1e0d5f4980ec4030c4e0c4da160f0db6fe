I"ø<p>å¦‚æœå­—æ®µåçš„é¦–å­—æ¯å°å†™ï¼Œè¿™ä¸ªå­—æ®µå°±æ˜¯ä¸å¯å¯¼å‡ºçš„ã€‚ä½†å…¶å®ï¼Œé€šè¿‡golangæä¾›çš„åå°„ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥åœ¨åŒ…å¤–è®¿é—®å¹¶æ“ä½œåˆ°ç»“æ„ä½“ä¸­çš„éå¯¼å‡ºå­—æ®µçš„ã€‚</p>

<p>package aboutGoTest</p>

<p>type Student struct {
	name string
	Age  int
}</p>

<p>var TestStudent = Student{
	name: â€œjackâ€,
	Age:  12,
}
<!-- more -->
å–åœ°å€è®¿é—®/ä¿®æ”¹</p>

<p>package main</p>

<p>import (
	at â€œaboutGoTestâ€
	â€œfmtâ€
	â€œreflectâ€
)</p>

<p>func main() {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fmt.Printf("testStudent.name: %v\n", getUnExportedField(&amp;at.TestStudent, "name"))
</code></pre></div></div>

<p>}</p>

<p>func getUnExportedField(ptr interface{}, fieldName string) reflect.Value {
	v := reflect.ValueOf(ptr).Elem().FieldByName(fieldName)
	return v
}
å¯è§ï¼Œé€šè¿‡åå°„æœºåˆ¶å¯ä»¥æˆåŠŸå–å‡ºnameå­—æ®µã€‚
è¿™é‡Œï¼Œé€šè¿‡reflect.Value.Elem.FieldByNameè·å–çš„væ˜¯éå¯¼å‡ºå­—æ®µåå°„å¯¹è±¡ã€‚
æ³¨æ„ï¼Œreflect.Value.Eleméœ€è¦reflect.Valueçš„ç±»å‹å¿…é¡»æ˜¯interfaceæˆ–è€…ptrã€‚å¯¹äºå‰è€…ï¼Œè¿”å›interfaceåº•å±‚çš„å€¼ï¼›å¯¹äºåè€…ï¼Œè¿”å›ptræŒ‡å‘çš„å€¼ã€‚</p>

<p>ä½†æ˜¯è¿™æ ·è·å–åˆ°çš„å€¼æ˜¯ä¸å¯ä»¥ä¿®æ”¹çš„ï¼Œå¦‚æœè¦ä¿®æ”¹nameå­—æ®µï¼Œéœ€è¦ç”¨åˆ°reflect.NewAtå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°é€šè¿‡ä¸€ä¸ªç±»å‹å€¼çš„åº•å±‚åœ°å€ï¼ˆæŒ‡é’ˆ pï¼‰å’Œç±»å‹ï¼Œè¿”å›æŒ‡å‘è¯¥å€¼çš„ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªè¿”å›å€¼æ˜¯å¯å¯»å€çš„ï¼Œå³å¯é€šè¿‡å®ƒç›´æ¥è®¿é—®è¯¥å€¼ã€‚
å…·ä½“çš„ä¿®æ”¹æ˜¯ä½¿ç”¨reflect.value.Setå‡½æ•°ã€‚</p>

<p>package main</p>

<p>import (
	at â€œaboutGoTestâ€
	â€œfmtâ€
	â€œreflectâ€
	â€œunsafeâ€
)</p>

<p>func main() {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fmt.Printf("testStudent.name: %v\n", getUnExportedField(&amp;at.TestStudent, "name"))

if err := setUnExportedStrField(&amp;at.TestStudent, "name", "kangkang"); err != nil {
	fmt.Println("err: %v", err)
}

fmt.Printf("testStudent.name: %v\n", getUnExportedField(&amp;at.TestStudent, "name")) }
</code></pre></div></div>

<p>func getUnExportedField(ptr interface{}, fieldName string) reflect.Value {
	v := reflect.ValueOf(ptr).Elem().FieldByName(fieldName)
	return v
}</p>

<p>func setUnExportedStrField(ptr interface{}, fieldName string, newFieldVal interface{}) (err error) {
	// è·å–éå¯¼å‡ºå­—æ®µåå°„å¯¹è±¡
	v := reflect.ValueOf(ptr).Elem().FieldByName(fieldName)
	// è·å–éå¯¼å‡ºå­—æ®µå¯å¯»å€åå°„å¯¹è±¡
	// ä¸ä¸Šé¢çš„åŒºåˆ«æ˜¯ï¼šè¿™ä¸ªæ˜¯å¯å¯»å€çš„
	v = reflect.NewAt(v.Type(), unsafe.Pointer(v.UnsafeAddr())).Elem()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nv := reflect.ValueOf(newFieldVal)
if v.Kind() != nv.Kind() {
	return fmt.Errorf("expected kind %v, got kind: %v", v.Kind(), nv.Kind())
}
v.Set(nv)
return nil } ç»“æœï¼š testStudent.name: jack testStudent.name: kangkang
</code></pre></div></div>

<p>ä¸å–åœ°å€è®¿é—®
ä¸Šé¢ä»‹ç»çš„æ–¹æ³•éƒ½æ˜¯è¦ä¼ å…¥æŒ‡é’ˆçš„ï¼Œäº‹å®ä¸Šä¸å–åœ°å€ä¹Ÿæ˜¯å¯ä»¥è®¿é—®éå¯¼å‡ºå­—æ®µçš„
ä»£ç ï¼š
package main</p>

<p>import (
	at â€œaboutGoTestâ€
	â€œfmtâ€
	â€œreflectâ€
)</p>

<p>func main() {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fmt.Printf("testStudent.name: %v\n", getUnExportedField(at.TestStudent, "name")
</code></pre></div></div>

<p>}</p>

<p>func getUnExportedField(source interface{}, fieldName string) (ret reflect.Value) {
	v := reflect.ValueOf(source)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vptr := reflect.New(v.Type()).Elem()
vptr.Set(v)

ret = vptr.FieldByName(fieldName)
return } è¿™é‡Œä½¿ç”¨äº†reflect.Newæ–¹æ³•ï¼Œä¸reflect.NewAtæ–¹æ³•ä¸åŒï¼Œè¿™ä¸ªæ–¹æ³•åŸºäºæŒ‡å®šç±»å‹åˆ›å»ºä¸€ä¸ªå¯ä»¥è¡¨ç¤ºè¯¥ç±»å‹çš„æŒ‡é’ˆï¼Œå› æ­¤è¿™é‡Œå®é™…ä¸Šæ˜¯åœ¨å‡½æ•°å†…éƒ¨æ„é€ äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥å¤–éƒ¨ä¸ç”¨å†å–åœ°å€ï¼› ä¸å–åœ°å€çš„ä¿®æ”¹æ˜¯ååº”ä¸åˆ°åŸç»“æ„ä½“çš„ï¼Œå› ä¸ºåœ¨ä¼ å‚çš„æ—¶å€™æ˜¯å€¼æ‹·è´
</code></pre></div></div>

<p>package main</p>

<p>import (
	at â€œaboutGoTestâ€
	â€œfmtâ€
	â€œreflectâ€
	â€œunsafeâ€
)</p>

<p>func main() {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fmt.Printf("testStudent.name: %v\n", getUnExportedField(at.TestStudent, "name"))

if ret, err := setUnExportedField(at.TestStudent, "name", "kangkang"); err != nil {
	fmt.Println("err: %v", err)
} else {

	fmt.Printf("testStudent.name: %v\n", getUnExportedField(at.TestStudent, "name"))

	v := ret.Interface().(at.Student)
	fmt.Printf("ret.name: %v\n", getUnExportedField(v, "name"))

}
</code></pre></div></div>

<p>}</p>

<p>func getUnExportedField(source interface{}, fieldName string) (ret reflect.Value) {
	v := reflect.ValueOf(source)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vptr := reflect.New(v.Type()).Elem()
vptr.Set(v)

ret = vptr.FieldByName(fieldName)
return }
</code></pre></div></div>

<p>func setUnExportedField(source interface{}, fieldName string, newFieldVal interface{}) (reflect.Value, error) {
	v := reflect.ValueOf(source)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vptr := reflect.New(v.Type()).Elem()
vptr.Set(v)

tv := vptr.FieldByName(fieldName)
tv = reflect.NewAt(tv.Type(), unsafe.Pointer(tv.UnsafeAddr())).Elem()

nv := reflect.ValueOf(newFieldVal)
if tv.Kind() != nv.Kind() {
	return v, fmt.Errorf("expected kind %v, got kind: %v", v.Kind(), nv.Kind())
}
tv.Set(nv)
return vptr, nil } https://blog.csdn.net/somanlee/article/details/108304525
</code></pre></div></div>

<p>https://blog.csdn.net/fangkang7/article/details/105045514</p>

<p>https://studygolang.com/articles/12348?fr=sidebar</p>
:ET