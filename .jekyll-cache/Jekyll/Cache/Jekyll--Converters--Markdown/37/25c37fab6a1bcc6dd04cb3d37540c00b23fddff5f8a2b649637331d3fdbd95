I"…X<p>åœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼ŒTraitsæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§æ¦‚å¿µï¼Œå®ƒè¡¨ç¤ºä¸€ç»„å¯ç”¨äºæ‰©å±•ç±»åŠŸèƒ½çš„æ–¹æ³•</p>

<p>Traitsæä¾›äº†ä¸€ç»„å®ç°è¡Œä¸ºçš„æ–¹æ³•ï¼Œå¹¶è¦æ±‚æ¥å®ç°ä¸€ç»„å‚æ•°åŒ–æ‰€æä¾›è¡Œä¸ºçš„æ–¹æ³•ã€‚
å¯¹äºå¯¹è±¡é—´çš„é€šä¿¡ï¼ˆä»¥åŠå¯¹è±¡ä¹‹é—´çš„å…±äº«ï¼‰ï¼Œç‰¹æ€§åœ¨é¢å‘å¯¹è±¡çš„åè®®ï¼ˆæ¥å£ï¼‰å’Œmixinä¹‹é—´æœ‰æ‰€ä¸åŒã€‚ç•Œé¢å¯ä»¥é€šè¿‡æ–¹æ³•ç­¾åæ¥å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªè¡Œä¸ºï¼Œè€Œç‰¹å¾é€šè¿‡å®Œæ•´çš„æ–¹æ³•å®šä¹‰æ¥å®šä¹‰è¡Œä¸ºï¼šå³ï¼Œå®ƒåŒ…æ‹¬æ–¹æ³•çš„ä¸»ä½“ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒmixinåŒ…å«å®Œæ•´çš„æ–¹æ³•å®šä¹‰ï¼Œå¹¶ä¸”è¿˜å¯ä»¥é€šè¿‡æˆå‘˜å˜é‡æºå¸¦çŠ¶æ€ï¼Œè€Œç‰¹å¾é€šå¸¸ä¸ä¼šã€‚
å› æ­¤ï¼Œè¢«å®šä¹‰ä¸ºç‰¹å¾çš„å¯¹è±¡è¢«åˆ›å»ºä¸ºæ–¹æ³•çš„ç»„åˆï¼Œå…¶å¯ä»¥è¢«å…¶ä»–ç±»ä½¿ç”¨è€Œä¸éœ€è¦å¤šé‡ç»§æ‰¿ã€‚åœ¨å‘½åå†²çªçš„æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç±»æ‰€ä½¿ç”¨çš„å¤šä¸ªç‰¹å¾å…·æœ‰åŒåçš„æ–¹æ³•æ—¶ï¼Œç¨‹åºå‘˜å¿…é¡»æ˜ç¡®åœ°æ¶ˆé™¤è¿™äº›æ–¹æ³•ä¸­å°†ä½¿ç”¨å“ªä¸€ç§æ–¹æ³•;ä»è€Œæ‰‹åŠ¨è§£å†³å¤šé‡ç»§æ‰¿çš„é’»çŸ³é—®é¢˜ã€‚è¿™ä¸é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„å…¶ä»–æ„æˆæ–¹æ³•ä¸åŒï¼Œåœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œå†²çªçš„åç§°å¯ä»¥é€šè¿‡èŒƒå›´è§„åˆ™è‡ªåŠ¨è§£å†³ã€‚
å°½ç®¡mixinåªèƒ½ä½¿ç”¨ç»§æ‰¿æ“ä½œæ„æˆï¼Œä½†ç‰¹å¾æä¾›äº†æ›´å¹¿æ³›çš„æ“ä½œé€‰æ‹©ï¼ŒåŒ…æ‹¬ï¼š
å¯¹ç§°å’Œï¼šåˆå¹¶ä¸¤ä¸ªä¸ç›¸äº¤ç‰¹å¾ä»¥åˆ›å»ºæ–°ç‰¹å¾çš„æ“ä½œï¼›
é‡å†™ï¼ˆæˆ–ä¸å¯¹ç§°æ€»å’Œï¼‰ï¼šé€šè¿‡å‘ç°æœ‰ç‰¹å¾æ·»åŠ æ–¹æ³•å½¢æˆæ–°ç‰¹å¾çš„æ“ä½œï¼Œå¯èƒ½ä¼šè¦†ç›–å…¶æŸäº›æ–¹æ³•ï¼›
åˆ«åï¼šé€šè¿‡ä¸ºç°æœ‰æ–¹æ³•æ·»åŠ æ–°åç§°æ¥åˆ›å»ºæ–°ç‰¹å¾çš„æ“ä½œï¼›
æ’é™¤ï¼šé€šè¿‡ä»ç°æœ‰ç‰¹å¾ä¸­ç§»é™¤æ–¹æ³•å½¢æˆæ–°ç‰¹å¾çš„æ“ä½œã€‚ ï¼ˆå°†å®ƒä¸åˆ«åæ“ä½œç»„åˆä¼šäº§ç”Ÿæµ…å±‚é‡å‘½åæ“ä½œï¼‰ã€‚
ç‰¹è´¨çš„æ„æˆæ–¹å¼å¦‚ä¸‹ï¼š
æ€§çŠ¶ç»„æˆæ˜¯å¯äº¤æ¢çš„;æ·»åŠ ç‰¹å¾çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œç»™å®šæ€§çŠ¶S = A + Bï¼Œåˆ™æ€§çŠ¶T = B + Aä¸Sç›¸åŒã€‚
ã€€ã€€å†²çªçš„æ–¹æ³•è¢«æ’é™¤åœ¨ç»„åˆç‰©ä¹‹å¤–ã€‚
åµŒå¥—æ€§çŠ¶ç›¸å½“äºæ‰å¹³åŒ–ç‰¹å¾;æ„å›¾å±‚æ¬¡ä¸å½±å“ç‰¹å¾è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œç»™å®šæ€§çŠ¶S = A + Xï¼Œå…¶ä¸­X = B + Cï¼Œåˆ™æ€§çŠ¶T = A + B + Cä¸Sç›¸åŒ [1]  ã€‚
æ”¯æŒçš„è¯­è¨€ç¼–è¾‘
Traitsæœ€åˆæ¥è‡ªç¼–ç¨‹è¯­è¨€Self ï¼Œå¹¶å—ä»¥ä¸‹ç¼–ç¨‹è¯­è¨€æ”¯æŒï¼š
AmbientTalkã€C++ã€Curlã€Dã€ECMAScriptã€Groovyã€Haxeã€Javaã€JavaScriptã€Juliaã€Kotlinã€Lasso OCamlã€Perlã€PHPã€Pythonã€Racketã€Rubyã€Smalltalkã€Swiftã€‚</p>

<p>TraitsæŠ€æœ¯
traits=ç‰¹æ€§
æå–ä¸åŒç±»çš„å…±æ€§ï¼Œç»Ÿä¸€å¤„ç†</p>

<p>ä¾é æ˜¾ç¤ºæ¨¡æ¿ç‰¹æ®ŠåŒ–ï¼ŒæŠŠä»£ç ä¸­å› ä¸åŒç±»å‹å‘ç”Ÿå˜åŒ–çš„ç‰‡æ®µæå–å‡ºï¼Œç”¨ç»Ÿä¸€çš„æ¥å£æ¥åŒ…è£…</p>

<p>æ¥å£å¯ä»¥ä¸ºc++ç±»æ‰€èƒ½åŒ…å«çš„ä»»ä½•ä¸œè¥¿</p>

<p>å®¢æˆ·é€šè¿‡traitsæ¨¡æ¿ç±»å…¬å¼€çš„æ¥å£æ¥é—´æ¥è®¿é—®
<!-- more -->
https://www.php.net/manual/en/language.oop5.traits.php</p>

<p>PHPæ˜¯å•ç»§æ‰¿çš„è¯­è¨€ï¼Œåœ¨PHP 5.4 Traitså‡ºç°ä¹‹å‰ï¼ŒPHPçš„ç±»æ— æ³•åŒæ—¶ä»ä¸¤ä¸ªåŸºç±»ç»§æ‰¿å±æ€§æˆ–æ–¹æ³•ã€‚phpçš„Traitså’ŒGoè¯­è¨€çš„ç»„åˆåŠŸèƒ½æœ‰ç‚¹ç±»ä¼¼ï¼Œ</p>

<p>é€šè¿‡åœ¨ç±»ä¸­ä½¿ç”¨useå…³é”®å­—å£°æ˜è¦ç»„åˆçš„Traitåç§°ï¼Œè€Œå…·ä½“æŸä¸ªTraitçš„å£°æ˜ä½¿ç”¨traitå…³é”®è¯ï¼ŒTraitä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ã€‚</p>

<p>&lt;?php
trait Drive {
    public $carName = â€˜BMWâ€™;
    public function driving() {
        echo â€œdriving {$this-&gt;carName}\nâ€;
    }
}
class Person {
    public function age() {
        echo â€œi am 18 years old\nâ€;
    }
}
class Student extends Person {
    use Drive;
    public function study() {
        echo â€œLearn to drive \nâ€;
    }
}
$student = new Student();
$student-&gt;study();
$student-&gt;age();
$student-&gt;driving();</p>

<p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒStudentç±»é€šè¿‡ç»§æ‰¿Personï¼Œæœ‰äº†ageæ–¹æ³•ï¼Œé€šè¿‡ç»„åˆDriveï¼Œæœ‰äº†drivingæ–¹æ³•å’Œå±æ€§carNameã€‚</p>

<p>å¦‚æœTraitã€åŸºç±»å’Œæœ¬ç±»ä¸­éƒ½å­˜åœ¨æŸä¸ªåŒåçš„å±æ€§æˆ–è€…æ–¹æ³•ï¼Œæœ€ç»ˆä¼šä¿ç•™å“ªä¸€ä¸ªå‘¢ï¼Ÿé€šè¿‡ä¸‹é¢çš„ä»£ç æµ‹è¯•ä¸€ä¸‹ï¼š</p>

<p>&lt;?php
trait Drive {
    public function hello() {
        echo â€œhello å‘¨ä¼¯é€š\nâ€;
    }
    public function driving() {
        echo â€œå‘¨ä¼¯é€šä¸ä¼šå¼€è½¦\nâ€;
    }
}
class Person {
    public function hello() {
        echo â€œhello å¤§å®¶å¥½\nâ€;
    }
    public function driving() {
        echo â€œå¤§å®¶éƒ½ä¼šå¼€è½¦\nâ€;
    }
}
class Student extends Person {
    use Drive;//trait çš„æ–¹æ³•è¦†ç›–äº†åŸºç±»Personä¸­çš„æ–¹æ³•ï¼Œæ‰€ä»¥Personä¸­çš„hello å’Œdrivingè¢«è¦†ç›–
    public function hello() {
        echo â€œhello æ–°å­¦å‘˜\nâ€;//å½“æ–¹æ³•æˆ–å±æ€§åŒåæ—¶ï¼Œå½“å‰ç±»ä¸­çš„æ–¹æ³•ä¼šè¦†ç›– traitçš„ æ–¹æ³•,æ‰€ä»¥æ­¤å¤„helloä¼šè¦†ç›–traitä¸­çš„hello
    }
}
$student = new Student();
$student-&gt;hello();
$student-&gt;driving();</p>

<p>hello æ–°å­¦å‘˜
å‘¨ä¼¯é€šä¸ä¼šå¼€è½¦
å› æ­¤å¾—å‡ºç»“è®ºï¼šå½“æ–¹æ³•æˆ–å±æ€§åŒåæ—¶ï¼Œå½“å‰ç±»ä¸­çš„æ–¹æ³•ä¼šè¦†ç›– traitçš„ æ–¹æ³•ï¼Œè€Œ trait çš„æ–¹æ³•åˆè¦†ç›–äº†åŸºç±»ä¸­çš„æ–¹æ³•ã€‚</p>

<p>å¦‚æœè¦ç»„åˆå¤šä¸ªTraitï¼Œé€šè¿‡é€—å·åˆ†éš” Traitåç§°ï¼š</p>

<p>use Trait1, Trait2;</p>

<p>å¦‚æœå¤šä¸ªTraitä¸­åŒ…å«åŒåæ–¹æ³•æˆ–è€…å±æ€§æ—¶ï¼Œä¼šæ€æ ·å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å½“ç»„åˆçš„å¤šä¸ªTraitåŒ…å«åŒåå±æ€§æˆ–è€…æ–¹æ³•æ—¶ï¼Œéœ€è¦æ˜ç¡®å£°æ˜è§£å†³å†²çªï¼Œå¦åˆ™ä¼šäº§ç”Ÿä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚</p>

<p>&lt;?php
trait Trait1 {
    public function hello() {
        echo â€œTrait1::hello\nâ€;
    }
    public function hi() {
        echo â€œTrait1::hi\nâ€;
    }
}
trait Trait2 {
    public function hello() {
        echo â€œTrait2::hello\nâ€;
    }
    public function hi() {
        echo â€œTrait2::hi\nâ€;
    }
}
class Class1 {
    use Trait1, Trait2;
}
//è¾“å‡ºï¼šFatal error:  Trait method hello has not been applied, because there are collisions with other trait methods on Class1 in</p>

<p>ä½¿ç”¨insteadofå’Œasæ“ä½œç¬¦æ¥è§£å†³å†²çªï¼Œinsteadofæ˜¯ä½¿ç”¨æŸä¸ªæ–¹æ³•æ›¿ä»£å¦ä¸€ä¸ªï¼Œè€Œasæ˜¯ç»™æ–¹æ³•å–ä¸€ä¸ªåˆ«åï¼Œå…·ä½“ç”¨æ³•è¯·çœ‹ä»£ç :</p>

<p>&lt;?php
trait Trait1 {
    public function hello() {
        echo â€œTrait1::hello \nâ€;
    }
    public function hi() {
        echo â€œTrait1::hi \nâ€;
    }
}
trait Trait2 {
    public function hello() {
        echo â€œTrait2::hello\nâ€;
    }
    public function hi() {
        echo â€œTrait2::hi\nâ€;
    }
}
class Class1 {
    use Trait1, Trait2 {
        Trait2::hello insteadof Trait1;
        Trait1::hi insteadof Trait2;
    }
}
class Class2 {
    use Trait1, Trait2 {
        Trait2::hello insteadof Trait1;
        Trait1::hi insteadof Trait2;
        Trait2::hi as hei;
        Trait1::hello as hehe;
    }
}
$Obj1 = new Class1();
$Obj1-&gt;hello();
$Obj1-&gt;hi();
echo â€œ\nâ€;
$Obj2 = new Class2();
$Obj2-&gt;hello();
$Obj2-&gt;hi();
$Obj2-&gt;hei();
$Obj2-&gt;hehe();</p>

<p>aså…³é”®è¯è¿˜æœ‰å¦å¤–ä¸€ä¸ªç”¨é€”ï¼Œé‚£å°±æ˜¯ä¿®æ”¹æ–¹æ³•çš„è®¿é—®æ§åˆ¶ï¼š
&lt;?php
trait Hello {
    public function hello() {
        echo â€œhello,æˆ‘æ˜¯å‘¨ä¼¯é€š\nâ€;
    }
}
class Class1 {
    use Hello {
        hello as protected;
    }
}
class Class2 {
    use Hello {
        Hello::hello as private hi;
    }
}
$Obj1 = new Class1();
$Obj1-&gt;hello(); # æŠ¥è‡´å‘½é”™è¯¯ï¼Œå› ä¸ºhelloæ–¹æ³•è¢«ä¿®æ”¹æˆå—ä¿æŠ¤çš„
$Obj2 = new Class2();
$Obj2-&gt;hello(); # è¾“å‡º: hello,æˆ‘æ˜¯å‘¨ä¼¯é€š,å› ä¸ºåŸæ¥çš„helloæ–¹æ³•ä»ç„¶æ˜¯å…¬å…±çš„
$Obj2-&gt;hi();  # æŠ¥è‡´å‘½é”™è¯¯ï¼Œå› ä¸ºåˆ«åhiæ–¹æ³•è¢«ä¿®æ”¹æˆç§æœ‰çš„</p>

<p>Trait ä¹Ÿèƒ½ç»„åˆTraitï¼ŒTraitä¸­æ”¯æŒæŠ½è±¡æ–¹æ³•ã€é™æ€å±æ€§åŠé™æ€æ–¹æ³•ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>

<p>&lt;?php
trait Hello {
    public function sayHello() {
        echo â€œHello æˆ‘æ˜¯å‘¨ä¼¯é€š\nâ€;
    }
}
trait World {
    use Hello;
    public function sayWorld() {
        echo â€œhello world\nâ€;
    }
    abstract public function getWorld();
    public function inc() {
        static $c = 0;
        $c = $c + 1;
        echo â€œ$c\nâ€;
    }
    public static function doSomething() {
        echo â€œDoing something\nâ€;
    }
}
class HelloWorld {
    use World;
    public function getWorld() {
        return â€˜do you get World ?â€™;
    }
}
$Obj = new HelloWorld();
$Obj-&gt;sayHello();
$Obj-&gt;sayWorld();
echo $Obj-&gt;getWorld() . â€œ\nâ€;
HelloWorld::doSomething();
$Obj-&gt;inc();
$Obj-&gt;inc();</p>

<p>ThinkPHP 5.0å¼€å§‹é‡‡ç”¨traitåŠŸèƒ½ï¼ˆPHP5.4+ï¼‰æ¥ä½œä¸ºä¸€ç§æ‰©å±•æœºåˆ¶ï¼Œå¯ä»¥æ–¹ä¾¿çš„å®ç°ä¸€ä¸ªç±»åº“çš„å¤šç»§æ‰¿é—®é¢˜ã€‚</p>

<p>traitæ˜¯ä¸€ç§ä¸ºç±»ä¼¼ PHP çš„å•ç»§æ‰¿è¯­è¨€è€Œå‡†å¤‡çš„ä»£ç å¤ç”¨æœºåˆ¶ã€‚traitä¸ºäº†å‡å°‘å•ç»§æ‰¿è¯­è¨€çš„é™åˆ¶ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè‡ªç”±åœ°åœ¨ä¸åŒå±‚æ¬¡ç»“æ„å†…ç‹¬ç«‹çš„ç±»ä¸­å¤ç”¨æ–¹æ³•é›†ã€‚traitå’Œç±»ç»„åˆçš„è¯­ä¹‰æ˜¯å®šä¹‰äº†ä¸€ç§æ–¹å¼æ¥å‡å°‘å¤æ‚æ€§ï¼Œé¿å…ä¼ ç»Ÿå¤šç»§æ‰¿å’Œæ··å…¥ç±»ï¼ˆMixinï¼‰ç›¸å…³çš„å…¸å‹é—®é¢˜ã€‚</p>

<p>ä½†ç”±äºPHP5.4ç‰ˆæœ¬ä¸æ”¯æŒtraitçš„è‡ªåŠ¨åŠ è½½ï¼Œå› æ­¤å¦‚æœæ˜¯PHP5.4ç‰ˆæœ¬ï¼Œå¿…é¡»æ‰‹åŠ¨å¯¼å…¥traitç±»åº“ï¼Œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªåŠ©æ‰‹å‡½æ•°load_traitï¼Œç”¨äºè‡ªåŠ¨åŠ è½½traitç±»åº“ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥è¿™æ ·æ­£ç¡®å¼•å…¥traitç±»åº“ã€‚</p>

<p>ç³»ç»Ÿæä¾›äº†ä¸€äº›å°è£…å¥½çš„traitç±»åº“ï¼Œä¸»è¦æ˜¯ç”¨äºæ§åˆ¶å™¨å’Œæ¨¡å‹ç±»çš„æ‰©å±•ã€‚è¿™äº›ç³»ç»Ÿå†…ç½®çš„traitç±»åº“çš„æ ¹å‘½åç©ºé—´é‡‡ç”¨traitsè€Œä¸æ˜¯traitï¼Œæ˜¯ä¸ºäº†é¿å…å’Œç³»ç»Ÿçš„å…³é”®å­—å†²çªã€‚</p>

<p>traitæ–¹å¼å¼•å…¥çš„ç±»åº“éœ€è¦æ³¨æ„ä¼˜å…ˆçº§ï¼Œä»åŸºç±»ç»§æ‰¿çš„æˆå‘˜å°†è¢« trait æ’å…¥çš„æˆå‘˜æ‰€è¦†ç›–ã€‚ä¼˜å…ˆé¡ºåºæ˜¯æ¥è‡ªå½“å‰ç±»çš„æˆå‘˜è¦†ç›–äº† traitçš„æ–¹æ³•ï¼Œè€Œ traitåˆ™è¦†ç›–äº†è¢«ç»§æ‰¿çš„æ–¹æ³•ã€‚</p>

<p>traitç±»ä¸­ä¸æ”¯æŒå®šä¹‰ç±»çš„å¸¸é‡ï¼Œåœ¨traitä¸­å®šä¹‰çš„å±æ€§å°†ä¸èƒ½åœ¨å½“å‰ç±»ä¸­æˆ–è€…ç»§æ‰¿çš„ç±»ä¸­é‡æ–°å®šä¹‰ã€‚</p>

<p>å†²çªçš„è§£å†³
æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªç±»åº“ä¸­å¼•å…¥å¤šä¸ªtraitç±»åº“ï¼Œå¦‚æœä¸¤ä¸ªtraitéƒ½å®šä¹‰äº†ä¸€ä¸ªåŒåçš„æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®è§£å†³å†²çªå°†ä¼šäº§ç”Ÿä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚</p>

<p>ä¸ºäº†è§£å†³å¤šä¸ªtraitåœ¨åŒä¸€ä¸ªç±»ä¸­çš„å‘½åå†²çªï¼Œéœ€è¦ä½¿ç”¨ insteadofæ“ä½œç¬¦æ¥æ˜ç¡®æŒ‡å®šä½¿ç”¨å†²çªæ–¹æ³•ä¸­çš„å“ªä¸€ä¸ªã€‚</p>

<p>Traitså¯ä»¥å¸®åŠ©äº¤äº’ä½œç”¨ï¼Œä¿è¯observable sequence å±æ€§ç©¿è¿‡ç•Œé¢è¾¹ç•Œï¼Œå¯¹æ¯”å¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸­ä½¿ç”¨çš„åŸå£°Observableï¼ŒTraitsåŒæ—¶ä¹Ÿæä¾›contextual meaningï¼ˆä¸Šä¸‹æ–‡æ„ä¹‰ï¼‰, syntactical sugar and target more specific use-casesï¼ˆæ›´å¤šçš„ç‰¹æ®Šåº”ç”¨åœºæ™¯ï¼‰ ã€‚
ç”±äºä¸Šè¿°åŸå› ï¼ŒTraitsæ˜¯å®Œå…¨å¯é€‰çš„ï¼Œä½ å¯ä»¥åœ¨ä½ ç¨‹åºçš„ä»»ä½•åœ°æ–¹è‡ªç”±çš„ä½¿ç”¨åŸç”Ÿçš„Observable sequencesï¼Œå› ä¸ºæ‰€æœ‰çš„RxSwift/RxCocoa APIséƒ½æ”¯æŒå®ƒä»¬ã€‚</p>

<p>æ³¨æ„ï¼šè¿™ç¯‡æ–‡æ¡£ä¸­çš„ä¸€äº›Traitsæè¿°ï¼ˆä¾‹å¦‚Driverï¼‰åªæ˜¯é’ˆå¯¹ RxCocoa å·¥ç¨‹,ä¸€äº›åªæ˜¯é€šå¸¸ RxSwift å·¥ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯åŒæ ·çš„åŸç†å¯ä»¥åœ¨å…¶ä»–Rxå®ç°åº“ä¸­å®ç°ã€‚</p>

<p>General
Why
swift æœ‰ä¸€ä¸ªå¼ºå¤§çš„ç±»å‹æ£€æµ‹ç³»ç»Ÿï¼Œå®ƒèƒ½å¤Ÿæé«˜æˆ‘ä»¬åº”ç”¨çš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ï¼Œä¹Ÿä½¿Rxæœ‰æ›´ç›´è§‚æ›´ç›´æ¥çš„ä½“éªŒã€‚</p>

<p>How they work
Traits åªæ˜¯ä¸€ä¸ªç®€å•åŒ…è£…çš„structï¼Œä»–æœ‰ä¸€ä¸ªread-onlyçš„Observable sequenceå±æ€§ã€‚</p>

<p>struct Single<Element> {
    let source: Observable<Element>
}</Element></Element></p>

<p>struct Driver<Element> {
    let source: Observable<Element>
}
...
ä½ å¯ä»¥æŠŠå¥¹ä»¬æƒ³æˆæ˜¯å»ºé€ è€…æ¨¡å¼çš„å®ç°ã€‚å½“ä¸€ä¸ªTraitè¢«å»ºé€ ï¼Œè°ƒç”¨.asObservable()æ—¶ï¼Œå°†ä¼šæŠŠå®ƒè½¬æ¢å›ä¸€ä¸ªobservable sequenceã€‚</Element></Element></p>

<p>RxSwift traits
Single
Singleä¸åŒäºObservableï¼ˆèƒ½å¤Ÿå‘é€å¾ˆå¤šå…ƒç´ ï¼‰ï¼Œä»–åªèƒ½å‘é€ä¸€ä¸ªå…ƒç´ æˆ–è€…ä¸€ä¸ªé”™è¯¯ã€‚</p>

<p>å‘å°„ä¸€ä¸ªå…ƒç´ ï¼Œæˆ–è€…ä¸€ä¸ªé”™è¯¯ã€‚
ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚
ä¸€ä¸ªå¸¸ç”¨çš„åœºæ™¯æ—¶æ‰§è¡ŒHTTPè¯·æ±‚æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªresponseæˆ–è€…errorã€‚Singleå¯è¢«ç”¨åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼šä½ åªå…³å¿ƒä¸€ä¸ªå…ƒç´ ï¼Œè€Œä¸æ˜¯æ— é™çš„å…ƒç´ æµã€‚</p>

<p>åˆ›å»ºSingle
åˆ›å»ºSingleæ ¹åˆ›å»ºObservableç±»ä¼¼ï¼Œä¾‹å¦‚ï¼š</p>

<p>func getRepo(_ repo: String) -&gt; Single&lt;[String: Any]&gt; {
   return Single&lt;[String: Any]&gt;.create { single in
       let task = URLSession.shared.dataTask(with: URL(string: â€œhttps://api.github.com/repos/(repo)â€)!) { data, _, error in
           if let error = error {
               single(.error(error))
               return
           }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       guard let data = data,
             let json = try? JSONSerialization.jsonObject(with: data, options: .mutableLeaves),
             let result = json as? [String: Any] else {
           single(.error(DataError.cantParseJSON))
           return
       }

       single(.success(result))
   }

   task.resume()

   return Disposables.create { task.cancel() }    } } åˆ›å»ºå®Œæ¯•åï¼Œè¿™æ ·ä½¿ç”¨ï¼š
</code></pre></div></div>

<p>getRepo(â€œReactiveX/RxSwiftâ€)
   .subscribe { event in
       switch event {
           case .success(let json):
               print(â€œJSON: â€œ, json)
           case .error(let error):
               print(â€œError: â€œ, error)
       }
   }
   .disposed(by: disposeBag)
æˆ–è€…åƒä¸‹é¢è¿™æ ·ä½¿ç”¨subscribe(onSuccess:onError:)ï¼š</p>

<p>getRepo(â€œReactiveX/RxSwiftâ€)
    .subscribe(onSuccess: { json in
                   print(â€œJSON: â€œ, json)
               },
               onError: { error in
                   print(â€œError: â€œ, error)
               })
    .disposed(by: disposeBag)
è¿™ä¸ªè®¢é˜…æä¾›äº†ä¸€ä¸ªSingleEventï¼Œå®ƒåªèƒ½æ˜¯.successï¼ˆåŒ…å«äº†ä¸€ä¸ªSingleçš„ç§ç±»çš„å…ƒç´ ï¼‰æˆ–è€….errorã€‚è¿™ä¸¤ç§å¯èƒ½ã€‚ä¸€ä¸ªäº‹ä»¶åä¸ä¼šå†æœ‰æ–°çš„äº‹ä»¶å‘å°„ã€‚</p>

<p>å¯ä»¥ä½¿ç”¨.asSingle()æ–¹æ³•æ¥æ”¹å˜Observable sequenceæˆä¸ºä¸€ä¸ªSingleã€‚</p>

<p>Completable
Completableæ˜¯ä¸€ä¸ªåªèƒ½completeæˆ–è€…errorçš„Observableã€‚ä»–ä¸èƒ½å‘å°„å…ƒç´ ã€‚</p>

<p>å‘å°„0ä¸ªå…ƒç´ 
å‘å°„ä¸€ä¸ªcompleteæˆ–è€…è¯´erroräº‹ä»¶ã€‚
æ²¡æœ‰å‰¯æ€»ç”¨ã€‚
ä¸€ç§Completableçš„ä½¿ç”¨æƒ…æ™¯æ˜¯ï¼šæˆ‘ä»¬åªå…³å¿ƒè¿è¡Œæ˜¯å¦ç»“æŸè€Œä¸å…³å¿ƒè¿è¡Œçš„ç»“æœï¼Œå¯ä»¥å¯¹æ¯”Observable<Void>ï¼Œå®ƒä¹Ÿä¸ä¼šäº§ç”Ÿå…ƒç´ ã€‚</Void></p>

<p>åˆ›å»ºCompletable
åˆ›å»ºCompletableæ ¹åˆ›å»ºObservableç±»ä¼¼ï¼š</p>

<p>func cacheLocally() -&gt; Completable {
    return Completable.create { completable in
       // Store some data locally
       â€¦
       â€¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   guard success else {
       completable(.error(CacheError.failedCaching))
       return Disposables.create {}
   }

   completable(.completed)
   return Disposables.create {}
} } åˆ›å»ºå®Œæ¯•åä½¿ç”¨
</code></pre></div></div>

<p>cacheLocally()
    .subscribe { completable in
        switch completable {
            case .completed:
                print(â€œCompleted with no errorâ€)
            case .error(let error):
                print(â€œCompleted with an error: (error.localizedDescription)â€)
        }
    }
    .disposed(by: disposeBag)
æˆ–è€…ä½¿ç”¨subscribe(onCompleted:onError:)</p>

<p>cacheLocally()
    .subscribe(onCompleted: {
                   print(â€œCompleted with no errorâ€)
               },
               onError: { error in
                   print(â€œCompleted with an error: (error.localizedDescription)â€)
               })
    .disposed(by: disposeBag)
è¿™ç§è®¢é˜…æä¾›äº†ä¸€ä¸ªCompletableEventï¼Œå®ƒåªèƒ½.completedï¼ˆè¡¨ç¤ºæ“ä½œå®Œæˆæ²¡æœ‰é”™è¯¯ï¼‰æˆ–è€….errorã€‚ä¸€ä¸ªäº‹ä»¶ä¹‹åä¸ä¼šå†å‘å°„æ–°çš„äº‹ä»¶ã€‚</p>

<p>Maybe
Maybeæ˜¯ä¸€ä¸ªä»‹äºSingleå’ŒCompletableä¹‹é—´çš„Observableã€‚å®ƒèƒ½å‘å°„ä¸€ä¸ªå…ƒç´ ï¼Œä¸å‘å°„å…ƒç´ completeï¼Œæˆ–è€…å‘å°„ä¸€ä¸ªerrorã€‚</p>

<p>æ³¨æ„ï¼šè¿™ä¸‰ç§æƒ…å†µçš„ä»»æ„ä¸€ç§éƒ½ä¼šä¸­æ–­Maybeã€‚è¿™å°±æ„å‘³ç€completedçš„Maybeä¸èƒ½å†å‘å°„å…ƒç´ ï¼Œå‘å°„å®Œä¸€ä¸ªå…ƒç´ çš„Maybeä¸èƒ½åœ¨å‘é€Completionäº‹ä»¶ã€‚</p>

<p>å‘å°„ä¸€ä¸ªCompletionäº‹ä»¶ï¼Œæˆ–è€…ä¸€ä¸ªå…ƒç´ ï¼Œæˆ–è€…errorä¿¡æ¯ã€‚
æ²¡æœ‰å‰¯ä½œç”¨
ä½ å¯ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨Maybeï¼šèƒ½å¤Ÿå‘å°„ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ˜¯å¹¶ä¸ä¸€å®šå¿…é¡»å‘å°„ä¸€ä¸ªã€‚</p>

<p>åˆ›å»ºMaybe
åˆ›å»ºMaybeæ ¹åˆ›å»ºObservableç±»ä¼¼ï¼š</p>

<p>func generateString() -&gt; Maybe<String> {
    return Maybe<String>.create { maybe in
        maybe(.success("RxSwift"))</String></String></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    // OR

    maybe(.completed)

    // OR

    maybe(.error(error))

    return Disposables.create {}
} } åˆ›å»ºå®Œæ¯•åä½¿ç”¨
</code></pre></div></div>

<p>generateString()
    .subscribe { maybe in
        switch maybe {
            case .success(let element):
                print(â€œCompleted with element (element)â€)
            case .completed:
                print(â€œCompleted with no elementâ€)
            case .error(let error):
                print(â€œCompleted with an error (error.localizedDescription)â€)
        }
    }
    .disposed(by: disposeBag)
æˆ–è€…ä½¿ç”¨subscribe(onCompleted:onError:)</p>

<p>generateString()
    .subscribe(onSuccess: { element in
                   print(â€œCompleted with element (element)â€)
               },
               onError: { error in
                   print(â€œCompleted with an error (error.localizedDescription)â€)
               },
               onCompleted: {
                   print(â€œCompleted with no elementâ€)
               })
    .disposed(by: disposeBag)
ä½ å¯ä»¥ä½¿ç”¨.asMaybe()å°†Observableè½¬åŒ–æˆMaybeã€‚</p>

<p>RxCocoa traits
Driver
è¿™ä¸ªæ˜¯æœ€ç²¾ç»†çš„traitã€‚å®ƒçš„ç›®çš„æ˜¯æä¾›ä¸€ç§ç›´è§‚çš„æ–¹å¼ä¹¦å†™UIå±‚ä»£ç ã€‚æˆ–è€…å…¶ä»–ä»»ä½•æƒ…å¢ƒä½ æƒ³è¦ä½¿ç”¨æ•°æ®é©±åŠ¨åº”ç”¨ã€‚</p>

<p>ä¸ä¼šäº§ç”Ÿé”™è¯¯ã€‚
è§‚å¯Ÿè€…å‡ºç°åœ¨ä¸»çº¿ç¨‹ã€‚
æœ‰å‰¯ä½œç”¨ï¼ˆshareReplayLatestWhileConnectedï¼‰
ä¸ºä»€ä¹ˆå«Driver
ä»–çš„è®¾è®¡æ„å›¾æ˜¯ä¸ºäº†æ¨¡ä»¿åºåˆ—é©±åŠ¨ä½ çš„åº”ç”¨ã€‚
ä¾‹å¦‚ï¼š</p>

<p>é€šè¿‡CoreData é©±åŠ¨UI
é€šè¿‡å…¶ä»–ç•Œé¢çš„å…ƒç´ ç­‰ç­‰ï¼ˆbindingsï¼‰é©±åŠ¨UI ã€‚
å°±åƒé€šå¸¸çš„æ“ä½œç³»ç»Ÿé©±åŠ¨ä¸€æ ·ï¼Œä¸€æ—¦é”™è¯¯å‘ä¸Šï¼Œä½ çš„åº”ç”¨å°±ä¼šåœæ­¢å›åº”ç”¨æˆ·è¾“å…¥ã€‚è¿™äº›å…ƒç´ æ˜¯åœ¨ä¸»çº¿åŸè¢«è§‚å¯Ÿçš„è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºç•Œé¢å…ƒç´ å’Œåº”ç”¨é€»è¾‘é€šå¸¸ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚
å½“ç„¶ï¼ŒDriverä¼šäº§ç”Ÿå‰¯ä½œç”¨
ä¾‹å¦‚ï¼š
å®é™…çš„ä¹ æƒ¯æ–¹æ³•
è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„åˆå­¦è€…ç”¨æ³•ä¾‹å­</p>

<p>let results = query.rx.text
    .throttle(0.3, scheduler: MainScheduler.instance)
    .flatMapLatest { query in
        fetchAutoCompleteItems(query)
    }</p>

<p>results
    .map { â€œ($0.count)â€ }
    .bind(to: resultCount.rx.text)
    .disposed(by: disposeBag)</p>

<p>results
    .bind(to: resultsTableView.rx.items(cellIdentifier: â€œCellâ€)) { (_, result, cell) in
        cell.textLabel?.text = â€œ(result)â€
    }
    .disposed(by: disposeBag)
è¿™æ®µä»£ç çš„æ„å›¾æ˜¯ï¼š</p>

<p>è·å–ç”¨æˆ·è¾“å…¥
é“¾æ¥æœåŠ¡å™¨è·å–ç”¨æˆ·åˆ—è¡¨ç»“æœï¼ˆæ¯æ¬¡æŸ¥è¯¢ï¼‰
ç»‘å®šç»“æœåˆ°ä¸¤ä¸ªUIå…ƒç´ ï¼štableview å’Œç”¨æ¥æ˜¾ç¤ºæ•°é‡çš„lableã€‚
é‚£ä¹ˆè¿™æ®µä»£ç æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ
å¦‚æœfetchAutoCompleteItems observableäº§ç”Ÿé”™è¯¯ï¼ˆé“¾æ¥é”™è¯¯æˆ–è€…è§£æé”™è¯¯ï¼‰ï¼Œè¿™ä¸ªé”™è¯¯æ²¡æœ‰ç»‘å®šä»»ä½•ä¸œè¥¿ï¼ŒUIä¸ä¼šå›åº”å…¶ä»–æ–°çš„æŸ¥è¯¢ã€‚
å¦‚æœfetchAutoCompleteItems åœ¨å…¶ä»–åå°çº¿ç¨‹ç§è¿”å›ç»“æœï¼Œç»“æœä¼šåœ¨åå°çº¿ç¨‹ç»‘å®šUIå…ƒç´ ï¼Œè¿™å°±å¯èƒ½å¯¼è‡´non-deterministic crashesã€‚
ç»“æœè¢«ç»‘å®šåˆ°ä¸¤ä¸ªç•Œé¢å…ƒç´ ã€‚è¿™å°±æ„å‘³ç€æ¯ä¸€æ¬¡ç”¨æˆ·æŸ¥è¯¢ï¼Œå°±ä¼šåšä¸¤æ¬¡HTTPè¯·æ±‚ï¼Œæ¯ä¸ªç•Œé¢å…ƒç´ åšä¸€æ¬¡ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚
æ›´åˆé€‚ä¸€ç‚¹çš„å†™æ³•ï¼š</p>

<p>let results = query.rx.text
    .throttle(0.3, scheduler: MainScheduler.instance)
    .flatMapLatest { query in
        fetchAutoCompleteItems(query)
            .observeOn(MainScheduler.instance)  // results are returned on MainScheduler
            .catchErrorJustReturn([])           // in the worst case, errors are handled
    }
    .shareReplay(1)                             // HTTP requests are shared and results replayed
                                                // to all UI elements</p>

<p>results
    .map { â€œ($0.count)â€ }
    .bind(to: resultCount.rx.text)
    .disposed(by: disposeBag)</p>

<p>results
    .bind(to: resultsTableView.rx.items(cellIdentifier: â€œCellâ€)) { (_, result, cell) in
        cell.textLabel?.text = â€œ(result)â€
    }
    .disposed(by: disposeBag)
åœ¨ä¸€ä¸ªå¤§çš„ç³»ç»Ÿä¸­ç¡®ä¿æ¯ä¸€ä¸ªéœ€æ±‚éƒ½è¢«æ­£ç¡®å†Œå¤„ç†æ‰æ˜¯å¾ˆæœ‰æŒ‘æˆ˜æ€§çš„ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªç®€å•æ–¹å¼æ¥è§£å†³è¿™ä¸ªéœ€æ±‚ï¼Œä½¿ç”¨ç¼–è¯‘å™¨å’Œtraitsã€‚
ä¸‹é¢ä»£ç çœ‹èµ·æ¥ä¸ä¸Šé¢å·®åˆ«ä¸å¤§</p>

<p>let results = query.rx.text.asDriver()        // This converts a normal sequence into a <code class="language-plaintext highlighter-rouge">Driver</code> sequence.
    .throttle(0.3, scheduler: MainScheduler.instance)
    .flatMapLatest { query in
        fetchAutoCompleteItems(query)
            .asDriver(onErrorJustReturn: [])  // Builder just needs info about what to return in case of error.
    }</p>

<p>results
    .map { â€œ($0.count)â€ }
    .drive(resultCount.rx.text)               // If there is a <code class="language-plaintext highlighter-rouge">drive</code> method available instead of <code class="language-plaintext highlighter-rouge">bindTo</code>,
    .disposed(by: disposeBag)              // that means that the compiler has proven that all properties
                                              // are satisfied.
results
    .drive(resultsTableView.rx.items(cellIdentifier: â€œCellâ€)) { (_, result, cell) in
        cell.textLabel?.text = â€œ(result)â€
    }
    .disposed(by: disposeBag)
é‚£åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ
é¦–å…ˆasDriveræ–¹æ³•è½¬å˜ControlProperty trait æˆä¸ºDriver traitã€‚</p>

<p>query.rx.text.asDriver()
æ³¨æ„è¿™é‡Œæ²¡æœ‰åœ¨åšå…¶ä»–çš„ä»»ä½•ç‰¹æ®Šçš„å¤„ç†ã€‚DriveråŒ…å«æ‰€æœ‰ControlPropertyçš„å±æ€§ã€‚
ç¬¬äºŒä¸ªæ”¹å˜æ˜¯</p>

<p>.asDriver(onErrorJustReturn: [])
ä»»ä½•ä¸€ä¸ªobservable sequenceéƒ½å¯ä»¥è¢«è½¬åŒ–æˆDriverï¼Œåªè¦å®ƒæ»¡è¶³3ç‚¹</p>

<p>ä¸ä¼šäº§ç”Ÿé”™è¯¯
åœ¨ä¸»çº¿åŸè§‚å¯Ÿ
äº§ç”Ÿå‰¯ä½œç”¨ï¼ˆshareReplayLatestWhileConnectedï¼‰
é‚£ä¹ˆä½ æ€æ ·ç¡®ä¿æ»¡è¶³è¿™ä¸‰ç‚¹å‘¢ï¼Ÿåªéœ€è¦ä½¿ç”¨Rxæ“ä½œç¬¦ . asDriver(onErrorJustReturn: [])è¿™å°±ç­‰äºä¸‹æ°‘çš„ä»£ç ï¼š
let safeSequence = xs
  .observeOn(MainScheduler.instance)       // observe events on main scheduler
  .catchErrorJustReturn(onErrorJustReturn) // canâ€™t error out
  .shareReplayLatestWhileConnected()       // side effects sharing
return Driver(raw: safeSequence)           // wrap it up
æœ€åä¸€ç‚¹æ˜¯ä½¿ç”¨driveä»£æ›¿bindToã€‚
åªæœ‰åœ¨Driver traitå®šä¹‰äº†driveã€‚ä¹Ÿå°±æ˜¯ä¼šæ‰€å¦‚æœä½ åœ¨ä»£ç ä¸­çœ‹åˆ°driveï¼Œé‚£ä¹ˆobservable sequenceå°±ä¸ä¼šäº§ç”Ÿé”™è¯¯ï¼Œå¹¶ä¸”åœ¨ä¸»çº¿ç¨‹ç›‘å¬ï¼Œè¿™æ ·ç»‘å®šUIå…ƒç´ å°±å¾ˆå®‰å…¨ã€‚</p>

<p>ç„¶è€Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç†è®ºä¸Šï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥åœ¨ObservableTypeæˆ–è€…å…¶ä»–æ¥å£ä¸Šå®šä¹‰driveæ–¹æ³•ã€‚æ‰€ä»¥ä¸ºäº†å®‰å…¨ï¼Œåœ¨ç»‘å®šUIå…ƒç´ ä¹‹å‰ä½¿ç”¨let results: Driver&lt;[Results]&gt; = â€¦åˆ›å»ºä¸€ä¸ªçŸ­æœŸçš„å®šä¹‰æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªé—®é¢˜ç•™ç»™è¯»è€…æ¥å†³å®šï¼Œæ˜¯å¦è¿™æ˜¯ä¸€ä¸ªç¡®å®å¯è¡Œçš„åœºæ™¯ã€‚</p>

<p>ControlProperty / ControlEvent
ä¸ä¼šäº§ç”Ÿé”™è¯¯
è®¢é˜…å‡ºç°åœ¨ä¸»çº¿ç¨‹
ç›‘å¬å‡ºç°åœ¨å‡ºçº¿ç¨‹
ä¼šäº§ç”Ÿå…¶ä»–å½±å“ã€‚</p>
:ET