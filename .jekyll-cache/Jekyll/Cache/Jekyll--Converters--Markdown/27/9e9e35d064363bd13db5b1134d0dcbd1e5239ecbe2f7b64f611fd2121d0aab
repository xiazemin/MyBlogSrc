I"Ğ,<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Akkaå’ŒÎ¼JavaActorsÎ¼JavaActorså‡æ˜¯javaçš„Actoråº“ï¼Œå…¶ä¸­Akkaæä¾›äº†å«ä¸ºå®Œæ•´çš„Actorå¼€å‘æ¡†æ¶ï¼Œè¾ƒä¸ºåºå¤§ï¼Œå­¦ä¹ æˆæœ¬å¾ˆé«˜ï¼ŒÎ¼JavaActors æ˜¯ä¸€ä¸ªè½»é‡çº§Actoråº“ï¼Œå¤§çº¦ä»…æœ‰1200è¡Œä»£ç ï¼Œæ¯”è¾ƒé€‚åˆå…¥é—¨ã€‚
</code></pre></div></div>

<p>ä¸€.Akka Demo 
Akkaæ˜¯ä¸€ä¸ªç›¸å½“æˆç†Ÿã€å¼ºå¤§çš„åº“ï¼Œgithubä¸Šdownloadä¸‹çš„æ˜¯Akkaçš„æºç ï¼Œåº”è¯¥ä½¿ç”¨sbtæ„å»ºçš„å·¥ç¨‹ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨sbtç»éªŒï¼Œæƒ³å¯¼å‡ºjarè¿˜æŒºä¸å®¹æ˜“çš„ï¼Œæ¨èAkkaå®˜ç½‘ä¸‹è½½akkaå„ä¸ªç»„ä»¶çš„jarå»ä½¿ç”¨ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹helloworld çº§åˆ«Akkaçš„demoã€‚</p>

<p>1.Akkaçš„ä¸»è¦ç»„ä»¶</p>

<p>akka-actor.jar ï¼š Actoræ ¸å¿ƒç»„ä»¶äº†ï¼Œå®šä¹‰äº†Acotræ ¸å¿ƒç±»</p>

<p>akka-slf4f.jar : SLF4F Loggerçš„æ”¯æŒï¼Œä¸€ä¸ªæ‰“logçš„ç»„ä»¶ï¼Œä¸ç”¨å¤ªå…³æ³¨</p>

<p>akka-remote.jar : Actoråšè¿œç¨‹è°ƒç”¨çš„jarï¼Œç±»ä¼¼RFCå§</p>

<p>akka-cluster : actoråšé›†ç¾¤ç®¡ç†ç»„ä»¶</p>

<p>akka-camel.jar ï¼š å¯¹Apache Camel é›†æˆæ¥å£</p>

<p>scala-library-2.11.8.jar ï¼š akkaæ ¸å¿ƒåº”è¯¥æ˜¯Scalaå†™çš„ï¼Œè¿™ä¸ªç»„ä»¶å°±æ˜¯å¯¹akkaçš„æ ¸å¿ƒæ”¯æŒ</p>

<p>Akkaè¿˜æœ‰å¾ˆå¤šç»„ä»¶ï¼Œä¸è¿‡å¯¹äºhello worldçº§çš„ç¨‹åºç®€å•äº†è§£å‡ ä¸ªå°±okäº†ã€‚å·¥ç¨‹æ˜¯åŸºäºeclipseçš„ï¼Œéœ€è¦åŒ…å«ä¸‹é¢å‡ ä¸ªåŸºç¡€çš„ç»„ä»¶ï¼š
	akka-actor.jar ï¼š Actoræ ¸å¿ƒç»„ä»¶äº†ï¼Œå®šä¹‰äº†Acotræ ¸å¿ƒç±»
	akka-slf4f.jar : SLF4F Loggerçš„æ”¯æŒï¼Œä¸€ä¸ªæ‰“logçš„ç»„ä»¶ï¼Œä¸ç”¨å¤ªå…³æ³¨
	scala-library-2.11.8.jar ï¼š akkaæ ¸å¿ƒåº”è¯¥æ˜¯Scalaå†™çš„ï¼Œè¿™ä¸ªç»„ä»¶å°±æ˜¯å¯¹akkaçš„æ ¸å¿ƒæ”¯æŒ
	config-1.3.0.jar</p>

<p>ç¼–å†™ä¸¤ä¸ªActorï¼š
package demo02;</p>

<p>import akka.actor.UntypedActor;
/*</p>
<ul>
  <li>
    <p>UntypedAcotræ˜¯æ— ç±»å‹Actorçš„ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç»§æ‰¿ä¸æ ¸å¿ƒç±»Actor
 */
public class Greeter extends UntypedActor {</p>

    <p>public static enum Msg{
     GREET , DONE;
 }
 /**</p>
    <ul>
      <li>æ¯ä¸ªActorå¿…é¡»å®ç°OnReceiveï¼Œå½“è¯¥Actoræ”¶åˆ°æ¶ˆæ¯è°ƒç”¨è¯¥æ–¹æ³•
  */
 @Override
 public void onReceive(Object msg) throws Throwable {
 if(msg == Msg.GREET){
     System.out.println(â€œHello worldâ€);
     /**
      * è¿™é‡Œåæ§½ä¸€ä¸‹Akkaå¯¹äºå‘æ¶ˆæ¯çš„è®¾è®¡ï¼Œå‘é€æ¶ˆæ¯çš„è®¾è®¡ç«Ÿç„¶æ˜¯ï¼š
      * receiver.tell(msg , senderï¼‰
      * ä¹Ÿè®¸æ²¡ç†è§£akkaè®¾è®¡çš„ç†å¿µï¼Œä½†æ˜¯æ­£å¸¸äººè®¾è®¡ä¸åº”è¯¥æ˜¯ï¼š
      *  sender.tell(msg ï¼Œ receiverï¼‰
      *  æ±—â€¦â€¦
      */
     getSender().tell(Msg.DONE, getSelf());
 }else{
     unhandled(msg);
 }</li>
    </ul>

    <p>}</p>
  </li>
</ul>

<p>}
package demo02;</p>

<p>import akka.actor.ActorRef;
import akka.actor.Props;
import akka.actor.UntypedActor;</p>

<p>public class HelloWorld extends UntypedActor {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Override
public void preStart(){
    final ActorRef greeter = getContext().actorOf(Props.create(Greeter.class));
    greeter.tell(Greeter.Msg.GREET, getSelf());
}


@Override
public void onReceive(Object msg) throws Throwable {

    if(msg == Greeter.Msg.DONE){
        getContext().stop(getSelf());
    }else{
        unhandled(msg);
    }
    
}
</code></pre></div></div>

<p>}
ä¸‹é¢æ˜¯Mainæ–¹æ³•ï¼š
package demo02;</p>

<p>import akka.actor.ActorRef;
import akka.actor.ActorSystem;
import akka.actor.Props;
import akka.actor.Terminated;
import akka.actor.UntypedActor;
import akka.event.Logging;
import akka.event.LoggingAdapter;</p>

<p>public class Main {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static void main(String[] args) {
    //ActorSystem ç›¸å½“äºActorManagerï¼Œç®¡ç†å„ç§Acorè°ƒåº¦ã€çº¿ç¨‹ç®¡ç†ç­‰
    ActorSystem system = ActorSystem.create("hello");
    //åˆ›å»ºä¸€ä¸ªHelloWorld ç±»å‹çš„Actorï¼Œåœ¨Actorå¯åŠ¨å‰ï¼Œä¼šè°ƒpreStartï¼ˆï¼‰ï¼Œæ­¤æ—¶ä¼šæƒ³Greeterå‘æ¶ˆæ¯
    ActorRef actor = system.actorOf(Props.create(HelloWorld.class));
    //æ·»åŠ ç»“æŸç»ˆç»“Actorï¼Œå½“ActorSystemè°ƒStopæ—¶ï¼Œä¼šå‘æ¯ä¸ªActorå‘é€Terminatedæ¶ˆæ¯    
    system.actorOf(Props.create(Terminator.class, actor), "terminator");
    
}
public static class Terminator extends UntypedActor{

    private final LoggingAdapter log = Logging.getLogger(getContext().system(),this);
    private ActorRef actorRef = null;
    
    public Terminator(ActorRef ref){
        System.out.println("Terminator Init !!!");
        actorRef = ref;
        getContext().watch(actorRef);
    }
    
    @Override
    public void onReceive(Object msg) throws Throwable {
          if (msg instanceof Terminated) {
              log.info("{} has terminated, shutting down system", actorRef.path());
              getContext().system().terminate();
            } else {
              unhandled(msg);
            }
        
    }
    
}
</code></pre></div></div>

<p>}
ä¸Šé¢ä»£ç åœ¨akkaçš„æºç ä¸­sampleéƒ½å¯ä»¥æ‰¾åˆ°çš„
<!-- more -->
äºŒ.Î¼JavaActors
    Î¼JavaActors æ˜¯ä¸€ä¸ªååˆ†è½»é‡çº§çš„Actoråº“ï¼Œå®ç°æ ¸å¿ƒçš„Actorè°ƒåº¦ï¼Œä¸æ¶‰åŠå¤æ‚çš„æ¡†æ¶ï¼Œç®€å•åˆ†æä¸€ä¸‹å®ƒçš„æºç å§</p>

<p>1.Actoræ ¸å¿ƒæ¥å£</p>

<p>Actorï¼šå®šä¹‰äº†ä¸€ä¸ªæ ‡å‡†çš„Actoråº”è¯¥å…·æœ‰è¡Œä¸º</p>

<p>ActorManagerï¼šActorç®¡ç†å™¨æ¥å£ï¼Œæä¾›çº¿ç¨‹ç®¡ç†ï¼ŒActorè°ƒåº¦ç­‰</p>

<p>Messager : Actorç›¸äº’é—´ä¼ é€’ä¼ é€’çš„æ¶ˆæ¯æ¥å£ï¼Œå½“ç„¶é™„å¸¦çš„æ¥å£è¿˜æœ‰MessageEventå’ŒMessageListener</p>

<p>ç®€å•å¼•ç”¨ä½œè€…å¯¹è¿™ä¸ªæ¦‚å¿µçš„æè¿°ï¼š</p>

<p>Actor æ˜¯ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œä¸€æ¬¡å¤„ç†ä¸€æ¡æ¶ˆæ¯ã€‚Actor å…·æœ‰ä»¥ä¸‹å…³é”®è¡Œä¸ºæˆ–ç‰¹å¾ï¼š</p>

<p>æ¯ä¸ª actor æœ‰ä¸€ä¸ª nameï¼Œè¯¥åç§°åœ¨æ¯ä¸ª ActorManager ä¸­å¿…é¡»æ˜¯æƒŸä¸€çš„ã€‚
æ¯ä¸ª actor å±äºä¸€ä¸ª categoryï¼›ç±»åˆ«æ˜¯ä¸€ç§å‘ä¸€ç»„ actor ä¸­çš„ä¸€ä¸ªæˆå‘˜å‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚ä¸€ä¸ª actor ä¸€æ¬¡åªèƒ½å±äºä¸€ä¸ªç±»åˆ«ã€‚
åªè¦ ActorManager å¯ä»¥æä¾›ä¸€ä¸ªæ‰§è¡Œ actor çš„çº¿ç¨‹ï¼Œç³»ç»Ÿå°±ä¼šè°ƒç”¨ receive()ã€‚ä¸ºäº†ä¿æŒæœ€é«˜æ•ˆç‡ï¼Œactor åº”è¯¥è¿…é€Ÿå¤„ç†æ¶ˆæ¯ï¼Œè€Œä¸è¦è¿›å…¥æ¼«é•¿çš„ç­‰å¾…çŠ¶æ€ï¼ˆæ¯”å¦‚ç­‰å¾…äººä¸ºè¾“å…¥ï¼‰ã€‚
willReceive() å…è®¸ actor è¿‡æ»¤æ½œåœ¨çš„æ¶ˆæ¯ä¸»é¢˜ã€‚
peek() å…è®¸è¯¥ actor å’Œå…¶ä»– actor æŸ¥çœ‹æ˜¯å¦å­˜åœ¨æŒ‚èµ·çš„æ¶ˆæ¯ï¼ˆæˆ–è®¸æ˜¯ä¸ºäº†é€‰æ‹©ä¸»é¢˜ï¼‰ã€‚
remove() å…è®¸è¯¥ actor å’Œå…¶ä»– actor åˆ é™¤æˆ–å–æ¶ˆä»»ä½•å°šæœªå¤„ç†çš„æ¶ˆæ¯ã€‚
getMessageCount() å…è®¸è¯¥ actor å’Œå…¶ä»– actor è·å–æŒ‚èµ·çš„æ¶ˆæ¯æ•°é‡ã€‚
getMaxMessageCount() å…è®¸ actor é™åˆ¶æ”¯æŒçš„æŒ‚èµ·æ¶ˆæ¯æ•°é‡ï¼›æ­¤æ–¹æ³•å¯ç”¨äºé¢„é˜²ä¸å—æ§åˆ¶åœ°å‘é€ã€‚
å¤§éƒ¨åˆ†ç¨‹åºéƒ½æœ‰è®¸å¤š actorï¼Œè¿™äº› actor å¸¸å¸¸å…·æœ‰ä¸åŒçš„ç±»å‹ã€‚actor å¯åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºæˆ–åœ¨ç¨‹åºæ‰§è¡Œæ—¶åˆ›å»ºï¼ˆå’Œé”€æ¯ï¼‰ã€‚æœ¬æ–‡ä¸­çš„ actor åŒ… åŒ…å«ä¸€ä¸ªåä¸º AbstractActor çš„æŠ½è±¡ç±»ï¼Œactor å®ç°åŸºäºè¯¥ç±»ã€‚</p>

<p>ActorManager æ˜¯ä¸€ä¸ª actor ç®¡ç†å™¨ã€‚å®ƒè´Ÿè´£å‘ actor åˆ†é…çº¿ç¨‹ï¼ˆè¿›è€Œåˆ†é…å¤„ç†å™¨ï¼‰æ¥å¤„ç†æ¶ˆæ¯ã€‚ActorManager æ‹¥æœ‰ä»¥ä¸‹å…³é”®è¡Œä¸ºæˆ–ç‰¹å¾ï¼š</p>

<p>createActor() åˆ›å»ºä¸€ä¸ª actor å¹¶å°†å®ƒä¸æ­¤ç®¡ç†å™¨ç›¸å…³è”ã€‚
startActor() å¯åŠ¨ä¸€ä¸ª actorã€‚
detachActor() åœæ­¢ä¸€ä¸ª actor å¹¶å°†å®ƒä¸æ­¤ç®¡ç†å™¨æ–­å¼€ã€‚
send()/broadcast() å°†ä¸€æ¡æ¶ˆæ¯å‘é€ç»™ä¸€ä¸ª actorã€ä¸€ç»„ actorã€ä¸€ä¸ªç±»åˆ«ä¸­çš„ä»»ä½• actor æˆ–æ‰€æœ‰ actorã€‚
åœ¨å¤§éƒ¨åˆ†ç¨‹åºä¸­ï¼Œåªæœ‰ä¸€ä¸ª ActorManagerï¼Œä½†å¦‚æœæ‚¨å¸Œæœ›ç®¡ç†å¤šä¸ªçº¿ç¨‹å’Œ/æˆ– actor æ± ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ª ActorManagerã€‚æ­¤æ¥å£çš„é»˜è®¤å®ç°æ˜¯ DefaultActorManagerã€‚</p>

<p>æ¶ˆæ¯ æ˜¯åœ¨ actor ä¹‹é—´å‘é€çš„æ¶ˆæ¯ã€‚Message æ˜¯ 3 ä¸ªï¼ˆå¯é€‰çš„ï¼‰å€¼å’Œä¸€äº›è¡Œä¸ºçš„å®¹å™¨ï¼š</p>

<p>source æ˜¯å‘é€ actorã€‚
subject æ˜¯å®šä¹‰æ¶ˆæ¯å«ä¹‰çš„å­—ç¬¦ä¸²ï¼ˆä¹Ÿç§°ä¸ºå‘½ä»¤ï¼‰ã€‚
data æ˜¯æ¶ˆæ¯çš„ä»»ä½•å‚æ•°æ•°æ®ï¼›é€šå¸¸æ˜¯ä¸€ä¸ªæ˜ å°„ã€åˆ—è¡¨æˆ–æ•°ç»„ã€‚å‚æ•°å¯ä»¥æ˜¯è¦å¤„ç†å’Œ/æˆ–å…¶ä»– actor è¦ä¸ä¹‹äº¤äº’çš„æ•°æ®ã€‚
subjectMatches() æ£€æŸ¥æ¶ˆæ¯ä¸»é¢˜æ˜¯å¦ä¸å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚
Î¼JavaActors åŒ…çš„é»˜è®¤æ¶ˆæ¯ç±»æ˜¯ DefaultMessageã€‚</p>

<p>ActorManagerå…¶å®åªè¦ç®€å•æµè§ˆä¸€ä¸‹Î¼JavaActorsæºç å°±å¯ä»¥ç†è§£Actorè®¾è®¡æ€è·¯å•¦ï¼Œä¸»è¦åˆ†æä¸€ä¸‹ActorManagerä¸­çš„Actorè°ƒåº¦æºç ï¼š
public class ActorRunnable implements Runnable {
        public boolean hasThread;
        public AbstractActor actor;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    public void run() {
        // logger.trace("procesNextActor starting");
        int delay = 1;
        while (running) {
            try {
                if (!procesNextActor()) {
                    // logger.trace("procesNextActor waiting on actor");
                    // sleep(delay * 1000);
                    synchronized (actors) {
                        // TOOD: adjust this delay; possible parameter
                        // we want to minizmize overhead (make bigger);
                        // but it has a big impact on message processing
                        // rate (makesmaller)
                        // actors.wait(delay * 1000);
                        actors.wait(100);
                    }
                    delay = Math.max(5, delay + 1);
                } else {
                    delay = 1;
                }
            } catch (InterruptedException e) {
            } catch (Exception e) {
                logger.error("procesNextActor exception", e);
            }
        }
        // logger.trace("procesNextActor ended");
    }

    protected boolean procesNextActor() {
        boolean run = false, wait = false, res = false;
        actor = null;
        synchronized (actors) {
            for (String key : runnables.keySet()) {
                actor = runnables.remove(key);
                break;
            }
        }
        if (actor != null) {
            // first run never started
            run = true;
            actor.setHasThread(true);
            hasThread = true;
            try {
                actor.run();
            } finally {
                actor.setHasThread(false);
                hasThread = false;
            }
        } else {
            synchronized (actors) {
                for (String key : waiters.keySet()) {
                    actor = waiters.remove(key);
                    break;
                }
            }
            if (actor != null) {
                // then waiting for responses
                wait = true;
                actor.setHasThread(true);
                hasThread = true;
                try {
                    res = actor.receive();
                    if (res) {
                        incDispatchCount();
                    }
                } finally {
                    actor.setHasThread(false);
                    hasThread = false;
                }
            }
        }
        // if (!(!run &amp;&amp; wait &amp;&amp; !res) &amp;&amp; a != null) {
        // logger.trace("procesNextActor %b/%b/%b: %s", run, wait, res, a);
        // }
        return run || res;
    }
} ActorMgrä¸­æœ‰ä¸€ä¸ªçº¿ç¨‹é˜Ÿåˆ—ç»´æŠ¤äº†ä¸€äº›ActorRunnableå¯¹è±¡ï¼Œæ¯ä¸ªActorRunnableå¯¹è±¡æœ‰éƒ½åœ¨æ— çº¿å¾ªç¯è°ƒåº¦Actorï¼Œè¿™ä¹Ÿå°±ç®€å•ä½¿å¾—æ¯ä¸ªActoråœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚å½“ç„¶æ­¤æ—¶ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæœ‰ä¸€äº›Actorå‡ºç°èµ„æºç«äº‰ä¼šä¸ä¼šå‡ºç°é—®é¢˜ï¼Œç­”æ¡ˆè‚¯å®šæ˜¯ä¼šçš„ã€‚Actorä»…ä»…æ˜¯æŠ½è±¡äº†çº¿ç¨‹è°ƒåº¦é—®é¢˜å¹¶ç»™å‡ºäº†ä¸€ä¸‹Actorçš„åŸåˆ™ï¼Œå¹¶ä¸èƒ½å®Œå…¨é¿å…èµ„æºç«äº‰ç°è±¡çš„å‡ºç°ï¼Œåªèƒ½è¯´å‡†å®ˆActoræ¨¡å¼è§„èŒƒï¼Œï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨rediså»åšå…¬å…±å†…å­˜å—ï¼Œé¿å…ç›´æ¥çš„å…¨å±€èµ„æºè¯»å†™ã€‚
</code></pre></div></div>
:ET