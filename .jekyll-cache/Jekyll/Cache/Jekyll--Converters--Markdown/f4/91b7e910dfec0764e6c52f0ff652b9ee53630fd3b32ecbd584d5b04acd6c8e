I"¦Ï<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Xtrabackupæ˜¯ä¸€ä¸ªå¯¹InnoDBåšæ•°æ®å¤‡ä»½çš„å·¥å…·ï¼Œæ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½ï¼ˆå¤‡ä»½æ—¶ä¸å½±å“æ•°æ®è¯»å†™ï¼‰ï¼Œæ˜¯å•†ä¸šå¤‡ä»½å·¥å…·InnoDB Hotbackupçš„ä¸€ä¸ªå¾ˆå¥½çš„æ›¿ä»£å“ã€‚å®ƒèƒ½å¯¹InnoDBå’ŒXtraDBå­˜å‚¨å¼•æ“çš„æ•°æ®åº“éé˜»å¡åœ°å¤‡ä»½ï¼ˆå¯¹äºMyISAMçš„å¤‡ä»½åŒæ ·éœ€è¦åŠ è¡¨é”ï¼‰ã€‚XtraBackupæ”¯æŒæ‰€æœ‰çš„Percona Serverã€MySQLã€MariaDBå’ŒDrizzleã€‚    xtrabackupæœ‰ä¸¤ä¸ªä¸»è¦çš„å·¥å…·ï¼šxtrabackupã€innobackupex
</code></pre></div></div>

<p>(1).xtrabackupåªèƒ½å¤‡ä»½InnoDBå’ŒXtraDB ä¸¤ç§æ•°æ®è¡¨</p>

<p>(2).innobackupexåˆ™å°è£…äº†xtrabackup,åŒæ—¶å¯ä»¥å¤‡ä»½MyISAMæ•°æ®è¡¨
Innobackupexå®Œæ•´å¤‡ä»½åç”Ÿæˆäº†å‡ ä¸ªé‡è¦çš„æ–‡ä»¶ï¼š
xtrabackup_binlog_infoï¼šè®°å½•å½“å‰æœ€æ–°çš„LOG Position</p>

<p>xtrabackup_binlog_pos_innodb:innodb log postion</p>

<p>xtrabackup_checkpoints: å­˜æ”¾å¤‡ä»½çš„èµ·å§‹ä½ç½®beginlsnå’Œç»“æŸä½ç½®endlsn,å¢é‡å¤‡ä»½éœ€è¦è¿™ä¸ªlsn[å¢é‡å¤‡ä»½å¯ä»¥åœ¨è¿™é‡Œé¢çœ‹fromå’Œtoä¸¤ä¸ªå€¼çš„å˜åŒ–]
Xtrabackupç‰¹ç‚¹ï¼š
(1)å¤‡ä»½è¿‡ç¨‹å¿«é€Ÿã€å¯é 
(2)å¤‡ä»½è¿‡ç¨‹ä¸ä¼šæ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡
(3)èƒ½å¤ŸåŸºäºå‹ç¼©ç­‰åŠŸèƒ½èŠ‚çº¦ç£ç›˜ç©ºé—´å’Œæµé‡
(4)è‡ªåŠ¨å®ç°å¤‡ä»½æ£€éªŒ
(5)è¿˜åŸé€Ÿåº¦å¿«
 äºŒ å®‰è£…:  http://www.percona.com/downloads/ 
 å®‰è£…å®Œä¹‹åä¼šç”Ÿæˆå‡ ä¸ªå·¥å…·ï¼šhttp://www.percona.com/doc/percona-xtrabackup/2.1/manual.html</p>

<p>å¤åˆ¶ä»£ç 
innobackupexï¼šè¿™ä¸ªæ˜¯å…¶å®æ˜¯ä¸‹é¢ä¸‰ä¸ªå·¥å…·çš„ä¸€ä¸ªperlè„šæœ¬å°è£…ï¼Œå¯ä»¥å¤‡ä»½MyISAM, InnoDB, XtraDBè¡¨ã€‚ä½†åœ¨å¤„ç†Myisamæ—¶éœ€è¦åŠ ä¸€ä¸ªè¯»é”ã€‚</p>

<p>xtrabackupï¼šä¸€ä¸ªç”±Cç¼–è¯‘è€Œæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåªèƒ½å¤‡ä»½InnoDBå’ŒXtraDBæ•°æ®ã€‚
xbcryptï¼šç”¨æ¥åŠ å¯†æˆ–è§£å¯†å¤‡ä»½çš„æ•°æ®ã€‚
xbstreamï¼šç”¨æ¥è§£å‹æˆ–å‹ç¼©xbstreamæ ¼å¼çš„å‹ç¼©æ–‡ä»¶ã€‚
innobackupex ï¼š</p>

<p>xtrabackupå‘½ä»¤åªå¤‡ä»½æ•°æ®æ–‡ä»¶,å¹¶ä¸å¤‡ä»½æ•°æ®è¡¨ç»“æ„(.frm)ï¼Œæ‰€ä»¥ä½¿ç”¨xtrabackupæ¢å¤çš„æ—¶å€™å¿…é¡»æœ‰å¯¹åº”è¡¨ç»“æ„æ–‡ä»¶(.frm)ã€‚ç”¨innobackupexå‘½ä»¤ï¼Œæ­¤å‘½ä»¤ç›¸å½“äºå†·å¤‡ä»½ï¼Œå¤åˆ¶æ•°æ®ç›®å½•çš„ç´¢å¼•ï¼Œæ•°æ®ï¼Œç»“æ„æ–‡ä»¶ï¼Œä½†ä¼šæœ‰çŸ­æš‚çš„é”è¡¨ï¼ˆæ—¶é—´ä¾èµ–äºMyISAMå¤§å°ï¼‰ã€‚</p>

<p>å‚æ•°ï¼š
â€“defaults-fileï¼šæŒ‡å®šmy.cnfå‚æ•°æ–‡ä»¶çš„ä½ç½®[æ­¤é…ç½®æ–‡ä»¶é‡Œå¿…é¡»æŒ‡å®šdatadir]
â€“apply-logï¼šåŒxtrabackupçš„â€“prepareå‚æ•°,ä¸€èˆ¬æƒ…å†µä¸‹,åœ¨å¤‡ä»½å®Œæˆåï¼Œæ•°æ®å°šä¸”ä¸èƒ½ç”¨äºæ¢å¤æ“ä½œï¼Œå› ä¸ºå¤‡ä»½çš„æ•°æ®ä¸­å¯èƒ½ä¼šåŒ…å«å°šæœªæäº¤çš„äº‹åŠ¡æˆ–å·²ç»æäº¤ä½†å°šæœªåŒæ­¥è‡³æ•°æ®æ–‡ä»¶ä¸­çš„äº‹åŠ¡ã€‚å› æ­¤ï¼Œæ­¤æ—¶æ•°æ® æ–‡ä»¶ä»å¤„ç†ä¸ä¸€è‡´çŠ¶æ€ã€‚â€“apply-logçš„ä½œç”¨æ˜¯é€šè¿‡å›æ»šæœªæäº¤çš„äº‹åŠ¡åŠåŒæ­¥å·²ç»æäº¤çš„äº‹åŠ¡è‡³æ•°æ®æ–‡ä»¶ä½¿æ•°æ®æ–‡ä»¶å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚
â€“copy-backï¼šåšæ•°æ®æ¢å¤æ—¶å°†å¤‡ä»½æ•°æ®æ–‡ä»¶æ‹·è´åˆ°MySQLæœåŠ¡å™¨çš„datadir
â€“remote-host=HOSTNAMEï¼š é€šè¿‡sshå°†å¤‡ä»½æ•°æ®å­˜å‚¨åˆ°è¿›ç¨‹æœåŠ¡å™¨ä¸Š
â€“stream=[tar]ï¼šå¤‡ä»½æ–‡ä»¶è¾“å‡ºæ ¼å¼, è¯¥æ–‡ä»¶å¯åœ¨XtarBackup binaryæ–‡ä»¶ä¸­è·å¾—. åœ¨ä½¿ç”¨å‚æ•°stream=tarå¤‡ä»½çš„æ—¶å€™,ä½ çš„xtrabackup_logfileå¯èƒ½ä¼šä¸´æ—¶æ”¾åœ¨/tmpç›®å½•ä¸‹,å¦‚æœä½ å¤‡ä»½çš„æ—¶å€™å¹¶å‘å†™å…¥è¾ƒå¤§çš„è¯,xtrabackup_logfileå¯èƒ½ä¼šå¾ˆå¤§(5G+),å¾ˆå¯èƒ½ä¼šæ’‘æ»¡ä½ çš„/tmpç›®å½•,å¯ä»¥é€šè¿‡å‚æ•°â€“tmpdiræŒ‡å®šç›®å½•æ¥è§£å†³è¿™ä¸ªé—®é¢˜.
â€“tmpdir=DIRECTORYï¼šå½“æœ‰æŒ‡å®šâ€“remote-host or â€“streamæ—¶, äº‹åŠ¡æ—¥å¿—ä¸´æ—¶å­˜å‚¨çš„ç›®å½•, é»˜è®¤é‡‡ç”¨MySQLé…ç½®æ–‡ä»¶ä¸­æ‰€æŒ‡å®šçš„ä¸´æ—¶ç›®å½•tmpdir
â€“redo-only â€“apply-logï¼šå¼ºåˆ¶å¤‡ä»½æ—¥å¿—æ—¶åªredo,è·³è¿‡rollback,è¿™åœ¨åšå¢é‡å¤‡ä»½æ—¶éå¸¸å¿…è¦
â€“use-memory=*ï¼šè¯¥å‚æ•°åœ¨prepareçš„æ—¶å€™ä½¿ç”¨,æ§åˆ¶prepareæ—¶innodbå®ä¾‹ä½¿ç”¨çš„å†…å­˜
â€“databases=LISTï¼šåˆ—å‡ºéœ€è¦å¤‡ä»½çš„databases,å¦‚æœæ²¡æœ‰æŒ‡å®šè¯¥å‚æ•°,æ‰€æœ‰åŒ…å«MyISAMå’ŒInnoDBè¡¨çš„databaseéƒ½ä¼šè¢«å¤‡ä»½
â€“slave-infoï¼šå¤‡ä»½ä»åº“, åŠ ä¸Šâ€“slave-infoå¤‡ä»½ç›®å½•ä¸‹ä¼šå¤šç”Ÿæˆä¸€ä¸ªxtrabackup_slave_info æ–‡ä»¶, è¿™é‡Œä¼šä¿å­˜ä¸»æ—¥å¿—æ–‡ä»¶ä»¥åŠåç§», æ–‡ä»¶å†…å®¹ç±»ä¼¼äº:CHANGE MASTER TO MASTER_LOG_FILE=â€™â€™, MASTER_LOG_POS=0
â€“socket=SOCKETï¼šæŒ‡å®šmysql.sockæ‰€åœ¨ä½ç½®ï¼Œä»¥ä¾¿å¤‡ä»½è¿›ç¨‹ç™»å½•mysql.
å¤‡ä»½ï¼š
 innobackupex â€“user=zjy â€“password=123456# â€“host=192.168.200.51 â€“defaults-file=/etc/mysql/my.cnf â€“databases=xtra_test  /home/zhoujy/xtrabackup/
çœ‹åˆ°redo logå·²ç»å‡ºç°ã€‚xtrabackup_å¼€å¤´çš„å‡ ä¸ªæ–‡ä»¶è®°å½•äº†ä¸€äº›æ—¥å¿—åç§»é‡çš„ä¿¡æ¯å’Œæ—¥å¿—åå’Œæ—¶é—´ç­‰ä¿¡æ¯ã€‚åœ¨xtrabackup_checkpointsä¸­è®°å½•äº†å¤‡ä»½çš„æ¨¡å¼ï¼š</p>

<p>backup_type = full-backupedã€‚</p>

<p>xtrabackup_binlog_infoï¼šè®°å½•å½“å‰æœ€æ–°çš„LOG Position
xtrabackup_binlog_pos_innodb:innodb log postion
xtrabackup_checkpoints: å­˜æ”¾å¤‡ä»½çš„èµ·å§‹ä½ç½®beginlsnå’Œç»“æŸä½ç½®endlsn,å¢é‡å¤‡ä»½éœ€è¦è¿™ä¸ªlsn[å¢é‡å¤‡ä»½å¯ä»¥åœ¨è¿™é‡Œé¢çœ‹fromå’Œtoä¸¤ä¸ªå€¼çš„å˜åŒ–
xtrabackup_info:å¤‡ä»½çš„ä¸€äº›å…·ä½“ä¿¡æ¯æ—¥å¿—
     #è¿˜åŸ</p>

<p>mysql&gt; drop database xtra_test;
Query OK, 2 rows affected (0.00 sec)
1) åˆ é™¤åŸå§‹ç›®å½•é‡Œçš„æ–‡ä»¶ï¼š</p>

<p>root@ha1:/var/lib/mysql# rm ib_logfile0 ib_logfile1 ibdata1
å…³é—­æ•°æ®åº“ï¼š
1) root@ha1:/var/lib/mysql# /etc/init.d/mysql stop</p>

<p>å¼€å§‹æ¢å¤
2) 1ï¼šinnobackupex â€“defaults-file=/etc/mysql/my.cnf â€“copy-back /home/zhoujy/xtrabackup/2014-11-11_11-56-58/
   æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤éœ€è¦ä¿è¯æ•°æ®åº“ç›®å½•æ˜¯ç©ºçš„ï¼Œå¦åˆ™ä¼šå¤±è´¥ï¼Œå› ä¸ºç›®å½•é‡Œæœ‰binlogæ—¥å¿—ï¼Œè¦ä¹ˆç§»èµ°ï¼Œè¦ä¹ˆå°±ç”¨æ‰‹åŠ¨å¤åˆ¶éœ€è¦çš„æ–‡ä»¶ã€‚æ‰€ä»¥è¯´æ—¥å¿—ä¸è¦å’Œæ•°æ®æ”¾åœ¨ä¸€èµ·ï¼
   2ï¼šcp ib_logfile0 ib_logfile1 ibdata1 /var/lib/mysql/
      cp -R xtra_test /var/lib/mysql/
ä¿®æ”¹æƒé™å’Œå¼€å¯æ•°æ®åº“
3)  root@ha1:/var/lib/mysql# chown -R mysql.mysql ib*
    root@ha1:/var/lib/mysql# chown -R mysql.mysql xtra_test/
å¼€å¯æ•°æ®åº“
    root@ha1:/var/lib/mysql# /etc/init.d/mysql start
    â€¦
    mysql start/running, process 15937
2ï¼šå¢é‡å¤‡ä»½ï¼ˆåŸºäºå…¨é‡çš„å¢é‡å¤‡ä»½ï¼‰
innobackupex â€“user=zjy â€“password=123456# â€“host=192.168.200.51 â€“defaults-file=/etc/mysql/my.cnf â€“incremental â€“incremental-basedir=/home/zhoujy/xtrabackup/2014-11-11_13-57-11/  /home/zhoujy/increment_data/
   å…¶ä¸­ï¼Œâ€“incrementalæŒ‡æ˜æ˜¯å¢é‡å¤‡ä»½ï¼Œâ€“incremental-basediræŒ‡å®šä¸Šæ¬¡å®Œæ•´å¤‡ä»½æˆ–è€…å¢é‡å¤‡ä»½æ–‡ä»¶çš„ä½ç½®ã€‚è¿™é‡Œçš„å¢é‡å¤‡ä»½å…¶å®åªé’ˆå¯¹çš„æ˜¯InnoDBï¼Œå¯¹äºMyISAMæ¥è¯´ï¼Œè¿˜æ˜¯å®Œæ•´å¤‡ä»½ã€‚
è¦æ˜¯åœ¨ç¬¬2æ¬¡åšå¢é‡å¤‡ä»½çš„æ—¶å€™ â€“incremental-basedir æŒ‡å‘å…¨é‡å¤‡ä»½ï¼Œåˆ™ç¬¬ä¸€æ¬¡å¢é‡å¤‡ä»½ä¸­çš„æ•°æ®ä¼šè¢«ç¬¬2æ¬¡åŒ…å«ï¼Œåªéœ€è¦è¿˜åŸä¸€æ¬¡å°±å¯ä»¥æ¢å¤ï¼Œç°åœ¨åˆ™éœ€è¦è¿˜åŸ2æ¬¡å¢é‡å¤‡ä»½ã€‚</p>

<p>#è¿˜åŸ</p>

<p>å¤åˆ¶ä»£ç 
#è¿˜åŸå…¨é‡å¤‡ä»½ï¼š
root@ha1:/home/zhoujy# innobackupex â€“apply-log /home/zhoujy/xtrabackup/2014-11-11_13-57-11/</p>

<p>#ç¬¬ä¸€æ¬¡çš„å¢é‡å¤‡ä»½åº”ç”¨æ—¥å¿—,åº”ç”¨å®Œæ—¥å¿—å,å°†åˆå¹¶åˆ°å…¨å¤‡ä¸Š,æ¢å¤ä½¿ç”¨å…¨å¤‡æ¢å¤<br />
root@ha1:~# innobackupex â€“apply-log /home/zhoujy/xtrabackup/2014-11-11_13-57-11/ â€“incremental-dir=/home/zhoujy/increment_data/2014-11-11_14-14-56/</p>

<p>#ç¬¬äºŒæ¬¡çš„å¢é‡å¤‡ä»½åº”ç”¨æ—¥å¿—,åº”ç”¨å®Œæ—¥å¿—å,å°†åˆå¹¶åˆ°å…¨å¤‡ä¸Š,æ¢å¤ä½¿ç”¨å…¨å¤‡æ¢å¤<br />
root@ha1:~# innobackupex â€“apply-log /home/zhoujy/xtrabackup/2014-11-11_13-57-11/ â€“incremental-dir=/home/zhoujy/increment_data/2014-11-11_14-25-36/</p>

<p>æ­¤æ—¶ä¸¤æ¬¡å¢é‡å¤‡ä»½å…¶å®éƒ½åˆå¹¶åˆ°å…¨å¤‡ä¸Šäº†,æ¢å¤æ˜¯åªéœ€è¦ä½¿ç”¨å…¨å¤‡è¿›è¡Œæ¢å¤å°±å¯ä»¥äº†
å¤åˆ¶ä»£ç 
è¿˜åŸæ“ä½œæ‰§è¡Œå®Œä¹‹åï¼ŒæŸ¥çœ‹å…¶lsnçš„ä¿¡æ¯ï¼š</p>

<p>root@ha1:/home/zhoujy/xtrabackup/2014-11-11_13-57-11# cat xtrabackup_checkpoints 
backup_type = full-prepared
from_lsn = 0
to_lsn = 7363107216
last_lsn = 7363107216
compact = 0
è¯´æ˜äº†ï¼Œè¿˜åŸæ“ä½œæ‰§è¡Œæ²¡é—®é¢˜ã€‚æŒ‰ç…§ä¹‹å‰è¿˜åŸæ“ä½œçš„æ­¥éª¤æ¥æ¢å¤æ•°æ®ï¼šå…ˆåˆ é™¤æ•°æ®ï¼Œå†æŠŠæ–‡ä»¶å¤åˆ¶è¿‡å»ï¼Œçœ‹çœ‹æ˜¯å¦æˆåŠŸã€‚æµ‹è¯•ä¸‹æ¥ï¼Œè¿˜åŸæˆåŠŸã€‚
3ï¼‰å‹ç¼©å¤‡ä»½ï¼šå¿…é¡»ä½¿ç”¨-iå‚æ•°æ‹†åŒ…è§£å‹</p>

<p>æ‰“åŒ…(Tar)å¤‡ä»½
innobackupex â€“user=zjy â€“password=123456# â€“host=192.168.200.51 â€“defaults-file=/etc/mysql/my.cnf â€“databases=xtra_test â€“stream=tar  /home/zhoujy/xtrabackup/ 1&gt;/home/zhoujy/xtrabackup/xtra_test.tar
<!-- more -->
Percona XtraBackupï¼ˆç®€ç§°PXBï¼‰æ˜¯ Percona å…¬å¸å¼€å‘çš„ä¸€ä¸ªç”¨äº MySQL æ•°æ®åº“ç‰©ç†çƒ­å¤‡çš„å¤‡ä»½å·¥å…·ï¼Œæ”¯æŒ MySQLï¼ˆOracleï¼‰ã€Percona Server å’Œ MariaDBï¼Œå¹¶ä¸”å…¨éƒ¨å¼€æºï¼ŒçœŸå¯è°“æ˜¯ä¸šç•Œè‰¯å¿ƒã€‚æˆ‘ä»¬ RDS MySQL çš„ç‰©ç†å¤‡ä»½å°±æ˜¯åŸºäºè¿™ä¸ªå·¥å…·åšçš„ã€‚</p>

<p>é¡¹ç›®çš„ blueprint å’Œ bug è®¨è®ºæ”¾åœ¨ Launchpadï¼Œä»£ç ä¹‹å‰ä¹Ÿæ”¾åœ¨ Launchpadï¼Œç°åœ¨å·²ç»è¿ç§»åˆ° Github å•¦ï¼Œé¡¹ç›®æ›´æ–°å‘å¸ƒéå¸¸å¿«ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å…³æ³¨ :-)</p>

<p>æœ¬æ–‡ä¼šä»‹ç»ä¸‹å¤‡ä»½å·¥å…·çš„å·¥ä½œåŸç†ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚</p>

<p>å·¥å…·é›†
è½¯ä»¶åŒ…å®‰è£…å®Œåä¸€å…±æœ‰4ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p>

<p>usr
â”œâ”€â”€ bin
â”‚   â”œâ”€â”€ innobackupex
â”‚   â”œâ”€â”€ xbcrypt
â”‚   â”œâ”€â”€ xbstream
â”‚   â””â”€â”€ xtrabackup
å…¶ä¸­æœ€ä¸»è¦çš„æ˜¯ innobackupex å’Œ xtrabackupï¼Œå‰è€…æ˜¯ä¸€ä¸ª perl è„šæœ¬ï¼Œåè€…æ˜¯ C/C++ ç¼–è¯‘çš„äºŒè¿›åˆ¶ã€‚</p>

<p>xtrabackup æ˜¯ç”¨æ¥å¤‡ä»½ InnoDB è¡¨çš„ï¼Œä¸èƒ½å¤‡ä»½é InnoDB è¡¨ï¼Œå’Œ mysqld server æ²¡æœ‰äº¤äº’ï¼›innobackupex è„šæœ¬ç”¨æ¥å¤‡ä»½é InnoDB è¡¨ï¼ŒåŒæ—¶ä¼šè°ƒç”¨ xtrabackup å‘½ä»¤æ¥å¤‡ä»½ InnoDB è¡¨ï¼Œè¿˜ä¼šå’Œ mysqld server å‘é€å‘½ä»¤è¿›è¡Œäº¤äº’ï¼Œå¦‚åŠ è¯»é”ï¼ˆFTWRLï¼‰ã€è·å–ä½ç‚¹ï¼ˆSHOW SLAVE STATUSï¼‰ç­‰ã€‚ç®€å•æ¥è¯´ï¼Œinnobackupex åœ¨ xtrabackup ä¹‹ä¸Šåšäº†ä¸€å±‚å°è£…ã€‚</p>

<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯å¸Œæœ›èƒ½å¤‡ä»½ MyISAM è¡¨çš„ï¼Œè™½ç„¶æˆ‘ä»¬å¯èƒ½è‡ªå·±ä¸ç”¨ MyISAM è¡¨ï¼Œä½†æ˜¯ mysql åº“ä¸‹çš„ç³»ç»Ÿè¡¨æ˜¯ MyISAM çš„ï¼Œå› æ­¤å¤‡ä»½åŸºæœ¬éƒ½é€šè¿‡ innobackupex å‘½ä»¤è¿›è¡Œï¼›å¦å¤–ä¸€ä¸ªåŸå› æ˜¯æˆ‘ä»¬å¯èƒ½éœ€è¦ä¿å­˜ä½ç‚¹ä¿¡æ¯ã€‚</p>

<p>å¦å¤–2ä¸ªå·¥å…·ç›¸å¯¹å°ä¼—äº›ï¼Œxbcrypt æ˜¯åŠ è§£å¯†ç”¨çš„ï¼›xbstream ç±»ä¼¼äºtarï¼Œæ˜¯ Percona è‡ªå·±å®ç°çš„ä¸€ç§æ”¯æŒå¹¶å‘å†™çš„æµæ–‡ä»¶æ ¼å¼ã€‚ä¸¤éƒ½åœ¨å¤‡ä»½å’Œè§£å‹æ—¶éƒ½ä¼šç”¨åˆ°ï¼ˆå¦‚æœå¤‡ä»½ç”¨äº†åŠ å¯†å’Œå¹¶å‘ï¼‰ã€‚</p>

<p>æœ¬æ–‡çš„ä»‹ç»çš„ä¸»è§’æ˜¯ innobackupex å’Œ xtrabackupã€‚</p>

<p>åŸç†
é€šä¿¡æ–¹å¼
2ä¸ªå·¥å…·ä¹‹é—´çš„äº¤äº’å’Œåè°ƒæ˜¯é€šè¿‡æ§åˆ¶æ–‡ä»¶çš„åˆ›å»ºå’Œåˆ é™¤æ¥å®ç°çš„ï¼Œä¸»è¦æ–‡ä»¶æœ‰ï¼š</p>

<p>xtrabackup_suspended_1
xtrabackup_suspended_2
xtrabackup_log_copied
ä¸¾ä¸ªæ —å­ï¼Œæˆ‘ä»¬æ¥çœ‹å¤‡ä»½æ—¶ xtrabackup_suspended_2 æ˜¯æ€ä¹ˆæ¥åè°ƒ2ä¸ªå·¥å…·è¿›ç¨‹çš„</p>

<p>innobackupex åœ¨å¯åŠ¨ xtrabackup è¿›ç¨‹åï¼Œä¼šä¸€ç›´ç­‰ xtrabackup å¤‡ä»½å®Œ InnoDB æ–‡ä»¶ï¼Œæ–¹å¼å°±æ˜¯ç­‰å¾… xtrabackup_suspended_2 è¿™ä¸ªæ–‡ä»¶è¢«åˆ›å»ºå‡ºæ¥ï¼›
xtrabackup åœ¨å¤‡å®Œ InnoDB æ•°æ®åï¼Œå°±åœ¨æŒ‡å®šç›®å½•ä¸‹åˆ›å»ºå‡ºè¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åç­‰è¿™ä¸ªæ–‡ä»¶è¢« innobackupex åˆ é™¤ï¼›
innobackupex æ£€æµ‹åˆ°æ–‡ä»¶ xtrabackup_suspended_2 è¢«åˆ›å»ºå‡ºæ¥åï¼Œå°±ç»§ç»­å¾€ä¸‹èµ°ï¼›
innobackupex åœ¨å¤‡ä»½å®Œé InnoDB è¡¨åï¼Œåˆ é™¤ xtrabackup_suspended_2 è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·å°±é€šçŸ¥ xtrabackup å¯ä»¥ç»§ç»­äº†ï¼Œç„¶åç­‰ xtrabackup_log_copied è¢«åˆ›å»ºï¼›
xtrabackup æ£€æµ‹åˆ° xtrabackup_suspended_2 æ–‡ä»¶åˆ é™¤åï¼Œå°±å¯ä»¥ç»§ç»­å¾€ä¸‹äº†ã€‚
æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹ä¸å¯æ€è®®ï¼Œé€šè¿‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨æ¥æ§åˆ¶è¿›ç¨‹ï¼Œè¿™ç§æ–¹å¼éå¸¸çš„ä¸é è°±ï¼Œå› ä¸ºéå¸¸å®¹æ˜“è¢«å¤–éƒ¨å¹²æ‰°ï¼Œæ¯”å¦‚æ–‡ä»¶è¢«åˆ«äººè¯¯åˆ æ‰ï¼Œæˆ–è€…2ä¸ªæ­£åœ¨è·‘çš„å¤‡ä»½æ§åˆ¶æ–‡ä»¶è¯¯æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œå°±ç­‰ç€å¤‡ä»½ä¹±æ‰å§ï¼Œä½†æ˜¯ Percona å°±æ˜¯è¿™ä¹ˆå¹²çš„ã€‚</p>

<p>ä¹‹æ‰€ä»¥è¿™ä¹ˆæï¼Œä¼°è®¡ä¸»è¦æ˜¯å› ä¸º perl å’Œ C äºŒè¿›åˆ¶2ä¸ªè¿›ç¨‹ï¼Œæ²¡æœ‰æ—¢å¥½ç”¨åˆæ–¹ä¾¿çš„é€šä¿¡æ–¹å¼ï¼Œæä¸ªåè®®å•¥çš„å¤ªéº»çƒ¦äº†ã€‚ä½†æ˜¯å®˜æ–¹ä¹Ÿè§‰å¾—è¿™ç§æ–¹å¼ä¸é è°±ï¼Œ11å¹´å°±æäº†ä¸ª blueprint è¦ç”¨Cé‡å†™ innobackupexï¼Œç»ˆäºåœ¨2.3 ç‰ˆæœ¬å®ç°äº†ï¼Œinnobackupex åŠŸèƒ½å…¨éƒ¨é›†æˆåˆ° xtrabackup é‡Œé¢ï¼Œåªæœ‰ä¸€ä¸ª binaryï¼Œå¦å¤–ä¸ºäº†ä½¿ç”¨ä¸Šçš„å…¼å®¹è€ƒè™‘ï¼Œinnobackupexä½œä¸º xtrabackup çš„ä¸€ä¸ªè½¯é“¾ã€‚å¯¹äºäºŒæ¬¡å¼€å‘æ¥è¯´ï¼Œ2.3 æ‘†è„±äº†ä¹‹å‰2ä¸ªè¿›ç¨‹åä½œçš„è´Ÿæ‹…ï¼Œæ¶æ„ä¸Šæ˜æ˜¾è¦å¥½äºä¹‹å‰ç‰ˆæœ¬ã€‚è€ƒè™‘åˆ° perl + C è¿™ç§æ¶æ„çš„é•¿æœŸå­˜åœ¨ï¼Œå¤§å¤šæ•°è¯»è€…æœ‹å‹ä¹ŸåŸºæœ¬ç”¨çš„2.3ä¹‹å‰ç‰ˆæœ¬ï¼Œæœ¬æ–‡çš„ä»‹ç»ä¹Ÿæ˜¯åŸºäºè€çš„æ¶æ„ï¼ˆ2.2ç‰ˆæœ¬ï¼‰ï¼Œä½†æ˜¯åŸç†å’Œ2.3æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å®ç°ä¸Šçš„å·®åˆ«ã€‚
å¤‡ä»½è¿‡ç¨‹
æ•´ä¸ªå¤‡ä»½è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š
	<img src="https://xiazemin.github.io/MyBlog/img/xtrabackup.png" />
PXB å¤‡ä»½è¿‡ç¨‹</p>

<p>innobackupex åœ¨å¯åŠ¨åï¼Œä¼šå…ˆ fork ä¸€ä¸ªè¿›ç¨‹ï¼Œå¯åŠ¨ xtrabackupè¿›ç¨‹ï¼Œç„¶åå°±ç­‰å¾… xtrabackup å¤‡ä»½å®Œ ibd æ•°æ®æ–‡ä»¶ï¼›
xtrabackup åœ¨å¤‡ä»½ InnoDB ç›¸å…³æ•°æ®æ—¶ï¼Œæ˜¯æœ‰2ç§çº¿ç¨‹çš„ï¼Œ1ç§æ˜¯ redo æ‹·è´çº¿ç¨‹ï¼Œè´Ÿè´£æ‹·è´ redo æ–‡ä»¶ï¼Œ1ç§æ˜¯ ibd æ‹·è´çº¿ç¨‹ï¼Œè´Ÿè´£æ‹·è´ ibd æ–‡ä»¶ï¼›redo æ‹·è´çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œåœ¨ ibd æ‹·è´çº¿ç¨‹ä¹‹å‰å¯åŠ¨ï¼Œåœ¨ ibd çº¿ç¨‹ç»“æŸåç»“æŸã€‚xtrabackup è¿›ç¨‹å¼€å§‹æ‰§è¡Œåï¼Œå…ˆå¯åŠ¨ redo æ‹·è´çº¿ç¨‹ï¼Œä»æœ€æ–°çš„ checkpoint ç‚¹å¼€å§‹é¡ºåºæ‹·è´ redo æ—¥å¿—ï¼›ç„¶åå†å¯åŠ¨ ibd æ•°æ®æ‹·è´çº¿ç¨‹ï¼Œåœ¨ xtrabackup æ‹·è´ ibd è¿‡ç¨‹ä¸­ï¼Œinnobackupex è¿›ç¨‹ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼ˆç­‰å¾…æ–‡ä»¶è¢«åˆ›å»ºï¼‰ã€‚
xtrabackup æ‹·è´å®Œæˆidbåï¼Œé€šçŸ¥ innobackupexï¼ˆé€šè¿‡åˆ›å»ºæ–‡ä»¶ï¼‰ï¼ŒåŒæ—¶è‡ªå·±è¿›å…¥ç­‰å¾…ï¼ˆredo çº¿ç¨‹ä»ç„¶ç»§ç»­æ‹·è´ï¼‰;
innobackupex æ”¶åˆ° xtrabackup é€šçŸ¥åï¼Œæ‰§è¡ŒFLUSH TABLES WITH READ LOCK (FTWRL)ï¼Œå–å¾—ä¸€è‡´æ€§ä½ç‚¹ï¼Œç„¶åå¼€å§‹å¤‡ä»½é InnoDB æ–‡ä»¶ï¼ˆåŒ…æ‹¬ frmã€MYDã€MYIã€CSVã€optã€parç­‰ï¼‰ã€‚æ‹·è´é InnoDB æ–‡ä»¶è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæ•°æ®åº“å¤„äºå…¨å±€åªè¯»çŠ¶æ€ï¼Œå¦‚æœåœ¨ä¸šåŠ¡çš„ä¸»åº“å¤‡ä»½çš„è¯ï¼Œè¦ç‰¹åˆ«å°å¿ƒï¼Œé InnoDB è¡¨ï¼ˆä¸»è¦æ˜¯MyISAMï¼‰æ¯”è¾ƒå¤šçš„è¯æ•´åº“åªè¯»æ—¶é—´å°±ä¼šæ¯”è¾ƒé•¿ï¼Œè¿™ä¸ªå½±å“ä¸€å®šè¦è¯„ä¼°åˆ°ã€‚
å½“ innobackupex æ‹·è´å®Œæ‰€æœ‰é InnoDB è¡¨æ–‡ä»¶åï¼Œé€šçŸ¥ xtrabackupï¼ˆé€šè¿‡åˆ æ–‡ä»¶ï¼‰ ï¼ŒåŒæ—¶è‡ªå·±è¿›å…¥ç­‰å¾…ï¼ˆç­‰å¾…å¦ä¸€ä¸ªæ–‡ä»¶è¢«åˆ›å»ºï¼‰ï¼›
xtrabackup æ”¶åˆ° innobackupex å¤‡ä»½å®Œé InnoDB é€šçŸ¥åï¼Œå°±åœæ­¢ redo æ‹·è´çº¿ç¨‹ï¼Œç„¶åé€šçŸ¥ innobackupexredo log æ‹·è´å®Œæˆï¼ˆé€šè¿‡åˆ›å»ºæ–‡ä»¶ï¼‰ï¼›
innobackupex æ”¶åˆ° redo å¤‡ä»½å®Œæˆé€šçŸ¥åï¼Œå°±å¼€å§‹è§£é”ï¼Œæ‰§è¡Œ UNLOCK TABLESï¼›
æœ€å innobackupex å’Œ xtrabackup è¿›ç¨‹å„è‡ªå®Œæˆæ”¶å°¾å·¥ä½œï¼Œå¦‚èµ„æºçš„é‡Šæ”¾ã€å†™å¤‡ä»½å…ƒæ•°æ®ä¿¡æ¯ç­‰ï¼Œinnobackupex ç­‰å¾… xtrabackup å­è¿›ç¨‹ç»“æŸåé€€å‡ºã€‚
åœ¨ä¸Šé¢æè¿°çš„æ–‡ä»¶æ‹·è´ï¼Œéƒ½æ˜¯å¤‡ä»½è¿›ç¨‹ç›´æ¥é€šè¿‡æ“ä½œç³»ç»Ÿè¯»å–æ•°æ®æ–‡ä»¶çš„ï¼Œåªåœ¨æ‰§è¡Œ SQL å‘½ä»¤æ—¶å’Œæ•°æ®åº“æœ‰äº¤äº’ï¼ŒåŸºæœ¬ä¸å½±å“æ•°æ®åº“çš„è¿è¡Œï¼Œåœ¨å¤‡ä»½é InnoDB æ—¶ä¼šæœ‰ä¸€æ®µæ—¶é—´åªè¯»ï¼ˆå¦‚æœæ²¡æœ‰MyISAMè¡¨çš„è¯ï¼Œåªè¯»æ—¶é—´åœ¨å‡ ç§’å·¦å³ï¼‰ï¼Œåœ¨å¤‡ä»½ InnoDB æ•°æ®æ–‡ä»¶æ—¶ï¼Œå¯¹æ•°æ®åº“å®Œå…¨æ²¡æœ‰å½±å“ï¼Œæ˜¯çœŸæ­£çš„çƒ­å¤‡ã€‚</p>

<p>InnoDB å’Œé InnoDB æ–‡ä»¶çš„å¤‡ä»½éƒ½æ˜¯é€šè¿‡æ‹·è´æ–‡ä»¶æ¥åšçš„ï¼Œä½†æ˜¯å®ç°çš„æ–¹å¼ä¸åŒï¼Œå‰è€…æ˜¯ä»¥pageä¸ºç²’åº¦åšçš„(xtrabackup)ï¼Œåè€…æ˜¯ cp æˆ–è€… tar å‘½ä»¤(innobackupex)ï¼Œxtrabackup åœ¨è¯»å–æ¯ä¸ªpageæ—¶ä¼šæ ¡éªŒ checksum å€¼ï¼Œä¿è¯æ•°æ®å—æ˜¯ä¸€è‡´çš„ï¼Œè€Œ innobackupex åœ¨ cp MyISAM æ–‡ä»¶æ—¶å·²ç»åšäº†flushï¼ˆFTWRLï¼‰ï¼Œç£ç›˜ä¸Šçš„æ–‡ä»¶ä¹Ÿæ˜¯å®Œæ•´çš„ï¼Œæ‰€ä»¥æœ€ç»ˆå¤‡ä»½é›†é‡Œçš„æ•°æ®æ–‡ä»¶éƒ½æ˜¯å†™å…¥å®Œæ•´çš„ã€‚</p>

<p>å¢é‡å¤‡ä»½
PXB æ˜¯æ”¯æŒå¢é‡å¤‡ä»½çš„ï¼Œä½†æ˜¯åªèƒ½å¯¹ InnoDB åšå¢é‡ï¼ŒInnoDB æ¯ä¸ª page æœ‰ä¸ª LSN å·ï¼ŒLSN æ˜¯å…¨å±€é€’å¢çš„ï¼Œpage è¢«æ›´æ”¹æ—¶ä¼šè®°å½•å½“å‰çš„ LSN å·ï¼Œpageä¸­çš„ LSN è¶Šå¤§ï¼Œè¯´æ˜å½“å‰pageè¶Šæ–°ï¼ˆæœ€è¿‘è¢«æ›´æ–°ï¼‰ã€‚æ¯æ¬¡å¤‡ä»½ä¼šè®°å½•å½“å‰å¤‡ä»½åˆ°çš„LSNï¼ˆxtrabackup_checkpoints æ–‡ä»¶ä¸­ï¼‰ï¼Œå¢é‡å¤‡ä»½å°±æ˜¯åªæ‹·è´LSNå¤§äºä¸Šæ¬¡å¤‡ä»½çš„pageï¼Œæ¯”ä¸Šæ¬¡å¤‡ä»½å°çš„è·³è¿‡ï¼Œæ¯ä¸ª ibd æ–‡ä»¶æœ€ç»ˆå¤‡ä»½å‡ºæ¥çš„æ˜¯å¢é‡ delta æ–‡ä»¶ã€‚</p>

<p>MyISAM æ˜¯æ²¡æœ‰å¢é‡çš„æœºåˆ¶çš„ï¼Œæ¯æ¬¡å¢é‡å¤‡ä»½éƒ½æ˜¯å…¨éƒ¨æ‹·è´çš„ã€‚</p>

<p>å¢é‡å¤‡ä»½è¿‡ç¨‹å’Œå…¨é‡å¤‡ä»½ä¸€æ ·ï¼Œåªæ˜¯åœ¨ ibd æ–‡ä»¶æ‹·è´ä¸Šæœ‰ä¸åŒã€‚</p>

<p>æ¢å¤è¿‡ç¨‹
å¦‚æœçœ‹æ¢å¤å¤‡ä»½é›†çš„æ—¥å¿—ï¼Œä¼šå‘ç°å’Œ mysqld å¯åŠ¨æ—¶éå¸¸ç›¸ä¼¼ï¼Œå…¶å®å¤‡ä»½é›†çš„æ¢å¤å°±æ˜¯ç±»ä¼¼ mysqld crashåï¼Œåšä¸€æ¬¡ crash recoverã€‚</p>

<p>æ¢å¤çš„ç›®çš„æ˜¯æŠŠå¤‡ä»½é›†ä¸­çš„æ•°æ®æ¢å¤åˆ°ä¸€ä¸ªä¸€è‡´æ€§ä½ç‚¹ï¼Œæ‰€è°“ä¸€è‡´å°±æ˜¯æŒ‡åŸæ•°æ®åº“æŸä¸€æ—¶é—´ç‚¹å„å¼•æ“æ•°æ®çš„çŠ¶æ€ï¼Œæ¯”å¦‚ MyISAM ä¸­çš„æ•°æ®å¯¹åº”çš„æ˜¯ 15:00 æ—¶é—´ç‚¹çš„ï¼ŒInnoDB ä¸­çš„æ•°æ®å¯¹åº”çš„æ˜¯ 15:20 çš„ï¼Œè¿™ç§çŠ¶æ€çš„æ•°æ®å°±æ˜¯ä¸ä¸€è‡´çš„ã€‚PXB å¤‡ä»½é›†å¯¹åº”çš„ä¸€è‡´ç‚¹ï¼Œå°±æ˜¯å¤‡ä»½æ—¶FTWRLçš„æ—¶é—´ç‚¹ï¼Œæ¢å¤å‡ºæ¥çš„æ•°æ®ï¼Œå°±å¯¹åº”åŸæ•°æ®åº“FTWRLæ—¶çš„çŠ¶æ€ã€‚</p>

<p>å› ä¸ºå¤‡ä»½æ—¶ FTWRL åï¼Œæ•°æ®åº“æ˜¯å¤„äºåªè¯»çš„ï¼Œé InnoDB æ•°æ®æ˜¯åœ¨æŒæœ‰å…¨å±€è¯»é”æƒ…å†µä¸‹æ‹·è´çš„ï¼Œæ‰€ä»¥é InnoDB æ•°æ®æœ¬èº«å°±å¯¹åº” FTWRL æ—¶é—´ç‚¹ï¼›InnoDB çš„ ibd æ–‡ä»¶æ‹·è´æ˜¯åœ¨ FTWRL å‰åšçš„ï¼Œæ‹·è´å‡ºæ¥çš„ä¸åŒ ibd æ–‡ä»¶æœ€åæ›´æ–°æ—¶é—´ç‚¹æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™ç§çŠ¶æ€çš„ ibd æ–‡ä»¶æ˜¯ä¸èƒ½ç›´æ¥ç”¨çš„ï¼Œä½†æ˜¯ redo log æ˜¯ä»å¤‡ä»½å¼€å§‹ä¸€ç›´æŒç»­æ‹·è´çš„ï¼Œæœ€åçš„ redo æ—¥å¿—ç‚¹æ˜¯åœ¨æŒæœ‰ FTWRL åå–å¾—çš„ï¼Œæ‰€ä»¥æœ€ç»ˆé€šè¿‡ redo åº”ç”¨åçš„ ibd æ•°æ®æ—¶é—´ç‚¹ä¹Ÿæ˜¯å’Œ FTWRL ä¸€è‡´çš„ã€‚</p>

<p>æ‰€ä»¥æ¢å¤è¿‡ç¨‹åªæ¶‰åŠ InnoDB æ–‡ä»¶çš„æ¢å¤ï¼Œé InnoDB æ•°æ®æ˜¯ä¸åŠ¨çš„ã€‚å¤‡ä»½æ¢å¤å®Œæˆåï¼Œå°±å¯ä»¥æŠŠæ•°æ®æ–‡ä»¶æ‹·è´åˆ°å¯¹åº”çš„ç›®å½•ï¼Œç„¶åé€šè¿‡mysqldæ¥å¯åŠ¨äº†ã€‚
innobackupex [â€“compress] [â€“compress-threads=NUMBER-OF-THREADS] [â€“compress-chunk-size=CHUNK-SIZE]
             [â€“encrypt=ENCRYPTION-ALGORITHM] [â€“encrypt-threads=NUMBER-OF-THREADS] [â€“encrypt-chunk-size=CHUNK-SIZE]
             [â€“encrypt-key=LITERAL-ENCRYPTION-KEY] | [â€“encryption-key-file=MY.KEY]
             [â€“include=REGEXP] [â€“user=NAME]
             [â€“password=WORD] [â€“port=PORT] [â€“socket=SOCKET]
             [â€“no-timestamp] [â€“ibbackup=IBBACKUP-BINARY]
             [â€“slave-info] [â€“galera-info] [â€“stream=tar|xbstream]
             [â€“defaults-file=MY.CNF] [â€“defaults-group=GROUP-NAME]
             [â€“databases=LIST] [â€“no-lock] 
             [â€“tmpdir=DIRECTORY] [â€“tables-file=FILE]
             [â€“history=NAME]
             [â€“incremental] [â€“incremental-basedir]
             [â€“incremental-dir] [â€“incremental-force-scan] [â€“incremental-lsn]
             [â€“incremental-history-name=NAME] [â€“incremental-history-uuid=UUID]
             [â€“close-files] [â€“compact]   <br />
             BACKUP-ROOT-DIR
â€“compressï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå‹ç¼©innodbæ•°æ®æ–‡ä»¶çš„å¤‡ä»½ã€‚
â€“compress-threadsï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå¹¶è¡Œå‹ç¼©workerçº¿ç¨‹çš„æ•°é‡ã€‚
â€“compress-chunk-sizeï¼šè¯¥é€‰é¡¹è¡¨ç¤ºæ¯ä¸ªå‹ç¼©çº¿ç¨‹worker bufferçš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼Œé»˜è®¤æ˜¯64Kã€‚
â€“encryptï¼šè¯¥é€‰é¡¹è¡¨ç¤ºé€šè¿‡ENCRYPTION_ALGORITHMçš„ç®—æ³•åŠ å¯†innodbæ•°æ®æ–‡ä»¶çš„å¤‡ä»½ï¼Œç›®å‰æ”¯æŒçš„ç®—æ³•æœ‰ASE128,AES192,AES256ã€‚
â€“encrypt-threadsï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå¹¶è¡ŒåŠ å¯†çš„workerçº¿ç¨‹æ•°é‡ã€‚
â€“encrypt-chunk-sizeï¼šè¯¥é€‰é¡¹è¡¨ç¤ºæ¯ä¸ªåŠ å¯†çº¿ç¨‹worker bufferçš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼Œé»˜è®¤æ˜¯64Kã€‚
â€“encrypt-keyï¼šè¯¥é€‰é¡¹ä½¿ç”¨åˆé€‚é•¿åº¦åŠ å¯†keyï¼Œå› ä¸ºä¼šè®°å½•åˆ°å‘½ä»¤è¡Œï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨ã€‚
â€“encryption-key-fileï¼šè¯¥é€‰é¡¹è¡¨ç¤ºæ–‡ä»¶å¿…é¡»æ˜¯ä¸€ä¸ªç®€å•äºŒè¿›åˆ¶æˆ–è€…æ–‡æœ¬æ–‡ä»¶ï¼ŒåŠ å¯†keyå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¡Œå‘½ä»¤ç”Ÿæˆï¼šopenssl rand -base64 24ã€‚
â€“includeï¼šè¯¥é€‰é¡¹è¡¨ç¤ºä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¡¨çš„åå­—[db.tb]ï¼Œè¦æ±‚ä¸ºå…¶æŒ‡å®šåŒ¹é…è¦å¤‡ä»½çš„è¡¨çš„å®Œæ•´åç§°ï¼Œå³databasename.tablenameã€‚
â€“userï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå¤‡ä»½è´¦å·ã€‚
â€“passwordï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå¤‡ä»½çš„å¯†ç ã€‚
â€“portï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå¤‡ä»½æ•°æ®åº“çš„ç«¯å£ã€‚
â€“hostï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå¤‡ä»½æ•°æ®åº“çš„åœ°å€ã€‚
â€“databasesï¼šè¯¥é€‰é¡¹æ¥å—çš„å‚æ•°ä¸ºæ•°æ®åï¼Œå¦‚æœè¦æŒ‡å®šå¤šä¸ªæ•°æ®åº“ï¼Œå½¼æ­¤é—´éœ€è¦ä»¥ç©ºæ ¼éš”å¼€ï¼›å¦‚ï¼šâ€xtra_test dba_testâ€ï¼ŒåŒæ—¶ï¼Œåœ¨æŒ‡å®šæŸæ•°æ®åº“æ—¶ï¼Œä¹Ÿå¯ä»¥åªæŒ‡å®šå…¶ä¸­çš„æŸå¼ è¡¨ã€‚å¦‚ï¼šâ€mydatabase.mytableâ€ã€‚è¯¥é€‰é¡¹å¯¹innodbå¼•æ“è¡¨æ— æ•ˆï¼Œè¿˜æ˜¯ä¼šå¤‡ä»½æ‰€æœ‰innodbè¡¨ã€‚æ­¤å¤–ï¼Œæ­¤é€‰é¡¹ä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªæ–‡ä»¶ä¸ºå‚æ•°ï¼Œæ–‡ä»¶ä¸­æ¯ä¸€è¡Œä¸ºä¸€ä¸ªè¦å¤‡ä»½çš„å¯¹è±¡ã€‚
â€“tables-fileï¼šè¯¥é€‰é¡¹è¡¨ç¤ºæŒ‡å®šå«æœ‰è¡¨åˆ—è¡¨çš„æ–‡ä»¶ï¼Œæ ¼å¼ä¸ºdatabase.tableï¼Œè¯¥é€‰é¡¹ç›´æ¥ä¼ ç»™â€“tables-fileã€‚
â€“socketï¼šè¯¥é€‰é¡¹è¡¨ç¤ºmysql.sockæ‰€åœ¨ä½ç½®ï¼Œä»¥ä¾¿å¤‡ä»½è¿›ç¨‹ç™»å½•mysqlã€‚
â€“no-timestampï¼šè¯¥é€‰é¡¹å¯ä»¥è¡¨ç¤ºä¸è¦åˆ›å»ºä¸€ä¸ªæ—¶é—´æˆ³ç›®å½•æ¥å­˜å‚¨å¤‡ä»½ï¼ŒæŒ‡å®šåˆ°è‡ªå·±æƒ³è¦çš„å¤‡ä»½æ–‡ä»¶å¤¹ã€‚
â€“ibbackupï¼šè¯¥é€‰é¡¹æŒ‡å®šäº†ä½¿ç”¨å“ªä¸ªxtrabackupäºŒè¿›åˆ¶ç¨‹åºã€‚IBBACKUP-BINARYæ˜¯è¿è¡Œpercona xtrabackupçš„å‘½ä»¤ã€‚è¿™ä¸ªé€‰é¡¹é€‚ç”¨äºxtrbackupäºŒè¿›åˆ¶ä¸åœ¨ä½ æ˜¯æœç´¢å’Œå·¥ä½œç›®å½•ï¼Œå¦‚æœæŒ‡å®šäº†è¯¥é€‰é¡¹,innoabackupexè‡ªåŠ¨å†³å®šç”¨çš„äºŒè¿›åˆ¶ç¨‹åºã€‚
â€“slave-infoï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå¯¹slaveè¿›è¡Œå¤‡ä»½çš„æ—¶å€™ä½¿ç”¨ï¼Œæ‰“å°å‡ºmasterçš„åå­—å’Œbinlog posï¼ŒåŒæ ·å°†è¿™äº›ä¿¡æ¯ä»¥change masterçš„å‘½ä»¤å†™å…¥xtrabackup_slave_infoæ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡åŸºäºè¿™ä»½å¤‡ä»½å¯åŠ¨ä¸€ä¸ªä»åº“ã€‚
â€“safe-slave-backupï¼šè¯¥é€‰é¡¹è¡¨ç¤ºä¸ºä¿è¯ä¸€è‡´æ€§å¤åˆ¶çŠ¶æ€ï¼Œè¿™ä¸ªé€‰é¡¹åœæ­¢SQLçº¿ç¨‹å¹¶ä¸”ç­‰åˆ°show statusä¸­çš„slave_open_temp_tablesä¸º0çš„æ—¶å€™å¼€å§‹å¤‡ä»½ï¼Œå¦‚æœæ²¡æœ‰æ‰“å¼€ä¸´æ—¶è¡¨ï¼Œbakcupä¼šç«‹åˆ»å¼€å§‹ï¼Œå¦åˆ™SQLçº¿ç¨‹å¯åŠ¨æˆ–è€…å…³é—­çŸ¥é“æ²¡æœ‰æ‰“å¼€çš„ä¸´æ—¶è¡¨ã€‚å¦‚æœslave_open_temp_tablesåœ¨â€“safe-slave-backup-timeountï¼ˆé»˜è®¤300ç§’ï¼‰ç§’ä¹‹åä¸ä¸º0ï¼Œä»åº“sqlçº¿ç¨‹ä¼šåœ¨å¤‡ä»½å®Œæˆçš„æ—¶å€™é‡å¯ã€‚
â€“rsyncï¼šè¯¥é€‰é¡¹è¡¨ç¤ºé€šè¿‡rsyncå·¥å…·ä¼˜åŒ–æœ¬åœ°ä¼ è¾“ï¼Œå½“æŒ‡å®šè¿™ä¸ªé€‰é¡¹ï¼Œinnobackupexä½¿ç”¨rsyncæ‹·è´éInnodbæ–‡ä»¶è€Œæ›¿æ¢cpï¼Œå½“æœ‰å¾ˆå¤šDBå’Œè¡¨çš„æ—¶å€™ä¼šå¿«å¾ˆå¤šï¼Œä¸èƒ½â€“streamä¸€èµ·ä½¿ç”¨ã€‚
â€“kill-long-queries-timeoutï¼šè¯¥é€‰é¡¹è¡¨ç¤ºä»å¼€å§‹æ‰§è¡ŒFLUSH TABLES WITH READ LOCKåˆ°killæ‰é˜»å¡å®ƒçš„è¿™äº›æŸ¥è¯¢ä¹‹é—´ç­‰å¾…çš„ç§’æ•°ã€‚é»˜è®¤å€¼ä¸º0ï¼Œä¸ä¼škillä»»ä½•æŸ¥è¯¢ï¼Œä½¿ç”¨è¿™ä¸ªé€‰é¡¹xtrabackupéœ€è¦æœ‰Processå’Œsuperæƒé™ã€‚
â€“kill-long-query-typeï¼šè¯¥é€‰é¡¹è¡¨ç¤ºkillçš„ç±»å‹ï¼Œé»˜è®¤æ˜¯allï¼Œå¯é€‰selectã€‚
â€“ftwrl-wait-thresholdï¼šè¯¥é€‰é¡¹è¡¨ç¤ºæ£€æµ‹åˆ°é•¿æŸ¥è¯¢ï¼Œå•ä½æ˜¯ç§’ï¼Œè¡¨ç¤ºé•¿æŸ¥è¯¢çš„é˜ˆå€¼ã€‚
â€“ftwrl-wait-query-typeï¼šè¯¥é€‰é¡¹è¡¨ç¤ºè·å¾—å…¨å±€é”ä¹‹å‰å…è®¸é‚£ç§æŸ¥è¯¢å®Œæˆï¼Œé»˜è®¤æ˜¯ALLï¼Œå¯é€‰updateã€‚
â€“galera-infoï¼šè¯¥é€‰é¡¹è¡¨ç¤ºç”Ÿæˆäº†åŒ…å«åˆ›å»ºå¤‡ä»½æ—¶å€™æœ¬åœ°èŠ‚ç‚¹çŠ¶æ€çš„æ–‡ä»¶xtrabackup_galera_infoæ–‡ä»¶ï¼Œè¯¥é€‰é¡¹åªé€‚ç”¨äºå¤‡ä»½PXCã€‚
â€“streamï¼šè¯¥é€‰é¡¹è¡¨ç¤ºæµå¼å¤‡ä»½çš„æ ¼å¼ï¼Œbackupå®Œæˆä¹‹åä»¥æŒ‡å®šæ ¼å¼åˆ°STDOUTï¼Œç›®å‰åªæ”¯æŒtarå’Œxbstreamã€‚
â€“defaults-fileï¼šè¯¥é€‰é¡¹æŒ‡å®šäº†ä»å“ªä¸ªæ–‡ä»¶è¯»å–MySQLé…ç½®ï¼Œå¿…é¡»æ”¾åœ¨å‘½ä»¤è¡Œç¬¬ä¸€ä¸ªé€‰é¡¹çš„ä½ç½®ã€‚
â€“defaults-extra-fileï¼šè¯¥é€‰é¡¹æŒ‡å®šäº†åœ¨æ ‡å‡†defaults-fileä¹‹å‰ä»å“ªä¸ªé¢å¤–çš„æ–‡ä»¶è¯»å–MySQLé…ç½®ï¼Œå¿…é¡»åœ¨å‘½ä»¤è¡Œçš„ç¬¬ä¸€ä¸ªé€‰é¡¹çš„ä½ç½®ã€‚ä¸€èˆ¬ç”¨äºå­˜å¤‡ä»½ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç çš„é…ç½®æ–‡ä»¶ã€‚
â€”-defaults-groupï¼šè¯¥é€‰é¡¹è¡¨ç¤ºä»é…ç½®æ–‡ä»¶è¯»å–çš„ç»„ï¼Œinnobakcupexå¤šä¸ªå®ä¾‹éƒ¨ç½²æ—¶ä½¿ç”¨ã€‚
â€“no-lockï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå…³é—­FTWRLçš„è¡¨é”ï¼Œåªæœ‰åœ¨æ‰€æœ‰è¡¨éƒ½æ˜¯Innodbè¡¨å¹¶ä¸”ä¸å…³å¿ƒbackupçš„binlog posç‚¹ï¼Œå¦‚æœæœ‰ä»»ä½•DDLè¯­å¥æ­£åœ¨æ‰§è¡Œæˆ–è€…éInnoDBæ­£åœ¨æ›´æ–°æ—¶ï¼ˆåŒ…æ‹¬mysqlåº“ä¸‹çš„è¡¨ï¼‰ï¼Œéƒ½ä¸åº”è¯¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œåæœæ˜¯å¯¼è‡´å¤‡ä»½æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚æœè€ƒè™‘å¤‡ä»½å› ä¸ºè·å¾—é”å¤±è´¥ï¼Œå¯ä»¥è€ƒè™‘â€“safe-slave-backupç«‹åˆ»åœæ­¢å¤åˆ¶çº¿ç¨‹ã€‚
â€“tmpdirï¼šè¯¥é€‰é¡¹è¡¨ç¤ºæŒ‡å®šâ€“streamçš„æ—¶å€™ï¼ŒæŒ‡å®šä¸´æ—¶æ–‡ä»¶å­˜åœ¨å“ªé‡Œï¼Œåœ¨streamingå’Œæ‹·è´åˆ°è¿œç¨‹serverä¹‹å‰ï¼Œäº‹åŠ¡æ—¥å¿—é¦–å…ˆå­˜åœ¨ä¸´æ—¶æ–‡ä»¶é‡Œã€‚åœ¨ ä½¿ç”¨å‚æ•°stream=tarå¤‡ä»½çš„æ—¶å€™ï¼Œä½ çš„xtrabackup_logfileå¯èƒ½ä¼šä¸´æ—¶æ”¾åœ¨/tmpç›®å½•ä¸‹ï¼Œå¦‚æœä½ å¤‡ä»½çš„æ—¶å€™å¹¶å‘å†™å…¥è¾ƒå¤§çš„è¯ xtrabackup_logfileå¯èƒ½ä¼šå¾ˆå¤§(5G+)ï¼Œå¾ˆå¯èƒ½ä¼šæ’‘æ»¡ä½ çš„/tmpç›®å½•ï¼Œå¯ä»¥é€šè¿‡å‚æ•°â€“tmpdiræŒ‡å®šç›®å½•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
â€“historyï¼šè¯¥é€‰é¡¹è¡¨ç¤ºpercona server çš„å¤‡ä»½å†å²è®°å½•åœ¨percona_schema.xtrabackup_historyè¡¨ã€‚
â€“incrementalï¼šè¯¥é€‰é¡¹è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå¢é‡å¤‡ä»½ï¼Œéœ€è¦æŒ‡å®šâ€“incremental-basedirã€‚
â€“incremental-basedirï¼šè¯¥é€‰é¡¹è¡¨ç¤ºæ¥å—äº†ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°æŒ‡å®šå«æœ‰full backupçš„ç›®å½•ä¸ºå¢é‡å¤‡ä»½çš„baseç›®å½•ï¼Œä¸â€“incrementalåŒæ—¶ä½¿ç”¨ã€‚
â€“incremental-dirï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå¢é‡å¤‡ä»½çš„ç›®å½•ã€‚
â€“incremental-force-scanï¼šè¯¥é€‰é¡¹è¡¨ç¤ºåˆ›å»ºä¸€ä»½å¢é‡å¤‡ä»½æ—¶ï¼Œå¼ºåˆ¶æ‰«ææ‰€æœ‰å¢é‡å¤‡ä»½ä¸­çš„æ•°æ®é¡µã€‚
â€“incremental-lsnï¼šè¯¥é€‰é¡¹è¡¨ç¤ºæŒ‡å®šå¢é‡å¤‡ä»½çš„LSNï¼Œä¸â€“incrementalé€‰é¡¹ä¸€èµ·ä½¿ç”¨ã€‚
â€“incremental-history-nameï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå­˜å‚¨åœ¨PERCONA_SCHEMA.xtrabackup_historyåŸºäºå¢é‡å¤‡ä»½çš„å†å²è®°å½•çš„åå­—ã€‚Percona Xtrabackupæœç´¢å†å²è¡¨æŸ¥æ‰¾æœ€è¿‘ï¼ˆinnodb_to_lsnï¼‰æˆåŠŸå¤‡ä»½å¹¶ä¸”å°†to_lsnå€¼ä½œä¸ºå¢é‡å¤‡ä»½å¯åŠ¨å‡ºäº‹lsn.ä¸innobackupexâ€“incremental-history-uuidäº’æ–¥ã€‚å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°æœ‰æ•ˆçš„lsnï¼Œxtrabackupä¼šè¿”å›errorã€‚
â€“incremental-history-uuidï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå­˜å‚¨åœ¨percona_schema.xtrabackup_historyåŸºäºå¢é‡å¤‡ä»½çš„ç‰¹å®šå†å²è®°å½•çš„UUIDã€‚
â€“close-filesï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå…³é—­ä¸å†è®¿é—®çš„æ–‡ä»¶å¥æŸ„ï¼Œå½“xtrabackupæ‰“å¼€è¡¨ç©ºé—´é€šå¸¸å¹¶ä¸å…³é—­æ–‡ä»¶å¥æŸ„ç›®çš„æ˜¯æ­£ç¡®çš„å¤„ç†DDLæ“ä½œã€‚å¦‚æœè¡¨ç©ºé—´æ•°é‡å·¨å¤§ï¼Œè¿™æ˜¯ä¸€ç§å¯ä»¥å…³é—­ä¸å†è®¿é—®çš„æ–‡ä»¶å¥æŸ„çš„æ–¹æ³•ã€‚ä½¿ç”¨è¯¥é€‰é¡¹æœ‰é£é™©ï¼Œä¼šæœ‰äº§ç”Ÿä¸ä¸€è‡´å¤‡ä»½çš„å¯èƒ½ã€‚
â€“compactï¼šè¯¥é€‰é¡¹è¡¨ç¤ºåˆ›å»ºä¸€ä»½æ²¡æœ‰è¾…åŠ©ç´¢å¼•çš„ç´§å‡‘çš„å¤‡ä»½ã€‚
â€“throttleï¼šè¯¥é€‰é¡¹è¡¨ç¤ºæ¯ç§’IOæ“ä½œçš„æ¬¡æ•°ï¼Œåªä½œç”¨äºbakcupé˜¶æ®µæœ‰æ•ˆã€‚apply-logå’Œâ€“copy-backä¸ç”Ÿæ•ˆä¸è¦ä¸€èµ·ç”¨ã€‚prepareï¼š</p>

<p>innobackupex â€“apply-log [â€“use-memory=B]
             [â€“defaults-file=MY.CNF]
             [â€“export] [â€“redo-only] [â€“ibbackup=IBBACKUP-BINARY]
             BACKUP-DIR
å‚æ•°è¯´æ˜ï¼š</p>

<p>â€“apply-logï¼šè¯¥é€‰é¡¹è¡¨ç¤ºåŒxtrabackupçš„â€“prepareå‚æ•°,ä¸€èˆ¬æƒ…å†µä¸‹,åœ¨å¤‡ä»½å®Œæˆåï¼Œæ•°æ®å°šä¸”ä¸èƒ½ç”¨äºæ¢å¤æ“ä½œï¼Œå› ä¸ºå¤‡ä»½çš„æ•°æ®ä¸­å¯èƒ½ä¼šåŒ…å«å°šæœªæäº¤çš„äº‹åŠ¡æˆ–å·²ç»æäº¤ä½†å°šæœªåŒæ­¥è‡³æ•°æ®æ–‡ä»¶ä¸­çš„äº‹åŠ¡ã€‚å› æ­¤ï¼Œæ­¤æ—¶æ•°æ® æ–‡ä»¶ä»å¤„ç†ä¸ä¸€è‡´çŠ¶æ€ã€‚â€“apply-logçš„ä½œç”¨æ˜¯é€šè¿‡å›æ»šæœªæäº¤çš„äº‹åŠ¡åŠåŒæ­¥å·²ç»æäº¤çš„äº‹åŠ¡è‡³æ•°æ®æ–‡ä»¶ä½¿æ•°æ®æ–‡ä»¶å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚
â€“use-memoryï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå’Œâ€“apply-logé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œprepare å¤‡ä»½çš„æ—¶å€™ï¼Œxtrabackupåšcrash recoveryåˆ†é…çš„å†…å­˜å¤§å°ï¼Œå•ä½å­—èŠ‚ã€‚ä¹Ÿå¯(1MB,1M,1G,1GB)ï¼Œæ¨è1Gã€‚
â€“defaults-fileï¼šè¯¥é€‰é¡¹æŒ‡å®šäº†ä»å“ªä¸ªæ–‡ä»¶è¯»å–MySQLé…ç½®ï¼Œå¿…é¡»æ”¾åœ¨å‘½ä»¤è¡Œç¬¬ä¸€ä¸ªé€‰é¡¹çš„ä½ç½®ã€‚
â€“exportï¼šè¿™ä¸ªé€‰é¡¹è¡¨ç¤ºå¼€å¯å¯å¯¼å‡ºå•ç‹¬çš„è¡¨ä¹‹åå†å¯¼å…¥å…¶ä»–Mysqlä¸­ã€‚
â€“redo-onlyï¼šè¿™ä¸ªé€‰é¡¹åœ¨prepare base full backupï¼Œå¾€å…¶ä¸­mergeå¢é‡å¤‡ä»½ï¼ˆä½†ä¸åŒ…æ‹¬æœ€åä¸€ä¸ªï¼‰æ—¶å€™ä½¿ç”¨ã€‚
3ï¼‰è§£å‹è§£å¯†ï¼š</p>

<p>innobackupex [â€“decompress] [â€“decrypt=ENCRYPTION-ALGORITHM]
             [â€“encrypt-key=LITERAL-ENCRYPTION-KEY] | [â€“encryption-key-file=MY.KEY]
             [â€“parallel=NUMBER-OF-FORKS] BACKUP-DIR
å‚æ•°è¯´æ˜ï¼š</p>

<p>â€“decompressï¼šè¯¥é€‰é¡¹è¡¨ç¤ºè§£å‹â€“compressé€‰é¡¹å‹ç¼©çš„æ–‡ä»¶ã€‚
â€“parallelï¼šè¯¥é€‰é¡¹è¡¨ç¤ºå…è®¸å¤šä¸ªæ–‡ä»¶åŒæ—¶è§£å‹ã€‚ä¸ºäº†è§£å‹ï¼Œqpresså·¥å…·å¿…é¡»æœ‰å®‰è£…å¹¶ä¸”è®¿é—®è¿™ä¸ªæ–‡ä»¶çš„æƒé™ã€‚è¿™ä¸ªè¿›ç¨‹å°†åœ¨åŒä¸€ä¸ªä½ç½®ç§»é™¤åŸæ¥çš„å‹ç¼©/åŠ å¯†æ–‡ä»¶ã€‚
â€“decryptï¼šè¯¥é€‰é¡¹è¡¨ç¤ºè§£å¯†é€šè¿‡â€“encrypté€‰é¡¹åŠ å¯†çš„.xbcryptæ–‡ä»¶ã€‚
4ï¼‰è¿˜åŸï¼š</p>

<p>innobackupex â€“copy-back [â€“defaults-file=MY.CNF] [â€“defaults-group=GROUP-NAME] BACKUP-DIR
innobackupex â€“move-back [â€“defaults-file=MY.CNF] [â€“defaults-group=GROUP-NAME] BACKUP-DIR
å‚æ•°è¯´æ˜ï¼š</p>

<p>å¤åˆ¶ä»£ç 
â€“copy-backï¼šåšæ•°æ®æ¢å¤æ—¶å°†å¤‡ä»½æ•°æ®æ–‡ä»¶æ‹·è´åˆ°MySQLæœåŠ¡å™¨çš„datadirã€‚
â€“move-backï¼šè¿™ä¸ªé€‰é¡¹ä¸â€“copy-backç›¸ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯å®ƒä¸æ‹·è´æ–‡ä»¶ï¼Œè€Œæ˜¯ç§»åŠ¨æ–‡ä»¶åˆ°ç›®çš„åœ°ã€‚è¿™ä¸ªé€‰é¡¹ç§»é™¤backupæ–‡ä»¶ï¼Œç”¨æ—¶å€™å¿…é¡»å°å¿ƒã€‚ä½¿ç”¨åœºæ™¯ï¼šæ²¡æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´åŒäº‹ä¿ç•™æ•°æ®æ–‡ä»¶å’ŒBackupå‰¯æœ¬
æ³¨æ„ï¼š
1.datadirç›®å½•å¿…é¡»ä¸ºç©ºã€‚é™¤éæŒ‡å®šinnobackupex â€“force-non-empty-directoriresé€‰é¡¹æŒ‡å®šï¼Œå¦åˆ™â€“copy-backupé€‰é¡¹ä¸ä¼šè¦†ç›–
2.åœ¨restoreä¹‹å‰,å¿…é¡»shutdown MySQLå®ä¾‹ï¼Œä½ ä¸èƒ½å°†ä¸€ä¸ªè¿è¡Œä¸­çš„å®ä¾‹restoreåˆ°datadirç›®å½•ä¸­
3.ç”±äºæ–‡ä»¶å±æ€§ä¼šè¢«ä¿ç•™ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½ éœ€è¦åœ¨å¯åŠ¨å®ä¾‹ä¹‹å‰å°†æ–‡ä»¶çš„å±ä¸»æ”¹ä¸ºmysqlï¼Œè¿™äº›æ–‡ä»¶å°†å±äºåˆ›å»ºå¤‡ä»½çš„ç”¨æˆ·
chown -R my5711:mysql /data1/dbrestore
ä»¥ä¸Šéœ€è¦åœ¨ç”¨æˆ·è°ƒç”¨Innobackupexä¹‹å‰å®Œæˆ
â€“force-non-empty-directoriesï¼šæŒ‡å®šè¯¥å‚æ•°æ—¶å€™ï¼Œä½¿å¾—innobackupex â€“copy-backæˆ–â€“move-backé€‰é¡¹è½¬ç§»æ–‡ä»¶åˆ°éç©ºç›®å½•ï¼Œå·²å­˜åœ¨çš„æ–‡ä»¶ä¸ä¼šè¢«è¦†ç›–ã€‚å¦‚æœâ€“copy-backå’Œâ€“move-backæ–‡ä»¶éœ€è¦ä»å¤‡ä»½ç›®å½•æ‹·è´ä¸€ä¸ªåœ¨datadirå·²ç»å­˜åœ¨çš„æ–‡ä»¶ï¼Œä¼šæŠ¥é”™å¤±è´¥ã€‚
å¤åˆ¶ä»£ç 
 5ï¼‰åº”ç”¨åœºæ™¯ï¼š</p>

<p>â‘ .æ™®é€šå…¨é‡å¤‡ä»½ã€è¿˜åŸï¼šï¼ˆåº“ï¼šdba_testã€xtra_testï¼‰</p>

<p>å¤åˆ¶ä»£ç 
#å¤‡ä»½æ‰€æœ‰æ•°æ®åº“ï¼šå¤‡ä»½ç›®å½•é‡Œç”Ÿæˆæ—¥æœŸå‘½åçš„æ–‡ä»¶å¤¹
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 /home/zhoujy/xtrabackup/
#è¿˜åŸ
1.å…ˆprepareï¼Œåˆ©ç”¨â€“apply-logçš„ä½œç”¨æ˜¯é€šè¿‡å›æ»šæœªæäº¤çš„äº‹åŠ¡åŠåŒæ­¥å·²ç»æäº¤çš„äº‹åŠ¡è‡³æ•°æ®æ–‡ä»¶ä½¿æ•°æ®æ–‡ä»¶å¤„äºä¸€è‡´æ€§çŠ¶æ€
innobackupex â€“apply-log /home/zhoujy/xtrabackup/2016-09-23_10-53-51/
2.copyï¼šéœ€è¦æ•°æ®ç›®å½•ä¸ºç©º
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“copy-back /home/zhoujy/xtrabackup/2016-09-23_10-53-51/
3.æ”¹æƒé™
++++++++++++++++++
#å¤‡ä»½æ‰€æœ‰æ•°æ®åº“ï¼šæŒ‡å®šå¤‡ä»½ç›®å½•
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“no-timestamp /home/zhoujy/xtrabackup/
#è¿˜åŸåŒä¸Š
++++++++++++++++++
#å¤‡ä»½æŒ‡å®šæ•°æ®åº“åï¼Œå¤šä¸ªæ•°æ®åº“ç”¨ç©ºæ ¼åˆ†å¼€
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“no-timestamp â€“databases=â€dba_test xtra_testâ€ /home/zhoujy/xtrabackup/
#è¿˜åŸ
1.å…ˆprepareï¼Œåˆ©ç”¨â€“apply-logçš„ä½œç”¨æ˜¯é€šè¿‡å›æ»šæœªæäº¤çš„äº‹åŠ¡åŠåŒæ­¥å·²ç»æäº¤çš„äº‹åŠ¡è‡³æ•°æ®æ–‡ä»¶ä½¿æ•°æ®æ–‡ä»¶å¤„äºä¸€è‡´æ€§çŠ¶æ€
innobackupex â€“apply-log /home/zhoujy/xtrabackup/
2.copyï¼Œå› ä¸ºæ˜¯éƒ¨åˆ†å¤‡ä»½ï¼Œä¸èƒ½ç›´æ¥ç”¨â€“copy-backï¼Œåªèƒ½æ‰‹åŠ¨æ¥å¤åˆ¶éœ€è¦çš„åº“ï¼Œä¹Ÿè¦å¤åˆ¶ibdata(æ•°æ®å­—å…¸ï¼‰
cp -r dba_test/ /var/lib/mysql/
cp -r xtrabackup/dba_test/ /var/lib/mysql
3.æ”¹æƒé™
++++++++++++++++++
#å¤‡ä»½æŒ‡å®šè¡¨
å¤‡ä»½ä¸åŒåº“ä¸‹çš„ä¸åŒè¡¨
1ï¼šinnobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“no-timestamp â€“databases=â€dba_test.tb1 xtra_test.Mâ€ /home/zhoujy/xtrabackup/
å¤‡ä»½ä¸€ä¸ªåº“ä¸‹é¢çš„è¡¨ï¼Œæ”¯æŒæ­£åˆ™ï¼Œå¦‚ï¼šâ€“include=â€™^mydatabase[.]mytableâ€™ 
2ï¼šinnobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“no-timestamp â€“include=â€™xtra_test.Iâ€™ /home/zhoujy/xtrabackup/
å¤‡ä»½æŒ‡å®šæ–‡ä»¶é‡Œçš„è¡¨ï¼Œæ–‡ä»¶é‡Œæ¯è¡Œçš„æ ¼å¼æ˜¯ï¼šdbname.tbname
3ï¼šinnobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“no-timestamp â€“tables-file=/tmp/tbname.txt  /home/zhoujy/xtrabackup/
#è¿˜åŸ
åŒæŒ‡å®šæ•°æ®åº“è¿˜åŸä¸€æ ·ï¼Œéœ€è¦è¿˜åŸibdataã€‚æ³¨æ„ï¼Œè¿˜åŸçš„æ—¶å€™å¯ä»¥è¿™æ ·è¿˜åŸï¼š
innobackupex â€“apply-log â€“export xtrabackup/
ç”Ÿæˆå¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š
-rw-râ€“râ€“ 1 root root  425  9æœˆ 23 17:16 I.cfg
-rw-râ€”â€“ 1 root root  16K  9æœˆ 23 17:16 I.exp
-rw-râ€”â€“ 1 root root 8.4K  9æœˆ 23 17:15 I.frm
-rw-râ€”â€“ 1 root root  96K  9æœˆ 23 17:15 I.ibd
  ç„¶åï¼š</p>

<p>alter table I discard tablespace;</p>

<p>å°†I.expå’ŒIæ–‡ä»¶ä¼ åˆ°ç›®æ ‡æœºç›®æ ‡ç›®å½•ä¸­æ‰§è¡Œ:</p>

<p>alter table I import tablespace;</p>

<p>å¤åˆ¶ä»£ç 
â‘¡.æ™®é€šå¢é‡å¤‡ä»½ã€è¿˜åŸ</p>

<p>å¤åˆ¶ä»£ç 
#å…¨é‡å¤‡ä»½ï¼Œè¿™é‡Œä¸¾ä¾‹å•ä¸ªè¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡å®šå‡ ä¸ªåº“ï¼Œç”šè‡³æ‰€æœ‰åº“
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“no-timestamp â€“databases=â€xtra_test.Iâ€ /home/zhoujy/xtrabackup/
#å¢é‡å¤‡ä»½1
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“no-timestamp â€“databases=â€xtra_test.Iâ€ â€“incremental-basedir=/home/zhoujy/xtrabackup/  â€“incremental /home/zhoujy/increment_data/
#å¢é‡å¤‡ä»½2
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“no-timestamp â€“databases=â€xtra_test.Iâ€ â€“incremental-basedir=/home/zhoujy/increment_data/ â€“incremental /home/zhoujy/increment_data1/</p>

<p>####ä¿¡æ¯####
é€šè¿‡ä¸Šé¢ä¸‰ä¸ªç›®å½•é‡Œçš„xtrabackup_checkpointsæ–‡ä»¶ï¼Œå¯ä»¥çœ‹å‡ºæ˜¯å“ªç§å¤‡ä»½ç±»å‹ï¼Œå…¨é‡ï¼ˆfull-backupedï¼‰è¿˜æ˜¯å¢é‡ï¼ˆincrementalï¼‰ã€‚å¹¶ä¸”å…¨é‡åˆ°å¢é‡çš„from_lsnå’Œlast_lsnæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚
åœ¨ç¬¬2æ¬¡åšå¢é‡å¤‡ä»½çš„æ—¶å€™ â€“incremental-basedir æŒ‡å‘å…¨é‡å¤‡ä»½ï¼Œåˆ™ç¬¬ä¸€æ¬¡å¢é‡å¤‡ä»½ä¸­çš„æ•°æ®ä¼šè¢«ç¬¬2æ¬¡åŒ…å«ï¼Œåªéœ€è¦è¿˜åŸä¸€æ¬¡å°±å¯ä»¥æ¢å¤ï¼Œç°åœ¨åˆ™éœ€è¦è¿˜åŸ2æ¬¡å¢é‡å¤‡ä»½ã€‚
##########</p>

<p>#è¿˜åŸ
1.å…ˆprepareå…¨å¤‡
innobackupex â€“incremental â€“apply-log â€“redo-only /home/zhoujy/xtrabackup
2.å†prepareç¬¬ä¸€ä¸ªå¢é‡
innobackupex â€“incremental â€“apply-log â€“redo-only /home/zhoujy/xtrabackup/ â€“user-memory=1G  â€“incremental-dir=/home/zhoujy/increment_data/
3.ç„¶åprepareæœ€åä¸€ä¸ªå¢é‡
innobackupex â€“incremental â€“apply-log â€“redo-only /home/zhoujy/xtrabackup/ â€“user-memory=1G  â€“incremental-dir=/home/zhoujy/increment_data1/</p>

<p>é€šè¿‡ä¸Šé¢é¢å¯ä»¥çœ‹åˆ°å…¨é‡å¤‡ä»½é‡Œxtrabackup_checkpointsæ–‡ä»¶çš„to_lsnæ˜¯æœ€æ–°çš„lsnã€‚</p>

<p>4.æœ€åå†prepareå…¨é‡å¤‡ä»½
innobackupex â€“apply-log /home/zhoujy/xtrabackup/</p>

<p>5.copy
å› ä¸ºæ˜¯éƒ¨åˆ†å¤‡ä»½ï¼Œä¸æ˜¯æ‰€æœ‰åº“å¤‡ä»½ï¼Œæ‰€ä»¥å’Œä¸Šé¢ä»‹ç»çš„ä¸€æ ·ï¼Œå…ˆæ‰‹åŠ¨å¤åˆ¶éœ€è¦çš„æ–‡ä»¶å†ä¿®æ”¹æƒé™å³å¯æ¢å¤æ•°æ®ã€‚ 
å¤åˆ¶ä»£ç 
â‘¢.æ‰“åŒ…å‹ç¼©å¤‡ä»½ï¼Œæ³¨æ„ï¼šâ€“compressä¸èƒ½å’Œâ€“stream=tarä¸€èµ·ä½¿ç”¨</p>

<p>å¤åˆ¶ä»£ç 
#å‹ç¼©å¤‡ä»½
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“compress â€“compress-threads=8 â€“no-timestamp â€“databases=â€xtra_test.Iâ€ /home/zhoujy/xtrabackup/</p>

<p>#åœ¨perpareä¹‹å‰éœ€è¦decompressï¼Œéœ€è¦å®‰è£…qpress
innobackupex â€“decompress /home/zhoujy/xtrabackup/</p>

<p>#prepare
innobackupex â€“apply-log /home/zhoujy/xtrabackup/</p>

<p>æœ€åè¿˜åŸæ–¹æ³•å’Œä¸Šé¢ä¸€è‡´</p>

<p>#æ‰“åŒ…å¤‡ä»½
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“stream=tar â€“no-timestamp â€“databases=â€xtra_testâ€ /home/zhoujy/xtrabackup/ 1&gt;/home/zhoujy/xtrabackup/xtra_test.tar</p>

<p>#è§£åŒ…
tar ixvf xtra_test.tar</p>

<p>æœ€åè¿˜åŸæ–¹æ³•å’Œä¸Šé¢ä¸€è‡´</p>

<p>#ç¬¬ä¸‰æ–¹å‹ç¼©å¤‡ä»½ï¼š
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“compress â€“compress-threads=8 â€“parallel=4 â€“stream=tar â€“no-timestamp â€“databases=â€xtra_testâ€ /home/zhoujy/xtrabackup/ | gzip &gt;/home/zhoujy/xtrabackup/xtra_test.tar.gz</p>

<p>#prepareä¹‹å‰å…ˆè§£å‹
tar izxvf xtra_test.tar.gz</p>

<p>#prepare
innobackupex â€“apply-log /home/zhoujy/xtrabackup/
å¤åˆ¶ä»£ç 
â‘£.åŠ å¯†å¤‡ä»½</p>

<p>å¤åˆ¶ä»£ç 
è¯´æ˜ï¼šåœ¨å‚æ•°è¯´æ˜é‡Œçœ‹åˆ°åŠ å¯†å¤‡ä»½çš„å‡ ä¸ªå‚æ•°ï¼šâ€“encryptã€â€“encrypt-threadsã€â€“encrypt-keyã€â€“encryption-key-fileã€‚å…¶ä¸­encrypt-keyå’Œencryption-key-fileä¸èƒ½ä¸€èµ·ä½¿ç”¨ï¼Œencryption-keyéœ€è¦æŠŠåŠ å¯†çš„å¯†ç å†™åˆ°å‘½ä»¤è¡Œï¼Œä¸æ¨èã€‚</p>

<p>#åŠ å¯†å¤‡ä»½ï¼š
å…ˆç”Ÿæˆkey:
openssl rand -base64 24
æŠŠKeyå†™åˆ°æ–‡ä»¶ï¼š
echo -n â€œUe2Wp6dIDWszpI76HQ1u57exyjAdHpROâ€ &gt; keyfile 
æœ€åå¤‡ä»½ï¼š
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“compress â€“compress-threads=3 â€“no-timestamp â€“encrypt=AES256 â€“encrypt-key-file=/home/zhoujy/keyfile â€”-encrypt-threads=3 â€“parallel=5 /home/zhoujy/xtrabackup2/</p>

<p>#è§£å¯†ï¼š
for i in <code class="language-plaintext highlighter-rouge">find . -iname "*\.xbcrypt"</code>; do xbcrypt -d â€“encrypt-key-file=/home/zhoujy/keyfile â€“encrypt-algo=AES256 &lt; $i &gt; $(dirname $i)/$(basename $i .xbcrypt) &amp;&amp; rm $i; done</p>

<p>#è§£å‹ï¼š
innobackupex â€“decompress /home/zhoujy/xtrabackup2/</p>

<p>#prepareï¼š
innobackupex â€“apply-log /home/zhoujy/xtrabackup2/</p>

<p>#è¿˜åŸcopy
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“move-back /home/zhoujy/xtrabackup2/
å¤åˆ¶ä»£ç 
â‘¤.å¤åˆ¶ç¯å¢ƒä¸­çš„å¤‡ä»½ï¼šä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸»ä»æ¨¡å¼ï¼Œä¸»æä¾›æœåŠ¡ï¼Œä»æä¾›å¤‡ä»½ã€‚</p>

<p>#å¤‡ä»½ 5ä¸ªçº¿ç¨‹å¤‡ä»½2ä¸ªæ•°æ®åº“ï¼Œå¹¶ä¸”æ–‡ä»¶xtrabackup_slave_infoè®°å½•GTIDå’Œchangeçš„ä¿¡æ¯
innobackupex â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123 â€“no-timestamp â€“slave-info â€“safe-slave-backup â€“parallel=5 â€“databases=â€™xtra_test dba_testâ€™ /home/zhoujy/xtrabackup/</p>

<p>#è¿˜åŸ
è¿˜åŸæ–¹æ³•åŒä¸Š
æ€»ç»“ï¼šå…³äºæ›´å¤šçš„innobackupexçš„å¤‡ä»½å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£å’Œxtrabackup å®‰è£…ä½¿ç”¨ï¼Œå‚æ•°å¯ä»¥å‚è€ƒæœ¬æ–‡ä¸Šé¢çš„ä»‹ç»è¯´æ˜ï¼Œé€šè¿‡ä¸Šé¢çš„å‡ ä¸ªè¯´æ˜çœ‹åˆ°innobackupexå¯ä»¥å®ç°ï¼šå…¨é‡ã€å¢é‡ã€å‹ç¼©ã€æ‰“åŒ…ã€åŠ å¯†å¤‡ä»½ï¼Œå¹¶ä¸”æ”¯æŒå¤šçº¿ç¨‹çš„å¤‡ä»½ï¼Œå¹¶ä¸”ä¹Ÿæä¾›äº†é•¿æŸ¥è¯¢è¶…è¿‡é˜€å€¼è‡ªåŠ¨killçš„æ–¹æ³•ï¼Œå¤§å¤§æå‡å¤‡ä»½æ•ˆç‡ã€‚</p>

<p>xtrabackup å‚æ•°è¯´æ˜ï¼ˆxtrabackup â€“help ï¼‰ï¼š 
å¤åˆ¶ä»£ç 
â€“apply-log-onlyï¼šprepareå¤‡ä»½çš„æ—¶å€™åªæ‰§è¡Œredoé˜¶æ®µï¼Œç”¨äºå¢é‡å¤‡ä»½ã€‚
â€“backupï¼šåˆ›å»ºå¤‡ä»½å¹¶ä¸”æ”¾å…¥â€“target-dirç›®å½•ä¸­
â€“close-filesï¼šä¸ä¿æŒæ–‡ä»¶æ‰“å¼€çŠ¶æ€ï¼Œxtrabackupæ‰“å¼€è¡¨ç©ºé—´çš„æ—¶å€™é€šå¸¸ä¸ä¼šå…³é—­æ–‡ä»¶å¥æŸ„ï¼Œç›®çš„æ˜¯ä¸ºäº†æ­£ç¡®å¤„ç†DDLæ“ä½œã€‚å¦‚æœè¡¨ç©ºé—´æ•°é‡éå¸¸å·¨å¤§å¹¶ä¸”ä¸é€‚åˆä»»ä½•é™åˆ¶ï¼Œä¸€æ—¦æ–‡ä»¶ä¸åœ¨è¢«è®¿é—®çš„æ—¶å€™è¿™ä¸ªé€‰é¡¹å¯ä»¥å…³é—­æ–‡ä»¶å¥æŸ„.æ‰“å¼€è¿™ä¸ªé€‰é¡¹ä¼šäº§ç”Ÿä¸ä¸€è‡´çš„å¤‡ä»½ã€‚
â€“compactï¼šåˆ›å»ºä¸€ä»½æ²¡æœ‰è¾…åŠ©ç´¢å¼•çš„ç´§å‡‘å¤‡ä»½
â€“compressï¼šå‹ç¼©æ‰€æœ‰è¾“å‡ºæ•°æ®ï¼ŒåŒ…æ‹¬äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å’Œå…ƒæ•°æ®æ–‡ä»¶ï¼Œé€šè¿‡æŒ‡å®šçš„å‹ç¼©ç®—æ³•ï¼Œç›®å‰å”¯ä¸€æ”¯æŒçš„ç®—æ³•æ˜¯quicklz.ç»“æœæ–‡ä»¶æ˜¯qpresså½’æ¡£æ ¼å¼ï¼Œæ¯ä¸ªxtrabackupåˆ›å»ºçš„*.qpæ–‡ä»¶éƒ½å¯ä»¥é€šè¿‡qpressç¨‹åºæå–æˆ–è€…è§£å‹ç¼©
â€“compress-chunk-size=#ï¼šå‹ç¼©çº¿ç¨‹å·¥ä½œbufferçš„å­—èŠ‚å¤§å°ï¼Œé»˜è®¤æ˜¯64K
â€“compress-threads=#ï¼šxtrabackupè¿›è¡Œå¹¶è¡Œæ•°æ®å‹ç¼©æ—¶çš„workerçº¿ç¨‹çš„æ•°é‡ï¼Œè¯¥é€‰é¡¹é»˜è®¤å€¼æ˜¯1ï¼Œå¹¶è¡Œå‹ç¼©ï¼ˆâ€™compress-threadsâ€™ï¼‰å¯ä»¥å’Œå¹¶è¡Œæ–‡ä»¶æ‹·è´(â€˜parallelâ€™)ä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚:â€™â€“parallel=4 â€“compress â€“compress-threads=2â€™ä¼šåˆ›å»º4ä¸ªIOçº¿ç¨‹è¯»å–æ•°æ®å¹¶é€šè¿‡ç®¡é“ä¼ é€ç»™2ä¸ªå‹ç¼©çº¿ç¨‹ã€‚
â€“create-ib-logfileï¼šè¿™ä¸ªé€‰é¡¹ç›®å‰è¿˜æ²¡æœ‰å®ç°ï¼Œç›®å‰åˆ›å»ºInnodbäº‹åŠ¡æ—¥å¿—ï¼Œä½ è¿˜æ˜¯éœ€è¦prepareä¸¤æ¬¡ã€‚
â€“datadir=DIRECTORYï¼šbackupçš„æºç›®å½•ï¼Œmysqlå®ä¾‹çš„æ•°æ®ç›®å½•ã€‚ä»my.cnfä¸­è¯»å–ï¼Œæˆ–è€…å‘½ä»¤è¡ŒæŒ‡å®šã€‚
â€“defaults-extra-file=[MY.CNF]ï¼šåœ¨global filesæ–‡ä»¶ä¹‹åè¯»å–ï¼Œå¿…é¡»åœ¨å‘½ä»¤è¡Œçš„ç¬¬ä¸€é€‰é¡¹ä½ç½®æŒ‡å®šã€‚
â€“defaults-file=[MY.CNF]ï¼šå”¯ä¸€ä»ç»™å®šæ–‡ä»¶è¯»å–é»˜è®¤é€‰é¡¹ï¼Œå¿…é¡»æ˜¯ä¸ªçœŸå®æ–‡ä»¶ï¼Œå¿…é¡»åœ¨å‘½ä»¤è¡Œç¬¬ä¸€ä¸ªé€‰é¡¹ä½ç½®æŒ‡å®šã€‚
â€“defaults-group=GROUP-NAMEï¼šä»é…ç½®æ–‡ä»¶è¯»å–çš„ç»„ï¼Œinnobakcupexå¤šä¸ªå®ä¾‹éƒ¨ç½²æ—¶ä½¿ç”¨ã€‚
â€“exportï¼šä¸ºå¯¼å‡ºçš„è¡¨åˆ›å»ºå¿…è¦çš„æ–‡ä»¶
â€“extra-lsndir=DIRECTORYï¼š(for â€“bakcup):åœ¨æŒ‡å®šç›®å½•åˆ›å»ºä¸€ä»½xtrabakcup_checkpointsæ–‡ä»¶çš„é¢å¤–çš„å¤‡ä»½ã€‚
â€“incremental-basedir=DIRECTORYï¼šåˆ›å»ºä¸€ä»½å¢é‡å¤‡ä»½æ—¶ï¼Œè¿™ä¸ªç›®å½•æ˜¯å¢é‡åˆ«åˆ†çš„ä¸€ä»½åŒ…å«äº†full bakcupçš„Baseæ•°æ®é›†ã€‚
â€“incremental-dir=DIRECTORYï¼šprepareå¢é‡å¤‡ä»½çš„æ—¶å€™ï¼Œå¢é‡å¤‡ä»½åœ¨DIRECTORYç»“åˆfull backupåˆ›å»ºå‡ºä¸€ä»½æ–°çš„full backupã€‚
â€“incremental-force-scanï¼šåˆ›å»ºä¸€ä»½å¢é‡å¤‡ä»½æ—¶ï¼Œå¼ºåˆ¶æ‰«ææ‰€æœ‰å¢åœ¨å¤‡ä»½ä¸­çš„æ•°æ®é¡µå³ä½¿å®Œå…¨æ”¹å˜çš„page bitmapæ•°æ®å¯ç”¨ã€‚
â€“incremetal-lsn=LSNï¼šåˆ›å»ºå¢é‡å¤‡ä»½çš„æ—¶å€™æŒ‡å®šlsnã€‚
â€“innodb-log-arch-dirï¼šæŒ‡å®šåŒ…å«å½’æ¡£æ—¥å¿—çš„ç›®å½•ã€‚åªèƒ½å’Œxtrabackup â€“prepareé€‰é¡¹ä¸€èµ·ä½¿ç”¨ã€‚
â€“innodb-miscellaneousï¼šä»My.cnfæ–‡ä»¶è¯»å–çš„ä¸€ç»„Innodbé€‰é¡¹ã€‚ä»¥ä¾¿xtrabackupä»¥åŒæ ·çš„é…ç½®å¯åŠ¨å†…ç½®çš„Innodbã€‚é€šå¸¸ä¸éœ€è¦æ˜¾ç¤ºæŒ‡å®šã€‚
â€“log-copy-interval=#ï¼šè¿™ä¸ªé€‰é¡¹æŒ‡å®šäº†logæ‹·è´çº¿ç¨‹checkçš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤1ç§’ï¼‰ã€‚
â€“log-streamï¼šxtrabakcupä¸æ‹·è´æ•°æ®æ–‡ä»¶ï¼Œå°†äº‹åŠ¡æ—¥å¿—å†…å®¹é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºç›´åˆ°â€“suspend-at-endæ–‡ä»¶è¢«åˆ é™¤ã€‚è¿™ä¸ªé€‰é¡¹è‡ªåŠ¨å¼€å¯â€“suspend-at-endã€‚
â€“no-defaultsï¼šä¸ä»ä»»ä½•é€‰é¡¹æ–‡ä»¶ä¸­è¯»å–ä»»ä½•é»˜è®¤é€‰é¡¹,å¿…é¡»åœ¨å‘½ä»¤è¡Œç¬¬ä¸€ä¸ªé€‰é¡¹ã€‚
â€“databases=#ï¼šæŒ‡å®šäº†éœ€è¦å¤‡ä»½çš„æ•°æ®åº“å’Œè¡¨ã€‚
â€“database-file=#ï¼šæŒ‡å®šåŒ…å«æ•°æ®åº“å’Œè¡¨çš„æ–‡ä»¶æ ¼å¼ä¸ºdatabasename1.tablename1ä¸ºä¸€ä¸ªå…ƒç´ ï¼Œä¸€ä¸ªå…ƒç´ ä¸€è¡Œã€‚
â€“parallel=#ï¼šæŒ‡å®šå¤‡ä»½æ—¶æ‹·è´å¤šä¸ªæ•°æ®æ–‡ä»¶å¹¶å‘çš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¸º1ã€‚
â€“prepareï¼šxtrabackupåœ¨ä¸€ä»½é€šè¿‡â€“backupç”Ÿæˆçš„å¤‡ä»½æ‰§è¡Œè¿˜åŸæ“ä½œï¼Œä»¥ä¾¿å‡†å¤‡ä½¿ç”¨ã€‚
â€“print-defaultï¼šæ‰“å°ç¨‹åºå‚æ•°åˆ—è¡¨å¹¶é€€å‡ºï¼Œå¿…é¡»æ”¾åœ¨å‘½ä»¤è¡Œé¦–ä½ã€‚
â€“print-paramï¼šä½¿xtrabackupæ‰“å°å‚æ•°ç”¨æ¥å°†æ•°æ®æ–‡ä»¶æ‹·è´åˆ°datadirå¹¶è¿˜åŸå®ƒä»¬ã€‚
â€“rebuild_indexesï¼šåœ¨applyäº‹åŠ¡æ—¥å¿—ä¹‹åé‡å»ºinnodbè¾…åŠ©ç´¢å¼•ï¼Œåªæœ‰å’Œâ€“prepareä¸€èµ·æ‰ç”Ÿæ•ˆã€‚
â€“rebuild_threads=#ï¼šåœ¨ç´§å‡‘å¤‡ä»½é‡å»ºè¾…åŠ©ç´¢å¼•çš„çº¿ç¨‹æ•°ï¼Œåªæœ‰å’Œâ€“prepareå’Œrebuild-indexä¸€èµ·æ‰ç”Ÿæ•ˆã€‚
â€“statsï¼šxtrabakcupæ‰«ææŒ‡å®šæ•°æ®æ–‡ä»¶å¹¶æ‰“å°å‡ºç´¢å¼•ç»Ÿè®¡ã€‚
â€“stream=nameï¼šå°†æ‰€æœ‰å¤‡ä»½æ–‡ä»¶ä»¥æŒ‡å®šæ ¼å¼æµå‘æ ‡å‡†è¾“å‡ºï¼Œç›®å‰æ”¯æŒçš„æ ¼å¼æœ‰xbstreamå’Œtarã€‚
â€“suspend-at-endï¼šä½¿xtrabackupåœ¨â€“target-dirç›®å½•ä¸­ç”Ÿæˆxtrabakcup_suspendedæ–‡ä»¶ã€‚åœ¨æ‹·è´æ•°æ®æ–‡ä»¶ä¹‹åxtrabackupä¸æ˜¯é€€å‡ºè€Œæ˜¯ç»§ç»­æ‹·è´æ—¥å¿—æ–‡ä»¶å¹¶ä¸”ç­‰å¾…çŸ¥é“xtrabakcup_suspendedæ–‡ä»¶è¢«åˆ é™¤ã€‚è¿™é¡¹å¯ä»¥ä½¿xtrabackupå’Œå…¶ä»–ç¨‹åºååŒå·¥ä½œã€‚
â€“tables=nameï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…database.tablenameã€‚å¤‡ä»½åŒ¹é…çš„è¡¨ã€‚
â€“tables-file=nameï¼šæŒ‡å®šæ–‡ä»¶ï¼Œä¸€ä¸ªè¡¨åä¸€è¡Œã€‚
â€“target-dir=DIRECTORYï¼šæŒ‡å®šbackupçš„ç›®çš„åœ°ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œxtrabakcupä¼šåˆ›å»ºã€‚å¦‚æœç›®å½•å­˜åœ¨ä¸”ä¸ºç©ºåˆ™æˆåŠŸã€‚ä¸ä¼šè¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶ã€‚
â€“throttle=#ï¼šæŒ‡å®šæ¯ç§’æ“ä½œè¯»å†™å¯¹çš„æ•°é‡ã€‚
â€“tmpdir=nameï¼šå½“ä½¿ç”¨â€“print-paramæŒ‡å®šçš„æ—¶å€™æ‰“å°å‡ºæ­£ç¡®çš„tmpdirå‚æ•°ã€‚
â€“to-archived-lsn=LSNï¼šæŒ‡å®šprepareå¤‡ä»½æ—¶applyäº‹åŠ¡æ—¥å¿—çš„LSNï¼Œåªèƒ½å’Œxtarbackup â€“prepareé€‰é¡¹ä¸€èµ·ç”¨ã€‚
â€“user-memory = #ï¼šé€šè¿‡â€“prepare prepareå¤‡ä»½æ—¶å€™åˆ†é…å¤šå¤§å†…å­˜ï¼Œç›®çš„åƒinnodb_buffer_pool_sizeã€‚é»˜è®¤å€¼100Må¦‚æœä½ æœ‰è¶³å¤Ÿå¤§çš„å†…å­˜ã€‚1-2Gæ˜¯æ¨èå€¼ï¼Œæ”¯æŒå„ç§å•ä½(1MB,1M,1GB,1G)ã€‚
â€“versionï¼šæ‰“å°xtrabackupç‰ˆæœ¬å¹¶é€€å‡ºã€‚
â€“xbstreamï¼šæ”¯æŒåŒæ—¶å‹ç¼©å’Œæµå¼åŒ–ã€‚éœ€è¦å®¢æœä¼ ç»Ÿå½’æ¡£tar,cpioå’Œå…¶ä»–ä¸å…è®¸åŠ¨æ€streamingç”Ÿæˆçš„æ–‡ä»¶çš„é™åˆ¶ï¼Œä¾‹å¦‚åŠ¨æ€å‹ç¼©æ–‡ä»¶ï¼Œxbstreamè¶…è¶Šå…¶ä»–ä¼ ç»Ÿæµå¼/å½’æ¡£æ ¼å¼çš„çš„ä¼˜ç‚¹æ˜¯ï¼Œå¹¶å‘streamå¤šä¸ªæ–‡ä»¶å¹¶ä¸”æ›´ç´§å‡‘çš„æ•°æ®å­˜å‚¨ï¼ˆæ‰€ä»¥å¯ä»¥å’Œâ€“parallelé€‰é¡¹é€‰é¡¹ä¸€èµ·ä½¿ç”¨xbstreamæ ¼å¼è¿›è¡Œstreamingï¼‰ã€‚
å¤åˆ¶ä»£ç 
xtrabackupå¤§éƒ¨åˆ†å¸¸ç”¨å‚æ•°éƒ½å’Œinnobackupexå·®ä¸å¤šï¼Œå¤§å®¶å¯ä»¥è‡ªå·±å»å®˜ç½‘ä¸Šçœ‹è¯´æ˜ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯xtrabackæ”¯æŒMyISAMçš„å¤‡ä»½ã€‚</p>

<p>åº”ç”¨åœºæ™¯ï¼š</p>

<p>â‘ .æ™®é€šå…¨é‡å¤‡ä»½ã€è¿˜åŸï¼š</p>

<p>å¤åˆ¶ä»£ç 
#å¤‡ä»½ï¼š
1ï¼šæŒ‡å®šâ€“defaults-file
xtrabackup â€“defaults-file=/etc/mysql/my.cnf â€“user=root â€“password=123  â€“backup â€“target-dir=/home/zhoujy/xtrabackup/</p>

<p>2ï¼šç”¨â€“datadirå–ä»£â€“defaults-file
xtrabackup â€“user=root â€“password=123  â€“backup â€“datadir=/var/lib/mysql/ â€“target-dir=/home/zhoujy/xtrabackup/</p>

<p>#è¿˜åŸï¼š
1ï¼š(å…³é—­mysql)å…ˆprepare
xtrabackup â€“prepare â€“target-dir=/home/zhoujy/xtrabackup/</p>

<p>2ï¼šå†copy
rsync -avrP /home/zhoujy/xtrabackup/* /var/lib/mysql/</p>

<p>3ï¼šæ”¹æƒé™ã€å¯åŠ¨
chown -R mysql.mysql *
å¤åˆ¶ä»£ç 
â‘¡.æ™®é€šå¢é‡å¤‡ä»½ã€è¿˜åŸ</p>

<p>å¤åˆ¶ä»£ç 
#å¤‡ä»½ï¼Œè¿™é‡ŒæŒ‡å®šå‡ ä¸ªåº“å’Œè¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯æ‰€æœ‰åº“
1ï¼šåº“å…¨é‡å¤‡ä»½
xtrabackup â€“user=root â€“password=123 â€“datadir=/var/lib/mysql/ â€“backup â€“parallel=3 â€“databases=â€xtra_test dba_testâ€ â€“target-dir=/home/zhoujy/xtrabackup/</p>

<p>2ï¼šå¢é‡å¤‡ä»½
xtrabackup â€“user=root â€“password=123 â€“datadir=/var/lib/mysql/ â€“backup â€“parallel=3 â€“databases=â€xtra_test dba_testâ€ â€“target-dir=/home/zhoujy/xtrabackup1/ â€“incremental-basedir=/home/zhoujy/xtrabackup/</p>

<p>æ³¨æ„ï¼šè¦æ˜¯æœ‰å¤šä¸ªå¢é‡å¤‡ä»½ï¼Œç¬¬2ä¸ªå¢é‡éœ€è¦æŒ‡å®šç¬¬ä¸€ä¸ªå¢é‡çš„ç›®å½•ã€‚å’Œinnobackupexä¸€æ ·ã€‚</p>

<p>3ï¼šè¿˜åŸ
#å…ˆprepareå…¨å¤‡
xtrabackup â€“prepare â€“apply-log-only â€“target-dir=/home/zhoujy/xtrabackup/
#å†prepareå¢é‡å¤‡ä»½
xtrabackup â€“prepare â€“apply-log-only â€“target-dir=/home/zhoujy/xtrabackup/ â€“incremental-dir=/home/zhoujy/xtrabackup1/</p>

<p>4ï¼šæœ€åprepare å…¨å¤‡
xtrabackup â€“prepare â€“target-dir=/home/zhoujy/xtrabackup/</p>

<p>5ï¼šæœ€åcopyã€æ”¹æƒé™ã€‚</p>

<p>å¦å¤–è¯´ä¸€ä¸ªæŒ‡å®šè¡¨çš„å¤‡ä»½ï¼š
å’Œinnobackupexä¸€æ ·ï¼Œç”¨â€“databases=dbname.tablenameå’Œâ€“tables-fileï¼Œä¹Ÿå¯ä»¥ç”¨â€“tablesï¼ˆâ€“includeï¼‰ï¼Œæ”¯æŒæ­£åˆ™ã€‚
å¦‚å¤‡ä»½tå¼€å¤´çš„æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨ï¼š
xtrabackup â€“user=root â€“password=123 â€“datadir=/var/lib/mysql/ â€“backup â€“parallel=3 â€“tables=â€^t[.]<em>.</em>â€ â€“target-dir=/home/zhoujy/xtrabackup/
å¤åˆ¶ä»£ç 
â‘¢.æ‰“åŒ…å‹ç¼©å¤‡ä»½ï¼Œæ³¨æ„ï¼šâ€“compressä¸èƒ½å’Œâ€“stream=tarä¸€èµ·ä½¿ç”¨</p>

<p>å¤åˆ¶ä»£ç 
##å‹ç¼©å¤‡ä»½
xtrabackup â€“user=root â€“password=123 â€“datadir=/var/lib/mysql/ â€“backup â€“parallel=3 â€“compress â€“compress-threads=5 â€“databases=â€xtra_test dba_testâ€ â€“target-dir=/home/zhoujy/xtrabackup/</p>

<p>#è§£å‹ï¼Œåœ¨perpareä¹‹å‰éœ€è¦å®‰è£…qpress
for f in <code class="language-plaintext highlighter-rouge">find ./ -iname "*\.qp"</code>; do qpress -dT2 $f  $(dirname $f) &amp;&amp; rm -f $f; done</p>

<p>#prepare
xtrabackup â€“prepare â€“target-dir=/home/zhoujy/xtrabackup/</p>

<p>#copyï¼Œæ”¹æƒé™</p>

<p>##æ‰“åŒ…å¤‡ä»½ï¼Œcompressä¸æ”¯æŒtarã€‚
xtrabackup â€“user=root â€“password=123 â€“datadir=/var/lib/mysql/ â€“backup â€“parallel=3 â€“compress â€“compress-threads=5 â€“stream=xbstream â€“target-dir=/home/zhoujy/xtrabackup/ &gt;/home/zhoujy/xtrabackup/alldb.xbstream</p>

<p>#è§£åŒ…
xbstream -x &lt; alldb.xbstream</p>

<p>#è§£å‹
for f in <code class="language-plaintext highlighter-rouge">find ./ -iname "*\.qp"</code>; do qpress -dT2 $f  $(dirname $f) &amp;&amp; rm -f $f; done</p>

<p>#prepare
xtrabackup â€“prepare â€“target-dir=/home/zhoujy/xtrabackup</p>

<p>#copyï¼Œæ”¹æƒé™</p>

<p>##ç¬¬ä¸‰æ–¹å‹ç¼©å¤‡ä»½ï¼š
 xtrabackup â€“user=root â€“password=123 â€“datadir=/var/lib/mysql/ â€“backup â€“parallel=3 â€“stream=tar â€“target-dir=/home/zhoujy/xtrabackup/ | gzip /home/zhoujy/xtrabackup/alldb.tar.gz</p>

<p>#è§£å‹ï¼š
tar izxvf alldb.tar.gz</p>

<p>#prepare
xtrabackup â€“prepare â€“target-dir=/home/zhoujy/xtrabackup</p>

<p>#copyï¼Œæ”¹æƒé™
å¤åˆ¶ä»£ç 
â‘£.åŠ å¯†å¤‡ä»½</p>

<p>å¤åˆ¶ä»£ç 
#å‹ç¼©åŠ å¯†å…¨é‡å¤‡ä»½æ‰€æœ‰æ•°æ®åº“
1ï¼šç”ŸæˆåŠ å¯†keyï¼š
openssl rand -base64 24
æŠŠKeyå†™åˆ°æ–‡ä»¶ï¼š
echo -n â€œUe2Wp6dIDWszpI76HQ1u57exyjAdHpROâ€ &gt; keyfile 
2ï¼šå‹ç¼©åŠ å¯†å…¨é‡å¤‡ä»½
xtrabackup â€“user=root â€“password=123 â€“datadir=/var/lib/mysql/ â€“backup â€“no-timestamp â€“compress â€“compress-threads=3 â€“encrypt=AES256 â€“encrypt-key-file=/home/zhoujy/keyfile â€”-encrypt-threads=3 â€“parallel=5 â€“target-dir=/home/zhoujy/xtrabackup/</p>

<p>#è¿˜åŸ
1ï¼šè§£å¯†
for i in <code class="language-plaintext highlighter-rouge">find . -iname "*\.xbcrypt"</code>; do xbcrypt -d â€“encrypt-key-file=/home/zhoujy/keyfile â€“encrypt-algo=AES256 &lt; $i &gt; $(dirname $i)/$(basename $i .xbcrypt) &amp;&amp; rm $i; done</p>

<p>2ï¼šè§£å‹
for f in <code class="language-plaintext highlighter-rouge">find ./ -iname "*\.qp"</code>; do qpress -dT2 $f  $(dirname $f) &amp;&amp; rm -f $f; done</p>

<p>3ï¼šprepare
xtrabackup â€“prepare â€“target-dir=/home/zhoujy/xtrabackup/</p>

<p>4ï¼šcopyï¼Œæ”¹æƒé™
rsync -avrP /home/zhoujy/xtrabackup/* /var/lib/mysql/
chown -R mysql.mysql *
å¤åˆ¶ä»£ç 
â‘¤.å¤åˆ¶ç¯å¢ƒä¸­çš„å¤‡ä»½ï¼šä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸»ä»æ¨¡å¼ï¼Œä¸»æä¾›æœåŠ¡ï¼Œä»æä¾›å¤‡ä»½ã€‚</p>

<p>å¤åˆ¶ä»£ç 
è¯´æ˜ï¼šå¤‡ä»½ 5ä¸ªçº¿ç¨‹å¤‡ä»½2ä¸ªæ•°æ®åº“ï¼Œå¹¶ä¸”æ–‡ä»¶xtrabackup_slave_infoè®°å½•GTIDå’Œchangeçš„ä¿¡æ¯
#å¤‡ä»½
xtrabackup â€“user=root â€“password=123 â€“datadir=/var/lib/mysql/ â€“backup â€“no-timestamp â€“slave-info â€“safe-slave-backup â€“parallel=5 â€“databases=â€™xtra_test dba_testâ€™ â€“target-dir=/home/zhoujy/xtrabackup/</p>

<p>#è¿˜åŸ
1ï¼šprepare
xtrabackup â€“prepare â€“target-dir=/home/zhoujy/xtrabackup/</p>

<p>2ï¼šcopyï¼Œæ”¹æƒé™
å¤åˆ¶ä»£ç 
æ€»ç»“ï¼šå…³äºæ›´å¤šçš„innobackupexçš„å¤‡ä»½å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£å’Œxtrabackup å®‰è£…ä½¿ç”¨ï¼Œå‚æ•°å¯ä»¥å‚è€ƒæœ¬æ–‡ä¸Šé¢çš„ä»‹ç»è¯´æ˜ï¼Œé€šè¿‡ä¸Šé¢çš„å‡ ä¸ªè¯´æ˜çœ‹åˆ°xtrabackupå¯ä»¥å®ç°ï¼šå…¨é‡ã€å¢é‡ã€å‹ç¼©ã€æ‰“åŒ…ã€åŠ å¯†å¤‡ä»½ï¼Œå¹¶ä¸”æ”¯æŒå¤šçº¿ç¨‹çš„å¤‡ä»½ï¼Œå¹¶ä¸”ä¹Ÿæä¾›äº†é•¿æŸ¥è¯¢è¶…è¿‡é˜€å€¼è‡ªåŠ¨killçš„æ–¹æ³•ï¼Œå¤§å¤§æå‡å¤‡ä»½æ•ˆç‡ã€‚</p>

<p>æœ€åï¼Œæ˜ç™½Percona XtraBackupå¤‡ä»½çš„åŸç†ä¹‹åï¼Œæ ¹æ®è‡ªå·±å¤‡ä»½åœºæ™¯çš„ç‰¹ç‚¹ï¼Œé€‰æ‹©åˆç†çš„å‚æ•°ï¼Œå®šåˆ¶é€‚åˆè‡ªå·±éœ€æ±‚çš„å¤‡ä»½è„šæœ¬è¿›è¡Œå·¥ä½œã€‚xtrabackupæ˜¯ä¸€ç§ç‰©ç†å¤‡ä»½å·¥å…·ï¼Œé€šè¿‡åè®®è¿æ¥åˆ°mysqlæœåŠ¡ç«¯ï¼Œç„¶åè¯»å–å¹¶å¤åˆ¶innodbåº•å±‚çš„â€æ•°æ®å—â€ï¼Œå®Œæˆæ‰€è°“çš„â€ç‰©ç†å¤‡ä»½â€ã€‚</p>

<p>æ”¯æŒå¯¹innodbè¿›è¡Œçƒ­å¤‡ã€å¢é‡å¤‡ä»½ã€å·®é‡å¤‡ä»½ã€‚</p>

<p>æ”¯æŒå¯¹myisamè¿›è¡Œæ¸©å¤‡ï¼Œå› ä¸ºåœ¨å¤‡ä»½myisamè¡¨æ—¶ï¼Œä¼šå¯¹myisamè¡¨æ·»åŠ è¯»é”ï¼Œè€Œä¸”ä¸èƒ½å¯¹myisamè¡¨è¿›è¡Œå¢é‡å¤‡ä»½ï¼Œæ¯æ¬¡å¤‡ä»½myisamæ•°æ®éƒ½æ˜¯å…¨é‡ï¼Œå³ä½¿åä¹‰ä¸Šæ˜¯å¢é‡ï¼Œä½†æ˜¯å®é™…ä¸Šä»ç„¶æ˜¯å…¨é‡ã€‚
æ‰©å±•ç†è§£ï¼š</p>

<p>æ•°æ®å­˜æ”¾äºrowä¸­ï¼Œrowå­˜åœ¨äºpageä¸­ï¼Œpageå­˜äºextentä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¤‡ä»½extentä¸­çš„pageï¼ˆpageæ˜¯innodbå¼•æ“çš„æœ€å°ç‰©ç†å­˜å‚¨åˆ†é…å•ä½ï¼‰ï¼Œå³å¯å¤‡ä»½å‡ºå¯¹åº”çš„æ•°æ®ã€‚</p>

<p>Xtrabackupæ˜¯ç”±Perconaå¼€å‘çš„ä¸€ä¸ªå¼€æºè½¯ä»¶,å¯å®ç°å¯¹InnoDBçš„æ•°æ®å¤‡ä»½,æ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½(å¤‡ä»½æ—¶ä¸å½±å“æ•°æ®è¯»å†™),ç‰¹ç‚¹å¦‚ä¸‹:1.å¤‡ä»½è¿‡ç¨‹å¿«é€Ÿã€å¯é ;2.å¤‡ä»½è¿‡ç¨‹ä¸ä¼šæ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡;3.èƒ½å¤ŸåŸºäºå‹ç¼©ç­‰åŠŸèƒ½èŠ‚çº¦ç£ç›˜ç©ºé—´å’Œæµé‡;4.è‡ªåŠ¨å®ç°å¤‡ä»½æ£€éªŒ;5.è¿˜åŸé€Ÿåº¦å¿«;XtraBackupæœ‰ä¸¤ä¸ªå·¥å…·:xtrabackupå’Œinnobackupex:1.xtrabackupæœ¬èº«åªèƒ½å¤‡ä»½InnoDBå’ŒXtraDB,ä¸èƒ½å¤‡ä»½MyISAM;2.innobackupexæœ¬èº«æ˜¯
Xtrabackupæ˜¯ç”± Percona å¼€å‘çš„ä¸€ä¸ªå¼€æºè½¯ä»¶,å¯å®ç°å¯¹ InnoDB çš„æ•°æ®å¤‡ä»½,æ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½(å¤‡ä»½æ—¶ä¸å½±å“æ•°æ®è¯»å†™),ç‰¹ç‚¹å¦‚ä¸‹:</p>

<p>1.å¤‡ä»½è¿‡ç¨‹å¿«é€Ÿã€å¯é ;</p>

<p>2.å¤‡ä»½è¿‡ç¨‹ä¸ä¼šæ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡;</p>

<p>3.èƒ½å¤ŸåŸºäºå‹ç¼©ç­‰åŠŸèƒ½èŠ‚çº¦ç£ç›˜ç©ºé—´å’Œæµé‡;</p>

<p>4.è‡ªåŠ¨å®ç°å¤‡ä»½æ£€éªŒ;</p>

<p>5.è¿˜åŸé€Ÿåº¦å¿«;</p>

<p>XtraBackup æœ‰ä¸¤ä¸ªå·¥å…·:xtrabackup å’Œ innobackupex:</p>

<p>1.xtrabackup æœ¬èº«åªèƒ½å¤‡ä»½ InnoDB å’Œ XtraDB ,ä¸èƒ½å¤‡ä»½ MyISAM;</p>

<p>2.innobackupex æœ¬èº«æ˜¯ Hot Backup è„šæœ¬ä¿®æ”¹è€Œæ¥,åŒæ—¶å¯ä»¥å¤‡ä»½ MyISAM å’Œ InnoDB,ä½†æ˜¯å¤‡ä»½ MyISAM éœ€è¦åŠ è¯»é”ã€‚</p>

<p>å®˜ç½‘: http://www.percona.com/software/percona-xtrabackup</p>

<p>æ–‡æ¡£: http://www.percona.com/doc/percona-xtrabackup/2.4/index.html</p>

<p>ä¸­æ–‡ç¿»è¯‘æ–‡æ¡£:Percona XtraBackup User Manual é˜…è¯»ç¬”è®°</p>

<p>ä¸€ã€InnoDBçš„å¤‡ä»½åŸç†</p>

<p>åœ¨InnoDBå†…éƒ¨ä¼šç»´æŠ¤ä¸€ä¸ªredoæ—¥å¿—æ–‡ä»¶,æˆ‘ä»¬ä¹Ÿå¯ä»¥å«åšäº‹åŠ¡æ—¥å¿—æ–‡ä»¶ã€‚äº‹åŠ¡æ—¥å¿—ä¼šå­˜å‚¨æ¯ä¸€ä¸ªInnoDBè¡¨æ•°æ®çš„è®°å½•ä¿®æ”¹ã€‚å½“InnoDBå¯åŠ¨æ—¶,InnoDBä¼šæ£€æŸ¥æ•°æ®æ–‡ä»¶å’Œäº‹åŠ¡æ—¥å¿—,å¹¶æ‰§è¡Œä¸¤ä¸ªæ­¥éª¤:å®ƒåº”ç”¨(å‰æ»š)å·²ç»æäº¤çš„äº‹åŠ¡æ—¥å¿—åˆ°æ•°æ®æ–‡ä»¶,å¹¶å°†ä¿®æ”¹è¿‡ä½†æ²¡æœ‰æäº¤çš„æ•°æ®è¿›è¡Œå›æ»šæ“ä½œã€‚</p>

<p>å¤‡ä»½è¿‡ç¨‹</p>

<p>Xtrabackupåœ¨å¯åŠ¨æ—¶ä¼šè®°ä½log sequence number(LSN),å¹¶ä¸”å¤åˆ¶æ‰€æœ‰çš„æ•°æ®æ–‡ä»¶ã€‚å¤åˆ¶è¿‡ç¨‹éœ€è¦ä¸€äº›æ—¶é—´,æ‰€ä»¥è¿™æœŸé—´å¦‚æœæ•°æ®æ–‡ä»¶æœ‰æ”¹åŠ¨,é‚£ä¹ˆå°†ä¼šä½¿æ•°æ®åº“å¤„äºä¸€ä¸ªä¸åŒçš„æ—¶é—´ç‚¹ã€‚è¿™æ—¶,xtrabackupä¼šè¿è¡Œä¸€ä¸ªåå°è¿›ç¨‹,ç”¨äºç›‘è§†äº‹åŠ¡æ—¥å¿—,å¹¶ä»äº‹åŠ¡æ—¥å¿—å¤åˆ¶æœ€æ–°çš„ä¿®æ”¹ã€‚Xtrabackupå¿…é¡»æŒç»­çš„åšè¿™ä¸ªæ“ä½œ,æ˜¯å› ä¸ºäº‹åŠ¡æ—¥å¿—æ˜¯ä¼šè½®è½¬é‡å¤çš„å†™å…¥,å¹¶ä¸”äº‹åŠ¡æ—¥å¿—å¯ä»¥è¢«é‡ç”¨ã€‚æ‰€ä»¥xtrabackupè‡ªå¯åŠ¨å¼€å§‹,å°±ä¸åœçš„å°†äº‹åŠ¡æ—¥å¿—ä¸­æ¯ä¸ªæ•°æ®æ–‡ä»¶çš„ä¿®æ”¹éƒ½è®°å½•ä¸‹æ¥ã€‚</p>

<p>å‡†å¤‡è¿‡ç¨‹</p>

<p>ä¸Šé¢å°±æ˜¯xtrabackupçš„å¤‡ä»½è¿‡ç¨‹ã€‚æ¥ä¸‹æ¥æ˜¯å‡†å¤‡(prepare)è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­,xtrabackupä½¿ç”¨ä¹‹å‰å¤åˆ¶çš„äº‹åŠ¡æ—¥å¿—,å¯¹å„ä¸ªæ•°æ®æ–‡ä»¶æ‰§è¡Œç¾éš¾æ¢å¤(å°±åƒmysqlåˆšå¯åŠ¨æ—¶è¦åšçš„ä¸€æ ·)ã€‚å½“è¿™ä¸ªè¿‡ç¨‹ç»“æŸå,æ•°æ®åº“å°±å¯ä»¥åšæ¢å¤è¿˜åŸäº†ã€‚</p>

<p>äºŒã€MyISAMçš„å¤‡ä»½åŸç†</p>

<p>ä»¥ä¸Šçš„è¿‡ç¨‹åœ¨xtrabackupçš„ç¼–è¯‘äºŒè¿›åˆ¶ç¨‹åºä¸­å®ç°ã€‚ç¨‹åºinnobackupexå¯ä»¥å…è®¸æˆ‘ä»¬å¤‡ä»½MyISAMè¡¨å’Œfrmæ–‡ä»¶ä»è€Œå¢åŠ äº†ä¾¿æ·å’ŒåŠŸèƒ½ã€‚Innobackupexä¼šå¯åŠ¨xtrabackup,ç›´åˆ°xtrabackupå¤åˆ¶æ•°æ®æ–‡ä»¶å,ç„¶åæ‰§è¡ŒFLUSH TABLES WITH READ LOCKæ¥é˜»æ­¢æ–°çš„å†™å…¥è¿›æ¥å¹¶æŠŠMyISAMè¡¨æ•°æ®åˆ·åˆ°ç¡¬ç›˜ä¸Š,ä¹‹åå¤åˆ¶MyISAMæ•°æ®æ–‡ä»¶,æœ€åé‡Šæ”¾é”ã€‚</p>

<p>å¤‡ä»½MyISAMå’ŒInnoDBè¡¨æœ€ç»ˆä¼šå¤„äºä¸€è‡´,åœ¨å‡†å¤‡(prepare)è¿‡ç¨‹ç»“æŸå,InnoDBè¡¨æ•°æ®å·²ç»å‰æ»šåˆ°æ•´ä¸ªå¤‡ä»½ç»“æŸçš„ç‚¹,è€Œä¸æ˜¯å›æ»šåˆ°xtrabackupåˆšå¼€å§‹æ—¶çš„ç‚¹ã€‚è¿™ä¸ªæ—¶é—´ç‚¹ä¸æ‰§è¡ŒFLUSH TABLES WITH READ LOCKçš„æ—¶é—´ç‚¹ç›¸åŒ,æ‰€ä»¥myisamè¡¨æ•°æ®ä¸InnoDBè¡¨æ•°æ®æ˜¯åŒæ­¥çš„ã€‚ç±»ä¼¼Oracleçš„,InnoDBçš„prepareè¿‡ç¨‹å¯ä»¥ç§°ä¸ºrecover(æ¢å¤),myisamçš„æ•°æ®å¤åˆ¶è¿‡ç¨‹å¯ä»¥ç§°ä¸ºrestore(è¿˜åŸ)ã€‚</p>

<p>Xtrabackupå’Œinnobackupexè¿™ä¸¤ä¸ªå·¥å…·éƒ½æä¾›äº†è®¸å¤šå‰æ–‡æ²¡æœ‰æåˆ°çš„åŠŸèƒ½ç‰¹ç‚¹ã€‚æ‰‹å†Œä¸Šæœ‰å¯¹å„ä¸ªåŠŸèƒ½éƒ½æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚ç®€å•ä»‹ç»ä¸‹,è¿™äº›å·¥å…·æä¾›äº†å¦‚æµ(streaming)å¤‡ä»½,å¢é‡(incremental)å¤‡ä»½ç­‰,é€šè¿‡å¤åˆ¶æ•°æ®æ–‡ä»¶,å¤åˆ¶æ—¥å¿—æ–‡ä»¶å’Œæäº¤æ—¥å¿—åˆ°æ•°æ®æ–‡ä»¶(å‰æ»š)å®ç°äº†å„ç§å¤åˆå¤‡ä»½æ–¹å¼ã€‚</p>
:ET