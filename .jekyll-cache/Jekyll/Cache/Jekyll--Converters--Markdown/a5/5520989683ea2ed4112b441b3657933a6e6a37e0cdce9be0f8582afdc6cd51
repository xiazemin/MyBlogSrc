I"±<p>ã€€è¿™ä¸¤ä¸ªå‡½æ•°æˆ–è€…è¿”å›ä¸æŸä¸ªå¥—æ¥å­—å…³è”çš„æœ¬åœ°åè®®åœ°å€ï¼ˆgetsocknameï¼‰ï¼Œæˆ–è€…è¿”å›ä¸æŸä¸ªå¥—æ¥å­—å…³è”çš„å¤–åœ°åè®®åœ°å€å³å¾—åˆ°å¯¹æ–¹çš„åœ°å€ï¼ˆgetpeernameï¼‰ã€‚
#include &lt;sys/socket.h&gt;</p>

<p>int getsockname(int sockfd,struct sockaddr* localaddr,socklen_t <em>addrlen);
int getpeername(int sockfd,struct sockaddr</em> peeraddr,socklen_t *addrlen);
å‡è¿”å›ï¼šè‹¥æˆåŠŸåˆ™ä¸º0ï¼Œå¤±è´¥åˆ™ä¸º-1
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€
getsocknameå¯ä»¥è·å¾—ä¸€ä¸ªä¸socketç›¸å…³çš„åœ°å€ï¼ŒæœåŠ¡å™¨ç«¯å¯ä»¥é€šè¿‡å®ƒå¾—åˆ°ç›¸å…³å®¢æˆ·ç«¯åœ°å€ï¼Œè€Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥å¾—åˆ°å½“å‰å·²è¿æ¥æˆåŠŸçš„socketçš„ipå’Œç«¯å£ã€‚</p>

<p>ç¬¬äºŒç§æƒ…å†µåœ¨å®¢æˆ·ç«¯ä¸è¿›è¡Œbindè€Œç›´æ¥è¿æ¥æœåŠ¡å™¨æ—¶ï¼Œè€Œä¸”å®¢æˆ·ç«¯éœ€è¦çŸ¥é“å½“å‰ä½¿ç”¨å“ªä¸ªipè¿›è¡Œé€šä¿¡æ—¶æ¯”è¾ƒæœ‰ç”¨ï¼ˆå¦‚å¤šç½‘å¡çš„æƒ…å†µï¼‰
<!-- more -->
getpeernameåªæœ‰åœ¨è¿æ¥å»ºç«‹ä»¥åæ‰è°ƒç”¨ï¼Œå¦åˆ™ä¸èƒ½æ­£ç¡®è·å¾—å¯¹æ–¹åœ°å€å’Œç«¯å£ï¼Œæ‰€ä»¥å®ƒçš„å‚æ•°æè¿°å­—ä¸€èˆ¬æ˜¯å·²è¿æ¥æè¿°å­—è€Œéç›‘å¬å¥—æ¥å£æè¿°å­—ã€‚
    æ²¡æœ‰è¿æ¥çš„UDPä¸èƒ½è°ƒç”¨getpeernameï¼Œä½†æ˜¯å¯ä»¥è°ƒç”¨getsocknameå’ŒTCPä¸€æ ·ï¼Œå®ƒçš„åœ°å€å’Œç«¯å£ä¸æ˜¯åœ¨è°ƒç”¨socketå°±æŒ‡å®šäº†ï¼Œè€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨sendtoå‡½æ•°ä»¥åã€‚
    å·²ç»è¿æ¥çš„UDPï¼Œåœ¨è°ƒç”¨connectä»¥åï¼Œè¿™2ä¸ªå‡½æ•°ï¼ˆgetsocknameï¼Œgetpeernameï¼‰éƒ½æ˜¯å¯ä»¥ç”¨çš„ã€‚ä½†æ˜¯è¿™æ—¶æ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºå·²ç»è¿æ¥ï¼ˆconnectï¼‰çš„UDPå·²ç»çŸ¥é“å¯¹æ–¹çš„åœ°å€ã€‚</p>

<p>ã€€ã€€éœ€è¦è¿™ä¸¤ä¸ªå‡½æ•°çš„ç†ç”±å¦‚ä¸‹ï¼š</p>

<p>ã€€åœ¨ä¸€ä¸ªæ²¡æœ‰è°ƒç”¨bindçš„TCPå®¢æˆ·ä¸Šï¼ŒconnectæˆåŠŸè¿”å›åï¼Œgetsocknameç”¨äºè¿”å›ç”±å†…æ ¸èµ‹äºˆè¯¥è¿æ¥çš„æœ¬åœ°IPåœ°å€å’Œæœ¬åœ°ç«¯å£å·ã€‚</p>

<p>ã€€åœ¨ä»¥ç«¯å£å·ä¸º0è°ƒç”¨bindï¼ˆå‘ŠçŸ¥å†…æ ¸å»é€‰æ‹©æœ¬åœ°ä¸´æ—¶ç«¯å£å·ï¼‰åï¼Œgetsocknameç”¨äºè¿”å›ç”±å†…æ ¸èµ‹äºˆçš„æœ¬åœ°ç«¯å£å·ã€‚</p>

<p>ã€€åœ¨ä¸€ä¸ªä»¥é€šé…IPåœ°å€è°ƒç”¨bindçš„TCPæœåŠ¡å™¨ä¸Šï¼Œä¸æŸä¸ªå®¢æˆ·çš„è¿æ¥ä¸€æ—¦å»ºç«‹ï¼ˆacceptæˆåŠŸè¿”å›ï¼‰ï¼Œgetsocknameå°±å¯ä»¥ç”¨äºè¿”å›ç”±å†…æ ¸èµ‹äºˆè¯¥è¿æ¥çš„æœ¬åœ°IPåœ°å€ã€‚åœ¨è¿™æ ·çš„è°ƒç”¨ä¸­ï¼Œå¥—æ¥å­—æè¿°ç¬¦å‚æ•°å¿…é¡»æ˜¯å·²è¿æ¥å¥—æ¥å­—çš„æè¿°ç¬¦ï¼Œè€Œä¸æ˜¯ç›‘å¬å¥—æ¥å­—çš„æè¿°ç¬¦ã€‚</p>

<p>ã€€å½“ä¸€ä¸ªæœåŠ¡å™¨çš„æ˜¯ç”±è°ƒç”¨è¿‡acceptçš„æŸä¸ªè¿›ç¨‹é€šè¿‡è°ƒç”¨execæ‰§è¡Œç¨‹åºæ—¶ï¼Œå®ƒèƒ½å¤Ÿè·å–å®¢æˆ·èº«ä»½çš„å”¯ä¸€é€”å¾„ä¾¿æ˜¯è°ƒç”¨getpeernameã€‚
ã€€
è·å–è¯¥å€¼æœ‰ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•ï¼š</p>

<p>ã€€ã€€è°ƒç”¨execçš„è¿›ç¨‹å¯ä»¥æŠŠè¿™ä¸ªæè¿°ç¬¦æ ¼å¼åŒ–æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå†æŠŠå®ƒä½œä¸ºä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ä¼ é€’ç»™æ–°ç¨‹åºã€‚</p>

<p>ã€€ã€€çº¦å®šåœ¨è°ƒç”¨execä¹‹å‰ï¼Œæ€»æ˜¯æŠŠæŸä¸ªç‰¹å®šæè¿°ç¬¦ç½®ä¸ºæ‰€æ¥å—çš„å·²è¿æ¥å¥—æ¥å­—çš„æè¿°ç¬¦ã€‚</p>

<p>ã€€ã€€inetdé‡‡ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹æ³•ï¼Œå®ƒæ€»æ˜¯æŠŠæè¿°ç¬¦0ã€1ã€2ç½®ä¸ºæ‰€æ¥å—çš„å·²è¿æ¥å¥—æ¥å­—çš„æè¿°ç¬¦ï¼ˆå³å°†å·²è¿æ¥å¥—æ¥å­—æè¿°ç¬¦dupåˆ°æè¿°ç¬¦0ã€1ã€2ï¼Œç„¶åcloseåŸè¿æ¥å¥—æ¥å­—ï¼‰ã€‚
ã€€ã€€
#include â€œunp.hâ€
int main(int argc, char ** argv)
{ 
ã€€ã€€int listenfd,connfd; 
ã€€ã€€struct sockaddr_in servaddr; 
ã€€ã€€pid_t pid; char temp[20]; 
ã€€ã€€listenfd = Socket(AF_INET, SOCK_STREAM, 0);</p>

<p>ã€€ã€€bzero(&amp;servaddr, sizeof(servaddr)); 
ã€€ã€€servaddr.sin_family = AF_INET; 
ã€€ã€€servaddr.sin_addr.s_addr = htonl(INADDR_ANY); 
ã€€ã€€servaddr.sin_port = htons(10010); 
ã€€ã€€
ã€€ã€€Bind(listenfd, (SA *)&amp;servaddr, sizeof(servaddr));</p>

<p>ã€€ã€€Listen(listenfd, LISTENQ); 
ã€€ã€€
ã€€ã€€for( ; ; ) 
ã€€ã€€{ 
ã€€ã€€ã€€ã€€struct sockaddr_in local; 
ã€€ã€€ã€€ã€€connfd = Accept(listenfd, (SA *)NULL, NULL); 
ã€€ã€€ã€€ã€€if((pid = fork()) == 0) 
ã€€ã€€ã€€ã€€{ 
ã€€ã€€ã€€ã€€ã€€ã€€Close(listenfd);
ã€€ã€€ã€€ã€€ã€€ã€€struct sockaddr_in serv, guest; 
ã€€ã€€ã€€ã€€ã€€ã€€char serv_ip[20]; 
ã€€ã€€ã€€ã€€ã€€ã€€char guest_ip[20]; 
ã€€ã€€ã€€ã€€ã€€ã€€socklen_t serv_len = sizeof(serv); 
ã€€ã€€ã€€ã€€ã€€ã€€socklen_t guest_len = sizeof(guest); 
ã€€ã€€ã€€ã€€ã€€ã€€getsockname(connfd, (struct sockaddr *)&amp;serv, &amp;serv_len); 
ã€€ã€€ã€€ã€€ã€€ã€€getpeername(connfd, (struct sockaddr *)&amp;guest, &amp;guest_len); 
ã€€ã€€ã€€ã€€ã€€ã€€Inet_ntop(AF_INET, &amp;serv.sin_addr, serv_ip, sizeof(serv_ip)); 
ã€€ã€€ã€€ã€€ã€€ã€€Inet_ntop(AF_INET, &amp;guest.sin_addr, guest_ip, sizeof(guest_ip)); 
ã€€ã€€ã€€ã€€ã€€ã€€printf(â€œhost %s:%d guest %s:%dnâ€, serv_ip, ntohs(serv.sin_port), guest_ip, ntohs(guest.sin_port)); 
ã€€ã€€ã€€ã€€ã€€ã€€char buf[] = â€œhello worldâ€; 
ã€€ã€€ã€€ã€€ã€€ã€€Write(connfd, buf, strlen(buf)); 
ã€€ã€€ã€€ã€€ã€€ã€€Close(connfd); exit(0);
 ã€€ã€€ã€€ã€€} 
ã€€ã€€ã€€ã€€Close(connfd); 
ã€€ã€€} 
}</p>

<p>#include <winsock.h>
int PASCAL FAR getsockname( SOCKET s, struct sockaddr FAR* name,
int FAR* namelen);
sï¼šæ ‡è¯†ä¸€ä¸ªå·²æ†ç»‘å¥—æ¥å£çš„æè¿°å­—ã€‚
nameï¼šæ¥æ”¶å¥—æ¥å£çš„åœ°å€ï¼ˆåå­—ï¼‰ã€‚
namelenï¼šåå­—ç¼“å†²åŒºé•¿åº¦ã€‚</winsock.h></p>

:ET