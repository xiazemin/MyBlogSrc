I"Û<p>Zebraæ˜¯ä¸€ä¸ªè·¯ç”±è½¯ä»¶åŒ…ï¼Œæä¾›åŸºäºTCP/IPè·¯ç”±æœåŠ¡ï¼Œæ”¯æŒRIPv1, RIPv2, RIPng, OSPFv2, OSPFv3, BGP- 4,</p>

<p>å’Œ BGP-4+ç­‰ä¼—å¤šè·¯ç”±åè®®ã€‚Zebraè¿˜æ”¯æŒBGPç‰¹æ€§è·¯ç”±åå°„å™¨ï¼ˆRoute Reflectorï¼‰ã€‚é™¤äº†ä¼ ç»Ÿçš„ IPv4è·¯ç”±åè®®</p>

<p>ï¼ŒZebraä¹Ÿæ”¯æŒIPv6è·¯ç”±åè®®ã€‚å¦‚æœè¿è¡Œçš„SNMPå®ˆæŠ¤è¿›ç¨‹ï¼ˆéœ€è¦ucd-snmpï¼‰æ”¯æŒSMUXå è®®ï¼ŒZebraè¿˜èƒ½æ”¯æŒè·¯ç”±</p>

<p>åè®®MIBsã€‚</p>

<p>ç”±ä»¥ä¸Šå¯è§ï¼ŒZebraçš„ç¡®æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„è·¯ç”±ç³»ç»Ÿï¼Œä½†æ¯”èµ·çœŸæ­£çš„è·¯ç”±å™¨å°±ç®€ç›´æ˜¯å°å„¿ç§‘ï¼Œæ‰€ä»¥ç½‘ç»œé«˜æ‰‹ å°±å½“</p>

<p>è¿™æ–‡ç« æ˜¯å°å­©å­è¿‡å®¶å®¶å§ï¼Œè€Œå¯¹äºè±¡æˆ‘è¿™æ ·çš„åˆå­¦è€…ï¼ˆç‰¹åˆ«æ˜¯æ²¡æœ‰çœŸå®è®¾å¤‡æˆ–è¶³å¤Ÿè®¾å¤‡è¿›è¡Œå®éªŒï¼‰ ä¹Ÿä¸å¤±ä¸ºä¸€</p>

<p>ä¸ªå­¦ä¹ å’Œç†Ÿæ‚‰è·¯ç”±é…ç½®ã€è·¯ç”±åè®®çš„å¥½å·¥å…·ã€‚æˆ‘æ²¡æœ‰å®é™…çš„é…ç½®ç»éªŒï¼Œå¯¹è·¯ç”±çš„æŠ€æœ¯ç»†èŠ‚ä¹Ÿ ä¸æ˜¯ååˆ†æ¸…æ™°ï¼Œå®Œ</p>

<p>å…¨æ˜¯åœ¨æ‰”ç ´ç –å¤´ã€‚å¸Œæœ›è·¯ç”±é«˜æ‰‹æŒ‡æ­£æ¦‚å¿µé”™è¯¯ã€‚</p>

<p>å®‰è£…</p>

<p>Zebraç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯0.92aï¼Œå®ƒçš„å®‰è£…éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€ä»http://www.zebra.org/ä¸‹è½½zebra-</p>

<p>0.92a.tar.gzï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼ˆæœ¬æ–‡ç¯å¢ƒæ˜¯RedHat7.2ï¼‰ï¼š</p>

<p>shell&gt; tar xzf zebra-0.92a.tar.gz
shell&gt; cd zebra-0.92a
shell&gt; ./configure
shell&gt; make
shell&gt; make install</p>

<p>è¿™æ ·Zebraå°±å®‰è£…å¥½äº†ï¼Œå®‰è£…çš„æ‰§è¡Œæ–‡ä»¶ï¼š</p>

<p>shell&gt; ls /usr/local/sbin
bgpd  ospfd  ripd  zebra</p>

<p>é…ç½®æ–‡ä»¶ï¼š</p>

<p>shell&gt; ls /usr/local/etc
bgpd.conf.sample   ospfd.conf.sample  zebra.conf.sample
bgpd.conf.sample2  ripd.conf.sample</p>

<p>è¿è¡Œ</p>

<p>ç¼–è¯‘å®‰è£…å®ŒZebraåï¼Œå¯ä»¥çœ‹åˆ°æœ‰4ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å’Œ5ä¸ªé…ç½®æ ·æœ¬æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨å®ƒçš„é…ç½®æ ·æœ¬æ–‡ä»¶ï¼š</p>

<p>shell&gt; cd /usr/local/etc
shell&gt; cp zebra.conf.sample zebra.conf</p>

<p>Zebraçš„å„è¿›ç¨‹æœ‰å„è‡ªçš„ç»ˆç«¯æ¥å£æˆ–VTYï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ç»™è¿æ¥åˆ°å®ƒä»¬çš„ç«¯å£è®¾ç½®åˆ«åçš„è¯ï¼Œåœ¨/etc/ services</p>

<p>æ–‡ä»¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>

<p>zebrasrv      2600/tcp   # zebra service
zebra         2601/tcp   # zebra vty
ripd          2602/tcp   # RIPd vty
ripngd        2603/tcp   # RIPngd vty
ospfd         2604/tcp   # OSPFd vty
bgpd          2605/tcp   # BGPd vty
ospf6d        2606/tcp   # OSPF6d vty</p>

<p>ç„¶åå°±å¯ä»¥å¯åŠ¨Zebraäº†ï¼š</p>

<p>shell&gt; zebra -d</p>

<p>è¿™æ ·ï¼ŒZebraå°±ä»¥å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨äº†ï¼Œå…¶å®ƒçš„å‚æ•°è¯·å‚è€ƒzebra -hã€‚</p>

<p>åŸºæœ¬è·¯ç”±é…ç½®å‘½ä»¤</p>

<p>ç›´æ¥ç”¨telnetè¿æ¥ï¼š</p>

<p>shell&gt; telnet localhost 2601
Trying 127.0.0.1â€¦
Connected to localhost.
Escape character is â€˜^]â€™.</p>

<p>Hello, this is zebra (version 0.92a).
Copyright 1996-2001 Kunihiro Ishiguro.</p>

<p>User Access Verification</p>

<p>Password:</p>

<p>Zebraä¼šæç¤ºè¾“å…¥å£ä»¤ï¼Œæˆ‘ä»¬é€šè¿‡/usr/local/etc/zebra.confå¯ä»¥çœ‹åˆ°å£ä»¤æ˜¯zebraï¼Œenableå£ä»¤ä¹Ÿæ˜¯zebraã€‚</p>

<p>è¾“ å…¥å£ä»¤zebraï¼Œå¾—åˆ°è·¯ç”±å™¨ç”¨æˆ·æ¨¡å¼æç¤ºç¬¦ï¼š</p>

<p>Router&gt;</p>

<p>è¿›å…¥ç‰¹æƒæ¨¡å¼ï¼š</p>

<p>Router&gt; en
Password:
Router#</p>

<p>è¾“å…¥ä¸€ä¸ªé—®å·ï¼Œçœ‹çœ‹Zebraæä¾›äº†å¤šå°‘è·¯ç”±å‘½ä»¤ï¼š</p>

<p>Router# ?
  configure  Configuration from vty interface
  copy       Copy configuration
  debug      Debugging functions (see also â€˜undebugâ€™)
  disable    Turn off privileged mode command
  end        End current mode and change to enable mode.
  exit       Exit current mode and down to previous mode
  help       Description of the interactive help system
  list       Print command list
  no         Negate a command or set its defaults
  quit       Exit current mode and down to previous mode
  show       Show running system information
  terminal   Set terminal line parameters
  who        Display who is on vty
  write      Write running configuration to memory, network, or terminal</p>

<p>æä¾›çš„å‘½ä»¤å¾ˆå°‘ï¼Œå®é™…è·¯ç”±å™¨å¥½å¤šå‘½ä»¤éƒ½æ²¡æœ‰ï¼Œæˆ‘ä»¬åªèƒ½ç”¨æœ‰é™çš„å‘½ä»¤æŠ•å…¥åˆ°æ— é™çš„å®éªŒä¸­å»ã€‚</p>

<p>Router# sh run</p>

<p>Current configuration:
!
hostname Router
password zebra
enable password zebra
!
interface lo
!
interface eth0
!
line vty
!
end</p>

<p>ZebraæŠŠæ“ä½œç³»ç»Ÿçš„ç½‘ç»œæ¥å£å½“åšè·¯ç”±å™¨çš„æ¥å£ï¼Œæ‰€ä»¥åœ¨åšæ¯”è¾ƒå¤æ‚çš„è·¯ç”±å®éªŒï¼Œä¼šéœ€è¦æ¯”è¾ƒå¤šçš„ç½‘å¡ã€‚</p>

<p>è¿›å…¥å…¨å±€æ¨¡å¼ï¼Œå°½å¯èƒ½æŠŠå®é™…å¯ç”¨çš„é…ç½®å‘½ä»¤éƒ½å®éªŒä¸€éï¼š</p>

<p>Router# conf t
Router(config)#</p>

<p>è‡ªå·±å–ä¸€ä¸ªè·¯ç”±å™¨åå­—ï¼š</p>

<p>Router(config)# hostname r1
r1(config)#</p>

<p>Zebraæ¯”è¾ƒç®€å•ï¼Œç™»é™†å£ä»¤ä¸æ˜¯åœ¨lineä¸‹ä¿®æ”¹ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å…¨å±€æ¨¡å¼ä¸‹ç”¨passwordä¿®æ”¹</p>

<p>r1(config)# password {password}</p>

<p>Zebraä¸æ”¯æŒenable secret {password}è¿™ç§MD5åŠ å¯†å£ä»¤ï¼Œåªèƒ½ä½¿ç”¨enable password {password}æ¥ä¿®æ”¹</p>

<p>enableå£ä»¤ï¼š</p>

<p>r1# conf t
r1(config)# enable password {password}</p>

<p>åœ¨è·¯ç”±å™¨é…ç½®ä¸­åŠ å¯†æ‰€æœ‰çš„å£ä»¤ï¼š</p>

<p>r1(config)# service password-encryption</p>

<p>å›åˆ°ç‰¹æƒæ¨¡å¼ï¼š</p>

<p>r1(config)# exit
r1# sh run</p>

<p>Current configuration:
!
hostname r1
password 8 alA5.vcyMAwXQ
enable password 8 ksbxOFN8xcFMc
service password-encryption
!
interface lo
!
interface eth0
!
line vty
!
end</p>

<p>æˆ‘ä»¬çœ‹åˆ°åˆšæ‰çš„æ˜æ–‡å¯†ç éƒ½è¿›è¡ŒåŠ å¯†äº†ï¼Œç»™æˆ‘ä»¬çš„å®éªŒæœºä¹Ÿæé«˜å®‰å…¨æ€§ã€‚Zebraæœ‰ä¸€ç‚¹æ¯”è¾ƒæ¶å¿ƒï¼Œå¦‚æœæˆ‘ ä»¬å…ˆ</p>

<p>è®¾ç½®äº†service password-encryptionï¼Œç„¶åå†ä¿®æ”¹å£ä»¤ï¼Œsh runå°±å‘ç°å£ä»¤åˆéƒ½æ˜¯æ˜æ–‡çš„äº†ï¼Œä½†æ˜¯ç”± äºæœ‰</p>

<p>service password-encryptionï¼Œæ‰€ä»¥å°±æ— æ³•ç™»é™†äº†ã€‚</p>

<p>å»æ‰ä¼šè¯è¶…æ—¶ï¼Œå…å¾—10åˆ†é’Ÿæ²¡æœ‰åŠ¨ä½œï¼Œå°±æŠŠæˆ‘ä»¬ç»™è¸¢äº†ã€‚ä½†æ˜¯åœ¨å®é™…çš„è·¯ç”±å™¨é…ç½®ä¸­ï¼Œä¸ºå®‰å…¨èµ·è§æˆ‘ä»¬ æœ€å¥½è¿˜</p>

<p>æ˜¯è®¾ä¸Šä¼šè¯è¶…æ—¶ã€‚</p>

<p>r1# conf t
r1(config)# line vty
r1(config-line)# exec-timeout 0 0</p>

<p>è®¾ç½®æ—¥å¿—è®°å½•ï¼ŒZebraå¯ä»¥æŠŠæ—¥å¿—è®°å½•åˆ°æ ‡å‡†è¾“å‡ºã€syslogã€ä»¥åŠæŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼š</p>

<p>r1(config-line)# exit
r1(config)# log stdout
r1(config)# no log stdout
r1(config)# log syslog
r1(config)# no log syslog
r1(config)# log file /usr/local/etc/zebra.log</p>

<p>é…ç½®æ¥å£IPåœ°å€ï¼š</p>

<p>r1(config)# int lo
r1(config-if)# ip address 127.0.0.1/8
r1(config-if)# exit
r1(config)# int eth0
r1(config-if)# ip address 192.168.5.121/24</p>

<p>Zebraæ¯”è¾ƒå¥‡æ€ªï¼Œä¸èƒ½ä½¿ç”¨ip address 192.168.5.121 255.255.255.0è¿™ç§å½¢å¼è®¾ç½®IPã€‚æµ‹è¯•ä¸€ä¸‹ï¼Œå°±è®¾ç½®æˆ</p>

<p>å’ŒLinuxä¸­ä½¿ç”¨çš„ä¸€æ ·ã€‚</p>

<p>ä¿å­˜æˆ‘ä»¬åˆšæ‰çš„é…ç½®ï¼š</p>

<p>r1(config-if)# exit
r1(config)# exit
r1# copy run start
Configuration saved to /usr/local/etc/zebra.conf
r1#</p>

<p>2ã€ç”¨Zebraåšç®€å•çš„RIPå®éªŒ</p>

<p>RIPæ˜¯åº”ç”¨è¾ƒæ—©ã€ä½¿ç”¨è¾ƒæ™®éçš„IGPï¼Œé€‚ç”¨äºå°å‹åŒç±»ç½‘ç»œï¼Œæ˜¯å…¸å‹çš„è·ç¦»å‘é‡(distance-vector)å è®®ã€‚RIPé€š</p>

<p>è¿‡å¹¿æ’­UDPæŠ¥æ–‡æ¥äº¤æ¢è·¯ç”±ä¿¡æ¯ï¼Œæ¯30ç§’å‘é€ä¸€æ¬¡è·¯ç”±ä¿¡æ¯æ›´æ–°ã€‚RIPæä¾›è·³è·ƒè®¡æ•°(hop count)ä½œä¸ºå°ºåº¦æ¥è¡¡é‡</p>

<p>è·¯ç”±è·ç¦»ï¼Œè·³è·ƒè®¡æ•°æ˜¯ä¸€ä¸ªåŒ…åˆ°è¾¾ç›®æ ‡æ‰€å¿…é¡»ç»è¿‡çš„è·¯ç”±å™¨çš„æ•°ç›®ã€‚å¦‚æœåˆ°ç›¸åŒ ç›®æ ‡æœ‰äºŒä¸ªä¸ç­‰é€Ÿæˆ–ä¸åŒå¸¦å®½</p>

<p>çš„è·¯ç”±å™¨ï¼Œä½†è·³è·ƒè®¡æ•°ç›¸åŒï¼Œåˆ™RIPè®¤ä¸ºä¸¤ä¸ªè·¯ç”±æ˜¯ç­‰è·ç¦»çš„ã€‚RIPæœ€å¤šæ”¯ æŒçš„è·³æ•°ä¸º15ï¼Œå³åœ¨æºå’Œç›®çš„ç½‘é—´æ‰€</p>

<p>è¦ç»è¿‡çš„æœ€å¤šè·¯ç”±å™¨çš„æ•°ç›®ä¸º15ï¼Œè·³æ•°16è¡¨ç¤ºä¸å¯è¾¾ã€‚RIPv2æ”¯æŒ éªŒè¯ã€å¯†é’¥ç®¡ç†ã€è·¯ç”±æ±‡æ€»ã€æ— ç±»åŸŸé—´è·¯ç”±</p>

<p>(CIDR)å’Œå˜é•¿å­ç½‘æ©ç (VLSMs)ã€‚</p>

<p>Zebraæ”¯æŒRIPv2ï¼Œä½¿ç”¨ripdç¨‹åºå®ç°RIPè·¯ç”±åŠŸèƒ½ï¼Œä½†ripdç¨‹åºéœ€è¦åœ¨zebraç¨‹åºè¯»å–æ¥å£ä¿¡æ¯ï¼Œæ‰€ä»¥zebra ä¸€</p>

<p>å®šè¦åœ¨ripdä¹‹å‰å¯åŠ¨ã€‚ç”±äºæ¡ä»¶æ‰€é™ï¼Œä¸‹é¢çš„RIPå®éªŒæ˜¯åœ¨ä¸¤å°å•ç½‘å¡çš„RedHat7.2ä¸‹åšçš„ï¼Œæ‰€ä»¥åªæ˜¯ æœ€ç®€å•çš„</p>

<p>æ¼”ç¤ºã€‚</p>

<p>æŒ‰ç…§ä¸Šé¢åŸºæœ¬é…ç½®çš„æ–¹æ³•åˆå§‹åŒ–ç¬¬ä¸€å°æœºå™¨ï¼š</p>

<p>shell_1&gt; cd /usr/local/etc
shell_1&gt; cp zebra.conf.sample zebra.conf
shell_1&gt; cp ripd.conf.sample ripd.conf
shell_1&gt; zebra -d</p>

<p>è¿›å…¥zebraè®¾ç½®IP</p>

<p>shell_1&gt; telnet localhost 2601
Password:
Router&gt; en
Password:
Router# conf t
Router(config)# hostname r1
r1(config)# int eth0
r1(config-if)# ip address 192.168.5.121/24
r1(config-if)# ctrl+z
r1# copy run start</p>

<p>è¿›å…¥ç¬¬ä¸€å°æœºå™¨çš„ripè®¾ç½®</p>

<p>shell_1&gt; ripd -d
shell_1&gt; telnet localhost 2602
Password:
ripd&gt; en
ripd# conf t
ripd(config)# hostname r1_ripd !æ”¹ä¸ªåå­—å¥½è¾¨è®¤
r1_ripd(config)# router rip !å¯åŠ¨rip
r1_ripd(config-router)# network 192.168.5.0/24 !RIPv1æ˜¯æœ‰ç±»åˆ«è·¯ç”±åè®®ï¼ŒRIPv2æ˜¯æ— ç±»åˆ«è·¯ç”±åè®®ï¼Œ</p>

<p>Zebra é»˜è®¤æ”¯æŒRIPv2ï¼ŒæŒ‡å®šç½‘ç»œéœ€è¦å­ç½‘æ©ç ã€‚</p>

<p>r1çš„RIPç®€å•é…ç½®è¿™æ ·å°±å¯ç”¨äº†ï¼Œä¸‹é¢æ¥æ£€éªŒä¸€ä¸‹ï¼š</p>

<p>r1_ripd# sh ip protocols
Routing Protocol is â€œripâ€
  Sending updates every 30 seconds with +/-50%, next due in 3 seconds
  Timeout after 180 seconds, garbage collect after 120 seconds
  Outgoing update filter list for all interface is not set
  Incoming update filter list for all interface is not set
  Default redistribution metric is 1
  Redistributing:
  Default version control: send version 2, receive version 2
    Interface        Send  Recv   Key-chain
    eth0             2     2
  Routing for Networks:
    192.168.5.0/24
  Routing Information Sources:
    Gateway          BadPackets BadRoutes  Distance Last Update
  Distance: (default is 120)</p>

<p>æˆ‘ä»¬çœ‹åˆ°RIPå·²ç»èµ·æ¥äº†ï¼Œæ˜¯RIPv2ã€‚</p>

<p>r1_ripd# sh ip rip
Codes: R - RIP, C - connected, O - OSPF, B - BGP</p>

<p>Network            Next Hop         Metric From            Time</p>

<p>ç”±äºå°±ä¸¤ä¸ªæ¥å£ç›´è¿ï¼Œæ²¡æœ‰å…¶å®ƒç½‘ç»œï¼Œæ‰€ä»¥sh ip ripçœ‹ä¸åˆ°ä»€ä¹ˆã€‚</p>

<p>Zebraå¯¹logå¤„ç†å¯èƒ½æœ‰äº›é—®é¢˜ï¼Œä½¿ç”¨log stdoutä¸èƒ½æ˜¾ç¤ºå„ç§debugä¿¡æ¯ï¼Œæ‰€ä»¥åªèƒ½è®°å½•åˆ°æ–‡ä»¶ï¼Œåœ¨shellä¸‹ ç”¨</p>

<p>tailå‘½ä»¤æŸ¥çœ‹ã€‚</p>

<p>r1_ripd# debug rip events
r1_ripd# debug rip packet
r1_ripd(config)# log file /usr/local/etc/ripd.log</p>

<p>ç„¶åæˆ‘ä»¬åœ¨shellä¸‹æŸ¥çœ‹debugä¿¡æ¯</p>

<p>shell_1&gt; tail -f /usr/local/etc/ripd.log
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
2002/04/28 22:17:44 RIP: update timer fire!
2002/04/28 22:17:44 RIP: SEND UPDATE to eth0 ifindex 2
2002/04/28 22:17:44 RIP: multicast announce on eth0
2002/04/28 22:17:44 RIP: update routes on interface eth0 ifindex 2
2002/04/28 22:18:23 RIP: update timer fire!
2002/04/28 22:18:23 RIP: SEND UPDATE to eth0 ifindex 2
2002/04/28 22:18:23 RIP: multicast announce on eth0
2002/04/28 22:18:23 RIP: update routes on interface eth0 ifindex 2
2002/04/28 22:19:04 RIP: update timer fire!
2002/04/28 22:19:04 RIP: SEND UPDATE to eth0 ifindex 2
2002/04/28 22:19:04 RIP: multicast announce on eth0
2002/04/28 22:19:04 RIP: update routes on interface eth0 ifindex 2
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>

<p>RIPæ¯éš”30ç§’å‘é€ä¸€æ¬¡æ›´æ–°ï¼Œåœ¨sh ip protå¯ä»¥çœ‹åˆ°Sending updates every 30 seconds with +/-50%</p>

<p>ç¬¬äºŒå°æœºå™¨çš„è®¾ç½®</p>

<p>å‰é¢çš„åˆå§‹åŒ–å’Œç¬¬ä¸€å°ä¸€æ ·ï¼Œä¸è¿‡è¿™é‡Œåå­—è®¾æˆr2ä¾¿äºè¾¨è®¤ï¼ŒIPè®¾æˆäº†192.168.5.123/24ã€‚</p>

<p>è¿›å…¥ç¬¬äºŒå°æœºå™¨çš„ripè®¾ç½®</p>

<p>shell_2&gt; ripd -d
shell_2&gt; telnet localhost 2602
Password:
ripd&gt; en
ripd# conf t
ripd(config)# hostname r2_ripd
r2_ripd(config)# router rip
r2_ripd(config-router)# network 192.168.5.0/24</p>

<p>æ‰§è¡Œå®Œnetworkå‘½ä»¤ï¼Œæˆ‘ä»¬çœ‹åˆ°ç¬¬ä¸€å°æœºå™¨çš„tail -f /usr/local/etc/ripd.logè¾“å‡ºä¸‹é¢çš„ä¿¡æ¯ï¼š</p>

<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
2002/04/28 22:19:15 RIP: RECV packet from 192.168.5.123 port 520 on eth0
2002/04/28 22:19:15 RIP: RECV REQUEST version 2 packet size 24
2002/04/28 22:19:15 RIP:   0.0.0.0/0 -&gt; 0.0.0.0 family 0 tag 0 metric 16
2002/04/28 22:19:15 RIP: update routes to neighbor 192.168.5.123
2002/04/28 22:19:35 RIP: update timer fire!
2002/04/28 22:19:35 RIP: SEND UPDATE to eth0 ifindex 2
2002/04/28 22:19:35 RIP: multicast announce on eth0
2002/04/28 22:19:35 RIP: update routes on interface eth0 ifindex 2
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>

<p>r1é€šè¿‡UDPå¹¿æ’­æ¥æ”¶åˆ°192.168.5.123çš„æ›´æ–°åŒ…ï¼Œå¹¶ä¸”æŠŠ192.168.5.123è®¾ä¸ºneighborã€‚</p>

<p>ä¿å­˜ä¸€ä¸‹é…ç½®</p>

<p>r1_ripd# copy run start
Configuration saved to /usr/local/etc/ripd.conf
r2_ripd# copy run start
Configuration saved to /usr/local/etc/ripd.conf</p>

<p>Zebraè¿˜æ”¯æŒå¾ˆå¤šRIPåŠŸèƒ½ï¼Œå¦‚æœFiltering RIP Routes, RIP route-map, RIP Authenticationç­‰ï¼Œæœ‰æ¡ä»¶æœ‰æ—¶</p>

<p>é—´ çš„è¯å¯ä»¥åšæ›´å¤æ‚çš„å®éªŒã€‚</p>

<p>3ã€ç”¨ZebraåšOSPFå®éªŒ</p>

<p>OSPFï¼ˆå¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼‰è·¯ç”±åè®®æ˜¯ä¸€é¡¹é“¾è·¯çŠ¶æ€å‹æŠ€æœ¯ï¼Œæ˜¯ç›®å‰IGPä¸­åº”ç”¨æœ€å¹¿ã€æ€§èƒ½æœ€ä¼˜çš„ä¸€ä¸ª åè®®ï¼Œ</p>

<p>è§£å†³äº†RIPä¸èƒ½è§£å†³çš„å¤§å‹ã€å¯æ‰©å±•çš„ç½‘ç»œéœ€æ±‚è€Œå†™çš„ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡çš„ç½‘ç»œã€‚</p>

<p>Zebraæ”¯æŒOSPFv2å’ŒOSPFv3ï¼ˆç”¨äºIPv6çš„OSPFï¼ŒCISCOè¿˜æœªå¯¹å…¶å°è£…ï¼‰ï¼Œç”±äºæ¡ä»¶æ‰€é™ï¼Œä¸‹é¢çš„OSPFå® éªŒåŒæ ·æ˜¯</p>

<p>åœ¨ä¸¤å°å•ç½‘å¡çš„RedHat7.2ä¸‹åšçš„ã€‚</p>

<p>Zebraä½¿ç”¨ospfdç¨‹åºå®ç°OSPFè·¯ç”±åŠŸèƒ½ï¼Œä½†ospfdéœ€è¦ä»zebraç¨‹åºè·å¾—æ¥å£ä¿¡æ¯ï¼Œæ‰€ä»¥zebraç¨‹åºå¿…é¡»åœ¨ ospfd</p>

<p>ç¨‹åºä¹‹å‰è¿è¡Œã€‚ospfdä¸æ”¯æŒå¤šä¸ªOSPFè¿›ç¨‹ï¼Œæˆ‘ä»¬ä¸èƒ½æŒ‡å®šOSPFè¿›ç¨‹å·ã€‚</p>

<p>åˆå§‹åŒ–ç¬¬ä¸€å°æœºå™¨ï¼š</p>

<p>shell_1&gt; cd /usr/local/etc
shell_1&gt; cp zebra.conf.sample zebra.conf
shell_1&gt; cp ospfd.conf.sample ospfd.conf
shell_1&gt; zebra -d</p>

<p>è¿›å…¥zebraè®¾ç½®IP</p>

<p>shell_1&gt; telnet localhost 2601
Password:
Router&gt; en
Password:
Router# conf t
Router(config)# hostname r1
r1(config)# int eth0
r1(config-if)# ip address 192.168.5.121/24
r1(config-if)# ctrl+z
r1# copy run start</p>

<p>è¿›å…¥ç¬¬ä¸€å°æœºå™¨çš„ospfè®¾ç½®</p>

<p>shell_1&gt; ospfd -d
shell_1&gt; telnet localhost 2604
Password:
ospfd&gt; en
ospfd# conf t
ospfd(config)# hostname r1_ospfd !æ”¹ä¸ªåå­—å¥½è¾¨è®¤
r1_ospfd(config)# router ospf !å¯åŠ¨ospf
r1_ospfd(config-router)# ospf router-id 192.168.5.121 !è®¾ç½®router-id
r1_ospfd(config-router)# network 192.168.5.0/24 area 0
!æœ€å…³é”®çš„ï¼Œæ¥æ ‡è¯†è·¯ç”±å™¨ä¸Šå“ªäº›IPç½‘ç»œå·æ˜¯OSPFçš„ä¸€éƒ¨åˆ†ï¼Œå¯¹äºæ¯ä¸ªç½‘ç»œï¼Œæˆ‘ä»¬å¿…é¡»æ ‡è¯†è¯¥ç½‘ç»œæ‰€å± çš„åŒºåŸŸ</p>

<p>ã€‚ç”±äºæˆ‘ä»¬åªæœ‰ä¸¤å°æœºå™¨ï¼Œå½“ç„¶åªæœ‰ä¸€ä¸ªç½‘ç»œï¼Œæ‰€ä»¥åªéœ€æ‰§è¡Œä¸€ä¸ªnetworkå‘½ä»¤å°±å¤Ÿäº†ã€‚</p>

<p>å¯¹äºæˆ‘ä»¬çš„å°ç½‘ç»œï¼Œospfå°±ç®—é…å¥½äº†ï¼Œä¸‹é¢æ¥æ£€éªŒä¸€ä¸‹ï¼š</p>

<p>r1_ospfd(config-router)# ctrl+z
r1_ospfd# sh ip ospf route
============ OSPF network routing table ============
N    192.168.5.0/24        [10] area: 0.0.0.0
                           directly attached to eth0</p>

<p>============ OSPF router routing table =============</p>

<p>============ OSPF external routing table ===========</p>

<p>r1_ospfd# sh ip ospf database</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   OSPF Router with ID (192.168.5.121)

            Router Link States (Area 0.0.0.0)
</code></pre></div></div>

<p>Link ID         ADV Router      Age  Seq#       CkSum  Link count
192.168.5.121   192.168.5.121    126 0x80000002 0x8584 1</p>

<p>r1_ospfd# sh ip ospf int eth0
eth0 is up, line protocol is up</p>

<p>Internet Address 192.168.5.121/24, Area 0.0.0.0
  Router ID 192.168.5.121, Network Type BROADCAST, Cost: 10
  Transmit Delay is 1 sec, State DR, Priority 1
  Designated Router (ID) 192.168.5.121, Interface Address 192.168.5.121
  No backup designated router on this network
  Timer intarvals configured, Hello 10, Dead 40, Wait 40, Retransmit 5
    Hello due in 00:00:07
  Neighbor Count is 0, Adjacent neighbor count is 0</p>

<p>ç”±äºç½‘ç»œé‡Œæ²¡æœ‰å…¶å®ƒçš„è·¯ç”±å™¨ï¼Œr1å°±æŠŠè‡ªå·±é€‰ä¸ºDRï¼ˆæŒ‡å®šè·¯ç”±å™¨ï¼‰äº†ã€‚Zebraå¯¹logå¤„ç†å¯èƒ½æœ‰äº›é—®é¢˜ï¼Œä½¿ ç”¨</p>

<p>log stdoutä¸èƒ½æ˜¾ç¤ºå„ç§debugä¿¡æ¯ï¼Œæ‰€ä»¥åªèƒ½è®°å½•åˆ°æ–‡ä»¶ï¼Œåœ¨shellä¸‹ç”¨tailå‘½ä»¤æŸ¥çœ‹ã€‚è€Œä¸”debugå‘½ä»¤å’Œ å®</p>

<p>é™…è·¯ç”±å™¨ä¹Ÿæœ‰ä¸åŒã€‚</p>

<p>r1_ospfd# debug ospf event
r1_ospfd(config)# log file /usr/local/etc/ospfd.log</p>

<p>ç„¶åæˆ‘ä»¬åœ¨shellä¸‹æŸ¥çœ‹debugä¿¡æ¯</p>

<p>shell_1&gt; tail -f /usr/local/etc/ospfd.log
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
2002/04/28 14:24:27 OSPF: make_hello: options: 2, int: eth0:192.168.5.121
2002/04/28 14:24:37 OSPF: make_hello: options: 2, int: eth0:192.168.5.121
2002/04/28 14:24:47 OSPF: make_hello: options: 2, int: eth0:192.168.5.121
2002/04/28 14:24:57 OSPF: make_hello: options: 2, int: eth0:192.168.5.121
2002/04/28 14:25:07 OSPF: make_hello: options: 2, int: eth0:192.168.5.121
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>

<p>æˆ‘ä»¬é”™è¿‡äº†æœ€å¼€å§‹çš„ä¿¡æ¯ï¼Œçœ‹åˆ°è·¯ç”±å™¨æ¯éš”10ç§’å‘é€ä¸€ä¸ªhelloæ•°æ®åŒ…ã€‚helloæ•°æ®åŒ…é€šè¿‡å¤šç›®ç»„æ’­åœ°å€</p>

<p>224.0.0.5è¢«å‘é€å‡ºå»ï¼Œå¦‚æœæˆ‘ä»¬æ‰“å¼€debug ospf packet allå°±èƒ½å¾ˆæ¸…æ¥šçš„çœ‹åˆ°ã€‚</p>

<p>ç¬¬äºŒå°æœºå™¨çš„è®¾ç½®</p>

<p>å‰é¢çš„åˆå§‹åŒ–å’Œç¬¬ä¸€å°ä¸€æ ·ï¼Œä¸è¿‡è¿™é‡Œåå­—è®¾æˆr2ä¾¿äºè¾¨è®¤ï¼ŒIPè®¾æˆäº†192.168.5.123/24ã€‚</p>

<p>è¿›å…¥ç¬¬äºŒå°æœºå™¨çš„ospfè®¾ç½®</p>

<p>shell_2&gt; ospfd -d
shell_2&gt; telnet localhost 2604
Password:
ospfd&gt; en
ospfd# conf t
ospfd(config)# hostname r2_ospfd
r2_ospfd(config)# router ospf
r2_ospfd(config-router)# ospf router-id 192.168.5.123
r2_ospfd(config-router)# network 192.168.5.0/24 area 0</p>

<p>æ‰§è¡Œå®Œnetworkå‘½ä»¤ï¼Œæˆ‘ä»¬çœ‹åˆ°ç¬¬ä¸€å°æœºå™¨çš„tail -f /usr/local/etc/ospfd.logè¾“å‡ºä¸‹é¢çš„ä¿¡æ¯ï¼š</p>

<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
2002/04/28 14:25:51 OSPF: Packet 192.168.5.123 [Hello:RECV]: Options <em>|</em>|-|-|-|-|E|*
2002/04/28 14:25:51 OSPF: NSM[eth0:192.168.5.121:0.0.0.0]: start
2002/04/28 14:25:52 OSPF: make_hello: options: 2, int: eth0:192.168.5.121
2002/04/28 14:25:52 OSPF: couldnâ€™t find any VL to associate the packet with
2002/04/28 14:25:52 OSPF: DR-Election[1st]: Backup 192.168.5.123
2002/04/28 14:25:52 OSPF: DR-Election[1st]: DR     192.168.5.121
2002/04/28 14:25:52 OSPF: Packet[DD]: Negotiation done (Slave).
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>

<p>r1æ”¶åˆ°r2(192.168.5.123)å‘è¿‡æ¥çš„helloæ•°æ®åŒ…ï¼Œäº¤æ¢ä¿¡æ¯åé€‰ä¸¾DRï¼Œç”±äºæœ¬èº«192.168.5.121æ˜¯DRäº†ï¼Œæ‰€ä»¥</p>

<p>åªé€‰ä¸¾äº†BDRå°±å¥½äº†ã€‚è¿™æ—¶åœ¨r1ä¸Šå°±èƒ½çœ‹åˆ°r2äº†ã€‚</p>

<p>r1_ospfd# sh ip ospf neig</p>

<p>Neighbor ID     Pri   State           Dead Time   Address         Interface              RXmtL</p>

<p>RqstL DBsmL
192.168.5.123     1   Full/Backup     00:00:37    192.168.5.123   eth0:192.168.5.121     0     0</p>

<p>0</p>

<p>æ£€éªŒå…¶å®ƒä¿¡æ¯</p>

<p>r1_ospfd# sh ip ospf database</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   OSPF Router with ID (192.168.5.121)

            Router Link States (Area 0.0.0.0)
</code></pre></div></div>

<p>Link ID         ADV Router      Age  Seq#       CkSum  Link count
192.168.5.121   192.168.5.121   1259 0x80000008 0x534e 1
192.168.5.123   192.168.5.123   1265 0x80000006 0x534a 1</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            Net Link States (Area 0.0.0.0)
</code></pre></div></div>

<p>Link ID         ADV Router      Age  Seq#       CkSum
192.168.5.123   192.168.5.123   1265 0x80000001 0x5a5a</p>

<p>r1_ospfd# sh ip ospf int eth0
eth0 is up, line protocol is up</p>

<p>Internet Address 192.168.5.121/24, Area 0.0.0.0
  Router ID 192.168.5.121, Network Type BROADCAST, Cost: 10
  Transmit Delay is 1 sec, State DR, Priority 1
  Designated Router (ID) 192.168.5.121, Interface Address 192.168.5.121
  Backup Designated Router (ID) 192.168.5.123, Interface Address 192.168.5.123
  Timer intarvals configured, Hello 10, Dead 40, Wait 40, Retransmit 5
    Hello due in 00:00:01
  Neighbor Count is 1, Adjacent neighbor count is 1</p>

<p>å’Œå‰é¢çš„è¾“å‡ºä¿¡æ¯ç›¸æ¯”ï¼Œå‘ç”Ÿäº†å¾ˆå¤šå˜åŒ–ï¼Œä¸¤å°è·¯ç”±å™¨å·²ç»ç›¸äº’è¯†åˆ«äº†ã€‚OSPFä¸è±¡RIPä¸€æ ·ï¼Œæ¯éš”30ç§’ ç»™æ‰€æœ‰</p>

<p>çš„é‚»å±…å¹¿æ’­ä¸€æ¬¡å®Œæ•´çš„è·¯ç”±è¡¨ï¼Œè€Œæ˜¯é€šè¿‡IPå¤šç›®ç»„æ’­åœ°å€224.0.0.5æ¯éš”10ç§’å‘é€ä¸€ä¸ªå¾ˆå°çš„hello æ•°æ®åŒ…æ¥ç»´</p>

<p>æŠ¤é‚»å±…å…³ç³»ï¼Œå½“é“¾è·¯å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ‰é‡æ–°è®¡ç®—ã€‚</p>

<p>æ‹”æ‰ä¸¤å°æœºå™¨è¿æ¥çš„ç½‘çº¿ï¼Œçœ‹ospfd.logçš„è®°å½•ï¼š</p>

<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
2002/04/28 16:25:53 OSPF: make_hello: options: 2, int: eth0:192.168.5.121
2002/04/28 16:25:57 OSPF: Packet 192.168.5.123 [Hello:RECV]: Options <em>|</em>|-|-|-|-|E|*
2002/04/28 16:26:03 OSPF: make_hello: options: 2, int: eth0:192.168.5.121
2002/04/28 16:26:13 OSPF: make_hello: options: 2, int: eth0:192.168.5.121
2002/04/28 16:26:23 OSPF: make_hello: options: 2, int: eth0:192.168.5.121
2002/04/28 16:26:33 OSPF: make_hello: options: 2, int: eth0:192.168.5.121
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): Start
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): looked through areas
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): bb_configured: 1
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): bb_act_attached: 1
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): areas_configured: 1
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): areas_act_attached: 1
2002/04/28 16:26:37 OSPF: nsm_change_status(): scheduling new router-LSA origination
2002/04/28 16:26:37 OSPF: DR-Election[1nd]: Backup 0.0.0.0
2002/04/28 16:26:37 OSPF: DR-Election[1nd]: DR     192.168.5.121
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): Start
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): looked through areas
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): bb_configured: 1
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): bb_act_attached: 1
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): areas_configured: 1
2002/04/28 16:26:37 OSPF: ospf_check_abr_status(): areas_act_attached: 1
2002/04/28 16:26:37 OSPF: Timer[router-LSA]: (router-LSA Refresh expire)
2002/04/28 16:26:37 OSPF: counting fully adjacent virtual neighbors in area 0.0.0.0
2002/04/28 16:26:37 OSPF: there are 0 of them
2002/04/28 16:26:37 OSPF: SPF: calculation timer scheduled
2002/04/28 16:26:37 OSPF: SPF: calculation timer delay = 5
2002/04/28 16:26:37 OSPF: ospf_flood_through_interface(): considering int eth0:192.168.5.121
2002/04/28 16:26:37 OSPF: ospf_flood_through_interface(): considering nbr 192.168.5.121
2002/04/28 16:26:42 OSPF: SPF: Timer (SPF calculation expire)
2002/04/28 16:26:42 OSPF: ospf_spf_calculate: Start
2002/04/28 16:26:42 OSPF: ospf_spf_calculate: running Dijkstra for area 0.0.0.0
2002/04/28 16:26:42 OSPF: SPF Result: 0 [R] 192.168.5.121
2002/04/28 16:26:42 OSPF: ========== OSPF routing table ==========
2002/04/28 16:26:42 OSPF: ========================================
2002/04/28 16:26:42 OSPF: ospf_process_stub():processing stubs for area 0.0.0.0
2002/04/28 16:26:42 OSPF: ospf_process_stub():processing router LSA, id: 192.168.5.121
2002/04/28 16:26:42 OSPF: ospf_process_stub(): we have 1 links to process
2002/04/28 16:26:42 OSPF: ospf_intra_add_stub(): Start
2002/04/28 16:26:42 OSPF: ospf_intra_add_stub(): processing route to 192.168.5.0/24
2002/04/28 16:26:42 OSPF: ospf_intra_add_stub(): calculated cost is 0 + 10 = 10
2002/04/28 16:26:42 OSPF: ospf_intra_add_stub(): installing new route
2002/04/28 16:26:42 OSPF: ospf_intra_add_stub(): this network is on this router
2002/04/28 16:26:42 OSPF: ospf_intra_add_stub(): the interface is eth0:192.168.5.121
2002/04/28 16:26:42 OSPF: ospf_intra_add_stub(): Stop
2002/04/28 16:26:42 OSPF: children of V:
2002/04/28 16:26:42 OSPF: ospf_spf_calculate: Stop
2002/04/28 16:26:42 OSPF: ospf_ia_routing():start
2002/04/28 16:26:42 OSPF: ospf_ia_routing():not ABR, considering all areas
2002/04/28 16:26:42 OSPF: Pruning unreachable networks
2002/04/28 16:26:42 OSPF: Pruning unreachable routers
2002/04/28 16:26:42 OSPF: Route: Router Routing Table free
2002/04/28 16:26:42 OSPF: SPF: calculation complete
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>

<p>æˆ‘ä»¬çœ‹åˆ°r1ç”Ÿæˆä¸€ä¸ªLSAåŒ…ï¼Œé€šçŸ¥å…¶å®ƒè·¯ç”±å™¨ï¼Œç”±äºç½‘ç»œé‡Œåªæœ‰è‡ªå·±äº†ï¼Œåˆé€‰è‡ªå·±ä¸ºDRã€‚r2ä¹Ÿæ˜¯ä¸€æ ·ã€‚ æˆ‘ä»¬å†</p>

<p>æ’ä¸Šç½‘çº¿ï¼ŒæŸ¥çœ‹ospfd.logï¼š</p>

<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
2002/04/28 16:52:08 OSPF: Packet 192.168.5.123 [Hello:RECV]: Options <em>|</em>|-|-|-|-|E|*
2002/04/28 16:52:08 OSPF: NSM[eth0:192.168.5.121:0.0.0.0]: start
2002/04/28 16:52:08 OSPF: DR-Election[1st]: Backup 192.168.5.123
2002/04/28 16:52:08 OSPF: DR-Election[1st]: DR     192.168.5.121
2002/04/28 16:52:08 OSPF: DR-Election[1st]: Backup 0.0.0.0
2002/04/28 16:52:08 OSPF: DR-Election[1st]: DR     192.168.5.123
2002/04/28 16:52:08 OSPF: DR-Election[2nd]: Backup 192.168.5.121
2002/04/28 16:52:08 OSPF: DR-Election[2nd]: DR     192.168.5.123
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>

<p>ç”±äºæ‹”äº†ç½‘çº¿ï¼Œr1å’Œr2éƒ½æŠŠè‡ªå·±é€‰ä¸ºDRï¼Œä¸€ä¸ªç½‘ç»œåªèƒ½æœ‰ä¸€ä¸ªDRï¼Œæ‰€ä»¥æ¢å¤è¿æ¥åå®ƒä»¬é‡æ–°è¿›è¡Œäº†DRé€‰ ä¸¾ï¼Œç”±</p>

<p>äº192.168.5.123çš„router idå¤§ï¼Œæ‰€ä»¥å®ƒè¢«é€‰ä¸ºDRã€‚</p>

<p>ä¿å­˜ä¸€ä¸‹é…ç½®</p>

<p>r1_ospfd# copy run start
Configuration saved to /usr/local/etc/ospfd.conf
r2_ospfd# copy run start
Configuration saved to /usr/local/etc/ospfd.conf</p>

<p>ä»¥ä¸Šåªæ˜¯æ¼”ç¤ºäº†æœ€ç®€å•çš„OSPFçš„é…ç½®ï¼Œè€ŒOSPFåœ¨å¤§å‹ç½‘ç»œæ‰å¹¿æ³›çš„ä½¿ç”¨ï¼Œé…ç½®ä¹Ÿå¤æ‚å¤šå¾ˆå¤šã€‚å³ä½¿æ˜¯ Zebraï¼Œ</p>

<p>ä¹Ÿè¿˜å¯ç”¨åšå¤æ‚çš„å¤šçš„OSPFå®éªŒã€‚</p>

<p>4ã€ç”¨ZebraåšBGPå®éªŒ</p>

<p>RIPå’ŒOSPFéƒ½æ˜¯å†…éƒ¨ç½‘å…³åè®®ï¼ˆIGPï¼‰ï¼ŒBGPå±äºå¤–éƒ¨ç½‘å…³åè®®ï¼ˆEGPï¼‰ã€‚BGPå¹¿æ³›ç”¨äºInternetä»¥è¿æ¥ ISPï¼Œå¹¶å°†</p>

<p>ä¼ä¸šä¸ISPäº’è¿ã€‚</p>

<p>å½“BGPçš„å½±å“è¢«å®Œå…¨äº†è§£ï¼Œå¹¶ä¸”è‡³å°‘ä¸‹åˆ—æƒ…å†µä¹‹ä¸€å­˜åœ¨æ—¶ï¼Œåœ¨ASä¸­ä½¿ç”¨BGPæ‰æ˜¯æœ€æ°å½“çš„ï¼š
  1 ASå…è®¸æ•°æ®åŒ…ç©¿è¿‡å®ƒåˆ°è¾¾å…¶å®ƒè‡ªæ²»ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼ŒæŸä¸ªæœåŠ¡æä¾›å•†ï¼‰ã€‚
  2 ASæœ‰åˆ°å…¶å®ƒè‡ªæ²»ç³»ç»Ÿçš„å¤šæ¡è¿æ¥ã€‚
  3 å¿…é¡»å¯¹è¿›å…¥å’Œç¦»å¼€ASçš„æ•°æ®æµè¿›è¡Œæ§åˆ¶ã€‚</p>

<p>å¯¹äºäº’è¿çš„è‡ªæ²»ç³»ç»Ÿæ¥è¯´ï¼ŒBGPå¹¶ä¸æ€»æ˜¯æ°å½“çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœæœ‰å¦‚ä¸‹æƒ…å†µä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ—¶ï¼Œä¸è¦ä½¿ ç”¨BGPï¼š
  1 åªæœ‰åˆ°Internetæˆ–å¦ä¸€ASçš„å•ä¸€è¿æ¥ã€‚
  2 æ— éœ€è€ƒè™‘è·¯ç”±ç­–ç•¥æˆ–è·¯ç”±é€‰æ‹©ã€‚
  3 è·¯ç”±å™¨ç¼ºä¹ç»å¸¸æ€§çš„BGPæ›´æ–°çš„å†…å­˜æˆ–å¤„ç†å™¨ã€‚
  4 å¯¹è·¯ç”±è¿‡æ»¤å’ŒBGPè·¯å¾„é€‰æ‹©è¿‡ç¨‹çš„äº†è§£ååˆ†æœ‰é™ã€‚
  5 åœ¨è‡ªæ²»ç³»ç»Ÿé—´çš„å¸¦å®½è¾ƒä½ã€‚
åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨é™æ€è·¯ç”±ã€‚</p>

<p>Zebraæ”¯æŒBGP-4å’ŒBGP-4+ï¼Œä¸‹é¢å®éªŒåªæ˜¯æ¼”ç¤ºBGPçš„åŸºæœ¬å‘½ä»¤ï¼Œä»¥åŠdebugçš„ä¸€äº›ä¿¡æ¯ã€‚ä¸€ä¸ªæ¯”è¾ƒå¤æ‚ çš„ç”¨</p>

<p>ZebraåšBGPå®éªŒè§http://www.unixreview.com/print/documentID=15977ï¼Œæœ‰æ¡ä»¶å¯ä»¥åšä¸€ä¸‹ã€‚</p>

<p>Zebraä½¿ç”¨bgpdç¨‹åºå®ç°BGPè·¯ç”±åŠŸèƒ½ï¼Œä½†bgpdéœ€è¦ä»zebraç¨‹åºè·å¾—æ¥å£ä¿¡æ¯ï¼Œæ‰€ä»¥zebraç¨‹åºå¿…é¡»åœ¨ bgpdç¨‹åº</p>

<p>ä¹‹å‰è¿è¡Œã€‚</p>

<p>åˆå§‹åŒ–ç¬¬ä¸€å°æœºå™¨ï¼š</p>

<p>shell_1&gt; cd /usr/local/etc
shell_1&gt; cp zebra.conf.sample zebra.conf
shell_1&gt; cp bgpd.conf.sample bgpd.conf
shell_1&gt; zebra -d</p>

<p>è¿˜æœ‰ä¸€ä¸ªbgpd.conf.sample2é…ç½®æ ·ä¾‹æ˜¯ç”¨äºIPv6çš„ã€‚</p>

<p>è¿›å…¥zebraè®¾ç½®IP</p>

<p>shell_1&gt; telnet localhost 2601
Password:
Router&gt; en
Password:
Router# conf t
Router(config)# hostname r1
r1(config)# int eth0
r1(config-if)# ip address 192.168.5.121/24
r1(config-if)# ctrl+z
r1# copy run start</p>

<p>è¿›å…¥ç¬¬ä¸€å°æœºå™¨çš„bgpè®¾ç½®</p>

<p>shell_1&gt; bgpd -d</p>

<p>å¯åŠ¨bgpdï¼Œæˆ‘ä»¬çœ‹åˆ°TCPç«¯å£179å·²ç»æ‰“å¼€ã€‚ä¸¤å°BGPè·¯ç”±å™¨ç›¸äº’é—´å»ºç«‹ä¸€æ¡TCPè¿æ¥ï¼Œäº¤æ¢æ¶ˆæ¯ä»¥æ‰“å¼€ å’Œç¡®è®¤è¿</p>

<p>æ¥å‚æ•°ã€‚è¿™ä¸¤å°è·¯ç”±å™¨è¢«ç§°ä¸ºå¯¹ç­‰è·¯ç”±å™¨ï¼Œæˆ–è€…é‚»å±…ã€‚</p>

<p>shell_1&gt; telnet localhost 2605
Password:
bgpd&gt; en
bgpd# conf t
bgpd(config)# hostname r1_bgpd
r1_bgpd(config)# router bgp 7675</p>

<p>é…ç½®æ ·ä¾‹é‡Œå·²ç»æŒ‡å®šäº†ASä¸º7675ï¼Œæˆ‘ä»¬æ‡’çš„æ”¹å°±æ‹¿æ¥ç”¨ã€‚ASæ˜¯ä¸€ä¸ª16bitçš„æ•°å­—ï¼Œå…¶èŒƒå›´ä»1åˆ° 65535ã€‚RFC</p>

<p>1930ç»™å‡ºäº†ASç¼–å·ä½¿ç”¨æŒ‡å—ã€‚ä»64512åˆ°65535çš„ASç¼–å·èŒƒå›´æ˜¯ç•™ä½œç§ç”¨çš„ï¼Œç±»ä¼¼ç§æœ‰IPã€‚</p>

<p>r1_bgpd(config-router)# network 192.168.5.0/24
r1_bgpd(config-router)# neighbor 192.168.5.121 remote-as 7676</p>

<p>æŸ¥çœ‹bgpä¿¡æ¯ï¼š</p>

<p>r1_bgpd# sh ip bgp
BGP table version is 0, local router ID is 192.168.5.123
Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal
Origin codes: i - IGP, e - EGP, ? - incomplete</p>

<p>Network          Next Hop            Metric LocPrf Weight Path
*&gt; 192.168.5.0      0.0.0.0                            32768 i</p>

<p>Total number of prefixes 1</p>

<p>æŠŠlogè®°å½•åˆ°æ–‡ä»¶ï¼š</p>

<p>r1_bgpd# conf t
r1_bgpd(config)# log file /usr/local/etc/bgpd.log</p>

<p>æ‰“å¼€debugé€‰é¡¹ï¼š</p>

<p>r1_bgpd(config)# exit
r1_bgpd debug bgp events
r1_bgpd debug bgp keepalives
r1_bgpd debug bgp updates</p>

<p>ç„¶ååœ¨shellä¸‹ç”¨tailæŸ¥çœ‹logè®°å½•ï¼š</p>

<p>shell_1&gt; tail -f /usr/local/etc/bgpd.log
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
2002/04/29 19:13:08 BGP: 192.168.5.121 [Event] Connect start to 192.168.5.121 fd 10
2002/04/29 19:13:11 BGP: 192.168.5.121 [Event] Connect failed (Operation now in progress)
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>

<p>r1ä¸èƒ½è¿æ¥é‚»å±…192.168.5.121ã€‚</p>

<p>ç¬¬äºŒå°æœºå™¨çš„è®¾ç½®</p>

<p>å‰é¢çš„åˆå§‹åŒ–å’Œç¬¬ä¸€å°ä¸€æ ·ï¼Œä¸è¿‡è¿™é‡Œåå­—è®¾æˆr2ä¾¿äºè¾¨è®¤ï¼ŒIPè®¾æˆäº†192.168.5.123/24ã€‚</p>

<p>è¿›å…¥ç¬¬äºŒå°æœºå™¨çš„bgpè®¾ç½®</p>

<p>shell_2&gt; bgpd -d
shell_2&gt; telnet localhost 2605
Password:
bgpd&gt; en
bgpd# conf t
bgpd(config)# hostname r2_bgpd</p>

<p>ASè¦è®¾æˆä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¿®æ”¹ä¸€ä¸‹ï¼š</p>

<p>r2_bgpd(config)# no router bgp 7675
r2_bgpd(config)# router bgp 7676
r2_bgpd(config-router)# network 192.168.5.0/24
r2_bgpd(config-router)# neighbor 192.168.5.123 remote-as 7675</p>

<p>è¿™æ—¶ç¬¬ä¸€å°æœºå™¨çš„logå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>

<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
2002/04/29 19:16:35 BGP: [Event] BGP connection from host 192.168.5.121
2002/04/29 19:16:35 BGP: [Event] Make dummy peer structure until read Open packet
2002/04/29 19:16:35 BGP: 192.168.5.121 [Event] Transfer temporary BGP peer to existing one
2002/04/29 19:16:35 BGP: 192.168.5.121 [Event] Accepting BGP peer delete
2002/04/29 19:16:35 BGP: 192.168.5.121 send UPDATE 192.168.5.0/24 nexthop 192.168.5.123, origin</p>

<p>i, path
2002/04/29 19:16:35 BGP: 192.168.5.121 rcvd UPDATE w/ attr: nexthop 192.168.5.121, origin i, path</p>

<p>7676
2002/04/29 19:16:35 BGP: 192.168.5.121 rcvd 192.168.5.0/24
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“8&lt;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>

<p>ä¸¤å°bgpå·²ç»äº’è¿äº†ã€‚å†çœ‹ä¸€ä¸‹ç¬¬ä¸€å°æœºå™¨çš„bgpä¿¡æ¯ï¼š</p>

<p>r1_bgpd# sh ip bgp
BGP table version is 0, local router ID is 192.168.5.123
Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal
Origin codes: i - IGP, e - EGP, ? - incomplete</p>

<p>Network          Next Hop            Metric LocPrf Weight Path</p>
<ul>
  <li>192.168.5.0      192.168.5.121                          0 7676 i
*&gt;                  0.0.0.0                            32768 i</li>
</ul>

<p>Total number of prefixes 1</p>

<p>r1_bgpd# sh ip bgp neighbors
BGP neighbor is 192.168.5.121, remote AS 7676, local AS 7675, external link
  BGP version 4, remote router ID 192.168.5.121
  BGP state = Established, up for 00:01:13
  Last read 00:00:13, hold time is 180, keepalive interval is 60 seconds
  Neighbor capabilities:
    Route refresh: advertised and received (old and new)
    Address family IPv4 Unicast: advertised and received
  Received 98 messages, 0 notifications, 0 in queue
  Sent 103 messages, 0 notifications, 0 in queue
  Route refresh request: received 0, sent 0
  Minimum time between advertisement runs is 0 seconds</p>

<p>For address family: IPv4 Unicast
  Community attribute sent to this neighbor (both)
  1 accepted prefixes</p>

<p>Connections established 2; dropped 1
Local host: 192.168.5.123, Local port: 179
Foreign host: 192.168.5.121, Foreign port: 1029
Nexthop: 192.168.5.123
Read thread: on  Write thread: off</p>

<p>Zebraè¿˜æ”¯æŒå¾ˆå¤šBGPçš„ç‰¹æ€§ï¼Œè¯·å‚è€ƒGNU Zebra Manualï¼Œæœ‰æ¡ä»¶çš„å¯ä»¥åšä¸€ä¸‹é‚£äº›å®éªŒã€‚</p>

<p>Zebraçš„Mailing Listæ¯”è¾ƒæ´»è·ƒï¼Œæœ‰è®¸å¤šäººåœ¨é‚£é‡Œè®¨è®ºZebraçš„å¼€å‘å’Œé…ç½®ç­‰ç­‰ï¼Œæœ‰é—®é¢˜çš„è¯ï¼Œåœ¨é‚£é‡Œåº”è¯¥ èƒ½å¾—</p>

<p>åˆ°è§£ç­”ã€‚</p>

<p>Reference</p>

<p>GNU Zebra Manual
http://www.pointless.net/~jasper/zebra-html/zebra_toc.html#SEC_Contents
ç»„å»ºå¯æ‰©å±•çš„Ciscoç½‘ç»œ
http://www.unixreview.com/print/documentID=15977]</p>
:ET