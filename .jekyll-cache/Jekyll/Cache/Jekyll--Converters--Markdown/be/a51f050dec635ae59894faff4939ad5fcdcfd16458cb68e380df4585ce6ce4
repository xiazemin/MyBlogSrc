I"4<p>é€šè¿‡åœ¨ä¸»ç¨‹åºå’Œå…±äº«åº“ç›´æ¥å®šä¹‰ä¸€ç³»åˆ—çš„çº¦å®šæˆ–è€…æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„ä»£ç åŠ¨æ€åŠ è½½å…¶ä»–äººç¼–è¯‘çš„ Go è¯­è¨€å…±äº«å¯¹è±¡ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ â€” ä¸»ç¨‹åºå’Œå…±äº«åº“çš„å¼€å‘è€…ä¸éœ€è¦å…±äº«ä»£ç ï¼Œåªè¦åŒæ–¹çš„çº¦å®šä¸å˜ï¼Œä¿®æ”¹å…±äº«åº“åä¹Ÿä¸å†éœ€è¦é‡æ–°ç¼–è¯‘ä¸»ç¨‹åºã€‚
ype Driver interface {
    Name() string
}</p>

<p>func main() {
    p, err := plugin.Open(â€œdriver.soâ€)
    if err != nil {
	   panic(err)
    }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>newDriverSymbol, err := p.Lookup("NewDriver")
if err != nil {
    panic(err)
}

newDriverFunc := newDriverSymbol.(func() Driver)
newDriver := newDriverFunc()
fmt.Println(newDriver.Name()) }
</code></pre></div></div>

<p>void *dlopen(const char *filename, int flag);
char *dlerror(void);
void *dlsym(void *handle, const char *symbol);
int dlclose(void *handle);</p>

<p>CGO
åœ¨å…·ä½“åˆ†æ plugin åŒ…ä¸­å‡ ä¸ªå…¬æœ‰æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹åŒ…ä¸­ä½¿ç”¨çš„ä¸¤ä¸ª C è¯­è¨€å‡½æ•° pluginOpen å’Œ pluginLookupï¼›pluginOpen åªæ˜¯ç®€å•åŒ…è£…äº†ä¸€ä¸‹æ ‡å‡†åº“ä¸­çš„ dlopen å’Œ dlerror å‡½æ•°å¹¶åœ¨åŠ è½½æˆåŠŸåè¿”å›æŒ‡å‘åŠ¨æ€åº“çš„å¥æŸ„
è¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°åŸç†éƒ½æ¯”è¾ƒç®€å•ï¼Œå®ƒä»¬çš„ä½œç”¨ä¹Ÿåªæ˜¯ç®€å•å°è£…æ ‡å‡†åº“ä¸­çš„ C è¯­è¨€å‡½æ•°ï¼Œè®©å®ƒä»¬çš„å‡½æ•°ç­¾åçœ‹èµ·æ¥æ›´åƒæ˜¯ Go è¯­è¨€ä¸­çš„å‡½æ•°ç­¾åï¼Œæ–¹ä¾¿åœ¨ Go è¯­è¨€ä¸­è°ƒç”¨ã€‚</p>

<p>åŠ è½½è¿‡ç¨‹
ç”¨äºåŠ è½½å…±äº«å¯¹è±¡çš„å‡½æ•° plugin.Open ä¼šæ¥å—å…±äº«å¯¹è±¡æ–‡ä»¶çš„è·¯å¾„ä½œä¸ºå‚æ•°å¹¶è¿”å› plugin.Plugin ç»“æ„ä½“ï¼š
https://draveness.me/golang/docs/part4-advanced/ch08-metaprogramming/golang-plugin/
<!-- more -->
https://golang.org/pkg/plugin/
http://kuanshijiao.com/2018/08/04/goplugin/
è¯­è¨€æœ¬èº«æ”¯æŒï¼Œæ’ä»¶å’Œä¸»ç¨‹åºåŸç”Ÿè¯­æ³•äº¤äº’</p>

<p>è¿›ç¨‹éš”ç¦»ï¼šæ— ï¼Œå•è¿›ç¨‹
ä¸»ç¨‹åºè°ƒç”¨æ’ä»¶ï¼šä¸€åˆ‡é¢„åå®šobjectï¼ˆåŒ…æ‹¬functionã€channelï¼‰
æ’ä»¶æ„ŸçŸ¥ä¸»ç¨‹åºä¸Šä¸‹æ–‡ï¼šä¸»ç¨‹åºé¢„å®šä¹‰ç±»å‹å‚æ•°objectï¼ˆåŒ…æ‹¬functionã€channelï¼‰
streamæ”¯æŒï¼šå•å‘ï¼ŒåŸºäºchannel
æ’ä»¶å‘ç°ï¼šä¸»ç¨‹åºå¾ªç¯æ‰«ææ’ä»¶ç›®å½•å¹¶ç»´æŠ¤çŠ¶æ€ï¼›é€šè¿‡ç¬¬ä¸‰æ–¹æ–‡ä»¶diffå·¥å…·ç»´æŠ¤ï¼Œä¾‹å¦‚git
ä¸Šçº¿ï¼šèƒ½
ä¸‹çº¿ï¼šä¸èƒ½
æ›´æ–°ï¼šä¸èƒ½
é€šä¿¡ï¼šè¿›ç¨‹å†…
åºåˆ—åŒ–ï¼šä¸éœ€è¦
æ€§èƒ½ï¼šé«˜
Go pluginåˆ¤æ–­ä¸¤ä¸ªæ’ä»¶æ˜¯å¦ç›¸åŒæ˜¯é€šè¿‡æ¯”è¾ƒpluginpathå®ç°çš„ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®špluginpathï¼Œåˆ™ç”±å†…éƒ¨çš„ç®—æ³•ç”Ÿæˆ, ç”Ÿæˆçš„æ ¼å¼ä¸ºplugin/unnamed-â€œ + root.Package.Internal.BuildID ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä¸¤ä¸ªæ’ä»¶çš„æ–‡ä»¶åä¸åŒï¼Œå¼•ç”¨åŒ…ä¸åŒï¼Œæˆ–è€…å¼•ç”¨çš„cgoä¸åŒï¼Œåˆ™ä¼šç”Ÿæˆä¸åŒçš„æ’ä»¶ï¼ŒåŒæ—¶åŠ è½½ä¸ä¼šæœ‰é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœä¸¤ä¸ªæ’ä»¶çš„æ–‡ä»¶åç›¸åŒï¼Œç›¸å…³çš„å¼•ç”¨åŒ…ä¹Ÿç›¸åŒï¼Œåˆ™å¯èƒ½ç”Ÿæˆç›¸åŒçš„æ’ä»¶ï¼Œå³ä½¿æ’ä»¶å†…åŒ…å«çš„æ–¹æ³•å’Œå˜é‡ä¸åŒï¼Œå®ç°ä¹Ÿä¸åŒã€‚åˆ¤æ–­æ’ä»¶ç›¸åŒï¼Œçƒ­åŠ è½½ä¸ä¼šæˆåŠŸï¼Œä¹Ÿå°±æ„å‘³ç€è€æ’ä»¶ä¸æ”¯æŒè¦†ç›–æ›´æ–°ã€‚</p>

<p>æœ€å¥½åœ¨ç¼–è¯‘çš„æŒ‡å®špluginpathï¼ŒåŒæ—¶æ–¹ä¾¿ç‰ˆæœ¬è·Ÿè¸ªã€‚ç›®å‰ç”Ÿäº§ç¯å¢ƒå»ºè®®ä¸€äº›å…¬å…±åº“æ— æœåŠ¡ä¾èµ–çš„å‡½æ•°ï¼Œä¾‹å¦‚ç®—æ³•åº“ä¹‹ç±»çš„ã€‚</p>

<p>go build -ldflags â€œ-pluginpath=plugin/hot-$(date +%s)â€ -buildmode=plugin -o so/Eng.so eng/greeter.go</p>

<p>http://kuanshijiao.com/2018/08/04/goplugin/
https://github.com/natefinch/pie
https://github.com/hashicorp/go-plugin
https://github.com/nanomsg/mangos-v1
https://github.com/mna/agora
https://github.com/goplus/gop</p>

<p>https://cloud.tencent.com/developer/article/1187560
https://blog.csdn.net/uisoul/article/details/79793379</p>

<p>https://www.yisu.com/zixun/126862.html</p>

<p>https://tonybai.com/2017/06/27/an-intro-about-go-portability/</p>

<p>https://github.com/dongjun111111/blog/issues/39</p>

<p>https://cloud.tencent.com/developer/article/1187560
https://github.com/golang/go/issues/20554
https://github.com/golang/go/issues/20461</p>
:ET