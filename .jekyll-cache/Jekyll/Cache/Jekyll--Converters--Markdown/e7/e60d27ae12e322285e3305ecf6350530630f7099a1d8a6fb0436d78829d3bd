I"İ1<p>https://www.php.net/manual/zh/internals2.buildsys.skeleton.php</p>

<p>ä¸åŒæ‰©å±•ä¹‹é—´ï¼Œè¿™äº›æ–‡ä»¶çš„å¾ˆå¤šç»†èŠ‚æ˜¯ç›¸ä¼¼çš„ï¼Œåªæ˜¯è¦è´¹åŠ›å»å¤åˆ¶æ¯ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰è„šæœ¬å¯ä»¥åšæ‰€æœ‰çš„åˆå§‹åŒ–å·¥ä½œï¼Œåä¸º ext_skelï¼Œè‡ª PHP 4.0 èµ·ä¸å…¶ä¸€èµ·åˆ†å‘ã€‚
<!-- more -->
php-5.2.2/ext$ ./ext_skel 
./ext_skel â€“extname=module [â€“proto=file] [â€“stubs=file] [â€“xml[=file]]
           [â€“skel=dir] [â€“full-xml] [â€“no-help]</p>

<p>â€“extname=module   module is the name of your extension
  â€“proto=file       file contains prototypes of functions to create
  â€“stubs=file       generate only function stubs in file
  â€“xml              generate xml documentation to be added to phpdoc-cvs
  â€“skel=dir         path to the skeleton directory
  â€“full-xml         generate xml documentation for a self-contained extension
                     (not yet implemented)
  â€“no-help          donâ€™t try to be nice and create comments in the code
                     and helper functions to test if the module compiled</p>

<p>ç¬¬ä¸€æ­¥ï¼Œç”Ÿæˆæ‰©å±•æ¡†æ¶ä»£ç 
   é¦–å…ˆåˆ‡æ¢åˆ°PHP-SRC/extç›®å½•ä¸‹é¢(PHP-SRCå³phpæºä»£ç çš„æ–‡ä»¶å¤¹è·¯å¾„)
é€šè¿‡lsæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°ä¸€ä¸ªå«ext_skel(skelå°±æ˜¯éª¨éª¼éª¨æ¶çš„æ„æ€)
æ‰§è¡Œ./ext_sekl â€“helpå¯ä»¥æŸ¥çœ‹ç®€è¦çš„å¸®åŠ©</p>

<p>ext_sekl æ˜¯ä¸ªbashè„šæœ¬</p>

<p>protoå‚æ•°çš„ä½¿ç”¨
åœ¨PHP-SRC/ext/ä¸‹åˆ›å»ºä¸€ä¸ªecho.protoçš„æ–‡ä»¶ï¼Œå…¶å†…å®¹ä¸º</p>

<p>void my_echo(string str)
æ‰§è¡Œext_skel</p>

<p>./ext_skel â€“extname=echo â€“proto=echo.proto</p>

<p>å®ƒä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸ºâ€æ‰©å±•åâ€çš„æ–‡ä»¶å¤¹,é‡Œé¢åŒ…å«äº†æ‰©å±•çš„æ•´ä¸ªæ¡†æ¶ä»£ç </p>

<p>ç¬¬äºŒæ­¥ï¼Œä¿®æ”¹ç¼–è¯‘é…ç½®æ–‡ä»¶
ä¿®æ”¹PHP-SRC/ext/echo/config.m4
æŠŠ10ã€11ã€12è¡Œçš„dnl å»æ‰ ä¿®æ”¹ä¸ºä¸‹é¢çš„æ ·å­
PHP_ARG_WITH(echo, for echo support,
Make sure that the comment is aligned:
[  â€“with-echo             Include echo support])</p>

<p>ç¬¬ä¸‰æ­¥ï¼Œå®ç°æˆ‘ä»¬çš„å‡½æ•°
ç¼–è¾‘echo.c,æ‰¾åˆ°PHP_FUNCTION(my_echo)ï¼Œä¿®æ”¹ä¸ºä¸‹é¢çš„ä»£ç </p>

<p>/* { { { proto void my_echo(string str)
    */
PHP_FUNCTION(my_echo)
{
        char *str = NULL;
        int argc = ZEND_NUM_ARGS();
        size_t str_len;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    if (zend_parse_parameters(argc TSRMLS_CC, "s", &amp;str, &amp;str_len) == FAILURE)
            return;

    printf("%s",str);

    //php_error(E_WARNING, "my_echo: not yet implemented"); } /* }}} */ ç¬¬å››æ­¥ï¼Œç¼–è¯‘æ‰©å±• /root/php7d/bin/phpize ./configure --with-php-config=/root/php7d/bin/php-config make &amp;&amp; make install å…¶ä¸­/root/php7dæ˜¯phpçš„å®‰è£…ç›®å½•
</code></pre></div></div>

<p>æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šè‡ªåŠ¨æŠŠç”Ÿæˆçš„.soæ–‡ä»¶æ‹·è´è¿›phpçš„æ‰©å±•ç›®å½•ï¼Œæˆ‘è¿™é‡Œæ˜¯/root/php7d/lib/php/extensions/debug-non-zts-20141001</p>

<p>ç¼–è¾‘php.iniæ–‡ä»¶ï¼ˆæˆ‘çš„åœ¨/root/php7d/lib/php.iniï¼‰,åœ¨æœ€åæ·»åŠ ä¸€ä¸‹ä»£ç è®©phpåŠ è½½æ‰©å±•</p>

<p>[echo]
extension = echo.so</p>

<p>; Local Variables:
; tab-width: 4
; End:
é€šè¿‡æ‰§è¡Œphp -mä¾¿å¯ä»¥æŸ¥çœ‹åŠ è½½çš„æ‰©å±•äº†</p>

<p>ç¬¬äº”æ­¥ï¼Œæµ‹è¯•å‡½æ•°
é€šè¿‡æ‰§è¡ŒPHP-SRC/ext/echo/echo.phpæ–‡ä»¶å¯ä»¥æ£€éªŒæ‰©å±•æ˜¯å¦å®‰è£…æˆåŠŸ</p>

<p>[root@localhost echo]# /root/php7d/bin/php ./echo.php
Functions available in the test extension:
confirm_echo_compiled
my_echo</p>

<p>Congratulations! You have successfully modified ext/echo/config.m4. Module echo is now compiled into PHP.</p>

<p>ä¸€ã€ext_skel è„šæœ¬
äºŒã€ä¸ UNIX æ„å»ºç³»ç»Ÿäº¤äº’: config.m4</p>

<p>æ‰©å±•çš„ config.m4 æ–‡ä»¶å‘Šè¯‰ UNIX æ„å»ºç³»ç»Ÿå“ªäº›æ‰©å±• configure é€‰é¡¹æ˜¯æ”¯æŒçš„ï¼Œä½ éœ€è¦å“ªäº›æ‰©å±•åº“ï¼Œä»¥åŠå“ªäº›æºæ–‡ä»¶è¦ç¼–è¯‘æˆå®ƒçš„ä¸€éƒ¨åˆ†ã€‚</p>

<p>autoconf è¯­æ³•ç®€ä»‹
config.m4 æ–‡ä»¶ä½¿ç”¨ GNU autoconf è¯­æ³•ç¼–å†™ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ç”¨å¼ºå¤§çš„å®è¯­è¨€å¢å¼ºçš„ shell è„šæœ¬ã€‚æ³¨é‡Šç”¨å­—ç¬¦ä¸² dnl åˆ†éš”ï¼Œå­—ç¬¦ä¸²åˆ™æ”¾åœ¨å·¦å³æ–¹æ‹¬å·ä¸­é—´ï¼ˆä¾‹å¦‚ï¼Œ[ å’Œ ]ï¼‰ã€‚å­—ç¬¦ä¸²å¯æŒ‰éœ€è¦å¤šæ¬¡åµŒå¥—å¼•ç”¨ã€‚
æ ¹æ®éœ€è¦ä¿®æ”¹config.m4</p>

<p>åˆ‡æ¢åˆ°ext/edutest1/ç›®å½•ã€‚
vi config.m4
å°†ä¸‹é¢çš„ç¬¬ä¸€ã€ä¸‰è¡Œå–æ¶ˆæ³¨é‡Šï¼Œå¹¶åˆ æ‰ç¬¬äºŒè¡Œï¼š</p>

<p>16 dnl PHP_ARG_ENABLE(edutest1, whether to enable edutest1 support,
 17 dnl Make sure that the comment is aligned:
 18 dnl [  â€“enable-edutest1           Enable edutest1 support])</p>

<p>ä¿®æ”¹ä¸ºï¼š</p>

<p>16 PHP_ARG_ENABLE(edutest1, whether to enable edutest1 support,
 17     [  â€“enable-edutest1           Enable edutest1 support])</p>

<p>å°†PHP_SUBSTä¸€è¡Œçš„æ³¨é‡Šæ‰“å¼€ï¼š</p>

<p>19 if test â€œ$PHP_EDUTEST1â€ != â€œnoâ€; then
â€¦â€¦
59   PHP_SUBST(EDUTEST1_SHARED_LIBADD)
60
61   PHP_NEW_EXTENSION(edutest1, edutest1.c, $ext_shared)
62 fi</p>

<p>ç®€è¦è¯´æ˜ï¼š</p>

<p>å®PHP_ARG_ENABLEï¼Œå«æœ‰ä¸‰ä¸ªå‚æ•°ï¼š
ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œextest1ä¸º./configureå»ºç«‹äº†åä¸ºenable-edutest1çš„é€‰é¡¹
ç¬¬äºŒä¸ªå‚æ•°å°†ä¼šåœ¨./configureå‘½ä»¤å¤„ç†åˆ°è¯¥æ‰©å±•çš„é…ç½®æ–‡ä»¶æ—¶ï¼Œæ˜¾ç¤ºè¯¥å‚æ•°çš„å†…å®¹
ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯./configureå‘½ä»¤çš„å¸®åŠ©ï¼Œåœ¨ä½¿ç”¨./configure â€“helpçš„æ—¶å€™æ˜¾ç¤º
å®PHP_NEW_EXTENSION
è¯¥å®å£°æ˜äº†æ‰©å±•çš„æ¨¡å—å’Œå¿…é¡»è¦ç¼–è¯‘ä½œä¸ºæ‰©å±•ä¸€éƒ¨åˆ†çš„æºç æ–‡ä»¶ã€‚å¦‚æœéœ€è¦å¤šä¸ªæºæ–‡ä»¶ï¼Œåˆ™ä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°$ext_sharedä¸è°ƒç”¨PHP_SUBST(EDUTEST1_SHARED_LIBADD)æœ‰å…³ã€‚
ä¸‰ã€phpizeã€é…ç½®ã€ç¼–è¯‘
å› ä¸ºæˆ‘çš„Macä¸Šå·²ç»è‡ªå¸¦äº†PHPçš„ç¯å¢ƒï¼Œå°±ä¸é‡‡å–å…¨å¥—PHPæºç ç¼–è¯‘çš„æ–¹æ³•äº†ã€‚ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·phpizeå¯¹æ‰©å±•è¿›è¡Œç¼–è¯‘ã€‚</p>

<p>phpize å‘½ä»¤æ˜¯ç”¨æ¥å‡†å¤‡ PHP æ‰©å±•åº“çš„ç¼–è¯‘ç¯å¢ƒçš„å·¥å…·ã€‚å¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰ phpize å‘½ä»¤å¹¶ä¸”ä½¿ç”¨äº†é¢„ç¼–è¯‘çš„åŒ…ï¼ˆä¾‹å¦‚ RPMï¼‰ï¼Œé‚£è¦å®‰è£… PHP åŒ…ç›¸åº”çš„å¼€å‘ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬é€šå¸¸åŒ…å«äº† phpize å‘½ä»¤ä»¥åŠç›¸åº”çš„ç”¨äºç¼–è¯‘ PHP åŠå…¶æ‰©å±•åº“çš„å¤´æ–‡ä»¶ã€‚ä½¿ç”¨ phpize â€“help å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæ­¤å‘½ä»¤ç”¨æ³•ã€‚</p>

<p>ä½¿ç”¨rootæƒé™æ‰§è¡Œphpizeï¼š
 zhangxuefeng@zhangxuefengdeMac-mini î‚° ~/Developer/php-5.6.24/ext/edutest1 î‚° sudo /usr/bin/phpize
Password:
Configuring for:
PHP Api Version:         20121113
Zend Module Api No:      20121212
Zend Extension Api No:   220121212</p>

<p>configureï¼Œéœ€è¦ä½¿ç”¨php-configå·¥å…·ï¼š</p>

<p>php-config æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œè„šæœ¬ç”¨äºè·å–æ‰€å®‰è£…çš„ PHP é…ç½®çš„ä¿¡æ¯ã€‚åœ¨ç¼–è¯‘æ‰©å±•æ—¶ï¼Œå¦‚æœå®‰è£…æœ‰å¤šä¸ª PHP ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨é…ç½®æ—¶ç”¨ â€“with-php-config é€‰é¡¹æ¥æŒ‡å®šä½¿ç”¨å“ªä¸€ä¸ªç‰ˆæœ¬ç¼–è¯‘ï¼Œè¯¥é€‰é¡¹æŒ‡å®šäº†ç›¸å¯¹åº”çš„ php-config è„šæœ¬çš„è·¯å¾„ã€‚</p>

<p>âœ˜ zhangxuefeng@zhangxuefengdeMac-mini î‚° ~/Developer/php-5.6.24/ext/edutest1 î‚° sudo ./configure â€“enable-edutest1 â€“with-php-config=/usr/bin/php-config
checking for grep that handles long lines and -eâ€¦ /usr/bin/grep
checking for egrepâ€¦ /usr/bin/grep -E
checking for a sed that does not truncate outputâ€¦ /usr/bin/sed
checking for ccâ€¦ cc
â€¦â€¦</p>

<p>Make ç¼–è¯‘ï¼š
 zhangxuefeng@zhangxuefengdeMac-mini î‚° ~/Developer/php-5.6.24/ext/edutest1 î‚° sudo make
Password:
/bin/sh /Users/zhangxuefeng/Developer/php-5.6.24/ext/edutest1/libtool â€“mode=compile cc  -I. -I/Users/zhangxuefeng/Developer/php-5.6.24/ext/edutest1 -DPHP_ATOM_INC -I/Users/zhangxuefeng/Developer/php-5.6.24/ext/edutest1/include -I/Users/zhangxuefeng/Developer/php-5.6.24/ext/edutest1/main -I/Users/zhangxuefeng/Developer/php-5.6.24/ext/edutest1 -I/usr/include/php -I/usr/include/php/main -I/usr/include/php/TSRM -I/usr/include/php/Zend -I/usr/include/php/ext -I/usr/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /Users/zhangxuefeng/Developer/php-5.6.24/ext/edutest1/edutest1.c -o edutest1.lo
mkdir .libs
â€¦â€¦
â€¦â€¦
â€¦â€¦
Build complete.
Donâ€™t forget to run â€˜make testâ€™.</p>

<p>Make Installï¼š
 zhangxuefeng@zhangxuefengdeMac-mini î‚° ~/Developer/php-5.6.24/ext/edutest1 î‚° sudo make install
Installing shared extensions:     /usr/lib/php/extensions/no-debug-non-zts-20121212/</p>

<p>æ·»åŠ å®Œæ•´è·¯å¾„åˆ°php.iniä¸­ï¼š
 zhangxuefeng@zhangxuefengdeMac-miniî‚° sudo vim /etc/php.ini
â€¦â€¦
899 extension=/usr/lib/php/extensions/no-debug-non-zts-20121212/edutest1.so
â€¦â€¦</p>

<p>PHP-X</p>

<p>https://github.com/swoole/phpx</p>

<p>å®‰è£…
ä¿®æ”¹~/.bashrcè®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p>

<p>PHPX_ROOTï¼šè®¾ç½®phpxçš„æ ¹è·¯å¾„
PATHï¼šå°†$PHPX_ROOT/binç›®å½•åŠ å…¥ç³»ç»Ÿå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
vim ~/.bashrc
export PHPX_ROOT=/path/to/phpx
export PATH=$PHPX_ROOT/bin:$PATH
ä¸‹è½½å¹¶å®‰è£…</p>

<p>curl -sS https://swoole-cloud.com/phpx/installer.sh | sh
æ›´æ–°</p>
<h1 id="æ›´æ–°-phpx">æ›´æ–° phpx</h1>
<p>phpx update self</p>
<h1 id="æ›´æ–°å†…æ ¸åŒ…æ‹¬-php-swoole-ä»¥åŠå…¶ä»–æ‰©å±•">æ›´æ–°å†…æ ¸ï¼ŒåŒ…æ‹¬ php swoole ä»¥åŠå…¶ä»–æ‰©å±•</h1>
<p>phpx update core</p>

<p>git clone https://github.com/swoole/PHP-X.git
cd PHP-X
cmake .
make -j 4
sudo make install
æœªå‡ºç°ä»»ä½•ç¼–è¯‘é”™è¯¯ï¼Œä¼šæˆåŠŸç¼–è¯‘å‡ºlibphpx.soï¼Œå¹¶å®‰è£…åˆ°ç³»ç»Ÿçš„libç›®å½•ã€‚å¤´æ–‡ä»¶ä¼šå¤åˆ¶åˆ°ç³»ç»Ÿçš„includeç›®å½•ã€‚è¿™æ—¶éœ€è¦æ‰§è¡Œ sudo ldconfigåˆ·æ–°soæ–‡ä»¶ç¼“å­˜ã€‚</p>

<p>0x02 æ–°å»ºå·¥ç¨‹
ä½¿ç”¨ä»»æ„å¼€å‘å·¥å…·ï¼Œæ–°å»ºä¸€ä¸ªtest.ccæºæ–‡ä»¶ã€‚é¦–å…ˆéœ€è¦å¼•å…¥phpx.hå¤´æ–‡ä»¶ã€‚ç„¶åä½¿ç”¨usingå¼•å…¥phpxçš„å‘½åç©ºé—´ã€‚PHPå®˜æ–¹æœªä½¿ç”¨C++ï¼Œå› æ­¤phpxç›´æ¥ä½¿ç”¨äº†phpä½œä¸ºå‘½åç©ºé—´ã€‚</p>

<p>#include <phpx.h>
using namespace std;
using namespace php;
åˆ›å»ºæ‰©å±•ä½¿ç”¨PHPX_EXTENSIONå®æ¥å®ç°ã€‚åœ¨è¿™å®ä¸­åªéœ€è¦new Extensionå³å¯åˆ›å»ºæ‰©å±•ã€‚æ„é€ æ–¹æ³•æ¥å—2ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ‰©å±•çš„åç§°ï¼Œç¬¬äºŒä¸ªæ˜¯æ‰©å±•çš„ç‰ˆæœ¬å·ã€‚åœ¨PHPX_EXTENSIONå®ä¸­returnè¿™ä¸ªæ‰©å±•å¯¹è±¡çš„æŒ‡é’ˆã€‚</phpx.h></p>

<p>PHPX_EXTENSION()
{
    Extension *ext = new Extension(â€œtestâ€, â€œ0.0.1â€);
    return ext;
}
è¿™é‡Œå¿…é¡»ä½¿ç”¨ new Extensionï¼Œè€Œä¸èƒ½ç›´æ¥åœ¨æ ˆä¸Šåˆ›å»ºå¯¹è±¡</p>

<p>0x03 å¢åŠ å‡½æ•°
ä¸€ä¸ªPHPæ‰©å±•çš„ä¸»è¦ä½œç”¨å°±æ˜¯æä¾›æ‰©å±•å‡½æ•°ï¼Œæ‰©å±•å‡½æ•°ç”±äºæ˜¯ç”¨C/C++ä»£ç å®ç°ï¼Œå› æ­¤å®ƒçš„æ€§èƒ½ä¼šæ¯”PHPç”¨æˆ·å‡½æ•°æ€§èƒ½é«˜å‡ åç”šè‡³ä¸Šç™¾å€ã€‚åœ¨phpxä¸­å®ç°å‡½æ•°éå¸¸ç®€å•ã€‚ä½¿ç”¨PHPX_FUNCTIONæ¥å®ç°æ‰©å±•å‡½æ•°ï¼Œç„¶åè°ƒç”¨Extension::registerFunctionæ¥æ³¨å†Œæ‰©å±•å‡½æ•°ã€‚</p>

<p>PHPX_FNæ˜¯ä¸€ä¸ªåŠ©æ‰‹å®ï¼Œå®é™…ä¸Šå±•å¼€å°±æ˜¯â€cpp_hello_worldâ€, cpp_hello_world 
PHPX_FUNCTIONå±•å¼€åï¼ŒåŒ…å«äº†2ä¸ªå˜é‡ï¼Œç¬¬ä¸€ä¸ªæ˜¯å‚æ•°argsï¼Œç¬¬äºŒä¸ªæ˜¯è¿”å›å€¼retval 
é€šè¿‡æ“ä½œargså’Œretvalä¸¤ä¸ªå˜é‡ï¼Œå°±å¯ä»¥å®ç°å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡º</p>

<p>è¿™é‡Œæˆ‘ä»¬çš„ä»£ç éå¸¸ç®€å•ï¼Œcpp_test($str, $n)ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ª$nä¸ª$strçš„æ•°ç»„ã€‚</p>

<p>#include <phpx.h>
using namespace std;
using namespace php;</phpx.h></p>

<p>//å£°æ˜å‡½æ•°
PHPX_FUNCTION(cpp_test);</p>

<p>PHPX_EXTENSION()
{
    Extension *ext = new Extension(â€œtestâ€, â€œ0.0.1â€);
    ext-&gt;registerFunction(PHPX_FN(cpp_test));
    return ext;
}</p>

<p>//å®ç°å‡½æ•°
PHPX_FUNCTION(cpp_test)
{
    //args[1] å°±æ˜¯è¿™ä¸ªæ‰©å±•å‡½æ•°çš„ç¬¬ 2 ä¸ªå‚æ•°
    long n = args[1].toInt();</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//å°†è¿”å›å€¼ retval åˆå§‹åŒ–ä¸ºæ•°ç»„
Array _array(retval);

for(int i = 0; i &lt; n; i++)
{
    //args[0] å°±æ˜¯è¿™ä¸ªæ‰©å±•å‡½æ•°çš„ç¬¬ 1 ä¸ªå‚æ•°
    //append æ–¹æ³•è¡¨ç¤ºå‘æ•°ç»„ä¸­è¿½åŠ å…ƒç´ 
    _array.append(args[0]);
} } 0x04 ç¼–è¯‘æ‰©å±• ç¼–å†™ä¸€ä¸ªMakefileæ–‡ä»¶ã€‚å†…å®¹å¦‚ä¸‹ï¼š
</code></pre></div></div>

<p>PHP_INCLUDE = <code class="language-plaintext highlighter-rouge">php-config --includes</code>
PHP_LIBS = <code class="language-plaintext highlighter-rouge">php-config --libs</code>
PHP_LDFLAGS = <code class="language-plaintext highlighter-rouge">php-config --ldflags</code>
PHP_INCLUDE_DIR = <code class="language-plaintext highlighter-rouge">php-config --include-dir</code>
PHP_EXTENSION_DIR = <code class="language-plaintext highlighter-rouge">php-config --extension-dir</code></p>

<p>test.so: test.cc
    c++ -DHAVE_CONFIG_H -g -o test.so -O0 -fPIC -shared test.cc -std=c++11 ${PHP_INCLUDE} -I${PHP_INCLUDE_DIR} -lphpx</p>

<p>install: test.so
    cp test.so ${PHP_EXTENSION_DIR}/
clean:
    rm *.so
php-config è¿™ä¸ªå·¥å…·æ˜¯PHPæä¾›çš„ï¼Œä½¿ç”¨php-configå¯ä»¥å¾—åˆ°PHPçš„å®‰è£…è·¯å¾„ã€å¤´æ–‡ä»¶ç›®å½•ã€æ‰©å±•ç›®å½•ã€å…¶ä»–é¢å¤–çš„ç¼–è¯‘å‚æ•°ç­‰ç­‰ã€‚</p>

<p>è¿™ä¸ªMakefileæ”¯æŒäº†3ä¸ªæŒ‡ä»¤ï¼Œmakeç¼–è¯‘ï¼Œmake cleanæ¸…ç†ï¼Œmake installå®‰è£…åˆ°æ‰©å±•ç›®å½•ä¸­ã€‚</p>

<p>è¿™é‡Œå¯èƒ½éœ€è¦rootæƒé™ï¼Œä½¿ç”¨sudo make installè¿›è¡Œå®‰è£… 
ç›´æ¥ä»ç½‘é¡µå¤åˆ¶ï¼Œå¯èƒ½ä¼šå‡ºç°tabåˆ¶è¡¨ç¬¦è¢«æ›¿æ¢ä¸ºç©ºæ ¼ï¼Œè¯·æ‰‹å·¥ç¼–è¾‘ä¸€ä¸‹Makefileä½¿ç”¨tabç¼©è¿› 
MacOSä¸‹éœ€è¦åœ¨c++ç¼–è¯‘å‚æ•°ä¸­å¢åŠ -undefined dynamic_lookup</p>

<p>ç¼–å†™å¥½ä¹‹åæ‰§è¡Œmake installï¼Œå°±ä¼šç¼–è¯‘æ‰©å±•å¹¶å°†æ‰©å±•test.soå®‰è£…åˆ°PHPçš„æ‰©å±•ç›®å½•ä¸­ã€‚è¿™æ—¶éœ€è¦ä¿®æ”¹php.iniåŠ å…¥extension=test.soåŠ è½½æ‰©å±•ã€‚</p>

<p>ä½¿ç”¨php -mæ¥è§‚å¯Ÿä½ çš„æ‰©å±•æ˜¯å¦æ­£å¸¸åŠ è½½ã€‚</p>

:ET