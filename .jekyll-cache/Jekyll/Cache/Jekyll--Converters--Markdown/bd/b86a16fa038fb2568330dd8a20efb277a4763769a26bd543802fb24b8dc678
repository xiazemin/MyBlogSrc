I"Ë<p>æµç¨‹åˆ†æ
å€ŸåŠ©TCPå®Œæˆæ–‡ä»¶çš„ä¼ è¾“ï¼ŒåŸºæœ¬æ€è·¯å¦‚ä¸‹:</p>

<p>å‘é€æ–¹(å®¢æˆ·ç«¯)å‘æœåŠ¡ç«¯å‘é€æ–‡ä»¶åï¼ŒæœåŠ¡ç«¯ä¿å­˜è¯¥æ–‡ä»¶åã€‚
æ¥æ”¶æ–¹(æœåŠ¡ç«¯)å‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªæ¶ˆæ¯okï¼Œç¡®è®¤æ–‡ä»¶åä¿å­˜æˆåŠŸã€‚
å‘é€æ–¹(å®¢æˆ·ç«¯)æ”¶åˆ°æ¶ˆæ¯åï¼Œå¼€å§‹å‘æœåŠ¡ç«¯å‘é€æ–‡ä»¶æ•°æ®ã€‚
æ¥æ”¶æ–¹(æœåŠ¡ç«¯)è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå†™å…¥åˆ°ä¹‹å‰ä¿å­˜å¥½çš„æ–‡ä»¶ä¸­ã€‚
ç”±äºæ–‡ä»¶ä¼ è¾“éœ€è¦ç¨³å®šå¯é çš„è¿æ¥ï¼Œæ‰€ä»¥é‡‡ç”¨TCPæ–¹å¼å®Œæˆç½‘ç»œæ–‡ä»¶ä¼ è¾“åŠŸèƒ½ã€‚
<!-- more -->
é¦–å…ˆè·å–æ–‡ä»¶åã€‚å€ŸåŠ©osåŒ…ä¸­çš„stat()å‡½æ•°æ¥è·å–æ–‡ä»¶å±æ€§ä¿¡æ¯ã€‚åœ¨å‡½æ•°è¿”å›çš„æ–‡ä»¶å±æ€§ä¸­åŒ…å«æ–‡ä»¶åå’Œæ–‡ä»¶å¤§å°ã€‚Statå‚æ•°nameä¼ å…¥çš„æ˜¯æ–‡ä»¶è®¿é—®çš„ç»å¯¹è·¯å¾„ã€‚FileInfoä¸­çš„Name()å‡½æ•°å¯ä»¥å°†æ–‡ä»¶åå•ç‹¬æå–å‡ºæ¥ã€‚</p>

<p>func Stat(name string) (fi FileInfo, err error)
Statè¿”å›ä¸€ä¸ªæè¿°nameæŒ‡å®šçš„æ–‡ä»¶å¯¹è±¡çš„FileInfoã€‚å¦‚æœæŒ‡å®šçš„æ–‡ä»¶å¯¹è±¡æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œè¿”å›çš„FileInfoæè¿°è¯¥ç¬¦å·é“¾æ¥æŒ‡å‘çš„æ–‡ä»¶çš„ä¿¡æ¯ï¼Œæœ¬å‡½æ•°ä¼šå°è¯•è·³è½¬è¯¥é“¾æ¥ã€‚å¦‚æœå‡ºé”™ï¼Œè¿”å›çš„é”™è¯¯å€¼ä¸º*PathErrorç±»å‹ã€‚</p>

<p>æˆ‘ä»¬é€šè¿‡æºç å¯ä»¥å¾—çŸ¥FileInfoæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¦å®ç°è¿™ä¸ªæ¥å£å°±å¿…é¡»å®ç°è¿™ä¸ªæ¥å£çš„å¦‚ä¸‹æ‰€æœ‰æ–¹æ³•</p>

<p>å®ç°ç½‘ç»œæ–‡ä»¶ä¼ è¾“å®è´¨ä¸Šæ—¶å€ŸåŠ©äº†æœ¬åœ°æ–‡ä»¶å¤åˆ¶å’ŒTCPç½‘ç»œç¼–ç¨‹ç›¸å…³çŸ¥è¯†ï¼Œå¯ä»¥å…ˆçœ‹çœ‹Goè¯­è¨€å¤åˆ¶æ–‡ä»¶å’ŒGoç½‘ç»œç¼–ç¨‹äº†è§£ç›¸å…³å†…å®¹ã€‚</p>

<p>æ‰€ä»¥å…³äºä½¿ç”¨TCPå®ç°æ–‡ä»¶ä¼ è¾“å¤§è‡´æ­¥éª¤å¯ä»¥å½’ç»“ä¸ºå¦‚ä¸‹æ­¥éª¤</p>

<p>æ¥æ”¶ç«¯:</p>

<p>åˆ›å»ºç›‘å¬ listenerï¼Œç¨‹åºç»“æŸæ—¶å…³é—­ã€‚
é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ connï¼Œç¨‹åºç»“æŸæ—¶å…³é—­connã€‚
è¯»å–å®¢æˆ·ç«¯å‘é€æ–‡ä»¶åã€‚ä¿å­˜ fileNameã€‚
å›å‘â€œokâ€ã€‚
å°è£…å‡½æ•° RecvFile æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ–‡ä»¶å†…å®¹ã€‚ä¼ å‚ fileName å’Œ conn
æŒ‰æ–‡ä»¶å Create æ–‡ä»¶ï¼Œç»“æŸæ—¶ Close
å¾ªç¯ Read å‘é€ç«¯ç½‘ç»œæ–‡ä»¶å†…å®¹ï¼Œå½“è¯»åˆ° 0 è¯´æ˜æ–‡ä»¶è¯»å–å®Œæ¯•ã€‚
å°†è¯»åˆ°çš„å†…å®¹åŸå°ä¸åŠ¨Writeåˆ°åˆ›å»ºçš„æ–‡ä»¶ä¸­
æ¥æ”¶ç«¯ä»£ç :</p>

<p>package main</p>

<p>import (
    â€œfmtâ€
    â€œioâ€
    â€œnetâ€
    â€œosâ€
)</p>

<p>func recvFile(conn net.Conn, fileName string) {
    //æŒ‰ç…§æ–‡ä»¶ååˆ›å»ºæ–°æ–‡ä»¶
    file, err := os.Create(fileName)
    if err != nil {
        fmt.Printf(â€œos.Create()å‡½æ•°æ‰§è¡Œé”™è¯¯ï¼Œé”™è¯¯ä¸º:%v\nâ€, err)
        return
    }
    defer file.Close()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//ä»ç½‘ç»œä¸­è¯»æ•°æ®ï¼Œå†™å…¥æœ¬åœ°æ–‡ä»¶
for {
    buf := make([]byte, 4096)
    n, err := conn.Read(buf)

    //å†™å…¥æœ¬åœ°æ–‡ä»¶ï¼Œè¯»å¤šå°‘ï¼Œå†™å¤šå°‘
    file.Write(buf[:n])
    if err != nil {
        if err == io.EOF {
            fmt.Printf("æ¥æ”¶æ–‡ä»¶å®Œæˆã€‚\n")
        } else {
            fmt.Printf("conn.Read()æ–¹æ³•æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯ä¸º:%v\n", err)
        }
        return
    }
} }
</code></pre></div></div>

<p>func main() {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//1.åˆ›å»ºç›‘å¬socket
listener, err := net.Listen("tcp", "127.0.0.1:8000")
if err != nil {
    fmt.Printf("net.Listen()å‡½æ•°æ‰§è¡Œé”™è¯¯ï¼Œé”™è¯¯ä¸º:%v\n", err)
    return
}
defer listener.Close()

//é˜»å¡ç›‘å¬
conn, err := listener.Accept()
if err != nil {
    fmt.Printf("listener.Accept()æ–¹æ³•æ‰§è¡Œé”™è¯¯ï¼Œé”™è¯¯ä¸º:%v\n", err)
    return
}
defer conn.Close()

//æ–‡ä»¶åçš„é•¿åº¦ä¸èƒ½è¶…è¿‡1024ä¸ªå­—èŠ‚
buf := make([]byte, 4096)
n, err := conn.Read(buf)
if err != nil {
    fmt.Printf("conn.Read()æ–¹æ³•æ‰§è¡Œé”™è¯¯ï¼Œé”™è¯¯ä¸º:%v\n", err)
    return
}
fileName := string(buf[:n])

//å›å†™okç»™å‘é€ç«¯
conn.Write([]byte("ok"))

//è·å–æ–‡ä»¶å†…å®¹
recvFile(conn, fileName) } å‘é€ç«¯:
</code></pre></div></div>

<p>æç¤ºç”¨æˆ·ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°è¾“å…¥æ–‡ä»¶åã€‚æ¥æ”¶æ–‡ä»¶å filepathï¼ˆå«è®¿é—®è·¯å¾„ï¼‰
ä½¿ç”¨ os.Stat(ï¼‰è·å–æ–‡ä»¶å±æ€§ï¼Œå¾—åˆ°çº¯æ–‡ä»¶å fileNameï¼ˆå»é™¤è®¿é—®è·¯å¾„ï¼‰
ä¸»åŠ¨å‘èµ·è¿æ¥æœåŠ¡å™¨è¯·æ±‚ï¼Œç»“æŸæ—¶å…³é—­è¿æ¥ã€‚
å‘é€æ–‡ä»¶ååˆ°æ¥æ”¶ç«¯ conn.Write()
è¯»å–æ¥æ”¶ç«¯å›å‘çš„ç¡®è®¤æ•°æ® conn.Read()
åˆ¤æ–­æ˜¯å¦ä¸ºâ€œokâ€ã€‚å¦‚æœæ˜¯ï¼Œå°è£…å‡½æ•° SendFile() å‘é€æ–‡ä»¶å†…å®¹ã€‚ä¼ å‚ filePath å’Œ conn
åªè¯» Open æ–‡ä»¶, ç»“æŸæ—¶Closeæ–‡ä»¶
å¾ªç¯è¯»æœ¬åœ°æ–‡ä»¶ï¼Œè¯»åˆ° EOFï¼Œè¯»å–å®Œæ¯•ã€‚
å°†è¯»åˆ°çš„å†…å®¹åŸå°ä¸åŠ¨ conn.Write ç»™æ¥æ”¶ç«¯ï¼ˆæœåŠ¡å™¨ï¼‰
å‘é€ç«¯ä»£ç :</p>

<p>package main</p>

<p>import (
    â€œfmtâ€
    â€œioâ€
    â€œnetâ€
    â€œosâ€
)
func sendFile(conn net.Conn, filePath string) {
    //åªè¯»æ‰“å¼€æ–‡ä»¶
    file, err := os.Open(filePath)
    if err != nil {
        fmt.Printf(â€œos.Open()å‡½æ•°æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯ä¸º:%v\nâ€, err)
        return
    }
    defer file.Close()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>buf := make([]byte, 4096)
for {
    //ä»æœ¬åœ°æ–‡ä»¶ä¸­è¯»æ•°æ®ï¼Œå†™ç»™ç½‘ç»œæ¥æ”¶ç«¯ã€‚è¯»å¤šå°‘ï¼Œå†™å¤šå°‘
    n, err := file.Read(buf)
    if err != nil {
        if err == io.EOF {
            fmt.Printf("å‘é€æ–‡ä»¶å®Œæ¯•\n")
        } else {
            fmt.Printf("file.Read()æ–¹æ³•æ‰§è¡Œé”™è¯¯,é”™è¯¯ä¸º:%v\n", err)
        }
        return
    }
    //å†™åˆ°ç½‘ç»œsocketä¸­
    _, err = conn.Write(buf[:n])
} }
</code></pre></div></div>

<p>func main() {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//è·å–å‘½ä»¤è¡Œå‚æ•°
list := os.Args

if len(list) != 2 {
    fmt.Printf("æ ¼å¼ä¸º:go run xxx.go æ–‡ä»¶å\n")
    return
}

//æå–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
path := list[1]

//è·å–æ–‡ä»¶å±æ€§
fileInfo, err := os.Stat(path)
if err != nil {
    fmt.Printf("os.Stat()å‡½æ•°æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯ä¸º:%v\n", err)
    return
}

//ä¸»åŠ¨å‘èµ·è¿æ¥è¯·æ±‚
conn, err := net.Dial("tcp", "127.0.0.1:8000")
if err != nil {
    fmt.Printf("net.Dial()å‡½æ•°æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯ä¸º:%v\n", err)
    return
}
defer conn.Close()

//å‘é€æ–‡ä»¶åç»™æ¥æ”¶ç«¯
_, err = conn.Write([]byte(fileInfo.Name()))

//è¯»å–æœåŠ¡å™¨å›å‘æ•°æ®
buf := make([]byte, 4096)
n, err := conn.Read(buf)
if err != nil {
    fmt.Printf("conn.Read(buf)æ–¹æ³•æ‰§è¡Œå‡ºé”™ï¼Œé”™è¯¯ä¸º:%v\n", err)
    return
}

if string(buf[:n]) == "ok" {
    //å†™æ–‡ä»¶å†…å®¹ç»™æœåŠ¡å™¨ -- å€ŸåŠ©conn
    sendFile(conn, path)
} }**
</code></pre></div></div>
:ET