I"€	<p>awesome-go è¦æ±‚é¡¹ç›®æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 80% ä»¥ä¸Šæ‰ç¬¦åˆå…¥é€‰æ ‡å‡†ã€‚æœ‰ä¸€äº›å…¬å¸ä¹Ÿä¼šè¦æ±‚é¡¹ç›®æœ‰ç›¸å¯¹åˆç†çš„æµ‹è¯•è¦†ç›–ç‡(å¦‚ 70% ä»¥ä¸Šæ‰ç¬¦åˆä»£ç å‡†å…¥æ¡ä»¶ç­‰ç­‰)ã€‚</p>

<p>ä½†æœ‰æ—¶ï¼Œæˆ‘ä»¬çš„é€»è¾‘ä»£ç å´æŒºéš¾åšåˆ°è¿™ä¹ˆé«˜çš„è¦†ç›–ç‡ï¼Œä¸»è¦è¿˜æ˜¯å› ä¸ºç›®å‰ Go çš„é”™è¯¯å¤„ç†é€»è¾‘ï¼š</p>

<p>func Register(req RegisterReq) error{
 if len(req.Username) == 0 {
  return errors.New(â€œlength of username cannot be 0â€)
 }</p>

<p>if len(req.PasswordNew) == 0 || len(req.PasswordRepeat) == 0 {
  return errors.New(â€œpassword and password reinput must be longer than 0â€)
 }</p>

<p>if req.PasswordNew != req.PasswordRepeat {
  return errors.New(â€œpassword and reinput must be the sameâ€)
 }</p>

<p>if emailFormatValid(req.Email) {
  return errors.New(â€œinvalid emailâ€)
 }</p>

<p>createUser(req.Username, req.PasswordNew, req.Email)
 return nil
}
ä¸Šé¢æ˜¯ä¸€ä¸ªåšæ¥å£çš„è¯·æ±‚æ ¡éªŒçš„ä¾‹å­(å½“ç„¶è¯·æ±‚æ ¡éªŒåº”è¯¥ç›´æ¥ä½¿ç”¨ validator åº“ï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­)ï¼Œæ•´ä¸ª register ä»£ç ä¸­å’Œä¸šåŠ¡é€»è¾‘ç›¸å…³çš„ä»£ç åªæœ‰æœ€å createUser(req.Username, req.PasswordNew, req.Email) è¿™ä¸€è¡Œï¼Œåœ¨è¿™ä¸ªå‡½æ•°é‡Œï¼Œä¸šåŠ¡é€»è¾‘ï¼šéä¸šåŠ¡é€»è¾‘åŸºæœ¬éƒ½å¿« 1:5 äº†ã€‚</p>

<p>å¦‚æœæˆ‘ä»¬æƒ³è¦è®© Register å‡½æ•°çš„æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 100%ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æŠŠæ¯ç§å¯èƒ½çš„é”™è¯¯éƒ½æ„é€ å‡ºæ¥ï¼Œè¿™è¦æ±‚æˆ‘ä»¬å¾—å†™å¤§é‡çš„ test caseï¼Œæ¥å¤„ç†å’Œä¸šåŠ¡é€»è¾‘æ²¡ä»€ä¹ˆå…³ç³»çš„ç”¨æˆ·è¾“å…¥ï¼Œç¨å¾®æœ‰ç‚¹èˆæœ¬é€æœ«ã€‚ä¸Šé¢è¿™æ ·çš„ä¾‹å­ï¼Œå¯èƒ½çš„ç›´æ¥ç»“æœå°±æ˜¯ï¼Œæˆ‘ä»¬çš„ test case æ•°ï¼Œä¸šåŠ¡ç›¸å…³:ä¸šåŠ¡æ— å…³ä¹Ÿæ˜¯ 1:5ã€‚å¦‚æœé¡¹ç›®çš„å…¥å£æ¯”è¾ƒå¤šï¼Œä¼šæœ‰å¾ˆå¤šå¾ˆå¤šé‡å¤çš„ test case æ•£è½åœ¨å„ç§åœ°æ–¹ï¼Œå¹¶ä¸æ˜¯å¾ˆå¥½ç»´æŠ¤ã€‚</p>

<p>é”™è¯¯å¤„ç†ä»£ç å æ¯”å¤ªé«˜çš„æƒ…å†µä¸‹ï¼Œç¢°ä¸Šå·é¸¡ç¨‹åºå‘˜ç”šè‡³å¯ä»¥åœ¨ä¸å†™ä»»ä½•é€»è¾‘ä»£ç æµ‹è¯•çš„æƒ…å†µä¸‹ï¼Œåªæ„é€ é”™è¯¯è¾“å…¥å°±è®©è¯¥æ–‡ä»¶çš„å±€éƒ¨è¦†ç›–ç‡ä¸Šå‡åˆ° 80%ã€‚</p>

<p>å½“ç„¶ï¼Œæˆ‘ä»¬ç”¨ validator çš„è¯å°±æ²¡è¿™ä¹ˆéº»çƒ¦äº†ï¼Œå› ä¸º validate æœ¬æ¥ä¹Ÿåªæœ‰ä¸€è¡Œï¼š</p>

<p>err := v.validate(req)
if err != nil {
    return err
}
è¿™æ ·æˆ‘ä»¬åªè¦å¯¹ validator æœ¬èº«è¿›è¡Œå¤§é‡ä¸¥æ ¼çš„æµ‹è¯•ï¼Œç”šè‡³å¯èƒ½æ˜¯å„ç§ fuzz testã€‚å°±ä¸ç”¨åœ¨ä¸šåŠ¡é¡¹ç›®é‡Œå»å†™å¤ªå¤šä¸šåŠ¡æ— å…³çš„ case äº†ã€‚è¿™é‡Œæš´éœ²å‡ºæ¥çš„é—®é¢˜ï¼Œä¸»è¦è¿˜æ˜¯ Go æœ¬èº«é”™è¯¯å¤„ç†çš„é—®é¢˜ï¼Œ
<!-- more -->
https://mp.weixin.qq.com/s/5KMqKgHC7demT1WeqrAt6A</p>
:ET