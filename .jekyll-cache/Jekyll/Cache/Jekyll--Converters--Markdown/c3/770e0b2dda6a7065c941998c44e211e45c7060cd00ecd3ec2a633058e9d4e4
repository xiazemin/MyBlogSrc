I"Ú3<p>å¦‚ä½•ä¼˜é›…çš„å…³é—­httpæœåŠ¡åœ¨Go Webå¼€å‘ä¸­ä¸€ç›´è¢«æåŠå’Œè®¨è®ºçš„è¯é¢˜ï¼Œä»Šå¤©Go 1.8çš„å‘å¸ƒç»ˆäºä¸ºæˆ‘ä»¬å¸¦æ¥äº†è¿™ä¸ªç‰¹æ€§ã€‚</p>

<p>æ–‡æ¡£ä¸­æ˜¯è¿™æ ·ä»‹ç»çš„ï¼š</p>

<p>func (srv *Server) Shutdown(ctx context.Context) error
Shutdown å°†æ— ä¸­æ–­çš„å…³é—­æ­£åœ¨æ´»è·ƒçš„è¿æ¥ï¼Œç„¶åå¹³æ»‘çš„åœæ­¢æœåŠ¡ã€‚å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p>

<p>é¦–å…ˆå…³é—­æ‰€æœ‰çš„ç›‘å¬</p>

<p>ç„¶åå…³é—­æ‰€æœ‰çš„ç©ºé—²è¿æ¥</p>

<p>ç„¶åæ— é™æœŸç­‰å¾…è¿æ¥å¤„ç†å®Œæ¯•è½¬ä¸ºç©ºé—²ï¼Œå¹¶å…³é—­</p>

<p>å¦‚æœæä¾›äº† å¸¦æœ‰è¶…æ—¶çš„Contextï¼Œå°†åœ¨æœåŠ¡å…³é—­å‰è¿”å› Contextçš„è¶…æ—¶é”™è¯¯</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒShutdown å¹¶ä¸å°è¯•å…³é—­æˆ–è€…ç­‰å¾… hijackedè¿æ¥ï¼Œå¦‚ WebSocketsã€‚å¦‚æœéœ€è¦çš„è¯è°ƒç”¨è€…éœ€è¦åˆ†åˆ«å¤„ç†è¯¸å¦‚é•¿è¿æ¥ç±»å‹çš„ç­‰å¾…å’Œå…³é—­ã€‚</p>

<p>å…¶å®ï¼Œä½ åªè¦è°ƒç”¨ Shutdown æ–¹æ³•å°±å¥½äº†ã€‚</p>

<p>https://github.com/facebookarchive/grace
https://github.com/fvbock/endless
https://github.com/jpillora/overseer
<!-- more -->
graceä¾‹å­ https://github.com/facebookgo/grace/blob/master/gracedemo/demo.go
endlessä¾‹å­ https://github.com/fvbock/endless/tree/master/examples
overseerä¾‹å­ https://github.com/jpillora/overseer/tree/master/example
æˆ‘ä»¬å‚è€ƒå®˜æ–¹çš„ä¾‹å­åˆ†åˆ«æ¥å†™ä¸‹ç”¨æ¥å¯¹æ¯”çš„ä¾‹å­ï¼š</p>

<p>grace
package main</p>

<p>import (
    â€œtimeâ€
    â€œnet/httpâ€
    â€œgithub.com/facebookgo/grace/gracehttpâ€
)</p>

<p>func main() {
    gracehttp.Serve(
        &amp;http.Server{Addr: â€œ:5001â€, Handler: newGraceHandler()},
        &amp;http.Server{Addr: â€œ:5002â€, Handler: newGraceHandler()},
    )
}</p>

<p>func newGraceHandler() http.Handler {
    mux := http.NewServeMux()
    mux.HandleFunc(â€œ/sleepâ€, func(w http.ResponseWriter, r *http.Request) {
        duration, err := time.ParseDuration(r.FormValue(â€œdurationâ€))
        if err != nil {
            http.Error(w, err.Error(), 400)
            return
        }
        time.Sleep(duration)
        w.Write([]byte(â€œHello Worldâ€))
    })
    return mux
}
endless
package main</p>

<p>import (
    â€œlogâ€
    â€œnet/httpâ€
    â€œosâ€
    â€œsyncâ€
    â€œtimeâ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"github.com/fvbock/endless"
"github.com/gorilla/mux" )
</code></pre></div></div>

<p>func handler(w http.ResponseWriter, r *http.Request) {
    duration, err := time.ParseDuration(r.FormValue(â€œdurationâ€))
    if err != nil {
        http.Error(w, err.Error(), 400)
        return
    }
    time.Sleep(duration)
    w.Write([]byte(â€œHello Worldâ€))
}</p>

<p>func main() {
    mux1 := mux.NewRouter()
    mux1.HandleFunc(â€œ/sleepâ€, handler)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>w := sync.WaitGroup{}
w.Add(2)
go func() {
    err := endless.ListenAndServe(":5003", mux1)
    if err != nil {
        log.Println(err)
    }
    log.Println("Server on 5003 stopped")
    w.Done()
}()
go func() {
    err := endless.ListenAndServe(":5004", mux1)
    if err != nil {
        log.Println(err)
    }
    log.Println("Server on 5004 stopped")
    w.Done()
}()
w.Wait()
log.Println("All servers stopped. Exiting.")

os.Exit(0) } overseer package main
</code></pre></div></div>

<p>import (
    â€œfmtâ€
    â€œnet/httpâ€
    â€œtimeâ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"github.com/jpillora/overseer" )
</code></pre></div></div>

<p>//see example.sh for the use-case</p>

<p>// BuildID is compile-time variable
var BuildID = â€œ0â€</p>

<p>//convert your â€˜main()â€™ into a â€˜prog(state)â€™
//â€™prog()â€™ is run in a child process
func prog(state overseer.State) {
    fmt.Printf(â€œapp#%s (%s) listeningâ€¦\nâ€, BuildID, state.ID)
    http.Handle(â€œ/â€, http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        duration, err := time.ParseDuration(r.FormValue(â€œdurationâ€))
        if err != nil {
            http.Error(w, err.Error(), 400)
            return
        }
        time.Sleep(duration)
        w.Write([]byte(â€œHello Worldâ€))
        fmt.Fprintf(w, â€œapp#%s (%s) says hello\nâ€, BuildID, state.ID)
    }))
    http.Serve(state.Listener, nil)
    fmt.Printf(â€œapp#%s (%s) exitingâ€¦\nâ€, BuildID, state.ID)
}</p>

<p>//then create another â€˜mainâ€™ which runs the upgrades
//â€™main()â€™ is run in the initial process
func main() {
    overseer.Run(overseer.Config{
        Program: prog,
        Addresses: []string{â€œ:5005â€, â€œ:5006â€},
        //Fetcher: &amp;fetcher.File{Path: â€œmy_app_nextâ€},
        Debug:   false, //display log of overseer actions
    })
}
å¯¹æ¯”
å¯¹æ¯”ç¤ºä¾‹çš„æ“ä½œæ­¥éª¤
åˆ†åˆ«æ„å»ºä¸Šé¢çš„ç¤ºä¾‹ï¼Œå¹¶è®°å½•pid
è°ƒç”¨APIï¼Œåœ¨å…¶æœªè¿”å›æ—¶ï¼Œä¿®æ”¹å†…å®¹(Hello World -&gt; Hello Harry)ï¼Œé‡æ–°æ„å»ºã€‚æŸ¥çœ‹æ—§APIæ˜¯å¦è¿”å›æ—§çš„å†…å®¹
è°ƒç”¨æ–°APIï¼ŒæŸ¥çœ‹è¿”å›çš„å†…å®¹æ˜¯å¦æ˜¯æ–°çš„å†…å®¹
æŸ¥çœ‹å½“å‰è¿è¡Œçš„pidï¼Œæ˜¯å¦ä¸ä¹‹å‰ä¸€è‡´
ä¸‹é¢ç»™ä¸€ä¸‹æ“ä½œå‘½ä»¤</p>

<h1 id="ç¬¬ä¸€æ¬¡æ„å»ºé¡¹ç›®">ç¬¬ä¸€æ¬¡æ„å»ºé¡¹ç›®</h1>
<p>go build grace.go</p>
<h1 id="è¿è¡Œé¡¹ç›®è¿™æ—¶å°±å¯ä»¥åšå†…å®¹ä¿®æ”¹äº†">è¿è¡Œé¡¹ç›®ï¼Œè¿™æ—¶å°±å¯ä»¥åšå†…å®¹ä¿®æ”¹äº†</h1>
<p>./grace &amp;</p>
<h1 id="è¯·æ±‚é¡¹ç›®60såè¿”å›">è¯·æ±‚é¡¹ç›®ï¼Œ60såè¿”å›</h1>
<p>curl â€œhttp://127.0.0.1:5001/sleep?duration=60sâ€ &amp;</p>
<h1 id="å†æ¬¡æ„å»ºé¡¹ç›®è¿™é‡Œæ˜¯æ–°å†…å®¹">å†æ¬¡æ„å»ºé¡¹ç›®ï¼Œè¿™é‡Œæ˜¯æ–°å†…å®¹</h1>
<p>go build grace.go</p>
<h1 id="é‡å¯2096ä¸ºpid">é‡å¯ï¼Œ2096ä¸ºpid</h1>
<p>kill -USR2 2096</p>
<h1 id="æ–°apiè¯·æ±‚">æ–°APIè¯·æ±‚</h1>
<p>curl â€œhttp://127.0.0.1:5001/sleep?duration=1sâ€</p>

<h1 id="ç¬¬ä¸€æ¬¡æ„å»ºé¡¹ç›®-1">ç¬¬ä¸€æ¬¡æ„å»ºé¡¹ç›®</h1>
<p>go build endless.go</p>
<h1 id="è¿è¡Œé¡¹ç›®è¿™æ—¶å°±å¯ä»¥åšå†…å®¹ä¿®æ”¹äº†-1">è¿è¡Œé¡¹ç›®ï¼Œè¿™æ—¶å°±å¯ä»¥åšå†…å®¹ä¿®æ”¹äº†</h1>
<p>./endless &amp;</p>
<h1 id="è¯·æ±‚é¡¹ç›®60såè¿”å›-1">è¯·æ±‚é¡¹ç›®ï¼Œ60såè¿”å›</h1>
<p>curl â€œhttp://127.0.0.1:5003/sleep?duration=60sâ€ &amp;</p>
<h1 id="å†æ¬¡æ„å»ºé¡¹ç›®è¿™é‡Œæ˜¯æ–°å†…å®¹-1">å†æ¬¡æ„å»ºé¡¹ç›®ï¼Œè¿™é‡Œæ˜¯æ–°å†…å®¹</h1>
<p>go build endless.go</p>
<h1 id="é‡å¯22072ä¸ºpid">é‡å¯ï¼Œ22072ä¸ºpid</h1>
<p>kill -1 22072</p>
<h1 id="æ–°apiè¯·æ±‚-1">æ–°APIè¯·æ±‚</h1>
<p>curl â€œhttp://127.0.0.1:5003/sleep?duration=1sâ€</p>

<h1 id="ç¬¬ä¸€æ¬¡æ„å»ºé¡¹ç›®-2">ç¬¬ä¸€æ¬¡æ„å»ºé¡¹ç›®</h1>
<p>go build -ldflags â€˜-X main.BuildID=1â€™ overseer.go</p>
<h1 id="è¿è¡Œé¡¹ç›®è¿™æ—¶å°±å¯ä»¥åšå†…å®¹ä¿®æ”¹äº†-2">è¿è¡Œé¡¹ç›®ï¼Œè¿™æ—¶å°±å¯ä»¥åšå†…å®¹ä¿®æ”¹äº†</h1>
<p>./overseer &amp;</p>
<h1 id="è¯·æ±‚é¡¹ç›®60såè¿”å›-2">è¯·æ±‚é¡¹ç›®ï¼Œ60såè¿”å›</h1>
<p>curl â€œhttp://127.0.0.1:5005/sleep?duration=60sâ€ &amp;</p>
<h1 id="å†æ¬¡æ„å»ºé¡¹ç›®è¿™é‡Œæ˜¯æ–°å†…å®¹æ³¨æ„ç‰ˆæœ¬å·ä¸åŒäº†">å†æ¬¡æ„å»ºé¡¹ç›®ï¼Œè¿™é‡Œæ˜¯æ–°å†…å®¹ï¼Œæ³¨æ„ç‰ˆæœ¬å·ä¸åŒäº†</h1>
<p>go build -ldflags â€˜-X main.BuildID=2â€™ overseer.go</p>
<h1 id="é‡å¯28300ä¸ºä¸»è¿›ç¨‹pid">é‡å¯ï¼Œ28300ä¸ºä¸»è¿›ç¨‹pid</h1>
<p>kill -USR2 28300</p>
<h1 id="æ–°apiè¯·æ±‚-2">æ–°APIè¯·æ±‚</h1>
<p>curl â€œhttp://127.0.0.1:5005/sleep?duration=1sâ€
å¯¹æ¯”ç»“æœ
ç¤ºä¾‹	æ—§APIè¿”å›å€¼	æ–°APIè¿”å›å€¼	æ—§pid	æ–°pid	ç»“è®º
grace	Hello world	Hello Harry	2096	3100	æ—§APIä¸ä¼šæ–­æ‰ï¼Œä¼šæ‰§è¡ŒåŸæ¥çš„é€»è¾‘ï¼Œpidä¼šå˜åŒ–
endless	Hello world	Hello Harry	22072	22365	æ—§APIä¸ä¼šæ–­æ‰ï¼Œä¼šæ‰§è¡ŒåŸæ¥çš„é€»è¾‘ï¼Œpidä¼šå˜åŒ–
overseer	Hello world	Hello Harry	28300	28300	æ—§APIä¸ä¼šæ–­æ‰ï¼Œä¼šæ‰§è¡ŒåŸæ¥çš„é€»è¾‘ï¼Œä¸»è¿›ç¨‹pidä¸ä¼šå˜åŒ–
åŸç†åˆ†æ
å¯ä»¥çœ‹å‡ºgraceå’Œendlessæ˜¯æ¯”è¾ƒåƒçš„ã€‚</p>

<p>ç›‘å¬ä¿¡å·
æ”¶åˆ°ä¿¡å·æ—¶forkå­è¿›ç¨‹ï¼ˆä½¿ç”¨ç›¸åŒçš„å¯åŠ¨å‘½ä»¤ï¼‰ï¼Œå°†æœåŠ¡ç›‘å¬çš„socketæ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å­è¿›ç¨‹
å­è¿›ç¨‹ç›‘å¬çˆ¶è¿›ç¨‹çš„socketï¼Œè¿™ä¸ªæ—¶å€™çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½å¯ä»¥æ¥æ”¶è¯·æ±‚
å­è¿›ç¨‹å¯åŠ¨æˆåŠŸä¹‹åï¼Œçˆ¶è¿›ç¨‹åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥ï¼Œç­‰å¾…æ—§è¿æ¥å¤„ç†å®Œæˆï¼ˆæˆ–è¶…æ—¶ï¼‰
çˆ¶è¿›ç¨‹é€€å‡ºï¼Œå‡çº§å®Œæˆ
overseeræ˜¯ä¸graceå’Œendlessæœ‰äº›ä¸åŒï¼Œä¸»è¦æ˜¯ä¸¤ç‚¹ï¼š</p>

<p>overseeræ·»åŠ äº†Fetcherï¼Œå½“Fetcherè¿”å›æœ‰æ•ˆçš„äºŒè¿›ä½æµ(io.Reader) æ—¶ï¼Œä¸»è¿›ç¨‹ä¼šå°†å®ƒä¿å­˜åˆ°ä¸´æ—¶ä½ç½®å¹¶éªŒè¯å®ƒï¼Œæ›¿æ¢å½“å‰çš„äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å¯åŠ¨ã€‚
Fetcherè¿è¡Œåœ¨ä¸€ä¸ªgoroutineä¸­ï¼Œé¢„å…ˆä¼šé…ç½®å¥½æ£€æŸ¥çš„é—´éš”æ—¶é—´ã€‚Fetcheræ”¯æŒFileã€GitHubã€HTTPå’ŒS3çš„æ–¹å¼ã€‚è¯¦ç»†å¯æŸ¥çœ‹åŒ…package fetcher
overseeræ·»åŠ äº†ä¸€ä¸ªä¸»è¿›ç¨‹ç®¡ç†å¹³æ»‘é‡å¯ã€‚å­è¿›ç¨‹å¤„ç†è¿æ¥ï¼Œèƒ½å¤Ÿä¿æŒä¸»è¿›ç¨‹pidä¸å˜ã€‚</p>

<p>è‡ªå·±å®ç°
æˆ‘ä»¬ä¸‹é¢æ¥å°è¯•è‡ªå·±å®ç°ä¸‹ç¬¬ä¸€ç§å¤„ç†ï¼Œä»£ç å¦‚ä¸‹ï¼Œä»£ç æ¥è‡ªã€Šçƒ­é‡å¯golangæœåŠ¡å™¨ã€‹ï¼š</p>

<p>package main
import (
    â€œcontextâ€
    â€œerrorsâ€
    â€œflagâ€
    â€œlogâ€
    â€œnetâ€
    â€œnet/httpâ€
    â€œosâ€
    â€œos/execâ€
    â€œos/signalâ€
    â€œsyscallâ€
    â€œtimeâ€
)</p>

<p>var (
    server   *http.Server
    listener net.Listener
    graceful = flag.Bool(â€œgracefulâ€, false, â€œlisten on fd open 3 (internal use only)â€)
)</p>

<p>func sleep(w http.ResponseWriter, r *http.Request) {
    duration, err := time.ParseDuration(r.FormValue(â€œdurationâ€))
    if err != nil {
        http.Error(w, err.Error(), 400)
        return
    }
    time.Sleep(duration)
    w.Write([]byte(â€œHello Worldâ€))
}</p>

<p>func main() {
    flag.Parse()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http.HandleFunc("/sleep", sleep)
server = &amp;http.Server{Addr: ":5007"}

var err error
if *graceful {
    log.Print("main: Listening to existing file descriptor 3.")
    // cmd.ExtraFiles: If non-nil, entry i becomes file descriptor 3+i.
    // when we put socket FD at the first entry, it will always be 3(0+3)
    f := os.NewFile(3, "")
    listener, err = net.FileListener(f)
} else {
    log.Print("main: Listening on a new file descriptor.")
    listener, err = net.Listen("tcp", server.Addr)
}

if err != nil {
    log.Fatalf("listener error: %v", err)
}

go func() {
    // server.Shutdown() stops Serve() immediately, thus server.Serve() should not be in main goroutine
    err = server.Serve(listener)
    log.Printf("server.Serve err: %v\n", err)
}()
signalHandler()
log.Printf("signal end") }
</code></pre></div></div>

<p>func reload() error {
    tl, ok := listener.(*net.TCPListener)
    if !ok {
        return errors.New(â€œlistener is not tcp listenerâ€)
    }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>f, err := tl.File()
if err != nil {
    return err
}

args := []string{"-graceful"}
cmd := exec.Command(os.Args[0], args...)
cmd.Stdout = os.Stdout
cmd.Stderr = os.Stderr
// put socket FD at the first entry
cmd.ExtraFiles = []*os.File{f}
return cmd.Start() }
</code></pre></div></div>

<p>func signalHandler() {
    ch := make(chan os.Signal, 1)
    signal.Notify(ch, syscall.SIGINT, syscall.SIGTERM, syscall.SIGUSR2)
    for {
        sig := &lt;-ch
        log.Printf(â€œsignal: %vâ€, sig)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    // timeout context for shutdown
    ctx, _ := context.WithTimeout(context.Background(), 100*time.Second)
    switch sig {
    case syscall.SIGINT, syscall.SIGTERM:
        // stop
        log.Printf("stop")
        signal.Stop(ch)
        server.Shutdown(ctx)
        log.Printf("graceful shutdown")
        return
    case syscall.SIGUSR2:
        // reload
        log.Printf("reload")
        err := reload()
        if err != nil {
            log.Fatalf("graceful restart error: %v", err)
        }
        server.Shutdown(ctx)
        log.Printf("graceful reload")
        return
    }
}
</code></pre></div></div>

<p>åŸç†
çƒ­é‡å¯çš„åŸç†éå¸¸ç®€å•ï¼Œä½†æ˜¯æ¶‰åŠåˆ°ä¸€äº›ç³»ç»Ÿè°ƒç”¨ä»¥åŠçˆ¶å­è¿›ç¨‹ä¹‹é—´æ–‡ä»¶å¥æŸ„çš„ä¼ é€’ç­‰ç­‰ç»†èŠ‚æ¯”è¾ƒå¤šã€‚
å¤„ç†è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>

<p>ç›‘å¬ä¿¡å·ï¼ˆUSR2ï¼‰
æ”¶åˆ°ä¿¡å·æ—¶forkå­è¿›ç¨‹ï¼ˆä½¿ç”¨ç›¸åŒçš„å¯åŠ¨å‘½ä»¤ï¼‰ï¼Œå°†æœåŠ¡ç›‘å¬çš„socketæ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å­è¿›ç¨‹
å­è¿›ç¨‹ç›‘å¬çˆ¶è¿›ç¨‹çš„socketï¼Œè¿™ä¸ªæ—¶å€™çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½å¯ä»¥æ¥æ”¶è¯·æ±‚
å­è¿›ç¨‹å¯åŠ¨æˆåŠŸä¹‹åï¼Œçˆ¶è¿›ç¨‹åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥ï¼Œç­‰å¾…æ—§è¿æ¥å¤„ç†å®Œæˆï¼ˆæˆ–è¶…æ—¶ï¼‰
çˆ¶è¿›ç¨‹é€€å‡ºï¼Œå‡çº§å®Œæˆ
ç»†èŠ‚
çˆ¶è¿›ç¨‹å°†socketæ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å­è¿›ç¨‹å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œï¼Œæˆ–è€…ç¯å¢ƒå˜é‡ç­‰
å­è¿›ç¨‹å¯åŠ¨æ—¶ä½¿ç”¨å’Œçˆ¶è¿›ç¨‹ä¸€æ ·çš„å‘½ä»¤è¡Œï¼Œå¯¹äºgolangæ¥è¯´ç”¨æ›´æ–°çš„å¯æ‰§è¡Œç¨‹åºè¦†ç›–æ—§ç¨‹åº
server.Shutdown()ä¼˜é›…å…³é—­æ–¹æ³•æ˜¯go1.8çš„æ–°ç‰¹æ€§
server.Serve(l)æ–¹æ³•åœ¨Shutdownæ—¶ç«‹å³è¿”å›ï¼ŒShutdownæ–¹æ³•åˆ™é˜»å¡è‡³contextå®Œæˆï¼Œæ‰€ä»¥Shutdownçš„æ–¹æ³•è¦å†™åœ¨ä¸»goroutineä¸­</p>

<p>systemd &amp; supervisor
çˆ¶è¿›ç¨‹é€€å‡ºä¹‹åï¼Œå­è¿›ç¨‹ä¼šæŒ‚åˆ°1å·è¿›ç¨‹ä¸Šé¢ã€‚è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨systemdå’Œsupervisordç­‰ç®¡ç†ç¨‹åºä¼šæ˜¾ç¤ºè¿›ç¨‹å¤„äºfailedçš„çŠ¶æ€ã€‚è§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p>

<p>ä½¿ç”¨pidfileï¼Œæ¯æ¬¡è¿›ç¨‹é‡å¯æ›´æ–°ä¸€ä¸‹pidfileï¼Œè®©è¿›ç¨‹ç®¡ç†è€…é€šè¿‡è¿™ä¸ªæ–‡ä»¶æ„ŸçŸ¥åˆ°mainpidçš„å˜æ›´ã€‚
èµ·ä¸€ä¸ªmasteræ¥ç®¡ç†æœåŠ¡è¿›ç¨‹ï¼Œæ¯æ¬¡çƒ­é‡å¯masteræ‹‰èµ·ä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼ŒæŠŠæ—§çš„killæ‰ã€‚è¿™æ—¶masterçš„pidæ²¡æœ‰å˜åŒ–ï¼Œå¯¹äºè¿›ç¨‹ç®¡ç†è€…æ¥è¯´è¿›ç¨‹å¤„äºæ­£å¸¸çš„çŠ¶æ€ã€‚</p>
:ET