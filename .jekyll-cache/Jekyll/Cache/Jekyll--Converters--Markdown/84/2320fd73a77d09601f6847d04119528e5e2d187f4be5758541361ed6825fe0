I"ú<p>æ”¹å†™æ–‡ä»¶
æœ€ç®€å•çš„åŠ é€Ÿæ˜¯æ”¹å†™ Dockerfile,
å› ä¸º Dockerfile ä¸­çš„ä¸€äº›å‘½ä»¤ (ADD/COPY/RUN) ä¼šäº§ç”Ÿæ–°çš„ layer,
è€Œ Docker ä¼šè‡ªåŠ¨è·³è¿‡å·²ç»æ„å»ºå¥½çš„ layerã€‚
æ‰€ä»¥ä¸€èˆ¬ä¼˜åŒ–çš„åŸåˆ™åŸºäºä»¥ä¸‹å‡ ç‚¹ï¼š</p>

<p>å˜åŠ¨è¶Šå°çš„å‘½ä»¤ï¼Œè¶Šé å‰ï¼Œå¢åŠ  cache ä½¿ç”¨ç‡ã€‚
åˆå¹¶ç›®çš„ç›¸åŒçš„å‘½ä»¤ï¼Œå‡å°‘ layer å±‚æ•°ã€‚
ä½¿ç”¨å›½å†…æºï¼Œæˆ–è€…å†…ç½‘æœåŠ¡åŠ é€Ÿæ„å»ºã€‚
å°‘è£…äº›ä¸œè¥¿ï¼Œä¸æ˜¯ä»£ç ä¾èµ–çš„å°±å°½é‡åˆ«è£…äº†â€¦
è®°å¾—åŠ ä¸Šåˆé€‚çš„æ³¨é‡Šï¼Œä»¥ä¾¿æ—¥åçš„ç»´æŠ¤ã€‚</p>

<p>æ”¹è¿‡ä»¥åçš„ç‰ˆæœ¬ï¼Œ
å¼€å‘è€…å°å‘¨å‘ç°ï¼Œ
æ¯æ¬¡æœ¬åœ°æ”¹å®Œä»£ç  build è°ƒè¯•éƒ½é£å¿«ï¼Œ
ä»–å¾ˆæ»¡æ„ã€‚</p>

<p>ä½†æ˜¯ç”¨å…¬å¸çš„åˆ†å¸ƒå¼ gitlab runner æ„å»ºä»¥åï¼Œ
ä»–å‘ç°ï¼š
æœ‰æ—¶é•œåƒæ²¡ç”¨åˆ° cacheï¼Œåˆè·‘äº†ä¸€éæ¼«é•¿çš„æ„å»ºè¿‡ç¨‹ã€‚</p>

<p>åˆ†å¸ƒå¼æ„å»º
åœ¨ codebase è¶³å¤Ÿå¤§çš„æƒ…å†µä¸‹ï¼Œ
CI/CD ä¸€èˆ¬éƒ½æ˜¯åˆ†å¸ƒå¼å¤šå°æœºå™¨çš„ï¼Œ
é»˜è®¤çš„ docker build åªä¼šä»æœ¬åœ°å¯»æ‰¾ cache layer,
æ— æ³•åº”å¯¹å¦‚æ­¤å¤æ‚çš„åœºé¢ã€‚</p>

<p>ç®€å•çš„åŠæ³•æ˜¯ä½¿ç”¨ docker build â€“cache-from æŒ‡å®šé•œåƒï¼Œ
æˆ‘ä»¬ä¼šåœ¨ ci è„šæœ¬ä¸­è¿™ä¹ˆå†™ï¼š</p>

<p>docker pull LKI/code:latest || true
docker build . -t LKI/code:latest â€“cache-from LKI/code:latest
docker push LKI/code:latest
ä½†æ˜¯è¿™æ ·æ‰‹å†™çš„å¼Šç«¯æ˜¯é€»è¾‘æ¯”è¾ƒè‡ƒè‚¿ï¼Œ
æ¯”å¦‚è¦å®Œç¾é€‚é…å¤šåˆ†æ”¯æ„å»º (dev/master/hotfix/release) çš„è¯ï¼Œ
å¾€å¾€å°±è¦è‡ªå·±å®ç°ä¸€å¥—åˆ¤æ–­ç©¶ç«Ÿ cache from å“ªä¸ªç‰ˆæœ¬çš„é€»è¾‘ã€‚</p>

<p>æ›´é€šç”¨çš„åŠæ³•æ˜¯ä½¿ç”¨ç±»ä¼¼ GoogleContainerTools/kaniko è¿™æ ·çš„å·¥å…·æ¥æ„å»ºã€‚
<!-- more -->
https://zhuanlan.zhihu.com/p/134810126</p>

<p>https://github.com/GoogleContainerTools/kaniko</p>

<p>https://github.com/golang/go/issues/35702</p>

<p>https://stackoverflow.com/questions/64462922/docker-multi-stage-build-go-image-x509-certificate-signed-by-unknown-authorit</p>

<p>https://blog.csdn.net/weixin_43983808/article/details/117661315</p>

<p>https://blog.csdn.net/zhangka002/article/details/107867356</p>

<p>https://www.cnblogs.com/YYRise/p/11589335.html</p>
:ET