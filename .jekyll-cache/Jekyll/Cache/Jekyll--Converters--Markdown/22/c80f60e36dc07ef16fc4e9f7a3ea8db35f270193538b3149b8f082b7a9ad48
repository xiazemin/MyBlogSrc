I"€<p>Goç¯å¢ƒæ­å»º
rootè´¦æˆ·
ä¸‹è½½Golang
[root@infra2-test-k8s /]# cd /usr/local/</p>

<p>[root@infra2-test-k8s local]# wget https://dl.google.com/go/go1.14.4.linux-amd64.tar.gz</p>

<p>[root@infra2-test-k8s local]# tar -xzvf go1.14.4.linux-amd64.tar.gz 
åˆ›å»ºGoç›®å½•
[root@infra2-test-k8s local]# cd /</p>

<p>[root@infra2-test-k8s /]# mkdir go
é…ç½®ç¯å¢ƒå˜é‡å¹¶è®¾ç½®ä»£ç†
[root@infra2-test-k8s /]# vim /etc/profile</p>

<h1 id="æ·»åŠ ä»¥ä¸‹å†…å®¹">æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</h1>
<p>export GOROOT=/usr/local/go
export PATH=$PATH:$GOROOT/bin
export GOPATH=/go
export GO111MODULE=auto
export GOPROXY=https://goproxy.cn,direct</p>

<h1 id="ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ">ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</h1>
<p>[root@infra2-test-k8s /]# source /etc/profile</p>

<h1 id="æ ¡éªŒ">æ ¡éªŒ</h1>
<p>[root@infra2-test-k8s /]# go version
go version go1.14.4 linux/amd64
[root@infra2-test-k8s /]# go env
<!-- more -->
Jenkinsé…ç½®Golangç¯å¢ƒ
ä¸‹è½½Goæ’ä»¶
åœ¨æ’ä»¶ç®¡ç†çš„å¯é€‰æ’ä»¶ä¸­æœç´¢Goç„¶åç‚¹å‡»ç›´æ¥å®‰è£…ï¼Œå®‰è£…å®Œæ¯•ä¹‹åéœ€è¦é‡å¯jenkinsã€‚
file</p>

<p>é…ç½®Goç¯å¢ƒ
ç³»ç»Ÿç®¡ç†&gt;å…¨å±€å·¥å…·é…ç½®&gt;Go&gt;Goå®‰è£…
å»æ‰è‡ªåŠ¨å®‰è£…çš„å‹¾é€‰ï¼Œç„¶ååˆ«åï¼šgo1.14.4ï¼Œå®‰è£…ç›®å½•ï¼š/usr/local/go
file
å¦‚æœå‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š</p>

<p>go: command not found
è§£å†³åŠæ³•ï¼š</p>

<p>[root@infra2-test-k8s bin]# ln -s /usr/local/go/bin/go /usr/bin/
è¿˜ä¸è¡Œçš„è¯åˆ™å°è¯•å°†ç¯å¢ƒå˜é‡é…ç½®åˆ°jenkinsä¸­ï¼š</p>

<p>GOROOT=/usr/local/go
PATH=/sbin:/usr/sbin:/bin:/usr/bin:/usr/local/sbin:/usr/local/jdk1.8.0_231/bin:/opt/apache-maven-3.6.3/bin:/usr/local/go/bin
GOPATH=/go
GO111MODULE=on
GOPROXY=https://goproxy.cn</p>

<p>è·¯å¾„ï¼šç³»ç»Ÿç®¡ç†&gt;ç³»ç»Ÿé…ç½®&gt;ç¯å¢ƒå˜é‡
file</p>

<p>Dockerfile
Dockerfile</p>

<p>FROM docker.io/centos:7</p>

<p>ENV PROJECT_DIR=/opt/docker
ENV TZ=Asia/Shanghai
WORKDIR $PROJECT_DIR</p>

<p>COPY src/dataservice/dataservice $PROJECT_DIR/goapp
COPY src/dataservice/ipipfree.ipdb $PROJECT_DIR/ipipfree.ipdb
COPY src/dataservice/ds.cnf $PROJECT_DIR/ds.cnf
COPY src/dataservice/start.sh $PROJECT_DIR/start.sh</p>

<p>RUN mkdir /opt/logs</p>

<p>RUN chown -R daemon:daemon $PROJECT_DIR
RUN chown -R daemon:daemon /opt/logs</p>

<p>EXPOSE 8080
USER daemon</p>

<p>ENTRYPOINT [â€œshâ€, â€œ/opt/docker/start.shâ€, â€œtestâ€]
start.shï¼š</p>

<p>#!/bin/bash</p>

<p>if [[ $1 == â€˜prodâ€™ ]]
then
   sed -i â€œs/env=.<em>/env=DS_ONLINE/â€ ds.cnf
else
   sed -i â€œs/env=.</em>/env=DS_DEV/â€ ds.cnf
fi</p>

<p>echo â€œå¯åŠ¨åº”ç”¨â€</p>

<p>./goapp &gt; ./nohup.out
build.sh</p>

<p>#!/bin/sh
cd src/dataservice/
pwd
CGO_ENABLED=0  GOOS=linux  GOARCH=amd64 go build -a dataservice.go
å› ä¸ºé¡¹ç›®ç»“æ„æ˜¯ï¼š</p>

<p>dataservice
â”œâ”€â”€ pkg
â”œâ”€â”€ build.sh
â””â”€â”€ src
    â”œâ”€â”€ dataservice
    â”‚   â””â”€â”€ dataservice.go
    â”‚   â””â”€â”€ start.sh
    â”‚   â””â”€â”€ ds.cnf
    â””â”€â”€ go.mod
å¹¶ä¸”ä½¿ç”¨äº†go modleï¼Œå¦‚æœç›´æ¥build src/dataservice/dataservice.goæ–‡ä»¶çš„è¯ä¼šæŠ¥é”™ï¼Œæç¤ºæ‰¾ä¸åˆ°ä¾èµ–çš„åŒ…ï¼Œjenkins pipelineåˆä¸æ”¯æŒcdå‘½ä»¤ï¼Œè¿›ä¸äº†src/dataservice/ç›®å½•ï¼Œåªèƒ½æƒ³äº†ä¸ªæŠ˜ä¸­çš„åŠæ³•ï¼Œä½¿ç”¨build.shè„šæœ¬æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ã€‚</p>

<p>https://www.lifengdi.com/archives/article/1966</p>
:ET