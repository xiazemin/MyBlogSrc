I"³6<p>https://segmentfault.com/a/1190000023691973</p>

<p>https://mp.weixin.qq.com/s/KPrzPP797efFUKOTTfY1Ow</p>

<p>https://mp.weixin.qq.com/s/LqV7ODo7QCRykcFSRMRRgA</p>

<p>å…¶å®ioutilæœ€å¥½ç†è§£ï¼Œå½“æ–‡ä»¶è¾ƒå°æ—¶ï¼Œioutilä½¿ç”¨ReadAllå‡½æ•°å°†æ–‡ä»¶ä¸­æ‰€æœ‰å†…å®¹ç›´æ¥è¯»å…¥å†…å­˜ï¼Œåªè¿›è¡Œäº†ä¸€æ¬¡ioæ“ä½œï¼Œä½†æ˜¯oså’Œbufioéƒ½æ˜¯è¿›è¡Œäº†å¤šæ¬¡è¯»å–ï¼Œæ‰å°†æ–‡ä»¶å¤„ç†å®Œï¼Œæ‰€ä»¥ioutilè‚¯å®šè¦å¿«äºoså’Œbufioçš„ã€‚
ä½†æ˜¯éšç€æ–‡ä»¶çš„å¢å¤§ï¼Œè¾¾åˆ°æ¥è¿‘GBçº§åˆ«æ—¶ï¼Œioutilç›´æ¥è¯»å…¥å†…å­˜çš„å¼Šç«¯å°±æ˜¾ç°å‡ºæ¥ï¼Œè¦å°†GBçº§åˆ«çš„æ–‡ä»¶å†…å®¹å…¨éƒ¨è¯»å…¥å†…å­˜ï¼Œä¹Ÿå°±æ„å‘³ç€è¦å¼€è¾Ÿä¸€å—GBå¤§å°çš„å†…å­˜ç”¨æ¥å­˜æ”¾æ–‡ä»¶æ•°æ®ï¼Œè¿™å¯¹å†…å­˜çš„æ¶ˆè€—æ˜¯éå¸¸å¤§çš„ï¼Œå› æ­¤æ•ˆç‡å°±æ…¢äº†ä¸‹æ¥ã€‚
å¦‚æœæ–‡ä»¶ç»§ç»­å¢å¤§ï¼Œè¾¾åˆ°3GBç”šè‡³ä»¥ä¸Šï¼Œioutilè¿™ç§è¯»å–æ–¹å¼å°±å®Œå…¨æ— èƒ½ä¸ºåŠ›äº†ã€‚ï¼ˆä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ç©ºé—´ä¸º4GBï¼ŒçœŸæ­£å­˜æ”¾æ•°æ®çš„å †åŒºå’Œæ ˆåŒºæ›´æ˜¯è¿œè¿œå°äº4GBï¼‰ã€‚
è€Œosä¸ºä»€ä¹ˆåœ¨é¢å¯¹å¤§æ–‡ä»¶æ—¶ï¼Œæ•ˆç‡ä¼šä½äºbufioï¼Ÿé€šè¿‡æŸ¥çœ‹bufioçš„NewReaderæºç ä¸éš¾å‘ç°ï¼Œåœ¨NewReaderé‡Œï¼Œé»˜è®¤ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¤§å°ä¸º4096çš„ç¼“å†²åŒºï¼Œæ‰€ä»¥ç³»ç»Ÿè°ƒç”¨ä¼šæ¯æ¬¡å…ˆè¯»å–4096å­—èŠ‚åˆ°ç¼“å†²åŒºï¼Œç„¶ård.Readä¼šä»ç¼“å†²åŒºå»è¯»å–ã€‚</p>

<!-- more -->
<p>Goè¯­è¨€åœ¨è¿›è¡Œæ–‡ä»¶æ“ä½œçš„æ—¶å€™ï¼Œå¯ä»¥æœ‰å¤šç§æ–¹æ³•ã€‚æœ€å¸¸è§çš„æ¯”å¦‚ç›´æ¥å¯¹æ–‡ä»¶æœ¬èº«è¿›è¡ŒReadå’ŒWriteï¼› é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨bufioåº“çš„æµå¼å¤„ç†ä»¥åŠåˆ†ç‰‡å¼å¤„ç†ï¼›å¦‚æœæ–‡ä»¶è¾ƒå°ï¼Œä½¿ç”¨ioutilä¹Ÿä¸å¤±ä¸ºä¸€ç§æ–¹æ³•ã€‚</p>

<p>é¢å¯¹è¿™ä¹ˆå¤šçš„æ–‡ä»¶å¤„ç†çš„æ–¹å¼ï¼Œé‚£ä¹ˆåˆå­¦è€…å¯èƒ½å°±ä¼šæœ‰å›°æƒ‘ï¼šæˆ‘åˆ°åº•è¯¥ç”¨é‚£ç§ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç¬”è€…è¯•ç€ä»æ–‡ä»¶è¯»å–æ¥å¯¹goè¯­è¨€çš„å‡ ç§æ–‡ä»¶å¤„ç†æ–¹å¼è¿›è¡Œåˆ†æã€‚</p>

<p>os.Fileã€bufioã€ioutilæ¯”è¾ƒ
æ•ˆç‡æµ‹è¯•
æ–‡ä»¶çš„è¯»å–æ•ˆç‡æ˜¯æ‰€æœ‰å¼€å‘è€…éƒ½ä¼šå…³å¿ƒçš„è¯é¢˜ï¼Œå°¤å…¶æ˜¯å½“æ–‡ä»¶ç‰¹åˆ«å¤§çš„æ—¶å€™ã€‚ä¸ºäº†å°½å¯èƒ½çš„å±•ç¤ºè¿™ä¸‰è€…å¯¹æ–‡ä»¶è¯»å–çš„æ€§èƒ½ï¼Œæˆ‘å‡†å¤‡äº†ä¸‰ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºsmall.txtï¼Œmidium.txtã€large.txtï¼Œåˆ†åˆ«å¯¹åº”KBçº§åˆ«ã€MBçº§åˆ«å’ŒGBçº§åˆ«ã€‚
image.png</p>

<p>è¿™ä¸‰ä¸ªæ–‡ä»¶å¤§å°åˆ†åˆ«ä¸º4KBã€21MBã€1GBã€‚å…¶ä¸­å†…å®¹æ˜¯æ¯”è¾ƒå¸¸è§„çš„jsonæ ¼å¼çš„æ–‡æœ¬ã€‚
æµ‹è¯•ä»£ç å¦‚ä¸‹:</p>

<p>//ä½¿ç”¨Fileè‡ªå¸¦çš„Read
func read1(filename string) int {
    fi, err := os.Open(filename)
    if err != nil {
        panic(err)
    }
    defer fi.Close()
    buf := make([]byte, 4096)
    var nbytes int
    for {
        n, err := fi.Read(buf)
        if err != nil &amp;&amp; err != io.EOF {
            panic(err)
        }
        if n == 0 {
            break
        }
        nbytes += n</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>}
return nbytes } read1å‡½æ•°ä½¿ç”¨çš„æ˜¯osåº“å¯¹æ–‡ä»¶è¿›è¡Œç›´æ¥æ“ä½œï¼Œä¸ºäº†ç¡®å®šç¡®å®éƒ½åˆ°äº†æ–‡ä»¶å†…å®¹ï¼Œå¹¶å°†è¯»åˆ°çš„å¤§å°å­—èŠ‚æ•°è¿”å›ã€‚
</code></pre></div></div>

<p>//ä½¿ç”¨bufio
func read2(filename string) int {
    fi, err := os.Open(filename)
    if err != nil {
        panic(err)
    }
    defer fi.Close()
    buf := make([]byte, 4096)
    var nbytes int
    rd := bufio.NewReader(fi)
    for {
        n, err := rd.Read(buf)
        if err != nil &amp;&amp; err != io.EOF {
            panic(err)
        }
        if n == 0 {
            break
        }
        nbytes += n
    }
    return nbytes
}
read2å‡½æ•°ä½¿ç”¨çš„æ˜¯bufioåº“ï¼Œæ“ä½œNewReaderå¯¹æ–‡ä»¶è¿›è¡Œæµå¼å¤„ç†ï¼Œå’Œå‰é¢ä¸€æ ·ï¼Œä¸ºäº†ç¡®å®šç¡®å®éƒ½åˆ°äº†æ–‡ä»¶å†…å®¹ï¼Œå¹¶å°†è¯»åˆ°çš„å¤§å°å­—èŠ‚æ•°è¿”å›ã€‚</p>

<p>//ä½¿ç”¨ioutil
func read3(filename string) int {
    fi, err := os.Open(filename)
    if err != nil {
        panic(err)
    }
    defer fi.Close()
    fd, err := ioutil.ReadAll(fi)
    nbytes := len(fd)
    return nbytes
}
read3å‡½æ•°æ˜¯ä½¿ç”¨ioutilåº“è¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒæš´åŠ›ï¼Œç›´æ¥å°†æ–‡ä»¶å†…å®¹ä¸€æ¬¡æ€§å…¨éƒ¨è¯»åˆ°å†…å­˜ä¸­ï¼Œç„¶åå¯¹å†…å­˜ä¸­çš„æ–‡ä»¶å†…å®¹è¿›è¡Œç›¸å…³çš„æ“ä½œã€‚
æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹çš„æµ‹è¯•ä»£ç è¿›è¡Œæµ‹è¯•ï¼š</p>

<p>func testfile1(filename string) {
    fmt.Printf(â€œ============test1 %s ===========\nâ€, filename)
    start := time.Now()
    size1 := read1(filename)
    t1 := time.Now()
    fmt.Printf(â€œRead 1 cost: %v, size: %d\nâ€, t1.Sub(start), size1)
    size2 := read2(filename)
    t2 := time.Now()
    fmt.Printf(â€œRead 2 cost: %v, size: %d\nâ€, t2.Sub(t1), size2)
    size3 := read3(filename)
    t3 := time.Now()
    fmt.Printf(â€œRead 3 cost: %v, size: %d\nâ€, t3.Sub(t2), size3)
}
åœ¨mainå‡½æ•°ä¸­è°ƒç”¨å¦‚ä¸‹ï¼š</p>

<p>func main() {
    testfile1(â€œsmall.txtâ€)
    testfile1(â€œmidium.txtâ€)
    testfile1(â€œlarge.txtâ€)
    // testfile2(â€œsmall.txtâ€)
    // testfile2(â€œmidium.txtâ€)
    // testfile2(â€œlarge.txtâ€)
}
æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š
image.png</p>

<p>ä»ä»¥ä¸Šç»“æœå¯çŸ¥ï¼š</p>

<p>å½“æ–‡ä»¶è¾ƒå°ï¼ˆKBçº§åˆ«ï¼‰æ—¶ï¼Œioutil &gt; bufio &gt; osã€‚
å½“æ–‡ä»¶å¤§å°æ¯”è¾ƒå¸¸è§„ï¼ˆMBçº§åˆ«ï¼‰æ—¶ï¼Œä¸‰è€…å·®åˆ«ä¸å¤§ï¼Œä½†bufioåˆæ˜¯å·²ç»æ˜¾ç°å‡ºæ¥ã€‚
å½“æ–‡ä»¶è¾ƒå¤§ï¼ˆGBçº§åˆ«ï¼‰æ—¶ï¼Œbufio &gt; os &gt; ioutilã€‚
åŸå› åˆ†æ
ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸Šé¢çš„ä¸åŒç»“æœï¼Ÿ
å…¶å®ioutilæœ€å¥½ç†è§£ï¼Œå½“æ–‡ä»¶è¾ƒå°æ—¶ï¼Œioutilä½¿ç”¨ReadAllå‡½æ•°å°†æ–‡ä»¶ä¸­æ‰€æœ‰å†…å®¹ç›´æ¥è¯»å…¥å†…å­˜ï¼Œåªè¿›è¡Œäº†ä¸€æ¬¡ioæ“ä½œï¼Œä½†æ˜¯oså’Œbufioéƒ½æ˜¯è¿›è¡Œäº†å¤šæ¬¡è¯»å–ï¼Œæ‰å°†æ–‡ä»¶å¤„ç†å®Œï¼Œæ‰€ä»¥ioutilè‚¯å®šè¦å¿«äºoså’Œbufioçš„ã€‚
ä½†æ˜¯éšç€æ–‡ä»¶çš„å¢å¤§ï¼Œè¾¾åˆ°æ¥è¿‘GBçº§åˆ«æ—¶ï¼Œioutilç›´æ¥è¯»å…¥å†…å­˜çš„å¼Šç«¯å°±æ˜¾ç°å‡ºæ¥ï¼Œè¦å°†GBçº§åˆ«çš„æ–‡ä»¶å†…å®¹å…¨éƒ¨è¯»å…¥å†…å­˜ï¼Œä¹Ÿå°±æ„å‘³ç€è¦å¼€è¾Ÿä¸€å—GBå¤§å°çš„å†…å­˜ç”¨æ¥å­˜æ”¾æ–‡ä»¶æ•°æ®ï¼Œè¿™å¯¹å†…å­˜çš„æ¶ˆè€—æ˜¯éå¸¸å¤§çš„ï¼Œå› æ­¤æ•ˆç‡å°±æ…¢äº†ä¸‹æ¥ã€‚
å¦‚æœæ–‡ä»¶ç»§ç»­å¢å¤§ï¼Œè¾¾åˆ°3GBç”šè‡³ä»¥ä¸Šï¼Œioutilè¿™ç§è¯»å–æ–¹å¼å°±å®Œå…¨æ— èƒ½ä¸ºåŠ›äº†ã€‚ï¼ˆä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ç©ºé—´ä¸º4GBï¼ŒçœŸæ­£å­˜æ”¾æ•°æ®çš„å †åŒºå’Œæ ˆåŒºæ›´æ˜¯è¿œè¿œå°äº4GBï¼‰ã€‚
è€Œosä¸ºä»€ä¹ˆåœ¨é¢å¯¹å¤§æ–‡ä»¶æ—¶ï¼Œæ•ˆç‡ä¼šä½äºbufioï¼Ÿé€šè¿‡æŸ¥çœ‹bufioçš„NewReaderæºç ä¸éš¾å‘ç°ï¼Œåœ¨NewReaderé‡Œï¼Œé»˜è®¤ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¤§å°ä¸º4096çš„ç¼“å†²åŒºï¼Œæ‰€ä»¥ç³»ç»Ÿè°ƒç”¨ä¼šæ¯æ¬¡å…ˆè¯»å–4096å­—èŠ‚åˆ°ç¼“å†²åŒºï¼Œç„¶ård.Readä¼šä»ç¼“å†²åŒºå»è¯»å–ã€‚</p>

<p>const (
    defaultBufSize = 4096
)</p>

<p>func NewReader(rd io.Reader) *Reader {
    return NewReaderSize(rd, defaultBufSize)
}</p>

<p>func NewReaderSize(rd io.Reader, size int) <em>Reader {
    // Is it already a Reader?
    b, ok := rd.(</em>Reader)
    if ok &amp;&amp; len(b.buf) &gt;= size {
        return b
    }
    if size &lt; minReadBufferSize {
        size = minReadBufferSize
    }
    r := new(Reader)
    r.reset(make([]byte, size), rd)
    return r
}
è€Œoså› ä¸ºå°‘äº†è¿™ä¸€å±‚ç¼“å†²åŒºï¼Œæ¯æ¬¡è¯»å–ï¼Œéƒ½ä¼šæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤å†…æ ¸é¢‘ç¹çš„åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´åˆ‡æ¢ï¼Œè€Œè¿™ç§åˆ‡æ¢ï¼Œä¹Ÿæ˜¯éœ€è¦æ¶ˆè€—çš„ï¼Œæ•…è€Œä¼šæ…¢äºbufioçš„è¯»å–æ–¹å¼ã€‚
ç¬”è€…ç¿»é˜…ç½‘ä¸Šèµ„æ–™ï¼Œå…³äºç¼“å†²ï¼Œæœ‰å†…æ ¸ä¸­çš„ç¼“å†²å’Œè¿›ç¨‹ä¸­çš„ç¼“å†²ä¸¤ç§ï¼Œå…¶ä¸­ï¼Œå†…æ ¸ä¸­çš„ç¼“å†²æ˜¯å†…æ ¸æä¾›çš„ï¼Œå³ç³»ç»Ÿå¯¹ç£ç›˜æä¾›ä¸€ä¸ªç¼“å†²åŒºï¼Œä¸ç®¡æœ‰æ²¡æœ‰æä¾›è¿›ç¨‹ä¸­çš„ç¼“å†²ï¼Œå†…æ ¸ç¼“å†²éƒ½æ˜¯å­˜åœ¨çš„ã€‚
è€Œè¿›ç¨‹ä¸­çš„ç¼“å†²æ˜¯å¯¹è¾“å…¥è¾“å‡ºæµåšäº†ä¸€å®šçš„æ”¹è¿›ï¼Œæä¾›çš„ä¸€ç§æµç¼“å†²ï¼Œå®ƒåœ¨è¯»å†™æ“ä½œå‘ç”Ÿæ—¶ï¼Œå…ˆå°†æ•°æ®å­˜å…¥æµç¼“å†²ä¸­ï¼Œåªæœ‰å½“æµç¼“å†²åŒºæ»¡äº†æˆ–è€…åˆ·æ–°ï¼ˆå¦‚è°ƒç”¨flushå‡½æ•°ï¼‰æ—¶ï¼Œæ‰å°†æ•°æ®å–å‡ºï¼Œé€å¾€å†…æ ¸ç¼“å†²åŒºï¼Œå®ƒèµ·åˆ°äº†ä¸€å®šçš„ä¿æŠ¤å†…æ ¸çš„ä½œç”¨ã€‚
å› æ­¤ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œosæ˜¯å…¸å‹çš„å†…æ ¸ä¸­çš„ç¼“å†²ï¼Œè€Œbufioå’Œioutiléƒ½å±äºè¿›ç¨‹ä¸­çš„ç¼“å†²ã€‚</p>

<p>æ€»ç»“
å½“è¯»å–å°æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨ioutilæ•ˆç‡æ˜æ˜¾ä¼˜äºoså’Œbufioï¼Œä½†å¦‚æœæ˜¯å¤§æ–‡ä»¶ï¼Œbufioè¯»å–ä¼šæ›´å¿«ã€‚</p>

<p>è¯»å–ä¸€è¡Œæ•°æ®
å‰é¢ç®€è¦åˆ†æäº†goè¯­è¨€ä¸‰ç§ä¸åŒè¯»å–æ–‡ä»¶æ–¹å¼ä¹‹é—´çš„åŒºåˆ«ã€‚ä½†å®é™…çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯¹æ–‡ä»¶çš„è¯»å–å¾€å¾€æ˜¯ä»¥è¡Œä¸ºå•ä½çš„ï¼Œå³æ¯æ¬¡è¯»å–ä¸€è¡Œè¿›è¡Œå¤„ç†ã€‚
goè¯­è¨€å¹¶æ²¡æœ‰åƒCè¯­è¨€ä¸€æ ·ç»™æˆ‘ä»¬æä¾›å¥½äº†ç±»ä¼¼äºfgetsè¿™æ ·çš„å‡½æ•°å¯ä»¥æ­£å¥½è¯»å–ä¸€è¡Œå†…å®¹ï¼Œå› æ­¤ï¼Œéœ€è¦è‡ªå·±å»å®ç°ã€‚
ä»å‰é¢çš„å¯¹æ¯”åˆ†æå¯ä»¥çŸ¥é“ï¼Œæ— è®ºæ˜¯å¤„ç†å¤§æ–‡ä»¶è¿˜æ˜¯å°æ–‡ä»¶ï¼Œbufioå§‹ç»ˆæ˜¯æœ€ä¸ºå¹³æ»‘å’Œé«˜æ•ˆçš„ï¼Œå› æ­¤æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨bufioåº“è¿›è¡Œå¤„ç†ã€‚
ç¿»é˜…bufioåº“çš„æºç ï¼Œå‘ç°å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‡ ç§æ–¹å¼è¿›è¡Œè¯»å–ä¸€è¡Œæ–‡ä»¶çš„å¤„ç†ï¼š</p>

<p>ReadBytes
ReadString
ReadSlice
ReadLine
æ•ˆç‡æµ‹è¯•
åœ¨è®¨è®ºè¿™å››ç§è¯»å–ä¸€è¡Œæ–‡ä»¶æ“ä½œçš„å‡½æ•°ä¹‹å‰ï¼Œä»ç„¶åšä¸€ä¸‹æ•ˆç‡æµ‹è¯•ã€‚
æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>

<p>func readline1(filename string) {
    fi, err := os.Open(filename)
    if err != nil {
        panic(err)
    }
    defer fi.Close()
    rd := bufio.NewReader(fi)
    for {
        _, err := rd.ReadBytes(â€˜\nâ€™)
        if err != nil || err == io.EOF {
            break
        }
    }
}</p>

<p>func readline2(filename string) {
    fi, err := os.Open(filename)
    if err != nil {
        panic(err)
    }
    defer fi.Close()
    rd := bufio.NewReader(fi)
    for {
        _, err := rd.ReadString(â€˜\nâ€™)
        if err != nil || err == io.EOF {
            break
        }
    }
}
func readline3(filename string) {
    fi, err := os.Open(filename)
    if err != nil {
        panic(err)
    }
    defer fi.Close()
    rd := bufio.NewReader(fi)
    for {
        _, err := rd.ReadSlice(â€˜\nâ€™)
        if err != nil || err == io.EOF {
            break
        }
    }
}
func readline4(filename string) {
    fi, err := os.Open(filename)
    if err != nil {
        panic(err)
    }
    defer fi.Close()
    rd := bufio.NewReader(fi)
    for {
        _, _, err := rd.ReadLine()
        if err != nil || err == io.EOF {
            break
        }
    }
}
å¯ä»¥çœ‹åˆ°ï¼Œè¿™å››ç§æ“ä½œæ–¹å¼ï¼Œæ— è®ºæ˜¯å‡½æ•°è°ƒç”¨ï¼Œè¿˜æ˜¯å‡½æ•°è¿”å›å€¼çš„å¤„ç†ï¼Œå…¶å®éƒ½æ˜¯å¤§åŒå°å¼‚çš„ã€‚ä½†é€šè¿‡æµ‹è¯•æ•ˆç‡ï¼Œåˆ™å¯ä»¥çœ‹å‡ºå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚
æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„æµ‹è¯•ä»£ç ï¼š</p>

<p>func testfile2(filename string) {
    fmt.Printf(â€œ============test2 %s ===========\nâ€, filename)
    start := time.Now()
    readline1(filename)
    t1 := time.Now()
    fmt.Printf(â€œReadline 1 cost: %v\nâ€, t1.Sub(start))
    readline2(filename)
    t2 := time.Now()
    fmt.Printf(â€œReadline 2 cost: %v\nâ€, t2.Sub(t1))
    readline3(filename)
    t3 := time.Now()
    fmt.Printf(â€œReadline 3 cost: %v\nâ€, t3.Sub(t2))
    readline4(filename)
    t4 := time.Now()
    fmt.Printf(â€œReadline 4 cost: %v\nâ€, t4.Sub(t3))
}
åœ¨mainå‡½æ•°ä¸­è°ƒç”¨å¦‚ä¸‹ï¼š</p>

<p>func main() {
    // testfile1(â€œsmall.txtâ€)
    // testfile1(â€œmidium.txtâ€)
    // testfile1(â€œlarge.txtâ€)
    testfile2(â€œsmall.txtâ€)
    testfile2(â€œmidium.txtâ€)
    testfile2(â€œlarge.txtâ€)
}
è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š
image.png</p>

<p>é€šè¿‡ç°è±¡ï¼Œé™¤äº†small.txtä¹‹å¤–ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç»„ï¼š</p>

<p>ReadByteså¯¹å°æ–‡ä»¶å¤„ç†æ•ˆç‡æœ€å·®
åœ¨å¤„ç†å¤§æ–‡ä»¶æ—¶ï¼ŒReadLineå’ŒReadSliceæ•ˆç‡ç›¸è¿‘ï¼Œè¦æ˜æ˜¾å¿«äºReadStringå’ŒReadBytesã€‚
åŸå› åˆ†æ
ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸Šé¢çš„ç°è±¡ï¼Œä¸é˜²ä»æºç å±‚é¢è¿›è¡Œåˆ†æã€‚
é€šè¿‡é˜…è¯»æºç ï¼Œæˆ‘ä»¬å‘ç°è¿™å››ä¸ªå‡½æ•°ä¹‹é—´å­˜åœ¨è¿™æ ·ä¸€ä¸ªå…³ç³»ï¼š</p>

<p>ReadLine &lt;- (è°ƒç”¨) ReadSlice
ReadString &lt;- (è°ƒç”¨)ReadBytes&lt;-(è°ƒç”¨)ReadSlice
æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£ä¸ºä»€ä¹ˆåœ¨å¤„ç†å¤§æ–‡ä»¶æ—¶ï¼ŒReadLineæ•ˆç‡è¦æ˜æ˜¾é«˜äºReadByteså‘¢ï¼Ÿ</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦çŸ¥é“ï¼ŒReadSliceæ˜¯åˆ‡ç‰‡å¼è¯»å–ï¼Œå³æ ¹æ®åˆ†éš”ç¬¦å»è¿›è¡Œåˆ‡ç‰‡ã€‚
é€šè¿‡æºç å‘ä¸‹ï¼ŒReadLineåªæ˜¯åœ¨åˆ‡ç‰‡è¯»å–çš„åŸºç¡€ä¸Šï¼Œå¯¹æ¢è¡Œç¬¦\nå’Œ\r\nåšäº†ä¸€äº›å¤„ç†ï¼š</p>

<p>func (b *Reader) ReadLine() (line []byte, isPrefix bool, err error) {
    line, err = b.ReadSlice(â€˜\nâ€™)
    if err == ErrBufferFull {
        // Handle the case where â€œ\r\nâ€ straddles the buffer.
        if len(line) &gt; 0 &amp;&amp; line[len(line)-1] == â€˜\râ€™ {
            // Put the â€˜\râ€™ back on buf and drop it from line.
            // Let the next call to ReadLine check for â€œ\r\nâ€.
            if b.r == 0 {
                // should be unreachable
                panic(â€œbufio: tried to rewind past start of bufferâ€)
            }
            b.râ€“
            line = line[:len(line)-1]
        }
        return line, true, nil
    }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if len(line) == 0 {
    if err != nil {
        line = nil
    }
    return
}
err = nil

if line[len(line)-1] == '\n' {
    drop := 1
    if len(line) &gt; 1 &amp;&amp; line[len(line)-2] == '\r' {
        drop = 2
    }
    line = line[:len(line)-drop]
}
return } è€ŒReadBytesåˆ™æ˜¯é€šè¿‡appendå…ˆå°†è¯»å–çš„å†…å®¹æš‚å­˜åˆ°fullæ•°ç»„ä¸­ï¼Œæœ€åå†copyå‡ºæ¥ï¼Œappendå’Œcopyéƒ½æ˜¯è¦æ¶ˆè€—å†…å­˜å’Œioçš„ï¼Œå› æ­¤æ•ˆç‡è‡ªç„¶å°±æ…¢äº†ã€‚å…¶æºç å¦‚ä¸‹æ‰€ç¤ºï¼š
</code></pre></div></div>

<p>func (b *Reader) ReadBytes(delim byte) ([]byte, error) {
    // Use ReadSlice to look for array,
    // accumulating full buffers.
    var frag []byte
    var full [][]byte
    var err error
    n := 0
    for {
        var e error
        frag, e = b.ReadSlice(delim)
        if e == nil { // got final fragment
            break
        }
        if e != ErrBufferFull { // unexpected error
            err = e
            break
        }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    // Make a copy of the buffer.
    buf := make([]byte, len(frag))
    copy(buf, frag)
    full = append(full, buf)
    n += len(buf)
}

n += len(frag)

// Allocate new buffer to hold the full pieces and the fragment.
buf := make([]byte, n)
n = 0
// Copy full pieces and fragment in.
for i := range full {
    n += copy(buf[n:], full[i])
}
copy(buf[n:], frag)
return buf, err } æ€»ç»“ è¯»å–æ–‡ä»¶ä¸­ä¸€è¡Œå†…å®¹æ—¶ï¼ŒReadSliceå’ŒReadLineæ€§èƒ½ä¼˜äºReadByteså’ŒReadStringï¼Œä½†ç”±äºReadLineå¯¹æ¢è¡Œçš„å¤„ç†æ›´åŠ å…¨é¢ï¼ˆå…¼å®¹\nå’Œ\r\næ¢è¡Œï¼‰ï¼Œå› æ­¤ï¼Œå®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå»ºè®®ä½¿ç”¨ReadLineå‡½æ•°ã€‚
</code></pre></div></div>
:ET