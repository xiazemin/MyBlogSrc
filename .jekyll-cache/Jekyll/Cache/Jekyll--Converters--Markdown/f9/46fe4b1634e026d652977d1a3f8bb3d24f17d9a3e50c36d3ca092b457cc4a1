I"¼<p>grpcurlæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è®¿é—®gRPCæœåŠ¡ï¼Œå°±åƒä½¿ç”¨curlè®¿é—®httpæœåŠ¡ä¸€æ ·ã€‚</p>

<p>å‡†å¤‡: åœ¨gRPCæœåŠ¡ä¸­æ³¨å†ŒreflectionæœåŠ¡
gRPCæœåŠ¡æ˜¯ä½¿ç”¨Protobuf(PB)åè®®çš„ï¼Œè€ŒPBæä¾›äº†åœ¨è¿è¡Œæ—¶è·å–Protoå®šä¹‰ä¿¡æ¯çš„åå°„åŠŸèƒ½ã€‚grpc-goä¸­çš„â€google.golang.org/grpc/reflectionâ€åŒ…å°±å¯¹è¿™ä¸ªåå°„åŠŸèƒ½æä¾›äº†æ”¯æŒã€‚</p>

<p>server := grpc.NewServer()
	// æ³¨å†Œgrpcurlæ‰€éœ€çš„reflectionæœåŠ¡
	reflection.Register(server)
	// æ³¨å†Œä¸šåŠ¡æœåŠ¡
	proto.RegisterGreeterServer(server, &amp;greeter{})
<!-- more -->
1,grpcurl 127.0.0.1:57904 list
Failed to dial target host â€œ127.0.0.1:57904â€: tls: first record does not look like a TLS handshake
åŸå› grpcé»˜è®¤æ˜¯https</p>

<p>2ï¼Œgrpcurl -plaintext 127.0.0.1:57904 list
grpc.health.v1.Health
grpc.reflection.v1alpha.ServerReflection
xxx.svc.xx.XXService</p>

<p>åŠ -plaintext èµ°http è§£å†³</p>

<p>3ï¼Œgrpcurl -plaintext 127.0.0.1:57904 list xxx.svc.xx.XXService
xxx.svc.xx.XXService.xxMethod
xxx.svc.xx.XXService.yyMethod
å‰ææ˜¯æœåŠ¡ç«¯èµ·äº†reflection</p>

<p>4,grpcurl -plaintext 127.0.0.1:57904 xxx.svc.xx.XXService/yyMethod
ERROR:
  Code: InvalidArgument
  Message: xxx
ç¼ºå°‘å‚æ•°</p>

<p>5ï¼Œgrpcurl -plaintext 127.0.0.1:57904 describe xxx.svc.xx.XXService
e xxx.svc.xx.XXService is a service:
service XXService {
  rpc yyMethod ( .google.protobuf.Empty ) returns ( .google.protobuf.Empty );</p>

<p>6ï¼Œgrpcurl -plaintext 127.0.0.1:57904 describe xxx.svc.xx.XXService.yyMethod</p>

<p>xxx.svc.xx.XXService.yyMethod is a method:
rpc yyMethod ( .xxx.svc.xx.XXService.yyMethodRequest ) returns ( .xxx.svc.xx.XXService.yyMethodResponse );</p>

<p>7.grpcurl -plaintext 127.0.0.1:57904 describe .xxx.svc.xx.yyMethodRequest</p>

<p>.xxx.svc.xx.yyMethodRequest is a message:
message yyMethodRequest {
  string xxx = 1;
  int64 yyy = 2;
  }</p>

<p>8.grpcurl -plaintext 127.0.0.1:57904  -d â€˜{â€œxxxâ€:â€12133â€,â€yyyâ€:0}â€™ xxx.svc.xx.XXService/yyMethod
Too many arguments.</p>

<p>åŸå› ï¼šè¯·æ±‚å‚æ•°ä½ç½®ä¸å¯¹</p>

<p>9ï¼Œgrpcurl -plaintext -d â€˜{â€œxxxâ€:â€12133â€,â€yyyâ€:0}â€™ 127.0.0.1:57904  xxx.svc.xx.XXService/yyMethod</p>

<p>ERROR:
  Code: PermissionDenied
åŸå›  ç¼ºå°‘metaå‚æ•°ï¼ˆheaderï¼‰</p>

<p>10.grpcurl -plaintext -d â€˜{â€œxxxâ€:â€12133â€,â€yyyâ€:0}â€™ -H â€˜â€œXxâ€:1234â€™ 127.0.0.1:57904 xxx.svc.xx.XXService/yyMethod</p>

<p>Error invoking method â€œxxx.svc.xx.XXService/yyMethodâ€: rpc error: code = Internal desc = failed to query for service descriptor â€œxxx.svc.xx.XXService/yyMethodâ€: stream terminated by RST_STREAM with error code: PROTOCOL_ERROR</p>

<p>åŸå› ï¼šæ²¡æœ‰æŒ‡å®šproto æ–‡ä»¶</p>

<p>11.grpcurl -plaintext -d  â€˜{â€œxxxâ€:â€12133â€,â€yyyâ€:0}â€™ -H â€˜â€œXxâ€:1234â€™ -proto â€œ~/go/protos/xxx.protoâ€ 127.0.0.1:57904 xxx.svc.xx.XXService/yyMethod</p>

<p>Failed to process proto source files.: could not parse given files: %!v(PANIC=Error method: runtime error: invalid memory address or nil pointer dereference)</p>

<p>åŸå› ï¼šæ²¡æœ‰æŒ‡å®šä¾èµ–æ–‡ä»¶çš„ç›®å½•</p>

<ol>
  <li>grpcurl -plaintext -d â€˜{â€œxxxâ€:â€12133â€,â€yyyâ€:0}â€™ -H â€˜â€œXxâ€:1234â€™ -import-path â€œ/go/protos/â€ -proto â€œ/go/protos/xxx.protoâ€ 127.0.0.1:57904 xxx.svc.xx.XXService/yyMethod
ERROR:
  Code: Internal
  Message: stream terminated by RST_STREAM with error code: PROTOCOL_ERROR</li>
</ol>

<p>åŸå› ï¼šheader é”™è¯¯ï¼ŒåŸå› header é‡Œå¤šäº†â€œ</p>

<ol>
  <li>grpcurl -plaintext -emit-defaults 127.0.0.1:57904 xxx.svc.xx.XXService/yyMethod
ERROR:
  Code: InvalidArgument
  Message: xxx or yyy is required</li>
</ol>

<p>14.grpcurl -plaintext -d â€˜{â€œxxxâ€:â€12133â€,â€yyyâ€:0}â€™ -H â€˜Xx:1234â€™ -import-path â€œ/go/protos/â€ -proto â€œ/go/protos/xxx.protoâ€ 127.0.0.1:57904 xxx.svc.xx.XXService/yyMethod
é—®é¢˜è§£å†³</p>

<p>å‚è€ƒï¼š
https://blog.csdn.net/weixin_30878501/article/details/94952412
https://www.cnblogs.com/highend/p/grpc_call_protocol_error.html
https://github.com/fullstorydev/grpcurl
https://about.sourcegraph.com/go/gophercon-2018-grpc-reflection-and-grpcurl/
https://github.com/fullstorydev/grpcurl/blob/master/README.md
https://blog.frognew.com/2020/04/grpcurl.html</p>

<p>https://github.com/xiazemin/lean_record/blob/main/grpcurl</p>
:ET