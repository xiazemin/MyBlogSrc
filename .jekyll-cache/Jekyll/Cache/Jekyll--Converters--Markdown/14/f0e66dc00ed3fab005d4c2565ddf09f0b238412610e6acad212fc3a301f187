I"¾4<p>gdb) file <ä½ çš„exe>
(gdb) load <ä½ çš„so>                #è¿™æ¡åº”è¯¥æ˜¯å¯é€‰çš„</ä½ çš„so></ä½ çš„exe></p>

<p>(gdb) dir &lt;soâ€™dir&gt;
(gdb) sharedlibrary <ä½ çš„so>
(gdb) breakpoint <ä½ çš„soä¸­somewhere>
(gdb) run
load æ˜¯å°†åŠ¨æ€åº“åŠ è½½å…¥å†…å­˜ã€‚
sharedlibraryæ˜¯å°†åŠ¨æ€åº“çš„ç¬¦å·è¯»å…¥gdbï¼Œä¸ºäº†ä½ èƒ½æ‰¾åˆ°å˜é‡å’Œå‡½æ•°åã€‚
å®ƒä»¬æœ¬èº«æ˜¯æ²¡æœ‰æ˜æ˜¾çš„åŠ¨ä½œï¼Œä½†åé¢å½“ä½ ç›´æ¥è®¾ç½®æ–­ç‚¹åˆ°åŠ¨æ€åº“çš„å‡½æ•°ï¼ˆæˆ–è¡Œå·ï¼‰æ—¶ï¼Œä½ å°±å¯ä»¥æˆåŠŸäº†ã€‚åœ¨æ­¤ä¹‹å‰è¦è®°å¾—ç”¨dirå°†åŠ¨æ€åº“çš„æºç ä¹ŸåŠ å…¥æœç´¢è·¯å¾„
<!-- more -->
https://blog.csdn.net/weixin_30307267/article/details/98746387</ä½ çš„soä¸­somewhere></ä½ çš„so></p>

<p>(gdb) b zend_execute_ex
Function â€œzend_execute_exâ€ not defined.
Make breakpoint pending on future shared library load? (y or [n]) y
Breakpoint 3 (zend_execute_ex) pending.</p>

<p>(gdb) b execute_ex
Breakpoint 4 at 0x10055190c: file Zend/zend_vm_execute.h, line 417.</p>

<p>(gdb) run -f spl.php</p>

<p>(gdb) n</p>

<p>Breakpoint 6, execute_ex (ex=0x101a17030) at Zend/zend_vm_execute.h:432
432			if (UNEXPECTED((ret = ((opcode_handler_t)OPLINE-&gt;handler)(ZEND_OPCODE_HANDLER_ARGS_PASSTHRU)) != 0)) {
(gdb) n</p>

<p>xzm 6</p>

<p>xzm 2 spl_autoload</p>

<p>Program received signal SIGSEGV, Segmentation fault.
0x00007fff9a84fd32 in strlen () from /usr/lib/system/libsystem_c.dylib
(gdb) bt
#0  0x00007fff9a84fd32 in strlen () from /usr/lib/system/libsystem_c.dylib
#1  0x0000000101eb4257 in my_get_file_class_function_info ()
   from /usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.so
#2  0x0000000101eb41b3 in my_get_file_class_function_info ()
   from /usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.so
#3  0x0000000101eb3922 in my_execute_ex () from /usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.so
#4  0x0000000100551b6a in zend_execute (op_array=0x101a72500, return_value=0x7fff5fbfdc90)
    at Zend/zend_vm_execute.h:474
#5  0x0000000100320a07 in spl_autoload (class_name=0x101a03a40, lc_name=0x101a03ac0, ext=0x101a03a18 â€œ.phpâ€,
    ext_len=4) at ext/spl/php_spl.c:289
#6  0x00000001003206d0 in zif_spl_autoload (execute_data=0x101a170c0, return_value=0x7fff5fbfe058)
    at ext/spl/php_spl.c:334
#7  0x00000001004ce8b2 in zend_call_function (fci=0x7fff5fbfe018, fci_cache=0x7fff5fbfdff0)
    at Zend/zend_execute_API.c:850
#8  0x00000001004cf27e in zend_lookup_class_ex (name=0x101a03a40, key=0x101a71140, use_autoload=1)
    at Zend/zend_execute_API.c:1009
#9  0x00000001004d039f in zend_fetch_class_by_name (class_name=0x101a03a40, key=0x101a71140, fetch_type=512)
    at Zend/zend_execute_API.c:1442
#10 0x000000010057db2e in ZEND_NEW_SPEC_CONST_HANDLER (execute_data=0x101a17030) at Zend/zend_vm_execute.h:3156
#11 0x0000000100551964 in execute_ex (ex=0x101a17030) at Zend/zend_vm_execute.h:432
#12 0x0000000101eb395f in my_execute_ex () from /usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.so
#13 0x0000000100551b6a in zend_execute (op_array=0x101a72300, return_value=0x0) at Zend/zend_vm_execute.h:474
#14 0x00000001004eaf12 in zend_execute_scripts (type=8, retval=0x0, file_count=3) at Zend/zend.c:1447
#15 0x0000000100440721 in php_execute_script (primary_file=0x7fff5fbff0b8) at main/main.c:2533
#16 0x00000001006062b5 in do_cli (argc=3, argv=0x100f00620) at sapi/cli/php_cli.c:990
#17 0x000000010060515a in main (argc=3, argv=0x100f00620) at sapi/cli/php_cli.c:1378</p>

<p>(gdb) load /usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.so
You canâ€™t do that when your target is `nativeâ€™</p>

<p>gdbåœ¨eclipseè¿œç¨‹è°ƒè¯•æ—¶ï¼Œè‡ªå·±å†™.gdbinitå®Œåï¼Œæ‰§è¡Œloadå‘½ä»¤ï¼Œå‡ºç°you canâ€™t do that when your target is execâ€™ã€‚æœ‰æœ¨æœ‰å¤§ç¥é‡åˆ°è¿‡å•Š</p>

<p>https://stackoverflow.com/questions/3691394/gdb-meaning-of-tstart-error-you-cant-do-that-when-your-target-is-exec</p>

<p>è°ƒè¯•å¤±è´¥çš„åŸå› æ˜¯å› ä¸ºgdbä¸èƒ½æ‰¾åˆ°libggg.soï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è§£å†³ï¼š</p>

<p>1) å°†åº“è·¯å¾„åŠ åˆ°LD_LIBRARY_PATHé‡Œ
2) æ‰§è¡Œï¼šldconfig YOUR_LIB_PATH
3) åœ¨/etc/ld.so.confé‡ŒåŠ å…¥åº“æ‰€åœ¨è·¯å¾„ã€‚ç„¶åæ‰§è¡Œï¼šldconfig</p>

<p>ä¸Šé¢3ä¸ªæ–¹æ³•ä»»æ„ä¸€ä¸ªéƒ½å¯ä»¥ï¼Œç„¶åå†å»ç”¨gdbè°ƒè¯•å°±æ²¡æœ‰é—®é¢˜äº†ã€‚
å¦:</p>

<p>1ã€å‡è®¾æˆ‘çš„å¯æ‰§è¡Œç¨‹åºæ˜¯ServerNameï¼Œå…±äº«åº“ä¸ºworker.so
2ã€æˆ‘ç”¨gdbè°ƒè¯•ServerNameï¼Œæƒ³åœ¨Bçš„æŸä¸ªæºæ–‡ä»¶ï¼ˆæ¯”å¦‚worker.cppï¼Œworker.cppä¸ServerNameä¸åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼‰ä¸­è®¾ç½®æ–­ç‚¹ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¡Œbreak worker.cpp:123</p>

<p>è‹¥æ‰¾ä¸åˆ°æºæ–‡ä»¶å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è®¾å®šæºæ–‡ä»¶ç›®å½•ï¼š</p>

<p>è®¾å®šgdbç¯å¢ƒå˜é‡ LD_PRELOADï¼Œåœ¨æ‰§è¡Œç¨‹åºå‰å…ˆæŠŠå…±äº«åº“ä»£ç loadè¿›æ¥
æŒ‡å®šä½ çš„é“¾æ¥åº“çš„ä½ç½®ï¼Œå¯ä»¥é€šè¿‡è®¾å®šç¯å¢ƒå˜é‡LD_LIBRARY_PATHæ¥å®ç°</p>

<p>æ‹·è´åˆ°æ ‡å‡†çš„libæœå¯»ç›®å½•ä¸‹ï¼Œä¾‹å¦‚/usr/libç­‰</p>

<p>b main, r,ç„¶åå†è®¾ç½®æ–­ç‚¹å°±å¯ä»¥äº†ï¼Œå…±äº«åº“åªæœ‰å½“ç¨‹åºè¿è¡Œæ‰å¼€å§‹åŠ è½½çš„</p>

<p>https://www.cnblogs.com/ybgame/archive/2012/03/23/2414078.html</p>

<p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰æŠŠåŠ¨æ€é“¾æ¥åº“æ”¾åˆ°æŒ‡å®šç›®å½•ï¼Œæ¯”å¦‚/libé‡Œé¢ï¼Œè°ƒè¯•å°±ä¼šå¤±è´¥</p>

<p>http://grepkey.blog.chinaunix.net/uid-391024-id-2410433.html</p>

<p>(gdb) dir /usr/local/lib/php/extensions/debug-non-zts-20160303/
Source directories searched: /usr/local/lib/php/extensions/debug-non-zts-20160303:$cdir:$cwd</p>

<p>(gdb) sharedlibrary myFile.so
Symbols already loaded for /usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.so</p>

<p>(gdb) b my_get_file_class_function_info
Cannot access memory at address 0x1d90</p>

<p>(gdb) file <ä½ çš„exe>
(gdb) load <ä½ çš„so>                #è¿™æ¡åº”è¯¥æ˜¯å¯é€‰çš„</ä½ çš„so></ä½ çš„exe></p>

<p>(gdb) dir &lt;soâ€™dir&gt;
(gdb) sharedlibrary <ä½ çš„so>
(gdb) breakpoint <ä½ çš„soä¸­somewhere>
(gdb) run
load æ˜¯å°†åŠ¨æ€åº“åŠ è½½å…¥å†…å­˜ã€‚
sharedlibraryæ˜¯å°†åŠ¨æ€åº“çš„ç¬¦å·è¯»å…¥gdbï¼Œä¸ºäº†ä½ èƒ½æ‰¾åˆ°å˜é‡å’Œå‡½æ•°åã€‚
å®ƒä»¬æœ¬èº«æ˜¯æ²¡æœ‰æ˜æ˜¾çš„åŠ¨ä½œï¼Œä½†åé¢å½“ä½ ç›´æ¥è®¾ç½®æ–­ç‚¹åˆ°åŠ¨æ€åº“çš„å‡½æ•°ï¼ˆæˆ–è¡Œå·ï¼‰æ—¶ï¼Œä½ å°±å¯ä»¥æˆåŠŸäº†ã€‚åœ¨æ­¤ä¹‹å‰è¦è®°å¾—ç”¨dirå°†åŠ¨æ€åº“çš„æºç ä¹ŸåŠ å…¥æœç´¢è·¯å¾„ã€‚</ä½ çš„soä¸­somewhere></ä½ çš„so></p>

<p>https://cloud.tencent.com/developer/article/1392837</p>

<ol>
  <li>
    <p>é€šè¿‡é˜…è¯» print_cvs å‘½ä»¤çš„å®ç°ï¼Œå¯ä»¥çŸ¥é“å¯ä»¥é€šè¿‡prev_execute_dataæ¥æ‰“å°ä¸Šä¸€æ‰§è¡Œç©ºé—´çš„PHPå˜é‡ï¼Œå¦‚ï¼š
(gdb) printzv *executor_globals.current_execute_data-&gt;prev_execute_data-&gt;CVs[1]<br />
[0x9543408] (refcount=1) string(3): â€œAAAâ€
(gdb) printzv *executor_globals.current_execute_data-&gt;prev_execute_data-&gt;CVs[2]<br />
[0x95433ec] (refcount=1) string(3): â€œBBBâ€
(gdb)</p>
  </li>
  <li>
    <p>é€šè¿‡ op_array-&gt;vars æ¥æ‰¾åˆ°å¯¹åº”çš„å˜é‡çš„åå­—
(gdb) printf â€œ%s\nâ€ ,executor_globals.current_execute_data-&gt;prev_execute_data-&gt;op_array-&gt;vars[1].name<br />
a
(gdb) printf â€œ%s\nâ€ ,executor_globals.current_execute_data-&gt;prev_execute_data-&gt;op_array-&gt;vars[2].name<br />
b</p>
  </li>
  <li>
    <p>ä¿®æ”¹äº†ä¸€ä¸‹ print_cvs å‘½ä»¤ï¼Œé€šè¿‡å‚æ•°æ¥è·å–æ¯ä¸ªæ‰§è¡Œç©ºé—´çš„PHPçš„å·²ç¼–è¯‘å˜é‡
define print_cvs
     ____executor_globals
     set $f = $eg.current_execute_data
     if $argc == 1
             set $j = 1
             while $j &lt; $arg0 &amp;&amp; $f.prev_execute_data != 0
                     set $f = $f.prev_execute_data
                     set $j = $j + 1
             end
     end
     set $p = $f.CVs
     set $c = $f.op_array.last_var
     set $v = $f.op_array.vars
     set $i = 0
     printf â€œCompiled variables count: %d\nâ€, $c
     while $i &lt; $c
             printf â€œ%d = %s\nâ€, $i, $v[$i].name
             if $p[$i] != 0
                     printzv <em>$p[$i]
             else
                     printf â€œ</em>uninitialized*\nâ€
             end
             set $i = $i + 1
     end
end</p>
  </li>
</ol>

<p>ä½¿ç”¨æ–¹æ³•ï¼š
â€”â€”â€”â€”â€”â€”â€”
(gdb) zbacktrace  #æŸ¥çœ‹PHPçš„è°ƒç”¨æ ˆ
[0x8ce2078] sleep(1) /usr/home/junjie2/a.php:9
[0x8ce1fe0] test(â€œphporâ€) /usr/home/junjie2/a.php:5
(gdb) print_cvs #æŸ¥çœ‹å½“å‰æ‰§è¡Œç©ºé—´ä¸­çš„PHPå˜é‡
Compiled variables count: 3
0 = name
[0x8cae3d0] (refcount=2) string(5): â€œphporâ€
1 = m
[0x8cae93c] (refcount=1) string(3): â€œMMMâ€
2 = n
[0x8cae958] (refcount=1) string(3): â€œNNNâ€
(gdb) print_cvs 2 # æŸ¥çœ‹æŒ‡å®šæ‰§è¡Œç©ºé—´ä¸­çš„PHPå˜é‡ï¼Œ è¿™ä¸ªå‚æ•°ç»™å¤§äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæœ€å¤šæ‰“å°æœ€å¤–å±‚çš„PHPå˜é‡
Compiled variables count: 2
0 = a
[0x8cae408] (refcount=1) string(3): â€œAAAâ€
1 = b
[0x8cae3ec] (refcount=1) string(3): â€œBBBâ€
(gdb)
â€”â€”â€”â€”â€”â€”â€”</p>

<ol>
  <li>
    <p>æœ‰æ—¶å€™éœ€è¦å€ŸåŠ©ç¯å¢ƒå˜é‡ï¼Œå¦‚ï¼š
(gdb) print_ft (HashTable *)0xa5bd450
A syntax error in expression, near `â€™.
(gdb) set $phpor=(HashTable *)0xa5bd450
(gdb) print_ft $phpor
[0xa5bd450] {
â€œzend_version\0â€³ =&gt; â€œzend_versionâ€
â€œfunc_num_args\0â€³ =&gt; â€œfunc_num_argsâ€
â€œfunc_get_arg\0â€³ =&gt; â€œfunc_get_argâ€
â€œfunc_get_args\0â€³ =&gt; â€œfunc_get_argsâ€
â€œstrlen\0â€³ =&gt; â€œstrlenâ€
â€œstrcmp\0â€³ =&gt; â€œstrcmpâ€
â€œstrncmp\0â€³ =&gt; â€œstrncmpâ€</p>
  </li>
  <li>
    <p>æ‰“å°æŒ‡å®šçš„PHPå˜é‡</p>
  </li>
</ol>

<p>https://blog.csdn.net/xiaolei1982/article/details/20584291</p>

<p>https://www.zhihu.com/question/20348619?sort=created</p>

<p>åˆæ­¥æ€€ç–‘æ²¡æœ‰è°ƒè¯•ä¿¡æ¯ï¼Œé‡æ–°ç¼–è¯‘æ‰©å±•
$./configure â€“enable-debug â€“enable-static=0
make &amp; make install
$sudo gdb php
(gdb)  source /Users/didi/PhpstormProjects/c/php-src/.gdbinit
(gdb) run -f spl.php</p>

<p>(gdb) dir  /usr/local/lib/php/extensions/debug-non-zts-20160303/
Source directories searched: /usr/local/lib/php/extensions/debug-non-zts-20160303:$cdir:$cwd
(gdb) sharedlibrary myFile.so
Symbols already loaded for /usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.so
(gdb) b my_get_file_class_function_info
Cannot access memory at address 0x1d90
(gdb) b
Breakpoint 1 at 0x7fff9a84fd32
(gdb) b zend_execute
Breakpoint 2 at 0x100551a97: file Zend/zend_vm_execute.h, line 461.</p>

<p>https://blog.csdn.net/u012684933/article/details/44060769</p>

<p>(gdb)  dir  /usr/local/lib/php/extensions/debug-non-zts-20160303/
Source directories searched: /usr/local/lib/php/extensions/debug-non-zts-20160303:$cdir:$cwd
(gdb) sharedlibrary myFile.so
No loaded shared libraries match the pattern <code class="language-plaintext highlighter-rouge">myFile.so'.
(gdb) sharedlibrary /usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.so
No loaded shared libraries match the pattern </code>/usr/local/lib/php/extensions/debug-non-zts-20160303/myFile.soâ€™.</p>

<p>(gdb) load myFile.so
You canâ€™t do that when your target is <code class="language-plaintext highlighter-rouge">exec'
(gdb) sharedlibrary myFile.so
No loaded shared libraries match the pattern </code>myFile.soâ€™.</p>

<p>(gdb) file php
Load new symbol table from â€œphpâ€? (y or n) y
Reading symbols from phpâ€¦done.</p>

<p>(gdb) dir /usr/local/lib/php/extensions/debug-non-zts-20160303/
Source directories searched: /usr/local/lib/php/extensions/debug-non-zts-20160303:$cdir:$cwd
(gdb) sharedlibrary myFile.so
No loaded shared libraries match the pattern <code class="language-plaintext highlighter-rouge">myFile.so'.
(gdb) load myFile.so
You can't do that when your target is </code>execâ€™
https://stackoverflow.com/questions/37641967/how-to-debug-a-shared-library-using-gdb</p>

<p>This implies a bug in GDB. Unfortunately your version of GDB is too old for developers to care. Try reproducing this behavior with current GDB 7.11.1, and file a bug in GDB bugzilla if it does reproduce.</p>

<p>If you donâ€™t want to use GDB 7.11.1, you can work around this bug by setting a breakpoint after the shared library has been loaded.</p>

<p>If the library is linked into the main executable directly, the following sequence should work:</p>

<p>(gdb) start</p>
<h1 id="gdb-stop-on-entry-to-main">GDB stop on entry to main</h1>

<p>(gdb) b FileOfSharedLib.c:NNN  # should find the source now
If the library is dlopened, youâ€™ll need to set a temporary breakpoint in the main exectable somewhere after that dlopen.</p>

<p>Another workaround: set stop-on-solib-events 1. This will make GDB stop after any new shared library is added (or removed).</p>

<p>(gdb)  set stop-on-solib-events 1
(gdb)
(gdb) run -f spl.php
Starting program: /usr/local/bin/php -f spl.php
Stopped due to shared library event:
  Inferior loaded /usr/lib/libresolv.9.dylib
    /usr/lib/libiconv.2.dylib
    /usr/lib/libSystem.B.dylib
    /usr/lib/libxml2.2.dylib
    /usr/lib/libz.1.dylib
(gdb) c
Continuing.
Stopped due to shared library event:
  Inferior loaded /usr/local/lib/php/extensions/debug-non-zts-20160303/zlib.so
(gdb)</p>

<p>(gdb) b spl_autoload
Breakpoint 1 at 0x10032084b: file ext/spl/php_spl.c, line 257.</p>

<p>https://www.cnblogs.com/yjf512/archive/2016/12/01/6120856.html
https://blog.csdn.net/weixin_34405354/article/details/90652400
https://zhuanlan.zhihu.com/p/67916872</p>

<p>(gdb) p *(execute_data-&gt;func-&gt;op_array.filename)
$7 = {gc = {refcount = 3, u = {v = {type = 6 â€˜\006â€™, flags = 0 â€˜\000â€™, gc_info = 0}, type_info = 6}}, h = 17817666378049475646, len = 55,
  val = â€œ/â€}
(gdb) s</p>

<p>xzm 6</p>

<p>xzm 2 spl_autoload</p>

<p>Program received signal SIGSEGV, Segmentation fault.
0x00007fff9a84fd32 in strlen () from /usr/lib/system/libsystem_c.dylib</p>

<p>https://blog.csdn.net/fff058/article/details/78692261
https://type.so/c/php-extension-in-action-get-arguments-after-zend-execute-ex.html</p>

:ET