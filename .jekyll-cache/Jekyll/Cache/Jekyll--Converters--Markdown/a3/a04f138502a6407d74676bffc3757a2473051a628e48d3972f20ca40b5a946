I"î<p>https://tinygo.org/
https://github.com/tinygo-org/tinygo
https://github.com/tinygo-org/drivers
<!-- more --></p>

<p>TinyGoæ˜¯ä¸€ä¸ªç”¨äºå¾®æ§åˆ¶å™¨çš„Goç¼–è¯‘å™¨ï¼Œä½¿ç”¨WebAssemblyï¼ˆWASMï¼‰å’Œå‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒé‡ç”¨äº†Goè¯­è¨€å·¥å…·å’ŒLLVMä¸€èµ·ä½¿ç”¨çš„åº“ï¼Œç¼–è¯‘ç”¨Goç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ç¨‹åºã€‚</p>

<p>package main</p>

<p>import (
    â€œmachineâ€
    â€œtimeâ€
)</p>

<p>func main() {
    led := machine.GPIO{machine.LED}
    led.Configure(machine.GPIOConfig{Mode: machine.GPIO_OUTPUT})
    for {
        led.Low()
        time.Sleep(time.Millisecond * 1000)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    led.High()
    time.Sleep(time.Millisecond * 1000)
} }
</code></pre></div></div>

<p>å·²ç»æ”¯æŒçš„ç¡¬ä»¶
Adafruit Circuit Playground Express
Adafruit ItsyBitsy M0
Arduino Uno
BBC:Microbit
ST Micro STM32F103XX â€œBluepillâ€
Digispark
Nordic Semiconductor PCA10031
Nordic Semiconductor PCA10040
Nordic Semiconductor PCA10056
Makerdiary nRF52840-MDK
Phytec reel board</p>

<p>é¡¹ç›®ç½‘ç«™
https://tinygo.org/</p>

<p>æºç 
https://github.com/tinygo-org/tinygo</p>

<p>https://www.ctolib.com/tinygo-org-tinygo.html</p>

<p>tinygoæœ¬èº«æ˜¯ä¸ªé’ˆå¯¹å¾®æ§åˆ¶å™¨çš„ç¼–è¯‘å™¨+å·¥å…·ï¼Œå¯ä»¥buildã€flushã€‚</p>

<p>tinygoä¾èµ–è‡ªå·±çš„go-llvm
tinygoçš„å®ç°ä¸­ä¾èµ–çš„è‡ªå·±çš„go-llvmï¼Œå…¶å®å°±æ˜¯llvmçš„ä¸€ä¸ªgoçš„bindingï¼Œæœ€ç»ˆä¾èµ–ç³»ç»Ÿçš„llvm</p>

<p>é€šè¿‡go-llvm/llvmå®ç°äº†ä¸€ä¸ªåŸºæœ¬çš„ç¼–è¯‘å™¨
tinygoåŸºäºgoçš„ç¼–è¯‘å™¨ï¼Œé€šè¿‡go-llvm/llvmå®ç°äº†ä¸€ä¸ªåŸºæœ¬çš„ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥æ”¯æŒçš„è¯­æ³•ã€ç‰¹æ€§ä¸»è¦å’Œgoç±»ä¼¼</p>

<p>ä¾‹å¦‚ channelçš„å‘é€ï¼š</p>

<p>compiler/channel.go</p>

<p>37 	c.createRuntimeCall(â€œchanSendâ€, []llvm.Value{coroutine, ch, valueAllocaCast, valueSize}, â€œâ€)
38
39	// End the lifetime of the alloca.
src/runtime/chan.go</p>

<p>44 // chanSend sends a single value over the channel. If this operation can
45 // complete immediately (there is a goroutine waiting for a value), it sends the
46 // value and re-activates both goroutines. If not, it sets itself as waiting on
47 // a value.
48 func chanSend(sender *coroutine, ch *channel, value unsafe.Pointer, size uintptr) {</p>

<p>é¦–å…ˆè®©æˆ‘è¯´ Go ä¸­çš„ Web Assembly æœ‰ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå®ƒå¤ªè¿‡ä¾èµ–äºå®Œæˆä»»åŠ¡è€Œå®šåˆ¶çš„ APIã€‚åœ¨æˆ‘çœ‹æ¥ syscalls/js æ˜¯é”™è¯¯çš„ä½¿ç”¨ Web Assembly æ–¹å¼ï¼š</p>

<p>Go å¼€å‘è€…ä¸åº”è¯¥å­¦ä¹  JavaScript
éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒWeb Assembly å°†è·å¾—è‡ªå·±çš„ APIï¼Œå¯èƒ½åŸºäºWebIDL
å®ƒå¯¹è¿è¡Œ Web Assembly çš„ä¸»æœºåšäº†å¤ªå¤šå‡è®¾ï¼Œç”šè‡³å¯¼å…¥è®©æ¨¡å—è¿è¡Œæ‰€éœ€çš„åŠŸèƒ½ä¹Ÿæ˜¯å¦‚æ­¤
è°ƒç”¨æœ¬èº«åœ¨ Web Assembly å †æ ˆæœºå™¨ä¸­ï¼ˆä¸æ˜¯ä¸€äº›æŠ½è±¡ï¼‰çš„å¤–éƒ¨å‡½æ•°å°†å§‹ç»ˆæ˜¯æœ€å¿«çš„æ–¹æ³•ã€‚
å½“æˆ‘å‘ç° tinygo éå¸¸é«˜å…´ï¼Œå®ƒç¼–è¯‘ä¸€ä¸ª Web assembly æ¨¡å—å¹¶ä½¿ç”¨æ›´å°‘çš„å‡è®¾æ¥å‘ç°è¯¥æ¨¡å—ï¼Œè€Œä¸”æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„åŸºäºæ³¨é‡Šçš„ç³»ç»Ÿç”¨äºå¯¼å…¥å‡½æ•° - æ®æˆ‘æ‰€çŸ¥ï¼Œåœ¨ä¸»çº¿ Go ç¼–è¯‘å™¨ä¸­æ˜¯ä¸å¯èƒ½çš„ã€‚</p>

<p>tinygo åˆ©ç”¨ LLVMï¼Œå¹¶èƒ½å¤Ÿå¾ˆå¥½åœ°å°† Web assembly æ¨¡å—å‡å°‘ç›¸å½“å¤§çš„æ•°é‡ã€‚è¿™è®©æˆ‘èƒ½åšçš„å°±æ˜¯ç¼–å†™åƒè¿™ä¸ª hello world è¿™æ ·çš„éå¸¸å°çš„æ¨¡å—ï¼š</p>

<p>package main
//go:export console_log
func console_log(msg string)
//go:export main
func start(){
  console_log(â€œhello worldâ€)
}
func main() {}
ç¼–è¯‘ä¸‹æ¥ï¼Œè¿™ä¸ªæ¨¡å—åªæœ‰ 2 ä¸ªå¯¼å…¥è¦æ±‚ï¼š</p>

<p>console_log
io_std_outï¼ˆå› ä¸ºç›®å‰ tinygo å‡è®¾æœ‰ä¸€äº›è¿è¡Œæ—¶ï¼‰
å¯¼å‡ºï¼š</p>

<p>main
åœ¨æˆ‘è¿„ä»Šä¸ºæ­¢çœ‹åˆ°çš„ç”¨äº Web assembly æŠ€æœ¯çš„æ‰€æœ‰é€‰é¡¹ä¸­ï¼Œè¿™å’Œæˆ‘å¸Œæœ›çš„ä¸€æ ·å¥½ã€‚</p>

<p>æˆ‘ä¸€ç›´åœ¨ç¼–å†™ä¸€äº›åº“ï¼Œè¿™äº›åº“ä½¿ç”¨åŸºäºæµè§ˆå™¨ Web IDLï¼ˆæµè§ˆå™¨ç¯å¢ƒå…·æœ‰å“ªäº›åŠŸèƒ½çš„æ ‡å‡†åŒ–æè¿°ï¼‰æ¥æš´éœ²ä¸€äº›éå¸¸æœ‰æ•ˆçš„ DOM æ“ä½œ APIï¼šrichardanaya/wasm-module</p>

<p>ä½ å¯ä»¥é€šè¿‡å¤§é‡çš„å‘½ä»¤å¼å‡½æ•°çš„è°ƒç”¨æ¥è·å– DOM ä¸­çš„èµ„æºå¥æŸ„å¹¶æ“çºµå®ƒä»¬ï¼Œè€Œä¸æ˜¯åˆ¶ä½œç³»ç»Ÿ syscalls/jsã€‚è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å®ƒéå¸¸ç®€å•å’Œ C ç±»ä¼¼ï¼Œå¹¶ä¸”ä¸éœ€è¦æ‚¨è‡ªå·±çš„ç‰¹æ®Šä»£ç ç”Ÿæˆï¼Œå¹¶ä¸”å®Œå…¨ä¸æŠ€æœ¯æ— å…³ã€‚åªéœ€å¯¼å…¥æ‚¨éœ€è¦çš„åŠŸèƒ½ã€‚</p>

<p>è¿™æ˜¯ä¸€ä¸ªç”»å¸ƒåº”ç”¨ç¨‹åºçš„ç¤ºä¾‹</p>

<p>package main
//go:export global_getWindow
func GetWindow() int32
//go:export Window_get_document
func GetDocument(window int32) int32
//go:export Document_querySelector
func QuerySelector(document int32 ,query string) int32
//go:export HTMLCanvasElement_getContext
func GetContext(element int32,context string) int32
//go:export CanvasRenderingContext2D_fillRect
func FillRect(ctx ,x ,y ,w ,h int32)
//go:export CanvasRenderingContext2D_set_fillStyle
func FillStyle(ctx int32, fillStyle string)
func cstr(s string) string{
  return s+â€\000â€
}
//go:export main
func start(){
  win := GetWindow()
  doc := GetDocument(win)
  canvas := QuerySelector(doc,cstr(â€œ#screenâ€))
  ctx := GetContext(canvas,cstr(â€œ2dâ€))
  FillRect(ctx,0,0,50,50)
  FillStyle(ctx,cstr(â€œredâ€))
  FillRect(ctx,10,10,50,50)
  FillStyle(ctx,cstr(â€œgreyâ€))
  FillRect(ctx,20,20,50,50)
}
func main() {}
ä½ å¯ä»¥åœ¨è¿™é‡Œ çœ‹åˆ°è¿™ä¸ªå·¥ä½œ</p>

<p>æ€»çš„æ¥è¯´ï¼Œæˆ‘å¾ˆé«˜å…´åœ¨æˆ‘çš„å·¥å…·ç®±ä¸­å†æ·»åŠ ä¸€ä¸ªå·¥å…·æ¥æ›´åŠ ç®€å•æ–¹ä¾¿çš„åˆ›å»º Web assemblyã€‚ä¹Ÿè®¸é€šè¿‡ä¸€äº›å·¥ä½œï¼Œtinygo å¯ä»¥ç”Ÿæˆçš„æ›´ç®€æ´ï¼Œå¹¶åƒ Rust ä¸€æ ·åœ¨ç½‘ç»œçš„ä¸‹ä¸€ä¸ªæŠ€æœ¯å¹³å°ä¸Šåšå®å¯é </p>
:ET