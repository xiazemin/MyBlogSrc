I"™+<p>æ—©æœŸçš„TDD</p>

<p>ï¼ˆTest Driven Developmentï¼‰,</p>

<p>æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œå°±æ˜¯æ•æ·å¼€å‘å¸¦æ¥çš„è½¯ä»¶å¼€å‘æ–°å®è·µã€‚TDDè®©æµ‹è¯•äººå‘˜æ›´æ·±å…¥åœ°å‚ä¸åˆ°äº†è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­ã€‚</p>

<p>TDDæ¨å‡ºäº†å‡ å¹´ä¹‹åï¼Œæ–°çš„æ•æ·å¼€å‘è¿­ä»£ï¼Œè¿˜åœ¨æŒç»­ç€ã€‚</p>

<p>æ–°è¿­ä»£çš„äº§ç‰©ï¼Œæ˜¯è½¯ä»¶å¼€å‘æ›´åŠ è´´è¿‘ä¸šåŠ¡é€»è¾‘çš„â€œè¡Œä¸ºé©±åŠ¨å¼€å‘â€ï¼Œç¼©å†™ä¸ºBDDã€‚</p>

<p>BDDï¼ˆBehavior Driven Developmentï¼‰ï¼Œè¡Œä¸ºé©±åŠ¨å¼€å‘æ˜¯ä¸€ç§æ•æ·è½¯ä»¶å¼€å‘çš„æŠ€æœ¯ï¼Œå®ƒé¼“åŠ±è½¯ä»¶é¡¹ç›®ä¸­çš„å¼€å‘è€…ã€QAå’ŒéæŠ€æœ¯äººå‘˜æˆ–å•†ä¸šå‚ä¸è€…ä¹‹é—´çš„åä½œã€‚</p>

<p>BDDæœ€åˆæ˜¯ç”±Dan Northåœ¨2003å¹´å‘½åï¼Œ2009å¹´åœ¨ä¼¦æ•¦å‘è¡¨çš„â€œæ•æ·è§„æ ¼ï¼ŒBDDå’Œæé™æµ‹è¯•äº¤æµâ€ä¸­ï¼ŒDan Northå¯¹BDDç»™å‡ºäº†å¦‚ä¸‹å®šä¹‰ï¼š</p>

<p>BDDæ˜¯ç¬¬äºŒä»£çš„ã€ç”±å¤–åŠå†…çš„ã€åŸºäºæ‹‰(pull)çš„ã€å¤šæ–¹åˆ©ç›Šç›¸å…³è€…çš„(stakeholder)ã€å¤šç§å¯æ‰©å±•çš„ã€é«˜è‡ªåŠ¨åŒ–çš„æ•æ·æ–¹æ³•ã€‚å®ƒæè¿°äº†ä¸€ä¸ªäº¤äº’å¾ªç¯ï¼Œå¯ä»¥å…·æœ‰å¸¦æœ‰è‰¯å¥½å®šä¹‰çš„è¾“å‡ºï¼ˆå³å·¥ä½œä¸­äº¤ä»˜çš„ç»“æœï¼‰ï¼šå·²æµ‹è¯•è¿‡çš„è½¯ä»¶ã€‚</p>

<p>Dan Northåˆ›é€ äº†é¦–ä¸ªBDDæ¡†æ¶ï¼šJBehaveã€‚ä¹‹åæ˜¯Rubyè¯­è¨€çš„åŸºäºæ•…äº‹çš„RBehaveï¼Œåæ¥è¢«çº³å…¥äº†RSpecé¡¹ç›®ã€‚RSpecä¸­ç¬¬ä¸€ä¸ªåŸºäºæ•…äº‹çš„æ¡†æ¶ï¼Œåæ¥è¢«ä¸»è¦ç”±Aslak HellesÃ¸yå¼€å‘çš„Cucumberå–ä»£ã€‚</p>

<p>Cucumberæ¡†æ¶å¯ä»¥è¯´æ˜¯BDDçš„ä»£åè¯äº†ã€‚å®˜ç½‘ï¼šhttps://cucumber.io</p>

<p>Cucumberæ”¯æŒçš„è¯­è¨€ä¹Ÿéå¸¸å¤šï¼Œæ¯”å¦‚ï¼š</p>

<p>â€¢ Java Virtual Machine: Cucumber-JVM</p>

<p>â€¢ .NET (Microsoft.NET and Mono): IronRuby and .NET, IronRuby and Mono</p>

<p>â€¢ Adobe Flex: FunFX, Melomel</p>

<p>â€¢ Python</p>

<p>â€¢ Perl: Test::BDD::Cucumber</p>

<p>â€¢ Erlang: cucumberl kucumberl</p>

<p>â€¢ PHP: Behat (ä½¿ç”¨ Mink è¿›è¡Œæµè§ˆå™¨æµ‹è¯•</p>

<p>Ginkgoæ˜¯ä¸€ä¸ªåŸºäºGoè¯­è¨€çš„BDDæµ‹è¯•æ¡†æ¶ï¼Œä¸€èˆ¬ç”¨äºGoæœåŠ¡çš„é›†æˆæµ‹è¯•ã€‚
https://github.com/onsi/ginkgo
http://onsi.github.io/ginkgo/
<!-- more -->
1.å®‰è£…Ginkgo</p>

<p>go get github.com/onsi/ginkgo/ginkgo
go get github.com/onsi/gomega/â€¦ é™„åŠ çš„åº“ï¼Œé…åˆä½¿ç”¨ï¼Œä¸‹ä¸€ç¯‡ä¼šè¯¦ç»†è®²è§£
é…ç½®ç¯å¢ƒå˜é‡ï¼ŒåŠ åˆ°$GOPATH/binæˆ–$PATH</p>

<p>2.æ–°å»º</p>

<p>åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶å¤¹å¦‚exampleï¼Œè¿›å…¥æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œå‘½ä»¤ginkgo bootstrapç”Ÿæˆæ¨¡ç‰ˆæ–‡ä»¶ï¼Œæ–‡ä»¶åæ˜¯example_suite_test.goï¼Œé‡Œé¢æœ‰å…¥å£å‡½æ•°
æ‰§è¡Œginkgo generate exampleï¼Œexampleå¯ä»¥ä¸å†™ï¼Œé»˜è®¤æ˜¯å½“å‰æ–‡ä»¶å¤¹åç§°ï¼Œç”Ÿæˆæµ‹è¯•ä¾‹æ¨¡æ¿æ–‡ä»¶example_test.go
åŠ _teståç¼€æ˜¯ä¸ºäº†å’Œå½“å‰æ–‡ä»¶å¤¹å†…å·²æœ‰ä»£ç åšåŒºåˆ†
example_test.goä»£ç ä¸­é»˜è®¤ä¼šimportå½“å‰æ–‡ä»¶å¤¹</p>

<p>3.æ¨¡å—</p>

<p>å¸¸ç”¨çš„10ä¸ªï¼šItã€Contextã€Describeã€BeforeEachã€AfterEachã€JustBeforeEachã€BeforeSuiteã€AfterSuiteã€Byã€Fail</p>

<p>Itæ˜¯æµ‹è¯•ä¾‹çš„åŸºæœ¬å•ä½ï¼Œå³ItåŒ…å«çš„ä»£ç å°±ç®—ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹
Contextå’ŒDescribeçš„åŠŸèƒ½éƒ½æ˜¯å°†ä¸€ä¸ªæˆ–å¤šä¸ªæµ‹è¯•ä¾‹å½’ç±»
BeforeEachæ˜¯æ¯ä¸ªæµ‹è¯•ä¾‹æ‰§è¡Œå‰æ‰§è¡Œè¯¥æ®µä»£ç 
AfterEachæ˜¯æ¯ä¸ªæµ‹è¯•ä¾‹æ‰§è¡Œåæ‰§è¡Œè¯¥æ®µä»£ç 
JustBeforeEachæ˜¯åœ¨BeforeEachæ‰§è¡Œä¹‹åï¼Œæµ‹è¯•ä¾‹æ‰§è¡Œä¹‹å‰æ‰§è¡Œ
BeforeSuiteæ˜¯åœ¨è¯¥æµ‹è¯•é›†æ‰§è¡Œå‰æ‰§è¡Œï¼Œå³è¯¥æ–‡ä»¶å¤¹å†…çš„æµ‹è¯•ä¾‹æ‰§è¡Œä¹‹å‰
AfterSuiteæ˜¯åœ¨è¯¥æµ‹è¯•é›†æ‰§è¡Œåæ‰§è¡Œï¼Œå³è¯¥æ–‡ä»¶å¤¹å†…çš„æµ‹è¯•ä¾‹æ‰§è¡Œå®Œå
Byæ˜¯æ‰“å°ä¿¡æ¯ï¼Œå†…å®¹åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œåªä¼šåœ¨æµ‹è¯•ä¾‹å¤±è´¥åæ‰“å°ï¼Œä¸€èˆ¬ç”¨äºè°ƒè¯•å’Œå®šä½é—®é¢˜
Failæ˜¯æ ‡å¿—è¯¥æµ‹è¯•ä¾‹è¿è¡Œç»“æœä¸ºå¤±è´¥ï¼Œå¹¶æ‰“å°é‡Œé¢çš„ä¿¡æ¯
è¿˜æœ‰ä¸€ä¸ªSpecifyå’ŒItåŠŸèƒ½å®Œå…¨ä¸€æ ·ï¼ŒItå±äºå…¶ç®€å†™</p>

<p>4.ä½¿ç”¨</p>

<p>var _ = Describe(â€œBookâ€, func() {
    var (
        book Book
        err error
        json string
    )</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BeforeEach(func() {
    json = `{
        "title":"Les Miserables",
        "author":"Victor Hugo",
        "pages":1488
    }`
})

JustBeforeEach(func() {
    book, err = NewBookFromJSON(json)
})

AfterEach(func() {
    By("End One Test")
})

Describe("loading from JSON", func() {
    Context("when the JSON parses succesfully", func() {
        It("should populate the fields correctly", func() {
            Expect(book.Title).To(Equal("Les Miserables"))
            Expect(book.Author).To(Equal("Victor Hugo"))
            Expect(book.Pages).To(Equal(1488))
        })

        It("should not error", func() {
            Expect(err).NotTo(HaveOccurred())
        })
    })

    Context("when the JSON fails to parse", func() {
        BeforeEach(func() {
            json = `{
                "title":"Les Miserables",
                "author":"Victor Hugo",
                "pages":1488oops
            }`
        })

        It("should return the zero-value for the book", func() {
            Expect(book).To(BeZero())
        })

        It("should error", func() {
            if err != nil {
                Fail("This Case Failed")
            }
        })
    })
})

Describe("Extracting the author's last name", func() {
    It("should correctly identify and return the last name", func() {
        Expect(book.AuthorLastName()).To(Equal("Hugo"))
    })
}) }) å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆå®šä¹‰äº†å…¨å±€å˜é‡bookã€errå’Œjsonã€‚ äº”ä¸ªæµ‹è¯•ä¾‹åˆ†æˆä¸¤å¤§ç±»ï¼Œç”±ä¸¤ä¸ªDescribeåŒºåˆ†ï¼Œç¬¬ä¸€ç±»åˆåˆ†æˆä¸¤å°ç±»ï¼Œç”¨ContextåšåŒºåˆ†ã€‚æ¯ä¸ªItåŒ…å«çš„å°±æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚ ç”±ä¸¤ä¸ªBeforeEachï¼Œæ¯ä¸ªBeforeEachåªåœ¨å½“å‰åŸŸå†…èµ·ä½œç”¨ã€‚æ‰§è¡Œé¡ºåºæ˜¯åŒä¸€å±‚çº§çš„é¡ºåºæ‰§è¡Œï¼Œä¸åŒå±‚çº§çš„ä»å¤–å±‚åˆ°é‡Œå±‚ä»¥æ­¤æ‰§è¡Œã€‚AfterEachè¯¥è§„åˆ™ç›¸åã€‚ AfterEachä¸€èˆ¬ç”¨äºæµ‹è¯•ä¾‹æ‰§è¡Œå®Œæˆåè¿›è¡Œæ•°æ®æ¸…ç†ï¼Œä¹Ÿå¯ä»¥ç”¨äºç»“æœåˆ¤æ–­ å°½é‡ä¸è¦è¦varé‡Œé¢ç»™å˜é‡èµ‹å€¼ï¼Œå› ä¸ºæ¯æ¬¡æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹éƒ½æœ‰å¯èƒ½æ”¹å˜å…¨å±€å˜é‡çš„å€¼ï¼Œä¼šå¯¹åé¢çš„æµ‹è¯•ä¾‹äº§ç”Ÿå½±å“ï¼Œå†™åœ¨BeforeEachä¸­æ¯”è¾ƒåˆé€‚ func TestBooks(t *testing.T) {
RegisterFailHandler(Fail)

RunSpecs(t, "Books Suite") }
</code></pre></div></div>

<p>var _ = BeforeSuite(func() {
    dbRunner = db.NewRunner()
    err := dbRunner.Start()
    Expect(err).NotTo(HaveOccurred())</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dbClient = db.NewClient()
err = dbClient.Connect(dbRunner.Address())
Expect(err).NotTo(HaveOccurred()) })
</code></pre></div></div>

<p>var _ = AfterSuite(func() {
    dbClient.Cleanup()
    dbRunner.Stop()
})
BeforeSuiteå’ŒAfterSuiteå†™åœ¨_suite_test.goæ–‡ä»¶ä¸­ï¼Œä¼šåœ¨æ‰€æœ‰æµ‹è¯•ä¾‹æ‰§è¡Œä¹‹å‰å’Œä¹‹åæ‰§è¡Œ
å¦‚æœBeforeSuiteæ‰§è¡Œå¤±è´¥ï¼Œåˆ™è¿™ä¸ªæµ‹è¯•é›†éƒ½ä¸ä¼šè¢«æ‰§è¡Œ
Tipï¼šä½¿ç”¨^Cä¸­æ–­æ‰§è¡Œæ—¶ï¼ŒAfterSuiteä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œéœ€è¦å†ä½¿ç”¨ä¸€æ¬¡^Cä¸­æ–­</p>

<p>5.æ ‡å¿—</p>

<p>æœ‰ä¸‰ä¸ªï¼šFã€Xå’ŒPï¼Œå¯ä»¥ç”¨åœ¨Describeã€Contextã€Itç­‰ä»»ä½•åŒ…å«æµ‹è¯•ä¾‹çš„æ¨¡å—</p>

<p>Få«ä¹‰Focusï¼Œä½¿ç”¨åè¡¨ç¤ºåªæ‰§è¡Œè¯¥æ¨¡å—åŒ…å«çš„æµ‹è¯•
FDescribe(â€œouter describeâ€, func() {
    It(â€œAâ€, func() { â€¦ })
    It(â€œBâ€, func() { â€¦ })
})
Tipï¼šå½“é‡Œå±‚å’Œå¤–å±‚éƒ½å­˜åœ¨Focusæ—¶ï¼Œå¤–å±‚çš„æ— æ•ˆï¼Œå³ä¸‹é¢ä»£ç åªä¼šæ‰§è¡ŒBæµ‹è¯•ç”¨ä¾‹</p>

<p>FDescribe(â€œouter describeâ€, func() {
    It(â€œAâ€, func() { â€¦ })
    FIt(â€œBâ€, func() { â€¦ })
})
Pçš„å«ä¹‰æ˜¯Pendingï¼Œå³ä¸æ‰§è¡Œï¼Œç”¨æ³•å’ŒFä¸€æ ·ï¼Œè§„åˆ™çš„å¤–å±‚çš„ç”Ÿæ•ˆ
Xå’ŒPçš„å«ä¹‰ä¸€æ ·
è¿˜æœ‰ä¸€ä¸ªè·³è¿‡æµ‹è¯•ä¾‹çš„æ–¹å¼æ˜¯åœ¨ä»£ç ä¸­åŠ Skip
It(â€œshould do something, if it canâ€, func() {
    if !someCondition {
        Skip(â€œspecial condition wasnâ€™t metâ€)
    }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// assertions go here }) æ¡ä»¶æ»¡è¶³æ—¶ï¼Œä¼šè·³è¿‡è¯¥æµ‹è¯•ç”¨ä¾‹ 6.å¹¶å‘
</code></pre></div></div>

<p>ginkgo -p ä½¿ç”¨é»˜è®¤å¹¶å‘æ•°
ginkgo -nodes=N è‡ªå·±è®¾å®šå¹¶å‘æ•°</p>

<p>é»˜è®¤å¹¶å‘æ•°æ˜¯ç”¨çš„å‚æ•°runtime.NumCPU()å€¼ï¼Œå³é€»è¾‘CPUä¸ªæ•°ï¼Œå¤§äº4æ—¶ï¼Œç”¨runtime.NumCPU()-1</p>

<p>å¹¶å‘æ‰§è¡Œæ—¶æ‰“å°çš„æ—¥å¿—æ˜¯æ±‡æ€»åç»è¿‡åˆå¹¶å¤„ç†å†æ‰“å°çš„ï¼Œæ‰€ä»¥çœ‹èµ·æ¥æ¯”è¾ƒè§„èŒƒï¼Œæ¯ä¸ªæµ‹è¯•ä¾‹çš„å†…å®¹ä¹Ÿéƒ½æ‰“å°åœ¨ä¸€èµ·ï¼Œä½†æ—¶ä¸å®æ—¶ï¼Œå¦‚æœéœ€è¦å®æ—¶æ‰“å°ï¼ŒåŠ -streamå‚æ•°ï¼Œç¼ºç‚¹æ˜¯æ¯ä¸ªæµ‹è¯•ä¾‹æ—¥å¿—äº¤å‰æ‰“å°</p>

<p>7.goroutine</p>

<p>It(â€œshould post to the channel, eventuallyâ€, func(done Done) {
    c := make(chan string, 0)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go DoSomething(c)
Expect(&lt;-c).To(ContainSubstring("Done!"))
close(done) }, 0.2) Ginkgoæ£€æµ‹åˆ°Doneç±»å‹å‚æ•°ï¼Œå°±ä¼šè‡ªåŠ¨è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå°±æ˜¯åé¢é‚£ä¸ª0.2ï¼Œå•ä½æ˜¯ç§’
</code></pre></div></div>

<p>8.DesctibeTableç”¨æ³•</p>

<p>æœ‰æ—¶å€™å¾ˆå¤šæµ‹è¯•ä¾‹é™¤äº†æ•°æ®éƒ¨åˆ†å…¶ä»–éƒ½æ˜¯ç›¸åŒçš„ï¼Œå†™å¾ˆå¤šç±»ä¼¼çš„Itä¼šå¾ˆç¹çï¼Œäºæ˜¯æœ‰Tableæ ¼å¼å‡ºç°</p>

<p>package table_test</p>

<p>import (
    . â€œgithub.com/onsi/ginkgo/extensions/tableâ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. "github.com/onsi/ginkgo"
. "github.com/onsi/gomega" )
</code></pre></div></div>

<p>var _ = Describe(â€œMathâ€, func() {
    DescribeTable(â€œthe &gt; inequalityâ€,
        func(x int, y int, expected bool) {
            Expect(x &gt; y).To(Equal(expected))
        },
        Entry(â€œx &gt; yâ€, 1, 0, true),
        Entry(â€œx == yâ€, 0, 0, false),
        Entry(â€œx &lt; yâ€, 0, 1, false),
    )
})</p>

<p>ç­‰åŒäº</p>

<p>package table_test</p>

<p>import (
    . â€œgithub.com/onsi/ginkgoâ€
    . â€œgithub.com/onsi/gomegaâ€
)</p>

<p>var _ = Describe(â€œMathâ€, func() {
    Describe(â€œthe &gt; inequalityâ€,
        It(â€œx &gt; yâ€, func() {
            Expect(1 &gt; 0).To(Equal(true))
        })</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    It("x == y", func() {
        Expect(0 &gt; 0).To(Equal(false))
    })

    It("x &lt; y", func() {
        Expect(0 &gt; 1).To(Equal(false))
    })
) }) 9.ç”ŸæˆJUnitæµ‹è¯•æŠ¥å‘Š ä¸€èˆ¬ç”ŸæˆJunitçš„XMLæµ‹è¯•æŠ¥å‘Š func TestFoo(t *testing.T) {
RegisterFailHandler(Fail)
junitReporter := reporters.NewJUnitReporter("junit.xml")
RunSpecsWithDefaultAndCustomReporters(t, "Foo Suite", []Reporter{junitReporter}) }
</code></pre></div></div>

<p>10.æµ‹è¯•ä¾‹æ€§èƒ½
ä½¿ç”¨Measureæ¨¡å—
Measure(â€œit should do something hard efficientlyâ€, func(b Benchmarker) {
    runtime := b.Time(â€œruntimeâ€, func() {
        output := SomethingHard()
        Expect(output).To(Equal(17))
    })</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Î©(runtime.Seconds()).Should(BeNumerically("&lt;", 0.2), "SomethingHard() shouldn't take too long.")

b.RecordValue("disk usage (in MB)", HowMuchDiskSpaceDidYouUse()) }, 10) è¯¥æµ‹è¯•ä¾‹ä¼šè¿è¡Œ10æ¬¡ï¼Œå¹¶æ‰“å°å‡ºæ‰§è¡Œæ€§èƒ½æ•°æ®
</code></pre></div></div>

<p>â€¢ [MEASUREMENT]
Suite
    it should do something hard efficiently</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ran 10 samples:
runtime:
  Fastest Time: 0.01s
  Slowest Time: 0.08s
  Average Time: 0.05s Â± 0.02s

disk usage (in MB):
  Smallest: 3.0
   Largest: 5.2
   Average: 3.9 Â± 0.4
</code></pre></div></div>
:ET