I"¶$<p>https://guidao.github.io/go_debug.html#orgheadline3
1 è°ƒè¯•å·¥å…·gdb
gdb æ˜¯ä¸€ä¸ªè°ƒè¯•å·¥å…·ï¼Œå¯ä»¥è°ƒè¯•å¾ˆå¤šç§è¯­è¨€ï¼Œå½“ç„¶å…¶ä¸­å°±æœ‰golangã€‚ç”±äºgdbä¸èƒ½æ˜¾ç¤ºgoçš„æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥åœ¨goçš„runtimeæºç ä¸‹æœ‰ä¸€ä¸ªpythonä»£ç æ–‡ä»¶,runtime-gdb.pyï¼Œæä¾›ç»™gdbä¸€ä¸ªæ‰©å±•ã€‚</p>

<p>1.1 gdb è°ƒè¯•goç¨‹åº
å…ˆå†™ä¸€ä¸ªå¾ˆç®€å•çš„å°ç¨‹åº</p>

<p>package main</p>

<p>import (
  â€œfmtâ€
)</p>

<p>func main() {
  b := make(map[string]string)
  b[â€œwriteâ€] = â€œwriteâ€
  b[â€œblackâ€] = â€œblackâ€
  fmt.Println(b)
}
go build -gcflags â€œ-N -lâ€ test8.go
ç¼–è¯‘ä»£ç ï¼Œ-gcflagsæ˜¯ç»™goç¼–è¯‘å™¨çš„å‚æ•°ï¼Œgcæ˜¯go compileçš„æ„æ€ã€‚-Næ˜¯ä¸è¦ä¼˜åŒ–ä»£ç ï¼Œ-l æ˜¯ç¦æ­¢å†…è”ä»£ç ã€‚</p>

<blockquote>
  <p>gdb test8
GNU gdb (Ubuntu 7.10-1ubuntu2) 7.10
Copyright (C) 2015 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <a href="http://gnu.org/licenses/gpl.html">http://gnu.org/licenses/gpl.html</a>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type â€œshow copyingâ€
and â€œshow warrantyâ€ for details.
This GDB was configured as â€œx86_64-linux-gnuâ€.
Type â€œshow configurationâ€ for configuration details.
For bug reporting instructions, please see:</p>
</blockquote>
<p><a href="http://www.gnu.org/software/gdb/bugs/">http://www.gnu.org/software/gdb/bugs/</a>.
Find the GDB manual and other documentation resources online at:
<a href="http://www.gnu.org/software/gdb/documentation/">http://www.gnu.org/software/gdb/documentation/</a>.
For help, type â€œhelpâ€.
Type â€œapropos wordâ€ to search for commands related to â€œwordâ€â€¦
Reading symbols from test8â€¦done.
warning: File â€œ/home/47/go/src/runtime/runtime-gdb.pyâ€ auto-loading has been declined by your <code class="language-plaintext highlighter-rouge">auto-load safe-path' set to "$debugdir:$datadir/auto-load".
To enable execution of this file add
  add-auto-load-safe-path /home/47/go/src/runtime/runtime-gdb.py
line to your configuration file "/home/47/.gdbinit".
To completely disable this security protection add
  set auto-load safe-path /
line to your configuration file "/home/47/.gdbinit".
For more information about this security protection see the
"Auto-loading safe path" section in the GDB manual.  E.g., run from the shell:
  info "(gdb)Auto-loading safe path"
(gdb) info files
Symbols from "/home/47/code/golang/src/test3/test8".
Local exec file:
  </code>/home/47/code/golang/src/test3/test8â€™, file type elf64-x86-64.
  Entry point: 0x456750
  0x0000000000401000 - 0x00000000004aa960 is .text
  0x00000000004ab000 - 0x000000000052dc62 is .rodata
  0x000000000052dc68 - 0x000000000052fd28 is .typelink
  0x000000000052fd28 - 0x000000000052fd28 is .gosymtab
  0x000000000052fd40 - 0x00000000005800d8 is .gopclntab
  0x0000000000581000 - 0x0000000000582ce8 is .noptrdata
  0x0000000000582d00 - 0x0000000000585250 is .data
  0x0000000000585260 - 0x000000000059fab8 is .bss
  0x000000000059fac0 - 0x00000000005a48c0 is .noptrbss
  0x0000000000400fc8 - 0x0000000000401000 is .note.go.buildid
(gdb) l main.main
2 
3 import (
4   â€œfmtâ€
5 )
6 
7 func main() {
8   fmt.Println(â€œbegin===============â€)
9   b := make(map[string]string)
10    b[â€œwriteâ€] = â€œwriteâ€
11    b[â€œblackâ€] = â€œblackâ€
(gdb) b 10
Breakpoint 1 at 0x401151: file /home/jyk-47/code/golang/src/test3/test8.go, line 10.
(gdb) r
Starting program: /home/jyk-47/code/golang/src/test3/test8 
[New LWP 21285]
[New LWP 21286]
[New LWP 21287]
begin===============</p>

<p>Breakpoint 1, main.main () at /home/jyk-47/code/golang/src/test3/test8.go:10
10    b[â€œwriteâ€] = â€œwriteâ€
(gdb) l
5 )
6 
7 func main() {
8   fmt.Println(â€œbegin===============â€)
9   b := make(map[string]string)
10    b[â€œwriteâ€] = â€œwriteâ€
11    b[â€œblackâ€] = â€œblackâ€
12    fmt.Println(b)
13  }
(gdb) p b
$1 = (map[string]string) 0xc8200121e0
(gdb) p *b
$2 = {count = 0, flags = 0 â€˜\000â€™, B = 0 â€˜\000â€™, hash0 = 1888351057, buckets = 0x0, oldbuckets = 0x0, nevacuate = 0, overflow = 0x0}
(gdb) n
11    b[â€œblackâ€] = â€œblackâ€
(gdb) bt
#0  main.main () at /home/jyk-47/code/golang/src/test3/test8.go:11
(gdb) bp
å¯ä»¥çœ‹åˆ°ä¸Šé¢å·²ç»åŠ è½½äº†golangçš„æ‰©å±•è„šæœ¬runtime-gdb.py, l main.main æ˜¯æŸ¥çœ‹mainå‡½æ•°çš„æºç ï¼Œb 10 åœ¨ç¬¬10è¡Œè®¾ç½®æ–­ç‚¹ã€‚r è¿è¡Œç¨‹åºã€‚p b æ˜¯æ‰“å°å˜é‡ã€‚n æ˜¯å•æ­¥ã€‚gdbä¸èƒ½æ‰“å°goä¸­mapå…·ä½“çš„å†…å®¹ï¼Œåªèƒ½å¤Ÿæ‰“å°mapåº•å±‚çš„ç»“æ„ï¼Œç”¨èµ·æ¥æœ‰ç‚¹ä¸çˆ½ã€‚</p>

<p>2 golang è°ƒè¯•å·¥å…·delve
ç”±äºgdbå¯¹golangæ”¯æŒæ¯”è¾ƒå·®ï¼Œåªèƒ½æ”¯æŒä¸€äº›ç®€å•çš„åŠŸèƒ½,æ¯”å¦‚æ–­ç‚¹ï¼Œå•æ­¥ç­‰ï¼Œä½†å¯¹goroutine, å†…ç½®å¯¹è±¡çš„æ‰“å°ç­‰è¿˜æ˜¯ä¸æ€ä¹ˆå¥½ã€‚æ‰€ä»¥goæœ‰äº†è‡ªå·±çš„debugå·¥å…·delveã€‚å®‰è£…ç­‰å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://github.com/derekparker/delve.</p>

<p>Delve is a source level debugger for Go programs.</p>

<p>Delve enables you to interact with your program by controlling the execution of the process,
evaluating variables, and providing information of thread / goroutine state, CPU register state and more.</p>

<p>The goal of this tool is to provide a simple yet powerful interface for debugging Go programs.</p>

<p>Usage:
  dlv [command]</p>

<p>Available Commands:
  attach      Attach to running process and begin debugging.
  connect     Connect to a headless debug server.
  debug       Compile and begin debugging main package in current directory, or the package specified.
  exec        Execute a precompiled binary, and begin a debug session.
  run         Deprecated command. Use â€˜debugâ€™ instead.
  test        Compile test binary and begin debugging program.
  trace       Compile and begin tracing program.
  version     Prints version.</p>

<p>Flags:
      â€“accept-multiclient[=false]: Allows a headless server to accept multiple client connections. Note that the server API is not reentrant and clients will have to coordinate.
      â€“api-version=1: Selects API version when headless.
      â€“build-flags=â€â€: Build flags, to be passed to the compiler.
      â€“headless[=false]: Run debug server only, in headless mode.
  -h, â€“help[=false]: help for dlv
      â€“init=â€â€: Init file, executed by the terminal client.
  -l, â€“listen=â€localhost:0â€: Debugging server listen address.
      â€“log[=false]: Enable debugging server logging.</p>

<p>Use â€œdlv [command] â€“helpâ€ for more information about a command.
delve çš„å¸®åŠ©æ–‡æ¡£è¯´çš„éå¸¸æ¸…æ¥šã€‚æˆ‘ä»¬è¿˜æ˜¯ç”¨ä¸Šé¢çš„é‚£ä¸ªä¾‹å­æ¥è¯´æ˜.</p>

<blockquote>
  <p>dlv exec ./test8
Type â€˜helpâ€™ for list of commands.
//æŸ¥çœ‹ä¸»å‡½æ•°çš„ä»£ç 
(dlv) ls main.main 
   2: 
   3: import (
   4:   â€œfmtâ€
   5: )
   6: 
   7: func main() {
   8:   fmt.Println(â€œbegin===============â€)
   9:   b := make(map[string]string)
  10:   b[â€œwriteâ€] = â€œwriteâ€
  11:   b[â€œblackâ€] = â€œblackâ€
  12:   fmt.Println(b)
//è®¾ç½®æ–­ç‚¹
(dlv) b main.main
Breakpoint 1 set at 0x40101b for main.main() ./test8.go:7
//è¿è¡Œåˆ°æ–­ç‚¹å¤„
(dlv) c
main.main() ./test8.go:7 (hits goroutine(1):1 total:1) (PC: 0x40101b)
     2: 
     3: import (
     4:   â€œfmtâ€
     5: )
     6: 
=&gt;   7: func main() {
     8:   fmt.Println(â€œbegin===============â€)
     9:   b := make(map[string]string)
    10:   b[â€œwriteâ€] = â€œwriteâ€
    11:   b[â€œblackâ€] = â€œblackâ€
    12:   fmt.Println(b)
//å•æ­¥æ‰§è¡Œ
(dlv) n
main.main() ./test8.go:8 (PC: 0x401022)
     3: import (
     4:   â€œfmtâ€
     5: )
     6: 
     7: func main() {
=&gt;   8:   fmt.Println(â€œbegin===============â€)
     9:   b := make(map[string]string)
    10:   b[â€œwriteâ€] = â€œwriteâ€
    11:   b[â€œblackâ€] = â€œblackâ€
    12:   fmt.Println(b)
    13: }
(dlv) 
begin===============
main.main() ./test8.go:9 (PC: 0x40111c)
     4:   â€œfmtâ€
     5: )
     6: 
     7: func main() {
     8:   fmt.Println(â€œbegin===============â€)
=&gt;   9:   b := make(map[string]string)
    10:   b[â€œwriteâ€] = â€œwriteâ€
    11:   b[â€œblackâ€] = â€œblackâ€
    12:   fmt.Println(b)
    13: }
(dlv) n
main.main() ./test8.go:10 (PC: 0x401151)
     5: )
     6: 
     7: func main() {
     8:   fmt.Println(â€œbegin===============â€)
     9:   b := make(map[string]string)
=&gt;  10:   b[â€œwriteâ€] = â€œwriteâ€
    11:   b[â€œblackâ€] = â€œblackâ€
    12:   fmt.Println(b)
    13: }
(dlv) n
main.main() ./test8.go:11 (PC: 0x4011bb)
     6: 
     7: func main() {
     8:   fmt.Println(â€œbegin===============â€)
     9:   b := make(map[string]string)
    10:   b[â€œwriteâ€] = â€œwriteâ€
=&gt;  11:   b[â€œblackâ€] = â€œblackâ€
    12:   fmt.Println(b)
    13: }
//æ‰“å°bçš„å€¼
(dlv) p b
map[string]string [
  â€œwriteâ€: â€œwriteâ€, 
]
(dlv)
dlvè¿˜æä¾›ä¸€äº›å‘½ä»¤ï¼Œæ€»çš„æ¥è¯´å¯¹äºç®€å•çš„è°ƒè¯•è¶³å¤Ÿäº†ã€‚ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿, ä¸è¿‡å¦‚æœè°ƒè¯•goæ±‡ç¼–ä»£ç ï¼Œå°±æœ‰ç‚¹ä¸è¶³ï¼Œ-0- å•æ­¥éƒ½ä¸èƒ½ä½¿ç”¨ã€‚</p>
</blockquote>

<p>3 ç›¸å…³é“¾æ¥
Debugging Go Code with GDB
https://github.com/derekparker/delve
<!-- more -->
dlvå‰ç«¯(gdlv)
dlvæä¾›äº†ç±»ä¼¼gdbçš„cliè°ƒè¯•ç³»ç»Ÿï¼Œè€Œæœ‰ç¬¬ä¸‰æ–¹è¿˜æä¾›äº†dlvçš„GUIå‰ç«¯(gdlv)ï¼Œå¯¹äºé‚£äº›ä¹ æƒ¯äº†ä½¿ç”¨GUIè¿›è¡Œè°ƒè¯•çš„äººæ¥è¯´ï¼Œç»“åˆgdlvå’Œdlvï¼Œè°ƒè¯•ä¼šæ›´åŠ æ–¹ä¾¿ã€‚gdlvæœ‰ä¸ªé—®é¢˜æ˜¯ï¼šä»–æ— æ³•åœ¨xwindows serverä¸Šè¿è¡Œï¼Œåªèƒ½åœ¨serveræœ¬åœ°è¿è¡Œ
https://github.com/aarzilli/gdlv
go get -u github.com/aarzilli/gdlv</p>
:ET