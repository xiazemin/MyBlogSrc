I"„<p>æ–¹å¼1:å‘½ä»¤è¡Œ
#!/bin/bash
cd shell/
~/goLang/bin/gotests -all -w ./
#ç”Ÿæˆæµ‹è¯•æ–‡ä»¶,æ·»åŠ æµ‹è¯•ç”¨ä¾‹
go test -coverprofile=coverage.out
#ç”Ÿæˆcoverage.out
go tool cover -html=coverage.out
#å¼¹å‡ºé¡µé¢
#file:///var/folders/r9/35q9g3d56_d9g0v59w9x2l9w0000gn/T/cover915348153/coverage.html#file0</p>

<p>æ–¹å¼2:subline æ’ä»¶
subline text 3 æ³¨å†Œç 
â€”â€“ BEGIN LICENSE â€”â€“
sgbteam
Single User License
EA7E-1153259
8891CBB9 F1513E4F 1A3405C1 A865D53F
115F202E 7B91AB2D 0D2A40ED 352B269B
76E84F0B CD69BFC7 59F2DFEF E267328F
215652A3 E88F9D8F 4C38E3BA 5B2DAAE4
969624E7 DC9CD4D5 717FB40C 1B9738CF
20B3C4F1 E917B5B3 87C38D9C ACCE7DD8
5F7EF854 86B9743C FADC04AA FB0DA5C0
F913BE58 42FEA319 F954EFDD AE881E0B
â€”â€” END LICENSE â€”â€”</p>

<p>1ï¼Œä¸‹è½½å®‰è£…gotest
https://github.com/cweill/gotests
2ï¼Œé…ç½®subline text 3
https://github.com/cweill/GoTests-Sublime
å…·ä½“å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š 
ï¼ˆ1ï¼‰å®‰è£…Package Controlï¼Œè¿™ä¸ªå¦‚æœå·²ç»å®‰è£…è¿‡çš„æœ‹å‹å¯ä»¥ç›´æ¥è·³è¿‡ã€‚å…³äºPackage Controlçš„å®‰è£…å¯ä»¥å‚è€ƒã€ŠSublime text 2/3 ä¸­ Package Control çš„å®‰è£…ä¸ä½¿ç”¨æ–¹æ³•ã€‹</p>

<p>ï¼ˆ2ï¼‰æ‰“å¼€Sublime Text 3 ï¼ŒæŒ‰ä½Ctrl+Shift+p ï¼Œå¼¹å‡ºå¦‚ä¸‹è¾“å…¥çª—å£ï¼Œåœ¨å…¶ä¸­è¾“å…¥install packageï¼Œå¹¶é€‰ä¸­çº¢æ¡†å†…çš„åˆ—è¡¨ã€‚</p>

<p>3ï¼Œå®‰è£…gotest
Run the Package Control: Install Package command
Find and install GoTests
Restart Sublime Text (if required)</p>

<p><img src="https://xiazemin.github.io/MyBlog/img/gotests.gif" />
4ï¼Œå®‰è£…GoSublime
GoSublime æ˜¯ä¸€ä¸ªäº¤äº’å¼çš„go build å·¥å…·ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿ï¼Œä¸»è¦é…åˆGolang buildä½¿ç”¨ã€‚</p>

<p>ç‚¹å‡» Preferences &gt; Package control èœå•(MACå¿«æ·é”® shift + command + p)
åœ¨å¼¹å‡ºçš„è¾“å…¥æ¡†è¾“å…¥install é€‰æ‹©Package control:install package
ç„¶åè¾“å…¥GoSublime é€‰æ‹© GoSublime å®‰è£…</p>

<p>5ï¼Œå®‰è£…mockery
https://github.com/vektra/mockery
go get github.com/vektra/mockery/â€¦/</p>

<!-- more -->
<p>1,$go get -u github.com/cweill/gotests/â€¦
 # cd /Users/didi/goLang/src/golang.org/x/tools; git pull â€“ff-only
fatal: unable to access â€˜https://go.googlesource.com/tools/â€™: Failed to connect to go.googlesource.com port 443: Operation timed out
package golang.org/x/tools/imports: exit status 1</p>

<p>è§£å†³æ–¹æ¡ˆ
mkdir ï¼p  golang.org/x/
https://github.com/golang/tools
cd tools/imports
go install</p>

<p>https://github.com/cweill/gotests
cd gotests 
go install</p>

<p>2,GoTests error: [Errno 2] No such file or directory: â€˜gotestsâ€™.
gopathé…ç½®ä¸æ­£ç¡®
// GoTests.sublime-settings
{
	// Add your GOPATH here.
	â€œGOPATHâ€: â€œ/Users/didi/goLangâ€,
}
æˆ–è€…cweill/gotests æ²¡æœ‰å®‰è£…æˆåŠŸ</p>

<p>3ï¼ŒError trying to parse settings: Expected value in Packages/User/GoTests.sublime-settings:1:1
é…ç½®æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®</p>

<p>mockæ˜¯å•å…ƒæµ‹è¯•ä¸­å¸¸ç”¨çš„ä¸€ç§æµ‹è¯•æ‰‹æ³•ï¼Œmockå¯¹è±¡è¢«å®šä¹‰ï¼Œå¹¶èƒ½å¤Ÿæ›¿æ¢æ‰çœŸå®çš„å¯¹è±¡è¢«æµ‹è¯•çš„å‡½æ•°æ‰€è°ƒç”¨ã€‚
è€Œmockå¯¹è±¡å¯ä»¥è¢«å¼€å‘äººå‘˜å¾ˆçµæ´»çš„æŒ‡å®šä¼ å…¥å‚æ•°ï¼Œè°ƒç”¨æ¬¡æ•°ï¼Œè¿”å›å€¼å’Œæ‰§è¡ŒåŠ¨ä½œï¼Œæ¥æ»¡è¶³æµ‹è¯•çš„å„ç§æƒ…æ™¯å‡è®¾ã€‚
ä½¿ç”¨åœºæ™¯</p>

<p>ä¾èµ–çš„æœåŠ¡è¿”å›ä¸ç¡®å®šçš„ç»“æœï¼Œå¦‚è·å–å½“å‰æ—¶é—´ã€‚
ä¾èµ–çš„æœåŠ¡è¿”å›çŠ¶æ€ä¸­æœ‰çš„éš¾ä»¥é‡å»ºæˆ–å¤ç°ï¼Œæ¯”å¦‚æ¨¡æ‹Ÿç½‘ç»œé”™è¯¯ã€‚
ä¾èµ–çš„æœåŠ¡æ­å»ºç¯å¢ƒä»£ä»·é«˜ï¼Œé€Ÿåº¦æ…¢ï¼Œéœ€è¦ä¸€å®šçš„æˆæœ¬ï¼Œæ¯”å¦‚æ•°æ®åº“ï¼ŒwebæœåŠ¡
ä¾èµ–çš„æœåŠ¡è¡Œä¸ºå¤šå˜ã€‚
ä¸ºäº†ä¿è¯æµ‹è¯•çš„è½»é‡ä»¥åŠå¼€å‘äººå‘˜å¯¹æµ‹è¯•æ•°æ®çš„æŒæ§ï¼Œé‡‡ç”¨mockæ¥æ–©æ–­è¢«æµ‹è¯•ä»£ç ä¸­çš„ä¾èµ–ä¸å¤±ä¸ºä¸€ç§å¥½æ–¹æ³•ã€‚</p>

<p>æ¯ç§ç¼–ç¨‹è¯­è¨€æ ¹æ®è¯­è¨€ç‰¹ç‚¹å…¶æ‰€é‡‡ç”¨çš„mockå®ç°æœ‰æ‰€ä¸åŒã€‚</p>

<p>ä½¿ç”¨
Run: mockery -name=Stringerç”Ÿæˆçš„mockåç§° and the following will be output to mocks/Stringer.go
1ã€ç”Ÿæˆmockæ–‡ä»¶ï¼Œé»˜è®¤åœ¨./mocksç›®å½•ä¸‹
mockery -name=Mockeræ¥å£å</p>

<p>2ã€ç”Ÿæˆmockè¾“å‡ºåˆ°æ§åˆ¶å°
mockery -name=æ¥å£å -print</p>

<p>ä»£ç å¤„ç†ï¼š
1.ä¸šåŠ¡æ¥å£</p>

<p>1.å®šä¹‰è¢«mockçš„æ¥å£
2.å®šä¹‰ç±»ï¼ˆå®ç°æ¥å£ï¼‰
3.å®šä¹‰ä¸ªæ–¹æ³•Newï¼ˆï¼‰ï¼Œè¿”å›è¯¥ç±»å¯¹è±¡</p>

<p>// 1.å®šä¹‰æ¥å£
type Driver interface {
    Add(*ImportSet) (int64, error)
    }
// 2.å®šä¹‰ç±»ï¼Œå®ç°è¯¥æ¥å£
type driverImp struct{}</p>

<p>//3.å®šä¹‰æ–¹æ³•ï¼Œåˆ›å»ºè¯¥ç±»å¯¹è±¡
func NewDriver() Driver {
    return &amp;driverImp{}
}</p>

<p>2.ç”Ÿæˆmockæ–¹æ³•
mockery -name=æ¥å£å -print
ç”Ÿæˆè¦è¢«mockçš„æ–¹æ³•
3.serviceå±‚è°ƒç”¨å¤„
// ç”¨åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ï¼Œè·å–å¯¹è±¡ï¼Œè°ƒç”¨æ¥å£æ–¹æ³•
NewDriver().QueryImportDetails(req.ImportUuid)</p>

<p>4.å•å…ƒæµ‹è¯•</p>

<p>func TestFunc(t *testing.T) {
//ä¿å­˜åŸæ¥çš„å¯¹è±¡helper.ListDrvå°±æ˜¯newDrv()
    oldFd := helper.ListDrv
    //æœ€åè¿˜åŸå¯¹è±¡
    defer func() {
        helper.ListDrv = oldFd
    }()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type args struct {
    ctx context.Context
    req 
}
tests := []struct {
    name    string
    args    args
    want    *****
    wantErr bool
    //åœ¨è¡¨é©±åŠ¨ä¸­ï¼Œå†™mockæ–¹æ³•
    mock    func()
}{
    {
        name: "error",
        args: args{
            ctx: context.Background(),
            req: **,
        },
        wantErr: false,
        want:    ***

        mock: func() {
            mfd := &amp;listmock.Driver{}
            mfd.On("QueryCount").Return(int64(0), nil)
            mfd.On("QueryList", mock.Anything, mock.Anything).Return([]list.ImportList{\{UUID: "xxx", Description: "ddddd"}\}, nil)
            //è¿˜åŸå¯¹è±¡
            helper.ListDrv = mfd
        },
    },
    },

    // æµ‹è¯•ç”¨ä¾‹ 
for _, tt := range tests {
// æ‰§è¡Œmockæ–¹æ³•
    tt.mock()
    
    t.Run(tt.name, func(t *testing.T) {
        é‡Œé¢çš„å•å…ƒæµ‹è¯•å†…å®¹ä¸å˜ }
</code></pre></div></div>

<p>å¸¸ç”¨å‘½ä»¤
-væ˜¯æ˜¾ç¤ºå‡ºè¯¦ç»†çš„æµ‹è¯•ç»“æœ,
-cover æ˜¾ç¤ºå‡ºæ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹çš„æµ‹è¯•è¦†ç›–ç‡
1 æµ‹è¯•å•ä¸ªæ–‡ä»¶ï¼Œä¸€å®šè¦å¸¦ä¸Šè¢«æµ‹è¯•çš„åŸæ–‡ä»¶
go test -v -cover  file1_test.go file.go</p>

<p>2 æµ‹è¯•å•ä¸ªå‡½æ•°æ–¹æ³•
go test -v -cover  -run TestFuncName</p>

<p>3 æµ‹è¯•æ•´ä¸ªapiåŒ…
åœ¨åŒ…ç»Ÿè®¡ç›®å½•ä¸‹
go test -v -cover ./api/â€¦</p>

<p>4ã€è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼Œä¸ºæŒ‡å®šçš„å‡½æ•°ç”Ÿæˆå•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°
gotests -only â€œå‡½æ•°åç§°â€ file(æºæ–‡ä»¶åç§°).go</p>

<p>5ã€è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼Œä¸ºæŒ‡å®šæ–‡ä»¶ç”Ÿæˆå•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºåˆ°æ–‡ä»¶ä¸­
gotests -all -w origin.go, origin_test.go</p>

<p>6ã€ç”Ÿæˆmock
 //è¾“å‡ºåˆ°æ§åˆ¶å°
 mockery -name=æ¥å£å -print</p>

<p>//è¾“å‡ºåˆ°./mocks/æ¥å£å.goæ–‡ä»¶ä¸­
 mockery -name=æ¥å£å</p>
:ET