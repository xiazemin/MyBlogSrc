I"!<p>docker pull jaegertracing/all-in-one</p>

<p>docker run -d â€“name jaeger
-e COLLECTOR_ZIPKIN_HTTP_PORT=9411
-p 5775:5775/udp
-p 6831:6831/udp
-p 6832:6832/udp
-p 5778:5778
-p 16686:16686
-p 14268:14268
-p 9411:9411
jaegertracing/all-in-one:1.14
<!-- more -->
https://registry.hub.docker.com/r/jaegertracing/all-in-one
Opentracingæ˜¯åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªçš„ä¸€ç§è§„èŒƒæ ‡å‡†ï¼Œæ˜¯CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰ä¸‹çš„é¡¹ç›®ä¹‹ä¸€ã€‚å’Œä¸€èˆ¬çš„è§„èŒƒæ ‡å‡†ä¸åŒï¼ŒOpentracingä¸æ˜¯ä¼ è¾“åè®®ï¼Œæ¶ˆæ¯æ ¼å¼å±‚é¢ä¸Šçš„è§„èŒƒæ ‡å‡†ï¼Œè€Œæ˜¯ä¸€ç§è¯­è¨€å±‚é¢ä¸Šçš„APIæ ‡å‡†ã€‚ä»¥Goè¯­è¨€ä¸ºä¾‹ï¼Œåªè¦æŸé“¾è·¯è¿½è¸ªç³»ç»Ÿå®ç°äº†Opentracingè§„å®šçš„æ¥å£ï¼ˆinterfaceï¼‰ï¼Œç¬¦åˆOpentracingå®šä¹‰çš„è¡¨ç°è¡Œä¸ºï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯´è¯¥åº”ç”¨ç¬¦åˆOpentracingæ ‡å‡†ã€‚è¿™æ„å‘³ç€å¼€å‘è€…åªéœ€ä¿®æ”¹å°‘é‡çš„é…ç½®ä»£ç ï¼Œå°±å¯ä»¥åœ¨ç¬¦åˆOpentracingæ ‡å‡†çš„é“¾è·¯è¿½è¸ªç³»ç»Ÿä¹‹é—´è‡ªç”±åˆ‡æ¢ã€‚</p>

<p>æ‰€å®šä¹‰çš„æ•°æ®æ¨¡å‹ã€‚
Span
Spanæ˜¯ä¸€æ¡è¿½è¸ªé“¾è·¯ä¸­çš„åŸºæœ¬ç»„æˆè¦ç´ ï¼Œä¸€ä¸ªspanè¡¨ç¤ºä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œå•å…ƒï¼Œæ¯”å¦‚å¯ä»¥è¡¨ç¤ºä¸€æ¬¡å‡½æ•°è°ƒç”¨ï¼Œä¸€æ¬¡httpè¯·æ±‚ç­‰ç­‰ã€‚spanä¼šè®°å½•å¦‚ä¸‹åŸºæœ¬è¦ç´ :</p>

<p>æœåŠ¡åç§°(operation name)
æœåŠ¡çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´
K/Vå½¢å¼çš„Tags
K/Vå½¢å¼çš„Logs
SpanContext
Referencesï¼šè¯¥spanå¯¹ä¸€ä¸ªæˆ–å¤šä¸ªspançš„å¼•ç”¨ï¼ˆé€šè¿‡å¼•ç”¨SpanContextï¼‰ã€‚</p>

<p>Tags
Tagsä»¥K/Vé”®å€¼å¯¹çš„å½¢å¼ä¿å­˜ç”¨æˆ·è‡ªå®šä¹‰æ ‡ç­¾ï¼Œä¸»è¦ç”¨äºé“¾è·¯è¿½è¸ªç»“æœçš„æŸ¥è¯¢è¿‡æ»¤ã€‚ä¾‹å¦‚ï¼š http.method=â€GETâ€,http.status_code=200ã€‚å…¶ä¸­keyå€¼å¿…é¡»ä¸ºå­—ç¬¦ä¸²ï¼Œvalueå¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œå¸ƒå°”å‹æˆ–è€…æ•°å€¼å‹ã€‚
spanä¸­çš„tagä»…è‡ªå·±å¯è§ï¼Œä¸ä¼šéšç€ SpanContextä¼ é€’ç»™åç»­spanã€‚
ä¾‹å¦‚ï¼š
span.SetTag(â€œhttp.methodâ€,â€GETâ€)
span.SetTag(â€œhttp.status_codeâ€,200)
å¤åˆ¶ä»£ç Logs
Logsä¸tagsç±»ä¼¼ï¼Œä¹Ÿæ˜¯K/Vé”®å€¼å¯¹å½¢å¼ã€‚ä¸tagsä¸åŒçš„æ˜¯ï¼Œlogsè¿˜ä¼šè®°å½•å†™å…¥logsçš„æ—¶é—´ï¼Œå› æ­¤logsä¸»è¦ç”¨äºè®°å½•æŸäº›äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ã€‚logsçš„keyå€¼åŒæ ·å¿…é¡»ä¸ºå­—ç¬¦ä¸²ï¼Œä½†å¯¹valueç±»å‹åˆ™æ²¡æœ‰é™åˆ¶ã€‚ä¾‹å¦‚ï¼š
span.LogFields(
	log.String(â€œeventâ€, â€œsoft errorâ€),
	log.String(â€œtypeâ€, â€œcache timeoutâ€),
	log.Int(â€œwaited.millisâ€, 1500),</p>

<p>SpanContext
SpanContextæºå¸¦ç€ä¸€äº›ç”¨äºè·¨æœåŠ¡é€šä¿¡çš„ï¼ˆè·¨è¿›ç¨‹ï¼‰æ•°æ®ï¼Œä¸»è¦åŒ…å«ï¼š</p>

<p>è¶³å¤Ÿåœ¨ç³»ç»Ÿä¸­æ ‡è¯†è¯¥spançš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šspan_id,trace_idã€‚
Baggage Itemsï¼Œä¸ºæ•´æ¡è¿½è¸ªè¿ä¿å­˜è·¨æœåŠ¡ï¼ˆè·¨è¿›ç¨‹ï¼‰çš„K/Væ ¼å¼çš„ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ã€‚</p>

<p>Baggage Items
Baggage Itemsä¸tagsç±»ä¼¼ï¼Œä¹Ÿæ˜¯K/Vé”®å€¼å¯¹ã€‚ä¸tagsä¸åŒçš„æ˜¯ï¼š</p>

<p>å…¶keyè·Ÿvalueéƒ½åªèƒ½æ˜¯å­—ç¬¦ä¸²æ ¼å¼
Baggage itemsä¸ä»…å½“å‰spanå¯è§ï¼Œå…¶ä¼šéšç€SpanContextä¼ é€’ç»™åç»­æ‰€æœ‰çš„å­spanã€‚è¦å°å¿ƒè°¨æ…çš„ä½¿ç”¨baggage itemsâ€”â€”å› ä¸ºåœ¨æ‰€æœ‰çš„spanä¸­ä¼ é€’è¿™äº›K,Vä¼šå¸¦æ¥ä¸å°çš„ç½‘ç»œå’ŒCPUå¼€é”€ã€‚</p>

<p>References
Opentracingå®šä¹‰äº†ä¸¤ç§å¼•ç”¨å…³ç³»:ChildOfå’ŒFollowFromã€‚
ChildOf: çˆ¶spançš„æ‰§è¡Œä¾èµ–å­spançš„æ‰§è¡Œç»“æœæ—¶ï¼Œæ­¤æ—¶å­spanå¯¹çˆ¶spançš„å¼•ç”¨å…³ç³»æ˜¯ChildOfã€‚æ¯”å¦‚å¯¹äºä¸€æ¬¡RPCè°ƒç”¨ï¼ŒæœåŠ¡ç«¯çš„spanï¼ˆå­spanï¼‰ä¸å®¢æˆ·ç«¯è°ƒç”¨çš„spanï¼ˆçˆ¶spanï¼‰æ˜¯ChildOfå…³ç³»ã€‚
FollowFromï¼šçˆ¶spançš„æ‰§ä¸ä¾èµ–å­spanæ‰§è¡Œç»“æœæ—¶ï¼Œæ­¤æ—¶å­spanå¯¹çˆ¶spançš„å¼•ç”¨å…³ç³»æ˜¯FollowFromã€‚FollowFromå¸¸ç”¨äºå¼‚æ­¥è°ƒç”¨çš„è¡¨ç¤ºï¼Œä¾‹å¦‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­consumerspanä¸producerspanä¹‹é—´çš„å…³ç³»ã€‚
Trace
Traceè¡¨ç¤ºä¸€æ¬¡å®Œæ•´çš„è¿½è¸ªé“¾è·¯ï¼Œtraceç”±ä¸€ä¸ªæˆ–å¤šä¸ªspanç»„æˆã€‚ä¸‹å›¾ç¤ºä¾‹è¡¨ç¤ºäº†ä¸€ä¸ªç”±8ä¸ªspanç»„æˆçš„trace:
        [Span A]  â†â†â†(the root span)
            |
     +â€”â€”+â€”â€”+
     |             |
 [Span B]      [Span C] â†â†â†(Span C is a <code class="language-plaintext highlighter-rouge">ChildOf</code> Span A)
     |             |
 [Span D]      +â€”+â€”â€”-+
               |           |
           [Span E]    [Span F]Â Â»&gt; [Span G]Â Â»&gt; [Span H]
                                       â†‘
                                       â†‘
                                       â†‘
                         (Span G <code class="language-plaintext highlighter-rouge">FollowsFrom</code> Span F)
å¤åˆ¶ä»£ç æ—¶é—´è½´çš„å±•ç°æ–¹å¼ä¼šæ›´å®¹æ˜“ç†è§£ï¼š
â€“â€“|â€“â€“â€“â€“â€“â€“â€“|â€“â€“â€“â€“â€“â€“â€“|â€“â€“â€“â€“â€“â€“â€“|â€“â€“â€“â€“â€“â€“â€“|â€“â€“â€“â€“â€“â€“â€“|â€“â€“â€“â€“â€“â€“â€“|â€“â€“â€“â€“â€“â€“â€“|â€“&gt; time</p>

<p>[Span AÂ·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·]
   [Span BÂ·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·]
      [Span DÂ·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·]
    [Span CÂ·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·]
         [Span EÂ·Â·Â·Â·Â·Â·Â·]        [Span FÂ·Â·] [Span GÂ·Â·] [Span HÂ·Â·]</p>

<p>Jaeger
Jaeger\ËˆyÄ-gÉ™r\ æ˜¯Uberå¼€æºçš„åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿï¼Œæ˜¯éµå¾ªOpentracingçš„ç³»ç»Ÿä¹‹ä¸€ï¼Œä¹Ÿæ˜¯CNCFé¡¹ç›®ã€‚æœ¬ç¯‡å°†ä½¿ç”¨Jaegeræ¥æ¼”ç¤ºå¦‚ä½•åœ¨ç³»ç»Ÿä¸­å¼•å…¥åˆ†å¸ƒå¼è¿½è¸ªã€‚</p>

<p>ä¸‹è½½å®¢æˆ·ç«¯library:
go get github.com/jaegertracing/jaeger-client-go
å¤åˆ¶ä»£ç åˆå§‹åŒ–Jaeger tracer:
import (
	â€œcontextâ€
	â€œerrorsâ€
	â€œfmtâ€
	â€œioâ€
	â€œtimeâ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"github.com/opentracing/opentracing-go"
"github.com/opentracing/opentracing-go/log"
"github.com/uber/jaeger-client-go"
jaegercfg "github.com/uber/jaeger-client-go/config" ) // initJaeger å°†jaeger tracerè®¾ç½®ä¸ºå…¨å±€tracer func initJaeger(service string) io.Closer {
cfg := jaegercfg.Configuration{
	// å°†é‡‡æ ·é¢‘ç‡è®¾ç½®ä¸º1ï¼Œæ¯ä¸€ä¸ªspanéƒ½è®°å½•ï¼Œæ–¹ä¾¿æŸ¥çœ‹æµ‹è¯•ç»“æœ
	Sampler: &amp;jaegercfg.SamplerConfig{
		Type:  jaeger.SamplerTypeConst,
		Param: 1,
	},
	Reporter: &amp;jaegercfg.ReporterConfig{
		LogSpans: true,
		// å°†spanå‘å¾€jaeger-collectorçš„æœåŠ¡åœ°å€
		CollectorEndpoint: "http://localhost:14268/api/traces",
	},
}
closer, err := cfg.InitGlobalTracer(service, jaegercfg.Logger(jaeger.StdLogger))
if err != nil {
	panic(fmt.Sprintf("ERROR: cannot init Jaeger: %v\n", err))
}
return closer }
</code></pre></div></div>

<p>å¤åˆ¶ä»£ç åˆ›å»ºtracerï¼Œç”Ÿæˆroot spanï¼š
func main() {
	closer := initJaeger(â€œin-processâ€)
	defer closer.Close()
	// è·å–jaeger tracer
	t := opentracing.GlobalTracer()
	// åˆ›å»ºroot span
	sp := t.StartSpan(â€œin-process-serviceâ€)
	// mainæ‰§è¡Œå®Œç»“æŸè¿™ä¸ªspan
	defer sp.Finish()
	// å°†spanä¼ é€’ç»™Foo
	ctx := opentracing.ContextWithSpan(context.Background(), sp)
	Foo(ctx)
}
å¤åˆ¶ä»£ç ä¸Šè¿°ä»£ç åˆ›å»ºäº†ä¸€ä¸ªroot spanï¼Œå¹¶å°†è¯¥spané€šè¿‡contextä¼ é€’ç»™Fooæ–¹æ³•ï¼Œä»¥ä¾¿åœ¨Fooæ–¹æ³•ä¸­å°†è¿½è¸ªé“¾ç»§ç»­å»¶ç»­ä¸‹å»ï¼š
func Foo(ctx context.Context) {
    // å¼€å§‹ä¸€ä¸ªspan, è®¾ç½®spançš„operation_name=Foo
	span, ctx := opentracing.StartSpanFromContext(ctx, â€œFooâ€)
	defer span.Finish()
	// å°†contextä¼ é€’ç»™Bar
	Bar(ctx)
	// æ¨¡æ‹Ÿæ‰§è¡Œè€—æ—¶
	time.Sleep(1 * time.Second)
}
func Bar(ctx context.Context) {
    // å¼€å§‹ä¸€ä¸ªspanï¼Œè®¾ç½®spançš„operation_name=Bar
	span, ctx := opentracing.StartSpanFromContext(ctx, â€œBarâ€)
	defer span.Finish()
	// æ¨¡æ‹Ÿæ‰§è¡Œè€—æ—¶
	time.Sleep(2 * time.Second)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// å‡è®¾Barå‘ç”Ÿäº†æŸäº›é”™è¯¯
err := errors.New("something wrong")
span.LogFields(
	log.String("event", "error"),
	log.String("message", err.Error()),
)
span.SetTag("error", true) }
</code></pre></div></div>

<p>å¤åˆ¶ä»£ç Fooæ–¹æ³•è°ƒç”¨äº†Barï¼Œå‡è®¾åœ¨Barä¸­å‘ç”Ÿäº†ä¸€äº›é”™è¯¯ï¼Œå¯ä»¥é€šè¿‡span.LogFieldså’Œspan.SetTagå°†é”™è¯¯è®°å½•åœ¨è¿½è¸ªé“¾ä¸­ã€‚
é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥å‘ç°ï¼Œå¦‚æœè¦ç¡®ä¿è¿½è¸ªé“¾åœ¨ç¨‹åºä¸­ä¸æ–­å¼€ï¼Œéœ€è¦å°†å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºcontext.Contextï¼Œé€šè¿‡opentracing.ContextWithSpanå°†ä¿å­˜åˆ°contextä¸­ï¼Œé€šè¿‡opentracing.StartSpanFromContextå¼€å§‹ä¸€ä¸ªæ–°çš„å­spanã€‚
æ•ˆæœæŸ¥çœ‹
æ‰§è¡Œå®Œä¸Šé¢çš„ç¨‹åºåï¼Œæ‰“å¼€Jaeger UI: http://localhost:16686/searchï¼Œå¯ä»¥çœ‹åˆ°é“¾è·¯è¿½è¸ªçš„ç»“æœ</p>

<p>https://juejin.cn/post/6844903942309019661
https://github.com/opentracing/opentracing-go
https://github.com/opentracing/specification/blob/master/semantic_conventions.md
https://www.jaegertracing.io/docs/1.33/getting-started/
https://github.com/yurishkuro/opentracing-tutorial/tree/master/go
https://github.com/opentracing/specification/blob/master/specification.md#the-opentracing-data-model
https://github.com/yurishkuro/opentracing-tutorial/tree/master/go</p>
:ET