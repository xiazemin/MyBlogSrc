I"¯<p>Golangçš„IOè¯»å†™æä¾›äº†å¾ˆå¤šç§æ–¹å¼ï¼Œç›®å‰æœ¬äººçŸ¥é“çš„æœ‰ioåº“ã€osåº“ã€ioutilåº“ã€bufioåº“ã€bytes/stringsåº“ç­‰ã€‚
è™½ç„¶åº“å¤šæ˜¯ä¸€ä»¶å¥½äº‹ï¼Œæ„å‘³ç€é€‰æ‹©æ€§å¤šï¼Œä½†è®©æˆ‘å›°æƒ‘çš„ä¸€ç‚¹æ˜¯ï¼šä»€ä¹ˆåœºæ™¯ä¸‹è¯¥ç”¨å“ªä¸ªåº“ï¼Ÿ ä¸ºä»€ä¹ˆï¼Ÿ
åœ¨ç»™å‡ºç»“è®ºå‰ï¼Œæˆ‘å…ˆæƒ³ç»™å‡ºGolangå†…ç½®IOåº“çš„é¡¹ç›®ç»“æ„ï¼Œä¸»è¦æ–¹ä¾¿ç†è§£å’Œå¼•ç”¨ï¼š</p>
<h1 id="åªåˆ—ä¸¾äº†æ ¸å¿ƒçš„ç›®å½•åŠæ–‡ä»¶">åªåˆ—ä¸¾äº†æ ¸å¿ƒçš„ç›®å½•åŠæ–‡ä»¶</h1>
<p>src:</p>
<ul>
  <li>bufio
    <ul>
      <li>bufio.go</li>
    </ul>
  </li>
  <li>bytes
    <ul>
      <li>buffer.go</li>
      <li>reader.go</li>
    </ul>
  </li>
  <li>io
    <ul>
      <li>ioutil
        <ul>
          <li>ioutil.go</li>
        </ul>
      </li>
      <li>io.go</li>
    </ul>
  </li>
  <li>os
    <ul>
      <li>file.go</li>
    </ul>
  </li>
  <li>strings
    <ul>
      <li>reader.go</li>
    </ul>
  </li>
</ul>

<p>å¤åˆ¶ä»£ç 
1.ioåº“å±äºåº•å±‚æ¥å£å®šä¹‰åº“ï¼Œå…¶ä½œç”¨æ˜¯æ˜¯å®šä¹‰ä¸€äº›åŸºæœ¬æ¥å£å’Œä¸€äº›åŸºæœ¬å¸¸é‡ï¼Œå¹¶å¯¹è¿™äº›æ¥å£çš„ä½œç”¨ç»™å‡ºè¯´æ˜ï¼Œå¸¸è§çš„æ¥å£æœ‰Readerã€Writerç­‰ã€‚ä¸€èˆ¬ç”¨è¿™ä¸ªåº“åªæ˜¯ä¸ºäº†è°ƒç”¨å®ƒçš„ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚io.EOFã€‚
2.ioutilåº“åŒ…å«åœ¨ioç›®å½•ä¸‹ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä½œä¸ºä¸€ä¸ªå·¥å…·åŒ…ï¼Œé‡Œé¢æœ‰ä¸€äº›æ¯”è¾ƒå®ç”¨çš„å‡½æ•°ï¼Œæ¯”å¦‚ ReadAll(ä»æŸä¸ªæºè¯»å–æ•°æ®)ã€ReadFileï¼ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼‰ã€WriteFileï¼ˆå°†æ•°æ®å†™å…¥æ–‡ä»¶ï¼‰ã€ReadDirï¼ˆè·å–ç›®å½•ï¼‰
3.osåº“ä¸»è¦æ˜¯è·Ÿæ“ä½œç³»ç»Ÿæ‰“äº¤é“ï¼Œæ‰€ä»¥æ–‡ä»¶æ“ä½œåŸºæœ¬éƒ½ä¼šè·Ÿosåº“æŒ‚é’©ï¼Œæ¯”å¦‚åˆ›å»ºæ–‡ä»¶ã€æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç­‰ã€‚è¿™ä¸ªåº“å¾€å¾€ä¼šå’Œioutilåº“ã€bufioåº“ç­‰é…åˆä½¿ç”¨
4.bufioåº“å¯ä»¥ç†è§£ä¸ºåœ¨ioåº“ä¸Šå†å°è£…ä¸€å±‚ï¼ŒåŠ ä¸Šäº†ç¼“å­˜åŠŸèƒ½ã€‚å®ƒå¯èƒ½ä¼šå’Œioutilåº“å’Œbytes.Bufferææ··ã€‚
4.1 bufio VS ioutilåº“ï¼šä¸¤è€…éƒ½æä¾›äº†å¯¹æ–‡ä»¶çš„è¯»å†™åŠŸèƒ½ï¼Œå”¯ä¸€çš„ä¸åŒå°±æ˜¯bufioå¤šäº†ä¸€å±‚ç¼“å­˜çš„åŠŸèƒ½ï¼Œè¿™ä¸ªä¼˜åŠ¿ä¸»è¦ä½“ç°è¯»å–å¤§æ–‡ä»¶çš„æ—¶å€™ï¼ˆioutil.ReadFileæ˜¯ä¸€æ¬¡æ€§å°†å†…å®¹åŠ è½½åˆ°å†…å­˜ï¼Œå¦‚æœå†…å®¹è¿‡å¤§ï¼Œå¾ˆå®¹æ˜“çˆ†å†…å­˜ï¼‰<br />
4.2 bufio VS bytes.Bufferï¼šä¸¤è€…éƒ½æä¾›ä¸€å±‚ç¼“å­˜åŠŸèƒ½ï¼Œå®ƒä»¬çš„ä¸åŒä¸»è¦åœ¨äº bufio é’ˆå¯¹çš„æ˜¯æ–‡ä»¶åˆ°å†…å­˜çš„ç¼“å­˜ï¼Œè€Œ bytes.Buffer çš„é’ˆå¯¹çš„æ˜¯å†…å­˜åˆ°å†…å­˜çš„ç¼“å­˜ï¼ˆä¸ªäººæ„Ÿè§‰æœ‰ç‚¹åƒchannelï¼Œä½ ä¹Ÿå¯ä»¥å‘ç° bytes.Buffer å¹¶æ²¡æœ‰æä¾›æ¥å£å°†æ•°æ®å†™åˆ°æ–‡ä»¶ï¼‰ã€‚
5.byteså’Œstringsåº“ï¼šè¿™ä¸¤ä¸ªåº“æœ‰ç‚¹è¿·ï¼Œé¦–å…ˆå®ƒä»¬éƒ½å®ç°äº†Readeræ¥å£ï¼Œæ‰€ä»¥å®ƒä»¬çš„ä¸åŒä¸»è¦åœ¨äºé’ˆå¯¹çš„å¯¹è±¡ä¸åŒï¼Œbytesé’ˆå¯¹çš„æ˜¯å­—èŠ‚ï¼Œstringsé’ˆå¯¹çš„æ˜¯å­—ç¬¦ä¸²ï¼ˆå®ƒä»¬çš„æ–¹æ³•å®ç°åŸç†å¾ˆç›¸ä¼¼ï¼‰ã€‚å¦ä¸€ä¸ªåŒºåˆ«å°±æ˜¯ bytesè¿˜å¸¦æœ‰Bufferçš„åŠŸèƒ½ï¼Œä½†æ˜¯ stringsæ²¡æä¾›ã€‚
æ³¨ï¼šå…³äºReaderå’ŒWriteræ¥å£ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºè¯»å–æºå’Œå†™å…¥æºï¼Œå³åªè¦å®ç°Readeré‡Œé¢çš„Readæ–¹æ³•ï¼Œè¿™ä¸ªä¸œè¥¿å°±å¯ä»¥ä½œä¸ºä¸€ä¸ªè¯»å–æºï¼Œé‡Œé¢å¯ä»¥åŒ…å«æ•°æ®å¹¶è¢«æˆ‘ä»¬è¯»å–ï¼›Writeräº¦æ˜¯å¦‚æ­¤ã€‚
ä»¥ä¸Šå°±æ˜¯ä¸ªäººçš„ä¸€äº›ç»“è®ºï¼Œä¸‹é¢ä¼šé’ˆå¯¹ä»¥ä¸Šç»“è®ºåšè¿›ä¸€æ­¥è¯´æ˜ï¼Œå¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹éº»çƒ¦è¯·ç•™è¨€æŒ‡æ­£ï¼Œæ¯”å¿ƒâ¤ï¸ï¼
çª¥æ¢ io åº“
ioåº“æ¯”è¾ƒå¸¸ç”¨çš„æ¥å£æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯Readerï¼ŒWriterå’ŒCloseã€‚
// Readæ–¹æ³•ä¼šæ¥æ”¶ä¸€ä¸ªå­—èŠ‚æ•°ç»„pï¼Œå¹¶å°†è¯»å–åˆ°çš„æ•°æ®å­˜è¿›è¯¥æ•°ç»„ï¼Œæœ€åè¿”å›è¯»å–çš„å­—èŠ‚æ•°nã€‚
// æ³¨æ„nä¸ä¸€å®šç­‰äºè¯»å–çš„æ•°æ®é•¿åº¦ï¼Œæ¯”å¦‚å­—èŠ‚æ•°ç»„pçš„å®¹é‡å¤ªå°ï¼Œnä¼šç­‰äºæ•°ç»„çš„é•¿åº¦
type Reader interface {
    Read(p []byte) (n int, err error)
}</p>

<p>// Write æ–¹æ³•åŒæ ·æ¥æ”¶ä¸€ä¸ªå­—èŠ‚æ•°ç»„pï¼Œå¹¶å°†æ¥æ”¶çš„æ•°æ®ä¿å­˜è‡³æ–‡ä»¶æˆ–è€…æ ‡å‡†è¾“å‡ºç­‰ï¼Œè¿”å›çš„nè¡¨ç¤ºå†™å…¥çš„æ•°æ®é•¿åº¦ã€‚
// å½“nä¸ç­‰äºlen(p)æ—¶ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚
type Writer interface {
    Write(p []byte) (n int, err error)
}</p>

<p>// å…³é—­æ“ä½œ
type Closer interface {
    Close() error
}</p>

<p>å¤åˆ¶ä»£ç 
å…³äº Read æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œå¯ä»¥åœ¨stringsåº“ä¸­çœ‹åˆ°ï¼š
// å®šä¹‰ä¸€ä¸ªReaderæ¥å£ä½“
type Reader struct {
    s        string
    i        int64 // current reading index
    prevRune int   // index of previous rune; or &lt; 0
}</p>

<p>// é€šè¿‡NewReaderæ–¹æ³•å¾—åˆ° reader å¯¹è±¡ï¼Œè¿™é‡Œæœ‰ä¸ªå…³é”®çš„åœ°æ–¹æ˜¯ä¼ å…¥çš„å­—ç¬¦ä¸²è¢«èµ‹å€¼åˆ° s å˜é‡ä¸­
func NewReader(s string) *Reader { 
  return &amp;Reader{s, 0, -1} 
}</p>

<p>// Readæ–¹æ³•ï¼š æ ¸å¿ƒæ˜¯ copy æ–¹æ³•ï¼Œå‚æ•°bè™½ç„¶æ˜¯åˆ‡ç‰‡ï¼Œä½†æ˜¯copyæ–¹æ³•ä¼šå½±å“åˆ°å®ƒçš„åº•å±‚æ•°ç»„
func (r *Reader) Read(b []byte) (n int, err error) {
    if r.i &gt;= int64(len(r.s)) {
        return 0, io.EOF
    }
  r.prevRune = -1
  // æ ¸å¿ƒæ–¹æ³•
    n = copy(b, r.s[r.i:])
    r.i += int64(n)
    return
}</p>

<p>å¤åˆ¶ä»£ç 
çª¥æ¢ ioutil åº“
ä¸Šé¢æåˆ°ï¼Œioutil åº“å°±æ˜¯ä¸€ä¸ªå·¥å…·åŒ…ï¼Œé‡Œé¢ä¸»è¦æ˜¯æ¯”è¾ƒå®ç”¨çš„å‡½æ•°ï¼Œæ¯”å¦‚ReadFileã€WriteFileç­‰ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯å®ƒä»¬éƒ½æ˜¯ä¸€æ¬¡æ€§è¯»å–å’Œä¸€æ¬¡æ€§å†™å…¥ï¼Œæ‰€ä»¥å½“è¯»å–çš„æ—¶å€™æ³¨æ„æ–‡ä»¶ä¸èƒ½è¿‡å¤§ã€‚
ä»æ–‡ä»¶è¯»å–æ•°æ®ï¼š
func readByFile()  {
    data, err := ioutil.ReadFile( â€œ./lab8_io/file/test.txtâ€)
    if err != nil {
        log.Fatal(â€œerr:â€, err)
        return
    }
    fmt.Println(â€œdataâ€, string(data)) // hello worldï¼
}</p>

<p>å¤åˆ¶ä»£ç 
æŠŠæ•°æ®å†™å…¥åˆ°æ–‡ä»¶ï¼š
func writeFile() {
    err := ioutil.WriteFile(â€œ./lab8_io/file/write_test.txtâ€, []byte(â€œhello world!â€), 0644)
    if err != nil {
        panic(err)
        return
    }
}
å¤åˆ¶ä»£ç 
éå†ç›®å½•ï¼šéå†ç›®å½•æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯å®ƒçš„æ’åºå¹¶ä¸æ˜¯è‡ªç„¶æ’åºæ–¹å¼ã€‚
çª¥æ¢bufioåº“
bufio åº“åœ¨ä¸Šé¢ä¹Ÿæåˆ°è¿‡ï¼Œå®ƒä¸»è¦æ˜¯åœ¨ioåº“ä¸ŠåŠ äº†ä¸€å±‚ç¼“å­˜çš„åŠŸèƒ½ï¼Œä»¥ä¸‹æ˜¯bufioè¯»å–å¤§æ–‡ä»¶çš„ä¾‹å­ï¼š
func readBigFile(filePath string) error {
    f, err := os.Open(filePath)
    defer f.Close()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if err != nil {
    log.Fatal(err)
    return err
}

buf := bufio.NewReader(f)
count := 0
for {
    count += 1
    line, err := buf.ReadString('\n')
    line = strings.TrimSpace(line)
    if err != nil {
        return err
    }
fmt.Println("line", line)
// è¿™é‡Œæ˜¯é¿å…å…¨éƒ¨æ‰“å°
    if count &gt; 100 {
        break
    }
}
return nil }
</code></pre></div></div>

<p>å¤åˆ¶ä»£ç 
æ³¨ï¼š
1.bufio çš„ReadLine/ReadBytes/ReadString/ReadSliceï¼š    ReadStringå’ŒReadBytesç­‰åŒï¼ŒReadByteså’ŒReadLineéƒ½è°ƒç”¨äº†ReadSlice
çª¥æ¢bytes/stringsåº“
å‰é¢æè¿‡ï¼Œå°±å•çº¯å®ç°Readeræ¥å£ï¼Œbyteså’Œstringsåº•å±‚å‡½æ•°çš„å®ç°æ–¹å¼æ˜¯å·®ä¸å¤šçš„ï¼Œå¯ä»¥æŸ¥çœ‹å…¶æºç å¾—è¯ï¼š
// bytes/reader.go
// Read implements the io.Reader interface.
func (r *Reader) Read(b []byte) (n int, err error) {
    if r.i &gt;= int64(len(r.s)) {
        return 0, io.EOF
    }
    r.prevRune = -1
    n = copy(b, r.s[r.i:])
    r.i += int64(n)
    return
}</p>

<p>// strings/reader.go
func (r *Reader) Read(b []byte) (n int, err error) {
    if r.i &gt;= int64(len(r.s)) {
        return 0, io.EOF
    }
    r.prevRune = -1
    n = copy(b, r.s[r.i:])
    r.i += int64(n)
    return
}</p>

<!-- more -->
<p>https://juejin.im/post/6864886461746855949
https://gocn.vip/topics/10877
https://gocn.vip/topics/10878</p>
:ET