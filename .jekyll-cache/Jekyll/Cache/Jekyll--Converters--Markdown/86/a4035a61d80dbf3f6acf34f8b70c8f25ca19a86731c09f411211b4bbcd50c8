I"<p>å½“ä½ åˆ›å»ºæ–°çš„ CustomResourceDefinitionï¼ˆCRDï¼‰æ—¶ï¼ŒKubernetes API æœåŠ¡å™¨ä¼šä¸ºä½ æ‰€ æŒ‡å®šçš„æ¯ä¸€ä¸ªç‰ˆæœ¬ç”Ÿæˆä¸€ä¸ª RESTful çš„ èµ„æºè·¯å¾„ã€‚CRD å¯ä»¥æ˜¯åå­—ç©ºé—´ä½œç”¨åŸŸçš„ï¼Œä¹Ÿå¯ä»¥ æ˜¯é›†ç¾¤ä½œç”¨åŸŸçš„ï¼Œå–å†³äº CRD çš„ scope å­—æ®µè®¾ç½®ã€‚</p>

<p>https://kubernetes.io/zh/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/
<!-- more -->
code-generatoræä¾›äº†ä»¥ä¸‹å·¥å…·ä¸ºkubernetesä¸­çš„èµ„æºç”Ÿæˆä»£ç :</p>

<p>deepcopy-gen: ç”Ÿæˆæ·±åº¦æ‹·è´æ–¹æ³•,é¿å…æ€§èƒ½å¼€é”€</p>

<p>client-gen:ä¸ºèµ„æºç”Ÿæˆæ ‡å‡†çš„æ“ä½œæ–¹æ³•(get,list,create,update,patch,delete,deleteCollection,watch)</p>

<p>informer-gen: ç”Ÿæˆinformer,æä¾›äº‹ä»¶æœºåˆ¶æ¥ç›¸åº”kubernetesçš„event</p>

<p>lister-gen: ä¸ºgetå’Œlistæ–¹æ³•æä¾›åªè¯»ç¼“å­˜å±‚</p>

<p>å…¶ä¸­informerå’Œlistersæ˜¯æ„å»ºcontrollerçš„åŸºç¡€,kubebuilderä¹Ÿæ˜¯åŸºäºinformerçš„æœºåˆ¶ç”Ÿæˆçš„ä»£ç .</p>

<p>code-generatorè¿˜ä¸“é—¨æ•´åˆäº†è¿™äº›gen,å½¢æˆäº†generate-groups.shå’Œgenerate-internal-groups.shè¿™ä¸¤ä¸ªè„šæœ¬.</p>

<p>åœ¨æˆ‘ä»¬çš„æºä»£ç ä¸­å‡ºç°äº†å¾ˆå¤š</p>

<p>doc.go</p>

<p>// +k8s:deepcopy-gen=package,register
// +groupName=samplecontroller.k8s.io
types.go</p>

<p>// +genclient
// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object
å‡ºç°äº†è¿™æ ·çš„tag,è¿™äº›tagåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢,æœ‰ä»€ä¹ˆä½œç”¨å‘¢?</p>

<p>åˆ†ç±»
å…¶å®code-generatorå°†tagåˆ†ä¸ºäº†ä¸¤ç§,</p>

<p>Global tags: å…¨å±€çš„tag,æ”¾åœ¨å…·ä½“ç‰ˆæœ¬çš„doc.goæ–‡ä»¶ä¸­</p>

<p>Local tags: æœ¬åœ°çš„tag,æ”¾åœ¨types.goæ–‡ä»¶ä¸­çš„å…·ä½“çš„structä¸Š.</p>

<p>tagçš„ä½¿ç”¨è¯­æ³•ä¸º:</p>

<p>// +tag-name 
æˆ–
// +tag-name=value
å¹¶ä¸” è¿™äº›æ³¨é‡Šå—å¿…é¡»åˆ†å¼€,è¿™ä¹Ÿæ˜¯æºä»£ç ä¸­ æ³¨é‡Šå­˜åœ¨åˆ†å‰²çš„åŸå› .</p>

<p>Global
å…¨å±€çš„tagæ˜¯å†™åœ¨doc.goä¸­çš„,å…¸å‹çš„å†…å®¹å¦‚ä¸‹:</p>

<p>// +k8s:deepcopy-gen=package</p>

<p>// Package v1 is the v1 version of the API.
// +groupName=example.com
package v1
æ³¨æ„: ç©ºè¡Œä¸èƒ½çœ</p>

<p>+k8s:deepcopy-gen=: å®ƒå‘Šè¯‰deepcopyé»˜è®¤ä¸ºè¯¥åŒ…ä¸­çš„æ¯ä¸€ä¸ªç±»å‹åˆ›å»ºdeepcopyæ–¹æ³•</p>

<p>å¦‚æœä¸éœ€è¦æ·±åº¦å¤åˆ¶,å¯ä»¥é€‰æ‹©å…³é—­æ­¤åŠŸèƒ½// +k8s:deepcopy-gen=false</p>

<p>å¦‚æœä¸å¯ç”¨åŒ…çº§åˆ«çš„æ·±åº¦å¤åˆ¶,é‚£ä¹ˆå°±éœ€è¦åœ¨æ¯ä¸ªç±»å‹ä¸ŠåŠ å…¥æ·±åº¦å¤åˆ¶// +k8s:deepcopy-gen=true</p>

<p>+groupName: å®šä¹‰groupçš„åç§°,æ³¨æ„åˆ«å¼„é”™äº†.</p>

<p>æ³¨æ„ è¿™é‡Œæ˜¯ +k8s:deepcopy-gen=,æœ€åæ˜¯ = ,å’Œlocalä¸­çš„åŒºåˆ«å¼€æ¥.</p>

<p>local
æœ¬åœ°çš„tagç›´æ¥å†™åœ¨ç±»å‹ä¸Š,å…¸å‹çš„å†…å®¹å¦‚ä¸‹:</p>

<p>// +genclient
// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object</p>

<p>// Foo is a specification for a Foo resource
type Foo struct {
	metav1.TypeMeta   <code class="language-plaintext highlighter-rouge">json:",inline"</code>
	metav1.ObjectMeta <code class="language-plaintext highlighter-rouge">json:"metadata,omitempty"</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Spec   FooSpec   `json:"spec"`
Status FooStatus `json:"status"` } å¯ä»¥çœ‹åˆ°localæ”¯æŒä¸¤ç§tag
</code></pre></div></div>

<p>+genclient: æ­¤æ ‡ç­¾æ˜¯å‘Šè¯‰client-gen,ä¸ºæ­¤ç±»å‹åˆ›å»ºclientset,ä½†ä¹Ÿæœ‰ä»¥ä¸‹å‡ ç§ç”¨æ³•.</p>

<p>1,å¯¹äºé›†ç¾¤èŒƒå›´å†…çš„èµ„æº(æ²¡æœ‰namespaceé™åˆ¶çš„),éœ€è¦ä½¿ç”¨// +genclient:nonNamespaced,ç”Ÿæˆçš„clientsetä¸­çš„namespace()æ–¹æ³•å°±ä¸å†éœ€è¦ä¼ å…¥å‚æ•°</p>

<p>2,ä½¿ç”¨å­èµ„æºåˆ†ç¦»çš„,ä¾‹å¦‚/statusåˆ†ç¦»çš„,åˆ™éœ€è¦ä½¿ç”¨+genclient:noStatus,æ¥é¿å…æ›´æ–°åˆ°statusèµ„æº(å½“ç„¶ä»£ç çš„structä¸­ä¹Ÿæ²¡æœ‰status)</p>

<p>3,å¯¹äºå…¶ä»–çš„å€¼,è¿™é‡Œä¸åšè¿‡å¤šçš„è§£é‡Š</p>
:ET