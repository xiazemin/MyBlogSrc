I"ø(<p>xtrabackup :
è¿™ä¸ªå¤‡ä»½å·¥å…·æ˜¯æŒºå¥½çš„ï¼Œä½†æ˜¯æœ‰ç¼ºé™·ï¼Œåªå¯ä»¥å¤‡ä»½innodbï¼›ä½†æ˜¯æˆ‘ä»¬ä¹Ÿéœ€è¦å¤‡ä»½myisamï¼Œç„¶åå°±å‡ºæ¥äº†ä¸€ä¸ªå·¥å…·ï¼šinnobackupex
<!-- more -->
ä¸€ã€innobackupex å¤‡ä»½:
1.1 æŸ¥çœ‹æ•°æ®ç›®å½•ï¼š</p>

<p>[[email protected]03 ~]# ls /data/mysql/
auto.cnf  db1  ibdata1  ib_logfile0  ib_logfile1  mysql  mysql2  performance_schema  test  zhdy01  zhdy02  zhdy03  zhdy-03.err  zhdy-03.pid
å…¶å®æˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨mysqldumpå»å¤‡ä»½myisamå’Œinnodbï¼Œä½†æ˜¯é€Ÿåº¦æœ‰ç‚¹æ…¢ï¼Œå¦‚æœé‡åˆ°å¤§çš„æ•°æ®åº“å¾ˆæµªè´¹æ—¶é—´ï¼</p>

<p>ä¸‹é¢æˆ‘ä»¬å°±å¯¹å¦‚ä¸Šçš„ä¸€äº›æ•°æ®è¿›è¡Œå¤‡ä»½ï¼š</p>

<p>1.2 å®‰è£…percona-xtrabackupå·¥å…·ï¼š</p>

<p>[[email protected]03 ~]# rpm -ivh http://www.percona.com/downloads/percona-release/redhat/0.1-3/percona-release-0.1-3.noarch.rpm</p>

<table>
  <tbody>
    <tr>
      <td>[[email protected]03 ~]# yum list</td>
      <td>grep percona</td>
    </tr>
  </tbody>
</table>

<p>[[email protected]03 ~]# yum install percona-xtrabackup -y
1.3 åˆ›å»ºä¸€ä¸ªå¤‡ä»½çš„ç”¨æˆ·ï¼š</p>

<p>å…ˆä½¿ç”¨rootè´¦æˆ·ç™»å½•;</p>

<p>mysql&gt; GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT ON <em>.</em> TO â€˜bakuserâ€™@â€™localhostâ€™ identified by â€˜zhangduanyaâ€™;
Query OK, 0 rows affected (0.00 sec)</p>

<p>åˆ›å»ºä¸€ä¸ªbakuserï¼Œä¸”æˆäºˆRELOAD,LOCK TABLES,REPLICATION CLIENTæƒé™ã€‚</p>

<p>mysql&gt; flush privileges;
Query OK, 0 rows affected (0.00 sec)</p>

<p>åˆ·æ–°ä¸€ä¸‹æƒé™ï¼›
1.4 å¤‡ä»½ï¼š</p>

<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªå¤‡ä»½çš„ç›®å½•ï¼›
[root@zhdy-03 ~]# mkdir -p /data/backup/</p>

<p>[root@zhdy-03 ~]# innobackupex â€“defaults-file=/etc/my.cnf â€“user=bakuser â€“password=â€™zhangduanyaâ€™ -S /tmp/mysql.sock  /data/backup</p>

<p>[root@zhdy-03 backup]# du -sh *
92M	2017-08-23_21-23-46
å¦‚æœåœ¨å¤‡ä»½çš„æ—¶å€™æœ‰ä»»ä½•çš„é”™è¯¯ï¼Œå®ƒä¼šè‡ªåŠ¨çš„åœæ­¢ï¼Œå¹¶è¾“å‡ºé”™è¯¯çš„ä¿¡æ¯ï¼</p>

<p>1.5 å¤‡ä»½å¯¹æ¯”ï¼š</p>

<p>[[email protected]03 backup]# ls /data/mysql/
auto.cnf  db1  ibdata1  ib_logfile0  ib_logfile1  mysql  mysql2  performance_schema  test  zhdy01  zhdy02  zhdy03  zhdy-03.err  zhdy-03.pid</p>

<p>[[email protected]03 backup]# ls /data/backup/2017-08-23_21-23-46/
backup-my.cnf  ibdata1  mysql2              test                    xtrabackup_info     zhdy01  zhdy03
db1            mysql    performance_schema  xtrabackup_checkpoints  xtrabackup_logfile  zhdy02
å…¶å®å¤‡ä»½çš„æ–‡ä»¶+ç›®å½•å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ˜¯ä¸å¯ä»¥ç›´æ¥æ¢å¤ä½¿ç”¨çš„ï¼</p>

<p>äºŒã€innobackupex æ¢å¤ï¼š
2.1 æ¨¡æ‹Ÿæ•°æ®åº“è¢«åˆ é™¤ï¼š</p>

<p>å…ˆåœæ‰æ•°æ®åº“ï¼›
[[email protected] backup]# /etc/init.d/mysqld stop 
Shutting down MySQL.. SUCCESS!</p>

<p>[[email protected]03 backup]# mv /data/mysql /data/mysql.bak
[[email protected]03 backup]# ls /data/
backup  mysql.bak  wwwroot
[[email protected]03 backup]# mkdir -p /data/mysql
[[email protected]03 backup]# chown -R mysql.mysql /data/mysql
2.2 æ¢å¤æ•°æ®ï¼š</p>

<p>[[email protected]03 backup]# innobackupex â€“use-memory=512M â€“apply-log 2017-08-23_21-23-46/</p>

<p>-use-memory=512Mï¼šæ„æ€æ˜¯æ¢å¤æ•°æ®æŒ‡å®šä½¿ç”¨çš„å†…å­˜ä¸º512Mï¼›ï¼ˆå› ä¸ºè¿™æ˜¯è™šæ‹Ÿæœºï¼Œæ‰€ä»¥åªæ˜¯æµ‹è¯•ï¼Œè¦æ˜¯çº¿ä¸Šçš„æœåŠ¡å™¨64Gæˆ‘ä»¬å¯ä»¥ä½¿ç”¨32Gæ¥æ¢å¤æ•°æ®ï¼Œè¿™æ ·é€Ÿåº¦ä¼šæ›´å¿«äº›ï¼‰
â€“apply-log:æŒ‡å®šéœ€è¦æ¢å¤çš„æ—¥å¿—æ–‡ä»¶
å¦‚ä¸Šæˆ‘ä»¬åªæ˜¯åˆå§‹åŒ–äº†ä¸€ä¸‹ï¼›</p>

<p>2.3 ç°åœ¨è¿›è¡Œæ¢å¤ï¼š</p>

<p>[[email protected]03 backup]# innobackupex â€“defaults-file=/etc/my.cnf â€“copy-back ./2017-08-23_21-23-46/</p>

<p>å³å¯æ¢å¤å’±ä»¬çš„å¤‡ä»½åˆ°mysqlç›®å½•ã€‚
å†æ¬¡æ£€æŸ¥ï¼š</p>

<p>[[email protected]03 data]# du -sh *
190M	backup
188M	mysql
188M	mysql.bak
132M	wwwroot
ä¸‰ã€innobackupexå¢é‡å¤‡ä»½
3.1 å…ˆå…¨é‡
innobackupex â€“defaults-file=/etc/my.cnf â€“user=bakuser â€“password=zhangduanya /data/backup</p>

<p>xtrabackup: Transaction log of lsn (3037472) to (3037472) was copied.
170824 22:57:58 completed OK!</p>

<hr />
<p>ç­‰å¾…å‡ºç°å¦‚ä¸Šæ¶ˆæ¯ï¼Œæ„å‘³ç€æˆ‘ä»¬å·²ç»å¯¹å…¨é‡å¤‡ä»½å®Œæ¯•ã€‚
æŸ¥çœ‹å…¨é‡å¤‡ä»½ï¼š</p>

<p>[[email protected]03 ~]# ls /data/backup/
2017-08-24_22-57-43</p>

<p>[[email protected]03 ~]# du -sh /data/backup/
92M	/data/backup/
3.2 åˆ›å»ºå¢é‡å¤‡ä»½</p>

<p>å†å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¨¡æ‹Ÿå¢åŠ ä¸€ä¸ªåº“ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„å¢åŠ çš„æ•°æ®ï¼</p>

<p>[[email protected]03 ~]# mysql -uroot -pzhangduanya -e â€œcreate database db123â€      //åˆ›å»ºä¸€ä¸ªdb123åº“</p>

<p>[[email protected]03 ~]# mysql -uroot -pzhangduanya db123 &lt; /tmp/mysqlbak.sql   //æŠŠä¹‹å‰å¤‡ä»½çš„æ•°æ®æ¢å¤å¾—åˆ°db123åº“
ç¬¬ä¸€æ¬¡å¢é‡å¤‡ä»½ï¼š</p>

<p>[[email protected] ~]# innobackupex â€“user=bakuser â€“password=â€™zhangduanyaâ€™ â€“incremental /data/backup â€“incremental-basedir /data/backup/2017-08-24_22-57-43</p>

<p>[[email protected] backup]# du -sh *
92M	2017-08-24_22-57-43
16M	2017-08-24_23-10-21</p>

<hr />
<p>ç¬¬ä¸€æ¬¡å¢é‡å¤‡ä»½çš„æ•°æ®åªæœ‰16Mï¼›
3.3 æ¨¡æ‹Ÿæ‰§è¡Œç¬¬äºŒæ¬¡å¢é‡å¤‡ä»½</p>

<p>[[email protected] backup]# mysql -uroot -pzhangduanya -e â€œcreate database lalalaâ€</p>

<p>[[email protected]03 backup]# mysql -uroot -pzhangduanya lalala &lt; /tmp/mysqlbak.sql</p>

<p>[[email protected]03 backup]# ls /data/mysql/
auto.cnf  db123    ib_logfile0  lalala  mysql2              test    zhdy02  zhdy-03.err
db1       ibdata1  ib_logfile1  mysql   performance_schema  zhdy01  zhdy03  zhdy-03.pid</p>

<p>æ‰¾åˆ°æˆ‘ä»¬åˆ›å»ºçš„ä¸¤ä¸ªdb123ï¼Œå’Œlalala</p>

<p>[[email protected]03 backup]# innobackupex â€“user=bakuser â€“password=â€™zhangduanyaâ€™ â€“incremental /data/backup â€“incremental-basedir /data/backup/2017-08-24_23-10-21</p>

<p>[[email protected]03 backup]# du -sh *
92M	2017-08-24_22-57-43
16M	2017-08-24_23-10-21
17M	2017-08-24_23-41-33</p>

<hr />
<p>è¿™é‡Œæœ‰ä¸ªæ³¨æ„ç‚¹ï¼Œä¹Ÿæ˜¯å›°æ‰°å¾ˆå¤šäººçš„ä¸€ä¸ªå…³é”®æ“ä½œï¼Œæˆ‘ä»¬å†æ¬¡åšå¢é‡å¤‡ä»½çš„æ—¶å€™è¦åŸºäºåˆšåˆšå·²ç»åšäº†çš„åŸºç¡€ä¸Šé¢å†æ¬¡å¢é‡ï¼Œä¹Ÿå°±æ˜¯2017-08-24_23-10-21ã€‚ä¹Ÿå³æ˜¯è¯´è¿™æ ·è¿™æ¬¡çš„å¢é‡é‡Œé¢æ‰ä¼šæœ‰åˆšåˆšå’±ä»¬æ·»åŠ çš„db123åº“çš„ä¿¡æ¯ã€‚
å››ã€å¢é‡å¤‡ä»½çš„æ¢å¤
4.1 ä¸ºäº†è¿˜åŸçœŸå®æ€§ï¼Œæˆ‘æ¨¡æ‹Ÿåˆ é™¤æ•°æ®åº“ï¼Œå¹¶ä¸”åœæ‰mysqlï¼Œåˆ©ç”¨å’±ä»¬å·²ç»å¤‡ä»½çš„æ•°æ®å»æ¢å¤å®ƒã€‚</p>

<p>[[email protected] backup]# /etc/init.d/mysqld stop
Shutting down MySQL.. SUCCESS!</p>

<p>[[email protected]03 data]# ls
backup  mysql  wwwroot</p>

<p>[[email protected]03 data]# mv /data/mysql/ /data/mysqlbak</p>

<p>[[email protected]03 data]# ls /data/
backup  mysqlbak  wwwroot</p>

<p>[[email protected]03 data]# mkdir /data/mysql</p>

<p>[[email protected]03 data]# ls 
backup  mysql  mysqlbak  wwwroot
ä¸ºäº†ä¸å®¹æ˜“æ··æ·†ï¼Œæˆ‘å…ˆæŠŠbackupç›®å½•ä¸­çš„è¿™äº›å¤‡ä»½å±•ç¤ºå‡ºæ¥ï¼š</p>

<p>[[email protected]03 backup]# ls
2017-08-24_22-57-43  2017-08-24_23-10-21  2017-08-24_23-41-33
4.2 å…ˆåˆå§‹åŒ–å…¨é‡å¤‡ä»½ï¼š</p>

<p>[[email protected]03 data]# innobackupex â€“apply-log â€“redo-only /data/backup/2017-08-24_22-57-43</p>

<hr />
<p>/data/backup/2017-08-24_22-57-43ï¼šæ­¤ä¸ºå’±ä»¬ç¬¬ä¸€æ¬¡å…¨é‡å¤‡ä»½çš„æ•°æ®ã€‚
4.3 åˆå§‹åŒ–æ•´åˆç¬¬ä¸€æ¬¡çš„å¢é‡ï¼š</p>

<p>[[email protected]03 backup]# innobackupex â€“apply-log â€“redo-only /data/backup/2017-08-24_22-57-43 â€“incremental-dir=/data/backup/2017-08-24_23-10-21
4.4 åˆå§‹åŒ–æ•´åˆç¬¬äºŒæ¬¡çš„å¢é‡ï¼š</p>

<p>[[email protected]03 backup]# innobackupex â€“apply-log â€“redo-only /data/backup/2017-08-24_22-57-43 â€“incremental-dir=/data/backup/2017-08-24_23-41-33
4.5 å†æ¬¡æŠŠæ•´åˆå¥½çš„å¢é‡å†æ¬¡åˆå§‹åŒ–ä¸€ä¸‹ï¼š</p>

<p>[[email protected]03 backup]# innobackupex â€“apply-log  /data/backup/2017-08-24_22-57-43
4.6 æœ€åä¸€æ­¥æ¢å¤ï¼š</p>

<p>ä½†æ˜¯åœ¨æœ€åä¸€æ­¥å‡ºé”™äº†ï¼š</p>

<p>[[email protected]03 backup]# innobackupex â€“copy-back  /data/backup/2017-08-24_22-57-43/
170825 00:12:44 innobackupex: Starting the copy-back operation</p>

<p>IMPORTANT: Please check that the copy-back run completes successfully.
           At the end of a successful copy-back run innobackupex
           prints â€œcompleted OK!â€.</p>

<p>innobackupex version 2.3.6 based on MySQL server 5.6.24 Linux (x86_64) (revision id: )
Error: datadir must be specified.
å…¶åŸå› æ˜¯ï¼Œæˆ‘æ²¡æœ‰å®šä¹‰/etc/my.cnfä¸­çš„datadir</p>

<p>[mysqld]</p>

<p>datadir = /data/mysql
è¿™æ ·å°±å¯ä»¥äº†ï¼</p>

<p>4.7 ç„¶åå¼€å§‹æ¢å¤ï¼</p>

<p>[[email protected]03 ~]# innobackupex â€“copy-back  /data/backup/2017-08-24_22-57-43/
å†æ¬¡æ£€æŸ¥æ•°æ®ï¼š</p>

<p>[root@zhdy-03 ~]# ls /data/mysql
db1  db123  ibdata1  ib_logfile0  ib_logfile1  lalala  mysql  mysql2  performance_schema  test  xtrabackup_info  zhdy01  zhdy02  zhdy03
åˆšåˆšåˆ›å»ºçš„db123å’Œlalalaä¹Ÿå·²ç»å…¨éƒ¨æ¢å¤ï¼</p>

<p>4.8 å¯åŠ¨mysqlæŠ¥é”™ï¼š</p>

<p>[[email protected] ~]# /etc/init.d/mysqld start
Starting MySQL.Logging to â€˜/data/mysql/zhdy-03.errâ€™.
. ERROR! The server quit without updating PID file (/data/mysql/zhdy-03.pid).
è¿˜è®°å¾—åˆšåˆšå’±ä»¬æ¨¡æ‹Ÿåˆ é™¤åº“ï¼Œè‡ªå·±åˆ›å»ºçš„/data/mysqlmå—ï¼Ÿ</p>

<p>[[email protected]03 ~]# ls -ld /data/mysql
drwxr-xr-x. 2 root root 6 Aug 24 23:50 /data/mysql
[[email protected]03 ~]# chown -R mysql.mysql /data/mysql</p>

<hr />
<p>æ‰€å±è€…å’Œæ‰€å±ç»„éƒ½å±äºrootï¼Œä¿®æ”¹ä¸ºmysqlå³å¯ã€‚
å†æ¬¡å¯åŠ¨ï¼š</p>

<p>[[email protected] ~]# /etc/init.d/mysqld start
Starting MySQL. SUCCESS!</p>

<p>Xtrabackupæ˜¯ä¸€ä¸ªå¯¹InnoDBåšæ•°æ®å¤‡ä»½çš„å·¥å…·ï¼Œæ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½ï¼ˆå¤‡ä»½æ—¶ä¸å½±å“æ•°æ®è¯»å†™ï¼‰ï¼Œæ˜¯å•†ä¸šå¤‡ä»½å·¥å…·InnoDB Hotbackupçš„ä¸€ä¸ªå¾ˆå¥½çš„æ›¿ä»£å“ã€‚å®ƒèƒ½å¯¹InnoDBå’ŒXtraDBå­˜å‚¨å¼•æ“çš„æ•°æ®åº“éé˜»å¡åœ°å¤‡ä»½ï¼ˆå¯¹äºMyISAMçš„å¤‡ä»½åŒæ ·éœ€è¦åŠ è¡¨é”ï¼‰ã€‚XtraBackupæ”¯æŒæ‰€æœ‰çš„Percona Serverã€MySQLã€MariaDBå’ŒDrizzleã€‚å‡ å¹´å‰ä½¿ç”¨è¿‡ï¼Œä½†ç°åœ¨å¿˜è®°çš„å·®ä¸å¤šäº†ï¼Œæ‰€ä»¥å°±é‡æ–°æ‹¾èµ·çœ‹çœ‹ã€‚</p>

<p>xtrabackupæœ‰ä¸¤ä¸ªä¸»è¦çš„å·¥å…·ï¼šxtrabackupã€innobackupex</p>

<p>(1).xtrabackupåªèƒ½å¤‡ä»½InnoDBå’ŒXtraDB ä¸¤ç§æ•°æ®è¡¨</p>

<p>(2).innobackupexåˆ™å°è£…äº†xtrabackup,åŒæ—¶å¯ä»¥å¤‡ä»½MyISAMæ•°æ®è¡¨
Innobackupexå®Œæ•´å¤‡ä»½åç”Ÿæˆäº†å‡ ä¸ªé‡è¦çš„æ–‡ä»¶ï¼š
xtrabackup_binlog_infoï¼šè®°å½•å½“å‰æœ€æ–°çš„LOG Position</p>

<p>xtrabackup_binlog_pos_innodb:innodb log postion</p>

<p>xtrabackup_checkpoints: å­˜æ”¾å¤‡ä»½çš„èµ·å§‹ä½ç½®beginlsnå’Œç»“æŸä½ç½®endlsn,å¢é‡å¤‡ä»½éœ€è¦è¿™ä¸ªlsn[å¢é‡å¤‡ä»½å¯ä»¥åœ¨è¿™é‡Œé¢çœ‹fromå’Œtoä¸¤ä¸ªå€¼çš„å˜åŒ–]
Xtrabackupç‰¹ç‚¹ï¼š
å¤åˆ¶ä»£ç 
(1)å¤‡ä»½è¿‡ç¨‹å¿«é€Ÿã€å¯é </p>

<p>(2)å¤‡ä»½è¿‡ç¨‹ä¸ä¼šæ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡</p>

<p>(3)èƒ½å¤ŸåŸºäºå‹ç¼©ç­‰åŠŸèƒ½èŠ‚çº¦ç£ç›˜ç©ºé—´å’Œæµé‡</p>

<p>(4)è‡ªåŠ¨å®ç°å¤‡ä»½æ£€éªŒ</p>

<p>(5)è¿˜åŸé€Ÿåº¦å¿«</p>
:ET