I"ã	<p>æŸäº›åœºæ™¯æˆ‘ä»¬éœ€è¦è·å–å®¢æˆ·ç«¯çš„ipï¼Œæ¯”å¦‚åŸ‹ç‚¹ã€åä½œå¼Šã€å®¡è®¡ç­‰ç­‰</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip := net.ParseIP(ctx.ClientIP())
ip = ip.To4()
ipInt32 := binary.BigEndian.Uint32(ip)
</code></pre></div></div>
<p>ä¸Šé¢è¿™æ®µä»£ç ä¹çœ‹æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å®é™…åº”ç”¨ä¸­å¯èƒ½panic
<!-- more -->
æˆ‘ä»¬æ¥çœ‹ä¸‹echoä¸­ç›¸å…³å‡½æ•°çš„å®ç°</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func (c *Context) ClientIP() string {
	if c.engine.ForwardedByClientIP {
		clientIP := c.requestHeader("X-Forwarded-For")
		clientIP = strings.TrimSpace(strings.Split(clientIP, ",")[0])
		if clientIP == "" {
			clientIP = strings.TrimSpace(c.requestHeader("X-Real-Ip"))
		}
		if clientIP != "" {
			return clientIP
		}
	}
</code></pre></div></div>
<p>è¿™é‡Œç›´æ¥é€šè¿‡é€—å·åˆ†éš”X-Forwarded-Forï¼Œå–ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¼—æ‰€å‘¨çŸ¥X-Forwarded-Foræ˜¯å¯ä»¥ç¯¡æ”¹çš„ï¼Œå¦‚æœç”¨æˆ·ä¸éµå®ˆä»£ç†åè®®ï¼ŒæŠŠç¬¬ä¸€ä¸ªipåœ°å€å†™æˆéæ³•çš„ipåœ°å€ï¼Œæ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°è¿”å›çš„å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹è§£æipçš„å‡½æ•°</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ParseIP parses s as an IP address, returning the result.
// The string s can be in IPv4 dotted decimal ("192.0.2.1"), IPv6
// ("2001:db8::68"), or IPv4-mapped IPv6 ("::ffff:192.0.2.1") form.
// If s is not a valid textual representation of an IP address,
// ParseIP returns nil.
func ParseIP(s string) IP {
	for i := 0; i &lt; len(s); i++ {
		switch s[i] {
		case '.':
			return parseIPv4(s)
		case ':':
			return parseIPv6(s)
		}
	}
	return nil
}
</code></pre></div></div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹äºä¸åˆæ³•çš„ipåœ°å€ï¼Œè¿”å›çš„ç›´æ¥æ˜¯ä¸ªnil</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// To4 converts the IPv4 address ip to a 4-byte representation.
// If ip is not an IPv4 address, To4 returns nil.
func (ip IP) To4() IP {
	if len(ip) == IPv4len {
		return ip
	}
	if len(ip) == IPv6len &amp;&amp;
		isZeros(ip[0:10]) &amp;&amp;
		ip[10] == 0xff &amp;&amp;
		ip[11] == 0xff {
		return ip[12:16]
	}
	return nil
}
</code></pre></div></div>
<p>è½¬æ¢å‡½æ•°ä¹Ÿä¸€æ ·ï¼Œå¦‚æœä¸æ˜¯åˆæ³•çš„ipv4 æˆ–è€…ipv6åœ°å€ï¼Œé‚£ä¹ˆè¿”å›çš„ä»ç„¶æ˜¯ä¸ªnil</p>

<p>å¦‚ä½•ä¿®å¤å‘¢
1ï¼Œä»£ç åŠ nilåˆ¤æ–­
2ï¼Œæ¥å…¥æˆå¯¹X-Forwarded-For  æ¸…æ´—</p>
:ET