I"³<p>https://github.com/antlr/antlr4
https://www.cntofu.com/book/115/index.html</p>

<p>å®‰è£…ANTLR
ANTLRæ˜¯ç”±Javaå†™æˆçš„ï¼Œæ‰€ä»¥åœ¨å®‰è£…ANTLRå‰å¿…é¡»ä¿è¯å·²ç»å®‰è£…æœ‰Java 1.6æˆ–ä»¥ä¸Šç‰ˆæœ¬ã€‚ä½ å¯ä»¥åˆ° http://www.antlr.org/download.html ä¸‹è½½ANTLRçš„æœ€æ–°ç‰ˆæœ¬ï¼Œæˆ–è€…ä¹Ÿå¯ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ä¸‹è½½ï¼š</p>

<p>curl -O http://www.antlr.org/download/antlr-4.5.1-complete.jar
antlr-4.5.1-complete.jaråŒ…å«è¿è¡ŒANTLRå·¥å…·çš„æ‰€æœ‰å¿…è¦ä¾èµ–ï¼Œä»¥åŠç¼–è¯‘å’Œæ‰§è¡Œç”±ANTLRç”Ÿæˆçš„è¯†åˆ«å™¨æ‰€éœ€çš„è¿è¡Œåº“ã€‚ANTLRå·¥å…·å°†ç”±è¯­æ³•æ–‡ä»¶æè¿°çš„è¯­æ³•è½¬æ¢æˆè¯†åˆ«ç¨‹åºï¼Œè¯†åˆ«ç¨‹åºåˆ©ç”¨ANTLRè¿è¡Œåº“ä¸­çš„æŸäº›æ”¯æŒç±»è¯†åˆ«è¾“å…¥çš„è¯­å¥ã€‚è¯¥jaråŒ…è¿˜åŒ…å«ä¸¤ä¸ªæ”¯æŒåº“ï¼šTreeLayoutï¼ˆä¸€ä¸ªå¤æ‚çš„æ ‘å¸ƒå±€åº“ï¼‰å’ŒStringTemplateï¼ˆä¸€ä¸ªç”¨äºç”Ÿæˆä»£ç å’Œå…¶å®ƒç»“æ„åŒ–æ–‡æœ¬çš„æ¨¡æ¿å¼•æ“ï¼‰ã€‚</p>

<p>ç°åœ¨æ¥æµ‹è¯•ä¸‹ANTLRå·¥å…·æ˜¯å¦å·¥ä½œæ­£å¸¸ï¼š</p>

<p>java -jar antlr-4.5.1-complete.jar  # å¯åŠ¨org.antlr.v4.Tool
å¦‚æœæ­£å¸¸çš„è¯ä¼šçœ‹åˆ°ä»¥ä¸‹å¸®åŠ©ä¿¡æ¯ï¼š</p>

<p>ANTLR Parser Generator  Version 4.5.1
 -o <em>__              specify output directory where all output is generated
 -lib __</em>            specify location of grammars, tokens files
 â€¦
æ¯æ¬¡è¿è¡ŒANTLRå·¥å…·éƒ½è¦è¾“å…¥è¿™ä¹ˆé•¿çš„å‘½ä»¤æ˜¯å¦æœ‰äº›ç—›è‹¦ï¼Ÿå†™ä¸ªè„šæœ¬æ¥è§£æ”¾æˆ‘ä»¬çš„æ‰‹æŒ‡å§ï¼</p>

<p>#!/bin/sh
java -cp .:./antlr-4.5.1-complete.jar:$CLASSPATH org.antlr.v4.Tool $*
æŠŠå®ƒä¿å­˜ä¸ºantlr.shï¼Œä»¥åå°±å¯ä»¥ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æ¥è¿è¡ŒANTLRå·¥å…·äº†ï¼š</p>

<p>antlr</p>

<p>mac ä¸‹å®‰è£…
1.å®‰è£…</p>

<p>brew install antlr</p>

<p>2.è®¾ç½®ç¯å¢ƒå˜é‡</p>

<p>åœ¨.bash_profileä¸­è®¾ç½®</p>

<p>export CLASSPATH=â€.:/usr/local/Cellar/antlr/4.7.2/antlr-4.7.2-complete.jar:$CLASSPATHâ€</p>

<p>ä¿®æ”¹ä¹‹åæ–‡ä»¶ç”Ÿæ•ˆsource .bash_profile</p>

<p>åœ¨IDEAä¸­å®‰è£…ä½¿ç”¨Antlr
åœ¨Settings-Pluginsä¸­å®‰è£…ANTLR v4 grammar plugin
æ–°å»ºä¸€ä¸ªMavené¡¹ç›®ï¼Œåœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ ANTLR4æ’ä»¶å’Œè¿è¡Œåº“çš„ä¾èµ–ã€‚æ³¨æ„ä¸€å®šè¦ç”¨æœ€æ–°ç‰ˆçš„ï¼Œä¾èµ–ï¼Œä¸çŸ¥é“æœ€æ–°ç‰ˆæœ¬å·çš„å¯ä»¥è‡ªå·±googleä¸€ä¸‹maven antlr4ã€‚</p>

<p>antlræ˜¯æŒ‡å¯ä»¥æ ¹æ®è¾“å…¥è‡ªåŠ¨ç”Ÿæˆè¯­æ³•æ ‘å¹¶å¯è§†åŒ–çš„æ˜¾ç¤ºå‡ºæ¥çš„å¼€æºè¯­æ³•åˆ†æå™¨ã€‚ANTLRâ€”Another Tool for Language Recognitionï¼Œå…¶å‰èº«æ˜¯PCCTSï¼Œå®ƒä¸ºåŒ…æ‹¬Javaï¼ŒC++ï¼ŒC#åœ¨å†…çš„è¯­è¨€æä¾›äº†ä¸€ä¸ªé€šè¿‡è¯­æ³•æè¿°æ¥è‡ªåŠ¨æ„é€ è‡ªå®šä¹‰è¯­è¨€çš„è¯†åˆ«å™¨ï¼ˆrecognizerï¼‰ï¼Œç¼–è¯‘å™¨ï¼ˆparserï¼‰å’Œè§£é‡Šå™¨ï¼ˆtranslatorï¼‰çš„æ¡†æ¶ã€‚</p>

<p>ANTLRâ€”Another Tool for Language Recognitionï¼Œå…¶å‰èº«æ˜¯PCCTSï¼Œå®ƒä¸ºåŒ…æ‹¬Javaï¼ŒC++ï¼ŒC#åœ¨å†…çš„è¯­è¨€æä¾›äº†ä¸€ä¸ªé€šè¿‡è¯­æ³•æè¿°æ¥è‡ªåŠ¨æ„é€ è‡ªå®šä¹‰è¯­è¨€çš„è¯†åˆ«å™¨ï¼ˆrecognizerï¼‰ï¼Œç¼–è¯‘å™¨ï¼ˆparserï¼‰å’Œè§£é‡Šå™¨ï¼ˆtranslatorï¼‰çš„æ¡†æ¶ã€‚ANTLRå¯ä»¥é€šè¿‡æ–­è¨€ï¼ˆPredicateï¼‰è§£å†³è¯†åˆ«å†²çªï¼›æ”¯æŒåŠ¨ä½œï¼ˆActionï¼‰å’Œè¿”å›å€¼ï¼ˆReturn Valueï¼‰æ¥ï¼›æ›´æ£’çš„æ˜¯ï¼Œå®ƒå¯ä»¥æ ¹æ®è¾“å…¥è‡ªåŠ¨ç”Ÿæˆè¯­æ³•æ ‘å¹¶å¯è§†åŒ–çš„æ˜¾ç¤ºå‡ºæ¥ï¼ˆè¿™ä¸€ç‚¹æˆ‘å°†åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­æ¼”ç¤ºï¼‰ã€‚ç”±æ­¤ï¼Œè®¡ç®—æœºè¯­è¨€çš„ç¿»è¯‘å˜æˆäº†ä¸€é¡¹æ™®é€šçš„ä»»åŠ¡â€”åœ¨è¿™ä¹‹å‰YACC/LEXæ˜¾å¾—è¿‡äºå­¦é™¢æ´¾ï¼Œè€Œä»¥LLï¼ˆkï¼‰ä¸ºåŸºç¡€çš„ANTLRè™½ç„¶åœ¨æ•ˆç‡ä¸Šè¿˜ç•¥æœ‰ä¸è¶³ï¼Œä½†æ˜¯ç»è¿‡è¿‘äº›å¹´æ¥çš„å‡çº§ä¿®æ”¹ï¼Œä½¿å¾—ANTLRè¶³ä»¥åº”ä»˜ç°å­˜çš„ç»å¤§å¤šæ•°åº”ç”¨ã€‚æ„Ÿè°¢Terence Parråšå£«å’Œä»–çš„åŒäº‹ä»¬åå‡ å¹´æ¥çš„å‡ºè‰²å·¥ä½œï¼Œä»–ä»¬ä¸ºç¼–è¯‘ç†è®ºçš„åŸºç¡€å’Œè¯­è¨€å·¥å…·çš„æ„é€ åšäº†å¤§é‡åŸºç¡€æ€§å·¥ä½œï¼Œä¹Ÿç›´æ¥å¯¼è‡´äº†ANTLRçš„äº§ç”Ÿã€‚
1.1 è¯æ³•åˆ†æå™¨ï¼ˆLexerï¼‰
è¯æ³•åˆ†æå™¨åˆç§°ä¸ºScannerï¼ŒLexical analyserå’ŒTokenizerã€‚ç¨‹åºè®¾è®¡è¯­è¨€é€šå¸¸ç”±å…³é”®å­—å’Œä¸¥æ ¼å®šä¹‰çš„è¯­æ³•ç»“æ„ç»„æˆã€‚ç¼–è¯‘çš„æœ€ç»ˆç›®çš„æ˜¯å°†ç¨‹åºè®¾è®¡è¯­è¨€çš„é«˜å±‚æŒ‡ä»¤ç¿»è¯‘æˆç‰©ç†æœºå™¨æˆ–è™šæ‹Ÿæœºå¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ã€‚è¯æ³•åˆ†æå™¨çš„å·¥ä½œæ˜¯åˆ†æé‡åŒ–é‚£äº›æœ¬æ¥æ¯«æ— æ„ä¹‰çš„å­—ç¬¦æµï¼Œå°†ä»–ä»¬ç¿»è¯‘æˆç¦»æ•£çš„å­—ç¬¦ç»„ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„Tokenï¼‰ï¼ŒåŒ…æ‹¬å…³é”®å­—ï¼Œæ ‡è¯†ç¬¦ï¼Œç¬¦å·ï¼ˆsymbolsï¼‰å’Œæ“ä½œç¬¦ä¾›è¯­æ³•åˆ†æå™¨ä½¿ç”¨ã€‚
1.2 è¯­æ³•åˆ†æå™¨ï¼ˆParserï¼‰
ç¼–è¯‘å™¨åˆç§°ä¸ºSyntactical analyserã€‚åœ¨åˆ†æå­—ç¬¦æµçš„æ—¶å€™ï¼ŒLexerä¸å…³å¿ƒæ‰€ç”Ÿæˆçš„å•ä¸ªTokençš„è¯­æ³•æ„ä¹‰åŠå…¶ä¸ä¸Šä¸‹æ–‡ä¹‹é—´çš„å…³ç³»ï¼Œè€Œè¿™å°±æ˜¯Parserçš„å·¥ä½œã€‚è¯­æ³•åˆ†æå™¨å°†æ”¶åˆ°çš„Tokensç»„ç»‡èµ·æ¥ï¼Œå¹¶è½¬æ¢æˆä¸ºç›®æ ‡è¯­è¨€è¯­æ³•å®šä¹‰æ‰€å…è®¸çš„åºåˆ—ã€‚
æ— è®ºæ˜¯Lexerè¿˜æ˜¯Parseréƒ½æ˜¯ä¸€ç§è¯†åˆ«å™¨ï¼ŒLexeræ˜¯å­—ç¬¦åºåˆ—è¯†åˆ«å™¨è€ŒParseræ˜¯Tokenåºåˆ—è¯†åˆ«å™¨ã€‚ä»–ä»¬åœ¨æœ¬è´¨ä¸Šæ˜¯ç±»ä¼¼çš„ä¸œè¥¿ï¼Œè€Œåªæ˜¯åœ¨åˆ†å·¥ä¸Šæœ‰æ‰€ä¸åŒè€Œå·²ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
å­—ç¬¦è¾“å…¥æµã€tokenså’ŒASTä¹‹é—´çš„å…³ç³»
å­—ç¬¦è¾“å…¥æµã€tokenså’ŒASTä¹‹é—´çš„å…³ç³»
1.3 æ ‘åˆ†æå™¨ (tree parser)
æ ‘åˆ†æå™¨å¯ä»¥ç”¨äºå¯¹è¯­æ³•åˆ†æç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘è¿›è¡Œéå†ï¼Œå¹¶èƒ½æ‰§è¡Œä¸€äº›ç›¸å…³çš„æ“ä½œã€‚
1.4 ANTLR
ANTLRå°†ä¸Šè¿°ç»“åˆèµ·æ¥ï¼Œå®ƒå…è®¸æˆ‘ä»¬å®šä¹‰è¯†åˆ«å­—ç¬¦æµçš„è¯æ³•è§„åˆ™å’Œç”¨äºè§£é‡ŠTokenæµçš„è¯­æ³•åˆ†æè§„åˆ™ã€‚ç„¶åï¼ŒANTLRå°†æ ¹æ®ç”¨æˆ·æä¾›çš„è¯­æ³•æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„è¯æ³•/è¯­æ³•åˆ†æå™¨ã€‚ç”¨æˆ·å¯ä»¥åˆ©ç”¨ä»–ä»¬å°†è¾“å…¥çš„æ–‡æœ¬è¿›è¡Œç¼–è¯‘ï¼Œå¹¶è½¬æ¢æˆå…¶ä»–å½¢å¼ï¼ˆå¦‚ASTâ€”Abstract Syntax Treeï¼ŒæŠ½è±¡çš„è¯­æ³•æ ‘ï¼‰ã€‚
<!-- more --></p>

<p>ç¯å¢ƒå‡†å¤‡
ç¯å¢ƒï¼šjava8+maven+idea
æ’ä»¶ï¼šå®‰è£…idea-antlr4çš„æ’ä»¶ï¼ˆfileâ€“&gt;settingâ€“&gt;pluginsâ€“&gt;install plugin from disk</p>

<p>antlrå‰ç«¯
ä¸€äº›æ¦‚å¿µ
å‰ç«¯ï¼šå®šä¹‰è¯­æ³•è§„åˆ™ï¼Œantlré€šè¿‡g4æ–‡ä»¶æ¥å®šä¹‰
lexerï¼šè¯æ³•è§£è§„åˆ™ï¼Œå°±æ˜¯å°†ä¸€ä¸ªå¥å­å¤šä¸ªå­—ç¬¦è¿›è¡Œç»„è£…åˆ†æˆå¤šä¸ªå•è¯çš„è§„åˆ™
parserï¼šè¯­æ³•è§£æï¼Œå¯¹åˆ†è¯åçš„æ•´ä¸ªå¥å­è¿›è¡Œè§£æï¼Œå¯ä»¥å¯¹æ¯ä¸ªåˆ†è¯å•å…ƒåšå‡ºè‡ªå®šä¹‰çš„å¤„ç†ï¼Œä»è€Œæ¥å®ç°è‡ªå·±çš„è¯­æ³•è§£æåŠŸèƒ½ã€‚
g4æ–‡ä»¶
g4æ–‡ä»¶æ˜¯antlrç”Ÿæˆè¯æ³•è§£æè§„åˆ™å’Œè¯­æ³•è§£æè§„åˆ™çš„åŸºç¡€ã€‚è¯¥æ–‡ä»¶æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ï¼Œæ–‡ä»¶ååç¼€éœ€è¦æ˜¯.g4ã€‚g4æ–‡ä»¶çš„ç»“æ„å¤§è‡´ä¸ºï¼š</p>

<p>grammar
comment(åŒjava //)
options
import
tokens
@actionName
rule
æˆ‘ä»¬éœ€è¦å…³æ³¨çš„ä¸»è¦æ˜¯grammarä¸rule
grammar
grammaræ˜¯è§„åˆ™æ–‡ä»¶çš„å¤´ï¼Œéœ€è¦ä¸æ–‡ä»¶åä¿æŒä¸€è‡´ã€‚å½“antlrç”Ÿæˆè¯æ³•è¯­æ³•è§£æçš„è§„åˆ™ä»£ç æ—¶ï¼Œç±»åå°±æ˜¯æ ¹æ®grammarçš„åå­—æ¥çš„ã€‚</p>

<p>rule
ruleæ˜¯antlrç”Ÿæˆè¯æ³•è¯­æ³•è§£æçš„åŸºç¡€ã€‚åŒ…æ‹¬äº†lexerä¸parserï¼Œæ¯æ¡è§„åˆ™éƒ½æ˜¯key:valueçš„å½¢å¼ï¼Œä»¥åˆ†å·ç»“å°¾ã€‚lexeré¦–å­—æ¯å¤§å†™ï¼Œlexerå°å†™ã€‚</p>

<p>g4æ–‡ä»¶çš„ç¼–å†™ä¸è§£é‡Š
grammar Dsl;    //å®šä¹‰è§„åˆ™æ–‡ä»¶grammar
@header {        //ä¸€ç§action,å®šä¹‰ç”Ÿæˆçš„è¯æ³•è¯­æ³•è§£ææ–‡ä»¶çš„å¤´ï¼Œå½“ä½¿ç”¨javaçš„æ—¶å€™ï¼Œç”Ÿæˆçš„ç±»éœ€è¦åŒ…åï¼Œå¯ä»¥åœ¨è¿™é‡Œç»Ÿä¸€å®šä¹‰
 package antlr;
 }</p>

<p>//parsers
sta:(sql ender)<em>;  //å®šä¹‰staè§„åˆ™ï¼Œé‡Œé¢åŒ…å«äº†</em>ï¼ˆ0ä¸ªä»¥ä¸Šï¼‰ä¸ª sql enderç»„åˆè§„åˆ™
ender:â€™;â€™;  //å®šä¹‰enderè§„åˆ™ï¼Œæ˜¯ä¸€ä¸ªåˆ†å·
sql   //å®šä¹‰sqlè§„åˆ™ï¼Œsqlè§„åˆ™æœ‰ä¸¤æ¡åˆ†æ”¯ï¼šselect/load
    : SELECT ~(â€˜;â€™)* as tableName   //selectè¯­æ³•è§„åˆ™ï¼Œä»¥lexer SELECTå¼€å¤´ï¼Œ ä»¥as tableName ç»“å°¾ï¼Œå…¶ä¸­as å’ŒtableNameåˆ†åˆ«æ˜¯ä¸¤ä¸ªparser
    | LOAD format â€˜.â€™ path  as tableName //loadè¯­æ³•è§„åˆ™,å¤§è‡´å°±æ˜¯ load json.â€™pathâ€™ as table1ï¼Œloadè¯­æ³•é‡Œé¢å«æœ‰formatï¼Œpathï¼Œ asï¼ŒtableNameå››ç§è§„åˆ™
    ;    //sqlè§„åˆ™ç»“æŸç¬¦
as: AS;   //å®šä¹‰asè§„åˆ™ï¼Œå…¶å†…å®¹æŒ‡å‘ASè¿™ä¸ªlexer
tableName: identifier;  //tableName è§„åˆ™ï¼ŒæŒ‡å‘identifierè§„åˆ™
format: identifier;   //formatè§„åˆ™ï¼Œä¹ŸæŒ‡å‘identifierè§„åˆ™
path: quotedIdentifier; //path,æŒ‡å‘quotedIdentifier 
identifier: IDENTIFIER | quotedIdentifier;  //identifierï¼ŒæŒ‡å‘lexer IDENTIFIER  æˆ–è€…parser quotedIdentifier
quotedIdentifier: BACKQUOTED_IDENTIFIER;  //quotedIdentifier,æŒ‡å‘lexer BACKQUOTED_IDENTIFIER</p>

<p>//lexers antlrå°†æŸä¸ªå¥å­è¿›è¡Œåˆ†è¯çš„æ—¶å€™ï¼Œåˆ†è¯å•å…ƒå°±æ˜¯å¦‚ä¸‹çš„lexer
//keywords  å®šä¹‰ä¸€äº›å…³é”®å­—çš„lexerï¼Œå¿½ç•¥å¤§å°å†™
AS: [Aa][Ss];
LOAD: [Ll][Oo][Aa][Dd];
SELECT: [Ss][Ee][Ll][Ee][Cc][Tt];</p>

<p>//base  å®šä¹‰ä¸€äº›åŸºç¡€çš„lexer,
fragment DIGIT:[0-9];   //åŒ¹é…æ•°å­—
fragment LETTER:[a-zA-Z];  //åŒ¹é…å­—æ¯
STRING        //åŒ¹é…å¸¦å¼•å·çš„æ–‡æœ¬
    : â€˜'â€™ ( ~(â€˜'â€™|â€™\â€™) | (â€˜\â€™ .) )* â€˜'â€™
    | â€˜â€â€™ ( ~(â€˜â€â€™|â€™\â€™) | (â€˜\â€™ .) )* â€˜â€â€™
    ;
IDENTIFIER    //åŒ¹é…åªå«æœ‰æ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿çš„æ–‡æœ¬
    : (LETTER | DIGIT | â€˜_â€™)+
    ;
BACKQUOTED_IDENTIFIER   //åŒ¹é…è¢«<code class="language-plaintext highlighter-rouge">åŒ…è£¹çš„æ–‡æœ¬
    : '`' ( ~'`' | '</code>â€™ )* â€˜`â€™
    ;</p>

<p>//â€“hiden  å®šä¹‰éœ€è¦éšè—çš„æ–‡æœ¬ï¼ŒæŒ‡å‘channel(HIDDEN)å°±ä¼šéšè—ã€‚è¿™é‡Œçš„channelå¯ä»¥è‡ªå®šä¹‰ï¼Œåˆ°æ—¶åœ¨åå°è·å–ä¸åŒçš„channelçš„æ•°æ®è¿›è¡Œä¸åŒçš„å¤„ç†
SIMPLE_COMMENT: â€˜â€“â€™ ~[\r\n]* â€˜\râ€™? â€˜\nâ€™? -&gt; channel(HIDDEN);   //å¿½ç•¥è¡Œæ³¨é‡Š
BRACKETED_EMPTY_COMMENT: â€˜/<em>*/â€™ -&gt; channel(HIDDEN);  //å¿½ç•¥å¤šè¡Œæ³¨é‡Š
BRACKETED_COMMENT : â€˜/</em>â€™ ~[+] .<em>? â€˜</em>/â€™ -&gt; channel(HIDDEN) ;  //å¿½ç•¥å¤šè¡Œæ³¨é‡Š
WS: [ \r\n\t]+ -&gt; channel(HIDDEN);  //å¿½ç•¥ç©ºç™½ç¬¦</p>

<p>// åŒ¹é…å…¶ä»–çš„ä¸èƒ½ä½¿ç”¨ä¸Šé¢çš„lexerè¿›è¡Œåˆ†è¯çš„æ–‡æœ¬
UNRECOGNIZED: .;</p>

<p>æ’ä»¶é…ç½®ç”Ÿæˆä»£ç 
åˆ›å»ºä¸€ä¸ªmavené¡¹ç›®
å°†Dsl.g4æ–‡ä»¶æ”¾å…¥é¡¹ç›®ä¸­
é…ç½®antlræ’ä»¶çš„config
<img src="{{site.url}}{{site.baseurl}}/img/antlrg4.webp" />
ç”Ÿæˆä»£ç è§£é‡Š
DslLexer è¯æ³•è§£æç±»
DslParser è¯­æ³•è§£æç±»ï¼Œåœ¨ç±»ä¸­æœ‰å„ç§Context,æ¯ä¸ªparseréƒ½èµŒå¯¹åº”äº†ä¸€ä¸ªxxxContextçš„å†…éƒ¨ç±»ï¼Œåœ¨Contextä¸­è®°å½•äº†ä¸å…¶ä»–Contextçš„åŒ…å«å…³ç³»ï¼Œè¿˜æä¾›äº†è·å–parserä¸­çš„lexerçš„æ–¹æ³•ï¼Œä»¥åŠè¿›å‡ºè¿™ä¸ªruleçš„å›è°ƒå‡½æ•°
DslListener è¯­æ³•è§£æç›‘å¬å™¨ã€‚antlræœ‰listenerå’Œvisitorä¸¤ç§éå†æ–¹å¼ï¼Œå‰é¢é…ç½®çš„æ—¶å€™é€‰æ‹©çš„æ˜¯listenerï¼Œå› æ­¤åªç”Ÿæˆäº†listenerã€‚ åœ¨Listenerä¸­æä¾›äº†è¿›å…¥å’Œé€€å‡ºæ¯ä¸€ç§è§„åˆ™çš„å›è°ƒæ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°Listtenerç±»ï¼ŒæŒ‰éœ€è¦†å†™å›è°ƒæ–¹æ³•ï¼Œä»¥æ­¤æ¥å®ç°æˆ‘ä»¬çš„ä¸šåŠ¡ã€‚
antlråç«¯
ç®€å•ä½¿ç”¨
æ·»åŠ ä¾èµ–</p>
<dependency>
     <groupId>org.antlr</groupId>
     <artifactId>antlr4-runtime</artifactId>
     <version>4.7.1</version>
</dependency>
<p>æ‰“å°è§£ææ ‘
    public static void main(String[] args) throws IOException {
        String sql= â€œSelect â€˜abcâ€™ as a, <code class="language-plaintext highlighter-rouge">hahah</code> as c  From a aS table;â€;
        ANTLRInputStream input = new ANTLRInputStream(sql);  //å°†è¾“å…¥è½¬æˆantlrçš„inputæµ
        DslLexer lexer = new DslLexer(input);  //è¯æ³•åˆ†æ
        CommonTokenStream tokens = new CommonTokenStream(lexer);  //è½¬æˆtokenæµ
        DslParser parser = new DslParser(tokens); // è¯­æ³•åˆ†æ
        DslParser.StaContext tree = parser.sta();  //è·å–æŸä¸€ä¸ªè§„åˆ™æ ‘ï¼Œè¿™é‡Œè·å–çš„æ˜¯æœ€å¤–å±‚çš„è§„åˆ™ï¼Œä¹Ÿå¯ä»¥é€šè¿‡sql()è·å–sqlè§„åˆ™æ ‘â€¦â€¦
        System.out.println(tree.toStringTree(parser)); //æ‰“å°è§„åˆ™æ•°
    }
loadè¯­æ³•å®ç°
åŠŸèƒ½è§£è¯´
loadçš„è¯­æ³•ï¼š load json.â€™F:\tmp\userâ€™ as temp; é€šè¿‡ç±»ä¼¼çš„è¯­æ³•ï¼Œå®ç°sparkåŠ è½½æ–‡ä»¶å¤¹çš„æ•°æ®ï¼Œç„¶åå°†æ•°æ®æ³¨å†Œæˆä¸€å¼ è¡¨ã€‚è¿™é‡Œçš„jsonå¯ä»¥æ›¿æ¢ä¸ºsparkæ”¯æŒçš„æ–‡ä»¶æ ¼å¼ã€‚</p>

<p>å®ç°æ€è·¯
å¦‚load json.â€™F:\tmp\userâ€™ as tempè¿™æ ·ä¸€ä¸ªsql,å¯¹åº”äº†æˆ‘ä»¬è‡ªå®šä¹‰è§„åˆ™çš„sqlè§„åˆ™é‡Œé¢çš„loadåˆ†æ”¯ã€‚ loadâ€“&gt;LOADï¼Œjsonâ€“&gt;formatï¼Œâ€™F:\tmp\userâ€™ â€“&gt;pathï¼Œ asâ€“&gt;asï¼Œtempâ€“&gt; tableNameã€‚
æˆ‘ä»¬å¯ä»¥é€šè¿‡è¦†å†™Listenerçš„enterSql()æ–¹æ³•ï¼Œæ¥è·å–åˆ°sqlè§„åˆ™é‡Œé¢ï¼Œä¸ä¹‹ç›¸å…³è”çš„å…¶ä»–å…ƒç´ ï¼Œè·å–åˆ°å„ä¸ªå…ƒç´ çš„å†…å®¹ï¼Œé€šè¿‡sparkæ¥æ ¹æ®ä¸åŒçš„å†…å®¹åŠ è½½ä¸åŒçš„æ•°æ®ã€‚</p>

<p>å®ç°ä»£ç 
public class ParseListener extends DslBaseListener {
    @Override
    public void enterSql(DslParser.SqlContext ctx) {
        String keyword = ctx.children.get(0).getText();  //è·å–sqlè§„åˆ™çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¸ºselectæˆ–è€…load
        if(â€œselectâ€.equalsIgnoreCase(keyword)){
            execSelect(ctx);   //ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºseleceçš„æ—¶å€™æ‰§è¡Œselect
        }else if(â€œloadâ€.equalsIgnoreCase(keyword)){
            execLoad(ctx);  //ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºloadçš„æ—¶å€™æ‰§è¡Œload
        }</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>}
public void execLoad(DslParser.SqlContext ctx){
    List&lt;ParseTree&gt; children = ctx.children;   //è·å–è¯¥è§„åˆ™æ ‘çš„æ‰€æœ‰å­èŠ‚ç‚¹
    String format = "";
    String path = "";
    String tableName = "";
    for (ParseTree c :children) {
        if(c instanceof DslParser.FormatContext){
            format = c.getText();
        }else if(c instanceof DslParser.PathContext){
            path = c.getText().substring(1,c.getText().length()-1);
        }else if(c instanceof DslParser.TableNameContext){
            tableName = c.getText();
        }
    }
    System.out.println(format);
    System.out.println(path);
    System.out.println(tableName);
    // spark loadå®ç°ï¼Œçœç•¥
}

public void execSelect(DslParser.SqlContext ctx){

}

public static void main(String[] args) throws IOException {
    String len = "load json.`F:\\tmp\\user` as temp;";
    ANTLRInputStream input = new ANTLRInputStream(len);
    DslLexer lexer = new DslLexer(input);
    CommonTokenStream tokens = new CommonTokenStream(lexer);
    DslParser parser = new DslParser(tokens);
    DslParser.SqlContext tree = parser.sql();
    ParseListener listener = new ParseListener();
    ParseTreeWalker.DEFAULT.walk(listener,tree);  //è§„åˆ™æ ‘éå†
} } https://www.jianshu.com/p/21f2afca65e8 ANTLRå…¶å®å¾ˆç®€å• ANTLRæ˜¯é€šè¿‡é€’å½’ä¸‹é™çš„æ–¹å¼æ¥è§£æä¸€ä¸ªè¯­æ³•çš„ã€‚ æ‰€è°“çš„é€’å½’ä¸‹é™ï¼Œå…¶å®å¾ˆç®€å•ï¼Œä¸è¿‡å°±æ˜¯ä¸€äº›æ¨¡å¼åŒ¹é…è€Œå·±ã€‚
</code></pre></div></div>

<p>ç®€å•çš„æ¨¡å¼åŒ¹é…
æˆ‘ä»¬çœ‹ä¸‹å®˜æ–¹çš„ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¿™æ˜¯ä¸€ä¸ªèµ‹å€¼è¡¨è¾¾å¼çš„ä¾‹å­ã€‚
è¯­æ³•è¿™æ ·å†™ï¼š</p>

<p>assign : ID â€˜=â€™ expr â€˜;â€™ ;
è§£æå™¨çš„ä»£ç ç±»ä¼¼äºä¸‹é¢è¿™æ ·ï¼š</p>

<p>void assign() {
  match(ID);
  match(â€˜=â€™);
  expr();
  match(â€˜;â€™);
è§£æåªåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€ç§æƒ…å†µæ˜¯ç›´æ¥æ¨¡å¼åŒ¹é…ï¼Œç¬¬äºŒç§æƒ…å†µæ˜¯è°ƒç”¨å…¶å®ƒå‡½æ•°ç»§ç»­åˆ†æã€‚</p>

<p>æˆ‘ä»¬å†™ä¸ªå®Œæ•´çš„èµ‹å€¼è¯­å¥çš„è¯­æ³•å§ã€‚æˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹ï¼Œå…ˆä¸åšé€’å½’ä¸‹é™ï¼Œå°†è¡¨è¾¾å¼åŒ–ç®€æˆåªæ”¯æŒæ•°å­—ï¼š</p>

<p>grammar assign;
assign : ID â€˜=â€™ expr â€˜;â€™ ;
ID : [a-z]+ ;
expr : NUMBER ;
NUMBER : [1-9][0-9]*|[0]|([0-9]+[.][0-9]+) ;
IDæˆ‘ä»¬ç®€åŒ–æˆåªæ”¯æŒå°å†™å­—æ¯çš„ç»„åˆï¼Œæ•°å­—æˆ‘ä»¬å†™ä¸ªæ¯”è¾ƒè¯¦ç»†çš„ã€‚
ä¸Šé¢çš„ä»£ç å­˜æˆassign.g4ï¼Œç”¨antlr4 assign.g4å‘½ä»¤ï¼Œå°±å¯ä»¥ç”Ÿæˆjavaè§£æå™¨ä»£ç äº†ã€‚</p>

<p>æˆ‘ä»¬æ¥çœ‹çœ‹ç”Ÿæˆçš„parserä¸­çš„ç‰‡æ®µï¼Œè·Ÿä¸Šé¢çš„åƒä¸åƒï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public final AssignContext assign() throws RecognitionException {
    AssignContext _localctx = new AssignContext(_ctx, getState());
    enterRule(_localctx, 0, RULE_assign);
    try {
        enterOuterAlt(_localctx, 1);
        {
        setState(4);
        match(ID);
        setState(5);
        match(T__0);
        setState(6);
        expr();
        setState(7);
        match(T__1);
        }
    }
    catch (RecognitionException re) {
        _localctx.exception = re;
        _errHandler.reportError(this, re);
        _errHandler.recover(this, re);
    }
    finally {
        exitRule();
    }
    return _localctx;
} ä¸‹é¢æ˜¯è§£æexprçš„æƒ…å†µï¼š

public final ExprContext expr() throws RecognitionException {
    ExprContext _localctx = new ExprContext(_ctx, getState());
    enterRule(_localctx, 2, RULE_expr);
    try {
        enterOuterAlt(_localctx, 1);
        {
        setState(9);
        match(NUMBER);
        }
    }
    catch (RecognitionException re) {
        _localctx.exception = re;
        _errHandler.reportError(this, re);
        _errHandler.recover(this, re);
    }
    finally {
        exitRule();
    }
    return _localctx;
} å¤šç§åˆ†æ”¯çš„æƒ…å†µ å¦‚æœæœ‰å¤šç§å¯èƒ½çš„è¯ï¼Œåœ¨è¯­æ³•é‡Œç”¨"|"ç¬¦å·åˆ†åˆ«åˆ—å‡ºæ¥å°±æ˜¯äº†ã€‚ANTLRä¼šæŠŠå®ƒç¿»è¯‘æˆswitch caseä¸€æ ·çš„è¯­å¥ã€‚
</code></pre></div></div>

<p>æˆ‘ä»¬æŠŠæˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­æ‰©å±•ä¸€ä¸‹ï¼Œä¸å…‰æ”¯æŒâ€™=â€™è¿˜æ”¯æŒâ€™:=â€™èµ‹å€¼</p>

<p>grammar assign2;
assign : ID â€˜=â€™ expr â€˜;â€™ 
         | ID â€˜:=â€™ expr â€˜;â€™ ;
ID : [a-z]+ ;
expr : NUMBER ;
NUMBER : [1-9][0-9]*|[0]|([0-9]+[.][0-9]+) ;
ç”Ÿæˆçš„Parserå°±å˜æˆswitch caseäº†ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public final AssignContext assign() throws RecognitionException {
    AssignContext _localctx = new AssignContext(_ctx, getState());
    enterRule(_localctx, 0, RULE_assign);
    try {
        setState(14);
        _errHandler.sync(this);
        switch ( getInterpreter().adaptivePredict(_input,0,_ctx) ) {
        case 1:
            enterOuterAlt(_localctx, 1);
            {
            setState(4);
            match(ID);
            setState(5);
            match(T__0);
            setState(6);
            expr();
            setState(7);
            match(T__1);
            }
            break;
        case 2:
            enterOuterAlt(_localctx, 2);
            {
            setState(9);
            match(ID);
            setState(10);
            match(T__2);
            setState(11);
            expr();
            setState(12);
            match(T__1);
            }
            break;
        }
    }
    catch (RecognitionException re) {
        _localctx.exception = re;
        _errHandler.reportError(this, re);
        _errHandler.recover(this, re);
    }
    finally {
        exitRule();
    }
    return _localctx;
} è¿™æ¬¡æˆ‘ä»¬ç›´æ¥çœ‹javaè¯­æ³•çš„ä¾‹å­ï¼š
</code></pre></div></div>

<p>typeDeclaration
    :   classOrInterfaceModifier* classDeclaration
    |   classOrInterfaceModifier* enumDeclaration
    |   classOrInterfaceModifier* interfaceDeclaration
    |   classOrInterfaceModifier* annotationTypeDeclaration
    |   â€˜;â€™
    ;
ä¸Šé¢çš„è¯­æ³•åœ¨ï¼šhttps://github.com/antlr/grammars-v4/blob/master/java/Java.g4 ä¸­ï¼Œæˆ‘ä»¬æŠŠå®ƒä¸‹è½½ä¸‹æ¥ï¼Œç”¨antlr4 Java.g4è¿è¡Œä¸€ä¸‹ï¼Œå°±ç”Ÿæˆäº†Lexerå’ŒParserç±»ã€‚
ç”±äºæ˜¯çœŸçš„è¯­æ³•ï¼Œç¿»å‡ºæ¥æ¯”èµ·çº¯ç²¹çš„ä¾‹å­è‡ªç„¶æ˜¯å¤æ‚ä¸€äº›ï¼Œä¸è¿‡ä¸è€ƒè™‘ç»†èŠ‚ï¼Œæ•´ä¸ªç»“æ„ä¸Šè¿˜æ˜¯å¾ˆå¥½æ‡‚çš„ã€‚å¤§å®¶åªè¦ç†è§£è¿™å¥—switch caseçš„ç»“æ„å°±å¥½ï¼š</p>

<p>â€¦
        try {
            int _alt;
            setState(269);
            _errHandler.sync(this);
            switch ( getInterpreter().adaptivePredict(_input,10,_ctx) ) {
            case 1:
                enterOuterAlt(_localctx, 1);
                {
                setState(243);
                _errHandler.sync(this);
                _la = _input.LA(1);
                while ((((_la) &amp; ~0x3f) == 0 &amp;&amp; ((1L Â«Â _la) &amp; ((1L Â«Â ABSTRACT) | (1L Â«Â FINAL) | (1L Â«Â PRIVATE) | (1L Â«Â PROTECTED) | (1L Â«Â PUBLIC) | (1L Â«Â STATIC) | (1L Â«Â STRICTFP))) != 0) || _la==AT) {
                    {
                    {
                    setState(240);
                    classOrInterfaceModifier();
                    }
                    }
                    setState(245);
                    _errHandler.sync(this);
                    _la = _input.LA(1);
                }
                setState(246);
                classDeclaration();
                }
                break;
            case 2:
                enterOuterAlt(_localctx, 2);
                {
                setState(250);
                _errHandler.sync(this);
                _la = _input.LA(1);
                while ((((_la) &amp; ~0x3f) == 0 &amp;&amp; ((1L Â«Â _la) &amp; ((1L Â«Â ABSTRACT) | (1L Â«Â FINAL) | (1L Â«Â PRIVATE) | (1L Â«Â PROTECTED) | (1L Â«Â PUBLIC) | (1L Â«Â STATIC) | (1L Â«Â STRICTFP))) != 0) || _la==AT) {
                    {
                    {
                    setState(247);
                    classOrInterfaceModifier();
                    }
                    }
                    setState(252);
                    _errHandler.sync(this);
                    _la = _input.LA(1);
                }
                setState(253);
                enumDeclaration();
                }
                break;
            case 3:
                enterOuterAlt(_localctx, 3);
                {
                setState(257);
                _errHandler.sync(this);
                _la = _input.LA(1);
                while ((((_la) &amp; ~0x3f) == 0 &amp;&amp; ((1L Â«Â _la) &amp; ((1L Â«Â ABSTRACT) | (1L Â«Â FINAL) | (1L Â«Â PRIVATE) | (1L Â«Â PROTECTED) | (1L Â«Â PUBLIC) | (1L Â«Â STATIC) | (1L Â«Â STRICTFP))) != 0) || _la==AT) {
                    {
                    {
                    setState(254);
                    classOrInterfaceModifier();
                    }
                    }
                    setState(259);
                    _errHandler.sync(this);
                    _la = _input.LA(1);
                }
                setState(260);
                interfaceDeclaration();
                }
                break;
            case 4:
                enterOuterAlt(_localctx, 4);
                {
                setState(264);
                _errHandler.sync(this);
                _alt = getInterpreter().adaptivePredict(_input,9,_ctx);
                while ( _alt!=2 &amp;&amp; _alt!=org.antlr.v4.runtime.atn.ATN.INVALID_ALT_NUMBER ) {
                    if ( _alt==1 ) {
                        {
                        {
                        setState(261);
                        classOrInterfaceModifier();
                        }
                        } 
                    }
                    setState(266);
                    _errHandler.sync(this);
                    _alt = getInterpreter().adaptivePredict(_input,9,_ctx);
                }
                setState(267);
                annotationTypeDeclaration();
                }
                break;
            case 5:
                enterOuterAlt(_localctx, 5);
                {
                setState(268);
                match(SEMI);
                }
                break;
            }
        }
â€¦
äºŒä¹‰æ€§æ–‡æ³•
é€‰æ‹©å¤ªå¤šäº†ä¹Ÿæœªå¿…è§å¾—æ˜¯å¥½äº‹å„¿ï¼Œæœ‰ä¸€ç§å‰¯ä½œç”¨å°±æ˜¯é€‰æ‹©ä¸æ˜¯å”¯ä¸€çš„ï¼Œè¿™å«åšã€äºŒä¹‰æ€§æ–‡æ³•ã€ã€‚
æœ€ç®€å•çš„äºŒä¹‰æ€§æ–‡æ³•å°±æ˜¯æŠŠåŒä¸€æ¡è§„åˆ™å†™ä¸¤éï¼Œæ¯”å¦‚ä¸Šé¢ä¾‹å­çš„â€:=â€æˆ‘ä»¬å°±æ”¹æˆâ€=â€ï¼Œè®©â€|â€ä¹‹å‰å’Œä¹‹åä¸¤æ¡éƒ½ä¸€æ ·ã€‚</p>

<p>grammar assign2;
assign : ID â€˜=â€™ expr â€˜;â€™ 
         | ID â€˜=â€™ expr â€˜;â€™ ;
ID : [a-z]+ ;
expr : NUMBER ;
NUMBER : [1-9][0-9]*|[0]|([0-9]+[.][0-9]+) ;
ä½†æ˜¯ANTLR4æ˜¯å…¼å®¹è¿™ç§æƒ…å†µçš„ï¼Œä¸æŠ¥é”™ã€‚åœ¨å®é™…åº”ç”¨çš„æ—¶å€™ï¼Œå®ƒé€‰æ‹©ç¬¬ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„è§„åˆ™ï¼Œè¯·çœ‹ç”Ÿæˆçš„ä»£ç </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    try {
        setState(14);
        _errHandler.sync(this);
        switch ( getInterpreter().adaptivePredict(_input,0,_ctx) ) {
        case 1:
            enterOuterAlt(_localctx, 1);
            {
            setState(4);
            match(ID);
            setState(5);
            match(T__0);
            setState(6);
            expr();
            setState(7);
            match(T__1);
            }
            break;
        case 2:
            enterOuterAlt(_localctx, 2);
            {
            setState(9);
            match(ID);
            setState(10);
            match(T__0);
            setState(11);
            expr();
            setState(12);
            match(T__1);
            }
            break;
        }
    } æœ€è‘—åçš„äºŒä¹‰æ€§çš„ä¾‹å­å°±æ˜¯å…³é”®å­—ã€‚åœ¨å¸¸è§çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå…³é”®å­—éƒ½æ˜¯å’Œæ ‡è¯†ç¬¦å†²çªçš„. æ¯”å¦‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªifå…³é”®å­—ï¼š
</code></pre></div></div>

<p>IF : â€˜ifâ€™ ;
ID : [a-z]+ ;
æ˜æ˜¾ï¼ŒIFå’ŒIDä¸¤ä¸ªè§„åˆ™éƒ½å¯ä»¥è§£æâ€™ifâ€™è¿™ä¸ªä¸²ï¼Œé‚£åˆ°åº•æ˜¯æŒ‰IFç®—ï¼Œè¿˜æ˜¯æŒ‰IDç®—å‘¢ï¼Ÿåœ¨ANTLRé‡Œï¼Œè§„åˆ™å¾ˆç®€å•ï¼ŒæŒ‰ç…§å¯ä»¥åŒ¹é…çš„ç¬¬ä¸€æ¡å¤„ç†ã€‚</p>

<p>ä½†æ˜¯ï¼Œå…‰é ç¬¬ä¸€æ¡ä¼˜å…ˆï¼Œä¹Ÿè¿˜æ˜¯è§£å†³ä¸äº†æ‰€æœ‰çš„é—®é¢˜ã€‚
æˆ‘ä»¬çœ‹ä¸¤ç±»æ–°çš„é—®é¢˜</p>

<p>ç¬¬ä¸€ç±»ï¼š1 + 2 * 3ã€‚è¿™ä¸ªå¦‚ä½•å¤„ç†ï¼Œæ˜¯å…ˆç®—+è¿˜æ˜¯å…ˆç®—*?
å‰äººæƒ³å‡ºäº†ä¸‰ç§åŠæ³•æ¥è§£å†³ï¼š</p>

<p>ä»å·¦åˆ°å³ï¼šç®¡äººæ˜¯å¦‚ä½•ç†è§£ä¹˜é™¤åŠ å‡çš„ï¼Œæˆ‘å°±ä»å·¦åˆ°å³ç®—ã€‚Smalltalkå°±æ˜¯è¿™æ ·åšçš„
ä¸­ç¼€è½¬å‰ç¼€ï¼šå¸¦æ¥é—®é¢˜çš„æ˜¯ä¸­ç¼€è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬ç»™æ¢ä¸ªå½¢å¼ä¸å°±OKäº†å—ï¼Œæ¯”å¦‚æ”¹æˆè¿™æ ·(+ 1 (* 2 3))ï¼Œlispå°±æ˜¯è¿™ä¹ˆåšçš„
è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼šæœ€å¸¸ç”¨çš„ä¸€ç§ä½œæ³•ï¼Œåé¢æˆ‘ä»¬è¯¦æƒ…åˆ†æã€‚åŸºæœ¬ä¸Šå¤§éƒ¨åˆ†å¸¸è§çš„è¯­è¨€éƒ½æœ‰ä¸€ä¸ªè¿ç®—ç¬¦ä¼˜å…ˆçº§çš„è¡¨ã€‚
ç¬¬äºŒç±»ï¼Œæ˜¯ä¸€äº›è¯­è¨€çš„è®¾è®¡æ‰€å¯¼è‡´çš„ï¼Œç»™è¯æ³•åˆ†æé˜¶æ®µå¸¦æ¥å›°éš¾ã€‚
æ¯”å¦‚â€<em>â€œè¿ç®—ç¬¦ï¼Œåœ¨å¤§éƒ¨åˆ†è¯­è¨€ä¸­éƒ½åªè¡¨ç¤ºä¹˜æ³•ï¼Œä½†æ˜¯åœ¨Cè¯­è¨€ä¸­è¡¨ç¤ºæŒ‡é’ˆï¼Œå½“i</em>jæ—¶ï¼Œè¡¨ç¤ºä¹˜æ³•ï¼Œä½†æ˜¯å½“int *j;æ—¶ï¼Œå°±å˜æˆè¡¨ç¤ºæŒ‡é’ˆã€‚
æ‰€ä»¥åƒGoè¯­è¨€åœ¨è®¾è®¡æ—¶ï¼Œå°±æŠŠç±»å‹å®šä¹‰ç§»åˆ°äº†åé¢ã€‚æˆ‘ä»¬å…¥é—¨é˜¶æ®µæš‚æ—¶ä¹Ÿä¸æ‰“ç®—è§£æè¿™ä¹ˆå¤æ‚çš„ï¼Œå°†æ¥ç”¨åˆ°äº†å†è¯´ã€‚</p>

<p>ä¸‹ä¸€æ­¥åšå•¥
ç»è¿‡å‰é¢å­¦ä¹ çš„å†™grammarçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå­—ç¬¦æµCharStreamï¼Œè½¬æ¢æˆä¸€æ£µParseTreeã€‚
CharStreamæ˜¯å­—ç¬¦æµï¼Œç»è¿‡è¯æ³•åˆ†æä¼šå˜æˆTokenæµã€‚
Tokenæµå†æœ€ç»ˆç»„è£…æˆä¸€æ£µParseTreeï¼Œå¶å­èŠ‚ç‚¹æ˜¯TerminalNodeï¼Œéå¶å­èŠ‚ç‚¹æ˜¯RuleNode.</p>

<p>ParseTreeç»“æ„å›¾
ä¸ºäº†èŠ‚çœç©ºé—´ï¼ŒTokenæµä¹‹ä¸Šéƒ½æ²¡æœ‰å¤åˆ¶å­—ç¬¦æµçš„å†…å®¹ï¼Œéƒ½æ˜¯é€šè¿‡æŒ‡å‘å­—ç¬¦æµåŒºç¼“å†²åŒºæ¥è·å–å†…å®¹ã€‚ç©ºç™½å­—ç¬¦åœ¨Tokenæµä»¥ä¸Šå°±ä¸å­˜åœ¨äº†ã€‚</p>

<p>æ—¢ç„¶æœ‰äº†ParseTreeï¼Œåé¢çš„äº‹æƒ…å°±å¥½åŠäº†ã€‚æˆ‘ä»¬åªè¦éå†è¿™æ£µParseTreeï¼Œå°±å¯ä»¥è®¿é—®æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œç„¶åç»§ç»­åšä»£ç ç”Ÿæˆä¹‹ç±»çš„åç«¯çš„å·¥ä½œã€‚</p>

<p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒANTLRå°†è¿™äº›èŠ‚ç‚¹ï¼Œå°è£…æˆRuleNodeçš„å­ç±»ï¼Œå‰é¢ä»£ç ä¸­æˆ‘ä»¬çœ‹åˆ°çš„xxxContextç±»ï¼Œå°±æ˜¯è¿™äº›å­ç±»ã€‚æ¯”å¦‚AssignContextï¼ŒExprContextç­‰ã€‚</p>

<p>å…·ä½“çš„æ¥å£ï¼Œè¯·çœ‹å›¾ï¼š</p>

<p>ParserRuleContext
æˆ‘ä»¬çœ‹ä¸ªAssignContextæ˜¯å¦‚ä½•è¢«å®ç°çš„ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static class AssignContext extends ParserRuleContext {
    public TerminalNode ID() { return getToken(assign2Parser.ID, 0); }
    public ExprContext expr() {
        return getRuleContext(ExprContext.class,0);
    }
    public TerminalNode IF() { return getToken(assign2Parser.IF, 0); }
    public AssignContext(ParserRuleContext parent, int invokingState) {
        super(parent, invokingState);
    }
    @Override public int getRuleIndex() { return RULE_assign; }
    @Override
    public void enterRule(ParseTreeListener listener) {
        if ( listener instanceof assign2Listener ) ((assign2Listener)listener).enterAssign(this);
    }
    @Override
    public void exitRule(ParseTreeListener listener) {
        if ( listener instanceof assign2Listener ) ((assign2Listener)listener).exitAssign(this);
    }
}
</code></pre></div></div>

<p>ä¸¤ç§è®¿é—®ParserTreeçš„æ–¹æ³•
ANTLRæä¾›äº†ä¸¤ç§æ–¹æ³•æ¥è®¿é—®ParseTreeï¼š</p>

<p>ä¸€ç§æ˜¯é€šè¿‡Parse-Tree Listenerçš„æ–¹æ³•
å¦ä¸€ç§æ˜¯é€šè¿‡Parse-Tree Visitorçš„æ–¹æ³•
Listeneræ–¹æ³•æœ‰ç‚¹ç±»ä¼¼äºè§£æXMLçš„SAXæ–¹æ³•ã€‚
åºŸè¯ä¸å¤šè¯´äº†ï¼Œè¿™ç¯‡æ–‡ç« å·²ç»æœ‰ç‚¹é•¿äº†ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šä»£ç ï¼š</p>

<p>// Generated from assign2.g4 by ANTLR 4.6
import org.antlr.v4.runtime.tree.ParseTreeListener;</p>

<p>/**</p>
<ul>
  <li>This interface defines a complete listener for a parse tree produced by</li>
  <li>{@link assign2Parser}.
 */
public interface assign2Listener extends ParseTreeListener {
 /**
    <ul>
      <li>Enter a parse tree produced by {@link assign2Parser#assign}.</li>
      <li>@param ctx the parse tree
  */
 void enterAssign(assign2Parser.AssignContext ctx);
 /**</li>
      <li>Exit a parse tree produced by {@link assign2Parser#assign}.</li>
      <li>@param ctx the parse tree
  */
 void exitAssign(assign2Parser.AssignContext ctx);
 /**</li>
      <li>Enter a parse tree produced by {@link assign2Parser#expr}.</li>
      <li>@param ctx the parse tree
  */
 void enterExpr(assign2Parser.ExprContext ctx);
 /**</li>
      <li>Exit a parse tree produced by {@link assign2Parser#expr}.</li>
      <li>@param ctx the parse tree
  */
 void exitExpr(assign2Parser.ExprContext ctx);
}
å¼€å§‹è§£æAssignçš„æ—¶å€™ï¼Œä¼šå›è°ƒetnterAssignæ–¹æ³•ï¼Œç»“æŸæ—¶å›è°ƒexitAssignæ–¹æ³•ã€‚</li>
    </ul>
  </li>
</ul>

<p>å¦ä¸€ç§æ˜¯é‡‡ç”¨visitoræ¨¡å¼çš„æ–¹æ³•ï¼Œæˆ‘ä»¬è°ƒç”¨antlr4çš„æ—¶å€™è¦å¢åŠ -visitorå‚æ•°æ¥ç”Ÿæˆã€‚</p>

<p>Visitorä»ç„¶éå¸¸ç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä»£ç ï¼š</p>

<p>// Generated from assign2.g4 by ANTLR 4.6
import org.antlr.v4.runtime.tree.ParseTreeVisitor;</p>

<p>/**</p>
<ul>
  <li>This interface defines a complete generic visitor for a parse tree produced</li>
  <li>by {@link assign2Parser}.
 *</li>
  <li>@param <T> The return type of the visit operation. Use {@link Void} for</T></li>
  <li>operations with no return type.
 */
public interface assign2Visitor<T> extends ParseTreeVisitor<T> {
 /**
</T></T>    <ul>
      <li>Visit a parse tree produced by {@link assign2Parser#assign}.</li>
      <li>@param ctx the parse tree</li>
      <li>@return the visitor result
  */
 T visitAssign(assign2Parser.AssignContext ctx);
 /**</li>
      <li>Visit a parse tree produced by {@link assign2Parser#expr}.</li>
      <li>@param ctx the parse tree</li>
      <li>@return the visitor result
  */
 T visitExpr(assign2Parser.ExprContext ctx);
}
å¥½çš„ï¼ŒåŸºæœ¬æ¦‚å¿µå·²ç»å‡†å¤‡å¥½äº†ï¼Œä¸‹ä¸€ç¯‡æ•™ç¨‹æˆ‘ä»¬å°±æ­£å¼åˆ©ç”¨è¿™äº›ç»„ä»¶æ¥å®ç°äº†ä¸€ä¸ªè§£æå™¨ã€‚</li>
    </ul>
  </li>
</ul>

<p>ç»“æŸä¹‹å‰ï¼Œæˆ‘ä»¬æä¸ªèƒ½è¿è¡Œçš„è°ƒç”¨å‰é¢è¯­æ³•è§£æå™¨çš„ä¾‹å­ï¼Œæœ€ç»ˆç”Ÿæˆä¸€æ£µParseTree.</p>

<p>è¯­æ³•æ–‡ä»¶å†åˆ—ä¸€éï¼Œçœå¾—å¤§å®¶å‘ä¸Šç¿»äº†ï¼š</p>

<p>grammar Assign;
assign : ID â€˜=â€™ expr â€˜;â€™ 
         | ID â€˜:=â€™ expr â€˜;â€™ ;
ID : [a-z]+ ;
expr : NUMBER ;
NUMBER : [1-9][0-9]*|[0]|([0-9]+[.][0-9]+) ;
WS : [ \t\r\n]+ -&gt; skip ;
è°ƒç”¨antlr4 Assign.g4ï¼Œç„¶åå†™ä¸ªè°ƒç”¨çš„mainæ–¹æ³•å§ï¼š</p>

<p>import org.antlr.v4.runtime.<em>;
import org.antlr.v4.runtime.tree.</em>;</p>

<p>public class TestAssign {
    public static void main(String[] args) throws Exception {
        ANTLRInputStream input = new ANTLRInputStream(System.in);</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    AssignLexer lexer = new AssignLexer(input);

    CommonTokenStream tokens = new CommonTokenStream(lexer);

    AssignParser parser = new AssignParser(tokens);

    ParseTree tree = parser.assign();

    System.out.println(tree.toStringTree(parser));
} } è¯•è¯•çµä¸çµå§ï¼š
</code></pre></div></div>

<p>java TestAssign
a = 1;
è¾“å‡ºå¦‚ä¸‹ï¼š</p>

<p>(assign a = (expr 1) ;)
å†è¯•ä¸€ä¸ªç”¨:=èµ‹å€¼çš„ï¼š</p>

<p>java TestAssign
b := 0;
è¾“å‡ºå¦‚ä¸‹ï¼š</p>

<p>(assign b := (expr 0) ;)
å¾ˆå¥½ç©å§ï¼Ÿè™½ç„¶ä¾‹å­å¾ˆç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»å®Œæˆäº†ä»å†™è¯­æ³•è§„åˆ™åˆ°ä½¿ç”¨ParseTreeçš„å…¨è¿‡ç¨‹ã€‚
https://www.jianshu.com/p/1f5e72156075
ä»€ä¹ˆæ˜¯ Antlr?
ANTLRâ„¢ (ANother Tool for Language Recognition) is a powerful parser generator for reading, processing, executing, or translating structured text or binary files. Itâ€™s widely used to build languages, tools, and frameworks. From a grammar, ANTLR generates a parser that can build and walk parse trees.</p>

<p>ä¸ºä»€ä¹ˆè¦æœ‰ Antlr?
ç®€æ˜“æ€§
å¯ä»¥é€šè¿‡æ–­è¨€ï¼ˆPredicateï¼‰è§£å†³è¯†åˆ«å†²çª
ã€€æ”¯æŒåŠ¨ä½œï¼ˆActionï¼‰å’Œè¿”å›å€¼ï¼ˆReturn Valueï¼‰
ã€€å®ƒå¯ä»¥æ ¹æ®è¾“å…¥è‡ªåŠ¨ç”Ÿæˆè¯­æ³•æ ‘ï¼Œå¹¶å¯è§†åŒ–çš„å±•ç¤ºå‡ºæ¥</p>

<p>æ¨¡å—åŒ–
å¤æ‚æƒ…å†µä¸‹ï¼Œéœ€è¦åŸºäºè¯­æ³•æ ‘éå†ï¼ˆwalking the treeï¼‰ç”Ÿæˆç›®æ ‡ä»£ç 
ã€€Embeded action å°†å¤„ç†ä»£ç è·Ÿè¯­æ³•æè¿°æ··åˆèµ·æ¥ï¼Œè¯­æ³•å¤æ‚æ—¶ä½¿è¯­æ³•æ–‡ä»¶è‡ƒè‚¿
ã€€è¯­æ³•å¯èƒ½ç»å¸¸éœ€è¦ä¿®æ”¹ï¼Œè€Œè¯­æ³•çš„ä¸»è¦è¡¨è¾¾å¼å´ä¸ä¼šå˜åŠ¨ï¼Œå› æ­¤ï¼ŒAntlr å°†è¯­æ³•è¯†åˆ«ä¸è½¬æ¢ã€ç”Ÿæˆï¼ˆç›®æ ‡ä»£ç ï¼‰çš„å¤„ç†åˆ†ç¦»</p>

<p>Antlr å·¥ä½œæœºåˆ¶
è¯æ³•åˆ†æå™¨ï¼ˆLexerï¼‰
åˆ†æé‡åŒ–å­—ç¬¦æµï¼Œç¿»è¯‘æˆç¦»æ•£çš„å­—ç¬¦ç»„ï¼ˆä¹Ÿå°±æ˜¯ä¸€å † Tokenï¼‰, åŒ…æ‹¬å…³é”®å­—ï¼Œæ ‡è¯†ç¬¦ï¼Œç¬¦å·ï¼ˆsymbolsï¼‰å’Œæ“ä½œç¬¦ï¼Œä»¥ä¾›è¯­æ³•åˆ†æå™¨ä½¿ç”¨</p>

<p>è¯­æ³•åˆ†æå™¨ï¼ˆParserï¼‰
å°† Tokens ç»„ç»‡èµ·æ¥ï¼Œå¹¶è½¬æ¢æˆä¸ºç›®æ ‡è¯­è¨€è¯­æ³•ï¼ˆé»˜è®¤æ˜¯ Javaï¼‰å®šä¹‰æ‰€å…è®¸çš„åºåˆ—</p>

<p>æ ‘åˆ†æå™¨ï¼ˆTree Parserï¼‰
ç”¨äºå¯¹è¯­æ³•åˆ†æç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘è¿›è¡Œéå†ï¼Œå¹¶åœ¨å…ˆåºç»è¿‡æ¯ä¸ªæ ‘èŠ‚ç‚¹çš„æ—¶å€™ï¼Œè¿›è¡Œä¸€äº›å®šåˆ¶æ“ä½œ</p>

<p>Antlr è¿ä½œæµç¨‹
å®‰è£…</p>
<h1 id="download">Download</h1>
<p>$ cd /usr/local/lib
$ curl -O https://www.antlr.org/download/antlr-4.7.2-complete.jar</p>

<h1 id="add-antlr-472-completejar-to-your-classpath">Add antlr-4.7.2-complete.jar to your CLASSPATH</h1>
<h1 id="create-aliases-for-the-antlr-tool-and-testrig">Create aliases for the ANTLR Tool, and TestRig</h1>
<p>$ vim ~/.bashrc
  export CLASSPATH=â€.:/usr/local/lib/antlr-4.7.2-complete.jar:$CLASSPATHâ€
  alias antlr4=â€™java -Xmx500M -cp â€œ/usr/local/lib/antlr-4.7.2-complete.jar:$CLASSPATHâ€ org.antlr.v4.Toolâ€™
  alias grun=â€™java -Xmx500M -cp â€œ/usr/local/lib/antlr-4.7.2-complete.jar:$CLASSPATHâ€ org.antlr.v4.gui.TestRigâ€™</p>

<p>$ source ~/.bashrc
ç¼–å†™æºæ–‡ä»¶
$ vim Benedict.g4
  // Define a grammar called Benedict
  grammar Benedict;
  r    : â€˜helloâ€™ Name ;         // match keyword hello followed by an identifier
  Name : [a-z]+ ;               // match lower-case identifiers
  WS   : [ \t\r\n]+ -&gt; skip ;   // skip spaces, tabs, newlines
è¯æ³•è¯­æ³•åˆ†æ
$ antlr4 Benedict.g4
$ ll
  total 36K
  -rw-râ€“râ€“ 1 benedictjin wheel   93  1 15 14:47 Benedict.g4
  -rw-râ€“râ€“ 1 benedictjin wheel  321  1 15 14:47 Benedict.interp
  -rw-râ€“râ€“ 1 benedictjin wheel   38  1 15 14:47 Benedict.tokens
  -rw-râ€“râ€“ 1 benedictjin wheel 1.3K  1 15 14:47 BenedictBaseListener.java
  -rw-râ€“râ€“ 1 benedictjin wheel 1.3K  1 15 14:47 BenedictLexer.interp
  -rw-râ€“râ€“ 1 benedictjin wheel 3.7K  1 15 14:47 BenedictLexer.java
  -rw-râ€“râ€“ 1 benedictjin wheel   38  1 15 14:47 BenedictLexer.tokens
  -rw-râ€“râ€“ 1 benedictjin wheel  569  1 15 14:47 BenedictListener.java
  -rw-râ€“râ€“ 1 benedictjin wheel 3.9K  1 15 14:47 BenedictParser.java
ç¼–è¯‘
$ javac Benedict*.java
$ ll
  total 60K
  -rw-râ€“râ€“ 1 benedictjin wheel   93  1 15 14:47  Benedict.g4
  -rw-râ€“râ€“ 1 benedictjin wheel  321  1 15 14:47  Benedict.interp
  -rw-râ€“râ€“ 1 benedictjin wheel   38  1 15 14:47  Benedict.tokens
  -rw-râ€“râ€“ 1 benedictjin wheel  822  1 15 14:48  BenedictBaseListener.class
  -rw-râ€“râ€“ 1 benedictjin wheel 1.3K  1 15 14:47  BenedictBaseListener.java
  -rw-râ€“râ€“ 1 benedictjin wheel 3.8K  1 15 14:48  BenedictLexer.class
  -rw-râ€“râ€“ 1 benedictjin wheel 1.3K  1 15 14:47  BenedictLexer.interp
  -rw-râ€“râ€“ 1 benedictjin wheel 3.7K  1 15 14:47  BenedictLexer.java
  -rw-râ€“râ€“ 1 benedictjin wheel   38  1 15 14:47  BenedictLexer.tokens
  -rw-râ€“râ€“ 1 benedictjin wheel  329  1 15 14:48  BenedictListener.class
  -rw-râ€“râ€“ 1 benedictjin wheel  569  1 15 14:47  BenedictListener.java
  -rw-râ€“râ€“ 1 benedictjin wheel  896  1 15 14:48 â€˜BenedictParser$SayContext.classâ€™
  -rw-râ€“râ€“ 1 benedictjin wheel 4.4K  1 15 14:48  BenedictParser.class
  -rw-râ€“râ€“ 1 benedictjin wheel 3.9K  1 15 14:47  BenedictParser.java</p>

<p>$ grun Benedict r -tree
  hello benedict
  (r hello benedict)
å¯è§†åŒ–
$ grun Benedict r -gui
  hello benedict
  ^D
è¸©åˆ°çš„å‘
ç»™æ¯æ¬¡ antlr çš„ç»“æœæ–‡ä»¶æ·»åŠ  package
åœ¨ .g4 ä¸­ä½¿ç”¨ @header{ â€¦ } æ·»åŠ </p>

<p>@header{
    package com.yuzhouwan.antlr;
}
ç¡®å®šèŠ‚ç‚¹ä¸å­èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»
ä½¿ç”¨ if-else åœ¨ exit/enter() ä¸­åˆ¤åˆ«ï¼ŒèŠ‚ç‚¹ä¸å­èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œç¡®å®šæ˜¯å¦æ˜¯ operator</p>

<p>say
    : â€˜sayâ€™ Colon Name    #Colon
    ;</p>

<p><code class="language-plaintext highlighter-rouge">benedictListener</code> å°†ä¼šå¾—åˆ°ä¸€ä¸ªå®šä½ç²’åº¦ä¸º Colon çš„è®¿é—®èŠ‚ç‚¹</p>

<p>/**</p>
<ul>
  <li>Enter a parse tree produced by the {@code Colon}</li>
  <li>labeled alternative in {@link benedictParser#say}.</li>
  <li>@param ctx the parse tree
 */
void enterColon(benedictParser.ColonContext ctx);
/**</li>
  <li>Exit a parse tree produced by the {@code Colon}</li>
  <li>labeled alternative in {@link benedictParser#say}.</li>
  <li>@param ctx the parse tree
 */
void exitColon(benedictParser.ColonContext ctx);
https://www.jianshu.com/p/c9ca3e55bd2e
antlrä½œä¸ºä¸€é—¨è§£æè¯­è¨€ï¼Œè¢«ç”¨åœ¨å¾ˆå¤šåœºæ™¯ã€‚æŸ¥è¯¢å¼•æ“prestoå°±æ˜¯ç”¨çš„antlråšåº•å±‚sqlè¯­æ³•è§£æã€‚ä»Šå¤©å†™äº†ä¸€ä¸ªå°demoï¼Œä½œä¸ºè¿‡å»ä¸€å¹´è®¤è¯†äº†antlrçš„æ€»ç»“ã€‚
ANTLR, è¯­è¨€è¯†åˆ«çš„å¦ä¸€ä¸ªå·¥å…·(ANother Tool for Language Recognition ),(å‰èº«æ˜¯
PCCTS)æ˜¯ä¸€ç§è¯­è¨€å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ¡†æ¶ï¼Œå¯ä»¥é€šè¿‡åŒ…å« Java,C++,æˆ– C#åŠ¨ä½œï¼ˆactionï¼‰
çš„è¯­æ³•æè¿°æ¥æ„é€ è¯­è¨€è¯†åˆ«å™¨ï¼Œç¼–è¯‘å™¨å’Œè§£æå™¨ã€‚</li>
</ul>

<p>è®¡ç®—æœºè¯­è¨€çš„è§£æå·²ç»å˜æˆäº†ä¸€ç§éå¸¸æ™®éçš„å·¥ä½œã€‚ä¼ ç»Ÿçš„è®¡ç®—æœºè¯­è¨€çš„ç¼–è¯‘å™¨å’Œå·¥å…·
ï¼ˆå¦‚ C æˆ– Javaï¼‰ä»æ—§éœ€è¦è¢«æ„é€ ï¼Œå®ƒä»¬çš„æ•°é‡ä¸éœ€è¦å¼€å‘çš„é‚£äº›æˆåƒä¸Šä¸‡çš„å°è¯­è¨€çš„è¯†åˆ«
å·¥å…·å’Œè§£æå·¥å…·ç›¸æ¯”æ˜¯ç›¸å½¢è§æ‹™ã€‚ç¨‹åºå‘˜ä¸ºäº†è§£ææ•°æ®æ ¼å¼ï¼Œå›¾å½¢æ–‡ä»¶ï¼ˆå¦‚ï¼Œ
PostScript,AutoCADï¼‰ï¼Œæ–‡æœ¬æ–‡ä»¶ï¼ˆå¦‚ï¼ŒHTML,SGML ç­‰ï¼‰è€Œéœ€è¦æ„é€ è§£æå™¨ã€‚ANTLR è¢«è®¾è®¡å‡ºæ¥å¤„ç†æ‰€æœ‰è¿™äº›è½¬æ¢å·¥ä½œã€‚</p>

<p>antlr æ’ä»¶ antlr works download:ã€è®°å½•ã€‘å°è¯•ä½¿ç”¨ANTLRWorks 1.5å¼€å‘</p>

<p>antlr4.1æºç  download:antlr/antlr4</p>

<p>ç½‘ä¸Šèƒ½æ‰¾åˆ°2.7çš„ä¸­æ–‡ç‰ˆæ–‡æ¡£ï¼Œæ¨èçœ‹é‚£ä¸ªï¼Œå†™çš„å¾ˆè¯¦ç»†ï¼Œå…¶å®3.å‡ å’Œæˆ‘åœ¨ç”¨çš„4.å‡ æˆ‘ä¹Ÿæ²¡æœ‰å»äº†è§£ä»–ä»¬çš„å·®åˆ«ã€‚å¦‚æœè‹±æ–‡å¥½è¿˜æ˜¯çœ‹è‹±æ–‡å§ï¼Œæˆ‘æ˜¯å¤ªæ‡’äº†ï¼Œä¸­æ–‡çœ‹ç€æ–¹ä¾¿ã€‚</p>

<p>ä¸‹é¢è´´ä¸Šå†™çš„å°demo</p>

<p>è§£å†³ä¸€ä¸ªjavaçš„å…¥é—¨ç¨‹åºHelloworldçš„è¯­æ³•è§£æã€‚
å…¶ä¸­æœ‰å¾ˆå¤šä¸è¶³ä¹‹å¤„ï¼Œç±»ä¼¼äºç¬¦å·ä¸å®Œå…¨ç­‰é—®é¢˜ï¼Œdont mindè¿™äº›ç»†èŠ‚ã€‚ã€‚ã€‚</p>

<p>é¦–å…ˆç¡®å®šå¥½æˆ‘ä»¬è¦åšçš„äº‹ï¼Œå¼€å§‹å†™è¯­æ³•æ–‡ä»¶ï¼š
grammar SomeLanguage; // å£°æ˜è¯­æ³•å¤´
/*
*========================</p>
<ul>
  <li>ä¸€äº› options é…ç½®
<em>=======================
*/
options {
language = Java; //è®¾å®šç”Ÿæˆä»£ç çš„è¯­è¨€
}
/**
 =========================
   rule
 =========================
*/
classDeclaration : â€˜classâ€™ className â€˜{â€˜ (method)</em> â€˜}â€™;
className : (ID|â€™ â€˜)+;
method : methodName â€˜(â€˜ (parameter)* â€˜)â€™(â€˜ â€˜)<em>â€™{â€˜ (instruction)+â€™}â€™ ;
parameter:instruction|â€™ â€˜|â€™[â€™|â€™]â€™;
methodName : (ID|â€™ â€˜)+ ;
instruction : ID|â€™.â€™|â€™(â€˜|â€™)â€™|â€™;â€™;
str:STR;
ID : [a-zA-Z0-9|â€™_â€™]+ ;
STR:â€™'â€™ (â€˜''â€™ | ~(â€˜'â€™))</em> â€˜'â€™;
WS: [ \t\n\r]+ -&gt; skip ;
è¿™ä¸æ˜¯ä¸€ä¸‹å­å†™å‡ºæ¥çš„ï¼Œæ˜¯ä¸€æ­¥æ­¥è°ƒå‡ºæ¥çš„ï¼Œå¯ä»¥åˆ©ç”¨IDEAçš„æ’ä»¶ï¼Œè‡ªå·±å†™ä¸€æ®µdemoæ”¾è¿›å»ï¼Œç„¶åè°ƒè¯­æ³•ä¿å­˜å³å¯çœ‹åˆ°æ•ˆæœï¼Œç›´åˆ°æ•´æ£µæ ‘è§£ææ²¡é—®é¢˜æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä¸‹ä¸€æ­¥äº†ã€‚</li>
</ul>

<p>è¿™é‡Œæˆ‘è¿™ä¹ˆå†™æœ‰ç‚¹ä¸‘é™‹ï¼Œå¶å­èŠ‚ç‚¹å¤ªå¤šäº†ï¼Œæ¨ªå‘ç‰¹åˆ«é•¿ï¼Œä¸»è¦æ˜¯ä¸€è¡Œä»£ç çš„å­—ç¬¦å¤ªå¤šäº†ï¼Œè¦è§£æå‡ºæ¥å°±åªèƒ½æ¯ä¸€ä¸ªå­—ç¬¦éƒ½ä½œä¸ºinstructionäº†ã€‚ã€‚</p>

<p>æå®šè¯­æ³•æ–‡ä»¶åï¼Œå¯ä»¥åŠ¨æ‰‹ææ ‘çš„éå†äº†ï¼ŒAntlræä¾›äº†ä¸¤ç§éå†æ‰‹æ®µï¼Œä¸€ç§æ˜¯Listeneræ¨¡å¼ï¼Œä¸€ç§æ˜¯Visitoræ¨¡å¼ã€‚ä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼ŒListeneræ¨¡å¼é€‚åˆå…¨å±€æŸ¥æ‰¾ï¼Œé»˜è®¤æ˜¯æ·±åº¦ä¼˜å…ˆéå†ï¼Œè€ŒVisitoræ¨¡å¼é€‚åˆæŒ‡å®šæŸä¸ªèŠ‚ç‚¹ä½œéå†ã€‚è¿™ç§éå†æ–¹å¼é»˜è®¤æ˜¯å…ˆæ ¹ï¼Œç„¶åéå†å·¦å³å­æ ‘ã€‚</p>

<p>ANTLRæ’ä»¶æœ‰è‡ªåŠ¨ç”Ÿæˆä»£ç çš„åŠŸèƒ½ï¼Œå¾ˆå¥½çš„ä¸ºæˆ‘ä»¬æ–°æ‰‹å­¦ä¹ ANTLRå¿«é€Ÿä¸Šæ‰‹ANTLRåšäº†é“ºå«ï¼Œæˆ‘ä»¬ç»§æ‰¿å®ƒæä¾›çš„BaseListenerå’ŒBaseVisitorå³å¯ã€‚åªéœ€å®ç°æˆ‘ä»¬å…³æ³¨çš„èŠ‚ç‚¹å³å¯ï¼Œéå¸¸å®Œç¾ã€‚</p>

<p>è´´ä¸Šä»£ç 
è§£ææ¥å£ï¼Œå°†è¯­æ³•æ ‘è§£ææˆJAVABeanç”¨äºåºåˆ—åŒ–
public interface ILangParser {
    SomeClass parse(ParseTree parseTree);
}
Listenerè§£æç±»
public class LangeListenerParser implements ILangParser {
    public SomeClass parse(ParseTree parseTree) {
        ClassListener classListener = new ClassListener();
        new ParseTreeWalker().walk(classListener, parseTree);
        SomeClass someClass = classListener.getSomeClass();
        return someClass;
    }
    class ClassListener extends SomeLanguageBaseListener {
        SomeClass someClass;
        @Override
        public void enterClassDeclaration(SomeLanguageParser.ClassDeclarationContext ctx) {
            SomeLanguageParser.ClassNameContext classNameContext = ctx.className();
            final MethodListener methodListener = new MethodListener();
            ctx.method().forEach(method -&gt; {
                                     method.enterRule(methodListener);
                                 }
                                );
            someClass = new SomeClass(classNameContext.getText(), methodListener.getMethod());
        }
        public SomeClass getSomeClass() {
            return someClass;
        }
    }
    class MethodListener extends SomeLanguageBaseListener {
        Collection<Method> method;
        public MethodListener() {
            method = new ArrayList&lt;&gt;();
        }
        @Override
        public void enterMethod(SomeLanguageParser.MethodContext ctx) {
            String methodName = ctx.methodName().getText();
            InstructionListener instructionListener = new InstructionListener();
            ctx.instruction().forEach(instructionContext -&gt; {
                                          instructionContext.enterRule(instructionListener);
                                      }
                                     );
            StringBuilder parameter = new StringBuilder("");
            ctx.parameter().forEach(e -&gt; parameter.append(e.getText()));
            method.add(new Method(methodName, parameter.toString().split(","), instructionListener.getInstruction()));
        }
        public Collection<Method> getMethod() {
            return method;
        }
    }
    class InstructionListener extends SomeLanguageBaseListener {
        Collection<Instruction> instruction;
        StringBuilder instructionDesc = new StringBuilder("");
        public InstructionListener() {
            instruction = new ArrayList&lt;&gt;();
        }
        @Override
        public void enterInstruction(SomeLanguageParser.InstructionContext ctx) {
            String instructionName = ctx.getText();
            instructionDesc.append(instructionName);
            if (instructionName.equals(";")) {
                instruction.add(new Instruction(instructionDesc.toString()));
                instructionDesc.delete(0, instructionDesc.length());
            }
        }
        public Collection<Instruction> getInstruction() {
            return instruction;
        }
    }
}
Visitorè§£æç±»
public class SomeLangVisitorParser implements ILangParser {
    @Override
    public SomeClass parse(ParseTree parseTree) {
        ClassVisitor classVistor = new ClassVisitor();
        return classVistor.visit(parseTree);
    }
    class ClassVisitor extends SomeLanguageBaseVisitor<SomeClass> {
        @Override
        public SomeClass visitClassDeclaration(SomeLanguageParser.ClassDeclarationContext ctx) {
            MethodVisitor methodVisitor = new MethodVisitor();
            Collection<Method> methods = ctx.method()
                    .stream()
                    .map(methodContext -&gt; methodContext.accept(methodVisitor))
                    .collect(Collectors.toList());
            return new SomeClass(ctx.className().getText(), methods);
        }
    }
    class MethodVisitor extends SomeLanguageBaseVisitor<Method> {
        @Override
        public Method visitMethod(SomeLanguageParser.MethodContext ctx) {
            InstructionVisitor instructionVisitor = new InstructionVisitor();
            Collection<Instruction> instructions = ctx.instruction()
                    .stream()
                    .map(instructionContext -&gt; instructionContext.accept(instructionVisitor))
                    .collect(Collectors.toList());
            StringBuilder sb = new StringBuilder("");
            ctx.parameter().forEach(e -&gt; sb.append(e.getText()));
            return new Method(ctx.methodName().getText(), sb.toString().split(","), instructions);
        }
    }
    class InstructionVisitor extends SomeLanguageBaseVisitor<Instruction> {
        @Override
        public Instruction visitInstruction(SomeLanguageParser.InstructionContext ctx) {
            return new Instruction(ctx.getText());
        }
    }
}
JavaBean
public class SomeClass {
    private String className;
    private Collection<Method> methods;
    public SomeClass(String className, Collection<Method> methods) {
        this.className = className;
        this.methods = methods;
    }
}
public class Method {
    private String methodName;
    private String[] parameters;
    private Collection<Instruction> instructions;
    public Method(String methodName, String[] parameters, Collection<Instruction> instructions) {
        this.methodName = methodName;
        this.parameters = parameters;
        this.instructions = instructions;
    }
}
public class Instruction {
    private  String instructionName;
    public Instruction(String name) {
        this.instructionName = name;
    }
}
æµ‹è¯•ç±»
public class TestSomeLang {
    public static void main(String[] args) {
        // listener æ–¹å¼éå†
        TestSomeLang testSomeLang = new TestSomeLang();
        String code = testSomeLang.readContent();
        SomeLanguageParser parser = getParseTree(code);
        SomeClass someClass = new LangeListenerParser().parse(parser.classDeclaration());
        Gson gson = new Gson();
        System.out.println(gson.toJson(someClass));
        System.out.println("======================================\n visitoræ–¹å¼");
        // visitoræ–¹å¼éå†
        SomeLanguageParser parser2 = getParseTree(code);
        SomeClass someClass1 = new SomeLangVisitorParser().parse(parser2.classDeclaration());
        System.out.println(gson.toJson(someClass1));
    }
    public String readContent() {
        File dir = null;
        try {
            dir = new File(getClass().getResource("/someLang").toURI());
            for (File file : dir.listFiles()) {
                if (!file.getName().equalsIgnoreCase("lang1")) {
                    continue;
                }
                String code = FileUtils.readFileToString(file, "utf-8");
                return code;
            }
        } catch (URISyntaxException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }
    public static SomeLanguageParser getParseTree(String code) {
        ANTLRInputStream antlrInputStream = new ANTLRInputStream(code);
        SomeLanguageLexer lexer = new SomeLanguageLexer(antlrInputStream);
        CommonTokenStream commonStream = new CommonTokenStream(lexer);
        SomeLanguageParser parseTree = new SomeLanguageParser(commonStream);
        return parseTree;
    }
}</Instruction></Instruction></Method></Method></Instruction></Instruction></Method></Method></SomeClass></Instruction></Instruction></Method></Method></p>

<p>https://zhuanlan.zhihu.com/p/25028169
https://www.cnblogs.com/clonen/p/9083359.html
https://blog.csdn.net/yangguosb/article/details/85332340
å®‰è£…ANTLR
ä½œè€…çš„ç”µè„‘æ˜¯MACçš„æ“ä½œç³»ç»ŸmacOS Catalina 10.15.2ã€‚</p>

<p>å®‰è£…æ­¥éª¤ålinuxæ“ä½œçš„ç³»ç»Ÿçš„ä¸€æ ·ï¼Œ Windowsç³»ç»Ÿå¤§è‡´æ­¥éª¤ä¸€æ ·ï¼Œä½†æ˜¯ç¯å¢ƒå˜é‡ç­‰é…ç½®æœ‰å·®åˆ«ï¼Œä½œè€…å¾ˆä¹…æ²¡ä½¿ç”¨è¿‡winç³»ç»Ÿï¼Œåªèƒ½åŸºäºMACçš„ç³»ç»Ÿä»‹ç»äº†ã€‚</p>

<p>ç¯å¢ƒå‡†å¤‡
ANLTRæ˜¯ç”¨JAVAç¼–å†™çš„ï¼Œéœ€è¦å…ˆå®‰è£…å¥½JAVAï¼Œéœ€è¦çš„JAVAç‰ˆæœ¬æ˜¯1.6ä»¥ä¸Šã€‚ç›¸ä¿¡çœ‹è¿™ç¯‡æ–‡ç« çš„å„ä½åŒå­¦ç”µè„‘ä¸Šåº”è¯¥éƒ½æœ‰å®‰è£…JAVAã€‚ğŸ˜Š</p>

<p>ä¸‹è½½ANTLR
ä½¿ç”¨ANTLRçš„åŠŸèƒ½å…¶å®å¾ˆç®€å•ï¼Œ ä¸‹è½½ä¸€ä¸ªANTLRçš„jaråŒ…å³å¯ã€‚
å®˜æ–¹ä¸‹è½½åœ°å€</p>

<p>é…ç½®
æœ€åä¸€æ­¥é…ç½®ç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿åé¢åœ¨å‘½ä»¤è¡Œæ“ä½œANTLR
æ‰“å¼€ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œä½œè€…å®‰è£…çš„æ˜¯zshï¼Œæ‰€ä»¥ç¼–è¾‘~/.zshrcæ–‡ä»¶ï¼Œå„ä½åŒå­¦åº”è¯¥ä¹Ÿæ¸…æ¥šç¯å¢ƒå˜é‡çš„é…ç½®ï¼Œåœ¨æ–‡ä»¶åŠ å…¥å‡ è¡Œï¼š</p>

<p>export CLASSPATH=â€.:/usr/local/lib/antlr-4.7.1-complete.jar:$CLASSPATHâ€  #è®¾ç½®antlrçš„jaråŒ…åˆ°ç¯å¢ƒå˜é‡
alias antlr4=â€™java -Xmx500M -cp â€œ/usr/local/lib/antlr-4.7.1-complete.jar:$CLASSPATHâ€ org.antlr.v4.Toolâ€™  #å¿«é€Ÿè¿è¡ŒANTLRçš„è§£é‡Šå™¨
alias grun=â€™java -Xmx500M -cp â€œ/usr/local/lib/antlr-4.7.1-complete.jar:$CLASSPATHâ€ org.antlr.v4.gui.TestRigâ€™ #å¿«é€Ÿè¿è¡ŒANTLRæµ‹è¯•å·¥å…·</p>

<p>å®Œæˆä¸Šé¢çš„å‡†å¤‡å·¥ä½œå°±å¯ä»¥å¼€å§‹ä½“éªŒANTLRçš„å¼ºå¤§åŠŸèƒ½äº†</p>

<p>ç¬¬ä¸€ä¸ªè¯­æ³•è§£é‡Šå™¨
ä¸‹é¢ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­å±•ç¤ºANTLRçš„ä½¿ç”¨ï¼Œç¼–è¯‘ä¸€ä¸ªæœ€ç®€å•çš„èµ‹å€¼è¯­å¥çš„è¯­æ³•ã€‚</p>

<p>ç¼–å†™g4æ–‡ä»¶
æ–°å»ºä¸€ä¸ªHello.g4çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯é’ˆå¯¹è¯­æ³•çš„æè¿°ï¼Œç›¸å½“äºå‘Šè¯‰ANTLRæˆ‘çš„è¯­æ³•è§„èŒƒ</p>

<p>Hello.g4å†…å®¹å¦‚ä¸‹ï¼š</p>

<p>grammar Hello;  //å®šä¹‰ä¸€ä¸ªåä¸º Hello çš„è¯­æ³•
 statement: ID â€˜=â€™ NUM; //åŒ¹é…ç±»ä¼¼ a=1 age=100 è¿™æ ·çš„è¯­å¥
 ID: [a-z]+;   // å®šä¹‰äº†ä¸€ä¸ªè¯æ³• IDï¼Œç”±å°å†™å­—æ¯ç»„æˆ
 NUM:[0-9]+; // å®šä¹‰äº†ä¸€ä¸ªè¯æ³• NUMï¼Œç”±æ•°å­—ç»„æˆ
 WS: [ \t\r\n]+ -&gt; skip;  //åœ¨è¿›è¡Œè§£æçš„è¿‡ç¨‹ä¸­ï¼Œå¿½ç•¥æ‰ç©ºæ ¼ï¼Œæ¢è¡Œ
è¿™æ ·å…¶å®å°±å®šä¹‰å¥½äº†ä¸€ä¸ªç®€å•è¯­æ³•ã€‚
å¯¹äºä¸åŒçš„ç¨‹åºè¯­è¨€æ¥è¯´ï¼Œè¯­æ³•ç»“æ„è¶Šæ˜¯å¤æ‚ï¼Œæƒ³å¯¹åº”çš„g4æ–‡ä»¶ä¹Ÿä¼šè¶Šå¤æ‚
è¿™ä¸ªé¡¹ç›®é‡Œé¢æœ‰é’ˆå¯¹ç›®å‰æµè¡Œçš„è¯­è¨€çš„ANTLRè¯­æ³•å®šä¹‰æ–‡ä»¶
å„ä½åŒå­¦å¯ä»¥æ‰¾æ‰¾æ¥è§¦è¿‡å“ªäº›ï¼Œçœ‹çœ‹ä½ ç”¨çš„è¯­è¨€å¤æ‚ä¸å¤æ‚ã€‚åæ­£JAVAæ–‡ä»¶æ˜¯å¾ˆå¤æ‚ğŸ’”</p>

<p>ç”Ÿæˆè§£é‡Šå™¨
ç”ŸæˆANTLRçš„è§£é‡Šå™¨å¾ˆç®€å•ï¼Œä¸€æ¡å‘½ä»¤æå®šã€‚</p>

<p>antlr4 Hello.g4
è¿è¡Œå®Œè¿™æ¡å‘½ä»¤ä¼šç”Ÿæˆå¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š</p>

<p>Hello.interp
Hello.tokens
HelloBaseListener.java
HelloLexer.interp
HelloLexer.java
HelloLexer.tokens
HelloListener.java
HelloParser.java
HelloParser.java</p>

<p>è¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªè¯­æ³•è§£é‡Šå™¨ç±»çš„å®šä¹‰ï¼Œè´Ÿè´£è¯†åˆ«æˆ‘ä»¬å®šä¹‰çš„è¯­æ³•</p>

<p>public class HelloParser extends Parser { â€¦ }
HelloLexer.java</p>

<p>è¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªè¯æ³•è§£é‡Šå™¨ç±»çš„å®šä¹‰ï¼Œè´Ÿè´£è‡ªåŠ¨è¯†åˆ«æˆ‘ä»¬å®šä¹‰çš„è¯­æ³•ä¸­çš„æ–‡æ³•è§„åˆ™å’Œè¯æ³•è§„åˆ™ã€‚</p>

<p>public class HelloLexer extends Lexer { â€¦ }
HelloListener.javaå’ŒHelloBaseListener.java</p>

<p>è¿™ä¸¤ä¸ªç±»éƒ½æ˜¯äº‹ä»¶ç›‘å¬ç±»ï¼Œæ˜¯ç•™ç»™å¼€å‘è€…è‡ªå·±æ¥å®šä¹‰ç›¸åº”çš„äº‹ä»¶ã€‚å› ä¸ºANTLRåœ¨è¿›è¡Œéå†è§£ææ—¶ï¼Œéå†å™¨ä¼šè§¦å‘ä¸€ç³»åˆ—çš„äº‹ä»¶ã€‚ æ¯”å¦‚è¿›å…¥æŸæŸæ ‡ç­¾ï¼Œè¯»åˆ°ä¸€ä¸ªæ•°å­—ç­‰ã€‚ANTLRå¼€æ”¾äº†è¿™äº›æ¥å£ï¼Œå¼€å‘è€…é€šè¿‡å®ç°è¿™äº›äº‹ä»¶å¯ä»¥åšåˆ°é™¤äº†è§£é‡Šè¯­æ³•ä»¥å¤–æ›´å¤æ‚çš„åŠŸèƒ½ã€‚è¿™é‡Œå°±ä¸è¯¦ç»†è§£é‡Šï¼Œåé¢ä¼šå†ä»‹ç»ã€‚å…ˆæŒ–ä¸ªå‘ğŸ˜Š</p>

<p>public interface HelloListener extends ParseTreeListener {
	/**
	 * Enter a parse tree produced by {@link HelloParser#statement}.
	 * @param ctx the parse tree
	 */
	void enterStatement(HelloParser.StatementContext ctx);
	/**
	 * Exit a parse tree produced by {@link HelloParser#statement}.
	 * @param ctx the parse tree
	 */
	void exitStatement(HelloParser.StatementContext ctx);
}
å…¶ä»–éjavaæ–‡ä»¶</p>

<p>ANTLRä¼šç»™æ¯ä¸ªå®šä¹‰çš„è¯æ³•ç¬¦å·æŒ‡å®šä¸€ä¸ªæ•°å­—å½¢å¼çš„ç±»å‹ï¼Œç„¶åå°†å¯¹åº”å…³ç³»å­˜å‚¨åœ¨è¿™äº›æ–‡ä»¶ä¸­ã€‚å½“ä¸åŒçš„è¯­æ³•æœ‰ç›¸åŒçš„è¯æ—¶è¿™ä¸ªæ–‡ä»¶å°±æœ‰å¤§ä½œç”¨äº†ã€‚</p>

<p>æµ‹è¯•è§£é‡Šå™¨
æœ€ååˆ°äº†éªŒæ”¶ç»“æœçš„æ—¶å€™ï¼Œæµ‹è¯•ä¸€ä¸‹ANTLRçš„è¯­æ³•è§£é‡Šå™¨åšäº†ä»€ä¹ˆã€‚ä¸‹é¢ä¼šå±•ç¤ºä¸¤ç§æµ‹è¯•æ–¹å¼ã€‚</p>

<p>JAVAä»£ç 
å°†å‰é¢ç”Ÿæˆçš„4ä¸ªJAVAæ–‡ä»¶æ·»åŠ åˆ°ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å†…ï¼Œè¯¥å·¥ç¨‹éœ€è¦å¼•å…¥ANTLRä¾èµ–ã€‚</p>
<dependency>
    <groupId>org.antlr</groupId>
    <artifactId>antlr4</artifactId>
    <version>4.7.1</version>
</dependency>
<p>ç¼–å†™ç›¸å…³æµ‹è¯•ä»£ç 
public static void main(String[] args) {
        HelloLexer lexer = new HelloLexer(CharStreams.fromString(â€œa = 1â€));
        CommonTokenStream tokenStream = new CommonTokenStream(lexer);
        HelloParser parser = new HelloParser(tokenStream);
        System.out.println(parser.statement().toStringTree(parser));
    }
è¿è¡Œåä¼šæœ‰å¦‚ä¸‹è¾“å…¥ï¼š
(statement a = 1)
è¿™ä¸ªä»£ç ANTLRæˆåŠŸè¯†åˆ«åˆ°äº†æˆ‘ä»¬çš„èµ‹å€¼è¯­å¥ã€‚
å‘½ä»¤è¡Œ
ANTLRä¹Ÿæä¾›äº†è‡ªåŠ¨çš„æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œæµ‹è¯•ã€‚è¯¦ç»†ç”¨æ³•å¦‚ä¸‹</p>

<p>ç¼–è¯‘javaä»£ç ï¼Œå°±è·Ÿä¸€èˆ¬çš„javaä»£ç ä¸€æ ·æˆ‘ä»¬éœ€è¦åŒjavacæŠŠjavaæ–‡ä»¶ç¼–è¯‘æˆclassæ–‡ä»¶ã€‚
javac *.java
ä½¿ç”¨ANTLRæµ‹è¯•å·¥å…·ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤
grun Hello statement -gui
Hello å¯¹åº”æˆ‘ä»¬å®šä¹‰çš„è¯­æ³• grammar Hello
statement å¯¹åº”æˆ‘ä»¬å®šä¹‰çš„è¯æ³• statement: ID â€˜=â€™ NUM;
-gui è¡¨ç¤ºè¾“å‡ºå›¾å½¢ç•Œé¢</p>

<p>è¿›å…¥æµ‹è¯•å·¥å…·åï¼Œè¾“å…¥a = 1ã€‚ MACç”µè„‘ç»“æŸè¾“å…¥ç¬¦å· control+Dã€‚
$ grun Hello statement -gui                               <br />
a = 1
^D
ANTLRä¼šè¾“å‡ºå›¾å½¢ç•Œé¢</p>

<p>å¯ä»¥çœ‹åˆ°ANTLRæœ€ç»ˆè§£é‡Šå‡ºæ¥çš„è¯­æ³•æ ‘ã€‚</p>

<p>æ€»ç»“
è¿™ç¯‡æ–‡ç« å¸¦å¤§å®¶å®Œæˆäº†ç¬¬ä¸€ä¸ªANTLRçš„è¯­æ³•æ–‡ä»¶ï¼Œå¹¶å±•ç¤ºäº†æµ‹è¯•è¿‡ç¨‹ã€‚ä¸­é—´æœ‰ä¸€äº›ç»†èŠ‚æ²¡æœ‰åœ¨è¿™é‡Œä»”ç»†è®²è§£ï¼Œåœ¨åé¢çš„ç¬”è®°ä¼šé™†ç»­æ›´æ–°ã€‚æœ€åé™„ä¸Šä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„è¯­æ³•æ ‘çš„å›¾ã€‚
https://www.cnblogs.com/zanezhou/p/12624712.html</p>

<p>Antlr æ˜¯ä¸€ä¸ªåŸºäº Java å¼€å‘çš„åŠŸèƒ½å¼ºå¤§çš„è¯­è¨€è¯†åˆ«å·¥å…·ï¼ŒAntlr ä»¥å…¶ç®€ä»‹çš„è¯­æ³•å’Œé«˜é€Ÿçš„è¿è¡Œæ•ˆç‡åœ¨è¿™ç±»å·¥å…·ä¸­å‡ºç±»æ‹”èƒã€‚å½“ä½ éœ€è¦å¼€å‘ä¸€ç§é¢†åŸŸè¯­è¨€æ—¶ï¼Œè¯­è¨€å¯èƒ½åƒ Excel ä¸­çš„å…¬å¼ä¸€æ ·å¤æ‚ï¼Œä¹Ÿå¯èƒ½åƒæœ¬æ–‡ä¸­çš„ä¾‹å­ä¸€æ ·ç®€å•ï¼ˆåªæœ‰ç®—æœ¯è¿ç®—ï¼‰ï¼Œè¿™æ—¶ä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨ Antlr æ¥å¤„ç†ä½ çš„è¯­è¨€ã€‚</p>

<p>Antlr ç®€ä»‹
ANTLR è¯­è¨€è¯†åˆ«çš„ä¸€ä¸ªå·¥å…· (ANother Tool for Language Recognition ) æ˜¯ä¸€ç§è¯­è¨€å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ¡†æ¶ï¼Œå¯ä»¥é€šè¿‡åŒ…å« Java, C++, æˆ– C# åŠ¨ä½œï¼ˆactionï¼‰çš„è¯­æ³•æè¿°æ¥æ„é€ è¯­è¨€è¯†åˆ«å™¨ï¼Œç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ã€‚ è®¡ç®—æœºè¯­è¨€çš„è§£æå·²ç»å˜æˆäº†ä¸€ç§éå¸¸æ™®éçš„å·¥ä½œï¼Œåœ¨è¿™æ–¹é¢çš„ç†è®ºå’Œå·¥å…·ç»è¿‡è¿‘ 40 å¹´çš„å‘å±•å·²ç»ç›¸å½“æˆç†Ÿï¼Œä½¿ç”¨ Antlr ç­‰è¯†åˆ«å·¥å…·æ¥è¯†åˆ«ï¼Œè§£æï¼Œæ„é€ ç¼–è¯‘å™¨æ¯”æ‰‹å·¥ç¼–ç¨‹æ›´åŠ å®¹æ˜“ï¼ŒåŒæ—¶å¼€å‘çš„ç¨‹åºä¹Ÿæ›´æ˜“äºç»´æŠ¤ã€‚
è¯­è¨€è¯†åˆ«çš„å·¥å…·æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚å¤§åé¼é¼çš„ Lex å’Œ YACCï¼ŒLinux ä¸­æœ‰ä»–ä»¬çš„å¼€æºç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯ Flex å’Œ Bisonã€‚åœ¨ Java ç¤¾åŒºé‡Œï¼Œé™¤äº† Antlr å¤–ï¼Œè¯­è¨€è¯†åˆ«å·¥å…·è¿˜æœ‰ JavaCC å’Œ SableCC ç­‰ã€‚
å’Œå¤§å¤šæ•°è¯­è¨€è¯†åˆ«å·¥å…·ä¸€æ ·ï¼ŒAntlr ä½¿ç”¨ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•æè¿°è¯­è¨€ã€‚æœ€æ–°çš„ Antlr æ˜¯ä¸€ä¸ªåŸºäº LL(*) çš„è¯­è¨€è¯†åˆ«å™¨ã€‚åœ¨ Antlr ä¸­é€šè¿‡è§£æç”¨æˆ·è‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯æ³•åˆ†æå™¨ (Lexer)ã€è¯­æ³•åˆ†æå™¨ (Parser) å’Œæ ‘åˆ†æå™¨ (Tree Parser)ã€‚
Antlr èƒ½åšä»€ä¹ˆ
ç¼–ç¨‹è¯­è¨€å¤„ç†
è¯†åˆ«å’Œå¤„ç†ç¼–ç¨‹è¯­è¨€æ˜¯ Antlr çš„é¦–è¦ä»»åŠ¡ï¼Œç¼–ç¨‹è¯­è¨€çš„å¤„ç†æ˜¯ä¸€é¡¹ç¹é‡å¤æ‚çš„ä»»åŠ¡ï¼Œä¸ºäº†ç®€åŒ–å¤„ç†ï¼Œä¸€èˆ¬çš„ç¼–è¯‘æŠ€æœ¯éƒ½å°†è¯­è¨€å¤„ç†å·¥ä½œåˆ†ä¸ºå‰ç«¯å’Œåç«¯ä¸¤ä¸ªéƒ¨åˆ†ã€‚å…¶ä¸­å‰ç«¯åŒ…æ‹¬è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€ä¸­é—´ä»£ç ç”Ÿæˆç­‰è‹¥å¹²æ­¥éª¤ï¼Œåç«¯åŒ…æ‹¬ç›®æ ‡ä»£ç ç”Ÿæˆå’Œä»£ç ä¼˜åŒ–ç­‰æ­¥éª¤ã€‚</p>

<p>Antlr è‡´åŠ›äºè§£å†³ç¼–è¯‘å‰ç«¯çš„æ‰€æœ‰å·¥ä½œã€‚ä½¿ç”¨ Anltr çš„è¯­æ³•å¯ä»¥å®šä¹‰ç›®æ ‡è¯­è¨€çš„è¯æ³•è®°å·å’Œè¯­æ³•è§„åˆ™ï¼ŒAntlr è‡ªåŠ¨ç”Ÿæˆç›®æ ‡è¯­è¨€çš„è¯æ³•åˆ†æå™¨å’Œè¯­æ³•åˆ†æå™¨ï¼›æ­¤å¤–ï¼Œå¦‚æœåœ¨è¯­æ³•è§„åˆ™ä¸­æŒ‡å®šæŠ½è±¡è¯­æ³•æ ‘çš„è§„åˆ™ï¼Œåœ¨ç”Ÿæˆè¯­æ³•åˆ†æå™¨çš„åŒæ—¶ï¼ŒAntlr è¿˜èƒ½å¤Ÿç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ï¼›æœ€ç»ˆä½¿ç”¨æ ‘åˆ†æå™¨éå†æŠ½è±¡è¯­æ³•æ ‘ï¼Œå®Œæˆè¯­ä¹‰åˆ†æå’Œä¸­é—´ä»£ç ç”Ÿæˆã€‚æ•´ä¸ªå·¥ä½œåœ¨ Anltr å¼ºå¤§çš„æ”¯æŒä¸‹ï¼Œå°†å˜å¾—éå¸¸è½»æ¾å’Œæ„‰å¿«ã€‚
æ–‡æœ¬å¤„ç†</p>

<p>æ–‡æœ¬å¤„ç†
å½“éœ€è¦æ–‡æœ¬å¤„ç†æ—¶ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½¿ç”¨ Anltr çš„è¯æ³•åˆ†æå™¨ç”Ÿæˆå™¨ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„å®Œæˆæ­£åˆ™è¡¨è¾¾å¼èƒ½å¤Ÿå®Œæˆçš„æ‰€æœ‰å·¥ä½œï¼›é™¤æ­¤ä¹‹å¤–ä½¿ç”¨ Anltr è¿˜å¯ä»¥å®Œæˆä¸€äº›æ­£åˆ™è¡¨è¾¾å¼éš¾ä»¥å®Œæˆçš„å·¥ä½œï¼Œæ¯”å¦‚è¯†åˆ«å·¦æ‹¬å·å’Œå³æ‹¬å·çš„æˆå¯¹åŒ¹é…ç­‰ã€‚</p>

<p>åœ¨IDEAä¸­å®‰è£…ä½¿ç”¨Antlr
åœ¨Settings-Pluginsä¸­å®‰è£…ANTLR v4 grammar plugin
æ–°å»ºä¸€ä¸ªMavené¡¹ç›®ï¼Œåœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ ANTLR4æ’ä»¶å’Œè¿è¡Œåº“çš„ä¾èµ–ã€‚æ³¨æ„ä¸€å®šè¦ç”¨æœ€æ–°ç‰ˆçš„ï¼Œä¾èµ–ï¼Œä¸çŸ¥é“æœ€æ–°ç‰ˆæœ¬å·çš„å¯ä»¥è‡ªå·±googleä¸€ä¸‹maven antlr4ã€‚</p>
<dependencies>

        <dependency>
            <groupId>org.antlr</groupId>
            <artifactId>antlr4-runtime</artifactId>
            <version>4.5.3</version>
        </dependency>
    </dependencies>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.antlr&lt;/groupId&gt;
            &lt;artifactId&gt;antlr4-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;4.3&lt;/version&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;id&gt;antlr&lt;/id&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;antlr4&lt;/goal&gt;
                    &lt;/goals&gt;
                    &lt;phase&gt;none&lt;/phase&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
            &lt;configuration&gt;
                &lt;outputDirectory&gt;src/test/java&lt;/outputDirectory&gt;
                &lt;listener&gt;true&lt;/listener&gt;
                &lt;treatWarningsAsErrors&gt;true&lt;/treatWarningsAsErrors&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 antlr4-maven-pluginç”¨äºç”Ÿäº§Javaä»£ç ï¼Œantlr4-runtimeåˆ™æ˜¯è¿è¡Œæ—¶æ‰€éœ€çš„ä¾èµ–åº“ã€‚æŠŠantlr4-maven-pluginçš„phaseè®¾ç½®æˆnoneï¼Œè¿™æ ·åœ¨Maven çš„lifecycleç§å°±ä¸ä¼šè°ƒç”¨ANTLR4ã€‚å¦‚æœä½ å¸Œæœ›æ¯æ¬¡æ„å»ºç”Ÿæˆæ–‡æ³•å¯ä»¥å°†è¿™ä¸ªé…ç½®å»æ‰ã€‚
</code></pre></div></div>

<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæœ€ç®€å•çš„é¢†åŸŸè¯­è¨€ï¼Œä»ä¸€ä¸ªç®€å•çš„å®Œæˆç®—æœ¯è¿ç®—çš„ä¾‹å­å‡ºå‘ï¼Œè¯¦ç»†è¯´æ˜ Antlr çš„ä½¿ç”¨ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨src\main\javaä¸­æ–°å»ºä¸€ä¸ª Antlr çš„æ–‡æ³•æ–‡ä»¶ï¼Œ ä¸€èˆ¬ä»¥ .g4 ä¸ºæ–‡ä»¶ååç¼€ï¼Œå‘½åä¸º Demo.g4 ã€‚
è¡¨è¾¾å¼å®šä¹‰
æ–‡æ³•å®šä¹‰
åœ¨è¿™ä¸ªæ–‡æ³•æ–‡ä»¶ Demo.g4 ä¸­æ ¹æ® Antlr çš„è¯­æ³•è§„åˆ™æ¥å®šä¹‰ç®—æœ¯è¡¨è¾¾å¼çš„æ–‡æ³•ï¼Œæ–‡ä»¶çš„å¤´éƒ¨æ˜¯ grammar å…³é”®å­—ï¼Œå®šä¹‰æ–‡æ³•çš„åå­—ï¼Œå¿…é¡»ä¸æ–‡æ³•æ–‡ä»¶æ–‡ä»¶çš„åå­—ç›¸åŒï¼š</p>

<p>grammar Demo;
1
ä¸ºäº†ç®€å•èµ·è§ï¼Œå‡è®¾æˆ‘ä»¬çš„è‡ªå®šä¹‰è¯­è¨€åªèƒ½è¾“å…¥ä¸€ä¸ªç®—æœ¯è¡¨è¾¾å¼ã€‚ä»è€Œæ•´ä¸ªç¨‹åºæœ‰ä¸€ä¸ªè¯­å¥æ„æˆï¼Œè¯­å¥æœ‰è¡¨è¾¾å¼æˆ–è€…æ¢è¡Œç¬¦æ„æˆã€‚å¦‚æ¸…å• 1 æ‰€ç¤ºï¼š</p>

<p>æ¸…å•1.ç¨‹åºå’Œè¯­å¥</p>

<p>prog: stat 
; 
stat: expr 
  |NEWLINE 
;
1
2
3
4
5
åœ¨ Anltr ä¸­ï¼Œç®—æ³•çš„ä¼˜å…ˆçº§éœ€è¦é€šè¿‡æ–‡æ³•è§„åˆ™çš„åµŒå¥—å®šä¹‰æ¥ä½“ç°ï¼ŒåŠ å‡æ³•çš„ä¼˜å…ˆçº§ä½äºä¹˜é™¤æ³•ï¼Œè¡¨è¾¾å¼ expr çš„å®šä¹‰ç”±ä¹˜é™¤æ³•è¡¨è¾¾å¼ multExpr å’ŒåŠ å‡æ³•ç®—ç¬¦ (â€˜+â€™|â€™-â€˜) æ„æˆï¼›åŒç†ï¼Œæ‹¬å·çš„ä¼˜å…ˆçº§é«˜äºä¹˜é™¤æ³•ï¼Œä¹˜é™¤æ³•è¡¨è¾¾å¼ multExpr é€šè¿‡åŸå­æ“ä½œæ•° atom å’Œä¹˜é™¤æ³•ç®—ç¬¦ (â€˜*â€™|â€™/â€™) æ„æˆã€‚æ•´ä¸ªè¡¨è¾¾çš„å®šä¹‰å¦‚æ¸…å• 2 æ‰€ç¤ºï¼š</p>

<p>æ¸…å•2.è¡¨è¾¾å¼</p>

<p>expr : multExpr ((â€˜+â€™|â€™-â€˜) multExpr)* 
; 
multExpr : atom ((â€˜<em>â€™|â€™/â€™) atom)</em> 
; 
atom:  â€˜(â€˜ expr â€˜)â€™ 
      | INT<br />
   | ID<br />
;
1
2
3
4
5
6
7
8
æœ€åéœ€è¦è€ƒè™‘çš„è¯æ³•çš„å®šä¹‰ï¼Œåœ¨ Antlr ä¸­è¯­æ³•å®šä¹‰å’Œè¯æ³•å®šä¹‰é€šè¿‡è§„åˆ™çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ¥åŒºåˆ«ï¼Œ è§„å®šè¯­æ³•å®šä¹‰ç¬¦å·çš„ç¬¬ä¸€ä¸ªå­—æ¯å°å†™ï¼Œè€Œè¯æ³•å®šä¹‰ç¬¦å·çš„ç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™ã€‚ç®—æœ¯è¡¨è¾¾å¼ä¸­ç”¨åˆ°äº† 4 ç±»è®°å· ( åœ¨ Antlr ä¸­è¢«ç§°ä¸º Token)ï¼Œåˆ†åˆ«æ˜¯æ ‡è¯†ç¬¦ IDï¼Œè¡¨ç¤ºä¸€ä¸ªå˜é‡ï¼›å¸¸é‡ INTï¼Œè¡¨ç¤ºä¸€ä¸ªå¸¸æ•°ï¼›æ¢è¡Œç¬¦ NEWLINE å’Œç©ºæ ¼ WSï¼Œç©ºæ ¼å­—ç¬¦åœ¨è¯­è¨€å¤„ç†æ—¶å°†è¢«è·³è¿‡ï¼Œskip() æ˜¯è¯æ³•åˆ†æå™¨ç±»çš„ä¸€ä¸ªæ–¹æ³•ã€‚å¦‚æ¸…å• 3 æ‰€ç¤ºï¼š</p>

<p>æ¸…å• 3. è®°å·å®šä¹‰</p>

<p>ID:(â€˜aâ€™..â€™zâ€™|â€™Aâ€™..â€™Zâ€™)+;
INT:â€™0â€™..â€™9â€™+;
NEWLINE:â€™\râ€™?â€™\nâ€™;
WS:(â€˜ â€˜|â€™\tâ€™|â€™\nâ€™|â€™\râ€™)+{skip();};
1
2
3
4
Antlr æ”¯æŒå¤šç§ç›®æ ‡è¯­è¨€ï¼Œå¯ä»¥æŠŠç”Ÿæˆçš„åˆ†æå™¨ç”Ÿæˆä¸º Javaï¼ŒC#ï¼ŒCï¼ŒPythonï¼ŒJavaScript ç­‰å¤šç§è¯­è¨€ï¼Œé»˜è®¤ç›®æ ‡è¯­è¨€ä¸º Javaï¼Œé€šè¿‡ options {language=?;} æ¥æ”¹å˜ç›®æ ‡è¯­è¨€ã€‚æˆ‘ä»¬çš„ä¾‹å­ä¸­ç›®æ ‡è¯­è¨€ä¸º Javaã€‚</p>

<p>æ•´ä¸ªDemo.g4æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>

<p>grammar Demo;</p>

<p>//parser
prog:stat
;
stat:expr|NEWLINE
;</p>

<p>expr:multExpr((â€˜+â€™|â€™-â€˜)multExpr)*
;
multExpr:atom((â€˜<em>â€™|â€™/â€™)atom)</em>
;
atom:â€™(â€˜exprâ€™)â€™
    |INT
    |ID
;</p>

<p>//lexer
ID:(â€˜aâ€™..â€™zâ€™|â€™Aâ€™..â€™Zâ€™)+;
INT:â€™0â€™..â€™9â€™+;
NEWLINE:â€™\râ€™?â€™\nâ€™;
WS:(â€˜ â€˜|â€™\tâ€™|â€™\nâ€™|â€™\râ€™)+{skip();};
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
è¿è¡ŒANTLR
å³é”®Demo.g4ï¼Œé€‰æ‹©Configure ANTLRï¼Œé…ç½®outputè·¯å¾„ã€‚</p>

<p>å³é”®Demo.g4ï¼Œé€‰æ‹©Generate ANTLR Recognizerã€‚å¯ä»¥çœ‹åˆ°ç”Ÿæˆç»“æœç»“æœã€‚
å…¶ä¸­Demo.tokensä¸ºæ–‡æ³•ä¸­ç”¨åˆ°çš„å„ç§ç¬¦å·åšäº†æ•°å­—åŒ–ç¼–å·ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å…³æ³¨è¿™ä¸ªæ–‡ä»¶ã€‚DemoLexeræ˜¯Antlrç”Ÿæˆçš„è¯æ³•åˆ†æå™¨ï¼ŒDemoParseræ˜¯Antlr ç”Ÿæˆçš„è¯­æ³•åˆ†æå™¨ã€‚</p>

<p>è°ƒç”¨åˆ†æå™¨ã€‚æ–°å»ºä¸€ä¸ªMain.javaã€‚
public static void run(String expr) throws Exception{</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    //å¯¹æ¯ä¸€ä¸ªè¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œæ„é€ ä¸€ä¸ª ANTLRStringStream æµ in
    ANTLRInputStream in = new ANTLRInputStream(expr);

    //ç”¨ in æ„é€ è¯æ³•åˆ†æå™¨ lexerï¼Œè¯æ³•åˆ†æçš„ä½œç”¨æ˜¯äº§ç”Ÿè®°å·
    DemoLexer lexer = new DemoLexer(in);

    //ç”¨è¯æ³•åˆ†æå™¨ lexer æ„é€ ä¸€ä¸ªè®°å·æµ tokens
    CommonTokenStream tokens = new CommonTokenStream(lexer);

    //å†ä½¿ç”¨ tokens æ„é€ è¯­æ³•åˆ†æå™¨ parser,è‡³æ­¤å·²ç»å®Œæˆè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æçš„å‡†å¤‡å·¥ä½œ
    DemoParser parser = new DemoParser(tokens);

    //æœ€ç»ˆè°ƒç”¨è¯­æ³•åˆ†æå™¨çš„è§„åˆ™ progï¼Œå®Œæˆå¯¹è¡¨è¾¾å¼çš„éªŒè¯
    parser.prog();
} 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 å®Œæ•´Main.javaä»£ç ï¼š
</code></pre></div></div>

<p>import org.antlr.v4.runtime.CommonTokenStream;
import org.antlr.v4.runtime.ANTLRInputStream;</p>

<p>public class Main {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static void run(String expr) throws Exception{

    //å¯¹æ¯ä¸€ä¸ªè¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œæ„é€ ä¸€ä¸ª ANTLRStringStream æµ in
    ANTLRInputStream in = new ANTLRInputStream(expr);

    //ç”¨ in æ„é€ è¯æ³•åˆ†æå™¨ lexerï¼Œè¯æ³•åˆ†æçš„ä½œç”¨æ˜¯äº§ç”Ÿè®°å·
    DemoLexer lexer = new DemoLexer(in);

    //ç”¨è¯æ³•åˆ†æå™¨ lexer æ„é€ ä¸€ä¸ªè®°å·æµ tokens
    CommonTokenStream tokens = new CommonTokenStream(lexer);

    //å†ä½¿ç”¨ tokens æ„é€ è¯­æ³•åˆ†æå™¨ parser,è‡³æ­¤å·²ç»å®Œæˆè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æçš„å‡†å¤‡å·¥ä½œ
    DemoParser parser = new DemoParser(tokens);

    //æœ€ç»ˆè°ƒç”¨è¯­æ³•åˆ†æå™¨çš„è§„åˆ™ progï¼Œå®Œæˆå¯¹è¡¨è¾¾å¼çš„éªŒè¯
    parser.prog();
}

public static void main(String[] args) throws Exception{

    String[] testStr={
            "2",
            "a+b+3",
            "(a-b)+3",
            "a+(b*3"
    };

    for (String s:testStr){
        System.out.println("Input expr:"+s);
        run(s);
    }
} } è¿è¡ŒMain.java å½“è¾“å…¥åˆæ³•çš„çš„è¡¨è¾¾å¼æ—¶ï¼Œåˆ†æå™¨æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œè¡¨ç¤ºè¯­è¨€è¢«åˆ†æå™¨æ¥å—ï¼›å½“è¾“å…¥çš„è¡¨è¾¾å¼è¿åæ–‡æ³•è§„åˆ™æ—¶ï¼Œæ¯”å¦‚â€œa + (b * 3â€ï¼Œåˆ†æå™¨è¾“å‡º line 0:-1 mismatched input â€˜â€™ expecting â€˜)â€™ï¼›æç¤ºæœŸå¾…ä¸€ä¸ªå³æ‹¬å·å´é‡åˆ°äº†ç»“æŸç¬¦å·ã€‚
</code></pre></div></div>

<p>æ–‡æ³•å¯è§†åŒ–
æ‰“å¼€Antlr Previewã€‚
åœ¨Demo.g4ä¸­é€‰ä¸­ä¸€ä¸ªè¯­æ³•å®šä¹‰ç¬¦å·ï¼Œå¦‚exprã€‚å³é”®é€‰ä¸­çš„ç¬¦åˆï¼Œé€‰æ‹©Text Rule exprã€‚</p>

<p>åœ¨ANTLR Previewä¸­é€‰æ‹©input,è¾“å…¥è¡¨è¾¾å¼ï¼Œå¦‚a+b*c+4/2ã€‚åˆ™èƒ½æ˜¾ç¤ºå‡ºå¯è§†åŒ–çš„æ–‡æ³•ã€‚
https://blog.csdn.net/sherrywong1220/article/details/53697737?utm_source=blogxgwz4</p>

<p>https://blog.csdn.net/qq_36616602/article/details/85858133</p>

<p>https://plugins.jetbrains.com/plugin/7358-antlr-v4-grammar-plugin%20
http://www.antlr.org/tools.html
Download:
https://plugins.jetbrains.com/plugin/7358-antlr-v4-grammar-plugin
æˆ–è€…ä»è¿™é‡Œhttp://www.antlr.org/tools.htmlè¿›å…¥ä¸‹è½½ã€‚</p>

<p>å‰æ
å®‰è£…å¥½</p>
<ul>
  <li>jdk</li>
  <li>IntelliJ</li>
</ul>

<p>é…ç½®å¥½ANTLRçš„javaè¿è¡Œæ—¶ç¯å¢ƒ(åº“)ã€‚å…·ä½“è§è¿™é‡Œ</p>

<p>æ’ä»¶å®‰è£…</p>

<p>Hello.g4ç¤ºä¾‹
åœ¨IntelliJä¸­æ–°å»ºjavaé¡¹ç›®ï¼ˆå³ä¸€ä¸ªModuleï¼‰ï¼Œå¹¶åˆ›å»ºgrammaræ–‡ä»¶Hello.g4 ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>

<p>//Define a grammar called Hello
grammar Hello;
r : â€˜helloâ€™ ID; // match keyword hello followed by an identifier
ID : [a-z]+; // match lower-case identifiers
WS : [ \t\r\n]+ -&gt; skip; // skip spaces, tabs, newlines</p>

<p>IntelliJ ä¸­çš„Projectç›¸å½“äºeclipseä¸­çš„workspaceï¼›
è€ŒIntelliJä¸­çš„Moduleç›¸å½“äºeclipseä¸­çš„projectã€‚
å› æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºé¡¹ç›®æ—¶åªéœ€åœ¨å½“å‰Projectä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„Moduleé¡¹ç›®ï¼ˆFile -&gt; New -&gt; Moduleï¼‰ã€‚</p>

<p>ç¼–è¾‘å¥½è¯¥.g4æ–‡ä»¶åå³å¯æµ‹è¯•è¯¥grammarè§„åˆ™ã€‚åœ¨rule â€œrâ€å¤„é€‰ä¸­â€œrâ€å¹¶å³å‡»é¼ æ ‡åï¼Œç‚¹å‡»â€œTest Rule râ€ï¼Œå¦‚ä¸‹å›¾ã€‚ç„¶ååœ¨å·¦ä¸‹æ–¹ä¾¿å¯ä»¥è¾“å…¥â€œhello nameâ€,åœ¨å³ä¸‹æ–¹æ¡†ä¸­ä¾¿ä¼šæ˜¾ç¤ºå¯¹åº”çš„Parse treeã€‚</p>

<p>Hello.g4çš„ANTLRä»£ç ç”Ÿæˆé…ç½®
æ³¨æ„ï¼šIntelliJä¸­çš„ANTLRæ’ä»¶æŒ‡å®šäº†antlrçš„è¿è¡Œæ—¶åº“çš„ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆæœ¬ï¼ˆæ­¤å¤„å³ä¸ºANTLR4 4.7ç‰ˆæœ¬ï¼‰</p>

<p>å³å‡»é¡¹ç›®ä¸­åˆšåˆšåˆ›å»ºçš„Hello.g4æ–‡ä»¶ï¼Œç‚¹å‡»â€œConfigure ANTLRâ€¦â€ï¼Œç„¶åä¾¿ä¼šå¼¹å‡ºå¦‚ä¸‹å›¾æ‰€ç¤ºçª—å£ã€‚</p>

<p>åœ¨è¯¥çª—å£ä¸­ä¾¿å¯ä»¥å¯¹ä»grammarè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ANTLR APIçš„javaä»£ç è¿›è¡Œé…ç½®ã€‚
å…¶ä¸­ï¼Œâ€œOutput directory where all output is generatedâ€è¡¨ç¤ºæŒ‡å®šéšåç”Ÿæˆçš„javaä»£ç æ‰€å­˜æ”¾çš„è·¯å¾„ã€‚
â€œgenerate parse tree vistorâ€è¡¨ç¤ºç”ŸæˆANTLRä¸­ç”¨äºéå†parse treeçš„visitorç±»ç›¸å…³APIã€‚(æˆ‘è¿™é‡Œå‹¾é€‰ä¸Šäº†ï¼Œä¸‡ä¸€è¦â€å®ç°â€äº†å‘¢^_^)</p>

<p>Hello.g4çš„ANTLRä»£ç ç”Ÿæˆ
å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨é¡¹ç›®ä¸­é€‰ä¸­Hello.g4æ–‡ä»¶å¹¶å³å‡»é€‰æ‹©â€œGenerate ANTLR Recognizerâ€ã€‚éšåä¾¿ä¼šåœ¨appç›®å½•ä¸‹çœ‹åˆ°ç”Ÿæˆçš„å„ç§.java æ–‡ä»¶ç­‰ã€‚(ä¸Šä¸€æ­¥é…ç½®ä¸­æˆ‘ä»¬è®¾ç½®äº†ä»£ç ç”Ÿæˆçš„ç›®æ ‡è·¯å¾„ä¸ºappç›®å½•)</p>

<p>ç”Ÿæˆäº†è¿™äº›APIåï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è°ƒç”¨APIå®ç°ç›¸åº”çš„åŠŸèƒ½äº†ã€‚
https://www.cnblogs.com/wynjauu/articles/9873231.html
https://www.pw88.com/teach/python/495.html
https://stackoverflow.com/questions/23568467/how-to-configure-antlr4-plugin-for-intellij-idea
https://www.jianshu.com/p/21f2afca65e8</p>

:ET