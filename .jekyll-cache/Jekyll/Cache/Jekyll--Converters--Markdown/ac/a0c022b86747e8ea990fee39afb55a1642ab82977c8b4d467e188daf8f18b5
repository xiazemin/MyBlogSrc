I"é5<p>è¿›å…¥Dockerå®¹å™¨æ¯”è¾ƒå¸¸è§çš„å‡ ç§åšæ³•å¦‚ä¸‹ï¼š</p>

<p>ä½¿ç”¨docker attach
ä½¿ç”¨SSH
ä½¿ç”¨nsenter
ä½¿ç”¨exec
<!-- more -->
ä¸€ã€ä½¿ç”¨docker attachè¿›å…¥Dockerå®¹å™¨
Dockeræä¾›äº†attachå‘½ä»¤æ¥è¿›å…¥Dockerå®¹å™¨ã€‚
æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®ˆæŠ¤æ€çš„Dockerå®¹å™¨ï¼Œç„¶åä½¿ç”¨docker attachå‘½ä»¤è¿›å…¥è¯¥å®¹å™¨ã€‚</p>

<p>$ sudo docker run -itd ubuntu:14.04 /bin/bash</p>

<p>ç„¶åæˆ‘ä»¬ä½¿ç”¨docker psæŸ¥çœ‹åˆ°è¯¥å®¹å™¨ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥å°±ä½¿ç”¨docker attachè¿›å…¥è¯¥å®¹å™¨</p>

<p>$ sudo docker attach 44fc0f0582d9
å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»è¿›å…¥åˆ°è¯¥å®¹å™¨ä¸­äº†ã€‚
ä½†åœ¨ï¼Œä½¿ç”¨è¯¥å‘½ä»¤æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å½“å¤šä¸ªçª—å£åŒæ—¶ä½¿ç”¨è¯¥å‘½ä»¤è¿›å…¥è¯¥å®¹å™¨æ—¶ï¼Œæ‰€æœ‰çš„çª—å£éƒ½ä¼šåŒæ­¥æ˜¾ç¤ºã€‚å¦‚æœæœ‰ä¸€ä¸ªçª—å£é˜»å¡äº†ï¼Œé‚£ä¹ˆå…¶ä»–çª—å£ä¹Ÿæ— æ³•å†è¿›è¡Œæ“ä½œã€‚ä¸‹æ¥æˆ‘ä»¬æ¥æ¼”ç¤ºä¸€ä¸‹ã€‚æ‰“å¼€ä¸¤ä¸ªçª—å£ï¼Œéƒ½ä½¿ç”¨attachå‘½ä»¤è¿›å…¥åŒä¸€ä¸ªå®¹å™¨é‡Œé¢ã€‚</p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬åªåœ¨ç¬¬ä¸€ä¸ªçª—å£è¿›è¡Œæ“ä½œï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªçª—å£çš„æ“ä½œåŒæ­¥åˆ°ç¬¬äºŒä¸ªçª—å£æ˜¾ç¤ºäº†</p>

<p>å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæ‰€ä»¥docker attachå‘½ä»¤ä¸å¤ªé€‚åˆäºç”Ÿäº§ç¯å¢ƒï¼Œå¹³æ—¶è‡ªå·±å¼€å‘åº”ç”¨æ—¶å¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤ã€‚</p>

<p>äºŒã€ä½¿ç”¨SSHè¿›å…¥Dockerå®¹å™¨
åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ’é™¤äº†ä½¿ç”¨docker attachå‘½ä»¤è¿›å…¥å®¹å™¨ä¹‹åï¼Œç›¸ä¿¡å¤§å®¶ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯sshã€‚åœ¨é•œåƒï¼ˆæˆ–å®¹å™¨ï¼‰ä¸­å®‰è£…SSH Serverï¼Œè¿™æ ·å°±èƒ½ä¿è¯å¤šäººè¿›å…¥å®¹å™¨ä¸”ç›¸äº’ä¹‹é—´ä¸å—å¹²æ‰°äº†ï¼Œç›¸ä¿¡å¤§å®¶åœ¨å½“å‰çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼ˆæ²¡æœ‰ä½¿ç”¨Dockerçš„æƒ…å†µï¼‰ä¹Ÿæ˜¯è¿™æ ·åšçš„ã€‚ä½†æ˜¯ä½¿ç”¨äº†Dockerå®¹å™¨ä¹‹åä¸å»ºè®®ä½¿ç”¨sshè¿›å…¥åˆ°Dockerå®¹å™¨å†…</p>

<p>ä¸‰ã€ä½¿ç”¨nsenterè¿›å…¥Dockerå®¹å™¨
åœ¨ä¸Šé¢ä¸¤ç§æ–¹å¼éƒ½ä¸é€‚åˆçš„æƒ…å†µä¸‹ï¼Œè¿˜æœ‰ä¸€ç§æ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•ï¼Œå³ä½¿ç”¨nsenterè¿›å…¥Dockerå®¹å™¨ã€‚
https://github.com/jpetazzo/nsenter</p>

<p>nsenteræ˜¯ä¸€ä¸ªå°çš„å·¥å…·ï¼Œç”¨æ¥è¿›å…¥å‘½åç©ºé—´ä¸­ã€‚æŠ€æœ¯ä¸Šï¼Œå®ƒå¯ä»¥è¿›å…¥ç°æœ‰çš„å‘½åç©ºé—´ï¼Œæˆ–è€…äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹è¿›å…¥æ–°çš„ä¸€ç»„å‘½åç©ºé—´ã€‚â€œå‘½åç©ºé—´æ˜¯ä»€ä¹ˆ?â€ä»–ä»¬æ˜¯å®¹å™¨çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ç®€å•ç‚¹è¯´ï¼šé€šè¿‡ä½¿ç”¨ nsenter ï¼Œä½ å¯ä»¥è¿›å…¥ä¸€ä¸ªå·²ç»å­˜åœ¨çš„containerä¸­ï¼Œå°½ç®¡è¿™ä¸ªcontaineræ²¡æœ‰è¿è¡Œssh æˆ–è€…ä»»æ„ç‰¹æ®Šç”¨é€”çš„å®ˆæŠ¤è¿›ç¨‹ã€‚</p>

<p>åœ¨äº†è§£äº†ä»€ä¹ˆæ˜¯nsenterä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æŠŠnsenterå®‰è£…åˆ°ä¸»æœºä¸­ï¼ˆæ³¨æ„æ˜¯ä¸»æœºè€Œéå®¹å™¨æˆ–é•œåƒï¼‰ï¼Œå…·ä½“çš„å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<p>$ wget https://www.kernel.org/pub/linux/utils/util-linux/v2.24/util-linux-2.24.tar.gz
$ tar -xzvf util-linux-2.24.tar.gz
$ cd util-linux-2.24/
$ ./configure â€“without-ncurses
$ make nsenter
$ sudo cp nsenter /usr/local/bin
å®‰è£…å¥½nsenterä¹‹åå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹è¯¥å‘½ä»¤çš„ä½¿ç”¨ã€‚
nsenterå¯ä»¥è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹çš„åç§°ç©ºé—´ã€‚æ‰€ä»¥ä¸ºäº†è¿æ¥åˆ°æŸä¸ªå®¹å™¨æˆ‘ä»¬è¿˜éœ€è¦è·å–è¯¥å®¹å™¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹çš„PIDã€‚å¯ä»¥ä½¿ç”¨docker inspectå‘½ä»¤æ¥æ‹¿åˆ°è¯¥PIDã€‚</p>

<p>docker inspectå‘½ä»¤ä½¿ç”¨å¦‚ä¸‹ï¼š
$ sudo docker inspect â€“help</p>

<p>inspectå‘½ä»¤å¯ä»¥åˆ†å±‚çº§æ˜¾ç¤ºä¸€ä¸ªé•œåƒæˆ–å®¹å™¨çš„ä¿¡æ¯ã€‚æ¯”å¦‚æˆ‘ä»¬å½“å‰æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨
å¯ä»¥ä½¿ç”¨docker inspectæ¥æŸ¥çœ‹è¯¥å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>

<p>$ sudo docker inspect 44fc0f0582d9</p>

<p>å¦‚æœè¦æ˜¾ç¤ºè¯¥å®¹å™¨ç¬¬ä¸€ä¸ªè¿›è¡Œçš„PIDå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼
$ sudo docker inspect -f {{.State.Pid}} 44fc0f0582d9</p>

<p>åœ¨æ‹¿åˆ°è¯¥è¿›ç¨‹PIDä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨nsenterå‘½ä»¤è®¿é—®è¯¥å®¹å™¨äº†ã€‚</p>

<p>$ sudo nsenter â€“target 3326 â€“mount â€“uts â€“ipc â€“net â€“pid
å…¶ä¸­çš„3326å³åˆšæ‰æ‹¿åˆ°çš„è¿›ç¨‹çš„PID</p>

<p>å½“ç„¶ï¼Œå¦‚æœä½ è®¤ä¸ºæ¯æ¬¡éƒ½è¾“å…¥é‚£ä¹ˆå¤šå‚æ•°å¤ªéº»çƒ¦çš„è¯ï¼Œç½‘ä¸Šä¹Ÿæœ‰è®¸å¤šåšå¥½çš„è„šæœ¬ä¾›å¤§å®¶ä½¿ç”¨ã€‚</p>

<p>https://yeasy.gitbooks.io/docker_practice/content/</p>

<p>åœ¨å¤§å¤šæ•°Linuxå‘è¡Œç‰ˆä¸­ï¼Œutil-linuxåŒ…ä¸­å«æœ‰nsenter.å¦‚æœæ²¡æœ‰ï¼Œä½ éœ€è¦å®‰è£…å®ƒ.</p>

<p>cd /tmp
curl https://www.kernel.org/pub/linux/utils/util-linux/v2.24/util-linux-2.24.tar.gz <br />
	| tar -zxf-
cd util-linux-2.24
./configure â€“without-ncurses
make nsenter
cp nsenter /usr/local/bin
ä½¿ç”¨shellè„šæœ¬ docker-enterï¼Œå°†å¦‚ä¸‹ä»£ç ä¿å­˜ä¸ºdocker-enter, chomod +x docker-enter</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/sh

if [ -e $(dirname "$0")/nsenter ]; then
	# with boot2docker, nsenter is not in the PATH but it is in the same folder
	NSENTER=$(dirname "$0")/nsenter
else
	NSENTER=nsenter
fi

if [ -z "$1" ]; then
	echo "Usage: `basename "$0"` CONTAINER [COMMAND [ARG]...]"
	echo ""
	echo "Enters the Docker CONTAINER and executes the specified COMMAND."
	echo "If COMMAND is not specified, runs an interactive shell in CONTAINER."
else
	PID=$(docker inspect --format "\{\{.State.Pid\}\}" "$1")
	if [ -z "$PID" ]; then
		exit 1
	fi
	shift

	OPTS="--target $PID --mount --uts --ipc --net --pid --"

	if [ -z "$1" ]; then
		# No command given.
		# Use su to clear all host environment variables except for TERM,
		# initialize the environment variables HOME, SHELL, USER, LOGNAME, PATH,
		# and start a login shell.
		"$NSENTER" $OPTS su - root
	else
		# Use env to clear all host environment variables.
		"$NSENTER" $OPTS env --ignore-environment -- "$@"
	fi
fi è¿è¡Œ docker-enter &lt;container id&gt; ï¼Œè¿™æ ·å°±è¿›å…¥åˆ°æŒ‡å®šçš„å®¹å™¨ä¸­
</code></pre></div></div>

<p>å››ã€ä½¿ç”¨docker execè¿›å…¥Dockerå®¹å™¨
é™¤äº†ä¸Šé¢å‡ ç§åšæ³•ä¹‹å¤–ï¼Œdockeråœ¨1.3.Xç‰ˆæœ¬ä¹‹åè¿˜æä¾›äº†ä¸€ä¸ªæ–°çš„å‘½ä»¤execç”¨äºè¿›å…¥å®¹å™¨ï¼Œè¿™ç§æ–¹å¼ç›¸å¯¹æ›´ç®€å•ä¸€äº›ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯¥å‘½ä»¤çš„ä½¿ç”¨ï¼š
$ sudo docker exec â€“help
æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨è¯¥å‘½ä»¤è¿›å…¥ä¸€ä¸ªå·²ç»åœ¨è¿è¡Œçš„å®¹å™¨
$ sudo docker ps
$ sudo docker exec -it 775c7c9ee1e1 /bin/bash</p>

<p>ç½‘ä¸Šè¿˜æœ‰ä¸€ç§åšæ³•æ˜¯ä½¿ç”¨nsinit</p>

<p>https://www.oschina.net/translate/why-you-dont-need-to-run-sshd-in-docker?cmp</p>

<p>docker run -t -i ubuntu /bin/bash
å®˜ç½‘æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p>

<p>docker run: runs a container.
ubuntu: is the image you would like to run.
-t: flag assigns a pseudo-tty or terminal inside the new container.
-i: flag allows you to make an interactive connection by grabbing the standard in (STDIN) of the container.
/bin/bash: launches a Bash shell inside our container.
ç†è§£å¾ˆç®€å•ï¼š</p>

<p>docker runï¼šå¯åŠ¨container</p>

<p>ubuntuï¼šä½ æƒ³è¦å¯åŠ¨çš„image</p>

<p>-tï¼šè¿›å…¥ç»ˆç«¯</p>

<p>-iï¼šè·å¾—ä¸€ä¸ªäº¤äº’å¼çš„è¿æ¥ï¼Œé€šè¿‡è·å–containerçš„è¾“å…¥</p>

<p>/bin/bashï¼šåœ¨containerä¸­å¯åŠ¨ä¸€ä¸ªbash shell</p>

<p>è¿›å…¥containerï¼ˆå®¹å™¨ï¼‰
4.1 ä½¿ç”¨â€œdocker attachâ€å‘½ä»¤è¿›å…¥
è¿™ä¸ªæ—¶å€™containerè¿è¡Œåœ¨åå°ï¼Œå¦‚æœæƒ³è¿›å…¥å®ƒçš„ç»ˆç«¯ï¼Œåˆ™ï¼š</p>

<p>docker attach goofy_almeida
å°±å¯ä»¥äº†ã€‚</p>

<p>4.2 ä½¿ç”¨â€œdocker exec -itâ€å‘½ä»¤è¿›å…¥
ä½¿ç”¨â€œdocker attachâ€å‘½ä»¤è¿›å…¥containerï¼ˆå®¹å™¨ï¼‰æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œé‚£å°±æ˜¯æ¯æ¬¡ä»containerä¸­é€€å‡ºåˆ°å‰å°æ—¶ï¼Œcontainerä¹Ÿè·Ÿç€é€€å‡ºäº†ã€‚</p>

<p>è¦æƒ³é€€å‡ºcontaineræ—¶ï¼Œè®©containerä»ç„¶åœ¨åå°è¿è¡Œç€ï¼Œå¯ä»¥ä½¿ç”¨â€œdocker exec -itâ€å‘½ä»¤ã€‚æ¯æ¬¡ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¿›å…¥containerï¼Œå½“é€€å‡ºcontaineråï¼Œcontainerä»ç„¶åœ¨åå°è¿è¡Œï¼Œå‘½ä»¤ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<p>docker exec -it goofy_almeida /bin/bash
goofy_almeidaï¼šè¦å¯åŠ¨çš„containerçš„åç§°
/bin/bashï¼šåœ¨containerä¸­å¯åŠ¨ä¸€ä¸ªbash shell
è¿™æ ·è¾“å…¥â€œexitâ€æˆ–è€…æŒ‰é”®â€œCtrl + Câ€é€€å‡ºcontaineræ—¶ï¼Œè¿™ä¸ªcontainerä»ç„¶åœ¨åå°è¿è¡Œï¼Œé€šè¿‡ï¼š
docker ps
å°±å¯ä»¥æŸ¥æ‰¾åˆ°ã€‚
5 é€€å‡ºcontainer
è¾“å…¥ï¼š
exit
æˆ–è€…æŒ‰é”®ï¼š</p>

<p>Ctrl + D</p>

<p>æˆ‘ä»¬ç»å¸¸éœ€è¦è¿›åˆ°å®¹å™¨é‡Œå»åšä¸€äº›å·¥ä½œï¼Œæ¯”å¦‚æŸ¥çœ‹æ—¥å¿—ã€è°ƒè¯•ã€å¯åŠ¨å…¶ä»–è¿›ç¨‹ç­‰ã€‚æœ‰ä¸¤ç§æ–¹æ³•è¿›å…¥å®¹å™¨ï¼šattach å’Œ execã€‚</p>

<p>docker attach
é€šè¿‡ docker attach å¯ä»¥ attach åˆ°å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯ï¼Œä¾‹å¦‚ï¼š</p>

<p>è¿™æ¬¡æˆ‘ä»¬é€šè¿‡ â€œé•¿IDâ€ attach åˆ°äº†å®¹å™¨çš„å¯åŠ¨å‘½ä»¤ç»ˆç«¯ï¼Œä¹‹åçœ‹åˆ°çš„æ˜¯echo æ¯éš”ä¸€ç§’æ‰“å°çš„ä¿¡æ¯ã€‚</p>

<p>æ³¨ï¼šå¯é€šè¿‡ Ctrl+p ç„¶å Ctrl+q ç»„åˆé”®é€€å‡º attach ç»ˆç«¯ã€‚</p>

<p>docker exec
é€šè¿‡ docker exec è¿›å…¥ç›¸åŒçš„å®¹å™¨ï¼š</p>

<p>è¯´æ˜å¦‚ä¸‹ï¼š</p>

<p>â‘  -it ä»¥äº¤äº’æ¨¡å¼æ‰“å¼€ pseudo-TTYï¼Œæ‰§è¡Œ bashï¼Œå…¶ç»“æœå°±æ˜¯æ‰“å¼€äº†ä¸€ä¸ª bash ç»ˆç«¯ã€‚</p>

<p>â‘¡ è¿›å…¥åˆ°å®¹å™¨ä¸­ï¼Œå®¹å™¨çš„ hostname å°±æ˜¯å…¶ â€œçŸ­IDâ€ã€‚</p>

<p>â‘¢ å¯ä»¥åƒåœ¨æ™®é€š Linux ä¸­ä¸€æ ·æ‰§è¡Œå‘½ä»¤ã€‚ps -elf æ˜¾ç¤ºäº†å®¹å™¨å¯åŠ¨è¿›ç¨‹while ä»¥åŠå½“å‰çš„ bash è¿›ç¨‹ã€‚</p>

<p>â‘£ æ‰§è¡Œ exit é€€å‡ºå®¹å™¨ï¼Œå›åˆ° docker hostã€‚</p>

<p>docker exec -it <container> bash|sh æ˜¯æ‰§è¡Œ exec æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚</container></p>

<p>attach VS exec
attach ä¸ exec ä¸»è¦åŒºåˆ«å¦‚ä¸‹:</p>

<p>attach ç›´æ¥è¿›å…¥å®¹å™¨ å¯åŠ¨å‘½ä»¤ çš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚</p>

<p>exec åˆ™æ˜¯åœ¨å®¹å™¨ä¸­æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œå¹¶ä¸”å¯ä»¥å¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚</p>

<p>å¦‚æœæƒ³ç›´æ¥åœ¨ç»ˆç«¯ä¸­æŸ¥çœ‹å¯åŠ¨å‘½ä»¤çš„è¾“å‡ºï¼Œç”¨ attachï¼›å…¶ä»–æƒ…å†µä½¿ç”¨ execã€‚</p>

<p>å½“ç„¶ï¼Œå¦‚æœåªæ˜¯ä¸ºäº†æŸ¥çœ‹å¯åŠ¨å‘½ä»¤çš„è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨ docker logs å‘½ä»¤ï¼š</p>

<p>nsenter
ä»util-linuxç‰ˆæœ¬2.23å¼€å§‹ï¼Œnsenterå·¥å…·å°±åŒ…å«åœ¨å…¶ä¸­ã€‚å®ƒç”¨æ¥è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹çš„åå­—ç©ºé—´ã€‚nsenterè¦æ­£å¸¸å·¥ä½œéœ€è¦æœ‰rootæƒé™ã€‚å¾ˆä¸å¹¸ï¼ŒUbuntu 14.4ä»ç„¶ä½¿ç”¨çš„æ˜¯util-linuxç‰ˆæœ¬2.20ã€‚å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„util-linuxï¼ˆ2.24)ç‰ˆï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š</p>

<p>cd /tmp
curl https://www.kernel.org/pub/linux/utils/util-linux/v2.24/util-linux-2.24.tar.gz | tar -zxf-cd util-linux-2.24./configure â€“without-ncursesmake nsentercp nsenter /usr/local/bin
ä¸ºäº†è¿æ¥åˆ°å®¹å™¨ï¼Œä½ è¿˜éœ€è¦æ‰¾åˆ°å®¹å™¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹çš„PIDã€‚</p>

<p>docker inspect â€“format â€œ{{ .State.Pid }}â€ <container-id>
é€šè¿‡è¿™ä¸ªPIDï¼Œä½ å°±å¯ä»¥è¿æ¥åˆ°è¿™ä¸ªå®¹å™¨ï¼š</container-id></p>

<p>nsenter â€“target $PID â€“mount â€“uts â€“ipc â€“net â€“pid
nsinit
ä»0.9ç‰ˆæœ¬å¼€å§‹ï¼ŒDockerè‡ªèº«å°±å…·æœ‰ä¸€ä¸ªç®¡ç†å®¹å™¨çš„åº“ï¼Œåå­—ä¸º libcontainerã€‚libcontainerä¸­çš„nsinitå·¥å…·å…è®¸ç”¨æˆ·ç›´æ¥è®¿é—®linuxåå­—ç©ºé—´å’Œcgroupå†…æ ¸ã€‚åœ¨å®‰è£…nsinitä¹‹å‰ï¼Œä½ é¦–å…ˆéœ€è¦å®‰è£…Goè¿è¡Œæ—¶ç¯å¢ƒï¼š
apt-get install git golang-go
 mkdir -p $HOME/go-dev/binmkdir -p $HOME/go-dev/src
 echo â€œexport GOPATH=$HOME/go-devâ€Â Â» ~/.profileecho â€œPATH=$PATH:$GOPATH/binâ€Â Â» ~/.profile
 source ~/.profile
æ¥ä¸‹æ¥æ‰å®‰è£…nsinit:</p>

<p>mkdir -p $GOPATH/src/github.com/dotcloudcd $GOPATH/src/github.com/dotcloud
 git clone https://github.com/dotcloud/docker.gitcd $GOPATH/src/github.com/dotcloud/docker
 /usr/bin/go get -v github.com/dotcloud/docker/vendor/src/github.com/docker/libcontainer/nsinit
nsinitè¯»å–çš„æ˜¯ä½äº/var/lib/docer/execdriver/native/<container-id>å®¹å™¨ç›®å½•ä¸‹çš„é…ç½®æ•°æ®ã€‚è¦è¿è¡Œnsinitï¼Œä½ éœ€è¦åˆ‡æ¢åˆ°å®¹å™¨ç›®å½•ä¸‹ã€‚ç”±äº/var/lib/dockerç›®å½•å¯¹äºrootç”¨æˆ·æ˜¯åªè¯»æƒé™ï¼Œå› æ­¤ä½ è¿˜éœ€è¦rootæƒé™ã€‚é€šè¿‡dockerçš„pså‘½ä»¤ï¼Œä½ å¯ä»¥ç¡®å®šå®¹å™¨IDã€‚ä¸€æ—¦ä½ è¿›å…¥/var/lib/dockerç›®å½•ï¼Œä½ å°±å¯ä»¥è¿æ¥å®¹å™¨äº†ï¼š</container-id></p>

<p>nsinit exec /bin/bash
lxc(-attach)
ç›´åˆ°Docker 0.8.1ç‰ˆæœ¬ä¸ºæ­¢ï¼ŒLXCä¸€ç›´æ˜¯ç®¡ç†å®¹å™¨çš„åŸºæœ¬å·¥å…·ï¼ŒDockerä¸€ç›´æ”¯æŒè¿™ä¸ªå·¥å…·ã€‚ä½†æ˜¯ä»0.9.0ç‰ˆæœ¬å¼€å§‹ï¼ŒDockeré»˜è®¤ä½¿ç”¨libcontainerç®¡ç†å®¹å™¨ï¼Œä¸å†ä¾èµ–LXCäº†ã€‚å› æ­¤é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ ä¸èƒ½ä½¿ç”¨lxc-attachäº†ã€‚</p>

<p>å¦‚æœä½ ä»ç„¶å¸Œæœ›ä½¿ç”¨lxc-attachï¼Œé‚£ä¹ˆä½ éœ€è¦ä½¿ç”¨-e lxcé€‰é¡¹æ¥é‡æ–°å¯åŠ¨DockeræœåŠ¡è¿›ç¨‹ã€‚ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼ŒDockerçš„å†…éƒ¨å°†å†æ¬¡ä½¿ç”¨LXCç®¡ç†å®¹å™¨äº†ã€‚å®Œæˆè¿™ä¸ªä»»åŠ¡æœ€ç®€å•çš„åšæ³•å°±æ˜¯åˆ›å»º/etc/default/dockeræ–‡ä»¶ï¼ˆå¦‚æœè¿™ä¸ªæ–‡ä»¶ä»ç„¶ä¸å­˜åœ¨ï¼‰ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>

<p>DOCKER_OPTS=â€ -e lxcâ€</p>

<p>ç°åœ¨ä½ å¯ä»¥é‡æ–°å¯åŠ¨DockeræœåŠ¡äº†ã€‚è¦è¿æ¥å®¹å™¨ï¼Œä½ éœ€è¦çŸ¥é“å®Œæ•´çš„å®¹å™¨ID:</p>

<p>docker ps â€“no-trunc
æ¥ä¸‹æ¥ï¼Œä½ å°±å¯ä»¥è¿æ¥è¿™ä¸ªå®¹å™¨äº†ã€‚è¦å®Œæˆä¸‹é¢å·¥ä½œï¼Œä½ è¿˜éœ€è¦rootæƒé™ï¼š</p>

<p>lxc-attach -n <container-id> -- /bin/bash
sshd
ä¸Šé¢æ‰€æœ‰ä¸‰ç§æ–¹æ³•éƒ½è¦æ±‚å…·æœ‰ä¸»æœºç³»ç»Ÿçš„rootæƒé™ã€‚ä¸ºäº†ä¸é‡‡ç”¨rootæƒé™ï¼Œé€šè¿‡sshè®¿é—®å®¹å™¨å°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</container-id></p>

<p>è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦æ„å»ºä¸€ä¸ªæ”¯æŒSSHæœåŠ¡çš„åŸºç¡€æ˜ åƒã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼šæˆ‘ä»¬æ˜¯ä¸æ˜¯ç”¨Docker CMDæˆ–è€…ENTRYPOINTè¿è¡Œä¸€æ¡å‘½ä»¤å°±å¯ä»¥äº†ï¼Ÿå¦‚æœæ­¤æ—¶æœ‰sshdè¿›ç¨‹è¿è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸è¦å†è¿è¡Œå…¶ä»–è¿›ç¨‹äº†ã€‚æ¥ä¸‹æ¥çš„å·¥ä½œæ˜¯åˆ›å»ºä¸€ä¸ªè„šæœ¬æˆ–è€…ä½¿ç”¨åƒsupervisordè¿™æ ·çš„è¿›ç¨‹ç®¡ç†å·¥å…·æ¥å¯åŠ¨å…¶å®ƒæ‰€æœ‰éœ€è¦å¯åŠ¨çš„è¿›ç¨‹ã€‚æœ‰å…³å¦‚ä½•ä½¿ç”¨supervisordçš„ ä¼˜ç§€çš„æ–‡æ¡£å¯ä»¥åœ¨Dockerçš„webç«™ç‚¹ä¸Šæ‰¾åˆ°ã€‚ä¸€æ—¦ä½ å¯åŠ¨äº†å…·æœ‰sshdè¿›ç¨‹çš„å®¹å™¨ï¼Œä½ å°±å¯ä»¥åƒä»¥å¾€ä¸€æ ·é€šè¿‡sshå®¢æˆ·ç«¯äº†è¿æ¥è¿™ä¸ªå®¹å™¨äº†ã€‚</p>

<p>ç»“è®º
sshdæ–¹æ³•å¯èƒ½æ˜¯æœ€ç®€å•çš„è¿æ¥å®¹å™¨çš„æ–¹æ³•ï¼Œè€Œä¸”å¤§å¤šæ•°ç”¨æˆ·ä¹ æƒ¯é€šè¿‡sshè¿æ¥è™šæ‹Ÿæœºã€‚å¦å¤–ï¼Œè¿æ¥å®¹å™¨æ—¶ä½ ä¹Ÿä¸éœ€è¦ä¸€å®šä½¿ç”¨rootæƒé™ã€‚ä¸è¿‡ï¼Œå¯¹äºæ˜¯å¦ä¸€ä¸ªå®¹å™¨æ˜¯å¦åº”å½“ç®¡ç†ä¸æ­¢ä¸€ä¸ªè¿›ç¨‹ä»ç„¶å­˜åœ¨è®¸å¤šäº‰è®®ã€‚è¿™ç§æ–¹æ³•æœ€ç»ˆä½¿å¾—æ¯ä¸ªå®¹å™¨äº†å¤šäº†ä¸€ä¸ªsshdè¿›ç¨‹ï¼Œè¿™ä»æ ¹æœ¬ä¸Šæ¥è¯´ä¸æ˜¯è¿›ç¨‹è™šæ‹ŸåŒ–çš„æ‰€æå€¡çš„ã€‚</p>

<p>å¦å¤–ä¸‰ç§æ–¹æ³•éƒ½éœ€è¦rootæƒé™ã€‚åˆ°0.8.1ç‰ˆæœ¬ä¸ºæ­¢ï¼ŒDockeréƒ½æ˜¯ä½¿ç”¨LXCæ¥ç®¡ç†å®¹å™¨çš„ã€‚æ­£æ˜¯ç”±äºè¿™ä¸ªåŸå› ï¼Œä½¿ç”¨lxc-attachè¿æ¥å®¹å™¨å°±éå¸¸å®¹æ˜“ã€‚ä¸è¿‡ä»ç‰ˆæœ¬0.9.0å¼€å§‹DockeræœåŠ¡å°±å¿…é¡»ä½¿ç”¨ -e lxcé€‰é¡¹å¯åŠ¨æ‰èƒ½åœ¨å†…éƒ¨æ”¯æŒLXCç®¡ç†å®¹å™¨ã€‚ä¸è¿‡ï¼Œç”±äºè®¾ç½®äº†è¿™ä¸ªé€‰é¡¹ï¼ŒDockerå°†å†æ¬¡ä¾èµ–LXCï¼Œè€ŒLXCå¯èƒ½éšç€å‘å¸ƒæˆ–è€…å®‰è£…çš„ä¸åŒå¯èƒ½è¢«å‰”é™¤ã€‚</p>

<p>nsenterå’Œnsinitæ€»çš„æ¥è¯´æ˜¯ç›¸åŒçš„ã€‚è¿™ä¸¤ä¸ªå·¥å…·çš„ä¸»è¦åŒºåˆ«æ˜¯nsinitåœ¨æœ¬èº«çš„å®¹å™¨äº†å»ºç«‹äº†ä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œè€Œnsenteråªæ˜¯è®¿é—®äº†åå­—ç©ºé—´ã€‚Jerome Petazzoniåœ¨Dockeråšå®¢æ–‡ç« é‡Œå¯¹è¿™ä¸€ç‚¹è¯´çš„å¾ˆé€å½»ã€‚
https://github.com/docker/libcontainer/blob/master/README.md#nsinit</p>

:ET