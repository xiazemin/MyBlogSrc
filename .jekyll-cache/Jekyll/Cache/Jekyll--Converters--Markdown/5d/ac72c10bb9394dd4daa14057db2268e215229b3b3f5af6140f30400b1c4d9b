I"ï;<!-- more -->
<p>outputé…ç½®ä¸­elasticsearché…ç½®
action
index ç»™ä¸€ä¸ªæ–‡æ¡£å»ºç«‹ç´¢å¼•
delete é€šè¿‡idå€¼åˆ é™¤ä¸€ä¸ªæ–‡æ¡£ï¼ˆè¿™ä¸ªactionéœ€è¦æŒ‡å®šä¸€ä¸ªidå€¼ï¼‰
create æ’å…¥ä¸€æ¡æ–‡æ¡£ä¿¡æ¯ï¼Œå¦‚æœè¿™æ¡æ–‡æ¡£ä¿¡æ¯åœ¨ç´¢å¼•ä¸­å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆæœ¬æ¬¡æ’å…¥å·¥ä½œå¤±è´¥
update é€šè¿‡idå€¼æ›´æ–°ä¸€ä¸ªæ–‡æ¡£ã€‚æ›´æ–°æœ‰ä¸ªç‰¹æ®Šçš„æ¡ˆä¾‹upsertï¼Œå¦‚æœè¢«æ›´æ–°çš„æ–‡æ¡£è¿˜ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¼šç”¨åˆ°upsert
ç¤ºä¾‹ï¼š</p>

<p>action =&gt; â€œindexâ€</p>

<p>index
å†™å…¥äº‹ä»¶æ‰€ç”¨çš„ç´¢å¼•ã€‚å¯ä»¥åŠ¨æ€çš„ä½¿ç”¨%{foo}è¯­æ³•ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯ï¼š 
â€œlogstash-%{+YYYY.MM.dd}â€ï¼Œä»¥å¤©ä¸ºå•ä½åˆ†å‰²çš„ç´¢å¼•ï¼Œä½¿ä½ å¯ä»¥å¾ˆå®¹æ˜“çš„åˆ é™¤è€çš„æ•°æ®æˆ–è€…æœç´¢æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ•°æ®ã€‚</p>

<p>ç´¢å¼•ä¸èƒ½åŒ…å«å¤§å†™å­—æ¯ã€‚æ¨èä½¿ç”¨ä»¥å‘¨ä¸ºç´¢å¼•çš„ISO 8601æ ¼å¼ï¼Œä¾‹å¦‚logstash-%{+xxxx.ww}</p>

<p>ç¤ºä¾‹ï¼š</p>

<p>index =&gt; â€œtomcat_logs_index_%{+YYYY.MM.dd}â€</p>

<p>hosts
æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹çš„å€¼</p>

<p>æ„httpåè®®ä½¿ç”¨çš„æ˜¯httpåœ°å€ï¼Œç«¯å£æ˜¯9200ï¼Œç¤ºä¾‹ï¼š</p>

<p>hosts =&gt; [â€œ192.168.102.209:9200â€, â€œ192.168.102.216:9200â€]</p>

<p>document_type
å®šä¹‰esç´¢å¼•çš„typeï¼Œä¸€èˆ¬ä½ åº”è¯¥è®©åŒä¸€ç§ç±»å‹çš„æ—¥å¿—å­˜åˆ°åŒä¸€ç§typeä¸­ï¼Œæ¯”å¦‚debugæ—¥å¿—å’Œerroræ—¥å¿—å­˜åˆ°ä¸åŒçš„typeä¸­</p>

<p>å¦‚æœä¸è®¾ç½®é»˜è®¤typeä¸ºlogs</p>

<p>template
å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥è®¾ç½®æŒ‡å‘ä½ è‡ªå·±æ¨¡æ¿çš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆé»˜è®¤çš„æ¨¡æ¿ä¼šè¢«ä½¿ç”¨</p>

<p>template_name
è¿™ä¸ªé…ç½®é¡¹ç”¨æ¥å®šä¹‰åœ¨Elasticsearchä¸­æ¨¡æ¿çš„å‘½å</p>

<p>æ³¨æ„åˆ é™¤æ—§çš„æ¨¡æ¿</p>

<p>curl -XDELETE <a href="http://localhost:9200/_template/OldTemplateName?pretty">http://localhost:9200/_template/OldTemplateName?pretty</a></p>

<p>template_overwrite
å¸ƒå°”ç±»å‹ é»˜è®¤ä¸ºfalse 
è®¾ç½®ä¸ºtrueè¡¨ç¤ºå¦‚æœä½ æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„æ¨¡æ¿å«logstashï¼Œé‚£ä¹ˆå°†ä¼šç”¨ä½ è‡ªå®šä¹‰æ¨¡æ¿è¦†ç›–é»˜è®¤æ¨¡æ¿logstash</p>

<p>manage_template
å¸ƒå°”ç±»å‹ é»˜è®¤ä¸ºtrue 
è®¾ç½®ä¸ºfalseå°†å…³é—­logstashè‡ªåŠ¨ç®¡ç†æ¨¡æ¿åŠŸèƒ½ 
æ¯”å¦‚ä½ å®šä¹‰äº†ä¸€ä¸ªè‡ªå®šä¹‰æ¨¡æ¿ï¼Œæ›´åŠ å­—æ®µååŠ¨æ€ç”Ÿæˆå­—æ®µï¼Œé‚£ä¹ˆåº”è¯¥è®¾ç½®ä¸ºfalse</p>

<p>orderå‚æ•°
ELK Stack åœ¨å…¥é—¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå¿…ç„¶ä¼šç¢°åˆ°è‡ªå·±ä¿®æ”¹å®šåˆ¶ç´¢å¼•æ˜ å°„(mapping)ä¹ƒè‡³æ¨¡æ¿(template)çš„é—®é¢˜ã€‚ 
è¿™æ—¶å€™ï¼Œä¸å°‘æ¯”è¾ƒè®¤çœŸçœ‹ Logstash æ–‡æ¡£çš„æ–°ç”¨æˆ·ä¼šé€šè¿‡ä¸‹é¢è¿™æ®µé…ç½®æ¥åˆ¶å®šè‡ªå·±çš„æ¨¡æ¿ç­–ç•¥ï¼š</p>

<p>output {
    elasticsearch {
        host =&gt; â€œ127.0.0.1â€
        manage_template =&gt; true
        template =&gt; â€œ/path/to/mytemplateâ€
        template_name =&gt; â€œmynameâ€
    }
}</p>

<p>ç„¶è€Œéšåå°±å‘ç°ï¼Œè‡ªå·±è¾›è¾›è‹¦è‹¦ä¿®æ”¹å‡ºæ¥çš„æ¨¡æ¿ï¼Œé€šè¿‡ curl -XGET â€˜http://127.0.0.1:9200/_template/mynameâ€™ çœ‹ä¹Ÿç¡®å®ä¸Šä¼ æˆåŠŸäº†ï¼Œä½†å®é™…æ–°æ•°æ®ç´¢å¼•åˆ›å»ºå‡ºæ¥ï¼Œå°±æ˜¯æ²¡ç”Ÿæ•ˆï¼</p>

<p>è¿™ä¸ªåŸå› æ˜¯ï¼šLogstash é»˜è®¤ä¼šä¸Šä¼ ä¸€ä¸ªåå« logstash çš„æ¨¡æ¿åˆ° ES é‡Œã€‚å¦‚æœä½ åœ¨ä½¿ç”¨ä¸Šé¢è¿™ä¸ªé…ç½®ä¹‹å‰ï¼Œæ›¾ç»è¿è¡Œè¿‡ Logstashï¼ˆä¸€èˆ¬æ¥è¯´éƒ½ä¼šï¼‰ï¼Œé‚£ä¹ˆ ES é‡Œå°±å·²ç»å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªæ¨¡æ¿äº†ã€‚ä½ å¯ä»¥curl -XGET â€˜http://127.0.0.1:9200/_template/logstashâ€™ éªŒè¯ã€‚</p>

<p>è¿™ä¸ªæ—¶å€™ï¼ŒES é‡Œå°±å˜æˆæœ‰ä¸¤ä¸ªæ¨¡æ¿ï¼Œlogstash å’Œ mynameï¼Œéƒ½åŒ¹é… logstash-* ç´¢å¼•åï¼Œè¦æ±‚è®¾ç½®ä¸€å®šçš„æ˜ å°„è§„åˆ™äº†ã€‚</p>

<p>ES ä¼šæŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ¥å°è¯•è‡ªåŠ¨ merge å¤šä¸ªéƒ½åŒ¹é…ä¸Šäº†çš„æ¨¡æ¿è§„åˆ™ï¼Œæœ€ç»ˆè¿ç”¨åˆ°ç´¢å¼•ä¸Š</p>

<p>å…¶ä¸­è¦ç‚¹å°±æ˜¯ï¼štemplate æ˜¯å¯ä»¥è®¾ç½® order å‚æ•°çš„ï¼è€Œä¸å†™è¿™ä¸ªå‚æ•°ï¼Œé»˜è®¤çš„ order å€¼å°±æ˜¯ 0ã€‚order å€¼è¶Šå¤§ï¼Œåœ¨ merge è§„åˆ™çš„æ—¶å€™ä¼˜å…ˆçº§è¶Šé«˜ã€‚</p>

<p>æ‰€ä»¥ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•å¾ˆç®€å•ï¼šåœ¨ä½ è‡ªå®šä¹‰çš„ template é‡Œï¼ŒåŠ ä¸€è¡Œï¼Œå˜æˆè¿™æ ·ï¼š</p>

<p>{
    â€œtemplateâ€ : â€œlogstash-*â€,
    â€œorderâ€ : 1,
    â€œsettingsâ€ : { â€¦ },
    â€œmappingsâ€ : { â€¦ }
}</p>

<p>å½“ç„¶ï¼Œå…¶å®å¦‚æœåªä» Logstash é…ç½®è§’åº¦å‡ºå‘ï¼Œå…¶å®æ›´ç®€å•çš„åŠæ³•æ˜¯ï¼šç›´æ¥ä¿®æ”¹åŸæ¥é»˜è®¤çš„ logstash æ¨¡æ¿ï¼Œç„¶åæ¨¡æ¿åç§°ä¹Ÿä¸è¦æ”¹ï¼Œå°±å¥½äº†ï¼š</p>

<p>output {
    elasticsearch {
        host =&gt; â€œ127.0.0.1â€
        manage_template =&gt; true
        template_overwrite =&gt; true
    }
}</p>

<p>ä¸ºelasticsearché…ç½®æ¨¡æ¿
åœ¨ä½¿ç”¨logstashæ”¶é›†æ—¥å¿—çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨logstashè‡ªå¸¦çš„åŠ¨æ€ç´¢å¼•æ¨¡æ¿ï¼Œè™½ç„¶æ— é¡»æˆ‘ä»¬åšä»»ä½•å®šåˆ¶æ“ä½œï¼Œå°±èƒ½æŠŠæˆ‘ä»¬çš„æ—¥å¿—æ•°æ®æ¨é€åˆ°elasticsearchç´¢å¼•é›†ç¾¤ä¸­</p>

<p>ä½†æ˜¯åœ¨æˆ‘ä»¬æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç°ï¼Œé»˜è®¤çš„ç´¢å¼•æ¨¡æ¿å¸¸å¸¸æŠŠæˆ‘ä»¬ä¸éœ€è¦åˆ†è¯çš„å­—æ®µï¼Œç»™åˆ†è¯äº†ï¼Œè¿™æ ·ä»¥æ¥ï¼Œæˆ‘ä»¬çš„æ¯”è¾ƒé‡è¦çš„èšåˆç»Ÿè®¡å°±ä¸å‡†ç¡®äº†ï¼š</p>

<p>æ‰€ä»¥è¿™æ—¶å€™ï¼Œå°±éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰ä¸€äº›ç´¢å¼•æ¨¡æ¿äº†</p>

<p>åœ¨logstashä¸elasticsearché›†æˆçš„æ—¶å€™ï¼Œæ€»å…±æœ‰å¦‚ä¸‹å‡ ç§ä½¿ç”¨æ¨¡æ¿çš„æ–¹å¼ï¼š</p>

<p>ä½¿ç”¨é»˜è®¤è‡ªå¸¦çš„ç´¢å¼•æ¨¡æ¿ ï¼Œå¤§éƒ¨åˆ†çš„å­—æ®µéƒ½ä¼šåˆ†è¯ï¼Œé€‚åˆå¼€å‘å’Œæ—¶å€™å¿«é€ŸéªŒè¯ä½¿ç”¨</p>

<p>åœ¨logstashæ”¶é›†ç«¯è‡ªå®šä¹‰é…ç½®æ¨¡æ¿ï¼Œå› ä¸ºåˆ†æ•£åœ¨æ”¶é›†æœºå™¨ä¸Šï¼Œç»´æŠ¤æ¯”è¾ƒéº»çƒ¦</p>

<p>åœ¨elasticsearcæœåŠ¡ç«¯è‡ªå®šä¹‰é…ç½®æ¨¡æ¿ï¼Œç”±elasticsearchè´Ÿè´£åŠ è½½æ¨¡æ¿ï¼Œå¯åŠ¨æ€æ›´æ”¹ï¼Œå…¨å±€ç”Ÿæ•ˆï¼Œç»´æŠ¤æ¯”è¾ƒå®¹æ˜“</p>

<p>ä½¿ç”¨é»˜è®¤è‡ªå¸¦çš„ç´¢å¼•æ¨¡æ¿
ElasticSearché»˜è®¤è‡ªå¸¦äº†ä¸€ä¸ªåå­—ä¸ºâ€logstashâ€çš„æ¨¡æ¿ï¼Œé»˜è®¤åº”ç”¨äºLogstashå†™å…¥æ•°æ®åˆ°ElasticSearchä½¿ç”¨</p>

<p>ä¼˜ç‚¹ï¼šæœ€ç®€å•ï¼Œæ— é¡»ä»»ä½•é…ç½®</p>

<p>ç¼ºç‚¹ï¼šæ— æ³•è‡ªå®šä¹‰ä¸€äº›é…ç½®ï¼Œä¾‹å¦‚ï¼šåˆ†è¯æ–¹å¼</p>

<p>åœ¨logstashæ”¶é›†ç«¯è‡ªå®šä¹‰é…ç½®æ¨¡æ¿
ä½¿ç”¨ç¬¬äºŒç§ï¼Œé€‚åˆå°è§„æ¨¡é›†ç¾¤çš„æ—¥å¿—æ”¶é›†</p>

<p>éœ€è¦åœ¨logstashçš„outputæ’ä»¶ä¸­ä½¿ç”¨templateæŒ‡å®šæœ¬æœºå™¨ä¸Šçš„ä¸€ä¸ªæ¨¡æ¿jsonè·¯å¾„ï¼Œ ä¾‹å¦‚ template =&gt; â€œ/tmp/logstash.jsonâ€</p>

<p>ä¼˜ç‚¹ï¼šé…ç½®ç®€å•</p>

<p>ç¼ºç‚¹ï¼šå› ä¸ºåˆ†æ•£åœ¨Logstash Indexeræœºå™¨ä¸Šï¼Œç»´æŠ¤èµ·æ¥æ¯”è¾ƒéº»çƒ¦</p>

<p>åœ¨elasticsearcæœåŠ¡ç«¯è‡ªå®šä¹‰é…ç½®æ¨¡æ¿
manage_template =&gt; false//å…³é—­logstashè‡ªåŠ¨ç®¡ç†æ¨¡æ¿åŠŸèƒ½<br />
template_name =&gt; â€œxxxâ€//æ˜ å°„æ¨¡æ¿çš„åå­—<br />
ç¬¬ä¸‰ç§éœ€è¦åœ¨elasticsearchçš„é›†ç¾¤ä¸­çš„config/templatesè·¯å¾„ä¸‹é…ç½®æ¨¡æ¿jsonï¼Œåœ¨elasticsearchä¸­ç´¢å¼•æ¨¡æ¿å¯åˆ†ä¸ºä¸¤ç§</p>

<p>é™æ€æ¨¡æ¿
é€‚åˆç´¢å¼•å­—æ®µæ•°æ®å›ºå®šçš„åœºæ™¯ï¼Œä¸€æ—¦é…ç½®å®Œæˆï¼Œä¸èƒ½å‘é‡Œé¢åŠ å…¥å¤šä½™çš„å­—æ®µï¼Œå¦åˆ™ä¼šæŠ¥é”™</p>

<p>ä¼˜ç‚¹ï¼šscheamå·²çŸ¥ï¼Œä¸šåŠ¡åœºæ™¯æ˜ç¡®ï¼Œä¸å®¹æ˜“å‡ºç°å› å­—æ®µéšä¾¿æ˜ å°„ä»è€Œé€ æˆå…ƒæ•°æ®æ’‘çˆ†eså†…å­˜ï¼Œä»è€Œå¯¼è‡´esé›†ç¾¤å…¨éƒ¨å®•æœºï¼Œç»´æŠ¤æ¯”è¾ƒå®¹æ˜“ï¼Œå¯åŠ¨æ€æ›´æ”¹ï¼Œå…¨å±€ç”Ÿæ•ˆã€‚</p>

<p>ç¼ºç‚¹ï¼šå­—æ®µæ•°å¤šçš„æƒ…å†µä¸‹é…ç½®ç¨ç¹ç</p>

<p>ä¸€ä¸ªé™æ€ç´¢å¼•æ¨¡æ¿é…ç½®ä¾‹å­å¦‚ä¸‹ï¼š</p>

<p>{<br />
  â€œxxxâ€ : {<br />
      â€œtemplateâ€: â€œxxx-*â€,<br />
        â€œsettingsâ€: {<br />
            â€œindex.number_of_shardsâ€: 3,<br />
            â€œnumber_of_replicasâ€: 0 <br />
        },<br />
    â€œmappingsâ€ : {<br />
      â€œlogsâ€ : {<br />
        â€œpropertiesâ€ : {<br />
          â€œ@timestampâ€ : { //è¿™æ˜¯ä¸“é—¨ç»™kibanaç”¨çš„ä¸€ä¸ªå­—æ®µï¼Œæ—¶é—´ç´¢å¼•
            â€œtypeâ€ : â€œdateâ€,<br />
            â€œformatâ€ : â€œdateOptionalTimeâ€,<br />
            â€œdoc_valuesâ€ : true<br />
          },<br />
          â€œ@versionâ€ : {<br />
            â€œtypeâ€ : â€œstringâ€,<br />
            â€œindexâ€ : â€œnot_analyzedâ€,<br />
            â€œdoc_valuesâ€ : true    <br />
          },<br />
          â€œidâ€ : {<br />
            â€œtypeâ€ : â€œstringâ€,<br />
            â€œindexâ€ : â€œnot_analyzedâ€<br />
          },<br />
          â€œnameâ€ : {<br />
            â€œtypeâ€ : â€œstringâ€,<br />
            â€œindexâ€ : â€œnot_analyzedâ€<br />
          }
        }<br />
      }<br />
    }<br />
  }<br />
}</p>

<p>åŠ¨æ€æ¨¡æ¿
é€‚åˆå­—æ®µæ•°ä¸æ˜ç¡®ï¼Œå¤§é‡å­—æ®µçš„é…ç½®ç±»å‹ç›¸åŒçš„åœºæ™¯ï¼Œå¤šåŠ å­—æ®µä¸ä¼šæŠ¥é”™</p>

<p>ä¼˜ç‚¹ï¼šå¯åŠ¨æ€æ·»åŠ ä»»æ„å­—æ®µï¼Œæ— é¡»æ”¹åŠ¨scheamlï¼Œ</p>

<p>ç¼ºç‚¹ï¼šå¦‚æœæ·»åŠ çš„å­—æ®µéå¸¸å¤šï¼Œæœ‰å¯èƒ½é€ æˆesé›†ç¾¤å®•æœº</p>

<p>ä¸€ä¸ªåŠ¨æ€ç´¢å¼•æ¨¡æ¿é…ç½®ä¾‹å­å¦‚ä¸‹ï¼š</p>

<p>{<br />
  â€œtemplateâ€ : â€œxxx-*â€,<br />
  â€œsettingsâ€ : {<br />
   â€œindex.number_of_shardsâ€: 5,<br />
   â€œnumber_of_replicasâ€: 0</p>

<p>},<br />
  â€œmappingsâ€ : {<br />
    â€œ<em>default</em>â€ : {<br />
      â€œ_allâ€ : {â€œenabledâ€ : true, â€œomit_normsâ€ : true},<br />
      â€œdynamic_templatesâ€ : [ {<br />
        â€œmessage_fieldâ€ : {<br />
          â€œmatchâ€ : â€œmessageâ€,<br />
          â€œmatch_mapping_typeâ€ : â€œstringâ€,<br />
          â€œmappingâ€ : {<br />
            â€œtypeâ€ : â€œstringâ€, â€œindexâ€ : â€œanalyzedâ€, â€œomit_normsâ€ : true,<br />
            â€œfielddataâ€ : { â€œformatâ€ : â€œdisabledâ€ }<br />
          }<br />
        }<br />
      }, {<br />
        â€œstring_fieldsâ€ : {<br />
          â€œmatchâ€ : â€œ*â€,<br />
          â€œmatch_mapping_typeâ€ : â€œstringâ€,<br />
          â€œmappingâ€ : {<br />
            â€œtypeâ€ : â€œstringâ€, â€œindexâ€ : â€œnot_analyzedâ€, â€œdoc_valuesâ€ : true<br />
          }<br />
        }<br />
      } ],<br />
      â€œpropertiesâ€ : {<br />
        â€œ@timestampâ€: { â€œtypeâ€: â€œdateâ€ },<br />
        â€œ@versionâ€: { â€œtypeâ€: â€œstringâ€, â€œindexâ€: â€œnot_analyzedâ€ }, 
        â€œgeoipâ€  : {<br />
          â€œdynamicâ€: true,<br />
          â€œpropertiesâ€ : {<br />
            â€œipâ€: { â€œtypeâ€: â€œipâ€ },<br />
            â€œlocationâ€ : { â€œtypeâ€ : â€œgeo_pointâ€ },<br />
            â€œlatitudeâ€ : { â€œtypeâ€ : â€œfloatâ€ },<br />
            â€œlongitudeâ€ : { â€œtypeâ€ : â€œfloatâ€ }<br />
          }<br />
        }<br />
      }<br />
    }<br />
  }<br />
}</p>

<p>åªè®¾ç½®messageå­—æ®µåˆ†è¯ï¼Œå…¶ä»–çš„å­—æ®µé»˜è®¤éƒ½ä¸åˆ†è¯</p>

<p>æ¨¡æ¿ç»“æ„
é€šç”¨è®¾ç½® ä¸»è¦æ˜¯æ¨¡æ¿åŒ¹é…ç´¢å¼•çš„è¿‡æ»¤è§„åˆ™ï¼Œå½±å“è¯¥æ¨¡æ¿å¯¹å“ªäº›ç´¢å¼•ç”Ÿæ•ˆ
settingsï¼šé…ç½®ç´¢å¼•çš„å…¬å…±å‚æ•°ï¼Œæ¯”å¦‚ç´¢å¼•çš„replicasï¼Œä»¥åŠåˆ†ç‰‡æ•°shardsç­‰å‚æ•°
mappingsï¼šæœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è¿™éƒ¨åˆ†ä¸­é…ç½®æ¯ä¸ªtypeä¸‹çš„æ¯ä¸ªfieldçš„ç›¸å…³å±æ€§ï¼Œæ¯”å¦‚fieldç±»å‹ï¼ˆstring,long,dateç­‰ç­‰ï¼‰ï¼Œæ˜¯å¦åˆ†è¯ï¼Œæ˜¯å¦åœ¨å†…å­˜ä¸­ç¼“å­˜ç­‰ç­‰å±æ€§éƒ½åœ¨è¿™éƒ¨åˆ†é…ç½®
aliasesï¼šç´¢å¼•åˆ«åï¼Œç´¢å¼•åˆ«åå¯ç”¨åœ¨ç´¢å¼•æ•°æ®è¿ç§»ç­‰ç”¨é€”ä¸Šã€‚
ä¾‹å­ï¼š</p>

<p>{
  â€œlogstashâ€ : {
    â€œorderâ€ : 0,
    â€œtemplateâ€ : â€œlogstash-<em>â€,
    â€œsettingsâ€ : {
      â€œindexâ€ : {
        â€œrefresh_intervalâ€ : â€œ5sâ€
      }
    },
    â€œmappingsâ€ : {
      â€œ_default_â€ : {
        â€œdynamic_templatesâ€ : [ {
          â€œmessage_fieldâ€ : {
            â€œmappingâ€ : {
              â€œfielddataâ€ : {
                â€œformatâ€ : â€œdisabledâ€
              },
              â€œindexâ€ : â€œanalyzedâ€,
              â€œomit_normsâ€ : true,
              â€œtypeâ€ : â€œstringâ€
            },
            â€œmatch_mapping_typeâ€ : â€œstringâ€,
            â€œmatchâ€ : â€œmessageâ€
          }
        }, {
          â€œstring_fieldsâ€ : {
            â€œmappingâ€ : {
              â€œfielddataâ€ : {
                â€œformatâ€ : â€œdisabledâ€
              },
              â€œindexâ€ : â€œanalyzedâ€,
              â€œomit_normsâ€ : true,
              â€œtypeâ€ : â€œstringâ€,
              â€œfieldsâ€ : {
                â€œrawâ€ : {
                  â€œignore_aboveâ€ : 256,
                  â€œindexâ€ : â€œnot_analyzedâ€,
                  â€œtypeâ€ : â€œstringâ€
                }
              }
            },
            â€œmatch_mapping_typeâ€ : â€œstringâ€,
            â€œmatchâ€ : â€œ</em>â€
          }
        } ],
        â€œ_allâ€ : {
          â€œomit_normsâ€ : true,
          â€œenabledâ€ : true
        },
        â€œpropertiesâ€ : {
          â€œ@timestampâ€ : {
            â€œtypeâ€ : â€œdateâ€
          },
          â€œgeoipâ€ : {
            â€œdynamicâ€ : true,
            â€œpropertiesâ€ : {
              â€œipâ€ : {
                â€œtypeâ€ : â€œipâ€
              },
              â€œlatitudeâ€ : {
                â€œtypeâ€ : â€œfloatâ€
              },
              â€œlocationâ€ : {
                â€œtypeâ€ : â€œgeo_pointâ€
              },
              â€œlongitudeâ€ : {
                â€œtypeâ€ : â€œfloatâ€
              }
            }
          },
          â€œ@versionâ€ : {
            â€œindexâ€ : â€œnot_analyzedâ€,
            â€œtypeâ€ : â€œstringâ€
          }
        }
      }
    },
    â€œaliasesâ€ : { }
  }
}</p>

<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰TemplateåŠ¨æ€æ¨¡æ¿ï¼Œè¿™ä¸ªæ¨¡æ¿æŒ‡å®šåŒ¹é…æ‰€æœ‰ä»¥â€go_logsindexâ€œå¼€å§‹çš„ç´¢å¼•ï¼Œå¹¶ä¸”æŒ‡å®šå…è®¸æ·»åŠ æ–°å­—æ®µï¼ŒåŒ¹é…æ‰€æœ‰stringç±»å‹çš„æ–°å­—æ®µä¼šåˆ›å»ºä¸€ä¸ªrawçš„åµŒå¥—å­—æ®µï¼Œè¿™ä¸ªrawåµŒå¥—å­—æ®µç±»å‹ä¹Ÿæ˜¯stringï¼Œä½†æ˜¯æ˜¯not_analyzedä¸åˆ†è¯çš„ï¼ˆä¸»è¦ç”¨äºè§£å†³ä¸€äº›analyzedçš„stringå­—æ®µæ— æ³•åšç»Ÿè®¡ï¼Œä½†å¯ä»¥ä½¿ç”¨è¿™ä¸ªrawåµŒå¥—å­—æ®µåšç»Ÿè®¡ï¼‰</p>

<p>{
  â€œtemplateâ€: â€œgo_logs_index_*â€,
  â€œorderâ€:0,
  â€œsettingsâ€: {
      â€œindex.number_of_replicasâ€: â€œ1â€,
      â€œindex.number_of_shardsâ€: â€œ5â€,
      â€œindex.refresh_intervalâ€ : â€œ10sâ€
  },
  â€œmappingsâ€: {
    â€œ<em>default</em>â€: {
      â€œ_allâ€: {
        â€œenabledâ€: false
      },
      â€œdynamic_templatesâ€: [
        {
          â€œmy_templateâ€: {
            â€œmatch_mapping_typeâ€: â€œstringâ€,
            â€œmappingâ€: {
              â€œtypeâ€: â€œstringâ€,
              â€œfieldsâ€: {
                â€œrawâ€: {
                  â€œtypeâ€: â€œstringâ€,
                  â€œindexâ€: â€œnot_analyzedâ€
                }
              }
            }
          }
        }
      ]
    },
    â€œgoâ€: {
      â€œpropertiesâ€: {
        â€œtimestampâ€: {
          â€œtypeâ€: â€œstringâ€,
          â€œindexâ€: â€œnot_analyzedâ€
        },
        â€œmsgâ€: {
          â€œtypeâ€: â€œstringâ€,
          â€œanalyzerâ€: â€œikâ€,
          â€œsearch_analyzerâ€: â€œik_smartâ€
        },
        â€œfileâ€: {
          â€œtypeâ€: â€œstringâ€,
          â€œindexâ€: â€œnot_analyzedâ€
        },
        â€œlineâ€: {
          â€œtypeâ€: â€œstringâ€,
          â€œindexâ€: â€œnot_analyzedâ€
        },
        â€œthreadidâ€: {
          â€œtypeâ€: â€œstringâ€,
          â€œindexâ€: â€œnot_analyzedâ€
        },
        â€œinfoâ€: {
          â€œtypeâ€: â€œstringâ€,
          â€œindexâ€: â€œnot_analyzedâ€
        },
        â€œtypeâ€: {
          â€œtypeâ€: â€œstringâ€,
          â€œindexâ€: â€œnot_analyzedâ€
        },
        â€œ@timestampâ€: {
          â€œformatâ€: â€œstrict_date_optional_time||epoch_millisâ€,
          â€œtypeâ€: â€œdateâ€
        },
        â€œ@versionâ€: {
          â€œtypeâ€: â€œstringâ€,
          â€œindexâ€: â€œnot_analyzedâ€
        }
      }
    }
  }
}
æ€»ç»“
ç¬¬ä¸‰ç§æ–¹å¼ç»Ÿä¸€ç®¡ç†Templateæœ€å¥½ï¼Œæ¨èä½¿ç”¨ç¬¬ä¸‰ç§æ–¹å¼ï¼Œä½†æ˜¯å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚ä¾‹å¦‚åœºæ™¯æ˜¯Logstash å’ŒElasticSearchéƒ½åœ¨ä¸€å°æœåŠ¡å™¨ï¼Œç¬¬äºŒç§å°±æ¯”è¾ƒå¥½</p>

<p>å®šåˆ¶ç´¢å¼•æ¨¡æ¿ï¼Œæ˜¯æœç´¢ä¸šåŠ¡ä¸­ä¸€é¡¹æ¯”è¾ƒé‡è¦çš„æ­¥éª¤ï¼Œéœ€è¦æ³¨æ„çš„åœ°æ–¹æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š 
1.å­—æ®µæ•°å›ºå®šå— 
2.å­—æ®µç±»å‹æ˜¯ä»€ä¹ˆ 
3.åˆ†ä¸åˆ†è¯ 
4.ç´¢å¼•ä¸ç´¢å¼• 
5.å­˜å‚¨ä¸å­˜å‚¨ 
6.æ’ä¸æ’åº 
7.æ˜¯å¦åŠ æƒ</p>
:ET