I"Ø<p>è¿™ä¸ªå¾ˆç†Ÿæ˜¯è¿›ç¨‹è°ƒåº¦åˆå§‹åŒ–å‡½æ•°ï¼Œä¸»è¦åšäº†è®¾ç½®è¿›ç¨‹çš„GDTï¼ŒLDTæè¿°ç¬¦ï¼Œè®¾ç½®ç³»ç»Ÿå®šæ—¶å™¨ä¸­æ–­ï¼Œç³»ç»Ÿè°ƒç”¨ç»ˆç«¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<p>void sched_init(void)
{
        int i;
        struct desc_struct * p;
/<strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**
æè¿°ç»“æ„åœ¨include/linux/head.hä¸­
typedef struct desc_struct {
        unsigned long a,b;
} 
**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><em>**</em>/
        if (sizeof(struct sigaction) != 16)
                panic(â€œStruct sigaction MUST be 16 bytesâ€);</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set_tss_desc(gdt+FIRST_TSS_ENTRY,&amp;(init_task.task.tss)); /*********************************************************** è®¾ç½®GDTï¼ŒFIRST_TSS_ENTRYï¼Œå¯¹åº”ä»»åŠ¡0çš„GDTã€‚è®¾ç½®ä»»åŠ¡çŠ¶æ€ **************************************************************/
    set_ldt_desc(gdt+FIRST_LDT_ENTRY,&amp;(init_task.task.ldt)); /********************************************** è®¾ç½®LDTï¼ŒFIRST_TSS_ENTRYï¼Œå¯¹åº”ä»»åŠ¡0çš„LDTã€‚è®¾ç½®ä»»åŠ¡0çš„LDT ä½“è°ƒç”¨ï¼šè®¾ç½®äº†å¯¹åº”ldtï¼Œgdtçš„ä½ #define _set_tssldt_desc(n,addr,type) \ __asm__ ("movw $104,%1\n\t" \
    "movw %%ax,%2\n\t" \
    "rorl $16,%%eax\n\t" \
    "movb %%al,%3\n\t" \
    "movb $" type ",%4\n\t" \
    "movb $0x00,%5\n\t" \
    "movb %%ah,%6\n\t" \
    "rorl $16,%%eax" \
    ::"a" (addr), "m" (*(n)), "m" (*(n+2)), "m" (*(n+4)), \
     "m" (*(n+5)), "m" (*(n+6)), "m" (*(n+7)) \
    )
</code></pre></div></div>

<p>#define set_tss_desc(n,addr) _set_tssldt_desc(((char <em>) (n)),addr,â€0x89â€)
#define set_ldt_desc(n,addr) _set_tssldt_desc(((char *) (n)),addr,â€0x82â€)
?</em><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong><strong>**</strong>/</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    p = gdt+2+FIRST_TSS_ENTRY;//ç§»åŠ¨åˆ°ä»»åŠ¡1 gdt
    for(i=1;i                 task[i] = NULL;
            p-&gt;a=p-&gt;b=0;//çŠ¶æ€æ®µæ¸…é›¶æˆ–è€…GDTç½®ç©º
            p++;
            p-&gt;a=p-&gt;b=0;//ldtç½®ç©ºç½®ç©ºå“¦
            p++;
    } //ä¸Šé¢è¿™ä¸€æ®µï¼Œåˆå§‹è´§63ä¸ªè¿›ç¨‹ï¼Œå…¨éƒ¨ç½®ç©ºï¼ŒNR_TASKSä¸º64 /* Clear NT, so that we won't have troubles with that later on */
    __asm__("pushfl ; andl $0xffffbfff,(%esp) ; popfl");
    ltr(0); /*********************************************************** è¿™ä¸ªè°ƒç”¨#define ltr(n) __asm__("ltr %%ax"::"a" (_TSS(n))) #define _TSS(n) ((((unsigned long) n)&lt;&lt;4)+(FIRST_TSS_ENTRY&lt;&lt;3)) åŠ è½½ä»»åŠ¡å¯„å­˜å™¨ã€‚æŠŠä»»åŠ¡0çš„tssæ®µé€‰æ‹©è¿°ç¬¦å’Œæ®µæè¿°ç¬¦åŠ è½½åˆ°ä»»åŠ¡å¯„å­˜å™¨ã€‚ **********************************************************/
    lldt(0); /***************************************************# è¿™ä¸ªè°ƒç”¨ï¼šdefine lldt(n) __asm__("lldt %%ax"::"a" (_LDT(n))) _LDTï¼ˆnï¼‰:#define _LDT(n) ((((unsigned long) n)&lt;&lt;4)+(FIRST_LDT_ENTRY&lt;&lt;3)) ä¸»è¦ä½œç”¨åŠ è½½æè¿°ç¬¦è¡¨å¯„å­˜å™¨LDTRã€‚ *************************************************************/
    outb_p(0x36,0x43);              /* binary, mode 3, LSB/MSB, ch 0 */
    outb_p(LATCH &amp; 0xff , 0x40);    /* LSB */
    outb(LATCH &gt;&gt; 8 , 0x40);        /* MSB */
    set_intr_gate(0x20,&amp;timer_interrupt); /************************************ è¿™å››å¥æ˜¯åˆå§‹åŒ–ç³»ç»Ÿå®šæ—¶å™¨ä¸­æ–­ï¼Œcat   /proc/ioportsæœ‰   0040-0043 : timer0 è¯´æ˜ç¬¬ä¸€å¥æ˜¯è®¾ç½®åªç”¨æ¨¡å¼3ï¼Œæ¥ä¸‹æ¥ä¸¤å¥è®¾ç½®è®¡æ•°çš„é«˜ä½å’Œä½ä½ï¼Œ#define LATCH (1193180/HZ) æœ€åä¸€å¥å®šä¹‰ä¸­æ–­æœåŠ¡ç¨‹åºtimer_interruptä¼šæ‰§è¡Œjmp ret_from_sys_callï¼Œæ£€æŸ¥æ˜¯å¦è¦åˆ‡æ¢ä»»åŠ¡ **********************************/
    outb(inb_p(0x21)&amp;~0x01,0x21);
    set_system_gate(0x80,&amp;system_call);//å®šä¹‰ç³»ç»Ÿè°ƒç”¨ }
</code></pre></div></div>

<p>æ€»ä½“æ¥è¯´ï¼Œè¿™æ®µç¨‹åºå…ˆåˆå§‹è¯0è¿›ç¨‹ï¼ŒåŒ…æ‹¬æ®µé€‰æ‹©ç¬¦ï¼Œæè¿°ç¬¦GDTã€‚LDTç­‰ã€‚ç„¶åå°†å…¶ä»–63ä¸ªè¿›ç¨‹çš„çš„ æ®µé€‰æ‹©ç¬¦ï¼Œæè¿°ç¬¦GDTã€‚LDT
ç½®ç©ºï¼Œè®¾ç½®å¥½åå¥½åï¼Œå°†ä»»åŠ¡0çš„ æ®µé€‰æ‹©ç¬¦ï¼Œæè¿°ç¬¦GDTã€‚LDTç­‰åŠ è½½è¿›ä¸ªå¯„å­˜å™¨ä¸­ã€‚æ¥ç€è®¾ç½®ç³»ç»Ÿä¸­æ–­å®šæ—¶å™¨ï¼Œä¸­æ–­å‡½æ•°åˆ¤æ–­
æ˜¯
<!-- more -->
https://www.cnblogs.com/sky-heaven/p/11506521.html</p>

<p>https://www.xuebuyuan.com/3263090.html</p>

<p>https://blog.csdn.net/xiongtiancheng/article/details/78880025</p>
:ET