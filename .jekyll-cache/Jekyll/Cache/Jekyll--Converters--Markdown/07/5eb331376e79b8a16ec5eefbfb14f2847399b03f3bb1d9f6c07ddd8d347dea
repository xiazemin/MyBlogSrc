I"á<p>å½“ä½ åœ¨æ‰©å±•ä¸­ä½¿ç”¨ HashTable æ—¶å€™ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯è¦å­˜å‚¨ç”¨æˆ·ç«¯çš„å˜é‡ï¼Œå°±åƒ PHP è¯­è¨€ä¸­æ•°ç»„é‚£æ ·ã€‚ä¸ºæ­¤ï¼Œå†…æ ¸ä¸­å·²ç»å‡†å¤‡å¥½äº†ç›¸åº”çš„å·¥å…·ï¼Œæ¥è®©æˆ‘ä»¬æ›´åŠ çš„æ–¹ä¾¿çš„æ“ä½œ HashTable å­˜å‚¨ zval*ï¼Œä¹Ÿå°±æ˜¯ PHP è¯­è¨€ä¸­çš„æ•°ç»„ï¼Œå³ IS_ARRAY å¸¸é‡ä»£è¡¨çš„ zvalï¼Œä»¥ä¸‹ç”¨ {æ•°ç»„} æ¥ä»£æ›¿ PHP è¯­è¨€ä¸­çš„æ•°ç»„è¿™ä¸ªè¯ã€‚
<!-- more --></p>

<p>åˆ›å»ºæ•°ç»„
åˆ›å»º HashTable æœ‰äº›ç¹çï¼Œè™½ç„¶æœ‰è¾…åŠ©çš„å®ä½†è¿˜æ˜¯ä¸èƒ½ä¸€æ­¥å®Œæˆï¼Œè€Œåˆ›å»º{æ•°ç»„}ä¾¿ç®€å•å¤šäº†ï¼Œç›´æ¥ä½¿ç”¨array_init(zval *arrval) å‡½æ•°å³å¯ï¼Œæ³¨æ„å®ƒçš„å‚æ•°æ˜¯ zval ç±»å‹çš„ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å‘ç”¨æˆ·ç«¯è¿”å›æ•°ç»„ä¾¿ç®€å•å¤šäº†ï¼š
ZEND_FUNCTION(sample_array)
{
    array_init(return_value);
}
1
ZEND_FUNCTION(sample_array)
2
{
3
    array_init(return_value);
4
}</p>

<p>è¿”å›å€¼æ˜¯ zval* ç±»å‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¯¹å®ƒè°ƒç”¨ array_init() å‡½æ•°å³å¯ï¼Œå³æŠŠå®ƒåˆå§‹åŒ–æˆäº†ä¸€ä¸ªç©ºæ•°ç»„ã€‚
æ·»åŠ å…ƒç´ 
å°†{æ•°ç»„}åˆå§‹åŒ–åï¼Œæ¥ä¸‹æ¥å°±è¦å‘å…¶æ·»åŠ å…ƒç´ äº†ã€‚å› ä¸º PHP è¯­è¨€ä¸­æœ‰å¤šç§ç±»å‹çš„å˜é‡ï¼Œæ‰€ä»¥ä¹Ÿå¯¹åº”çš„æœ‰å¤šç§ç±»å‹çš„ add_assoc_<em>ã€add_index_</em>ã€add_next_index_* å‡½æ•°ã€‚å¦‚ï¼š
1
array_init(arrval);
2
â€‹
3
add_assoc_long(zval <em>arrval, char *key, long lval);
4
add_index_long(zval *arrval, ulong idx, long lval);
5
add_next_index_long(zval *arrval, long lval);
è¿™ä¸‰ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½è¦è¢«æ“ä½œçš„ {æ•°ç»„} æŒ‡é’ˆï¼Œç„¶åæ˜¯ç´¢å¼•å€¼ï¼Œæœ€åæ˜¯å˜é‡ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯add_next_index_long() å‡½æ•°çš„ç´¢å¼•å€¼æ˜¯å…¶è‡ªå·±è®¡ç®—å‡ºæ¥çš„ã€‚æ ¹æ®ä¸Šä¸€èŠ‚çš„å†…å®¹æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°åˆ†åˆ«åœ¨å†…éƒ¨ä½¿ç”¨äº† zend_hash_update()ã€zend_hash_index_update()ä¸zend_hash_next_index_insert() å‡½æ•°ã€‚
zval *value
1
// add_assoc_</em>ç³»åˆ—å‡½æ•°ï¼š
2
add_assoc_null(zval <em>aval, char *key);
3
add_assoc_bool(zval *aval, char *key, zend_bool bval);
4
add_assoc_long(zval *aval, char *key, long lval);
5
add_assoc_double(zval *aval, char *key, double dval);
6
add_assoc_string(zval *aval, char *key, char *strval, int dup);
7
add_assoc_stringl(zval *aval, char *key,char *strval, uint strlen, int dup);
8
add_assoc_zval(zval *aval, char *key, zval *value);
9
â€‹
10
//å¤‡æ³¨ï¼šå…¶å®è¿™äº›å‡½æ•°éƒ½æ˜¯å®ï¼Œéƒ½æ˜¯å¯¹add_assoc_</em><em>exå‡½æ•°çš„å°è£…ã€‚
11
â€‹
12
// add_index</em><em>ç³»åˆ—å‡½æ•°ï¼š
13
ZEND_API int add_index_long(zval *arg, ulong idx, long n);
14
ZEND_API int add_index_null(zval *arg, ulong idx);
15
ZEND_API int add_index_bool(zval *arg, ulong idx, int b);
16
ZEND_API int add_index_resource(zval *arg, ulong idx, int r);
17
ZEND_API int add_index_double(zval *arg, ulong idx, double d);
18
ZEND_API int add_index_string(zval *arg, ulong idx, const char *str, int duplicate);
19
ZEND_API int add_index_stringl(zval *arg, ulong idx, const char *str, uint length, int duplicate);
20
ZEND_API int add_index_zval(zval *arg, ulong index, zval *value);
21
â€‹
22
// add_next_index_</em>å‡½æ•°ï¼š
23
ZEND_API int add_next_index_long(zval *arg, long n);
24
ZEND_API int add_next_index_null(zval *arg);
25
ZEND_API int add_next_index_bool(zval *arg, int b   );
26
ZEND_API int add_next_index_resource(zval *arg, int r   );
27
ZEND_API int add_next_index_double(zval *arg, double d);
28
ZEND_API int add_next_index_string(zval *arg, const char *str, int duplicate);
29
ZEND_API int add_next_index_stringl(zval *arg, const char *str, uint length, int duplicate);
30
ZEND_API int add_next_index_zval(zval *arg, zval *value);
æ¯ç»„å‡½æ•°æœ€åçš„ä¸€ä¸ªï¼Œå³ zendâ€¦_zval() å‡½æ•°ï¼Œå…è®¸æˆ‘ä»¬å‘è¿™ä¸ª{æ•°ç»„}ä¸­æ·»åŠ èµ„æºã€å¯¹è±¡ã€{æ•°ç»„} ç­‰å¤åˆç±»å‹çš„ PHP å˜é‡ã€‚
æ¼”ç¤ºç¤ºä¾‹
ä¸‹é¢è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºä¸‹å®ƒä»¬çš„ç”¨æ³•ï¼š
ZEND_FUNCTION(academy_sample_array)
{
    zval *subarray;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array_init(return_value);

// æ·»åŠ æ ‡é‡
add_assoc_long(return_value, "laravel", 55);
add_index_bool(return_value, 100, 1);
add_next_index_double(return_value, 3.1415926);

// é™æ€å­—ç¬¦ä¸²
add_next_index_string(return_value, "Laravel", 1);

// åŠ¨æ€å­—ç¬¦ä¸²
add_next_index_string(return_value, estrdup("Academy"), 0);

// åˆ›å»ºä¸€ä¸ªå­æ•°ç»„
MAKE_STD_ZVAL(subarray);
array_init(subarray);

// ä½¿ç”¨æ•°å€¼å¡«å……æ•°ç»„
add_next_index_long(subarray, 1);
add_next_index_long(subarray, 10);
add_next_index_long(subarray, 100);

// å°†å­æ•°ç»„é™„åŠ åˆ°çˆ¶çº§æ•°ç»„
add_index_zval(return_value, 200, subarray); } 1 ZEND_FUNCTION(academy_sample_array) 2 { 3
zval *subarray; 4 â€‹ 5
array_init(return_value); 6 â€‹ 7
// æ·»åŠ æ ‡é‡ 8
add_assoc_long(return_value, "laravel", 55); 9
add_index_bool(return_value, 100, 1); 10
add_next_index_double(return_value, 3.1415926); 11 â€‹ 12
// é™æ€å­—ç¬¦ä¸² 13
add_next_index_string(return_value, "Laravel", 1); 14 â€‹ 15
// åŠ¨æ€å­—ç¬¦ä¸² 16
add_next_index_string(return_value, estrdup("Academy"), 0); 17 â€‹ 18
// åˆ›å»ºä¸€ä¸ªå­æ•°ç»„ 19
MAKE_STD_ZVAL(subarray); 20
array_init(subarray); 21 â€‹ 22
// ä½¿ç”¨æ•°å€¼å¡«å……æ•°ç»„ 23
add_next_index_long(subarray, 1); 24
add_next_index_long(subarray, 10); 25
add_next_index_long(subarray, 100); 26 â€‹ 27
// å°†å­æ•°ç»„é™„åŠ åˆ°çˆ¶çº§æ•°ç»„ 28
add_index_zval(return_value, 200, subarray); 29 } é‡æ–°ç¼–è¯‘æ‰©å±•åï¼Œè¿™æ—¶å¦‚æœæˆ‘ä»¬è°ƒç”¨ç”¨æˆ·ç«¯ var_dump è¿™ä¸ªå‡½æ•°ï¼š &lt;?php var_dump(academy_sample_array()); 1 &lt;?php 2 var_dump(academy_sample_array()); è¾“å‡ºå¦‚ä¸‹ï¼š ï¿¼ æˆ‘ä»¬ç”¨äº†å¾ˆé•¿çš„ç¯‡å¹…åœ¨è¿™ä¸€ç« æè¿°å†…æ ¸ä¸­çš„ HashTable ç»“æ„ä»¥åŠ PHP ä¸­çš„æ•°ç»„å®ç°ã€‚åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šåœ¨å®ƒçš„åŸºç¡€ä¸Šå­¦ä¹ ä¸€ä¸‹å†…æ ¸æ˜¯æ€æ ·å®ç°ä¸ç®¡ç† PHP è¯­è¨€ä¸­çš„èµ„æºä¸ç±»çš„ã€‚
</code></pre></div></div>

<p>https://xueyuanjun.com/post/7261
https://blog.csdn.net/xing_____/article/details/79154053
https://www.jianshu.com/p/0de2c303ee6f
https://www.jianshu.com/p/32fdad9be6c8
https://yaoguais.github.io/article/php/extension-php5to7.html
https://toutiao.io/posts/47pyrd/preview
https://www.bo56.com/php%E6%89%A9%E5%B1%95%E8%BF%81%E7%A7%BB%E4%B8%BA%E5%85%BC%E5%AE%B9php7%E8%AE%B0%E5%BD%95/</p>
:ET