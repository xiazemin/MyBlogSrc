I"Ä5<p>åœ¨5å°ç‰©ç†ä¸»æœºä¸Šçš„è™šæ‹Ÿæœºä¸­éƒ½è£…äº†Dockerï¼Œæ¯å°ä¸­éƒ½æœ‰3ä¸ªå®¹å™¨ï¼Œç°åœ¨è¦è§£å†³å®¹å™¨è·¨ä¸»æœºé€šä¿¡ï¼Œäº”ç§æ–¹æ¡ˆï¼š
ä¸€ã€åˆ©ç”¨OpenVSwitch
äºŒã€åˆ©ç”¨Weave
ä¸‰ã€Dockeråœ¨1.9ä¹‹åæ”¯æŒçš„Overlay networkï¼ˆè¿™ä¸ªå¥½åƒæ˜¯å®˜æ–¹çš„åšæ³•ï¼‰
å››ã€å°†å¤šä¸ªç‰©ç†æœºçš„å®¹å™¨ç»„åˆ°ä¸€ä¸ªç‰©ç†ç½‘ç»œæ¥
        1.åˆ›å»ºè‡ªå·±çš„ç½‘æ¡¥br0
        2.å°†dockeré»˜è®¤ç½‘æ¡¥ç»‘å®šåˆ°br0
äº”ã€ä¿®æ”¹ä¸»æœºdockeré»˜è®¤çš„è™šæ‹Ÿç½‘æ®µï¼Œç„¶ååœ¨å„è‡ªä¸»æœºä¸Šåˆ†åˆ«æŠŠå¯¹æ–¹çš„dockerç½‘æ®µåŠ å…¥åˆ°è·¯ç”±è¡¨ä¸­ï¼Œé…åˆiptableså³å¯å®ç°dockerå®¹å™¨è·¨ä¸»æœºé€šä¿¡
<!-- more -->
è·¨ä¸»æœºå®¹å™¨é€šä¿¡å¤§è‡´æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<ol>
  <li>NATæ–¹å¼
NATå°±æ˜¯ä¼ ç»Ÿçš„dockerç½‘ç»œï¼Œåˆ©ç”¨å®¿ä¸»æœºçš„IPå’ŒIptablesæ¥è¾¾åˆ°å®¹å™¨ï¼Œä¸»æœºä¹‹é—´çš„é€šä¿¡ã€‚å®¹å™¨å¯¹å¤–IPéƒ½æ˜¯å®¿ä¸»æœºçš„IPã€‚åªè¦å®¿ä¸»æœºä¹‹é—´ä¸‰å±‚å¯è¾¾ï¼Œå®¹å™¨ä¹‹é—´å°±å¯ä»¥é€šä¿¡ã€‚</li>
  <li>Tunnelï¼ˆoverlayï¼‰æ–¹å¼
VPNï¼Œipipï¼ŒVXLANç­‰éƒ½æ˜¯tunnelæŠ€æœ¯ï¼Œç®€å•è®²å°±æ˜¯åœ¨å®¹å™¨çš„æ•°æ®åŒ…é—´å°è£…ä¸€å±‚æˆ–å¤šå±‚å…¶ä»–çš„æ•°æ®åè®®å¤´ï¼Œè¾¾åˆ°è¿é€šçš„æ•ˆæœã€‚
Dockerçš„Libnetworkå°±æ”¯æŒvxlançš„overlayæ–¹å¼ï¼Œweaveä¹Ÿæ”¯æŒUDPå’ŒVxlançš„overlayæ¨¡å¼ï¼Œflannelï¼Œcalicoç­‰éƒ½æ”¯æŒoverlayæ¨¡å¼ã€‚
â€¢      Overlayä¸€èˆ¬é€šè¿‡vSwitchæ¥å®ç°ï¼Œæ¯”å¦‚OVS
â€¢      ä¸€èˆ¬éœ€è¦ä¸€ä¸ªå…¨å±€çš„KV
storeï¼ˆsdn controllerã€etcdã€consulï¼‰æ¥ä¿å­˜æ§åˆ¶ä¿¡æ¯ã€‚</li>
  <li>Routingæ–¹å¼
è·¯ç”±æ–¹æ¡ˆä¸»è¦æ˜¯é€šè¿‡è·¯ç”±è®¾ç½®çš„æ–¹å¼è®©å®¹å™¨å¯¹å®¹å™¨ï¼Œå®¹å™¨å¯¹å®¿ä¸»æœºä¹‹é—´ç›¸é€šä¿¡ã€‚ä¾‹å¦‚ï¼šcalicoçš„BGPè·¯ç”±æ–¹æ¡ˆ</li>
  <li>â€œå¤§äºŒå±‚â€æ–¹å¼
å¤§äºŒå±‚å°±æ˜¯å°†ç‰©ç†ç½‘å¡å’Œå®¹å™¨ç½‘ç»œæ¡¥æ¥åˆ°åŒä¸€ä¸ªlinux bridgeã€‚å®¹å™¨ç½‘ç»œå¯ä»¥ç›´æ¥æ¥å…¥è¯¥linux bridgeï¼Œä¹Ÿå¯ä»¥å°†å®¹å™¨ç½‘ç»œæ¥å…¥å®¹å™¨ç½‘æ¡¥docker0ï¼Œå†æŠŠdocker0æ¡¥æ¥åˆ°linux bridgeä¸Šã€‚ç›®çš„æ˜¯ä½¿å¾—å®¹å™¨ç½‘ç»œå’Œå®¿ä¸»æœºç½‘ç»œåœ¨åŒä¸€ä¸ªäºŒå±‚ç½‘ç»œã€‚
docker é»˜è®¤çš„æ¡¥æ¥ç½‘å¡æ˜¯docker0,å®ƒåªä¼šåœ¨æœ¬æœºæ¡¥æ¥æ‰€æœ‰çš„å®¹å™¨ç½‘å¡ï¼Œä¸¾ä¾‹æ¥è¯´å®¹å™¨çš„è™šæ‹Ÿç½‘å¡åœ¨ä¸»æœºä¸Šçœ‹ä¸€èˆ¬å«åšveth<em>**  è€Œdockeråªæ˜¯æŠŠæ‰€æœ‰è¿™äº›ç½‘å¡æ¡¥æ¥åœ¨ä¸€èµ·,è¿™æ ·å°±å¯ä»¥æŠŠè¿™ä¸ªç½‘ç»œçœ‹æˆæ˜¯ä¸€ä¸ªç§æœ‰çš„ç½‘ç»œï¼Œé€šè¿‡nat è¿æ¥å¤–ç½‘ï¼Œå¦‚æœè¦è®©å¤–ç½‘è¿æ¥åˆ°å®¹å™¨ä¸­ï¼Œå°±éœ€è¦åšç«¯å£æ˜ å°„ï¼Œå³-på‚æ•°
 å½“rockerå¯åŠ¨æ—¶ï¼Œä¼šåœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªdocker0çš„è™šæ‹Ÿç½‘å¡ã€‚ä»–éšæœºæŒ‘é€‰RFC1918ç§æœ‰ç½‘ç»œä¸­çš„ä¸€æ®µåœ°å€ç»™docker0ã€‚æ¯”å¦‚172.17.42.1/16,16ä½æ©ç çš„ç½‘æ®µå¯ä»¥æ‹¥æœ‰65534ä¸ªåœ°å€å¯ä»¥ä½¿ç”¨ï¼Œè¿™å¯¹ä¸»æœºå’Œå®¹å™¨æ¥è¯´åº”è¯¥è¶³å¤Ÿäº†ã€‚docker0 ä¸æ˜¯æ™®é€šçš„ç½‘å¡ï¼Œä»–æ˜¯æ¡¥æ¥åˆ°å…¶ä»–ç½‘å¡çš„è™šæ‹Ÿç½‘å¡ï¼Œå®¹å™¨ä½¿ç”¨å®ƒæ¥å’Œä¸»æœºç›¸äº’é€šä¿¡ã€‚å½“åˆ›å»ºä¸€ä¸ªdockerå®¹å™¨çš„æ—¶å€™ï¼Œå®ƒå°±åˆ›å»ºäº†ä¸€ä¸ªå¯¹æ¥å£ï¼Œå½“æ•°æ®åŒ…å‘é€åˆ°ä¸€ä¸ªæ¥å£æ—¶ï¼Œå¦å¤–ä¸€ä¸ªæ¥å£ä¹Ÿå¯ä»¥æ”¶åˆ°ç›¸åŒçš„æ•°æ®åŒ…ï¼Œå®ƒä»¬æ˜¯ç»‘åœ¨ä¸€èµ·ä¸€å¯¹å­ªç”Ÿæ¥å£ã€‚è¿™å¯¹æ¥å£åœ¨å®¹å™¨ä¸­çš„é‚£ä¸ªçš„åå­—æ˜¯eth0ï¼Œä¸»æœºä¸Šçš„æ¥å£ä¼šæŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„åå­—ï¼Œæ¯”å¦‚vethAQI2QTè¿™æ ·çš„åå­—ï¼Œè¿™ç§æ¥å£åå­—ä¸å†ä¸»æœºçš„å‘½åç©ºé—´ä¸­ã€‚æ‰€æœ‰çš„veth</em>çš„æ¥å£éƒ½ä¼šæ¡¥æ¥åˆ°docker0ï¼Œè¿™æ ·dockerå°±åˆ›å»ºäº†åœ¨ä¸»æœºå’Œæ‰€æœ‰å®¹å™¨ä¹‹é—´ä¸€ä¸ªè™šæ‹Ÿå…±äº«ç½‘ç»œã€‚
å¦‚æœåœ¨ä¼ä¸šå†…éƒ¨åº”ç”¨ï¼Œæˆ–åˆ™åšå¤šä¸ªç‰©ç†ä¸»æœºçš„é›†ç¾¤ï¼Œå¯èƒ½éœ€è¦å°†å¤šä¸ªç‰©ç†ä¸»æœºçš„å®¹å™¨ç»„åˆ°ä¸€ä¸ªç‰©ç†ç½‘ç»œä¸­æ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦å°†è¿™ä¸ªç½‘æ¡¥æ¡¥æ¥åˆ°æˆ‘ä»¬æŒ‡å®šçš„ç½‘å¡ä¸Šã€‚ä¸‹é¢ä»¥ubuntuä¸ºä¾‹åˆ›å»ºå¤šä¸ªä¸»æœºçš„å®¹å™¨è”ç½‘ã€‚
ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè‡ªå·±çš„ç½‘æ¡¥
ç¼–è¾‘/etc/network/interfaceæ–‡ä»¶
auro br0
iface bro inet static
address
netmask
gateway
bridge_ports em1
bridge_stp off
dns-nameservers 8.8.8.8 
å°†dockerçš„é»˜è®¤ç½‘æ¡¥ç»‘å®šåˆ°è¿™ä¸ªæ–°å»ºçš„br0ä¸Šé¢ï¼Œè¿™æ ·å°±å°†è¿™å°æœºå™¨ä¸Šå®¹å™¨ç»‘å®šåˆ°em1è¿™ä¸ªç½‘å¡æ‰€å¯¹åº”çš„ç‰©ç†ç½‘ç»œä¸Šäº†ã€‚ubuntuä¿®æ”¹/etc/default/dockeræ–‡ä»¶ æ·»åŠ æœ€åä¸€è¡Œå†…å®¹
DOCKER_OPTS=â€-b=br0â€
è¿™æ”¹å˜é»˜è®¤çš„dockerç½‘å¡ç»‘å®šï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºå¤šä¸ªç½‘æ¡¥ç»‘å®šåˆ°å¤šä¸ªç‰©ç†ç½‘å¡ä¸Šï¼Œåœ¨å¯åŠ¨dockerçš„æ—¶å€™ ä½¿ç”¨-bå‚æ•° ç»‘å®šåˆ°å¤šä¸ªä¸åŒçš„ç‰©ç†ç½‘ç»œä¸Šã€‚
é‡å¯dockeræœåŠ¡åï¼Œå†è¿›å…¥å®¹å™¨å¯ä»¥çœ‹åˆ°å®ƒå·²ç»ç»‘å®šåˆ°ä½ çš„ç‰©ç†ç½‘ç»œä¸Šäº†ï¼Œè¿™æ ·å°±ç›´æ¥æŠŠå®¹å™¨æš´éœ²åˆ°ä½ çš„ç‰©ç†ç½‘ç»œä¸Šäº†ï¼Œå¤šå°ç‰©ç†ä¸»æœºçš„å®¹å™¨ä¹Ÿå¯ä»¥ç›¸äº’è”ç½‘äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ ·å°±éœ€è¦è‡ªå·±æ¥ä¿è¯å®¹å™¨çš„ç½‘ç»œå®‰å…¨äº†ã€‚
Dockerå‘å¸ƒäº†1.9ç‰ˆæœ¬ï¼Œå®ç°äº†åŸæœ¬å®éªŒæ€§çš„Networkingç»„ä»¶çš„æ”¯æŒã€‚ç”¨æˆ·å¯ä»¥åœ¨Swarmä¸­ä½¿ç”¨å®ƒæˆ–è€…å°†å…¶ä½œä¸ºCompose å·¥å…·ã€‚åˆ›å»ºè™šæ‹Ÿç½‘ç»œå¹¶å°†å…¶è¿æ¥åˆ°å®¹å™¨ä¸Šï¼Œå¯å®ç°å¤šä¸ªä¸»æœºä¸Šå®¹å™¨ç›¸äº’é€šä¿¡ï¼Œå¹¶ä¸”å®ç°ä¸åŒçš„åº”ç”¨ç¨‹åºæˆ–è€…åº”ç”¨ç¨‹åºä¸åŒéƒ¨åˆ†èƒ½å¤Ÿç›¸äº’éš”ç¦»ã€‚äº’è”å­ç³»ç»Ÿè®¾è®¡ä¸ºå¯æ’æ‹”å¼ï¼Œå…¼å®¹VXLANæˆ–è€…IPVLANç­‰æŠ€æœ¯ã€‚
Docker å®¹å™¨å®ç°è·¨ä¸»æœºé€šè®¯ä¸»è¦é€šè¿‡å‡ ç§æ–¹å¼ï¼šè‡ªå¸¦overlay networkæ’ä»¶ï¼Œç¬¬ä¸‰æ–¹æ’ä»¶å¦‚weaveã€ovsç­‰ï¼Œdocker swarmï¼ˆè™½ç„¶ä¹Ÿæ˜¯é€šè¿‡key value serviceè¿›è¡Œè°ƒç”¨ï¼‰ã€‚åœ¨è¿™é‡Œä¸»è¦ä»‹ç»ç›´æ¥ä½¿ç”¨è‡ªå¸¦æ’ä»¶ï¼Œä»¥åŠé€šè¿‡docker swarmçš„ä¸¤ç§å®ç°æ–¹å¼ã€‚
ç›´æ¥ä½¿ç”¨è‡ªå¸¦æ’ä»¶å®ç°å®¹å™¨è·¨ä¸»æœºè®¿é—®
æµ‹è¯•ç¯å¢ƒä¸ºubuntu14.04ã€‚æ ¹æ®dockerå»ºè®®è¦æ±‚ï¼Œå°†å†…æ ¸å‡çº§åˆ°3.19.å¦‚æœå†…æ ¸ç‰ˆæœ¬è¿‡ä½ï¼Œå°†ä¼šå‡ºç°overlay networkåˆ›å»ºå¤±è´¥æˆ–åŠ å…¥å¤±è´¥ç­‰ä¸€ç³»åˆ—é—®é¢˜ã€‚
å†…æ ¸å‡çº§
 #apt-get install linux-generic-lts-vivid
å‡çº§å®Œæˆï¼Œé‡å¯ä¸»æœºã€‚
 # uname -a
Linux ukub09 3.19.0-33-generic #38~14.04.1-Ubuntu SMP Fri Nov 6 18:17:28 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux
å¯åŠ¨key value service
å¯ä»¥é€‰æ‹©ä½¿ç”¨zookeeperã€etcdã€consulç­‰å¤šç§ç»„ä»¶ã€‚æœ¬ä¾‹ä½¿ç”¨é¢å¤–ä¸€å°è™šæ‹Ÿæœºï¼Œå¯ç”¨å’Œå®˜æ–¹æ–‡æ¡£ç›¸ä¸€è‡´çš„consulé•œåƒã€‚
docker $(docker-machine config consul2) run -d <br />
-p â€œ8501:8500â€ <br />
-h â€œconsulâ€ <br />
progrium/consul -server -bootstrap
æ­¤æ—¶å¯ä»¥é€šè¿‡ip:8501å¯¹consulæœåŠ¡è¿›è¡Œè®¿é—®ã€‚
å°†key value serviceä¿¡æ¯åŠ å…¥docker daemon
ä¿®æ”¹å¸Œæœ›åŠ å…¥docker overlay networkçš„æ‰€æœ‰ä¸»æœºä¸Šdocker daemonæœåŠ¡ã€‚
#vi /etc/dafault/docker
DOCKER_OPTS=â€™
-H tcp://0.0.0.0:2376
-H unix:///var/run/docker.sock
â€“cluster-store=consul://172.25.2.43:8501
â€“cluster-advertise=eth0:2376â€™
é€šè¿‡ä¿®æ”¹ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°å®ç°
â€“cluster-store= å‚æ•°æŒ‡å‘docker daemonæ‰€ä½¿ç”¨key value serviceçš„åœ°å€
â€“cluster-advertise= å‚æ•°å†³å®šäº†æ‰€ä½¿ç”¨ç½‘å¡ä»¥åŠdocker daemonç«¯å£ä¿¡æ¯
é‡å¯dockeræœåŠ¡ã€‚
#service docker restart
docker ç½‘ç»œçš„åˆ›å»ºä¸æ“ä½œ
æ­¤æ—¶å¯ä»¥é€šè¿‡docker network createåˆ›å»º-d overlayå±æ€§çš„é©±åŠ¨ã€‚
#docker network create -d overlay over
åˆ—å‡ºå½“å‰ç½‘ç»œ
root@ukub10:~# docker network ls
NETWORK ID          NAME                DRIVER
b95efb2ab985        over                overlay           <br />
0a4a123fc278        bridge              bridge            <br />
2da9ecadf108        none                null              <br />
5ca3275ec2a9        host                host      <br />
åœ¨å¦ä¸€å°å·²åŠ å…¥key value serviceæŒ‡å‘çš„ä¸»æœºä¸ŠåŒæ ·å¯ä»¥çœ‹åˆ°è¿™ä¸ªç½‘ç»œ
root@ukub09:~# docker network ls
NETWORK ID          NAME                DRIVER
b95efb2ab985        over                overlay           <br />
b5f9713c9f2b        bridge              bridge            <br />
16e1cdf30f97        none                null              <br />
cf257529463c        host                host
dockerç½‘ç»œçš„è¿æ¥æ–¹å¼
å¯ä»¥åœ¨ä¸¤å°ä¸»æœºä¸Šåˆ†åˆ«åˆ›å»ºå®¹å™¨ï¼Œäº’ç›¸è¿›è¡Œpingæˆ–sshè®¿é—®ã€‚å®˜æ–¹æ–‡æ¡£ä¾‹å­åˆ›å»ºä¸€ä¸ªnginxå®¹å™¨ï¼Œå¹¶åœ¨å¦ä¸€ä¸ªå®¹å™¨å†…æŠ“å–å…¶çŠ¶æ€è¿›è¡ŒéªŒè¯ã€‚è¿™é‡Œä¸å†è¯¦è¿°ã€‚
åˆ›å»ºå®¹å™¨æ¥å…¥æŒ‡å®šç½‘ç»œ
#docker run -itd â€“name=testcontainer â€“net=over  nginx
å°†å®¹å™¨ä»æŒ‡å®šç½‘ç»œä¸­é€€å‡º
#docker network disconnect over testcontainer 
é‡æ–°è¿å…¥æŒ‡å®šç½‘ç»œ
#docker network connect over testcontainer
è¿æ¥ä¸æ–­å¼€å°†ä¼šæ˜¯å®æ—¶çš„ã€‚åœ¨è¿æ¥ä¹‹åï¼Œå³å¯é€šè¿‡å®¹å™¨åè®¿é—®æœ¬ç½‘ç»œä¸­æ‰€æœ‰å®¹å™¨ã€‚
ä½¿ç”¨Swarmåˆ›å»ºdocker clusterå®ç°è·¨ä¸»æœºç®¡ç†å’Œç½‘ç»œè®¿é—®
æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œéœ€è¦æ­å»ºèµ·åŸºäºswarmçš„clusterï¼Œæ¥å®ç°Docker overlay networkã€‚ä¸ºéƒ¨ç½²æ•´å¥—Docker clusterï¼Œéœ€è¦å®‰è£…docker machine/compose/swarmç­‰ç»„ä»¶ã€‚
ä½¿ç”¨ç¬¬ä¸‰æ–¹ç½‘ç»œæ’ä»¶å®ç°è·¨ä¸»æœºå®¹å™¨é€šè®¯ä¹Ÿå˜å¾—æ›´å®¹æ˜“äº†ã€‚
å®‰è£…docker machine
docker machineç”¨æ¥è¿›è¡Œdockerçš„æ¨é€å®‰è£…ï¼Œå¯ä»¥åœ¨è®¸å¤šdriverä¸Šå®‰è£…éƒ¨ç½²dockerï¼š
amazonec2 azure digitalocean exoscale generic google none
openstack rackspace softlayer virtualbox vmwarevcloudair
vmwarevsphere
é¦–å…ˆéœ€è¦å®‰è£…å¥½docker engineï¼Œä¹‹åä¸‹è½½å¹¶å°†docker machineçš„åº“æ–‡ä»¶ç§»åŠ¨åˆ°binä¸‹ã€‚
#curl -L https://github.com/docker/machine/releases/download/v0.5.0/docker-machine_linux-amd64.zip &gt;machine.zip &amp;&amp; <br />
unzip machine.zip &amp;&amp; <br />
rm machine.zip &amp;&amp; <br />
mv docker-machine* /usr/local/bin
éªŒè¯å®‰è£…
    <h1 id="docker-machine--v">docker-machine -v</h1>
    <p>docker-machine version 0.5.0 (04cfa58)
docker-machine ls
NAME   ACTIVE   DRIVER   STATE   URL   SWARM
å®˜æ–¹æ–‡æ¡£çš„ä½¿ç”¨virtualboxè¿›è¡Œå„ç§è§’è‰²ä¸»æœºçš„å¯ç”¨ã€‚æœ¬ç¯‡æ–‡æ¡£åˆ™åœ¨å·²æœ‰çš„è™šæ‹Ÿæœºç¯å¢ƒä¸­è¿›è¡Œã€‚
ä½¿ç”¨docker-machineè¿›è¡Œæ¨é€å®‰è£…
é¦–å…ˆéœ€è¦æ‹¥æœ‰ä¸€å°linuxç³»ç»Ÿï¼Œå¹¶ä½¿docker-machineä¸»æœºå¯ä»¥æ— å¯†ç è®¿é—®åˆ°è¿™å°ç³»ç»Ÿã€‚
#ssh-copy-id -i /root/.ssh/id_rsa.pub root@172.25.2.43
ä¹‹åå³å¯é€šè¿‡docker-machineè¿›è¡Œå®‰è£…ã€‚
å®‰è£…é€šè¿‡internetä¸‹è½½ç›¸å…³åŒ…ï¼Œå¹¶é€šè¿‡docker-machineè¿›è¡Œè®¾ç½®å®‰è£…çš„ã€‚å¿…é¡»ä¿è¯ç½‘ç»œç•…é€šï¼Œå¦åˆ™å¯èƒ½å®‰è£…å¤±è´¥ã€‚
#docker-machine create -d generic â€“generic-ip-address=172.25.2.43 â€“generic-ssh-user=root test5
å®‰è£…åï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰è¢«docker-machineå®‰è£…æ§åˆ¶åçš„ä¸»æœºçŠ¶æ€</p>
    <h1 id="docker-machine-ls">docker-machine ls</h1>
    <p>NAME        ACTIVE   DRIVER    STATE     URL                      SWARM
c0-master   -        generic   Running   tcp://172.25.2.44:2376   c0-master (master)
c0-n1       -        generic   Running   tcp://172.25.2.45:2376   c0-master
c0-n2       -        generic   Running   tcp://172.25.2.46:2376   c0-master
dm01        -        generic   Running   tcp://172.25.2.43:2376 <br />
local       -        generic   Running   tcp://172.25.2.34:2376
å¯ä»¥æŸ¥çœ‹ç›¸åº”ä¸»æœºçš„ç¯å¢ƒå˜é‡
#docker-machine env local 
æŠŠå½“å‰æ“ä½œç¯å¢ƒå˜æ›´ä¸ºæŒ‡å®šä¸»æœº
#eval â€œ$(docker-machine env local)â€
åœ¨docker-machineä¸»æœºä¸Šæ“çºµhost
 #docker $(docker-machine config local) run -tid ubuntu /bin/bash
é€šè¿‡sshè¿æ¥åˆ°ç›¸åº”ä¸»æœº
 # docker-machine ssh dm01
Docker Composeå®‰è£…
docker composeç”¨äºåŒæ—¶å¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œæ„æˆåŒä¸€ç»„åº”ç”¨ç¯å¢ƒï¼Œåœ¨è¿™é‡Œç”¨äºæ”¯æŒswarmçš„å®‰è£…ã€‚
curl -L https://github.com/docker/comp â€¦ ose-X 10X- uname -m &gt; /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
 Docker Swarmé›†ç¾¤å®‰è£…
å¯ç”¨ä¸€å°ä¸»æœºå®‰è£…key value serviceï¼Œç”¨äºèŠ‚ç‚¹ã€ä¸»æœºå‘ç°ç­‰å·¥ä½œã€‚
æœ¬ä¾‹ä½¿ç”¨äº†consulçš„é•œåƒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚etcdã€zookeeperç­‰ç»„ä»¶ã€‚
åœ¨dm01ä¸Šå¯åŠ¨ä¸€ä¸ªconsulæœåŠ¡ï¼š
docker $(docker-machine config dm01) run -d <br />
-p â€œ8500:8500â€ <br />
-h â€œconsulâ€ <br />
progrium/consul -server -bootstrap
åˆ›å»ºswarmé›†ç¾¤å¯ä»¥é€šè¿‡key valueæœåŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨swarm cluster IDå­—ç¬¦ä¸²åˆ›å»ºã€‚
åˆ›å»ºswarm manager
docker-machine create <br />
-d generic â€“generic-ip-address=172.25.2.44 â€“generic-ssh-user=root<br />
â€“swarm <br />
â€“swarm-master <br />
â€“swarm-discovery=â€consul://$(docker-machine ip dm01):8500â€ <br />
â€“engine-opt=â€cluster-store=consul://$(docker-machine ip dm01):8500â€ <br />
â€“engine-opt=â€cluster-advertise=eth0:2376â€ <br />
c0-master
åˆ›å»ºswarm node
docker-machine create <br />
-d generic â€“generic-ip-address=172.25.2.45 â€“generic-ssh-user=root <br />
â€“swarm <br />
â€“swarm-discovery=â€consul://$(docker-machine ip dm01):8500â€ <br />
â€“engine-opt=â€cluster-store=consul://$(docker-machine ip dm01):8500â€ <br />
â€“engine-opt=â€cluster-advertise=eth0:2376â€ <br />
c0-n1
docker-machine create <br />
-d generic â€“generic-ip-address=172.25.2.46 â€“generic-ssh-user=root <br />
â€“swarm <br />
â€“swarm-discovery=â€consul://$(docker-machine ip dm01):8500â€ <br />
â€“engine-opt=â€cluster-store=consul://$(docker-machine ip dm01):8500â€ <br />
â€“engine-opt=â€cluster-advertise=eth0:2376â€ <br />
c0-n2
Overlay Networkåˆ›å»º
è®¾ç½®ç¯å¢ƒå˜é‡
 #eval â€œ$(docker-machine env â€“swarm c0-master)â€
å¯ä»¥ç”¨docker infoçœ‹åˆ°ç°åœ¨çš„é›†ç¾¤çŠ¶å†µ
 #docker network create -d overlay myStack1
root@local:~# docker network ls
NETWORK ID          NAME                DRIVER
685ed9e9f701        myStack1            overlay           <br />
4c88e7c52a7c        c0-n1/bridge        bridge            <br />
7fd49a4f6a64        c0-n1/none          null              <br />
8b2372139902        c0-n2/host          host              <br />
d998a91dcfea        c0-n2/bridge        bridge            <br />
afd7a1190fb4        c0-n2/none          null              <br />
0f2b5dae67f7        c0-n1/host          host              <br />
a45b8049f8e6        c0-master/bridge    bridge            <br />
d13eed83f250        c0-master/none      null              <br />
364a592ae9ae        c0-master/host      host<br />
æµ‹è¯•
åœ¨c0-n1ä¸Šå¯åŠ¨ä¸€ä¸ªnginxï¼Œå¹¶åŠ å…¥myStack1ç½‘ç»œ
 #docker run -itd â€“name=web â€“net=myStack1 â€“env=â€constraint:node==c0-n1â€ nginx
åœ¨c0-n2ä¸Šå¯åŠ¨ä¸€ä¸ªshellï¼ŒåŒæ ·åŠ å…¥myStack1ç½‘ç»œ
 #docker run -ti â€“name=webtest â€“net=myStack1 â€“env=â€constraint:node==c0-n2â€ ubuntu /bin/bash
åœ¨shellä¸­å°†å¯ä»¥é€šè¿‡å®¹å™¨åæˆ–ipè·å–åˆ°webå®¹å™¨çš„çŠ¶æ€
{{{#apt-get install wget
wget -O- http://web }}}
dockeråœ¨å®˜æ–¹æ–‡æ¡£ä¸Šä¸»æ¨ä»¥swarmçš„æ–¹å¼åˆ›å»ºclusterï¼Œç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œä½†æä¾›äº†æ•´ä½“Clusterçš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å°†å®¹å™¨è¿›è¡Œæ•´ä½“ç®¡ç†ã€æ¨é€ã€ä½¿ç”¨ã€‚</p>
  </li>
</ol>
:ET