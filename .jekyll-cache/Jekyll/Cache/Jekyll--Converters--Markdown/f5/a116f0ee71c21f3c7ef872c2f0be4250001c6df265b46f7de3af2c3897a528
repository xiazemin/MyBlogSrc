I"øC<p>goå¦‚ä½•å®æ—¶ç›‘æµ‹å½“å‰è¿›ç¨‹ç”Ÿæˆçš„goroutineåç¨‹æ•°é‡ï¼Ÿ
runtime.NumGoroutine()
è¿”å›å½“å‰çš„è¿è¡Œæ—¶çš„goåç¨‹æ•°ã€‚</p>

<p>Linux æŸ¥çœ‹è¿›ç¨‹çš„çº¿ç¨‹æ•°
ä¸‰ç§æ–¹æ³•ï¼š</p>

<p>1ã€‚ ä½¿ç”¨topå‘½ä»¤ï¼Œå…·ä½“ç”¨æ³•æ˜¯ top -H</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    åŠ ä¸Šè¿™ä¸ªé€‰é¡¹ï¼Œtopçš„æ¯ä¸€è¡Œå°±ä¸æ˜¯æ˜¾ç¤ºä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œæ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚
</code></pre></div></div>

<p>2ã€‚ ä½¿ç”¨pså‘½ä»¤ï¼Œå…·ä½“ç”¨æ³•æ˜¯ ps -xH</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    è¿™æ ·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å­˜åœ¨çš„çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨grepä½œè¿›ä¸€æ­¥çš„è¿‡æ»¤ã€‚
</code></pre></div></div>

<p>3ã€‚ ä½¿ç”¨pså‘½ä»¤ï¼Œå…·ä½“ç”¨æ³•æ˜¯ ps -mq PID</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    è¿™æ ·å¯ä»¥çœ‹åˆ°æŒ‡å®šçš„è¿›ç¨‹äº§ç”Ÿçš„çº¿ç¨‹æ•°ç›®ã€‚
</code></pre></div></div>

<p>1.æ ¹æ®è¿›ç¨‹å·è¿›è¡ŒæŸ¥è¯¢ï¼š</p>

<h1 id="pstree--p-è¿›ç¨‹å·">pstree -p è¿›ç¨‹å·</h1>

<h1 id="top--hp-è¿›ç¨‹å·">top -Hp è¿›ç¨‹å·</h1>

<p>2.æ ¹æ®è¿›ç¨‹åå­—è¿›è¡ŒæŸ¥è¯¢ï¼š</p>

<h1 id="pstree--p-ps--e--grep-server--awk-print-1">pstree -p <code class="language-plaintext highlighter-rouge">ps -e | grep server | awk '{print $1}'</code></h1>

<h1 id="pstree--p-ps--e--grep-server--awk-print-1--wc--l">pstree -p <code class="language-plaintext highlighter-rouge">ps -e | grep server | awk '{print $1}'</code> | wc -l</h1>

<p>æ›´è¿›ä¸€æ­¥ï¼Œå…¶å®ä¸€äº›ç³»ç»Ÿç›‘æ§å·¥å…·ï¼Œåœ¨æœ¬è´¨ä¸Šä¹Ÿæ˜¯è¯»å–çš„ç³»ç»Ÿäº§ç”Ÿçš„æ–‡ä»¶ç½¢äº†ã€‚æ¯”å¦‚è¯´è¿›ç¨‹è¿™ä¸ªäº‹æƒ…ï¼Œ</p>

<p>ç°åœ¨å‡è®¾æœ‰è¿›ç¨‹å·ä¸º 5000 çš„è¿›ç¨‹ï¼ŒæŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹çš„æ‰€æœ‰å…·ä½“ä¿¡æ¯ï¼Œåœ¨å“ªæŸ¥çœ‹å‘¢?</p>

<p>çœ‹çœ‹è¿™ä¸ªç›®å½•å§ï¼Œ/proc/5000/ è¿™é‡Œé¢æœ‰ä½ æ‰€æœ‰æƒ³è¦çš„ã€‚å…¶å®statä»£è¡¨ç€å½“å‰çš„ä¸€äº›ä¿¡æ¯ã€‚</p>

<p>ä½¿ç”¨pså‘½ä»¤æ¥æŸ¥çœ‹è¿›ç¨‹çš„æ—¶å€™ï¼Œè¿›ç¨‹çŠ¶æ€åˆ†åˆ«å¯¹åº”çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>

<p>D    ä¸å¯ä¸­æ–­ç¡çœ  (é€šå¸¸æ˜¯åœ¨IOæ“ä½œ) æ”¶åˆ°ä¿¡å·ä¸å”¤é†’å’Œä¸å¯è¿è¡Œ, è¿›ç¨‹å¿…é¡»ç­‰å¾…ç›´åˆ°æœ‰ä¸­æ–­å‘ç”Ÿ
R   æ­£åœ¨è¿è¡Œæˆ–å¯è¿è¡Œï¼ˆåœ¨è¿è¡Œé˜Ÿåˆ—æ’é˜Ÿä¸­ï¼‰
S   å¯ä¸­æ–­ç¡çœ  (ä¼‘çœ ä¸­, å—é˜», åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å½¢æˆæˆ–æ¥å—åˆ°ä¿¡å·)
T   å·²åœæ­¢çš„ è¿›ç¨‹æ”¶åˆ°SIGSTOP, SIGSTP, SIGTIN, SIGTOUä¿¡å·ååœæ­¢è¿è¡Œ
W   æ­£åœ¨æ¢é¡µ(2.6.å†…æ ¸ä¹‹å‰æœ‰æ•ˆ)
 X   æ­»è¿›ç¨‹ (æœªå¼€å¯)
 Z   åƒµå°¸è¿›ç¨‹  è¿›ç¨‹å·²ç»ˆæ­¢, ä½†è¿›ç¨‹æè¿°ç¬¦å­˜åœ¨, ç›´åˆ°çˆ¶è¿›ç¨‹è°ƒç”¨wait4()ç³»ç»Ÿè°ƒç”¨åé‡Šæ”¾BSDé£æ ¼çš„
 &lt;   é«˜ä¼˜å…ˆçº§(not nice to other users)
 N   ä½ä¼˜å…ˆçº§(nice to other users)
 L   é¡µé¢é”å®šåœ¨å†…å­˜ï¼ˆå®æ—¶å’Œå®šåˆ¶çš„IOï¼‰
 s   ä¸€ä¸ªä¿¡æ¯å¤´
 l   å¤šçº¿ç¨‹ï¼ˆä½¿ç”¨ CLONE_THREADï¼ŒåƒNPTLçš„pthreadsçš„é‚£æ ·ï¼‰</p>
<ul>
  <li>åœ¨å‰å°è¿›ç¨‹ç»„</li>
</ul>

<ol>
  <li>pstree</li>
</ol>

<p>pstreeä»¥æ ‘ç»“æ„æ˜¾ç¤ºè¿›ç¨‹</p>

<ol>
  <li>ps -Lf</li>
</ol>

<p>$ ps -Lf 1892</p>

<p>$ pstree -p 10536
xzm(10536)â”€â”¬â”€{xzm}(10537)
           â”œâ”€{xzm}(10538)
           â””â”€{xzm}(10539)
$ ps -Lf 10536
UID        PID  PPID   LWP  C NLWP STIME TTY      STAT   TIME CMD
xiaoju   10536  9374 10536  0    4 11:09 pts/0    Sl     0:00 ./xzm
xiaoju   10536  9374 10537  0    4 11:09 pts/0    Sl     0:00 ./xzm
xiaoju   10536  9374 10538  0    4 11:09 pts/0    Sl     0:00 ./xzm
xiaoju   10536  9374 10539  0    4 11:09 pts/0    Sl     0:00 ./xzm</p>

<p>ä¹ä¸€çœ‹ï¼Œps -Lf æ¯” pstree å¤šäº†ä¸€é¡¹ï¼Œæ£€æŸ¥ä¸‹LWP è¿™ä¸€åˆ—ï¼Œå‘ç°idæ•°æ˜¯å¯¹åº”çš„ï¼ŒåŸå› ï¼Œps -Lf åŒ…å«äº†çˆ¶çº¿ç¨‹</p>

<p>$ ps -hH -p 10536
10536 pts/0    Sl     0:00 ./xzm
10536 pts/0    Sl     0:00 ./xzm
10536 pts/0    Sl     0:00 ./xzm
10536 pts/0    Sl     0:00 ./xzm</p>

<p>$ ps -mq 10536
  PID TTY          TIME CMD
10536 pts/0    00:00:00 xzm
    - -        00:00:00 -
    - -        00:00:00 -
    - -        00:00:00 -
    - -        00:00:00 -</p>

<p>package main</p>

<p>import (
  â€œfmtâ€
  â€œtimeâ€
)</p>

<p>func main()  {
  fmt.Println(â€œhelloâ€)
  time.Sleep(10000*time.Second)
}</p>

<p>è¿™æ®µä»£ç æœ‰4ä¸ªç³»ç»Ÿçº¿ç¨‹</p>

<p>[xiaoju@5ad7acb94725 ~]$ pstack 10536
Thread 1 (process 10536):
#0  runtime.futex () at /usr/local/go1.13.3/src/runtime/sys_linux_amd64.s:536
#1  0x0000000000427264 in runtime.futexsleep (addr=0x561380 &lt;runtime.timers+32&gt;, val=0, ns=9999999990864) at /usr/local/go1.13.3/src/runtime/os_linux.go:50
#2  0x0000000000409bbe in runtime.notetsleep_internal (n=0x561380 &lt;runtime.timers+32&gt;, ns=9999999990864, ~r2=<optimized out="">) at /usr/local/go1.13.3/src/runtime/lock_futex.go:193
#3  0x0000000000409d1c in runtime.notetsleepg (n=0x561380 &lt;runtime.timers+32&gt;, ns=9999999990864, ~r2=<optimized out="">) at /usr/local/go1.13.3/src/runtime/lock_futex.go:228
#4  0x0000000000444ff1 in runtime.timerproc (tb=0x561360 <runtime.timers>) at /usr/local/go1.13.3/src/runtime/time.go:311
#5  0x0000000000453851 in runtime.goexit () at /usr/local/go1.13.3/src/runtime/asm_amd64.s:1357
#6  0x0000000000561360 in ?? ()
#7  0x0000000000000000 in ?? ()
[xiaoju@5ad7acb94725 ~]$ pstack 10537
Thread 1 (process 10537):
#0  runtime.futex () at /usr/local/go1.13.3/src/runtime/sys_linux_amd64.s:536
#1  0x0000000000427264 in runtime.futexsleep (addr=0x55ead0 &lt;runtime.sched+272&gt;, val=0, ns=60000000000) at /usr/local/go1.13.3/src/runtime/os_linux.go:50
#2  0x0000000000409bbe in runtime.notetsleep_internal (n=0x55ead0 &lt;runtime.sched+272&gt;, ns=60000000000, ~r2=<optimized out="">) at /usr/local/go1.13.3/src/runtime/lock_futex.go:193
#3  0x0000000000409c91 in runtime.notetsleep (n=0x55ead0 &lt;runtime.sched+272&gt;, ns=60000000000, ~r2=<optimized out="">) at /usr/local/go1.13.3/src/runtime/lock_futex.go:216
#4  0x00000000004355ae in runtime.sysmon () at /usr/local/go1.13.3/src/runtime/proc.go:4316
#5  0x000000000042dec3 in runtime.mstart1 () at /usr/local/go1.13.3/src/runtime/proc.go:1201
#6  0x000000000042ddde in runtime.mstart () at /usr/local/go1.13.3/src/runtime/proc.go:1167
#7  0x00000000004557d3 in runtime.clone () at /usr/local/go1.13.3/src/runtime/sys_linux_amd64.s:587
#8  0x0000000000000000 in ?? ()
[xiaoju@5ad7acb94725 ~]$ pstack 10538
Thread 1 (process 10538):
#0  runtime.futex () at /usr/local/go1.13.3/src/runtime/sys_linux_amd64.s:536
#1  0x00000000004271e6 in runtime.futexsleep (addr=0xc00009c4c8, val=0, ns=-1) at /usr/local/go1.13.3/src/runtime/os_linux.go:44
#2  0x0000000000409a3f in runtime.notesleep (n=0xc00009c4c8) at /usr/local/go1.13.3/src/runtime/lock_futex.go:151
#3  0x000000000042f2c0 in runtime.stopm () at /usr/local/go1.13.3/src/runtime/proc.go:1928
#4  0x00000000004303df in runtime.findrunnable (gp=0xc000026500, inheritTime=false) at /usr/local/go1.13.3/src/runtime/proc.go:2391
#5  0x000000000043108e in runtime.schedule () at /usr/local/go1.13.3/src/runtime/proc.go:2524
#6  0x00000000004313cd in runtime.park_m (gp=0xc000001200) at /usr/local/go1.13.3/src/runtime/proc.go:2610
#7  0x00000000004518eb in runtime.mcall () at /usr/local/go1.13.3/src/runtime/asm_amd64.s:318
#8  0x0000000000000000 in ?? ()
[xiaoju@5ad7acb94725 ~]$ pstack 10539
Thread 1 (process 10539):
#0  runtime.futex () at /usr/local/go1.13.3/src/runtime/sys_linux_amd64.s:536
#1  0x00000000004271e6 in runtime.futexsleep (addr=0xc00009c848, val=0, ns=-1) at /usr/local/go1.13.3/src/runtime/os_linux.go:44
#2  0x0000000000409a3f in runtime.notesleep (n=0xc00009c848) at /usr/local/go1.13.3/src/runtime/lock_futex.go:151
#3  0x000000000042f2c0 in runtime.stopm () at /usr/local/go1.13.3/src/runtime/proc.go:1928
#4  0x00000000004303df in runtime.findrunnable (gp=0xc000028a00, inheritTime=false) at /usr/local/go1.13.3/src/runtime/proc.go:2391
#5  0x000000000043108e in runtime.schedule () at /usr/local/go1.13.3/src/runtime/proc.go:2524
#6  0x00000000004313cd in runtime.park_m (gp=0xc000000c00) at /usr/local/go1.13.3/src/runtime/proc.go:2610
#7  0x00000000004518eb in runtime.mcall () at /usr/local/go1.13.3/src/runtime/asm_amd64.s:318
#8  0x0000000000000000 in ?? ()</optimized></optimized></runtime.timers></optimized></optimized></p>

<p>å¯¹æ¯”å‘ç°ï¼š
10536  runtime.timerproc (tb=0x561360 <runtime.timers>)
10537  runtime.sysmon ()
10538  runtime.schedule ()
10539  runtime.schedule ()</runtime.timers></p>

<p>è¯´æ˜é™¤äº†ä¸»çº¿ç¨‹åºå’Œ sysmonçº¿ç¨‹ï¼Œå³ä½¿æ²¡æœ‰ç”¨æˆ·goroutineï¼Œç³»ç»Ÿä¹Ÿä¼šå¯åŠ¨ä¸¤ä¸ªç©ºé—²çš„M
<!-- more -->
æŸ¥çœ‹è¿›ç¨‹æ€»æ•°
ps -ef | wc -l
1
æŸ¥çœ‹ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§è¿›ç¨‹æ•°
sysctl kernel.pid_max
1
æŸ¥çœ‹å½“å‰è¿›ç¨‹æ•°
ps -eLf | wc -l
1
ä¿®æ”¹æœ€å¤§è¿›ç¨‹æ•°
echo â€œkernel.pid_max=1000000 â€œÂ Â» /etc/sysctl.conf
sysctl -p
1
2
æŸ¥çœ‹æŸä¸ªæœåŠ¡çš„è¿›ç¨‹æ•°
egï¼šhttpæœåŠ¡ï¼š</p>

<p>ps -ef | grep httpd | wc -l
1
æŸ¥çœ‹ç‰©ç†cpuä¸ªæ•°
grep â€˜physical idâ€™ /proc/cpuinfo | sort -u
1
æŸ¥çœ‹æ ¸å¿ƒæ•°é‡
grep â€˜core idâ€™ /proc/cpuinfo | sort -u | wc -l
1
æŸ¥çœ‹çº¿ç¨‹æ•°
grep â€˜processorâ€™ /proc/cpuinfo | sort -u | wc -l</p>

<ol>
  <li>pstree</li>
</ol>

<p>pstreeä»¥æ ‘ç»“æ„æ˜¾ç¤ºè¿›ç¨‹
$ pstree -p work | grep ad
sshd(22669)â€”bash(22670)â€”ad_preprocess(4551)-+-{ad_preprocess}(4552)
                                                |-{ad_preprocess}(4553)
                                                |-{ad_preprocess}(4554)
                                                |-{ad_preprocess}(4555)
                                                |-{ad_preprocess}(4556)
                                                `-{ad_preprocess}(4557)</p>

<p>workä¸ºå·¥ä½œç”¨æˆ·ï¼Œ-pä¸ºæ˜¾ç¤ºè¿›ç¨‹è¯†åˆ«ç ï¼Œad_preprocesså…±å¯åŠ¨äº†6ä¸ªå­çº¿ç¨‹ï¼ŒåŠ ä¸Šä¸»çº¿ç¨‹å…±7ä¸ªçº¿ç¨‹</p>

<ol>
  <li>ps -Lf
$ ps -Lf 4551
UID        PID  PPID   LWP  C NLWP STIME TTY      STAT   TIME CMD
work      4551 22670  4551  2    7 16:30 pts/2    Sl+    0:02 ./ad_preprocess
work      4551 22670  4552  0    7 16:30 pts/2    Sl+    0:00 ./ad_preprocess
work      4551 22670  4553  0    7 16:30 pts/2    Sl+    0:00 ./ad_preprocess
work      4551 22670  4554  0    7 16:30 pts/2    Sl+    0:00 ./ad_preprocess
work      4551 22670  4555  0    7 16:30 pts/2    Sl+    0:00 ./ad_preprocess
work      4551 22670  4556  0    7 16:30 pts/2    Sl+    0:00 ./ad_preprocess
work      4551 22670  4557  0    7 16:30 pts/2    Sl+    0:00 ./ad_preprocess</li>
</ol>

<p>è¿›ç¨‹å…±å¯åŠ¨äº†7ä¸ªçº¿ç¨‹</p>
<ol>
  <li>pstack</li>
</ol>

<p>pstackæ˜¾ç¤ºæ¯ä¸ªè¿›ç¨‹çš„æ ˆè·Ÿè¸ª
$ pstack 4551
Thread 7 (Thread 1084229984 (LWP 4552)):
#0  0x000000302afc63dc in epoll_wait () from /lib64/tls/libc.so.6
#1  0x00000000006f0730 in ub::EPollEx::poll ()
#2  0x00000000006f172a in ub::NetReactor::callback ()
#3  0x00000000006fbbbb in ub::UBTask::CALLBACK ()
#4  0x000000302b80610a in start_thread () from /lib64/tls/libpthread.so.0
#5  0x000000302afc6003 in clone () from /lib64/tls/libc.so.6
#6  0x0000000000000000 in ?? ()
Thread 6 (Thread 1094719840 (LWP 4553)):
#0  0x000000302afc63dc in epoll_wait () from /lib64/tls/libc.so.6
#1  0x00000000006f0730 in ub::EPollEx::poll ()
#2  0x00000000006f172a in ub::NetReactor::callback ()
#3  0x00000000006fbbbb in ub::UBTask::CALLBACK ()
#4  0x000000302b80610a in start_thread () from /lib64/tls/libpthread.so.0
#5  0x000000302afc6003 in clone () from /lib64/tls/libc.so.6
#6  0x0000000000000000 in ?? ()</p>

<p>#ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
4 S     0 17236 17233  0  80   0 - 28946 wait   pts/0    00:00:00 bash
0 R     0 17274 17236  0  80   0 - 37233 -      pts/0    00:00:00 ps</p>

<p>æ¯ä¸ªé¡¹ç›®çš„æ„ä¹‰ç®€å•è¯´æ˜å¦‚ä¸‹ï¼š</p>

<p>F (flag)ï¼šä»£è¡¨ç¨‹åºçš„æ€»ç»“æ——æ ‡ï¼Œå¸¸è§ä¸º4 ä»£è¡¨root
S (stat)ï¼šçŠ¶æ€åˆ—ï¼Œä¸»è¦çš„åˆ†ç±»é¡¹ç›®æœ‰ï¼š
R (Running)ï¼šè¯¥ç¨‹å¼æ­£åœ¨è¿ä½œä¸­ï¼›
S (Sleep)ï¼šè¯¥ç¨‹å¼ç›®å‰æ­£åœ¨ç¡çœ çŠ¶æ€(idle)ï¼Œä½†å¯ä»¥è¢«å”¤é†’(signal)ã€‚
D ï¼šä¸å¯è¢«å”¤é†’çš„ç¡çœ çŠ¶æ€ï¼Œé€šå¸¸è¿™æ”¯ç¨‹å¼å¯èƒ½åœ¨ç­‰å¾…I/O çš„æƒ…å†µ(ex&gt;åˆ—å°)
T ï¼šåœæ­¢çŠ¶æ€(stop)ï¼Œå¯èƒ½æ˜¯åœ¨å·¥ä½œæ§åˆ¶(èƒŒæ™¯æš‚åœ)æˆ–é™¤é”™(traced) çŠ¶æ€ï¼›
Z (Zombie)ï¼šåƒµå°¸çŠ¶æ€ï¼Œç¨‹åºå·²ç»ç»ˆæ­¢ä½†å´æ— æ³•è¢«ç§»é™¤è‡³è®°å¿†ä½“å¤–ã€‚
UID/PID/PPIDï¼šä»£è¡¨ã€æ­¤ç¨‹åºè¢«è¯¥UID æ‰€æ‹¥æœ‰/ç¨‹åºçš„PID å·ç /æ­¤ç¨‹åºçš„çˆ¶ç¨‹åºPID å·ç ã€
Cï¼šä»£è¡¨CPU ä½¿ç”¨ç‡ï¼Œå•ä½ä¸ºç™¾åˆ†æ¯”ï¼›
PRI/NIï¼šPriority/Nice çš„ç¼©å†™ï¼Œä»£è¡¨æ­¤ç¨‹åºè¢«CPU æ‰€æ‰§è¡Œçš„ä¼˜å…ˆé¡ºåºï¼Œæ•°å€¼è¶Šå°ä»£è¡¨è¯¥ç¨‹åºè¶Šå¿«è¢«CPU æ‰§è¡Œã€‚
ADDR/SZ/WCHANï¼šéƒ½ä¸è®°å¿†ä½“æœ‰å…³ï¼ŒADDR æ˜¯kernel functionï¼ŒæŒ‡å‡ºè¯¥ç¨‹åºåœ¨è®°å¿†ä½“çš„å“ªä¸ªéƒ¨åˆ†ï¼Œå¦‚æœæ˜¯ä¸ªrunning çš„ç¨‹åºï¼Œä¸€èˆ¬å°±ä¼šæ˜¾ç¤ºã€ - ã€ / SZ ä»£è¡¨æ­¤ç¨‹åºç”¨æ‰å¤šå°‘è®°å¿†ä½“/ WCHAN è¡¨ç¤ºç›®å‰ç¨‹åºæ˜¯å¦è¿ä½œä¸­ï¼ŒåŒæ ·çš„ï¼Œ è‹¥ä¸º- è¡¨ç¤ºæ­£åœ¨è¿ä½œä¸­ã€‚
TTYï¼šç™»å…¥è€…çš„ç»ˆç«¯æœºä½ç½®ï¼Œè‹¥ä¸ºè¿œç«¯ç™»å…¥åˆ™ä½¿ç”¨åŠ¨æ€ç»ˆç«¯ä»‹é¢(pts/n)ï¼›
TIMEï¼šä½¿ç”¨æ‰çš„CPU æ—¶é—´ï¼Œæ³¨æ„ï¼Œæ˜¯æ­¤ç¨‹åºå®é™…èŠ±è´¹CPU è¿ä½œçš„æ—¶é—´ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿæ—¶é—´ï¼›
CMDï¼šå°±æ˜¯command çš„ç¼©å†™ï¼Œé€ æˆæ­¤ç¨‹åºçš„è§¦å‘ç¨‹å¼ä¹‹æŒ‡ä»¤ä¸ºä½•ã€‚
pstree
ç¨‹åºå…³è”æ ‘å³pstree,ä¸ºäº†æ˜¾ç¤ºçš„æ–¹ä¾¿ï¼Œå»ºè®®-A çš„é€‰é¡¹ï¼Œ ä»¥ASCII çš„æ˜¾ç¤ºå­—å…ƒè¾“å‡ºï¼Œæ¯”è¾ƒä¸å®¹æ˜“å‡ºç°ä¹±ç ï¼š</p>

<h1 id="pstree--a">pstree -A</h1>
<p>systemd-+-NetworkManager-+-dhclient
        |                <code class="language-plaintext highlighter-rouge">-2*[{NetworkManager}]
        |-2*[agetty]
        |-auditd---{auditd}
        |-chronyd
        |-crond
        |-dbus-daemon
        |-dsp.jar---java---82*[{java}]
        |-gapd---{gapd}
        |-irqbalance
        |-nginx---2*[nginx]
        |-oms-server.jar---java---99*[{java}]
       -----çœç•¥-------      
        </code>-tunedâ€”4*[{tuned}]</p>

<p>è‹¥éœ€è¦åŠ ä¸ŠPID ä¸ä½¿ç”¨è€…èµ„æ–™ï¼Œ å¯ä»¥ç›´æ¥ä½¿ç”¨-up æ¥åŠ å…¥å³å¯</p>
<h1 id="pstree--aup">pstree -Aup</h1>
<p>systemd(1)-+-NetworkManager(445)-+-dhclient(706)
           |                     |-{NetworkManager}(455)
           |                     `-{NetworkManager}(457)
           |-agetty(625)
           |-agetty(644)
           |-dbus-daemon(429,dbus)
           |-dgp-server.jar(2615,bootapp)â€”java(2663)-+-{java}(2664)
           |                                           |-{java}(2666)
           â€”â€”-åº•ä¸‹çœç•¥â€”â€”-</p>
<h1 id="ps-aux">ps aux</h1>
<p>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0 125196  2640 ?        Ss    2019  23:56 /usr/lib/systemd/sy
root         2  0.0  0.0      0     0 ?        S     2019   0:00 [kthreadd]</p>

<p>æ¯ä¸€ä¸ªé¡¹ç›®ä»£è¡¨çš„æ„ä¹‰ç®€æ˜“è¯´æ˜å¦‚ä¸‹ï¼š</p>

<p>USERï¼šè¯¥process å±äºé‚£ä¸ªä½¿ç”¨è€…å¸å·çš„
PID ï¼šè¯¥process çš„ç¨‹åºè¯†åˆ«ç ã€‚
%CPUï¼šè¯¥process ä½¿ç”¨æ‰çš„CPU èµ„æºç™¾åˆ†æ¯”ï¼›
%MEMï¼šè¯¥process æ‰€å ç”¨çš„å®ä½“è®°å¿†ä½“ç™¾åˆ†æ¯”ï¼›
VSZ ï¼šè¯¥process ä½¿ç”¨æ‰çš„è™šæ‹Ÿè®°å¿†ä½“é‡(Kbytes)
RSS ï¼šè¯¥process å ç”¨çš„å›ºå®šçš„è®°å¿†ä½“é‡(Kbytes)
TTY ï¼šè¯¥process æ˜¯åœ¨é‚£ä¸ªç»ˆç«¯æœºä¸Šé¢è¿ä½œï¼Œè‹¥ä¸ç»ˆç«¯æœºæ— å…³åˆ™æ˜¾ç¤º?ï¼Œå¦å¤–ï¼Œ tty1-tty6 æ˜¯æœ¬æœºä¸Šé¢çš„ç™»å…¥è€…ç¨‹åºï¼Œè‹¥ä¸ºpts/0 ç­‰ç­‰çš„ï¼Œåˆ™è¡¨ç¤ºä¸ºç”±ç½‘è·¯è¿æ¥è¿›ä¸»æœºçš„ç¨‹åºã€‚
STATï¼šè¯¥ç¨‹åºç›®å‰çš„çŠ¶æ€ï¼ŒçŠ¶æ€æ˜¾ç¤ºä¸ps -l çš„S æ——æ ‡ç›¸åŒ(R/S/T/Z)
STARTï¼šè¯¥process è¢«è§¦å‘å¯åŠ¨çš„æ—¶é—´ï¼›
TIME ï¼šè¯¥process å®é™…ä½¿ç”¨CPU è¿ä½œçš„æ—¶é—´ã€‚
COMMANDï¼šè¯¥ç¨‹åºçš„å®é™…æŒ‡ä»¤
top åŠ¨æ€è§‚å¯Ÿç¨‹åº
top å¯ä»¥ååŠ©è¯»è€…æœªæ¥åœ¨ç®¡ç†ç¨‹åºçš„CPU ä½¿ç”¨é‡ä¸Šé¢çš„ä¸€ä¸ªå¾ˆé‡è¦çš„å·¥å…·ã€‚ç›´æ¥è¾“å…¥top å³å¯æ¯5 ç§’é’Ÿæ›´æ–°ä¸€æ¬¡ç¨‹åºçš„ç°å†µ
op ç¨‹å¼æ‰§è¡Œçš„çŠ¶æ€åˆ—ï¼Œæ¯ä¸ªé¡¹ç›®çš„æ„ä¹‰ä¸ºï¼š
PID ï¼šæ¯ä¸ªprocess çš„è¯†åˆ«ç (PID)
USERï¼šè¯¥process æ‰€å±çš„ä½¿ç”¨è€…ï¼›
PR ï¼šPriority çš„ç®€å†™ï¼Œç¨‹åºçš„ä¼˜å…ˆæ‰§è¡Œé¡ºåºï¼Œè¶Šå°è¶Šæ—©è¢«æ‰§è¡Œï¼›
NI ï¼šNice çš„ç®€å†™ï¼Œä¸Priority æœ‰å…³ï¼Œä¹Ÿæ˜¯è¶Šå°è¶Šæ—©è¢«æ‰§è¡Œï¼›
%CPUï¼šCPU çš„ä½¿ç”¨ç‡ï¼›
%MEMï¼šè®°å¿†ä½“çš„ä½¿ç”¨ç‡ï¼›
TIME+ï¼šCPU ä½¿ç”¨æ—¶é—´çš„ç´¯åŠ ï¼›
COMMANDï¼šæŒ‡ä»¤
åœ¨é¢„è®¾çš„æƒ…å†µä¸‹ï¼Œtop æ‰€æ˜¾ç¤ºçš„ç¨‹åºä¼šä»¥CPU çš„ä½¿ç”¨ç‡æ¥æ’åºï¼Œè¿™ä¹Ÿæ˜¯ç®¡ç†å‘˜æœ€éœ€è¦çš„ä¸€ä¸ªè§‚å¯Ÿä»»åŠ¡ã€‚è®¸å¤šæ—¶å€™ç³»ç»Ÿå‘ç”Ÿèµ„æºä¸è¶³æˆ–è€…æ˜¯æ•ˆèƒ½å˜å·®çš„æ—¶å€™ï¼Œ æœ€ç®€æ˜“çš„æ–¹æ³•ä¸ºä½¿ç”¨top è§‚å¯Ÿæœ€å¿™ç¢Œçš„å‡ åªç¨‹åºï¼Œå€Ÿä»¥å¤„ç†ç¨‹åºçš„æ•ˆèƒ½é—®é¢˜ã€‚æ­¤å¤–ï¼Œä¹Ÿèƒ½é€è¿‡top è§‚å¯ŸI/O wait çš„CPU ä½¿ç”¨ç‡ï¼Œ å¯ä»¥æ‰¾åˆ°I/O æœ€é¢‘ç¹çš„å‡ åªç¨‹åºï¼Œå€Ÿä»¥äº†è§£åˆ°å“ªäº›ç¨‹åºåœ¨è¿›è¡Œå“ªäº›è¡Œä¸ºï¼Œæˆ–è€…æ˜¯ç³»ç»Ÿæ•ˆèƒ½çš„ç“¶é¢ˆï¼Œå€Ÿä»¥ä½œä¸ºæœªæ¥å‡çº§ç¡¬ä½“çš„ä¾æ®ã€‚</p>

<p>top - 10:22:33 up 34 days, 18:16,  1 user,  load average: 6.41, 5.25, 4.66
1
ä»£è¡¨ç›®å‰ä¸º10:22:33 ï¼Œæœ¬ç³»ç»Ÿå¼€æœºäº†34 å¤©åˆ18:16 è¿™çš„ä¹…çš„æ—¶é—´ï¼Œç›®å‰æœ‰1 ç”¨æˆ·ç™»å…¥ï¼Œå·¥ä½œè´Ÿè½½ä¸º6.41, 5.25, 4.66 ã€‚é‚£ä¸‰ä¸ªæ•°æ®ä»£è¡¨1, 5, 15 åˆ†é’Ÿå†…çš„å¹³å‡å·¥ä½œè´Ÿè½½ã€‚æ‰€è°“çš„å·¥ä½œè´Ÿè½½ä¸ºã€å•ä¸€æ—¶é—´å†…ï¼ŒCPU éœ€è¦è¿ä½œå‡ ä¸ªå·¥ä½œã€ä¹‹æ„ï¼Œå¹¶éCPU ä½¿ç”¨ç‡ã€‚</p>

<p>Tasks:  92 total,   1 running,  91 sleeping,   0 stopped,   0 zombie
1
ç›®å‰å…±æœ‰92ä¸ªç¨‹åºï¼Œå…¶ä¸­1 ä¸ªåœ¨æ‰§è¡Œï¼Œ91ä¸ªç¡ç€äº†ï¼Œæ²¡æœ‰åœæ­¢ä¸åƒµå°¸ç¨‹åºã€‚</p>

<p>%Cpu(s): 27.6 us,  5.5 sy,  0.0 ni, 66.8 id,  0.0 wa,  0.0 hi,  0.2 si,  0.0 st
1
è¿™é‡Œæ‰æ˜¯CPU çš„ä½¿ç”¨ç‡ç™¾åˆ†æ¯”ï¼Œæ¯”è¾ƒéœ€è¦æ³¨æ„id (idle) ä¸wa (I/O wait)ï¼Œid è¶Šé«˜ä»£è¡¨ç³»ç»Ÿè¶Šé—²ç½®ï¼Œ wa è¶Šé«˜ä»£è¡¨ç¨‹åºå¡åœ¨è¯»å†™ç£ç¢Ÿæˆ–ç½‘è·¯ä¸Šï¼Œæ­¤æ—¶ç³»ç»Ÿæ•ˆèƒ½ä¼šæ¯”è¾ƒç³Ÿç³•ã€‚</p>

<p>å¦‚æœä½ å‘ç°åœ¨æŸä¸ªç¨‹åºçš„CMD åé¢è¿˜æ¥ä¸Š æ—¶ï¼Œå°±ä»£è¡¨è¯¥ç¨‹åºæ˜¯åƒµå°¸ç¨‹åºå•¦,ä¾‹å¦‚ï¼š</p>

<p>apache 8683 0.0 0.9 83384 9992 ? Z 14:33 0:00 /usr/sbin/httpd <defunct></defunct></p>

<p>https://www.cnblogs.com/FengGeBlog/p/10353275.html</p>

:ET