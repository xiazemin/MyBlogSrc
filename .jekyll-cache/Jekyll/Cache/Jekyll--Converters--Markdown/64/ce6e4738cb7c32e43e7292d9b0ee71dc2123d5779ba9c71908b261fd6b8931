I"ã<p>https://github.com/dragonflyoss/Dragonfly/blob/v0.4.3/pkg/ratelimiter/ratelimiter.go
<!-- more -->
package main</p>

<p>import (
   â€œfmtâ€
   â€œosâ€
   â€œio/ioutilâ€
   â€œioâ€
)</p>

<p>func main() {
   file, err := os.OpenFile(â€œtest.txtâ€, os.O_RDWR, 777) //makeä¸€ä¸ªreader
   if err != nil {
      panic(err)
   }
   r := io.NewSectionReader(file, 4, 10) //è§„å®šèŒƒå›´
   buf, err := ioutil.ReadAll(r)
   fmt.Println(string(buf))</p>

<p>lr := io.LimitReader(file, 12) //è§„å®šæœ€å¤§èƒ½è¯»å–åˆ°å“ªé‡Œ
   buf, err = ioutil.ReadAll(lr)
   fmt.Println(string(buf))
}
æœ€ç»ˆç»“æœè¾“å‡º</p>

<p>is io-tes
this is io-t</p>

<p>ioåŒ…çš„ä½¿ç”¨
åŠŸèƒ½ï¼šioåŒ…æä¾›äº†å¯¹I/OåŸè¯­çš„åŸºæœ¬æ¥å£ã€‚æœ¬åŒ…çš„åŸºæœ¬ä»»åŠ¡æ˜¯åŒ…è£…è¿™äº›åŸè¯­å·²æœ‰çš„å®ç°ï¼ˆå¦‚osåŒ…é‡Œçš„åŸè¯­ï¼‰ï¼Œä½¿ä¹‹æˆä¸ºå…±äº«çš„å…¬å…±æ¥å£ï¼Œè¿™äº›å…¬å…±æ¥å£æŠ½è±¡å‡ºäº†æ³›ç”¨çš„å‡½æ•°å¹¶é™„åŠ äº†ä¸€äº›ç›¸å…³çš„åŸè¯­çš„æ“ä½œ</p>

<p>ï¼‘ã€Reader æ¥å£</p>

<p>type Reader interface {
     Read(p []byte) (n int, err error)
}
Readæ–¹æ³•è¯»å–len(p)å­—èŠ‚æ•°æ®å†™å…¥pã€‚å®ƒè¿”å›å†™å…¥çš„å­—èŠ‚æ•°å’Œé‡åˆ°çš„ä»»ä½•é”™è¯¯ã€‚å³ä½¿Readæ–¹æ³•è¿”å›å€¼n &lt; len(p)ï¼Œæœ¬æ–¹æ³•åœ¨è¢«è°ƒç”¨æ—¶ä»å¯èƒ½ä½¿ç”¨pçš„å…¨éƒ¨é•¿åº¦ä½œä¸ºæš‚å­˜ç©ºé—´ã€‚å¦‚æœæœ‰éƒ¨åˆ†å¯ç”¨æ•°æ®ï¼Œä½†ä¸å¤Ÿlen(p)å­—èŠ‚ï¼ŒReadæŒ‰æƒ¯ä¾‹ä¼šè¿”å›å¯ä»¥è¯»å–åˆ°çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ›´å¤šæ•°æ®ã€‚</p>

<p>å½“Readåœ¨è¯»å–n &gt; 0ä¸ªå­—èŠ‚åé­é‡é”™è¯¯æˆ–è€…åˆ°è¾¾æ–‡ä»¶ç»“å°¾æ—¶ï¼Œä¼šè¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚å®ƒå¯èƒ½ä¼šåœ¨è¯¥æ¬¡è°ƒç”¨è¿”å›ä¸€ä¸ªénilçš„é”™è¯¯ï¼Œæˆ–è€…åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨æ—¶è¿”å›0å’Œè¯¥é”™è¯¯ã€‚ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ï¼ŒReaderæ¥å£ä¼šåœ¨è¾“å…¥æµçš„ç»“å°¾è¿”å›é0çš„å­—èŠ‚æ•°ï¼Œè¿”å›å€¼err == EOFæˆ–err == nilã€‚ä½†ä¸ç®¡æ€æ ·ï¼Œä¸‹ä¸€æ¬¡Readè°ƒç”¨å¿…ç„¶è¿”å›(0, EOF)ã€‚è°ƒç”¨è€…åº”è¯¥æ€»æ˜¯å…ˆå¤„ç†è¯»å–çš„n &gt; 0å­—èŠ‚å†å¤„ç†é”™è¯¯å€¼ã€‚è¿™ä¹ˆåšå¯ä»¥æ­£ç¡®çš„å¤„ç†å‘ç”Ÿåœ¨è¯»å–éƒ¨åˆ†æ•°æ®åçš„I/Oé”™è¯¯ï¼Œä¹Ÿèƒ½æ­£ç¡®å¤„ç†EOFäº‹ä»¶ã€‚</p>

<p>å¦‚æœReadçš„æŸä¸ªå®ç°è¿”å›0å­—èŠ‚æ•°å’Œnilé”™è¯¯å€¼ï¼Œè¡¨ç¤ºè¢«é˜»ç¢ï¼›è°ƒç”¨è€…åº”è¯¥å°†è¿™ç§æƒ…å†µè§†ä¸ºæœªè¿›è¡Œæ“ä½œ</p>

<p>ï¼’ã€Writer æ¥å£</p>

<p>type Writer interface {
    Write(p []byte) (n int, err error)
}
Writeræ¥å£ç”¨äºåŒ…è£…åŸºæœ¬çš„å†™å…¥æ–¹æ³•ã€‚</p>

<p>Writeæ–¹æ³•len(p) å­—èŠ‚æ•°æ®ä»på†™å…¥åº•å±‚çš„æ•°æ®æµã€‚å®ƒä¼šè¿”å›å†™å…¥çš„å­—èŠ‚æ•°(0 &lt;= n &lt;= len(p))å’Œé‡åˆ°çš„ä»»ä½•å¯¼è‡´å†™å…¥æå–ç»“æŸçš„é”™è¯¯ã€‚Writeå¿…é¡»è¿”å›énilçš„é”™è¯¯ï¼Œå¦‚æœå®ƒè¿”å›çš„ n &lt; len(p)ã€‚Writeä¸èƒ½ä¿®æ”¹åˆ‡ç‰‡pä¸­çš„æ•°æ®ï¼Œå³ä½¿ä¸´æ—¶ä¿®æ”¹ä¹Ÿä¸è¡Œ</p>

<p>ï¼“ã€Seeker æ¥å£</p>

<p>type Seeker interface {
        Seek(offset int64, whence int) (int64, error)
}
Seekæ–¹æ³•è®¾å®šä¸‹ä¸€æ¬¡è¯»å†™çš„ä½ç½®ï¼šåç§»é‡ä¸ºoffsetï¼Œæ ¡å‡†ç‚¹ç”±whenceç¡®å®šï¼š0è¡¨ç¤ºç›¸å¯¹äºæ–‡ä»¶èµ·å§‹ï¼›1è¡¨ç¤ºç›¸å¯¹äºå½“å‰ä½ç½®ï¼›2è¡¨ç¤ºç›¸å¯¹äºæ–‡ä»¶ç»“å°¾ã€‚Seekæ–¹æ³•è¿”å›æ–°çš„ä½ç½®ä»¥åŠå¯èƒ½é‡åˆ°çš„é”™è¯¯</p>

<p>ï¼”ã€Closeræ¥å£</p>

<p>type Closer interface {
    Close() error
}
Closeræ¥å£ç”¨äºåŒ…è£…åŸºæœ¬çš„å…³é—­æ–¹æ³•ã€‚
åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ä¹‹åå†æ¬¡è¢«è°ƒç”¨æ—¶ï¼ŒCloseæ–¹æ³•çš„çš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚æŸäº›å®ç°å¯èƒ½ä¼šè¯´æ˜ä»–ä»¬è‡ªå·±çš„è¡Œä¸ºã€‚</p>

<p>ï¼•ã€ReaderAt å’Œ WriterAt æ¥å£</p>

<p>type ReaderAt interface {
    ReadAt(p []byte, off int64) (n int, err error)
}
ReadAtä»åº•å±‚è¾“å…¥æµçš„åç§»é‡offä½ç½®è¯»å–len(p)å­—èŠ‚æ•°æ®å†™å…¥pï¼Œ å®ƒè¿”å›è¯»å–çš„å­—èŠ‚æ•°(0 &lt;= n &lt;= len(p))å’Œé‡åˆ°çš„ä»»ä½•é”™è¯¯ã€‚å½“ReadAtæ–¹æ³•è¿”å›å€¼n &lt; len(p)æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªénilçš„é”™è¯¯æ¥è¯´æ˜ä¸ºå•¥æ²¡æœ‰è¯»å–æ›´å¤šçš„å­—èŠ‚ã€‚åœ¨è¿™æ–¹é¢ï¼ŒReadAtæ˜¯æ¯”Readè¦ä¸¥æ ¼çš„ã€‚å³ä½¿ReadAtæ–¹æ³•è¿”å›å€¼ n &lt; len(p)ï¼Œå®ƒåœ¨è¢«è°ƒç”¨æ—¶ä»å¯èƒ½ä½¿ç”¨pçš„å…¨éƒ¨é•¿åº¦ä½œä¸ºæš‚å­˜ç©ºé—´ã€‚å¦‚æœæœ‰éƒ¨åˆ†å¯ç”¨æ•°æ®ï¼Œä½†ä¸å¤Ÿlen(p)å­—èŠ‚ï¼ŒReadAtä¼šé˜»å¡ç›´åˆ°è·å–len(p)ä¸ªå­—èŠ‚æ•°æ®æˆ–è€…é‡åˆ°é”™è¯¯ã€‚åœ¨è¿™æ–¹é¢ï¼ŒReadAtå’ŒReadæ˜¯ä¸åŒçš„ã€‚å¦‚æœReadAtè¿”å›æ—¶åˆ°è¾¾è¾“å…¥æµçš„ç»“å°¾ï¼Œè€Œè¿”å›å€¼n == len(p)ï¼Œå…¶è¿”å›å€¼erræ—¢å¯ä»¥æ˜¯EOFä¹Ÿå¯ä»¥æ˜¯nil</p>

<p>type WriterAt interface {
    WriteAt(p []byte, off int64) (n int, err error)
}
WriteAtå°†på…¨éƒ¨len(p)å­—èŠ‚æ•°æ®å†™å…¥åº•å±‚æ•°æ®æµçš„åç§»é‡offä½ç½®ã€‚å®ƒè¿”å›å†™å…¥çš„å­—èŠ‚æ•°(0 &lt;= n &lt;= len(p))å’Œé‡åˆ°çš„ä»»ä½•å¯¼è‡´å†™å…¥æå‰ä¸­æ­¢çš„é”™è¯¯ã€‚å½“å…¶è¿”å›å€¼n &lt; len(p)æ—¶ï¼ŒWriteAtå¿…é¡»æ”¾å“ªä¼šä¸€ä¸ªénilçš„é”™è¯¯ã€‚
å¦‚æœWriteAtå†™å…¥çš„å¯¹è±¡æ˜¯æŸä¸ªæœ‰åç§»é‡çš„åº•å±‚è¾“å‡ºæµï¼ˆçš„WriteråŒ…è£…ï¼‰ï¼ŒWriteAtæ–¹æ³•æ—¢ä¸åº”å½±å“åº•å±‚çš„åç§»é‡ï¼Œä¹Ÿä¸åº”è¢«åº•å±‚çš„åç§»é‡å½±å“</p>

<p>ï¼–ã€ReaderFrom å’Œ WriterTo æ¥å£</p>

<p>type ReaderFrom interface {
    ReadFrom(r Reader) (n int64, err error)
}</p>

<p>type WriterTo interface {
    WriteTo(w Writer) (n int64, err error)
}
ï¼—ã€ByteReader å’Œ ByteWriter</p>

<p>type ByteReader interface {
    ReadByte() (c byte, err error)
}</p>

<p>type ByteWriter interface {
    WriteByte(c byte) error
}
ï¼˜ã€ByteScannerã€RuneReader å’Œ RuneScanner</p>

<p>type ByteScanner interface {
    ByteReader
    UnreadByte() error
}</p>

<p>type RuneReader interface {
    ReadRune() (r rune, size int, err error)
}</p>

<p>type RuneScanner interface {
    RuneReader
    UnreadRune() error
}
ï¼™ã€åµŒå¥—æ¥å£ã€€ReadCloserã€ReadSeekerã€ReadWriteCloserã€ReadWriteSeekerã€ReadWriterã€WriteCloser å’Œ WriteSeeker æ¥å£</p>

<p>ï¼‘ï¼ã€SectionReaderç±»å‹</p>

<p>func NewSectionReader(r ReaderAt, off int64, n int64) *SectionReader
func (s *SectionReader) Size() int64
func (s *SectionReader) Read(p []byte) (n int, err error)
func (s *SectionReader) ReadAt(p []byte, off int64) (n int, err error)
func (s *SectionReader) Seek(offset int64, whence int) (int64, error)
ï¼‘ï¼‘ã€ LimitedReaderç±»å‹</p>

<p>func LimitReader(r Reader, n int64) Reader
func (l *LimitedReader) Read(p []byte) (n int, err error)
ï¼‘ï¼’ã€PipeReader å’Œ PipeWriter ç±»å‹</p>

<p>func Pipe() (*PipeReader, *PipeWriter)
func (r *PipeReader) Read(data []byte) (n int, err error)
func (r *PipeReader) Close() error
func (r *PipeReader) CloseWithError(err error) error</p>

<p>func (w *PipeWriter) Write(data []byte) (n int, err error)
func (w *PipeWriter) Close() error
func (w *PipeWriter) CloseWithError(err error) error
ï¼‘ï¼“ã€Copy å’Œ CopyN å‡½æ•°</p>

<p>func Copy(dst Writer, src Reader) (written int64, err error)
func CopyN(dst Writer, src Reader, n int64) (written int64, err error)
ï¼‘ï¼”ã€ReadAtLeast å’Œ ReadFull å‡½æ•°</p>

<p>func ReadFull(r Reader, buf []byte) (n int, err error)
func ReadAtLeast(r Reader, buf []byte, min int) (n int, err error)
ï¼‘ï¼•ã€WriteString å‡½æ•°</p>

<p>func WriteString(w Writer, s string) (n int, err error)
ï¼‘ï¼–ã€MultiReader å’Œ MultiWriter å‡½æ•°</p>

<p>func MultiWriter(writers â€¦Writer) Writer
func MultiReader(readers â€¦Reader) Reader
ï¼‘ï¼—ã€TeeReaderå‡½æ•°</p>

<p>func TeeReader(r Reader, w Writer) Reader</p>
:ET