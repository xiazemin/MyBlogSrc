I"ç<p>https://github.com/WebAssembly/binaryen
WebAssembly çš„ç”Ÿæ€å¤§è‡´åˆ†ä¸ºä¸¤éƒ¨åˆ†, ç¼–è¯‘å™¨ç­‰å·¥å…·é“¾, å’Œæ‰§è¡Œç¯å¢ƒ
ä¸¤è€…ä¾æ® spec æ¥å®Œæˆå¯¹æ¥, å¹¶ä¸”å®ç°è§£è€¦
å·¥å…·é“¾éƒ¨åˆ†é‡è¦çš„æ–°é¡¹ç›®æ˜¯ Binaryen, ä¸€ä¸ªç¼–è¯‘å™¨
https://github.com/WebAssembly/binaryen
å®ç°è¯­è¨€æ˜¯ C++, å¯ä»¥ç”¨äº parse å’Œ emit WebAssembly
ä¹Ÿå¯ä»¥åŸºäº AST è§„èŒƒè¿›è¡Œè½¬æ¢
åŸºäºå‡ ä¸ªéƒ¨åˆ†çš„å·¥å…·:</p>

<p>Binaryen shell å¯ä»¥åŠ è½½è¿è¡Œä»£ç , ç±»ä¼¼è§£é‡Šå™¨
ä½¿ç”¨çš„åç¼€ .wast, è¿™æ˜¯ WebAssembly çš„æŸä¸ªæ–‡æœ¬æ ¼å¼</p>

<p>asm2wasm ASM.js ç¼–è¯‘åˆ° WebAssembly</p>

<p>wasm2asm WebAssembly ç¼–è¯‘åˆ° ASM.js(è¿˜æ²¡å®Œæˆ)</p>

<p>s2wasm æ±‡ç¼–æ–‡ä»¶, åç¼€ .s, ç¼–è¯‘åˆ° WebAssembly, åŸºäº LLVM
http://llvm.org/devmtg/2015-10/slides/BastienGohman-WebAssembly-HereBeDragons.pdf</p>

<p>wasm.js Binaryen çš„ JavaScript å®ç°, ä»¥ä¾¿åœ¨å·²æœ‰ JavaScript ç¯å¢ƒæ‰§è¡Œ</p>

<p>å…³äº Binaryen çš„ä»‹ç», æœ‰ä¸ªå¹»ç¯ç‰‡, å…¶ä¸­ä¸€é¡µç‰¹åˆ«è¦çœ‹ä¸‹
https://kripken.github.io/talks/wasm.html#/9
Binaryen å°±æ˜¯ Binary å’Œ Emscripten çš„ç»“å°¾è¿è½½ä¸€èµ·å†™
<!-- more -->
Emscripten å¯ä»¥ç¼–è¯‘ C æˆ–è€… C++ åˆ° ASM.js
è€Œ Binaryen å¯ä»¥æŠŠ ASM.js ç¼–è¯‘åˆ° WebAssembly, æ•´ä¸ªå°±é€šäº†
å¯ä»¥ç”¨ asm2wasm å‘½ä»¤, ä¹Ÿå¯ä»¥ç”¨ emcc ç›´æ¥åŒ…å«è¿™ä¸€æ­¥:</p>

<p>emcc file.cpp -o file.js -s â€˜BINARYEN=â€path-to-binaryenâ€â€™
https://github.com/kripken/emscripten/wiki/WebAssembly</p>

<p>ç›®å‰è¿˜æ²¡æœ‰ç›´æ¥ç¼–è¯‘åˆ°æµè§ˆå™¨ç¯å¢ƒè¿è¡Œçš„æ–¹æ¡ˆ
ç°åœ¨æµ‹ç›®æ ‡æ˜¯æœ€å¿«èƒ½å®ç°å’Œæ£€éªŒæ•ˆæœ, æµè§ˆå™¨çš„äº‹ä»¥åå†è¯´
è€Œä¸ºäº†æµ‹å‡ºçš„ç›®çš„çš„è¯, æœ‰ä¸ªæ€§èƒ½å¾ˆä½çš„ wasm.js å¯ä»¥è·‘
å¤§æ¦‚å°±æ˜¯ç”¨æ¥åˆå§‹åŒ–è¿è¡Œç¯å¢ƒ, ç„¶åè§£é‡Šæ‰§è¡Œ WebAssembly
ä¼°è®¡è¿™ä¸ªæ–¹æ¡ˆå’Œ CoffeeScript çš„è§£é‡Šæ‰§è¡Œä¼šæœ‰ç›¸ä¼¼ä¹‹å¤„
æåˆ°ä¸€äº›å¯ä»¥å‚è€ƒçš„å†…å®¹
https://kripken.github.io/talks/wasm.html#/10
https://github.com/WebAssembly/build-suite</p>

<p>ç›®å‰çš„æµ‹è¯•å·¥å…·, å°†æ¥ä¹Ÿèƒ½ç”¨æ¥ä¿è¯åç»­ä»£ç çš„å¯é æ€§
å½“ç„¶ä»¥åè¿è¡Œæ€§èƒ½å¿…å®šæ˜¯è¦éå¸¸é«˜çš„
https://github.com/WebAssembly/binaryen/blob/master/src/wasm2asm.h
https://github.com/WebAssembly/polyfill-prototype-2
https://github.com/WebAssembly/design/blob/master/FAQ.md#can-the-polyfill-really-be-efficient
å¾ˆå¤š C/C++ é¡¹ç›®å°†æ¥å¯ä»¥è¢«ç¼–è¯‘åˆ° WebAssembly, ä»¥åéš¾åº¦ä¸ä¼šé«˜</p>

<p>å…³äº LLVM åç«¯
WebAssembly ä¹Ÿåœ¨å¼€å‘ä¸€ä¸ª LLVM åç«¯, ç°åœ¨è¿˜ä¸æˆç†Ÿ
ä¸è¿‡å°†æ¥åº”è¯¥ä¼šéå¸¸é‡è¦çš„, Binaryen ä¹Ÿæ”¯æŒ
LLVM é€šå¸¸ä¼šè¾“å‡º .s çš„æ±‡ç¼–åç¼€æ–‡ä»¶, è¿™ä¸ªä¹Ÿæ˜¯ç±»ä¼¼çš„
è¿™ä¸ªç»“æœä¼šæœ‰ç‚¹åƒ C ç”Ÿæˆçš„æ±‡ç¼–, è€Œä¸æ˜¯åƒ AST çš„æ ·å­
è‡³å°‘èƒ½ä»è¿™ä¸ªæ–‡ä»¶æ¯”è¾ƒç›´æ¥å¾—è½¬æ¢åˆ° WebAssembly
å…¶ä¸­ä¼šç”¨åˆ° s2wasm æ¥è¿›è¡Œç¼–è¯‘, ç»†èŠ‚çœ‹åŸæ–‡
è¿™ä¸ªé¡¹ç›®æœ‰å‘½ä»¤è¡Œ, ä¹Ÿå·²ç»é›†æˆåœ¨ Emscripten é‡Œè¾¹</p>

<p>emcc file.cpp -o file.js -s â€˜BINARYEN=â€path-to-binaryenâ€â€™ -s WASM_BACKEND=1
https://github.com/kripken/emscripten/wiki/WebAssembly</p>

<p>ç°åœ¨å¤§è‡´æœ‰ä¸¤æ¡æ€è·¯, ä¸€æ¡æ—§ä¸€æ¡æ–°, æ–°çš„è¿˜æ²¡æˆç†Ÿ, ä½†å°†æ¥ä¼šå–ä»£æ—§çš„</p>

<p>Emscripten + asm.js backend + asm2wasm</p>

<p>Emscripten + new WebAssembly backend + s2wasm</p>

<p>å¦å¤–åœ¨ FAQ é‡Œæ‰’äº†ä¸€äº›æ„Ÿå…´è¶£çš„å†…å®¹
https://github.com/WebAssembly/design/blob/master/FAQ.md</p>

<p>ä½¿ç”¨åœºæ™¯ç”¨å“ªäº›?
é¡µé¢ä¸Šæ‹‰äº†å¾ˆé•¿çš„åˆ—è¡¨, æ„Ÿè§‰å¸¸ç”¨çš„æ¡Œé¢è½¯ä»¶éƒ½åˆ—ä¸Šå»äº†
https://github.com/WebAssembly/design/blob/master/UseCases.md</p>

<p>åªæ˜¯é’ˆå¯¹ C/C++ ç¨‹åºå‘˜è®¾è®¡çš„å—?
æœ€åˆå¯èƒ½æ˜¯ä¸ºäº† C/C++, åé¢ä¼šè·Ÿ ES6 æ¨¡å—æ¥å£æ•´åˆ
é‚£ä¹ˆå°±æ˜¯å¾ˆå®¹æ˜“å¤ç”¨ C++ å†™çš„ç±»åº“, è€Œä¸ç”¨å†™ C++ äº†
æ„å»º LLVM åç«¯, æ”¯æŒ LLVM çš„ Clang, GCC ç­‰, å› ä¸ºç†Ÿæ‚‰æ‰€ä»¥å…ˆå¯¹ä»˜ LLVM</p>

<p>ä»é•¿è¿œçš„ç›®æ ‡, WebAssembly ç®—æ˜¯æä¾›äºŒè¿›åˆ¶æ ¼å¼, å®ç° Web å¹³å°åŠŸèƒ½
https://github.com/WebAssembly/design/blob/master/HighLevelGoals.md
æ¯”å¦‚å¯¹ Web å‘åå…¼å®¹, ç»§æ‰¿ JavaScript çš„åŒæºç­–ç•¥, å¼‚æ­¥è°ƒç”¨å’Œè¢«è°ƒç”¨ JavaScript
è®¿é—®å·²æœ‰çš„ API, æä¾›äººç±»èƒ½é˜…è¯»çš„æ–‡æœ¬æ ¼å¼, å¯¹åº” View Source æ•ˆæœ
è¿˜æœ‰ Source Maps, åç¨‹, å¤šè¿›ç¨‹, å¤§äº 4GB å†…å­˜, å°¾é€’å½’, å…·ä½“çœ‹æ–‡æ¡£
https://github.com/WebAssembly/design/blob/master/FutureFeatures.md#gcdom-integration
å¯¹äº Node ç¯å¢ƒä¹Ÿæ”¯æŒ, è¿˜æœ‰ç§»åŠ¨å¹³å°, ç½‘è”ç½‘è®¾å¤‡ç­‰ç­‰
https://github.com/WebAssembly/design/blob/master/NonWeb.md</p>

<p>å…³äº Web API æœ‰å•ç‹¬çš„æ–‡æ¡£, åœ¨ MVP è¿™ä¸ªåˆæ­¥çš„é˜¶æ®µä¹‹åä¼šå¼€å§‹åš
https://github.com/WebAssembly/design/blob/master/GC.md</p>

<p>åœ¨ WebAssembly å½“ä¸­ç›´æ¥å¼•ç”¨ DOM å’Œå„ç§å¯¹è±¡</p>

<p>ç›´æ¥è®¿é—® Web API, è€Œä¸æ˜¯é€šè¿‡ JavaScript å»è°ƒç”¨</p>

<p>åœ¨ WebAssembly ä»£ç ä¸­ç›´æ¥æ“ä½œ GC å¯¹è±¡</p>

<p>æƒ³è¦æ›¿ä»£ JavaScript å—?
ä¸æ˜¯çš„. WebAssembly åªæ˜¯å…è®¸äº†æ›´å¤šçš„è¯­è¨€èƒ½ç¼–è¯‘è¿è¡Œ
è€Œ JavaScript ä½œä¸ºå¿«é€Ÿå‘å±•çš„è¯­è¨€, æ˜¯äº«æœ‰ç‰¹æƒ, ä¸€ç›´æ”¯æŒä¸‹å»çš„
ä¸¤ç§è¯­è¨€å¾ˆå¯èƒ½ä¼šé•¿æœŸå…±ç”¨ä¸‹å», æ¯”å¦‚æ€§èƒ½è¦æ±‚é«˜çš„éƒ¨åˆ†ç”¨ WebAssembly</p>

<p>Binaryen å·¥å…·é“¾
       Binaryenæä¾›äº†ä¸€ç³»åˆ—å·¥å…·ï¼Œç”¨æ¥å½¢æˆä»–ä»¬ç‹¬æœ‰çš„å·¥ä½œæµã€‚</p>

<p>binaryen-shell: A shell that can load and interpret WebAssembly code in S-Expression format, as well as run transformation passes on it. It can also run the spec test suite.
wasm-as: Assembles WebAssembly in text format (currently S-Expression format) into binary format (currently v8 format).
wasm-dis: Un-assembles WebAssembly in binary format (currently v8 format) into text format (currently S-Expression format).
asm2wasm: An asm.js-to-WebAssembly compiler, built on Emscriptenâ€™s asm optimizer infrastructure. This is used by Emscripten in Binaryen mode when it uses Emscriptenâ€™s fastcomp asm.js backend.
wasm2asm: A WebAssembly-to-asm.js compiler, the reverse of asm2wasm. This is a work in progress.
s2wasm: A compiler from the .s format emitted by the new WebAssembly backend being developed in LLVM. This is used by Emscripten in Binaryen mode when it integrates with the new LLVM backend.
wasm.js: wasm.js contains Binaryen components compiled to JavaScript, including the interpreter, asm2wasm, the S-Expression parser, etc., which allow you to use Binaryen with Emscripten and execute code compiled to WASM even if the browser doesnâ€™t have native support yet. This can be useful as a (slow) polyfill.
binaryen.js: A stand alone library that exposes Binaryen methods for parsing s-expressions and instantiating WASM modules in JavaScript.
ç°é˜¶æ®µæ¯”è¾ƒæœ‰ç”¨çš„å‘½ä»¤
binaryen-shell
bin/binaryen-shell [.wast file] [options] [passes, see â€“help] [â€“help]
       å¯ä»¥é«˜äº®æ˜¾ç¤ºwastæ–‡ä»¶</p>

<p>asm2wasm
bin/asm2wasm [input.asm.js file]
       å¯ä»¥è½¬æ¢asm.jsæ–‡ä»¶åˆ°wasmæ ¼å¼ï¼Œå¹¶é«˜äº®æ˜¾ç¤º</p>

<p>WebAssemblyç”Ÿæˆå·¥ä½œæµ
       binaryenæä¾›äº†ä¸¤ä¸ªæµç¨‹</p>

<p>C/C++ Source â‡’ asm2wasm â‡’ WebAssembly</p>

<p>C/C++ Source â‡’ WebAssembly LLVM backend â‡’ s2wasm â‡’ WebAssembly</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ilwasmæŠŠ.NET CILå˜æˆWebAssembly S-expressionsï¼Œä¸è¿‡è¿™ä¸ªé¡¹ç›®å·²ç»å¾ˆä¹…æ²¡åŠ¨è¿‡äº†ã€‚
</code></pre></div></div>
:ET