I"ª#<p>https://github.com/go-delve/delve
ã€€Devleæ˜¯ä¸€ä¸ªéå¸¸æ£’çš„golang è°ƒè¯•å·¥å…·ï¼Œæ”¯æŒå¤šç§è°ƒè¯•æ–¹å¼ï¼Œç›´æ¥è¿è¡Œè°ƒè¯•ï¼Œæˆ–è€…attachåˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„golangç¨‹åºï¼Œè¿›è¡Œè°ƒè¯•ã€‚</p>

<p>ã€€ã€€çº¿ä¸ŠgolangæœåŠ¡å‡ºç°é—®é¢˜æ—¶ï¼ŒDevleæ˜¯å¿…ä¸å°‘çš„åœ¨çº¿è°ƒè¯•å·¥å…·ï¼Œå¦‚æœä½¿ç”¨dockerï¼Œä¹Ÿå¯ä»¥æŠŠDevleæ‰“è¿›dockeré•œåƒé‡Œï¼Œè°ƒè¯•ä»£ç ã€‚</p>

<p>ã€€ã€€å®‰è£…Devle
ã€€ã€€å®‰è£…Devleéå¸¸ç®€å•ï¼Œç›´æ¥è¿è¡Œgo  get å³å¯ï¼š</p>

<p>go get -u github.com/derekparker/delve/cmd/dlv
ã€€ã€€å¦‚æœä½ çš„goç‰ˆæœ¬ä¸º1.5è¯·å…ˆè®¾ç½®ç¯å¢ƒå˜é‡GO15VENDOREXPERIMENT=1å†è¿è¡Œgo getã€‚æˆ‘çš„goç‰ˆæœ¬ä¸º1.10ï¼Œä¸ç”¨è®¾ç½®ã€‚
<!-- more -->
ä½¿ç”¨Devleè°ƒè¯•golangæœåŠ¡
ã€€ã€€å…ˆå†™ä¸€ä¸ªç®€å•çš„webæœåŠ¡ï¼Œç„¶åä½¿ç”¨Devleæ¥è¿›è¡Œè°ƒè¯•ã€‚</p>

<p>ã€€ã€€åœ¨$GOPATH/src/github.com/mytest æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºmain.go
ã€€ã€€package main</p>

<p>import (
    â€œfmtâ€
    â€œlogâ€
    â€œnet/httpâ€
    â€œosâ€
)</p>

<p>const port  = â€œ8000â€</p>

<p>func main() {
    http.HandleFunc(â€œ/hiâ€, hi)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fmt.Println("runing on port: " + port)
log.Fatal(http.ListenAndServe(":" + port, nil)) }
</code></pre></div></div>

<p>func hi(w http.ResponseWriter, r *http.Request) {
    hostName, _ := os.Hostname()
    fmt.Fprintf(w, â€œHostName: %sâ€, hostName)
}</p>

<p>ä¸€ä¸ªè¿è¡Œåœ¨8000ç«¯å£ä¸Šçš„webæœåŠ¡ï¼Œè®¿é—® hiä¼šè¿”å›æœºå™¨çš„åç§°ã€‚ä¸Šé¢ä»£ç çš„è¡Œå·æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œç­‰ä¼šæˆ‘ä»¬æ‰“æ–­ç‚¹çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p>

<p>ã€€  ä½¿ç”¨Delveè¿è¡Œæˆ‘ä»¬çš„main.go</p>

<p>dlv debug ./main.go</p>

<p>å¾ˆç®€å•çš„ä¸€äº›å‘½ä»¤</p>

<p>ã€€ã€€æˆ‘ä»¬å…ˆæ‰“åœ¨mainæ–¹æ³•ä¸Šæ‰“ä¸€ä¸ªæ–­ç‚¹ï¼š</p>

<p>b main.main</p>

<p>ç„¶åè¿è¡Œc æ¥è¿è¡Œåˆ°æ–­ç‚¹ï¼Œ</p>

<p>åœ¨func li  é‡Œæ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨</p>

<p>b main.hi
æˆ–è€…ä½¿ç”¨   â€œæ–‡ä»¶:è¡Œå·â€æ¥æ‰“æ–­ç‚¹</p>

<p>b /home/goworkspace/src/github.com/mytest/main.go:20</p>

<p>ç°åœ¨æ‰§è¡Œcontinue è®©æœåŠ¡è·‘èµ·æ¥ã€‚è®¿é—®ä¸€ä¸‹æˆ‘ä»¬çš„æœåŠ¡ï¼Œçœ‹hiæ–¹æ³•ä¼šä¸ä¼šåœä¸‹æ¥ã€‚</p>

<p>curl localhost:8000/hi</p>

<p>ã€€ã€€è¾“å…¥ n å›è½¦ï¼Œæ‰§è¡Œåˆ°ä¸‹ä¸€è¡Œ</p>

<p>ã€€ã€€è¾“å…¥s å›è½¦ï¼Œå•æ­¥æ‰§è¡Œ</p>

<p>ã€€ã€€è¾“å…¥ printï¼ˆåˆ«åpï¼‰è¾“å‡ºå˜é‡ä¿¡æ¯ã€€ã€€</p>

<p>ã€€ã€€è¾“å…¥ args æ‰“å°å‡ºæ‰€æœ‰çš„æ–¹æ³•å‚æ•°ä¿¡æ¯</p>

<p>ã€€ã€€è¾“å…¥ locals æ‰“å°æ‰€æœ‰çš„æœ¬åœ°å˜é‡
ã€€ã€€
å…¶ä»–çš„å‘½ä»¤æˆ‘å°±ä¸åœ¨è¿™é‡Œç»™å¤§å®¶æ¼”ç¤ºäº†ï¼Œè‡ªå·±åŠ¨åŠ¨æ‰‹è¯•ä¸€ä¸‹ã€‚</p>

<p>ã€€ã€€ä½¿ç”¨Delveé™„åŠ åˆ°è¿è¡Œçš„golangæœåŠ¡è¿›è¡Œè°ƒè¯•
 ã€€ã€€å…ˆç¼–è¯‘ä¸€ä¸‹æˆ‘ä»¬çš„main.goç„¶åå»è¡Œmain</p>

<p>go build main.go</p>

<p>./main</p>

<p>ç„¶åä½¿ç”¨Delveé™„åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸Šï¼Œå…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬çš„é¡¹ç›®çš„pid</p>

<p>ps aux|grep main
dlv attach 29260</p>

<p>åœ¨hiæ–¹æ³•é‡Œæ‰“æ–­ç‚¹ï¼Œç„¶åæ‰§è¡Œcæ¥ç­‰å¾…æ–­ç‚¹çš„æ‰§è¡Œã€‚</p>

<p>b /home/goworkspace/src/github.com/mytest/main.go:20
ã€€ã€€</p>

<p>ã€€ã€€è®¿é—®æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œçœ‹ä¸€ä¸‹æ–­ç‚¹ä¼šä¸ä¼šè¢«æ‰§è¡Œ</p>

<p>curl localhost:8000/hi</p>

<p>åœ¨windowsç³»ç»Ÿä¸‹å¼€å‘Linuxç¯å¢ƒä¸‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿç»„ä»¶æ—¶ï¼Œå¾€å¾€å› ä¸ºç»„ä»¶ä¹‹é—´çš„ç›¸äº’ä¾èµ–è°ƒç”¨éœ€è¦è¿›è¡ŒæœåŠ¡ç«¯è°ƒè¯•,delveæ˜¯ä¸€æ¬¾å¼€æºçš„goè¯­è¨€è°ƒè¯•å™¨ï¼Œå¸¸ç”¨çš„goè¯­è¨€IDEï¼Œå¦‚goland vscodeç­‰éƒ½æ˜¯ä¾é delveæ¥è¿›è¡Œè°ƒè¯•æ“ä½œçš„.</p>

<p>ä½¿ç”¨golandè¿œç¨‹è°ƒè¯•
ä½¿ç”¨golandæ¥è¿›è¡Œè¿œç¨‹è°ƒè¯•æœ€å¥½ä½¿ç”¨golandçš„ 2019.1ç‰ˆæœ¬,åŸå› æ˜¯åœ¨goland 2019.1ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå› ä¸ºè°ƒè¯•è·¯å¾„æ˜ å°„çš„é—®é¢˜ï¼Œå¿…éœ€ä¿è¯æœ¬åœ°å’Œè¿œç¨‹ä»£ç ç›®å½•éƒ½åœ¨GOPATHä¸‹çš„srcç›®å½•ï¼Œä¸”æ–‡ä»¶å¤¹å¿…éœ€åŒåæ‰å¯ä»¥æ­£å¸¸è¿›è¡Œè¿œç¨‹çš„æ–­ç‚¹è°ƒè¯•ï¼Œå¦åˆ™åœ¨æœ¬åœ°ideå¼€å¯è¿œç¨‹è°ƒè¯•åå°±ä¼šæ˜¾ç¤º error â€œcould not find â€œ</p>

<p>delveçš„issuesé‡Œè¯¦ç»†çš„è¯´æ˜äº†è¿™ä¸ªé—®é¢˜:https://github.com/go-delve/delve/issues/1163</p>

<p>å°†æœ¬åœ°ä»£ç æ‹·è´åˆ°è¿œç¨‹è°ƒè¯•æœºä¸Š,å¯ä»¥é€šè¿‡golandæ’ä»¶Remote Hosts Accessæ¥å®Œæˆï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¸Šä¼ æˆ–è€…git clone</p>

<p>åœ¨è¿œç¨‹è°ƒè¯•æœºå™¨ä¸Šå®‰è£…è°ƒè¯•å·¥å…·delveï¼Œå®‰è£…æ–¹æ³• è¯¦è§ä½œè€…Github.</p>

<p>ä½¿ç”¨delveå¯åŠ¨è°ƒè¯•,è¿™é‡Œæœ‰2ä¸­æ–¹å¼ï¼Œä¸€ç§æ˜¯å°†ä»£ç æ‰‹åŠ¨ç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºè°ƒè¯•ï¼Œä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨dlvè‡ªåŠ¨ç¼–è¯‘å¯åŠ¨ä»£ç è°ƒè¯•.</p>

<p>æ‰‹åŠ¨ç¼–è¯‘æ–¹å¼è°ƒè¯•(ä½¿ç”¨äº†moduleç‰¹æ€§çš„æ¨èä½¿ç”¨æ­¤æ–¹å¼)</p>

<p>ç¼–è¯‘</p>

<h1 id="go-110ä»¥ä¸Šç‰ˆæœ¬">Go 1.10ä»¥ä¸Šç‰ˆæœ¬</h1>
<p>go build -gcflags â€œall=-N -lâ€ cmd/agent/main.go</p>
<h1 id="ä½¿ç”¨moduleç¦»çº¿æ‰“åŒ…">ä½¿ç”¨moduleç¦»çº¿æ‰“åŒ…</h1>
<p>go build -gcflags â€œall=-N -lâ€ -o bin/agent -mod=vendor cmd/agent/main.go</p>
<h1 id="go-19åŠä»¥å‰">Go 1.9åŠä»¥å‰</h1>
<p>go build -gcflags â€œ-N -lâ€ cmd/agent/main.go
è¿è¡Œ</p>

<p>dlv â€“listen=:2345 â€“headless=true â€“api-version=2 exec bin/agent
1
ç›´æ¥debugè‡ªåŠ¨ç¼–è¯‘è¿è¡Œ</p>

<p>dlv debug â€“headless â€“listen=:2345 â€“api-version=2 cmd/agent/main.go
1
åœ¨æœ¬åœ°golandæ·»åŠ è¿œç¨‹è°ƒè¯•é…ç½®</p>

<p>é€šè¿‡golandçš„èœå•æ Runâ€“&gt;Edit Configurationsæ¥æ·»åŠ è¿œç¨‹è°ƒè¯•çš„é…ç½®
<img src="https://xiazemin.github.io/MyBlog/img/godelve_r.png" /></p>

<p>ç„¶åé€‰æ‹©IDEå³ä¸Šè§’çš„è¿œç¨‹è°ƒè¯•é€‰é¡¹,ç‚¹å‡»å°è™«å­æŒ‰é’®å¼€å§‹è¿œç¨‹è°ƒè¯•å°±å¯ä»¥å¼€å¿ƒçš„åœ¨æœ¬åœ°ä¸‹æ–­ç‚¹è¿œç¨‹è°ƒè¯•æœåŠ¡ç«¯çš„ç¨‹åºå•¦ï¼</p>

<p>tips
å¯ä»¥ä½¿ç”¨dockeræ¥é™ä½è°ƒè¯•ç¯å¢ƒå¤æ‚åº¦,å°†dlvå’Œgo sdkå°è£…åˆ°dockeré‡Œé¢,æŒ‚è½½ä»£ç å·¥ç¨‹ç›®å½•åˆ°dockeré‡ŒGOPATHä¸‹çš„srcç›®å½•é‡Œ.</p>

<p>æ‹‰å–è°ƒè¯•é•œåƒ</p>

<p>docker pull robolwq/golang-debug:1.10.3
1
æŒ‚è½½æœ¬åœ°å·¥ç¨‹å¯åŠ¨docker</p>

<h1 id="rootproject-ä¸ºå·¥ç¨‹ç›®å½•">/root/project ä¸ºå·¥ç¨‹ç›®å½•</h1>

<h1 id="å¯åŠ¨ç”¨äºè°ƒè¯•çš„å®¹å™¨å¹¶æŠŠç›®æ ‡ä»£ç ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…">å¯åŠ¨ç”¨äºè°ƒè¯•çš„å®¹å™¨ï¼Œå¹¶æŠŠç›®æ ‡ä»£ç ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…</h1>
<h1 id="ç‰¹åˆ«æ³¨æ„è¿™ä¸ªå‚æ•°security-opt-seccompunconfined">ç‰¹åˆ«æ³¨æ„è¿™ä¸ªå‚æ•°â€œâ€“security-opt seccomp:unconfinedâ€</h1>
<h1 id="å®ƒçš„ä½œç”¨æ˜¯ç¦ç”¨linuxå†…æ ¸å±‚é¢çš„secure-computing-mode">å®ƒçš„ä½œç”¨æ˜¯ç¦ç”¨Linuxå†…æ ¸å±‚é¢çš„Secure computing mode</h1>
<h1 id="ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®ä½¿ç”¨dlvç›¸å…³å‘½ä»¤">ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®ä½¿ç”¨dlvç›¸å…³å‘½ä»¤</h1>
<h1 id="å…·ä½“å¯ä»¥å‚è§httpsdocsdockercomenginesecurityseccomp">å…·ä½“å¯ä»¥å‚è§ï¼šhttps://docs.docker.com/engine/security/seccomp/</h1>
<p>docker container run -ti â€“rm â€“security-opt seccomp:unconfined â€“net=host -v /root/project:/root/go/src/project robolwq/golang-debug:1.10.3  bash</p>
<blockquote>
  <p>cd $GOPATH/src/project
dlv debug â€“headless â€“listen=:2345 â€“api-version=2 cmd/agent/main.go</p>
</blockquote>

<p>å¦‚æœä½¿ç”¨goland 2019.1ä»¥ä¸‹çš„ç‰ˆæœ¬åˆ™éœ€è¦é…ç½®æœ¬åœ°ç›®å½•å’Œè¿œç¨‹ç›®å½•éƒ½åœ¨ç¯å¢ƒå˜é‡GOPATHä¸­ï¼Œä¸”ç›¸å¯¹è·¯å¾„ä¸€è‡´</p>

<h1 id="windows-æœ¬åœ°ç›®å½•">windows æœ¬åœ°ç›®å½•</h1>
<p>echo %GOPATH%
D:\workspace\go</p>

<h1 id="è¿œç¨‹æœåŠ¡å™¨docker-é‡Œçš„ç¯å¢ƒ">è¿œç¨‹æœåŠ¡å™¨docker é‡Œçš„ç¯å¢ƒ</h1>
<p>echo $GOPATH
/root/go</p>

<h1 id="å·¥ç¨‹ä»£ç å¿…éœ€åç§°ä¸€è‡´ä¸”éƒ½åœ¨å„è‡ªçš„gopathç›®å½•ä¸‹çš„srcç›®å½•é‡Œé¢æ‰å¯ä»¥æ­£å¸¸ä¸‹æ–­ç‚¹è°ƒè¯•">å·¥ç¨‹ä»£ç å¿…éœ€åç§°ä¸€è‡´ä¸”éƒ½åœ¨å„è‡ªçš„GOPATHç›®å½•ä¸‹çš„srcç›®å½•é‡Œé¢æ‰å¯ä»¥æ­£å¸¸ä¸‹æ–­ç‚¹è°ƒè¯•</h1>
<p>cd /root/go/src/project
dlv debug â€“headless â€“listen=:2345 â€“api-version=2 cmd/agent/main.go</p>

<p>https://github.com/go-delve/delve/issues/1163</p>

<p>https://youtrack.jetbrains.com/issue/GO-3988</p>

<p>step1 è¿œç¨‹ä¸»æœº
å®‰è£…delveï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/derekparker/delve
æŒ‰ç…§å®˜æ–¹çš„æç¤ºå®‰è£…å³å¯ï¼ˆæ³¨æ„å› ä¸ºGFWç­‰ä½ æ‡‚å¾—çš„åŸå› ï¼Œç½‘ç»œä¸‹è½½å¯èƒ½è¾ƒæ…¢æˆ–ä¸å¯ç”¨ï¼Œè¯·è‡ªè¡Œä½¿ç”¨æŸé«˜ç§‘æŠ€è½¯ä»¶ï¼Œå¦‚ss+proxychainsç­‰å·¥å…·ï¼‰ã€‚</p>

<p>ä¸‹è½½å¹¶å®‰è£…å®Œæˆåè¾“å…¥dlvå°±ä¼šçœ‹åˆ°å¸®åŠ©ä¿¡æ¯ï¼š</p>

<p>image.png
step2 æœ¬åœ°
æœ¬åœ°è¿›å…¥IDEï¼Œåœ¨è¦è°ƒè¯•çš„åœ°æ–¹æ‰“ä¸Šæ–­ç‚¹ï¼Œç„¶å
runâ€“debugâ€“eidit configurationsâ€“&gt;æ·»åŠ remoteä¸»æœºä¿¡æ¯ã€‚</p>

<p>image.png
ç‚¹debug ç¡®è®¤åï¼Œå°±ä¼šç­‰å¾…è¿œç«¯ä¼ å›çš„debugä¿¡æ¯ã€‚åˆ‡è¿œç«¯ï¼š</p>

<p>step3 è¿œç«¯
å¦‚æˆ‘è¦å¯¹ main.go è¿™ä¸ªé¡¹ç›®debugï¼Œå¯¹mainè¿›è¡Œç¼–è¯‘åï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ
dlv â€“listen=:2345 â€“headless=true â€“api-version=2 exec ./main
ç„¶åæœ¬åœ°å°±æ”¶åˆ°äº†è°ƒè¯•ä¿¡æ¯ã€‚</p>

<p>https://davidlovezoe.wordpress.com/2019/01/24/golang-debug-intermediate/</p>

<p>https://baijiahao.baidu.com/s?id=1615101405775143768&amp;wfr=spider&amp;for=pc</p>

<p>https://github.com/go-delve/delve</p>

<table>
  <tbody>
    <tr>
      <td>åœ¨æœåŠ¡å™¨ä¸Š ps x</td>
      <td>grep game æŸ¥æ‰¾åˆ°gameserverçš„è¿›ç¨‹pid</td>
    </tr>
  </tbody>
</table>

<p>ç„¶åæœåŠ¡å™¨å‘½ä»¤è¡Œè¾“å…¥ï¼š
dlv attach $PID â€“headless â€“api-version=2 â€“log â€“listen=:8181</p>

<p>æœ¬æœºåªè¦è¾“å…¥ï¼š</p>

<p>dlv connect www.example.com:8181 è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„dlvè¿›ç¨‹ï¼Œå°±å¯ä»¥åœ¨æœ¬æœºè¿œç¨‹è°ƒè¯•äº†ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯</p>

<p>æœ¬æœºquit ä»¥åï¼Œè¿œç¨‹dlvè¿›ç¨‹ä¹Ÿä¼šç»“æŸã€‚
æœ¬æœºæ²¡æœ‰dlv connectï¼Œè¿œç¨‹dlvç›´æ¥å…³é—­ä¼šå¯¼è‡´ è¿œç¨‹è°ƒè¯•è¿›ç¨‹PIDç›´æ¥é€€å‡ºï¼ˆå¾ˆæ˜¯å¿§ä¼¤ï¼‰
æœ¬æœºdlvè¾“å…¥quitä»¥åï¼Œä¼šè®©ä½ é€‰æ‹©æ˜¯å¦å…³é—­è°ƒè¯•è¿›ç¨‹ï¼Œè¿™ä¸ªæœ‰æ—¶å€™ä¹Ÿæ–¹ä¾¿ï¼Œä¸è¿‡å¤§å¤šæ•°éƒ½æ˜¯é€‰æ‹©N ä¸å…³é—­è°ƒè¯•è¿›ç¨‹PID</p>
:ET