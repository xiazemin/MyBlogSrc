I"÷
<p>https://github.com/t-yuki/gocover-cobertura
This is a simple helper tool for generating XML output in Cobertura format for CIs like Jenkins and others from go tool cover output.</p>

<p>$ go get code.google.com/p/go.tools/cmd/cover
$ go get github.com/t-yuki/gocover-cobertura</p>

<p>https://github.com/sozorogami/gover
<!-- more --></p>

<p>æ­¤å¤„ä½¿ç”¨å‘½ä»¤go test -c -covermode=count -ldflags â€œ-X main.<em>VERSION</em>=$VERSION.${reversion}â€  -coverpkg  ./gopath/src/mvdsp/module/,./gopath/src/mvdsp/extractor/,./gopath/src/mvdsp/mvutil/,./gopath/src/mvdsp/protocol/ -o dsp_server.test</p>

<p>â‘  -c è¡¨ç¤º ç”Ÿæˆæµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶</p>

<p>â‘¡ -covermode=count è¡¨ç¤º ç”Ÿæˆçš„äºŒè¿›åˆ¶ä¸­åŒ…å«è¦†ç›–ç‡è®¡æ•°ä¿¡æ¯</p>

<p>â‘¢ -ldflags ç”¨æ¥å°†ç‰ˆæœ¬ä¿¡æ¯å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶,è€Œä¸ä½¿ç”¨é¢å¤–çš„versionæ–‡ä»¶</p>

<p>â‘£ -coverpkg åé¢æ˜¯è¦ç»Ÿè®¡è¦†ç›–ç‡çš„æ–‡ä»¶æºç </p>

<p>â‘¤ -o åé¢æ˜¯è¾“å‡ºçš„äºŒè¿›åˆ¶æ–‡ä»¶å</p>

<p>â‘¥ â€¦â€¦å¯èƒ½è¿˜æœ‰æ›´å¤šçš„å¯ç”¨å‚æ•°ï¼Œæˆ‘å°±ä¸çŸ¥é“äº†</p>

<p>3 æ‰§è¡Œå‘½ä»¤ï¼Œç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ‹·è´åˆ°éƒ¨ç½²ç›®å½•ä¸‹</p>

<p>4 å¯åŠ¨æœåŠ¡ï¼Œåœ¨å¯åŠ¨å‘½ä»¤ååŠ å‚æ•°ï¼š -systemTest -test.coverprofile coverage/coverage.cov</p>

<p>â‘  -systemTest ç”¨æ¥å¯åŠ¨å‰é¢è¯´è¿‡çš„main test</p>

<p>â‘¡  -test.coverprofile ç”¨æ¥æŒ‡å®šè¦†ç›–ç‡ä¿¡æ¯å†™å…¥åˆ°å“ªä¸ªæ–‡ä»¶</p>

<p>ä¸‰  ç»Ÿè®¡è¦†ç›–ç‡
1 æ‰§è¡Œè‡ªåŠ¨åŒ–</p>

<p>2 æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤,ç”Ÿæˆè¦†ç›–ç‡æ–‡ä»¶coverage.cov</p>

<p>1
2
pid_server=<code class="language-plaintext highlighter-rouge">ps -ef | grep "my_server -systemTest" | grep -v "grep" | awk '{print $2}'</code>
kill $pid_server
è¦†ç›–ç‡äº§ç”Ÿçš„æ¡ä»¶æ˜¯ç¨‹åºéœ€è¦æ­£å¸¸é€€å‡º/ç»“æŸ, å› æ­¤å½“è‡ªåŠ¨åŒ–è¿è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬éœ€è¦ç»™ç¨‹åºå‘é€æ¶ˆæ¯è¡¨ç¤ºç»“æŸæ‰å¯ä»¥å¾—åˆ°è¦†ç›–ç‡æ–‡ä»¶</p>

<p>å¯¹æ­¤ï¼šgoæ˜¯éœ€è¦return,å³å¯ä»¥kill server_pid(è‹¥æœåŠ¡ä½¿ç”¨supervisorå¯åŠ¨,è¿˜ä¼šè‡ªå·±æ‹‰èµ·æ¥ï¼Œä¸ä¼šå½±å“åç»­è°ƒç”¨)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       c/c++ æ˜¯éœ€è¦exitï¼Ÿï¼Œå‘é€p __gcov_flush()ï¼Œè§http://www.cnblogs.com/zhaoxd07/p/5608177.html

       pythonéœ€è¦è§¦å‘atexitæ¨¡å—æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¯ä½¿ç”¨CTRL+Cæˆ–è€…kill -2
</code></pre></div></div>

<p>3 ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</p>

<p>go tool cover -html=./coverage/coverage.cov -o /data/reports/coverage.html
./coverage/gocover-cobertura &lt; coverage.cov &gt; /data/reports/coverage.xmlã€€ã€€
ç”ŸæˆxmlæŠ¥å‘Šæ—¶éœ€è¦å®‰è£…ä¸€ä¸ªå°æ’ä»¶ï¼šgo get github.com/t-yuki/gocover-cobertura</p>

<p>å°†binä¸‹çš„gocover-coberturaæ”¾åˆ°æ–¹ä¾¿æ‰§è¡Œçš„ç›®å½•ä¸‹å³å¯ä½¿ç”¨</p>

<p>4 å°†æµ‹è¯•æŠ¥å‘Šé›†æˆåˆ°jenkins</p>

<p>https://www.cnblogs.com/zhaoxd07/p/8028847.html</p>

<p>https://github.com/gravityblast/fresh</p>
:ET