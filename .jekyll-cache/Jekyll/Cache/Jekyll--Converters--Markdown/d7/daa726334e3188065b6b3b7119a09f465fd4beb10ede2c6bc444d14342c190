I" <!-- more -->
<p>ngx_http_headers_moduleæ¨¡å—
ä¸€. å‰è¨€
ngx_http_headers_moduleæ¨¡å—æä¾›äº†ä¸¤ä¸ªé‡è¦çš„æŒ‡ä»¤add_headerå’Œexpiresï¼Œæ¥æ·»åŠ  â€œExpiresâ€ å’Œ â€œCache-Controlâ€ å¤´å­—æ®µï¼Œå¯¹å“åº”å¤´æ·»åŠ ä»»ä½•åŸŸå­—æ®µã€‚add_headerå¯ä»¥ç”¨æ¥æ ‡ç¤ºè¯·æ±‚è®¿é—®åˆ°å“ªå°æœåŠ¡å™¨ä¸Šï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥é€šè¿‡nginxæ¨¡å—nginx-http-footer-filterç ”ç©¶ä½¿ç”¨æ¥å®ç°ã€‚expiresæŒ‡ä»¤ç”¨æ¥å¯¹æµè§ˆå™¨æœ¬åœ°ç¼“å­˜çš„æ§åˆ¶ã€‚
äºŒ. add_headeræŒ‡ä»¤
è¯­æ³•: add_header name value;
é»˜è®¤å€¼: â€”
é…ç½®æ®µ: http, server, location, if in location
å¯¹å“åº”ä»£ç ä¸º200ï¼Œ201ï¼Œ204ï¼Œ206ï¼Œ301ï¼Œ302ï¼Œ303ï¼Œ304ï¼Œæˆ–307çš„å“åº”æŠ¥æ–‡å¤´å­—æ®µæ·»åŠ ä»»æ„åŸŸã€‚å¦‚ï¼š</p>

<p>add_header From jb51.net
ä¸‰. expiresæŒ‡ä»¤
è¯­æ³•: expires [modified] time;
expires epoch | max | off;
é»˜è®¤å€¼: expires off;
é…ç½®æ®µ: http, server, location, if in location
åœ¨å¯¹å“åº”ä»£ç ä¸º200ï¼Œ201ï¼Œ204ï¼Œ206ï¼Œ301ï¼Œ302ï¼Œ303ï¼Œ304ï¼Œæˆ–307å¤´éƒ¨ä¸­æ˜¯å¦å¼€å¯å¯¹â€œExpiresâ€å’Œâ€œCache-Controlâ€çš„å¢åŠ å’Œä¿®æ”¹æ“ä½œã€‚
å¯ä»¥æŒ‡å®šä¸€ä¸ªæ­£æˆ–è´Ÿçš„æ—¶é—´å€¼ï¼ŒExpireså¤´ä¸­çš„æ—¶é—´æ ¹æ®ç›®å‰æ—¶é—´å’ŒæŒ‡ä»¤ä¸­æŒ‡å®šçš„æ—¶é—´çš„å’Œæ¥è·å¾—ã€‚
epochè¡¨ç¤ºè‡ª1970å¹´ä¸€æœˆä¸€æ—¥00:00:01 GMTçš„ç»å¯¹æ—¶é—´ï¼ŒmaxæŒ‡å®šExpiresçš„å€¼ä¸º2037å¹´12æœˆ31æ—¥23:59:59ï¼ŒCache-Controlçš„å€¼ä¸º10 yearsã€‚
Cache-Controlå¤´çš„å†…å®¹éšé¢„è®¾çš„æ—¶é—´æ ‡è¯†æŒ‡å®šï¼š
Â·è®¾ç½®ä¸ºè´Ÿæ•°çš„æ—¶é—´å€¼:Cache-Control: no-cacheã€‚
Â·è®¾ç½®ä¸ºæ­£æ•°æˆ–0çš„æ—¶é—´å€¼ï¼šCache-Control: max-age = #ï¼Œè¿™é‡Œ#çš„å•ä½ä¸ºç§’ï¼Œåœ¨æŒ‡ä»¤ä¸­æŒ‡å®šã€‚
å‚æ•°offç¦æ­¢ä¿®æ”¹åº”ç­”å¤´ä¸­çš„â€Expiresâ€å’Œâ€Cache-Controlâ€ã€‚
å®ä¾‹ä¸€ï¼šå¯¹å›¾ç‰‡ï¼Œflashæ–‡ä»¶åœ¨æµè§ˆå™¨æœ¬åœ°ç¼“å­˜30å¤©
location ~ .<em>.(gif|jpg|jpeg|png|bmp|swf)$
 {
      expires 30d;
 }
å®ä¾‹äºŒï¼šå¯¹jsï¼Œcssæ–‡ä»¶åœ¨æµè§ˆå™¨æœ¬åœ°ç¼“å­˜1å°æ—¶
location ~ .</em>.(js|css)$
 {
      expires 1h;
 }
ngx_headers_moreæ¨¡å—
ä¸€. ä»‹ç»ngx_headers_more
ngx_headers_more ç”¨äºæ·»åŠ ã€è®¾ç½®å’Œæ¸…é™¤è¾“å…¥å’Œè¾“å‡ºçš„å¤´ä¿¡æ¯ã€‚nginxæºç æ²¡æœ‰åŒ…å«è¯¥æ¨¡å—ï¼Œéœ€è¦å¦è¡Œæ·»åŠ ã€‚
è¯¥æ¨¡å—æ˜¯ngx_http_headers_moduleæ¨¡å—çš„å¢å¼ºç‰ˆï¼Œæä¾›äº†æ›´å¤šçš„å®ç”¨å·¥å…·ï¼Œæ¯”å¦‚å¤ä½æˆ–æ¸…é™¤å†…ç½®å¤´ä¿¡æ¯ï¼Œå¦‚Content-Type, Content-Length, å’ŒServerã€‚
å¯ä»¥å…è®¸ä½ ä½¿ç”¨-sé€‰é¡¹æŒ‡å®šHTTPçŠ¶æ€ç ï¼Œä½¿ç”¨-té€‰é¡¹æŒ‡å®šå†…å®¹ç±»å‹ï¼Œé€šè¿‡more_set_headers å’Œ more_clear_headers æŒ‡ä»¤æ¥ä¿®æ”¹è¾“å‡ºå¤´ä¿¡æ¯ã€‚å¦‚ï¼š
more_set_headers -s 404 -t â€˜text/htmlâ€™ â€˜X-Foo: Barâ€™;
è¾“å…¥å¤´ä¿¡æ¯ä¹Ÿå¯ä»¥è¿™ä¹ˆä¿®æ”¹ï¼Œå¦‚ï¼š
location /foo {
  more_set_input_headers â€˜Host: fooâ€™ â€˜User-Agent: fakedâ€™;
  # now $host, $http_host, $user_agent, and
  #  $http_user_agent all have their new values.
}
-té€‰é¡¹ä¹Ÿå¯ä»¥åœ¨more_set_input_headerså’Œmore_clear_input_headersæŒ‡ä»¤ä¸­ä½¿ç”¨ã€‚
ä¸åƒæ ‡å‡†å¤´æ¨¡å—ï¼Œè¯¥æ¨¡å—çš„æŒ‡ç¤ºé€‚ç”¨äºæ‰€æœ‰çš„çŠ¶æ€ç ï¼ŒåŒ…æ‹¬4xxå’Œ5xxçš„ã€‚ add_headeråªé€‚ç”¨äº200ï¼Œ201ï¼Œ204ï¼Œ206ï¼Œ301ï¼Œ302ï¼Œ303ï¼Œ304ï¼Œæˆ–307ã€‚</p>

<p>äºŒ. å®‰è£…ngx_headers_more
wget â€˜http://nginx.org/download/nginx-1.5.8.tar.gzâ€™
tar -xzvf nginx-1.5.8.tar.gz
cd nginx-1.5.8/</p>

<h1 id="here-we-assume-you-would-install-you-nginx-under-optnginx">Here we assume you would install you nginx under /opt/nginx/.</h1>
<p>./configure â€“prefix=/opt/nginx <br />
  â€“add-module=/path/to/headers-more-nginx-module
make
make install
ngx_headers_more åŒ…ä¸‹è½½åœ°å€ï¼šhttp://github.com/agentzh/headers-more-nginx-module/tags
ngx_openrestyåŒ…å«è¯¥æ¨¡å—ã€‚
ä¸‰. æŒ‡ä»¤è¯´æ˜
more_set_headers
è¯­æ³•ï¼šmore_set_headers [-t <content-type list="">]... [-s <status-code list="">]... <new-header>...
é»˜è®¤å€¼ï¼šno
é…ç½®æ®µï¼šhttp, server, location, location if
é˜¶æ®µï¼šè¾“å‡ºæŠ¥å¤´è¿‡æ»¤å™¨
æ›¿æ¢ï¼ˆå¦‚æœ‰ï¼‰æˆ–å¢åŠ ï¼ˆå¦‚æœä¸æ˜¯æ‰€æœ‰ï¼‰æŒ‡å®šçš„è¾“å‡ºå¤´æ—¶å“åº”çŠ¶æ€ä»£ç ä¸-sé€‰é¡¹ç›¸åŒ¹é…å’Œå“åº”çš„å†…å®¹ç±»å‹çš„-té€‰é¡¹æŒ‡å®šçš„ç±»å‹ç›¸åŒ¹é…çš„ã€‚
å¦‚æœæ²¡æœ‰æŒ‡å®š-sæˆ–-tï¼Œæˆ–æœ‰ä¸€ä¸ªç©ºè¡¨å€¼ï¼Œæ— éœ€åŒ¹é…ã€‚å› æ­¤ï¼Œå¯¹äºä¸‹é¢çš„æŒ‡å®šï¼Œä»»ä½•çŠ¶æ€ç å’Œä»»ä½•å†…å®¹ç±»å‹éƒ½è®²è®¾ç½®ã€‚
more_set_headers  "Server: my_server";
å…·æœ‰ç›¸åŒåç§°çš„å“åº”å¤´æ€»æ˜¯è¦†ç›–ã€‚å¦‚æœè¦æ·»åŠ å¤´ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„add_headeræŒ‡ä»¤ä»£æ›¿ã€‚
å•ä¸ªæŒ‡ä»¤å¯ä»¥è®¾ç½®/æ·»åŠ å¤šä¸ªè¾“å‡ºå¤´ã€‚å¦‚ï¼š
more_set_headers 'Foo: bar' 'Baz: bah';
åœ¨å•ä¸€æŒ‡ä»¤ä¸­ï¼Œé€‰é¡¹å¯ä»¥å¤šæ¬¡å‡ºç°ï¼Œå¦‚ï¼š
more_set_headers -s 404 -s '500 503' 'Foo: bar';
ç­‰åŒäºï¼š
more_set_headers -s '404 500 503' 'Foo: bar';
æ–°çš„å¤´æ˜¯ä¸‹é¢å½¢å¼ä¹‹ä¸€ï¼š</new-header></status-code></content-type></p>

<p>Name: Value
Name:
Name
æœ€åä¸¤ä¸ªæœ‰æ•ˆæ¸…é™¤çš„å¤´åç§°çš„å€¼ã€‚Nginxçš„å˜é‡å…è®¸æ˜¯å¤´å€¼ï¼Œå¦‚ï¼š
set $my_var â€œdogâ€;
more_set_headers â€œServer: $my_varâ€;
æ³¨æ„ï¼šmore_set_headerså…è®¸åœ¨locationçš„ifå—ä¸­ï¼Œä½†ä¸å…è®¸åœ¨serverçš„ifå—ä¸­ã€‚ä¸‹é¢çš„é…ç½®å°±æŠ¥è¯­æ³•é”™è¯¯ï¼š</p>
<h1 id="this-is-not-allowed">This is NOT allowed!</h1>
<p>server {
    if ($args ~ â€˜downloadâ€™) {
      more_set_headers â€˜Foo: Barâ€™;
    }
    â€¦
  }
more_clear_headers
è¯­æ³•ï¼šmore_clear_headers [-t <content-type list="">]... [-s <status-code list="">]... <new-header>...
é»˜è®¤å€¼ï¼šno
é…ç½®æ®µï¼šhttp, server, location, location if
é˜¶æ®µï¼šè¾“å‡ºæŠ¥å¤´è¿‡æ»¤å™¨
æ¸…é™¤æŒ‡å®šçš„è¾“å‡ºå¤´ã€‚
more_clear_headers -s 404 -t 'text/plain' Foo Baz;
ç­‰åŒäº
more_set_headers -s 404 -t 'text/plain' "Foo: " "Baz: ";
æˆ–
more_clear_headers -s 404 -t 'text/plain' Foo Baz;
ç­‰åŒäº
more_set_headers -s 404 -t 'text/plain' "Foo: " "Baz: ";
æˆ–
more_set_headers -s 404 -t 'text/plain' Foo Baz
ä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦*ï¼Œå¦‚ï¼š
more_clear_headers 'X-Hidden-*';
æ¸…é™¤å¼€å§‹ç”±â€œX-Hidden-â€ä»»ä½•è¾“å‡ºå¤´ã€‚
more_set_input_headers
è¯­æ³•ï¼šmore_set_input_headers [-r] [-t <content-type list="">]... <new-header>...
é»˜è®¤å€¼ï¼šno
é…ç½®æ®µï¼šhttp, server, location, location if
é˜¶æ®µï¼š rewrite tail
éå¸¸ç±»ä¼¼more_set_headersï¼Œä¸åŒçš„æ˜¯å®ƒå·¥ä½œåœ¨è¾“å…¥å¤´ï¼ˆæˆ–è¯·æ±‚å¤´ï¼‰ï¼Œå®ƒä»…æ”¯æŒ-té€‰é¡¹ã€‚
æ³¨æ„ï¼šä½¿ç”¨-té€‰é¡¹çš„æ˜¯è¿‡æ»¤è¯·æ±‚å¤´çš„Content-Typeï¼Œè€Œä¸æ˜¯å“åº”å¤´çš„ã€‚
more_clear_input_headers
è¯­æ³•ï¼šmore_clear_input_headers [-t <content-type list="">]... <new-header>...
é»˜è®¤å€¼ï¼šno
é…ç½®æ®µï¼šhttp, server, location, location if
é˜¶æ®µï¼š rewrite tail
æ¸…é™¤æŒ‡å®šè¾“å…¥å¤´ã€‚å¦‚ï¼š
more_clear_input_headers -s 404 -t 'text/plain' Foo Baz;
ç­‰åŒäº
more_set_input_headers -s 404 -t 'text/plain' "Foo: " "Baz: ";
æˆ–
more_clear_input_headers -s 404 -t 'text/plain' Foo Baz;
ç­‰åŒäº
more_set_input_headers -s 404 -t 'text/plain' "Foo: " "Baz: ";
æˆ–
more_set_input_headers -s 404 -t 'text/plain' Foo Baz
å››. ngx_headers_moreå±€é™æ€§</new-header></content-type></new-header></content-type></new-header></status-code></content-type></p>
<ol>
  <li>ä¸åŒäºæ ‡å‡†å¤´æ¨¡å—ï¼Œè¯¥æ¨¡å—ä¸ä¼šå¯¹ä¸‹é¢å¤´æœ‰æ•ˆï¼š Expires, Cache-Control, å’ŒLast-Modifiedã€‚</li>
  <li>ä½¿ç”¨æ­¤æ¨¡å—æ— æ³•åˆ é™¤Connectionçš„å“åº”æŠ¥å¤´ã€‚å”¯ä¸€æ–¹æ³•æ˜¯æ›´æ”¹src/ HTTP/ ngx_http_header_filter_module.cæ–‡ä»¶ã€‚
äº”. ä½¿ç”¨ngx_headers_more
    <h1 id="set-the-server-output-header">set the Server output header</h1>
    <p>more_set_headers â€˜Server: my-serverâ€™;</p>
  </li>
</ol>

<h1 id="set-and-clear-output-headers">set and clear output headers</h1>
<p>location /bar {
  more_set_headers â€˜X-MyHeader: blahâ€™ â€˜X-MyHeader2: fooâ€™;
  more_set_headers -t â€˜text/plain text/cssâ€™ â€˜Content-Type: text/fooâ€™;
  more_set_headers -s â€˜400 404 500 503â€™ -s 413 â€˜Foo: Barâ€™;
  more_clear_headers â€˜Content-Typeâ€™;</p>

<p># your proxy_pass/memcached_pass/or any other config goes hereâ€¦
}</p>

<h1 id="set-output-headers">set output headers</h1>
<p>location /type {
  more_set_headers â€˜Content-Type: text/plainâ€™;
  # â€¦
}</p>

<h1 id="set-input-headers">set input headers</h1>
<p>location /foo {
  set $my_host â€˜my dogâ€™;
  more_set_input_headers â€˜Host: $my_hostâ€™;
  more_set_input_headers -t â€˜text/plainâ€™ â€˜X-Foo: bahâ€™;</p>

<p># now $host and $http_host have their new valuesâ€¦
  # â€¦
}</p>

<p># replace input header X-Foo <em>only</em> if it already exists
more_set_input_headers -r â€˜X-Foo: howdyâ€™;
å…­. åº”ç”¨ngx_headers_more
ä¿®æ”¹webæœåŠ¡å™¨æ˜¯ä»€ä¹ˆè½¯ä»¶ï¼Œä»€ä¹ˆç‰ˆæœ¬ï¼ŒåŒæ—¶éšè—Centent-Typeã€Accept-Rangeã€Content-Lengthå¤´ä¿¡æ¯ã€‚</p>
:ET