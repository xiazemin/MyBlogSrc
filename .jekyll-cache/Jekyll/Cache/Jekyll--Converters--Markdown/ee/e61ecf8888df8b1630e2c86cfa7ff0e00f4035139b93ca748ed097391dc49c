I"¶^<p>å®‰è£…Devle
ã€€ã€€å®‰è£…Devleéå¸¸ç®€å•ï¼Œç›´æ¥è¿è¡Œgo  get å³å¯ï¼š</p>

<p>go get -u github.com/derekparker/delve/cmd/dlv
ã€€ã€€å¦‚æœä½ çš„goç‰ˆæœ¬ä¸º1.5è¯·å…ˆè®¾ç½®ç¯å¢ƒå˜é‡GO15VENDOREXPERIMENT=1å†è¿è¡Œgo getã€‚æˆ‘çš„goç‰ˆæœ¬ä¸º1.10ï¼Œä¸ç”¨è®¾ç½®ã€‚
ã€€ã€€
ã€€ã€€git clone https://github.com/go-delve/delve.git $GOPATH/src/github.com/go-delve/delve
cd $GOPATH/src/github.com/go-delve/delve
make install</p>

<!-- more -->
<p>ä½¿ç”¨Devleè°ƒè¯•golangæœåŠ¡
ã€€ã€€å…ˆå†™ä¸€ä¸ªç®€å•çš„webæœåŠ¡ï¼Œç„¶åä½¿ç”¨Devleæ¥è¿›è¡Œè°ƒè¯•ã€‚
ã€€ã€€
package main</p>

<p>import (
    â€œfmtâ€
    â€œlogâ€
    â€œnet/httpâ€
    â€œosâ€
)</p>

<p>const port  = â€œ8000â€</p>

<p>func main() {
    http.HandleFunc(â€œ/hiâ€, hi)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fmt.Println("runing on port: " + port)
log.Fatal(http.ListenAndServe(":" + port, nil)) }
</code></pre></div></div>

<p>func hi(w http.ResponseWriter, r *http.Request) {
    hostName, _ := os.Hostname()
    fmt.Fprintf(w, â€œHostName: %sâ€, hostName)
}</p>

<p>ç®€å•å§ï¼Œä¸€ä¸ªè¿è¡Œåœ¨8000ç«¯å£ä¸Šçš„webæœåŠ¡ï¼Œè®¿é—® hiä¼šè¿”å›æœºå™¨çš„åç§°ã€‚ä¸Šé¢ä»£ç çš„è¡Œå·æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œç­‰ä¼šæˆ‘ä»¬æ‰“æ–­ç‚¹çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p>

<p>ã€€  ä½¿ç”¨Delveè¿è¡Œæˆ‘ä»¬çš„main.go</p>

<p>dlv debug ./main.go</p>

<p>å¾ˆç®€å•çš„ä¸€äº›å‘½ä»¤</p>

<p>ã€€ã€€æˆ‘ä»¬å…ˆæ‰“åœ¨mainæ–¹æ³•ä¸Šæ‰“ä¸€ä¸ªæ–­ç‚¹ï¼š</p>

<p>b main.main</p>

<p>ç„¶åè¿è¡Œc æ¥è¿è¡Œåˆ°æ–­ç‚¹ï¼Œ
åœ¨func li  é‡Œæ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨</p>

<p>b main.hi
æˆ–è€…ä½¿ç”¨   â€œæ–‡ä»¶:è¡Œå·â€æ¥æ‰“æ–­ç‚¹</p>

<p>b /home/goworkspace/src/github.com/mytest/main.go:20</p>

<p>ç°åœ¨æ‰§è¡Œcontinue è®©æœåŠ¡è·‘èµ·æ¥ã€‚è®¿é—®ä¸€ä¸‹æˆ‘ä»¬çš„æœåŠ¡ï¼Œçœ‹hiæ–¹æ³•ä¼šä¸ä¼šåœä¸‹æ¥ã€‚</p>

<p>curl localhost:8000/hi
ã€€ã€€çœ‹åˆ°äº†æ²¡ï¼Œåœ¨19å·åœä¸‹æ¥äº†ã€‚
ã€€ã€€
è¾“å…¥ n å›è½¦ï¼Œæ‰§è¡Œåˆ°ä¸‹ä¸€è¡Œ</p>

<p>ã€€ã€€è¾“å…¥s å›è½¦ï¼Œå•æ­¥æ‰§è¡Œ</p>

<p>ã€€ã€€è¾“å…¥ printï¼ˆåˆ«åpï¼‰è¾“å‡ºå˜é‡ä¿¡æ¯ã€€ã€€</p>

<p>ã€€ã€€è¾“å…¥ args æ‰“å°å‡ºæ‰€æœ‰çš„æ–¹æ³•å‚æ•°ä¿¡æ¯</p>

<p>ã€€ã€€è¾“å…¥ locals æ‰“å°æ‰€æœ‰çš„æœ¬åœ°å˜é‡</p>

<p>ä½¿ç”¨Delveé™„åŠ åˆ°è¿è¡Œçš„golangæœåŠ¡è¿›è¡Œè°ƒè¯•
 ã€€ã€€å…ˆç¼–è¯‘ä¸€ä¸‹æˆ‘ä»¬çš„main.goç„¶åå»è¡Œmain</p>

<p>go build main.go</p>

<p>./main</p>

<p>ç„¶åä½¿ç”¨Delveé™„åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸Šï¼Œå…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬çš„é¡¹ç›®çš„pid</p>

<table>
  <tbody>
    <tr>
      <td>ps aux</td>
      <td>grep main</td>
    </tr>
  </tbody>
</table>

<p>æˆ–è€…
$ lsof -i tcp:8000
COMMAND   PID USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
main    56267 didi    3u  IPv6 0xf6b535637660b19f      0t0  TCP *:irdmi (LISTEN)</p>

<p>dlv attach 56267</p>

<p>è¿œç¨‹è°ƒè¯•</p>

<table>
  <tbody>
    <tr>
      <td>åœ¨æœåŠ¡å™¨ä¸Š ps x</td>
      <td>grep game æŸ¥æ‰¾åˆ°gameserverçš„è¿›ç¨‹pid</td>
    </tr>
  </tbody>
</table>

<p>ç„¶åæœåŠ¡å™¨å‘½ä»¤è¡Œè¾“å…¥ï¼š
dlv attach $PID â€“headless â€“api-version=2 â€“log â€“listen=:8181</p>

<p>æœ¬æœºåªè¦è¾“å…¥ï¼š</p>

<p>dlv connect remote_ip:8181 è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„dlvè¿›ç¨‹ï¼Œå°±å¯ä»¥åœ¨æœ¬æœºè¿œç¨‹è°ƒè¯•äº†ã€‚</p>

<p>golandè°ƒè¯•
<img src="https://xiazemin.github.io/MyBlog/img/goland_dlv.png" />
dlvåœæ­¢è°ƒè¯•å¯ä»¥ç”¨ctrl+|</p>

<p>dlv attach goç¨‹åº
dlv attach 7148 â€“headless â€“listen=:2345 â€“api-version=2 â€“accept-multiclient</p>

<p>GoLandé…ç½®
Main menu-&gt;Run-&gt;Edit Configurationsâ€¦</p>

<p>-&gt; Go Remote
Hostæ”¹æˆæœåŠ¡å™¨ip</p>

<p>Port: 2345</p>

<p>ä¿å­˜ å Debug go remote</p>

<p>æ­¤æ—¶å¯ä»¥è®¾ç½®æ–­ç‚¹, åœ¨ Variables é¢æ¿å¯ä»¥æŸ¥çœ‹å˜é‡, å¯ä»¥ç‚¹å‡»<strong>+å¢åŠ Watch</strong></p>

<p>ç»ˆæ­¢dlvå’Œgoç¨‹åº
dlvä¸ç»ˆæ­¢, åˆ™ goç¨‹åºä¹Ÿæ— æ³•ç»ˆæ­¢
è€Œdlvåªèƒ½é€šè¿‡ç»ˆæ­¢è¿›ç¨‹çš„æ–¹å¼ç»ˆæ­¢æ‰</p>

<p>kill -9 <code class="language-plaintext highlighter-rouge">ps -ef | grep "dlv|mytest" -E | awk '{print $2}'</code></p>

<p>ä¸ºbuildæˆ–installå‚æ•°åŠ å…¥å…³é—­ç¼–è¯‘å™¨ä¼˜åŒ–çš„å‚æ•° -gcflags â€œ-N -lâ€ã€‚ä¾‹å¦‚:</p>

<p>go install -gcflags â€œ-N -lâ€ svc/gamesvc</p>

<p>LiteIDEä¸­çš„delveè°ƒè¯•å™¨é…ç½®
é€‰æ‹©è°ƒè¯•å™¨
åœ¨LiteIDEèœå•ä¸­é€‰æ‹© è°ƒè¯•-&gt;debugger/delve</p>

<p>delveç¯å¢ƒå˜é‡è®¾ç½®
è¿™ä¸ªæ—¶å€™, LiteIDEä¾ç„¶æ‰¾ä¸åˆ°delve, å› ä¸ºå®ƒä¸åœ¨ç¯å¢ƒå˜é‡PATHä¸­, è¿™é‡Œæ— éœ€ä¿®æ”¹ç¯å¢ƒå˜é‡, åªéœ€è¦LiteIDEçš„ç¯å¢ƒé…ç½®ã€‚åœ¨LiteIDEèœå•ä¸­é€‰æ‹© æŸ¥çœ‹-&gt;ç¼–è¾‘å½“å‰ç¯å¢ƒ, åœ¨å¼¹å‡ºçš„æ–‡æ¡£ä¸­ä¿®æ”¹</p>

<p>PATH=c:\mingw32\bin;%GOROOT%\bin;%PATH%;c:\your\path\to\delve
1
å»æ‰PATHå‰çš„æ³¨é‡Š#, åœ¨%PATH%æ·»åŠ åˆ†å·, ç„¶åå’Œä½ åˆ°delveè°ƒè¯•å™¨çš„è·¯å¾„</p>

<p>golandæ˜¯åŸºäºintellij IDEAæ¨å‡ºçš„å¼€å‘goçš„IDEï¼Œæ‰€ä»¥å¾ˆå¤šä¹‹å‰Intellijçš„ä½¿ç”¨ä¹ æƒ¯å¯ä»¥ä¿ç•™ä¸‹æ¥ï¼Œå®å±developerçš„ç¦éŸ³ï¼Œä»Šå¤©é‡åˆ°ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œå°±æ˜¯æˆ‘è¦è°ƒè¯•è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„goä»£ç ï¼Œè¿œç¨‹ç³»ç»Ÿæ˜¯ubuntuæˆ–è€…centosï¼Œæ€»ä¹‹æ˜¯æ²¡æœ‰å›¾å½¢ç•Œé¢çš„ï¼Œæˆ‘æƒ³åœ¨æœ¬åœ°è°ƒè¯•è¯¥æ€ä¹ˆåŠå‘¢ï¼Œç­”æ¡ˆæ˜¯ä½¿ç”¨Delve è¿™ä¸ªä¸“é—¨çš„è°ƒè¯•å·¥å…·ã€‚</p>

<p>å‰æï¼šæœ¬åœ°ä»£ç å’Œè¿œç¨‹ä»£ç ä¿æŒä¸€è‡´ï¼Œå¦åˆ™å¯èƒ½å‡ºç°æ–­ç‚¹è¯­å¥è·Ÿé¢„æœŸä¸ä¸€è‡´æˆ–è«åå…¶å¦™çš„æƒ…å†µã€‚å¯ä»¥åœ¨Intellijä¸­ä½¿ç”¨ç»å…¸çš„remote host accessæ’ä»¶æ¥dowloadæˆ–è€…uploadä»£ç å®ç°åŒæ­¥ã€‚å› ä¸ºæ¯”è¾ƒç®€å•ï¼Œå…·ä½“ä½¿ç”¨å§¿åŠ¿è‡ªè¡Œæ¢ç´¢ã€‚</p>

<p>step1 è¿œç¨‹ä¸»æœº
å®‰è£…delveï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/derekparker/delve
æŒ‰ç…§å®˜æ–¹çš„æç¤ºå®‰è£…å³å¯ï¼ˆæ³¨æ„å› ä¸ºGFWç­‰ä½ æ‡‚å¾—çš„åŸå› ï¼Œç½‘ç»œä¸‹è½½å¯èƒ½è¾ƒæ…¢æˆ–ä¸å¯ç”¨ï¼Œè¯·è‡ªè¡Œä½¿ç”¨æŸé«˜ç§‘æŠ€è½¯ä»¶ï¼Œå¦‚ss+proxychainsç­‰å·¥å…·ï¼‰ã€‚</p>

<p>ä¸‹è½½å¹¶å®‰è£…å®Œæˆåè¾“å…¥dlvå°±ä¼šçœ‹åˆ°å¸®åŠ©ä¿¡æ¯ï¼š</p>

<p>step2 æœ¬åœ°
æœ¬åœ°è¿›å…¥IDEï¼Œåœ¨è¦è°ƒè¯•çš„åœ°æ–¹æ‰“ä¸Šæ–­ç‚¹ï¼Œç„¶å
runâ€“debugâ€“eidit configurationsâ€“&gt;æ·»åŠ remoteä¸»æœºä¿¡æ¯ã€‚</p>

<p>ç‚¹debug ç¡®è®¤åï¼Œå°±ä¼šç­‰å¾…è¿œç«¯ä¼ å›çš„debugä¿¡æ¯ã€‚åˆ‡è¿œç«¯ï¼š</p>

<p>step3 è¿œç«¯
å¦‚æˆ‘è¦å¯¹ main.go è¿™ä¸ªé¡¹ç›®debugï¼Œå¯¹mainè¿›è¡Œç¼–è¯‘åï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ
dlv â€“listen=:2345 â€“headless=true â€“api-version=2 exec ./main
ç„¶åæœ¬åœ°å°±æ”¶åˆ°äº†è°ƒè¯•ä¿¡æ¯ã€‚</p>

<p>golang remote debugå’Œdocker debug
æœ‰æ—¶å€™æˆ‘ä¹ˆéœ€è¦è¿œç¨‹è°ƒè¯•golangç¨‹åº,æ¯”å¦‚æˆ‘ä»¬åœ¨macoså†™çš„ä»£ç ,ä½†æ˜¯æœ‰æ—¶åœ¨linuxä¸Šè¿è¡Œçš„,æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿œç¨‹è°ƒè¯•è¿è¡Œåœ¨linuxç³»ç»Ÿçš„ä»£ç ã€‚å¦å¤–ä¸€ç§æƒ…å†µæ˜¯æˆ‘ä»¬å¯ä»¥æŠŠgoalngæ‰“åŒ…åˆ°docker é•œåƒä¸­,ä»£ç è·‘åœ¨å®¹å™¨ä¸­åŒæ ·å¯ä»¥è°ƒè¯•ã€‚ä»¥golandä¸ºä¾‹ã€‚</p>

<p>remote debug
è¿œç¨‹è°ƒè¯•golangä»£ç éœ€è¦åœ¨è¿è¡Œä»£ç çš„è¿œç¨‹æœºå™¨ä¸ŠæŒ‰ç…§delve,ç„¶åä»¥delveè¿è¡Œè¦è°ƒè¯•çš„ç¨‹åºã€‚</p>

<p>ç¼–è¯‘
   export CGO_ENABLED=0 GOOS=linux GOARCH=amd64
   go build -gcflags=â€™all -N -lâ€™ main.go
install delve
   go get go get -u github.com/derekparker/delve/cmd/dlv 
delve è¿è¡Œç¨‹åº
 dlv â€“listen=:2345 â€“headless=true â€“api-version=2 exec ./main
goland è®¾ç½®remote debug
hostä¸ºè¿œç¨‹ä¸»æœºip ç«¯å£æ˜¯åˆšæ‰dlvè®¾ç½®çš„ç«¯å£</p>

<p>debug
ç„¶åå°±åƒè°ƒè¯•æœ¬åœ°ä»£ç ä¸€æ ·è°ƒè¯•è¿œç¨‹ä¸»æœºä¸Šçš„ç¨‹åº</p>

<p>dlv â€“listen=:2345 â€“headless=true â€“api-version=2 â€“accept-multiclient exec ./test1</p>

<table>
  <tbody>
    <tr>
      <td>åœ¨æœåŠ¡å™¨ä¸Š ps x</td>
      <td>grep game æŸ¥æ‰¾åˆ°gameserverçš„è¿›ç¨‹pid</td>
    </tr>
  </tbody>
</table>

<p>ç„¶åæœåŠ¡å™¨å‘½ä»¤è¡Œè¾“å…¥ï¼š
dlv attach $PID â€“headless â€“api-version=2 â€“log â€“listen=:8181</p>

<p>æœ¬æœºåªè¦è¾“å…¥ï¼š</p>

<p>dlv connect www.example.com:8181 è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„dlvè¿›ç¨‹ï¼Œå°±å¯ä»¥åœ¨æœ¬æœºè¿œç¨‹è°ƒè¯•äº†ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯</p>

<p>æœ¬æœºquit ä»¥åï¼Œè¿œç¨‹dlvè¿›ç¨‹ä¹Ÿä¼šç»“æŸã€‚
æœ¬æœºæ²¡æœ‰dlv connectï¼Œè¿œç¨‹dlvç›´æ¥å…³é—­ä¼šå¯¼è‡´ è¿œç¨‹è°ƒè¯•è¿›ç¨‹PIDç›´æ¥é€€å‡ºï¼ˆå¾ˆæ˜¯å¿§ä¼¤ï¼‰
æœ¬æœºdlvè¾“å…¥quitä»¥åï¼Œä¼šè®©ä½ é€‰æ‹©æ˜¯å¦å…³é—­è°ƒè¯•è¿›ç¨‹ï¼Œè¿™ä¸ªæœ‰æ—¶å€™ä¹Ÿæ–¹ä¾¿ï¼Œä¸è¿‡å¤§å¤šæ•°éƒ½æ˜¯é€‰æ‹©N ä¸å…³é—­è°ƒè¯•è¿›ç¨‹PID</p>

<p>could not attach to pid 56267: open : no such file or directory</p>

<p>é—®é¢˜
Golandå’ŒIdeaä½¿ç”¨debugæŠ¥é”™ï¼Œå¦‚ä¸‹ï¼šcould not launch process: decoding dwarf section info at offset 0x0: too shortã€‚</p>

<p>è§£å†³æ–¹æ³•
1,æ›´æ–°dlv</p>

<p>go get -u github.com/derekparker/delve/cmd/dlv
2.ä¿®æ”¹golandæˆ–ideaé…ç½®
æ›´æ–°åçš„divåœ¨$gopathè·¯å¾„ä¸‹çš„binæ–‡ä»¶å¤¹ä¸‹ã€‚</p>

<p>æ›¿æ¢åˆ°ideaæˆ–golandçš„è¿™ä¸ªç›®å½•ä¸‹</p>

<p>Delveï¼ˆdlvï¼‰æ— æ³•é™„åŠ åˆ°è¿›ç¨‹
Iâ€™m getting this error back from dlv</p>

<p>could not attach to pid 20727: decoding dwarf section info at offset 0x0: too short
The binary is built in this way:</p>

<p>go build -a -v -ldflags â€œ-w -X main.gitCommit=<sha> -linkmode 'auto' -extldflags '-static'"
Could you confirm that is the
-w
flag that cause the following issue? Does it strip the debug symbol?</sha></p>

<p>After Iâ€™ve removed the -w flag delve was able to attach to the process</p>

<p>$ sudo dlv attach 69291
could not attach to pid 69291: open : no such file or directory</p>

<p>https://stackoverflow.com/questions/54338111/delve-dlv-is-not-able-to-attach-to-the-process</p>

<p>https://stackoverflow.com/questions/53621853/golang-dlv-unable-to-see-source-no-such-file-or-directory</p>

<p>could not attach to pid: decoding dwarf section info at offset 0x0: too short</p>

<p>ç¬¬ä¸€æ¬¡ä½¿ç”¨dlv attachï¼Œå°±ç¢°åˆ°äº†è¿™ä¸ªè«åçš„é—®é¢˜ã€‚æŸ¥äº†å¥½å¤šèµ„æ–™ï¼Œéƒ½è¯´æ˜¯dlvç‰ˆæœ¬å¤ªä½ï¼Œè®©æ›´æ–°dlvï¼Œï¼Œï¼Œè¯•äº†ï¼Œæ— æœã€‚
ç»ˆäºåœ¨derekparker/delveçš„issueä¸­çš„ä¸€ä¸ªé—®é¢˜æ‰¾åˆ°æŸ¥é”™æ€è·¯ï¼Œgo buildçš„å‚æ•°ï¼Ÿ
æŸ¥çœ‹ç¼–è¯‘å‘½ä»¤ï¼šgo build -o $(APP) -x -ldflags â€œ-w -sâ€
å‚æ•°ä¸­-ldflags â€œ-w -sâ€å«ä¹‰ï¼š</p>

<p>-ldflags â€˜flag listâ€™
    â€˜-s -wâ€™: å‹ç¼©ç¼–è¯‘åçš„ä½“ç§¯
    -s: å»æ‰ç¬¦å·è¡¨
    -w: å»æ‰è°ƒè¯•ä¿¡æ¯ï¼Œä¸èƒ½gdbè°ƒè¯•äº†</p>

<p>å»æ‰äº†-ldflags â€œ-w -sâ€åé‡æ–°ç¼–åŒ…ï¼Œé—®é¢˜è§£å†³ã€‚</p>

<p>gdbæ˜¯å¼ºå¤§çš„è°ƒè¯•å·¥å…·ã€‚ä½†å¯¹äºgolangç¨‹åºæ¥è¯´ï¼Œdelveæ˜¯ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œå®ƒèƒ½æ›´å¥½åœ°ç†è§£Go runtime, data structures, and expressionsï¼Œå°¤å…¶æ˜¯goroutineã€‚</p>

<p>ä»¥ä¸‹æè¿°å¼•ç”¨è‡ªDebugging Go Code with GDBã€1ã€‘</p>

<p>Note that Delve is a better alternative to GDB when debugging Go programs built with the standard toolchain. It understands the Go runtime, data structures, and expressions better than GDB. Delve currently supports Linux, OSX, and Windows on amd64. For the most up-to-date list of supported platforms, please see the Delve documentation.</p>

<p>GDB does not understand Go programs well. The stack management, threading, and runtime contain aspects that differ enough from the execution model GDB expects that they can confuse the debugger and cause incorrect results even when the program is compiled with gccgo. As a consequence, although GDB can be useful in some situations (e.g., debugging Cgo code, or debugging the runtime itself), it is not a reliable debugger for Go programs, particularly heavily concurrent ones. Moreover, it is not a priority for the Go project to address these issues, which are difficult.</p>

<p>Delve is a debugger for the Go programming languageã€2ã€‘.</p>

<p>å®‰è£…
å®‰è£…è¿‡ç¨‹å‚è€ƒhttps://github.com/go-delve/delve/tree/master/Documentation/installation</p>

<p>å®‰è£…å¥½åï¼Œå¯ä»¥æŸ¥çœ‹ç‰ˆæœ¬</p>

<p>âœ  _posts dlv version
Delve Debugger
Version: 1.1.0
Build: $Id: 1990ba12450cab9425a2ae62e6ab988725023d5c
è°ƒè¯•æ–¹æ³•
dlvæä¾›äº†å¤šç§è°ƒè¯•å‘½ä»¤ï¼Œå¦‚debugã€execã€attachã€coreç­‰ï¼Œå…·ä½“è§å®˜ç½‘æ–‡æ¡£æˆ–helpä¿¡æ¯ã€‚æ¥ä¸‹ä»‹ç»å¸¸ç”¨çš„å‡ ç§ã€‚</p>

<p>dlv debug
è¿™æ˜¯ä¸€ä¸ªä»£ç å·¥ç¨‹å®ä¾‹, ä½äºç›®å½•GoWorks/GoDbgã€‚</p>

<p>image</p>

<p>å¦‚æœä½äºå·¥ç¨‹ç›®å½•ä¸‹ï¼Œå¯ä»¥dlv debugå¼€å§‹è°ƒè¯•ï¼›
ä¹Ÿå¯ä»¥æŒ‡å®šç›®å½•ï¼Œdlv debug GoWorks/GoDbg;
å¦‚æœè¦ä¼ å…¥å‚æ•°ï¼Œæ·»åŠ â€“åæŒ‡å®šï¼Œ å¦‚dlv debug GoWorks/GoDbg â€“ -arg1 value
âœ  GoDbg dlv debug GoWorks/GoDbg
Type â€˜helpâ€™ for list of commands.
(dlv) break main.main
Breakpoint 1 set at 0x1089f6b for main.main() ./main.go:7
(dlv) continue</p>
<blockquote>
  <p>main.main() ./main.go:7 (hits goroutine(1):1 total:1) (PC: 0x1089f6b)
     2:	import (
     3:		â€œGoWorks/GoDbg/mylibâ€
     4:		â€œfmtâ€
     5:		â€œosâ€
     6:	)
=&gt;   7:	func main() {
     8:		fmt.Println(â€œGolang dbg testâ€¦â€)
     9:		var argc = len(os.Args)
    10:		var argv = append([]string{}, os.Argsâ€¦)
    11:		fmt.Printf(â€œargc:%d\nâ€, argc)
    12:		fmt.Printf(â€œargv:%v\nâ€, argv)
(dlv) next
main.main() ./main.go:8 (PC: 0x1089f82)
     3:		â€œGoWorks/GoDbg/mylibâ€
     4:		â€œfmtâ€
     5:		â€œosâ€
     6:	)
     7:	func main() {
=&gt;   8:		fmt.Println(â€œGolang dbg testâ€¦â€)
     9:		var argc = len(os.Args)
    10:		var argv = append([]string{}, os.Argsâ€¦)
    11:		fmt.Printf(â€œargc:%d\nâ€, argc)
    12:		fmt.Printf(â€œargv:%v\nâ€, argv)
    13:		var var1 = 1
å…·ä½“æœ‰å“ªäº›debugå‘½ä»¤ï¼Œå¯ä»¥helpæ¥æŸ¥çœ‹ï¼Œä¸gdbçš„å¾ˆç±»ä¼¼ï¼Œgoroutine/goroutinesçš„æ˜¯dlvä¸­ç‰¹æœ‰çš„ã€‚</p>
</blockquote>

<p>(dlv) help
The following commands are available:
    args â€”â€”â€”â€”â€”â€”â€”â€” Print function arguments.
    break (alias: b) â€”â€”â€”â€” Sets a breakpoint.
    breakpoints (alias: bp) â€”â€“ Print out info for active breakpoints.
    call â€”â€”â€”â€”â€”â€”â€”â€” Resumes process, injecting a function call (EXPERIMENTAL!!!)
    clear â€”â€”â€”â€”â€”â€”â€”â€“ Deletes breakpoint.
    clearall â€”â€”â€”â€”â€”â€”â€“ Deletes multiple breakpoints.
    condition (alias: cond) â€”â€“ Set breakpoint condition.
    config â€”â€”â€”â€”â€”â€”â€”- Changes configuration parameters.
    continue (alias: c) â€”â€”â€” Run until breakpoint or program termination.   // ç»§ç»­è¿è¡Œ
    deferred â€”â€”â€”â€”â€”â€”â€“ Executes command in the context of a deferred call.
    disassemble (alias: disass) - Disassembler.
    down â€”â€”â€”â€”â€”â€”â€”â€” Move the current frame down.
    edit (alias: ed) â€”â€”â€”â€” Open where you are in $DELVE_EDITOR or $EDITOR
    exit (alias: quit | q) â€”â€” Exit the debugger.
    frame â€”â€”â€”â€”â€”â€”â€”â€“ Set the current frame, or execute command on a different frame.
    funcs â€”â€”â€”â€”â€”â€”â€”â€“ Print list of functions.
    goroutine (alias: gr) â€”â€”- Shows or changes current goroutine
    goroutines (alias: grs) â€”â€“ List program goroutines.
    help (alias: h) â€”â€”â€”â€”- Prints the help message.
    libraries â€”â€”â€”â€”â€”â€”- List loaded dynamic libraries
    list (alias: ls | l) â€”â€”â€“ Show source code.    // æ˜¾ç¤ºä»£ç 
    locals â€”â€”â€”â€”â€”â€”â€”- Print local variables.
    next (alias: n) â€”â€”â€”â€”- Step over to next source line.  // å•æ­¥ä¸‹ä¸€å¥
    on â€”â€”â€”â€”â€”â€”â€”â€”â€“ Executes a command when a breakpoint is hit.
    print (alias: p) â€”â€”â€”â€” Evaluate an expression.
    regs â€”â€”â€”â€”â€”â€”â€”â€” Print contents of CPU registers.
    restart (alias: r) â€”â€”â€”- Restart process.
    set â€”â€”â€”â€”â€”â€”â€”â€”- Changes the value of a variable.
    source â€”â€”â€”â€”â€”â€”â€”- Executes a file containing a list of delve commands
    sources â€”â€”â€”â€”â€”â€”â€” Print list of source files.
    stack (alias: bt) â€”â€”â€”â€“ Print stack trace.
    step (alias: s) â€”â€”â€”â€”- Single step through program.  // è¿›å…¥å‡½æ•°å†…,å•æ­¥ä¸‹ä¸€å¥
    step-instruction (alias: si)  Single step a single cpu instruction.
    stepout (alias: so) â€”â€”â€” Step out of the current function.
    thread (alias: tr) â€”â€”â€”- Switch to the specified thread.
    threads â€”â€”â€”â€”â€”â€”â€” Print out info for every traced thread.
    trace (alias: t) â€”â€”â€”â€” Set tracepoint.
    types â€”â€”â€”â€”â€”â€”â€”â€“ Print list of types
    up â€”â€”â€”â€”â€”â€”â€”â€”â€“ Move the current frame up.
    vars â€”â€”â€”â€”â€”â€”â€”â€” Print package variables.
    whatis â€”â€”â€”â€”â€”â€”â€”- Prints type of an expression.
Type help followed by a command for full documentation.
dlv exec
Execute a precompiled binary, and begin a debug session.</p>

<p>âœ  file ./main
./main: Mach-O 64-bit executable x86_64
âœ  dlv exec ./main
Type â€˜helpâ€™ for list of commands.
(dlv)
dlv attach
Attach to running process and begin debugging.</p>

<p>æ³¨æ„ï¼šåœ¨é€€å‡ºæ—¶ï¼Œæœ‰å¯é€‰æ˜¯å¦è¦killè¯¥è¿›ç¨‹ã€‚</p>

<p>[root@yg-man-uhost-set9-01 ~]# dlv attach 22063
Type â€˜helpâ€™ for list of commands.
(dlv) q
Would you like to kill the process? [Y/n] n
dlv core
Examine a core dump.</p>

<p>æ³¨æ„ï¼šdlvä¸æ”¯æŒç”Ÿæˆcoreï¼Œå¯ä»¥é€šè¿‡gdb attachä¸Šå»åï¼Œæ‰§è¡Œgcoreæ¥ç”Ÿæˆcoreï¼›ç„¶åå†dlv coreæ¥è°ƒè¯•ã€‚</p>

<p>çº¿ä¸Šè°ƒè¯•çš„ä¾‹å­
æ’æŸ¥è¿‡ç¨‹
çº¿ä¸Šä¸€ä¸ªæœåŠ¡å‡ºç°äº†é—®é¢˜ï¼Œçœ‹æ—¥å¿—æ˜¯ä¸€ä¸ªæ¥å£çš„ç¨‹åºè·‘äº†ä¸€åŠï¼Œåé¢ä¸å†æ‰§è¡Œä¸‹å»äº†ã€‚</p>

<p>dlv attachä¸Šå»åï¼Œçœ‹åˆ°æœ‰å¾ˆå¤š.runtime_SemacquireMutexè¿™ä¸ªçš„goroutineï¼Œä¸€ç›´å¡ç€ã€‚</p>

<p>Goroutine 28232679 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28232684 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(<em>TCPTask).Run (0x6ce8cc)
Goroutine 28232685 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28232686 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28232688 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(</em>TCPTask).Run (0x6ce8cc)
Goroutine 28232704 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(<em>TCPTask).Run (0x6ce8cc)
Goroutine 28232705 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28232710 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(</em>TCPTask).Run (0x6ce8cc)
Goroutine 28232714 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(<em>TCPTask).Run (0x6ce8cc)
Goroutine 28232715 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28232718 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(</em>TCPTask).Run (0x6ce8cc)
Goroutine 28232719 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28232721 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28232726 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(<em>TCPTask).Run (0x6ce8cc)
Goroutine 28232727 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28232939 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(</em>TCPTask).Run (0x6ce8cc)
Goroutine 28232940 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28239464 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(<em>TCPTask).Run (0x6ce8cc)
Goroutine 28239465 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28239914 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(</em>TCPTask).Run (0x6ce8cc)
Goroutine 28239915 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28239938 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(<em>TCPTask).Run (0x6ce8cc)
Goroutine 28239939 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28239965 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(</em>TCPTask).Run (0x6ce8cc)
Goroutine 28239966 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28239968 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(<em>TCPTask).Run (0x6ce8cc)
Goroutine 28239984 - User: /Users/patrick.xu/go/src/uframework/task/tcp_task.go:84 uframework/task.(</em>TCPTask).Run (0x6ce8cc)
Goroutine 28239985 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28240001 - User: /usr/local/go/src/runtime/sema.go:62 sync.runtime_SemacquireMutex (0x43cb74)
Goroutine 28240961 - User: /Users/patrick.xu/go/src/uframework/log/logext.go:281 uframework/log.RealWrite (0x6bff2d)
Goroutine 28241103 - User: /Users/patrick.xu/go/src/uframework/utils/zookeeper/zk/conn.go:515 uframework/utils/zookeeper/zk.(<em>Conn).sendLoop (0x7c7835)
Goroutine 28241104 - User: /usr/local/go/src/runtime/netpoll.go:164 net.runtime_pollWait (0x426ec9)
Goroutine 28241126 - User: /usr/local/go/src/runtime/sema.go:47 sync.runtime_Semacquire (0x43ca94)
çœ‹è¿™ä¸ªgoroutineå¡åœ¨äº†0x000000000046c45d in sync.(</em>Mutex).Lockï¼Œå¯¹åº”ä¸šåŠ¡ä»£ç uhost-go/uhost-scheduler/logic.updateBufferã€‚</p>

<p>(dlv) gr 28239985
Switched from 28241159 to 28239985 (thread 31788)
(dlv) bt
0  0x000000000042c76a in runtime.gopark
   at /usr/local/go/src/runtime/proc.go:272
1  0x000000000042c84e in runtime.goparkunlock
   at /usr/local/go/src/runtime/proc.go:277
2  0x000000000043ce91 in runtime.semacquire
   at /usr/local/go/src/runtime/sema.go:130
3  0x000000000043cb74 in sync.runtime_SemacquireMutex
   at /usr/local/go/src/runtime/sema.go:62
4  0x000000000046c45d in sync.(<em>Mutex).Lock
   at /usr/local/go/src/sync/mutex.go:87
5  0x0000000000817b1d in uhost-go/uhost-scheduler/logic.updateBuffer
   at /Users/patrick.xu/go/src/uhost-go/uhost-scheduler/logic/get_suitable_resource.go:418
6  0x0000000000814bd7 in uhost-go/uhost-scheduler/logic.getSuitableResource
   at /Users/patrick.xu/go/src/uhost-go/uhost-scheduler/logic/get_suitable_resource.go:328
7  0x00000000006cecd4 in uframework/task.TCPTaskFunc.ServeTCP
   at /Users/patrick.xu/go/src/uframework/task/tcp_task_handle.go:27
8  0x00000000006d02b8 in uframework/task.(</em>TCPTask).Run.func1
   at /Users/patrick.xu/go/src/uframework/task/tcp_task.go:66
9  0x0000000000458dd1 in runtime.goexit
   at /usr/local/go/src/runtime/asm_amd64.s:2197
å†å»çœ‹ä¸šåŠ¡ä»£ç ï¼Œ frame 5 list</p>

<p>(dlv) frame 5 list
Goroutine 28239985 frame 5 at /Users/patrick.xu/go/src/uhost-go/uhost-scheduler/logic/get_suitable_resource.go:418 (PC: 0x817b1d)
Command failed: open /Users/patrick.xu/go/src/uhost-go/uhost-scheduler/logic/get_suitable_resource.go: no such file or directory
ç”±äºçº¿ä¸Šæ²¡æœ‰æºä»£ç ï¼Œæç¤ºæ–‡ä»¶ä¸å­˜åœ¨ã€‚åˆ°æœ¬åœ°æŸ¥çœ‹è¿™è¡Œçš„ä»£ç ã€‚
image</p>

<p>å®šä½åˆ°è¿™è¡Œåï¼Œå†ç»“åˆä¸šåŠ¡é€»è¾‘å»åˆ†æï¼Œå°±èƒ½å®šä½åˆ°æ˜¯å“ªé‡Œé—®é¢˜ï¼Œé€ æˆäº†è¿™é‡Œçš„æ­»é”ã€‚</p>

<p>æœ€åé€€å‡ºæ¥åï¼Œæ³¨æ„å‘ä¸Šä»£ç åˆ«é‡å¯ã€‚</p>

<p>(dlv) q
Would you like to kill the process? [Y/n] n
å’Œgdbçš„å¯¹æ¯”
gdbèƒ½çœ‹å‡ºçš„ä¿¡æ¯æœ‰é™ï¼Œåªèƒ½å®šä½åˆ°çº¿ç¨‹è¿™ä¸ªå±‚é¢ï¼Œæ— æ³•åˆ°goroutineè¿™ä¸€å±‚ï¼Œå¾ˆéš¾å®šä½å‡ºé—®é¢˜ã€‚</p>

<p>(gdb) info threads</p>
<ul>
  <li>1 process 10732  runtime.epollwait () at /usr/local/go/src/runtime/sys_linux_amd64.s:560
(gdb) thread apply all bt</li>
</ul>

<p>Thread 1 (process 10732):
#0  runtime.epollwait () at /usr/local/go/src/runtime/sys_linux_amd64.s:560
#1  0x00000000004280d1 in runtime.netpoll (block=true, ~r1=0x1) at /usr/local/go/src/runtime/netpoll_epoll.go:67
#2  0x0000000000430f8f in runtime.findrunnable (gp#10=0xc42001c000, inheritTime=false) at /usr/local/go/src/runtime/proc.go:2084
#3  0x0000000000431aec in runtime.schedule () at /usr/local/go/src/runtime/proc.go:2222
#4  0x0000000000431deb in runtime.park_m (gp=0xc4200011e0) at /usr/local/go/src/runtime/proc.go:2285
#5  0x000000000045626b in runtime.mcall () at /usr/local/go/src/runtime/asm_amd64.s:269
#6  0x0000000000cebd00 in runtime.work ()
#7  0x00007ffe3162bc70 in ?? ()
#8  0x0000000000cebd80 in runtime.work ()
#9  0x00007ffe3162bc60 in ?? ()
#10 0x000000000042f0e4 in runtime.mstart () at /usr/local/go/src/runtime/proc.go:1149
#11 0x00000000004560d9 in runtime.rt0_go () at /usr/local/go/src/runtime/asm_amd64.s:169
#12 0x0000000000000009 in ?? ()
#13 0x00007ffe3162bca8 in ?? ()
#14 0x0000000000000009 in ?? ()
#15 0x00007ffe3162bca8 in ?? ()
#16 0x0000000000000000 in ?? ()
ä½†å¯ä»¥ç”¨gdbäº§ç”Ÿcoreï¼Œé‡‡é›†ä¸€äº›ç°åœºä¿¡æ¯ï¼Œç„¶åé‡å¯å°½å¿«æ¢å¤ä¸šåŠ¡ï¼Œäº‹åå†ç”¨dlvåˆ†æcoreæ¥å®šä½åŸå› ã€‚</p>

<p>å‚è€ƒé“¾æ¥
Debugging Go Code with GDB
go-delve/delve
Golangç¨‹åºè°ƒè¯•å·¥å…·ä»‹ç»(gdb vs dlv)
å®æˆ˜åˆ†æä¸€ä¸ªè¿è¡Œèµ·æ¥ä¼šå¡æ­»çš„Goç¨‹åº</p>

<p>https://xusenqi.github.io/2019/08/25/%E9%80%9A%E8%BF%87delve-dlv-%E8%B0%83%E8%AF%95golang%E7%A8%8B%E5%BA%8F/</p>
:ET