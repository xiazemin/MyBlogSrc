I"Õ(<p>æµStreamsè¿™ä¸ªæ¦‚å¿µæ˜¯åœ¨php4.3å¼•è¿›çš„ï¼Œæ˜¯å¯¹æµå¼æ•°æ®çš„æŠ½è±¡ï¼Œç”¨äºç»Ÿä¸€æ•°æ®æ“ä½œï¼Œæ¯”å¦‚æ–‡ä»¶æ•°æ®ã€ç½‘ç»œæ•°æ®ã€å‹ç¼©æ•°æ®ç­‰ï¼Œä»¥ä½¿å¯ä»¥å…±äº«åŒä¸€å¥—å‡½æ•°ï¼Œ
phpçš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°å°±æ˜¯è¿™æ ·çš„å…±äº«ï¼Œæ¯”å¦‚file_get_contents()å‡½æ•°å³å¯æ‰“å¼€æœ¬åœ°æ–‡ä»¶ä¹Ÿå¯ä»¥è®¿é—®urlå°±æ˜¯è¿™ä¸€ä½“ç°ã€‚ç®€å•ç‚¹è®²ï¼Œæµå°±æ˜¯è¡¨ç°å‡ºæµå¼æ•°æ®è¡Œä¸ºçš„èµ„æºå¯¹è±¡ã€‚
ä»¥çº¿æ€§æ–¹å¼è¿›è¡Œè¯»å†™ï¼Œå¹¶å¯ä»¥åœ¨æµé‡Œé¢ä»»æ„ä½ç½®è¿›è¡Œæœç´¢ã€‚
æµæœ‰ç‚¹ç±»ä¼¼æ•°æ®åº“æŠ½è±¡å±‚ï¼Œåœ¨æ•°æ®åº“æŠ½è±¡å±‚æ–¹é¢ï¼Œä¸ç®¡ä½¿ç”¨ä½•ç§æ•°æ®åº“ï¼Œåœ¨æŠ½è±¡å±‚ä¹‹ä¸Šéƒ½ä½¿ç”¨ç›¸åŒçš„æ–¹å¼æ“ä½œæ•°æ®ï¼Œ
è€Œæµæ˜¯å¯¹æ•°æ®çš„æŠ½è±¡ï¼Œå®ƒä¸ç®¡æ˜¯æœ¬åœ°æ–‡ä»¶è¿˜æ˜¯è¿œç¨‹æ–‡ä»¶è¿˜æ˜¯å‹ç¼©æ–‡ä»¶ç­‰ç­‰ï¼Œåªè¦æ¥çš„æ˜¯æµå¼æ•°æ®ï¼Œé‚£ä¹ˆæ“ä½œæ–¹å¼å°±æ˜¯ä¸€æ ·çš„
æœ‰äº†æµè¿™ä¸ªæ¦‚å¿µå°±å¼•ç”³å‡ºäº†åŒ…è£…å™¨wrapperè¿™ä¸ªæ¦‚å¿µï¼Œæ¯ä¸ªæµéƒ½å¯¹åº”ä¸€ç§åŒ…è£…å™¨ï¼Œ
æµæ˜¯ä»ç»Ÿä¸€æ“ä½œè¿™ä¸ªè§’åº¦äº§ç”Ÿçš„ä¸€ä¸ªæ¦‚å¿µï¼Œè€ŒåŒ…è£…å™¨å‘¢æ˜¯ä»ç†è§£æµæ•°æ®å†…å®¹å‡ºå‘äº§ç”Ÿçš„ä¸€ä¸ªæ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªç»Ÿä¸€çš„æ“ä½œæ–¹å¼æ€ä¹ˆæ“ä½œæˆ–é…ç½®ä¸åŒçš„å†…å®¹ï¼›
è¿™äº›å†…å®¹éƒ½æ˜¯ä»¥æµçš„æ–¹å¼å‘ˆç°ï¼Œä½†å†…å®¹è§„åˆ™æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚httpåè®®ä¼ æ¥çš„æ•°æ®æ˜¯æµçš„æ–¹å¼ï¼Œä½†åªæœ‰httpåŒ…è£…å™¨æ‰ç†è§£httpåè®®ä¼ æ¥çš„æ•°æ®çš„æ„æ€ï¼Œ
å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œæµå°±æ˜¯ä¸€æ ¹æµæ°´çš„ç®¡å­ï¼Œåªä¸è¿‡å®ƒæµå‡ºçš„æ˜¯æ•°æ®ï¼ŒåŒ…è£…å™¨å°±æ˜¯å¥—åœ¨æµè¿™æ ¹ç®¡å­å¤–å±‚çš„ä¸€ä¸ªè§£é‡Šè€…ï¼Œå®ƒç†è§£æµå‡ºçš„æ•°æ®çš„æ„æ€ï¼Œå¹¶èƒ½æ“ä½œå®ƒ
å®˜æ–¹æ‰‹å†Œè¯´ï¼šâ€œä¸€ä¸ªåŒ…è£…å™¨æ˜¯å‘Šè¯‰æµæ€ä¹ˆå¤„ç†ç‰¹æ®Šåè®®æˆ–ç¼–ç çš„é™„åŠ ä»£ç â€æ˜ç™½è¿™å¥è¯çš„æ„æ€äº†å—ï¼Ÿ</p>

<p>åŒ…è£…å™¨å¯ä»¥åµŒå¥—ï¼Œä¸€ä¸ªæµå¤–é¢åŒ…è£¹äº†ä¸€ä¸ªåŒ…è£…å™¨åï¼Œè¿˜å¯ä»¥åœ¨å¤–å±‚ç»§ç»­åŒ…è£¹åŒ…è£…å™¨ï¼Œè¿™ä¸ªæ—¶å€™é‡Œå±‚çš„åŒ…è£…å™¨ç›¸å¯¹äºå¤–å±‚çš„åŒ…è£…å™¨å……å½“æµçš„è§’è‰²</p>

<p>åœ¨phpè‡ªèº«åº•å±‚å®ç°çš„cè¯­è¨€å¼€å‘æ–‡æ¡£æœ‰è¿™æ ·çš„è§£é‡Šï¼š
æµAPIæ“ä½œä¸€å¯¹ä¸åŒçº§åˆ«ï¼šåœ¨åŸºæœ¬çº§åˆ«ï¼Œapiå®šä¹‰äº†php_streamå¯¹è±¡è¡¨ç¤ºæµå¼æ•°æ®æºï¼Œåœ¨ç¨å¾®é«˜ä¸€ç‚¹çš„çº§åˆ«ï¼Œapiå®šä¹‰äº†php_stream_wrapperå¯¹è±¡
å®ƒåŒ…è£¹ä½ä¸€çº§åˆ«çš„php_streamå¯¹è±¡ï¼Œä»¥æä¾›å–å›URLçš„å†…å®¹å’Œå…ƒæ•°æ®ã€æ·»åŠ ä¸Šä¸‹æ–‡å‚æ•°çš„èƒ½åŠ›ï¼Œè°ƒæ•´åŒ…è£…å™¨è¡Œä¸ºï¼›</p>

<p>æ¯ä¸€ç§æµæ‰“å¼€åéƒ½å¯ä»¥åº”ç”¨ä»»æ„æ•°é‡çš„è¿‡æ»¤å™¨åœ¨ä¸Šé¢ï¼Œæµæ•°æ®ä¼šç»è¿‡è¿‡æ»¤å™¨çš„å¤„ç†ï¼Œç¬”è€…è®¤ä¸ºè¿‡æ»¤å™¨è¿™ä¸ªè¯ç”¨å¾—æœ‰ç‚¹ä¸å‡†ç¡®ï¼Œæœ‰äº›è¯¯å¯¼äºº
ä»å­—é¢æ„æ€çœ‹å¥½åƒæ˜¯å»æ‰ä¸€äº›æ•°æ®çš„æ„Ÿè§‰ï¼Œåº”è¯¥ç§°ä¸ºæ•°æ®è°ƒæ•´å™¨ï¼Œå› ä¸ºå®ƒæ—¢å¯å»æ‰ä¸€äº›æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ·»åŠ ï¼Œè¿˜å¯ä»¥ä¿®æ”¹ï¼Œä½†å†å²åŸå› çº¦å®šä¿—æˆï¼Œ
ä¹Ÿå°±ç§°ä¸ºè¿‡æ»¤å™¨äº†ï¼Œå¤§å®¶å¿ƒé‡Œæ˜ç™½å°±å¥½ã€‚</p>

<p>æˆ‘ä»¬ç»å¸¸çœ‹åˆ°ä¸‹é¢çš„è¯ï¼Œæ¥è§£é‡Šä¸‹ä»–ä»¬çš„åŒºåˆ«ï¼š
èµ„æºå’Œæ•°æ®ï¼šèµ„æºæ˜¯æ¯”è¾ƒå®è§‚çš„è¯´æ³•ï¼Œé€šå¸¸åŒ…å«æ•°æ®ï¼Œè€Œæ•°æ®æ˜¯æ¯”è¾ƒå…·è±¡çš„è¯´æ³•ï¼Œåœ¨å¼€å‘ç¨‹åºçš„æ—¶å€™ç»å¸¸è¯´æ˜¯æ•°æ®ï¼Œè€Œåœ¨è½¯ä»¶è§„åˆ’æ—¶è¯´æ˜¯èµ„æºï¼Œä»–ä»¬æ˜¯è¿‘ä¹‰è¯ï¼Œå°±åƒè½¯ä»¶è®¾è®¡å’Œç¨‹åºå¼€å‘çš„åŒºåˆ«ä¸€æ ·ã€‚
ä¸Šä¸‹æ–‡å’Œå‚æ•°ï¼šä¸Šä¸‹æ–‡æ˜¯æ¯”è¾ƒå®è§‚çš„è¯´æ³•ï¼Œç»å¸¸ç”¨åœ¨æ²Ÿé€šä¸Šé¢ï¼Œå…·ä½“ç‚¹è®²å°±æ˜¯ä¸€æ¬¡æ²Ÿé€šæœ¬èº«çš„å‚æ•°ï¼Œè€Œå‚æ•°è¿™ä¸ªè¯´æ³•å¾€å¾€ç”¨åœ¨æ¯”è¾ƒå…·ä½“çš„äº‹æƒ…ä¸Šé¢ï¼Œæ¯”å¦‚è¯´å‡½æ•°</p>

<p>ä¸Šé¢è§£é‡Šäº†æ¦‚å¿µæ€§çš„ä¸œè¥¿ï¼Œä¸‹é¢æ¥çœ‹çœ‹å…·ä½“å†…å®¹ï¼š
phpæ”¯æŒçš„åè®®å’ŒåŒ…è£…å™¨è¯·çœ‹è¿™é‡Œï¼šhttp://php.net/manual/zh/wrappers.phpï¼š
é»˜è®¤çš„æ”¯æŒäº†ä¸€äº›åè®®å’ŒåŒ…è£…å™¨ï¼Œè¯·ç”¨stream_get_wrappers()å‡½æ•°æŸ¥çœ‹.ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªåŒ…è£…å™¨ï¼Œç”¨stream_wrapper_register()æ³¨å†Œ
å°½ç®¡RFC 3986é‡Œé¢å¯ä»¥ä½¿ç”¨:åšåˆ†å‰²ç¬¦ï¼Œä½†phpåªå…è®¸://ï¼Œæ‰€ä»¥urlè¯·ä½¿ç”¨â€scheme://targetâ€è¿™æ ·çš„æ ¼å¼
    file:// â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨ç”¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°æ—¶é»˜è®¤å°±ä½¿ç”¨è¯¥åŒ…è£…å™¨
    http:// â€” è®¿é—® HTTP(s) ç½‘å€
    ftp:// â€” è®¿é—® FTP(s) URLs
    php:// â€” è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰
    zlib:// â€” å‹ç¼©æµ
    data:// â€” æ•°æ®ï¼ˆRFC 2397ï¼‰
    glob:// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼
    phar:// â€” PHP å½’æ¡£
    ssh2:// â€” Secure Shell 2
    rar:// â€” RAR
    ogg:// â€” éŸ³é¢‘æµ
    expect:// â€” å¤„ç†äº¤äº’å¼çš„æµ
å¦‚ä½•å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„åŒ…è£…å™¨ï¼š</p>

<p>åœ¨ç”¨fopenã€fwriteã€freadã€fgetsã€feofã€rewindã€file_put_contentsã€file_get_contentsç­‰ç­‰æ–‡ä»¶ç³»ç»Ÿå‡½æ•°æ“ä½œæµæ—¶ï¼Œæ•°æ®æ˜¯å…ˆä¼ ç»™å®šä¹‰çš„åŒ…è£…å™¨ç±»å¯¹è±¡ï¼ŒåŒ…è£…å™¨å†å»æ“ä½œæµã€‚
å¦‚ä½•å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„æµåŒ…è£…å™¨å‘¢ï¼Ÿphpæä¾›äº†ä¸€ä¸ªç±»åŸå‹ï¼Œåªæ˜¯åŸå‹è€Œå·²ï¼Œä¸æ˜¯æ¥å£ä¹Ÿä¸æ˜¯ç±»ï¼Œä¸èƒ½ç”¨äºç»§æ‰¿ï¼š
 streamWrapper {
/* å±æ€§ <em>/
public resource $context ;
/</em> æ–¹æ³• */
__construct ( void )
__destruct ( void )
public bool dir_closedir ( void )
public bool dir_opendir ( string $path , int $options )
public string dir_readdir ( void )
public bool dir_rewinddir ( void )
public bool mkdir ( string $path , int $mode , int $options )
public bool rename ( string $path_from , string $path_to )
public bool rmdir ( string $path , int $options )
public resource stream_cast ( int $cast_as )
public void stream_close ( void )
public bool stream_eof ( void )
public bool stream_flush ( void )
public bool stream_lock ( int $operation )
public bool stream_metadata ( string $path , int $option , mixed $value )
public bool stream_open ( string $path , string $mode , int $options , string &amp;$opened_path )
public string stream_read ( int $count )
public bool stream_seek ( int $offset , int $whence = SEEK_SET )
public bool stream_set_option ( int $option , int $arg1 , int $arg2 )
public array stream_stat ( void )
public int stream_tell ( void )
public bool stream_truncate ( int $new_size )
public int stream_write ( string $data )
public bool unlink ( string $path )
public array url_stat ( string $path , int $flags )
}</p>

<p>åœ¨è¿™ä¸ªåŸå‹é‡Œé¢å®šä¹‰çš„æ–¹æ³•ï¼Œæ ¹æ®è‡ªå·±éœ€è¦å»å®šä¹‰ï¼Œå¹¶ä¸è¦æ±‚å…¨éƒ¨å®ç°ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸å®šä¹‰æˆæ¥å£çš„åŸå› ï¼Œå› ä¸ºæœ‰äº›å®ç°æ ¹æœ¬ç”¨ä¸ç€æŸäº›æ–¹æ³•ï¼Œ
è¿™å¸¦æ¥å¾ˆå¤šçµæ´»æ€§ï¼Œæ¯”å¦‚åŒ…è£…å™¨æ˜¯ä¸æ”¯æŒåˆ é™¤ç›®å½•rmdiråŠŸèƒ½çš„ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å®ç°streamWrapper::rmdir
ç”±äºæœªå®ç°å®ƒï¼Œå¦‚æœç”¨æˆ·åœ¨åŒ…è£…å™¨ä¸Šè°ƒç”¨rmdirå°†æœ‰é”™è¯¯æŠ›å‡ºï¼Œè¦è‡ªå®šä¹‰è¿™ä¸ªé”™è¯¯é‚£ä¹ˆä¹Ÿå¯ä»¥å®ç°å®ƒå¹¶åœ¨å…¶å†…éƒ¨æŠ›å‡ºé”™è¯¯</p>

<p>streamWrapperä¹Ÿä¸æ˜¯ä¸€ä¸ªé¢„å®šä¹‰ç±»ï¼Œæµ‹è¯•class_exists(â€œstreamWrapperâ€)å°±çŸ¥é“ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæŒ‡å¯¼å¼€å‘è€…çš„åŸå‹</p>

<p>å®˜æ–¹æ‰‹å†Œæä¾›äº†ä¸€ä¸ªä¾‹å­ï¼šhttp://php.net/manual/zh/stream.streamwrapper.example-1.php</p>

<p>æœ¬åšå®¢æä¾›ä¸€ä¸ªä»drupal8ç³»ç»Ÿä¸­æŠ½å–ä¿®æ”¹è¿‡çš„åŒ…è£…å™¨ä¾‹å­ï¼Œè¯·çœ‹drupal8æºç åˆ†æå…³äºæµé‚£ä¸€éƒ¨åˆ†
æµç³»åˆ—å‡½æ•°ï¼Œå®˜æ–¹æ‰‹å†Œï¼šhttp://php.net/manual/zh/ref.stream.php
å¸¸ç”¨çš„å‡½æ•°å¦‚ä¸‹ï¼š
stream_bucket_appendå‡½æ•°ï¼šä¸ºé˜Ÿåˆ—æ·»åŠ æ•°æ®ã€€
stream_bucket_make_writeableå‡½æ•°ï¼šä»æ“ä½œçš„é˜Ÿåˆ—ä¸­è¿”å›ä¸€ä¸ªæ•°æ®å¯¹è±¡
stream_bucket_newå‡½æ•°ï¼šä¸ºå½“å‰é˜Ÿåˆ—åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®
stream_bucket_prependå‡½æ•°ï¼šé¢„å¤‡æ•°æ®åˆ°é˜Ÿåˆ—ã€€
stream_context_createå‡½æ•°ï¼šåˆ›å»ºæ•°æ®æµä¸Šä¸‹æ–‡
stream_context_get_defaultå‡½æ•°ï¼šè·å–é»˜è®¤çš„æ•°æ®æµä¸Šä¸‹æ–‡
stream_context_get_optionså‡½æ•°ï¼šè·å–æ•°æ®æµçš„è®¾ç½®
stream_context_set_optionå‡½æ•°ï¼šå¯¹æ•°æ®æµã€æ•°æ®åŒ…æˆ–è€…ä¸Šä¸‹æ–‡è¿›è¡Œè®¾ç½®
stream_context_set_paramså‡½æ•°ï¼šä¸ºæ•°æ®æµã€æ•°æ®åŒ…æˆ–è€…ä¸Šä¸‹æ–‡è®¾ç½®å‚æ•°
stream_copy_to_streamå‡½æ•°ï¼šåœ¨æ•°æ®æµä¹‹é—´è¿›è¡Œå¤åˆ¶æ“ä½œ
stream_filter_appendå‡½æ•°ï¼šä¸ºæ•°æ®æµæ·»åŠ è¿‡æ»¤å™¨
stream_filter_prependå‡½æ•°ï¼šä¸ºæ•°æ®æµé¢„å¤‡æ·»åŠ è¿‡æ»¤å™¨
stream_filter_registerå‡½æ•°ï¼šæ³¨å†Œä¸€ä¸ªæ•°æ®æµçš„è¿‡æ»¤å™¨å¹¶ä½œä¸ºPHPç±»æ‰§è¡Œ
stream_filter_removeå‡½æ•°ï¼šä»ä¸€ä¸ªæ•°æ®æµä¸­ç§»é™¤è¿‡æ»¤å™¨
stream_get_contentså‡½æ•°ï¼šè¯»å–æ•°æ®æµä¸­çš„å‰©ä½™æ•°æ®åˆ°å­—ç¬¦ä¸²
stream_get_filterså‡½æ•°ï¼šè¿”å›å·²ç»æ³¨å†Œçš„æ•°æ®æµè¿‡æ»¤å™¨åˆ—è¡¨
stream_get_lineå‡½æ•°ï¼šæŒ‰ç…§ç»™å®šçš„å®šç•Œç¬¦ä»æ•°æ®æµèµ„æºä¸­è·å–è¡Œ
stream_get_meta_dataå‡½æ•°ï¼šä»å°è£…åè®®æ–‡ä»¶æŒ‡é’ˆä¸­è·å–æŠ¥å¤´/å…ƒæ•°æ®
stream_get_transportså‡½æ•°ï¼šè¿”å›æ³¨å†Œçš„Socketä¼ è¾“åˆ—è¡¨
stream_get_wrapperså‡½æ•°ï¼šè¿”å›æ³¨å†Œçš„æ•°æ®æµåˆ—è¡¨
stream_register_wrapperå‡½æ•°ï¼šæ³¨å†Œä¸€ä¸ªç”¨PHPç±»å®ç°çš„URLå°è£…åè®®
stream_selectå‡½æ•°ï¼šæ¥æ”¶æ•°æ®æµæ•°ç»„å¹¶ç­‰å¾…å®ƒä»¬çŠ¶æ€çš„æ”¹å˜
stream_set_blockingå‡½æ•°ï¼šå°†ä¸€ä¸ªæ•°æ®æµè®¾ç½®ä¸ºå µå¡æˆ–è€…éå µå¡çŠ¶æ€
stream_set_timeoutå‡½æ•°ï¼šå¯¹æ•°æ®æµè¿›è¡Œè¶…æ—¶è®¾ç½®
stream_set_write_bufferå‡½æ•°ï¼šä¸ºæ•°æ®æµè®¾ç½®ç¼“å†²åŒº
stream_socket_acceptå‡½æ•°ï¼šæ¥å—ç”±å‡½æ•°stream_ socket_server()åˆ›å»ºçš„Socketè¿æ¥
stream_socket_clientå‡½æ•°ï¼šæ‰“å¼€ç½‘ç»œæˆ–è€…UNIXä¸»æœºçš„Socketè¿æ¥
stream_socket_enable_cryptoå‡½æ•°ï¼šä¸ºä¸€ä¸ªå·²ç»è¿æ¥çš„Socketæ‰“å¼€æˆ–è€…å…³é—­æ•°æ®åŠ å¯†
stream_socket_get_nameå‡½æ•°ï¼šè·å–æœ¬åœ°æˆ–è€…ç½‘ç»œSocketçš„åç§°
stream_socket_pairå‡½æ•°ï¼šåˆ›å»ºä¸¤ä¸ªæ— åŒºåˆ«çš„Socketæ•°æ®æµè¿æ¥
stream_socket_recvfromå‡½æ•°ï¼šä»Socketè·å–æ•°æ®ï¼Œä¸ç®¡å…¶è¿æ¥ä¸å¦
stream_socket_sendtoå‡½æ•°ï¼šå‘Socketå‘é€æ•°æ®ï¼Œä¸ç®¡å…¶è¿æ¥ä¸å¦
stream_socket_serverå‡½æ•°ï¼šåˆ›å»ºä¸€ä¸ªç½‘ç»œæˆ–è€…UNIX SocketæœåŠ¡ç«¯
stream_wrapper_restoreå‡½æ•°ï¼šæ¢å¤ä¸€ä¸ªäº‹å…ˆæ³¨é”€çš„æ•°æ®åŒ…
stream_wrapper_unregisterå‡½æ•°ï¼šæ³¨é”€ä¸€ä¸ªURLåœ°å€åŒ…</p>

<p>ä¸€ä¸ªè¿‡æ»¤å™¨çš„åˆ—å­åŠè§£é‡Šï¼š</p>

<p>ç›¸å…³é“¾æ¥ï¼š</p>

<p>ç”¨æˆ·è¿‡æ»¤å™¨åŸºç±»ï¼šhttp://php.net/manual/zh/class.php-user-filter.php</p>

<p>è¿‡æ»¤å™¨æ³¨å†Œï¼šhttp://php.net/manual/zh/function.stream-filter-register.php</p>

<p>&lt;?php</p>

<p>/* å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ */
class strtoupper_filter extends php_user_filter {
  function filter($in, $out, &amp;$consumed, $closing)
  {
    while ($bucket = stream_bucket_make_writeable($in)) { //ä»æµé‡Œé¢å–å‡ºä¸€æ®µæ•°æ®
      $bucket-&gt;data = strtoupper($bucket-&gt;data);
      $consumed += $bucket-&gt;datalen;
      stream_bucket_append($out, $bucket); //å°†ä¿®æ”¹åçš„æ•°æ®é€åˆ°è¾“å‡ºçš„åœ°æ–¹
    }
    return PSFS_PASS_ON;
  }
}</p>

<p>/* æ³¨å†Œè¿‡æ»¤å™¨åˆ°php */
stream_filter_register(â€œstrtoupperâ€, â€œstrtoupper_filterâ€)
    or die(â€œFailed to register filterâ€);</p>

<p>$fp = fopen(â€œfoo-bar.txtâ€, â€œwâ€);</p>

<p>/* åº”ç”¨è¿‡æ»¤å™¨åˆ°ä¸€ä¸ªæµ */
stream_filter_append($fp, â€œstrtoupperâ€);</p>

<p>fwrite($fp, â€œLine1\nâ€);
fwrite($fp, â€œWord - 2\nâ€);
fwrite($fp, â€œEasy As 123\nâ€);</p>

<p>fclose($fp);</p>

<p>//è¯»å–å¹¶æ˜¾ç¤ºå†…å®¹ å°†å…¨éƒ¨å˜ä¸ºå¤§å†™
readfile(â€œfoo-bar.txtâ€);</p>

<p>?&gt;</p>

<!-- more -->
:ET