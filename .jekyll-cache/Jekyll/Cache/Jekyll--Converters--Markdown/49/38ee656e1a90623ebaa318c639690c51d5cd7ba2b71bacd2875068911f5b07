I"Ü0<p>t_generatorç±»å’Œt_generator_registryç±»</p>

<p>è¿™ä¸ªä¸¤ä¸ªç±»çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯ä¸ºç”Ÿæˆæ‰€æœ‰è¯­è¨€çš„ä»£ç æä¾›åŸºç¡€ä¿¡æ¯å’Œæä¾›å…·ä½“ä»£ç ç”Ÿæˆå™¨å¯¹è±¡ï¼Œä¸Šé¢å°±æ˜¯è°ƒç”¨è¿™ä¸ªä¸¤ä¸ªç±»çš„æ–¹æ³•æ¥ç”Ÿæˆå…·ä½“è¯­è¨€çš„ä»£ç ç”Ÿæˆå™¨å¯¹è±¡å’Œæ‰§è¡Œç”Ÿæˆä»£ç çš„åŠŸèƒ½å‡½æ•°ã€‚ä¸‹é¢ä¸»è¦åˆ†æä¸¤ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯t_generator_registryç±»çš„get_generatorå‡½æ•°ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªé™æ€çš„å‡½æ•°å¯ä»¥ç›´æ¥é€šè¿‡ç±»è°ƒç”¨ï¼›å¦ä¸€ä¸ªæ˜¯t_generatorç±»çš„generate_programå‡½æ•°ã€‚ 
<!-- more -->
(1ï¼‰t_generator_registryç±»çš„get_generatorå‡½æ•°</p>

<p>è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯è¡¨ç¤ºç¨‹åºçš„å¯¹è±¡programï¼Œå¦ä¸€ä¸ªæ˜¯è¯­è¨€å­—ç¬¦ä¸²å‚æ•°ï¼ˆåŒ…æ‹¬ä»£è¡¨è¯­è¨€çš„ç®€çŸ­å­—ç¬¦ä¸²å’Œå¯é€‰é¡¹çš„ç»„åˆï¼Œæœ‰çš„æ²¡æœ‰ï¼‰ã€‚å‡½æ•°é¦–å…ˆè§£æè¯­è¨€å­—ç¬¦ä¸²å‚æ•°ï¼Œå‚æ•°å­—ç¬¦ä¸²ä¸­æ˜¯è¿™æ ·ç»„ç»‡çš„ï¼šåœ¨å†’å·ï¼ˆï¼šï¼‰ä¹‹å‰æ˜¯ä»£è¡¨è¯­è¨€çš„å­—ç¬¦ä¸²ï¼Œå†’å·ä¹‹åæ˜¯å¯é€‰é¡¹çš„å‚æ•°ï¼Œæ¯ä¸€ä¸ªå¯é€‰é¡¹å‚æ•°ç”¨é€—å·ï¼ˆï¼Œï¼‰åˆ†å‰²ï¼Œæ¯ä¸€ä¸ªå¯é€‰é¡¹å‚æ•°éƒ½æ˜¯é”®å€¼å¯¹å¹¶ä¸”é”®å’Œå€¼æ˜¯ç”¨ç­‰å·ï¼ˆ=ï¼‰åˆ†å‰²ã€‚æŒ‰ç…§ä¸Šé¢çš„å­—ç¬¦ä¸²æ ¼å¼è§£æå„ä¸ªå‚æ•°éƒ¨åˆ†å°±å¯ä»¥äº†ï¼Œå¯é€‰é¡¹å‚æ•°ç”¨mapæ¥ä¿å­˜é”®å€¼å¯¹ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p>

<p>string::size_type colon = options.find(â€˜:â€™); 
  string language = options.substr(0, colon); 
  map&lt;string, string&gt; parsed_options; 
  if (colon != string::npos) { 
  string::size_type pos = colon+1; 
  while (pos != string::npos &amp;&amp; pos &lt; options.size()) { 
  string::size_type next_pos = options.find(â€˜,â€™, pos); 
  string option = options.substr(pos, next_pos-pos); 
  pos = ((next_pos == string::npos) ? next_pos : next_pos+1); 
  string::size_type separator = option.find(â€˜=â€™); 
  string key, value; 
  if (separator == string::npos) { 
  key = option; 
  value = â€œâ€; 
  } else { 
  key = option.substr(0, separator); 
  value = option.substr(separator+1); 
  } 
  parsed_options[key] = value; 
  } 
  } 
 ç„¶åè°ƒç”¨get_generator_mapå‡½æ•°å¾—åˆ°ä¸€ä¸ªä»£è¡¨è¯­è¨€å­—ç¬¦ä¸²å’Œäº§ç”Ÿè¿™ç§è¯­è¨€ç”Ÿæˆå™¨å¯¹è±¡çš„å·¥å‚å¯¹è±¡çš„mapå¯¹è±¡ï¼šgen_map_t&amp; the_map = get_generator_map(); gen_map_tçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>

<p>typedef std::map&lt;std::string, t_generator_factory*&gt; gen_map_t; 
 get_generator_mapå‡½æ•°åªæœ‰ä¸¤å¥ä»£ç ï¼Œä¸€ä¸ªæ˜¯å®šä¹‰ä¸€ä¸ªé™æ€å±€éƒ¨å˜é‡å¹¶åˆå§‹åŒ–ï¼ˆå› ä¸ºé™æ€å±€éƒ¨å˜é‡å¿…é¡»å¹¶åˆå§‹åŒ–å¹¶ä¸”åªæœ‰ç¬¬ä¸€æ¬¡ä¼šæ‰§è¡Œåˆå§‹åŒ–ï¼Œå› ä¸ºä¸åˆå§‹åŒ–é“¾æ¥ç¨‹åºçš„æ—¶å€™ä¼šæŠ¥é”™ï¼‰ï¼Œç¬¬äºŒå¥å°±æ˜¯è¿”å›è¿™ä¸ªé™æ€å±€éƒ¨å˜é‡ç»™è°ƒç”¨è€…ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<p>static gen_map_t* the_map = new gen_map_t(); 
  return *the_map; 
 ç„¶ååœ¨è¿™ä¸ªmapå¯¹è±¡ä¸­æ‰¾åˆ°å¯¹åº”è¯­è¨€çš„å·¥å‚å¯¹è±¡ï¼Œç„¶åç”¨è¿™ä¸ªå·¥å‚å¯¹è±¡ç”Ÿäº§ä¸€ä¸ªè¿™ç§è¯­è¨€çš„ä»£ç ç”Ÿæˆå™¨å¯¹è±¡å¹¶è¿”å›ç»™è°ƒç”¨è€…ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<p>gen_map_t::iterator iter = the_map.find(language); 
  return iter-&gt;second-&gt;get_generator(program, parsed_options, options); 
 æœ¬å‡½æ•°çš„åŠŸèƒ½å·²ç»åˆ†æå®Œæ¯•ï¼Œä½†æ˜¯è¿˜å­˜åœ¨ç€ä¸¤ä¸ªé—®é¢˜ï¼ˆæˆ–æ˜¯å›°éš¾ï¼‰ã€‚ä¸€ä¸ªæ˜¯æœ€åä¸€æ¡è¿”å›ä¸€å¥æ˜¯æ ¹æ®å…·ä½“çš„è¯­è¨€æ¥ä½¿ç”¨å…·ä½“è¯­è¨€ç”Ÿäº§å™¨çš„å·¥å‚å¯¹è±¡ç”Ÿäº§ä»£ç ç”Ÿæˆå™¨ï¼Œå…·ä½“åˆæ˜¯æ€ä¹ˆç”Ÿæˆçš„äº†ï¼Ÿç¬¬äºŒä¸ªå°±æ˜¯ä»mainå‡½æ•°æ‰§è¡Œåˆ°ç°åœ¨è¿˜æ²¡æœ‰å‘ç°åœ¨å“ªå„¿ä¸ºget_generator_mapå‡½æ•°é‡Œå®šä¹‰çš„é™æ€å±€éƒ¨å˜é‡æ·»åŠ è¿‡ä»»ä½•é”®å€¼å¯¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŸ¥æ‰¾å…·ä½“è¯­è¨€å¿…å®šä¼šå¤±è´¥ï¼Œé‚£ä¹ˆä¼šè¿”å›ä¸€ä¸ªNULLç»™è°ƒç”¨è€…ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šæ‰§è¡Œä¸ä¸‹å»äº†ï¼Œä½†æ˜¯ç¨‹åºç¡®å®èƒ½å¤Ÿå®Œå®Œæ•´æ•´çš„æ‰§è¡Œä¸‹å»ï¼Œè¿™ä¸ªé—®é¢˜å›°æ‰°äº†æˆ‘å¥½ä¸€ä¼šå„¿ã€‚ä¸‹é¢å°±è¿™ä¸¤ä¸ªé—®é¢˜ç»§ç»­åˆ†æç›¸å…³ä»£ç å¹¶ä¸”è§£å†³é—®é¢˜ã€‚</p>

<p>ç¬¬ä¸€ä¸ªåº”è¯¥ä¸ç®—æ˜¯é—®é¢˜ï¼Œä½†æ˜¯å¿…é¡»è¦è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ä»¥åæ‰èƒ½å¤Ÿè§£é‡Šï¼Œå› ä¸ºæ²¡æœ‰è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆæ ¹æœ¬å°±ä¸ä¼šæ‰§è¡Œåˆ°æœ€åä¸€æ¡è¿”å›è¯­å¥è¿™å„¿æ¥ï¼Œæ‰€ä»¥æˆ‘å…ˆè§£å†³ç¬¬äºŒä¸ªé—®é¢˜ã€‚</p>

<p>ç¬¬äºŒä¸ªé—®é¢˜åˆ†æå’Œè§£å†³æ€è·¯å¦‚ä¸‹ï¼š</p>

<p>æˆ‘ä»¬é€šå¸¸è®¤ä¸ºmainå‡½æ•°æ˜¯ç¨‹åºçš„å…¥å£å‡½æ•°ï¼Œé‚£ä¹ˆæ‰€ä»¥ç¨‹åºçš„æ‰§è¡Œéƒ½æ˜¯ä»mainå‡½æ•°å¼€å§‹çš„ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿé€‰æ‹©ä»mainå‡½æ•°å¼€å§‹åˆ†æè¿™éƒ¨åˆ†çš„ä»£ç ï¼Œæ ¹æ®ç¨‹åºçš„æ‰§è¡Œæµç¨‹é˜…è¯»å’Œåˆ†æä»£ç æ˜¯æˆ‘ä¸€è´¯çš„æ€è·¯ã€‚ä½†æ˜¯è¿™ç§æƒ…å†µåœ¨C++é‡Œé¢æœ‰ä¾‹å¤–ï¼Œè®°å¾—æˆ‘åœ¨å­¦ä¹ MFCçš„æ—¶å€™ï¼Œåˆ†æMFCæ‰§è¡Œè¿‡ç¨‹å°±å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å…¨å±€å˜é‡çš„åˆå§‹åŒ–æ˜¯åœ¨mainå‡½æ•°å¼€å§‹ä¹‹å‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å…¨å±€ç±»å¯¹è±¡çš„æ„é€ å‡½æ•°ä¹Ÿæ˜¯åœ¨mainæ‰§è¡Œä¹‹å‰æ‰§è¡Œçš„ã€‚ç”±äºæˆ‘åå¤ä»mainå¼€å§‹ä¸€ç›´è¯¦ç»†çš„é˜…è¯»æ¯ä¸€è¡Œä»£ç ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šç¡®å®æ²¡æœ‰åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­åˆå§‹åŒ–the_mapé™æ€å±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥å”¯ä¸€çš„å¯èƒ½å°±æ˜¯åœ¨mainå‡½æ•°å¼€å§‹ä¹‹å‰å·²ç»åˆå§‹åŒ–å¥½äº†ã€‚æ ¹æ®è¿™ä¸€ç‚¹æ€è·¯è‡ªå·±å¼€å§‹ç€æ‰‹æŸ¥æ‰¾åˆå§‹åŒ–the_mapçš„ä»£ç ï¼Œå‘ç°t_generator_registryç±»çš„register_generatorå‡½æ•°ä¸ºthe_mapæ·»åŠ é”®å€¼å¯¹äº†ï¼Œè¿™ä¸ªå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>

<p>void t_generator_registry::register_generator(t_generator_factory* factory) { 
  gen_map_t&amp; the_map = get_generator_map(); 
  if (the_map.find(factory-&gt;get_short_name()) != the_map.end()) { 
  failure(â€œDuplicate generators for language \â€%s\â€!\nâ€, factory-&gt;get_short_name().c_str()); 
  } 
  the_map[factory-&gt;get_short_name()] = factory; 
 } 
 è¿™ä¸ªå‡½æ•°ä¹Ÿé¦–å…ˆè°ƒç”¨get_generator_mapå‡½æ•°å¾—åˆ°é‚£ä¸ªé™æ€å±€éƒ¨å˜é‡ï¼Œç„¶åæŸ¥æ‰¾è¦æ³¨å†Œçš„å·¥ç¨‹æ˜¯å¦å·²ç»åœ¨the_mapä¸­å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±æç¤ºå¤±è´¥ä¿¡æ¯ï¼Œå¦åˆ™å°±æŠŠå·¥å‚çš„åå­—å’Œå·¥å‚å¯¹è±¡ä½œä¸ºé”®å€¼å¯¹æ·»åŠ åˆ°the_mapä¸­ã€‚</p>

<p>è™½ç„¶æ‰¾åˆ°äº†ä¸ºthe_mapæ·»åŠ é”®å€¼å¯¹çš„åœ°æ–¹ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ‰¾åˆ°è°ƒç”¨è¿™ä¸ªæ³¨å†Œå·¥å‚å‡½æ•°çš„åœ°æ–¹ï¼Œæ‰€ä»¥ç»§ç»­åœ¨ä»£ç ä¸­æœç´¢è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„åœ°æ–¹ã€‚æ•´ä¸ªä»£ç å°±åªæœ‰ä¸€å¤„è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œè€Œä¸”æ˜¯åœ¨ä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<p>t_generator_factory::t_generator_factory(const std::string&amp; short_name, const std::string&amp; long_name, 
     const std::string&amp; documentation) : short_name_(short_name) 
   , long_name_(long_name) , documentation_(documentation) 
 { 
   t_generator_registry::register_generator(this); 
 } 
 t_generator_factoryç±»æ˜¯æ‰€æœ‰ç”Ÿäº§ä»£ç ç”Ÿäº§å™¨å¯¹è±¡å·¥å‚çš„åŸºç±»ï¼Œæ¯ä¸€ç§å…·ä½“çš„è¯­è¨€éƒ½æœ‰è‡ªå·±çš„ä»£ç ç”Ÿæˆå™¨ç±»å’Œç”Ÿäº§è¿™ç§ç±»çš„å·¥å‚ç±»ï¼Œä¸Šé¢çš„ä»£ç æ˜¯å®ƒçš„æ„é€ å‡½æ•°ï¼ŒåŠŸèƒ½å°±æ˜¯æŠŠè‡ªå·±æ³¨å†Œåˆ°the_mapä¸­ã€‚çœ‹åˆ°è¿™é‡Œæ˜¯å¦æœ‰ä¸€ç§é€æ¸æ¸…æ™°çš„æ„Ÿè§‰ï¼Œä½†æ˜¯æ€»æ˜¯æ„Ÿè§‰è¿˜æœ‰å°‘ç‚¹ä»€ä¹ˆï¼Œå°±æ˜¯è¿™ä¸ªæ„é€ å‡½æ•°è¢«è°ƒç”¨ä¹Ÿå¿…é¡»æœ‰è¿™ä¸ªç±»çš„å¯¹è±¡è¢«å®šä¹‰æˆ–å…¶å­ç±»çš„å¯¹è±¡è¢«å®šä¹‰ã€‚äºæ˜¯æˆ‘åˆå¼€å§‹æœç´¢å“ªäº›ç±»æ˜¯ä»è¿™ä¸ªç±»ç»§æ‰¿çš„ï¼Œå‘ç°ä¸¤å¤„å¾ˆé‡è¦çš„ä»£ç ï¼Œä¸€å¤„å¦‚ä¸‹ï¼š</p>

<p>template <typename generator=""> 
 class t_generator_factory_impl : public t_generator_factory { 
  public: 
  t_generator_factory_impl(const std::string&amp; short_name, const std::string&amp; long_name, 
          const std::string&amp; documentation) : t_generator_factory(short_name, long_name, documentation) 
  {} 
 virtual t_generator* get_generator(t_program* program,  
  const std::map&lt;std::string, std::string&gt;&amp; parsed_options, const std::string&amp; option_string) { 
  return new generator(program, parsed_options, option_string); 
  } 
 â€¦â€¦//æ­¤å¤„çœç•¥äº†ä¸€äº›ä»£ç  
 }; 
 t_generator_factory_implç±»ç»§æ‰¿äº†t_generator_factoryç±»ï¼Œè€Œä¸”åœ¨æ„é€ å‡½æ•°çš„æ—¶å€™ä¹Ÿè°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œå› ä¸ºæ˜¯å¸¦å‚æ•°çš„æ„é€ å‡½æ•°æ‰€ä»¥å¿…é¡»æ‰‹åŠ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œæ¨¡æ¿å‚æ•°å°±æ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ç±»ï¼Œæ‰€ä»¥å‡½æ•°get_generatorå°±èƒ½å¤Ÿæ ¹æ®è¿™ä¸ªæ¨¡æ¿å‚æ•°ç”Ÿæˆnewä¸€ä¸ªå¯¹åº”è¯­è¨€çš„ä»£ç ç”Ÿæˆå™¨å¯¹è±¡äº†ã€‚è¿™é‡Œå°±æŠŠä¸Šé¢æåˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜ä¹Ÿè§£å†³äº†ï¼Œæ¯ä¸€ä¸ªå·¥å‚ç±»æŠŠè‡ªå·±æ³¨å†Œåˆ°the_mapï¼Œç„¶åä½¿ç”¨è€…é€šè¿‡ä»£è¡¨è¯­è¨€çš„é”®ï¼ˆkeyï¼‰åœ¨the_mapæ‰¾åˆ°å¯¹åº”çš„å·¥å‚å¯¹è±¡ï¼Œç„¶åè°ƒç”¨get_generatorå‡½æ•°å°±ç”Ÿæˆå…·ä½“çš„ä»£ç ç”Ÿæˆå™¨å¯¹è±¡äº†ï¼Œè¿™å°±æ˜¯ç¬¬ä¸€ä¸ªé—®é¢˜æåˆ°çš„æœ€åä¸€å¥è¿”å›è¯­å¥çš„ä»£ç æ‰§è¡Œæƒ…å†µã€‚</typename></p>

<p>ä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰çœ‹åˆ°å®šä¹‰å…·ä½“çš„å·¥å‚å¯¹è±¡å‘€ï¼Œé‚£ä¹ˆè¿˜éœ€è¦çœ‹ä¸‹é¢ä¸€å¤„çš„ä»£ç ï¼š</p>

<dl>
  <dt>#define THRIFT_REGISTER_GENERATOR(language, long_name, doc)        \ </dt>
  <dt> class t_##language##_generator_factory_impl                      \</dt>
  <dd>public t_generator_factory_impl&lt;t_##language##<em>generator&gt;    \ 
  {                                                                \ 
  public:                                                         \ 
  t</em>##language##_generator_factory_impl()                        \</dd>
  <dd>t_generator_factory_impl&lt;t_##language##<em>generator&gt;(        \ 
  #language, long_name, doc)                               \ 
  {}                                                             \ 
  };                                                               \ 
  static t</em>##language##_generator_factory_impl _registerer; 
 è¿™æ˜¯ä¸€ä¸ªå®å®šä¹‰ï¼Œå®ƒæ ¹æ®å‚æ•°languageå®šä¹‰ä¸€ä¸ªç”Ÿäº§å…·ä½“è¯­è¨€çš„ä»£ç ç”Ÿæˆå™¨çš„å·¥å‚ç±»ï¼Œå¹¶ä»t_generator_factory_implç±»ç»§æ‰¿ï¼Œä¼ é€’çš„æ¨¡æ¿å‚æ•°ä¹Ÿæ˜¯å¯¹åº”è¯­è¨€çš„ä»£ç ç”Ÿæˆå™¨ç±»ï¼Œæ„é€ å‡½æ•°åŒæ ·è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼›æœ€åè¿˜å®šä¹‰äº†ä¸€ä¸ªå¯¹åº”çš„é™æ€çš„ç±»å…¨å±€å˜é‡ï¼ˆåƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼Œç»ˆäºæ‰¾åˆ°å®šä¹‰ç±»çš„å…¨å±€å˜é‡äº†ï¼‰ã€‚ä½†æ˜¯è¿˜æ˜¯å­˜åœ¨åŒæ ·çš„é—®é¢˜å°±æ˜¯å®šä¹‰äº†å®å‡½æ•°è¿˜æ˜¯éœ€è¦è°ƒç”¨æ‰æ‰§è¡Œå§ï¼Œæ‰€ä»¥å°±åœ¨ä»£ç ä¸­æœç´¢è°ƒç”¨äº†è¿™ä¸ªå®å‡½æ•°çš„ä»£ç ï¼Œæœ€ç»ˆå‘ç°è¿™ä¸ªæ¯ä¸€ä¸ªå…·ä½“çš„è¯­è¨€ä»£ç ç”Ÿæˆå™¨çš„æ–‡ä»¶éƒ½è°ƒç”¨äº†ä¸€æ¬¡ï¼Œå¦‚ä¸‹é¢æ˜¯C++çš„æ–‡ä»¶t_cpp_generator.ccä¸­è°ƒç”¨çš„ä»£ç ï¼š</dd>
</dl>

<p>THRIFT_REGISTER_GENERATOR(cpp, â€œC++â€, 
 â€    pure_enums:      Generate pure enums instead of wrapper classes.\nâ€ 
 â€    dense:           Generate type specifications for the dense protocol.\nâ€ 
 â€    include_prefix:  Use full include paths in generated files.\nâ€ 
 ) 
 å…¶ä»–è¯­è¨€çš„ä»£ç ç”Ÿæˆå™¨ç±»çš„å®šä¹‰æ–‡ä»¶ä¸­éƒ½æœ‰ç±»ä¼¼çš„è°ƒç”¨ï¼Œè¿™æ ·æ¯ä¸€ä¸ªè¯­è¨€ç”Ÿæˆå™¨å¯¹è±¡çš„ç”Ÿäº§å·¥å‚å°±è¢«æ³¨å†Œåˆ°the_mapä¸­äº†ï¼Œç”±æ­¤é—®é¢˜å¾—åˆ°è§£å†³ã€‚</p>

<p>ï¼ˆ2ï¼‰t_generatorç±»çš„generate_programå‡½æ•°</p>

<p>è¿™ä¸ªå‡½æ•°æ˜¯ç”Ÿæˆå…·ä½“è¯­è¨€ä»£ç çš„é¡¶å±‚å‡½æ•°ï¼Œå®ƒä¼šè°ƒç”¨å­ç±»å®šä¹‰çš„å„ä¸ªå­å‡½æ•°æ¥åšå…·ä½“ä»£ç çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œåé¢ä¼šè¯¦ç»†è§£æC++ã€Javaå’ŒPythonä»£ç ç”Ÿæˆçš„è¿‡ç¨‹ã€‚</p>

<p>é¦–å…ˆè°ƒç”¨ä»£ç ç”Ÿæˆå™¨çš„åˆå§‹åŒ–å‡½æ•°æ¥åˆå§‹åŒ–ä»£ç ç”Ÿæˆå™¨ï¼Œç„¶åä¾æ¬¡è°ƒç”¨å„ç§åŸºæœ¬æ•°æ®ç±»å‹å’ŒæœåŠ¡çš„ç”Ÿæˆå‡½æ•°æ¥ç”Ÿæˆç›¸åº”çš„ä»£ç ï¼Œæœ€åå…³é—­ä»£ç ç”Ÿæˆå™¨ã€‚ä»£ç å®ç°å¦‚ä¸‹ï¼š</p>

<p>init_generator(); 
   vector&lt;t_enum<em>&gt; enums = program_-&gt;get_enums(); 
   vector&lt;t_enum</em>&gt;::iterator en_iter; 
   for (en_iter = enums.begin(); en_iter != enums.end(); ++en_iter) { 
  generate_enum(<em>en_iter); 
   } 
   vector&lt;t_typedef</em>&gt; typedefs = program_-&gt;get_typedefs(); 
   vector&lt;t_typedef<em>&gt;::iterator td_iter; 
   for (td_iter = typedefs.begin(); td_iter != typedefs.end(); ++td_iter) { 
  generate_typedef(</em>td_iter); 
   } 
   vector&lt;t_const<em>&gt; consts = program_-&gt;get_consts(); 
   generate_consts(consts); 
   vector&lt;t_struct</em>&gt; objects = program_-&gt;get_objects(); 
   vector&lt;t_struct<em>&gt;::iterator o_iter; 
   for (o_iter = objects.begin(); o_iter != objects.end(); ++o_iter) { 
     if ((</em>o_iter)-&gt;is_xception()) { 
  generate_xception(<em>o_iter); 
     } else { 
  generate_struct(</em>o_iter); 
     } 
   } 
   vector&lt;t_service<em>&gt; services = program_-&gt;get_services(); 
   vector&lt;t_service</em>&gt;::iterator sv_iter; 
   for (sv_iter = services.begin(); sv_iter != services.end(); ++sv_iter) { 
  service_name_ = get_service_name(<em>sv_iter); 
  generate_service(</em>sv_iter); 
   } 
   close_generator(); 
 æ­¤å‡½æ•°ä½¿ç”¨çš„æ˜¯è¯æ³•å’Œè¯­æ³•åˆ†æç»“æœçš„ä¸€äº›ç¬¦å·ï¼Œè¿™äº›ç¬¦å·éƒ½ä¿æŒåœ¨t_programå¯¹è±¡çš„å¯¹äºæ•°æ®ç»“æ„é‡Œé¢ï¼Œæ‰€ä»¥ä¸Šé¢çš„å‡½æ•°ä¾æ¬¡ä»t_programå¯¹è±¡ä¸­å–å¾—å„ç§æ•°æ®ç±»å‹çš„ç¬¦å·å’ŒæœåŠ¡çš„ç¬¦å·ï¼Œå¹¶ä¾æ¬¡ç”Ÿæˆã€‚</p>

<p>ï¼ˆ3ï¼‰t_generatorç±»çš„å…¶å®ƒåŠŸèƒ½ç®€ä»‹</p>

<p>è¿™ä¸ªç±»æ˜¯æ‰€æœ‰å…·ä½“è¯­è¨€ä»£ç ç”Ÿæˆå™¨çš„å…±åŒåŸºç±»ï¼Œæ‰€ä»¥å®šä¹‰äº†å¾ˆå¤šå„ç§è¯­è¨€ä»£ç ç”Ÿæˆéœ€è¦çš„å…±åŒåŠŸèƒ½ï¼Œä¾‹å¦‚ç”Ÿæˆä»£ç çš„æ ¼å¼æ§åˆ¶ã€å‘½åç©ºé—´çš„æœ‰æ•ˆæ€§æ£€æŸ¥ã€é©¼å³°æ ‡è¯†ç¬¦å’Œä¸‹åˆ’çº¿æ ‡è¯†ç¬¦çš„ç›¸äº’è½¬æ¢ç­‰ç­‰ã€‚è¿™äº›åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œéœ€è¦å¯ä»¥ç›´æ¥æŸ¥çœ‹æºä»£ç ã€‚</p>
:ET