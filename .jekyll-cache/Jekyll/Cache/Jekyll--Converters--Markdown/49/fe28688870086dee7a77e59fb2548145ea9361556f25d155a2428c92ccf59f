I"'<p>https://juejin.im/post/5e53e2efe51d4527196d5352
åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæ¯ä¸€åå¼€å‘è€…ï¼Œä¸ç®¡æ˜¯å‰ç«¯è¿˜æ˜¯åç«¯ï¼Œéƒ½ç»å¸¸ä½¿ç”¨ JSONã€‚JSON æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚ç›¸æ¯”äº XMLï¼Œå®ƒçµæ´»ã€è½»å·§ã€ä½¿ç”¨æ–¹ä¾¿ã€‚JSON ä¹Ÿæ˜¯RESTful APIæ¨èçš„æ ¼å¼ã€‚æœ‰æ—¶ï¼Œæˆ‘ä»¬åªæƒ³è¯»å– JSON ä¸­çš„æŸä¸€äº›å­—æ®µã€‚å¦‚æœè‡ªå·±æ‰‹åŠ¨è§£æã€ä¸€å±‚ä¸€å±‚è¯»å–ï¼Œè¿™å°±å˜å¾—å¼‚å¸¸ç¹çäº†ã€‚ç‰¹åˆ«æ˜¯åœ¨åµŒå¥—å±‚æ¬¡å¾ˆæ·±çš„æƒ…å†µä¸‹ã€‚ä»Šå¤©æˆ‘ä»¬ä»‹ç»gojsonqã€‚å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„æ“ä½œ JSONã€‚
<!-- more -->
å¿«é€Ÿä½¿ç”¨
å…ˆå®‰è£…ï¼š
$ go get github.com/thedevsaddam/gojsonq
å¤åˆ¶ä»£ç åä½¿ç”¨ï¼š
package main</p>

<p>import (
  â€œfmtâ€</p>

<p>â€œgithub.com/thedevsaddam/gojsonqâ€
)</p>

<p>func main() {
  content := <code class="language-plaintext highlighter-rouge">{
  "user": {
    "name": "dj",
    "age": 18,
    "address": {
      "provice": "shanghai",
      "district": "xuhui"
    },
    "hobbies":["chess", "programming", "game"]
  }
}</code></p>

<p>gq := gojsonq.New().FromString(content)
  district := gq.Find(â€œuser.address.districtâ€)
  fmt.Println(district)</p>

<p>gq.Reset()</p>

<p>hobby := gq.Find(â€œuser.hobbies.[0]â€)
  fmt.Println(hobby)
}
å¤åˆ¶ä»£ç æ“ä½œéå¸¸ç®€å•ï¼š</p>

<p>é¦–å…ˆè°ƒç”¨gojsonq.New()åˆ›å»ºä¸€ä¸ªJSONQçš„å¯¹è±¡ï¼›
ç„¶åå°±å¯ä»¥ä½¿ç”¨è¯¥ç±»å‹çš„æ–¹æ³•æ¥æŸ¥è¯¢å±æ€§äº†ã€‚</p>

<p>ä¸Šé¢ä»£ç æˆ‘ä»¬ç›´æ¥è¯»å–ä½äºæœ€å†…å±‚çš„districtå€¼å’Œhobbiesæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼å±‚ä¸å±‚ä¹‹é—´ç”¨.éš”å¼€ï¼Œå¦‚æœæ˜¯æ•°ç»„ï¼Œåˆ™åœ¨å±æ€§å­—æ®µåé€šè¿‡.[index]è¯»å–ä¸‹æ ‡ä¸ºindexçš„å…ƒç´ ã€‚è¿™ç§æ–¹å¼å¯ä»¥å®ç°å¾ˆçµæ´»çš„è¯»å–ã€‚
æ³¨æ„åˆ°ä¸€ä¸ªç»†èŠ‚ï¼šåœ¨æŸ¥è¯¢ä¹‹åï¼Œæˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨äº†ä¸€æ¬¡Reset()æ–¹æ³•ã€‚å› ä¸ºJSONQå¯¹è±¡åœ¨è°ƒç”¨Findæ–¹æ³•æ—¶ï¼Œå†…éƒ¨ä¼šè®°å½•å½“å‰çš„èŠ‚ç‚¹ï¼Œä¸‹ä¸€ä¸ªæŸ¥è¯¢ä¼šä»ä¸Šæ¬¡æŸ¥æ‰¾çš„èŠ‚ç‚¹å¼€å§‹ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬æ³¨é‡Šæ‰jq.Reset()ï¼Œç¬¬äºŒä¸ªFind()æ–¹æ³•å®é™…ä¸ŠæŸ¥æ‰¾çš„æ˜¯user.address.district.user.hobbies.[0]ï¼Œè‡ªç„¶å°±è¿”å›niläº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œgojsonqä¹Ÿæä¾›äº†å¦å¤–ä¸€ç§æ–¹å¼ã€‚å¦‚æœä½ æƒ³è¦ä¿å­˜å½“å‰æŸ¥è¯¢çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼Œå¯ä»¥è°ƒç”¨JSONQçš„Copyæ–¹æ³•è¿”å›ä¸€ä¸ªåˆå§‹çŠ¶æ€ä¸‹çš„å¯¹è±¡ï¼Œå®ƒä»¬ä¼šå…±ç”¨åº•å±‚çš„ JSON å­—ç¬¦ä¸²å’Œè§£æåçš„å¯¹è±¡ã€‚ä¸Šé¢çš„gq.Reset()å¯ä»¥ç”±ä¸‹é¢è¿™è¡Œä»£ç ä»£æ›¿ï¼š
gpCopy := gp.Copy()
å¤åˆ¶ä»£ç åé¢å°±å¯ä»¥ä½¿ç”¨gpCopyæŸ¥è¯¢hobbiesäº†ã€‚
è¿™ä¸ªç®—æ˜¯gojsonqåº“çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œä½†ä¹Ÿæ˜¯åˆå­¦è€…å¸¦æ¥äº†å¾ˆå¤šå›°æ‰°ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚å®é™…ä¸Šï¼ŒJSONQæä¾›çš„å¾ˆå¤šæ–¹æ³•ä¼šæ”¹å˜å½“å‰èŠ‚ç‚¹ï¼Œç¨åéƒ¨åˆ†æˆ‘ä»¬ä¼šæ›´æ¸…æ¥šçš„çœ‹åˆ°ã€‚
æ•°æ®æº
é™¤äº†ä»å­—ç¬¦ä¸²ä¸­åŠ è½½ï¼Œjsonqè¿˜å…è®¸ä»æ–‡ä»¶å’Œio.Readerä¸­è¯»å–å†…å®¹ã€‚åˆ†åˆ«ä½¿ç”¨JSONQå¯¹è±¡çš„Fileå’ŒReaderæ–¹æ³•ï¼š
func main() {
  gq := gojsonq.New().File(â€œ./data.jsonâ€)</p>

<p>fmt.Println(gq.Find(â€œitems.[1].priceâ€))
}
å¤åˆ¶ä»£ç å’Œä¸‹é¢ç¨‹åºçš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š
func main() {
  file, err := os.OpenFile(â€œ./data.jsonâ€, os.O_RDONLY, 0666)
  if err != nil {
    log.Fatal(err)
  }</p>

<p>gq := gojsonq.New().Reader(file)</p>

<p>fmt.Println(gq.Find(â€œitems.[1].priceâ€))
}
å¤åˆ¶ä»£ç ä¸ºäº†åé¢æ¼”ç¤ºæ–¹ä¾¿ï¼Œæˆ‘æ„é€ äº†ä¸€ä¸ªdata.jsonæ–‡ä»¶ï¼š
{
  â€œnameâ€: â€œshopping cartâ€,
  â€œdescriptionâ€: â€œList of items in your cartâ€,
  â€œpricesâ€: [â€œ2400â€, â€œ2100â€, â€œ1200â€, â€œ400.87â€, â€œ89.90â€, â€œ150.10â€],
  â€œitemsâ€: [
    {
      â€œidâ€: 1,
      â€œnameâ€: â€œAppleâ€,
      â€œcountâ€: 2,
      â€œpriceâ€: 12
    },
    {
      â€œidâ€: 2,
      â€œnameâ€: â€œNotebookâ€,
      â€œcountâ€: 10,
      â€œpriceâ€: 3
    },
    {
      â€œidâ€: 3,
      â€œnameâ€: â€œPencilâ€,
      â€œcountâ€: 5,
      â€œpriceâ€: 1
    },
    {
      â€œidâ€: 4,
      â€œnameâ€: â€œCameraâ€,
      â€œcountâ€: 1,
      â€œpriceâ€: 1750
    },
    {
      â€œidâ€: null,
      â€œnameâ€: â€œInvalid Itemâ€,
      â€œcountâ€: 1,
      â€œpriceâ€: 12000
    }
  ]
}
å¤åˆ¶ä»£ç é«˜çº§æŸ¥è¯¢
gojsonqçš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºï¼Œå®ƒå¯ä»¥åƒ SQL ä¸€æ ·è¿›è¡Œæ¡ä»¶æŸ¥è¯¢ï¼Œå¯ä»¥é€‰æ‹©è¿”å›å“ªäº›å­—æ®µï¼Œå¯ä»¥åšä¸€äº›èšåˆç»Ÿè®¡ã€‚
å­—æ®µæ˜ å°„
æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åªå…³å¿ƒå¯¹è±¡ä¸­çš„å‡ ä¸ªå­—æ®µï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨SelectæŒ‡å®šè¿”å›å“ªäº›å­—æ®µï¼Œå…¶ä½™å­—æ®µä¸è¿”å›ï¼š
func main() {
  r := gojsonq.New().File(â€œ./data.jsonâ€).From(â€œitemsâ€).Select(â€œidâ€, â€œnameâ€).Get()
  data, _ := json.MarshalIndent(r, â€œâ€, â€œ  â€œ)
  fmt.Println(string(data))
}
å¤åˆ¶ä»£ç åªä¼šè¾“å‡ºidå’Œnameå­—æ®µï¼š
$ go run main.go
[
  {
    â€œidâ€: 1,
    â€œnameâ€: â€œAppleâ€
  },
  {
    â€œidâ€: 2,
    â€œnameâ€: â€œNotebookâ€
  },
  {
    â€œidâ€: 3,
    â€œnameâ€: â€œPencilâ€
  },
  {
    â€œidâ€: 4,
    â€œnameâ€: â€œCameraâ€
  },
  {
    â€œidâ€: null,
    â€œnameâ€: â€œInvalid Itemâ€
  }
]
å¤åˆ¶ä»£ç ä¸ºäº†æ˜¾ç¤ºæ›´ç›´è§‚ä¸€ç‚¹ï¼Œæˆ‘è¿™é‡Œç”¨json.MarshalIndent()å¯¹è¾“å‡ºåšäº†ä¸€äº›ç¾åŒ–ã€‚
æ˜¯ä¸æ˜¯å’Œ SQL æœ‰ç‚¹åƒSelect id,name From itemsâ€¦
è¿™é‡Œä»‹ç»ä¸€ä¸‹Fromæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å°†å½“å‰èŠ‚ç‚¹ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®ã€‚ä¸Šé¢ä¹Ÿè¯´è¿‡å½“å‰èŠ‚ç‚¹çš„ä½ç½®æ˜¯è®°ä¸‹æ¥çš„ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å…ˆå°†å½“å‰èŠ‚ç‚¹ç§»åŠ¨åˆ°itemsï¼Œåé¢çš„æŸ¥è¯¢å’Œèšåˆæ“ä½œéƒ½æ˜¯é’ˆå¯¹è¿™ä¸ªæ•°ç»„ã€‚å®é™…ä¸ŠFindæ–¹æ³•å†…éƒ¨å°±è°ƒç”¨äº†Fromï¼š
// src/github.com/thedevsaddam/gojsonq/jsonq.go
func (j *JSONQ) Find(path string) interface{} {
  return j.From(path).Get()
}</p>

<p>func (j *JSONQ) From(node string) *JSONQ {
  j.node = node
  v, err := getNestedValue(j.jsonContent, node, j.option.separator)
  if err != nil {
    j.addError(err)
  }
  // ============= æ³¨æ„è¿™ä¸€è¡Œï¼Œè®°ä½å½“å‰èŠ‚ç‚¹ä½ç½®
  j.jsonContent = v
  return j
}
å¤åˆ¶ä»£ç æœ€åå¿…é¡»è¦è°ƒç”¨Get()ï¼Œå®ƒç»„åˆæ‰€æœ‰æ¡ä»¶åæ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢ï¼Œè¿”å›ç»“æœã€‚
æ¡ä»¶æŸ¥è¯¢
æœ‰äº†Selectå’ŒFromï¼Œæ€ä¹ˆèƒ½æ²¡æœ‰Whereå‘¢ï¼Ÿgojsonqæä¾›çš„Whereæ–¹æ³•éå¸¸å¤šï¼Œæˆ‘ä»¬å¤§æ¦‚çœ‹å‡ ä¸ªå°±è¡Œäº†ã€‚
é¦–å…ˆæ˜¯ï¼ŒWhere(key, op, val)ï¼Œè¿™ä¸ªæ˜¯é€šç”¨çš„Whereæ¡ä»¶ï¼Œè¡¨ç¤ºkeyå’Œvalæ˜¯å¦æ»¡è¶³opå…³ç³»ã€‚opå†…ç½®çš„å°±æœ‰å°†è¿‘ 20 ç§ï¼Œè¿˜æ”¯æŒè‡ªå®šä¹‰ã€‚ä¾‹å¦‚=è¡¨ç¤ºç›¸ç­‰ï¼Œ!=è¡¨ç¤ºä¸ç­‰ï¼ŒstartsWithè¡¨ç¤ºvalæ˜¯å¦æ˜¯keyå­—æ®µçš„å‰ç¼€ç­‰ç­‰ç­‰ç­‰ï¼›
å…¶ä»–å¾ˆå¤šæ¡ä»¶éƒ½æ˜¯Whereçš„ç‰¹ä¾‹ï¼Œä¾‹å¦‚WhereIn(key, val)å°±ç­‰ä»·äºWhere(key, â€œinâ€, val)ï¼ŒWhereStartsWith(key, val)å°±ç­‰ä»·äºWhere(key, â€œstartsWithâ€, val)ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼ŒWhereçš„æ¡ä»¶éƒ½æ˜¯Andè¿æ¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡OrWhereè®©å…¶ä»¥Orè¿æ¥ï¼š
func main() {
  gq := gojsonq.New().File(â€œ./data.jsonâ€)</p>

<p>r := gq.From(â€œitemsâ€).Select(â€œidâ€, â€œnameâ€).
    Where(â€œidâ€, â€œ=â€, 1).OrWhere(â€œidâ€, â€œ=â€, 2).Get()
  fmt.Println(r)</p>

<p>gq.Reset()</p>

<p>r = gq.From(â€œitemsâ€).Select(â€œidâ€, â€œnameâ€, â€œcountâ€).
    Where(â€œcountâ€, â€œ&gt;â€, 1).Where(â€œpriceâ€, â€œ&lt;â€, 100).Get()
  fmt.Println(r)
}
å¤åˆ¶ä»£ç ä¸Šé¢ç¬¬ä¸€ä¸ªæŸ¥è¯¢ï¼ŒæŸ¥æ‰¾idä¸º 1 æˆ– 2 çš„è®°å½•ã€‚ç¬¬äºŒä¸ªæŸ¥è¯¢ï¼ŒæŸ¥æ‰¾countå¤§äº 1 ä¸” priceå°äº 100 çš„è®°å½•ã€‚
æŒ‡å®šåç§»å’Œè¿”å›æ¡ç›®æ•°
æœ‰æ—¶æˆ‘ä»¬æƒ³è¦åˆ†é¡µæ˜¾ç¤ºï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶è¿”å›å‰ 3 æ¡å†…å®¹ï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶è¿”å›æ¥ä¸‹æ¥çš„ 3 æ¡è®°å½•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨JSONQå¯¹è±¡çš„Offsetå’ŒLimitæ–¹æ³•æ¥æŒ‡å®šåç§»å’Œè¿”å›çš„æ¡ç›®æ•°ï¼š
func main() {
  gq := gojsonq.New().File(â€œ./data.jsonâ€)</p>

<p>r1 := gq.From(â€œitemsâ€).Select(â€œidâ€, â€œnameâ€).Offset(0).Limit(3).Get()
  fmt.Println(â€œFirst Page:â€, r1)</p>

<p>gq.Reset()</p>

<p>r2 := gq.From(â€œitemsâ€).Select(â€œidâ€, â€œnameâ€).Offset(3).Limit(3).Get()
  fmt.Println(â€œSecond Page:â€, r2)
}
å¤åˆ¶ä»£ç æ¥çœ‹çœ‹è¿è¡Œç»“æœï¼š
$ go run main.go
First Page: [map[id:1 name:Apple] map[id:2 name:Notebook] map[id:3 name:Pencil]]
Second Page: [map[id:4 name:Camera] map[id:<nil> name:Invalid Item]]
å¤åˆ¶ä»£ç èšåˆç»Ÿè®¡
æˆ‘ä»¬è¿˜èƒ½å¯ä»¥å¯¹ä¸€äº›å­—æ®µåšç®€å•çš„ç»Ÿè®¡ï¼Œè®¡ç®—å’Œã€å¹³å‡æ•°ã€æœ€å¤§ã€æœ€å°å€¼ç­‰ï¼š
func main() {
  gq := gojsonq.New().File("./data.json").From("items")</nil></p>

<p>fmt.Println(â€œTotal Count:â€, gq.Sum(â€œcountâ€))
  fmt.Println(â€œMin Price:â€, gq.Min(â€œpriceâ€))
  fmt.Println(â€œMax Price:â€, gq.Max(â€œpriceâ€))
  fmt.Println(â€œAvg Price:â€, gq.Avg(â€œpriceâ€))
}
å¤åˆ¶ä»£ç ä¸Šé¢ç»Ÿè®¡å•†å“çš„æ€»æ•°é‡ã€æœ€ä½ä»·æ ¼ã€æœ€é«˜ä»·æ ¼å’Œå¹³å‡ä»·æ ¼ã€‚
èšåˆç»Ÿè®¡ç±»çš„æ–¹æ³•éƒ½ä¸ä¼šä¿®æ”¹å½“å‰èŠ‚ç‚¹çš„æŒ‡å‘ï¼Œæ‰€ä»¥JSONQå¯¹è±¡å¯ä»¥é‡å¤ä½¿ç”¨ï¼
è¿˜å¯ä»¥å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„å’Œæ’åºï¼š
func main() {
  gq := gojsonq.New().File(â€œ./data.jsonâ€)</p>

<p>fmt.Println(gq.From(â€œitemsâ€).GroupBy(â€œpriceâ€).Get())
  gq.Reset()
  fmt.Println(gq.From(â€œitemsâ€).SortBy(â€œpriceâ€, â€œdescâ€).Get())
}
å¤åˆ¶ä»£ç å…¶ä»–æ ¼å¼
é»˜è®¤æƒ…å†µä¸‹ï¼Œgojsonqä½¿ç”¨ JSON æ ¼å¼è§£ææ•°æ®ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®å…¶ä»–æ ¼å¼è§£æå™¨è®©gojsonqå¯ä»¥å¤„ç†å…¶ä»–æ ¼å¼çš„æ•°æ®ï¼š
func main() {
  jq := gojsonq.New(gojsonq.SetDecoder(&amp;yamlDecoder{})).File(â€œ./data.yamlâ€)
  jq.From(â€œitemsâ€).Where(â€œpriceâ€, â€œ&lt;=â€, 500)
  fmt.Printf(â€œ%v\nâ€, jq.First())
}</p>

<p>type yamlDecoder struct {
}</p>

<p>func (i *yamlDecoder) Decode(data []byte, v interface{}) error {
  bb, err := yaml.YAMLToJSON(data)
  if err != nil {
    return err
  }
  return json.Unmarshal(bb, &amp;v)
}
å¤åˆ¶ä»£ç ä¸Šé¢ä»£ç ç”¨åˆ°äº†yamlåº“ï¼Œéœ€è¦é¢å¤–å®‰è£…ï¼š
$ go get github.com/ghodss/yaml
å¤åˆ¶ä»£ç è§£æå™¨åªè¦å®ç°gojsonq.Decoderæ¥å£ï¼Œéƒ½å¯ä»¥ä½œä¸ºè®¾ç½®åˆ°gojsonqä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ä»»ä½•æ ¼å¼çš„å¤„ç†ï¼š
// src/github.com/thedevsaddam/gojsonq/decoder.go
type Decoder interface {
  Decode(data []byte, v interface{}) error
}
å¤åˆ¶ä»£ç æ€»ç»“
gojsonqè¿˜æœ‰ä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œä¾‹å¦‚è‡ªå®šä¹‰Whereçš„æ“ä½œç±»å‹ï¼Œå–ç¬¬ä¸€ä¸ªã€æœ€åä¸€ä¸ªã€ç¬¬ N ä¸ªå€¼ç­‰ã€‚æ„Ÿå…´è¶£å¯è‡ªè¡Œç ”ç©¶~
å¤§å®¶å¦‚æœå‘ç°å¥½ç©ã€å¥½ç”¨çš„ Go è¯­è¨€åº“ï¼Œæ¬¢è¿åˆ° Go æ¯æ—¥ä¸€åº“ GitHub ä¸Šæäº¤ issueğŸ˜„</p>

<p>gojsonq GitHubï¼šgithub.com/thedevsaddaâ€¦
Go æ¯æ—¥ä¸€åº“ GitHubï¼šgithub.com/darjun/go-dâ€¦</p>
:ET