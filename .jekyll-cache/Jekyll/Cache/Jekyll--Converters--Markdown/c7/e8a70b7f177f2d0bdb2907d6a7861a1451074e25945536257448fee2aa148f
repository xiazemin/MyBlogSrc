I"–<p>æˆ‘ä»¬çŸ¥é“ï¼Œ åœ¨C++ä¸­ï¼Œ æ˜¯å…è®¸å‡½æ•°é‡è½½çš„ï¼Œ ä¹Ÿå°±å¼•å‡ºäº†ç¼–è¯‘å™¨çš„name manglingæœºåˆ¶ï¼Œ ä»Šå¤©æˆ‘ä»¬è¦ä»‹ç»çš„c++filtå‘½ä»¤ä¾¿ä¸æ­¤æœ‰å…³ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  å¯¹äºä»äº‹linuxå¼€å‘çš„äººæ¥è¯´ï¼Œ ä¸å¯ä¸çŸ¥é“c++filtå‘½ä»¤çš„ä½¿ç”¨ã€‚
  https://linux.die.net/man/1/c++filt
  http://web.mit.edu/gnu/doc/html/binutils_10.html
  https://rcweb.dartmouth.edu/doc/ibmcxx/en_US/doc/toolkits/ref/rkcxxflt.htm
  http://ccrma.stanford.edu/planetccrma/man/man1/avr-c++filt.1.html
  https://doc.ecoscentric.com/gnutools/doc/binutils/c_002b_002bfilt.html &lt;!-- more --&gt;  å¦‚æœè¦è°ƒç”¨åŸºç¡€æ¨¡å—åº“ï¼Œ å°±è¦åŒ…å«å¯¹åº”çš„å¤´æ–‡ä»¶ï¼Œ å¹¶åœ¨makefileä¸­æŒ‡å®šå¤´æ–‡ä»¶è·¯å¾„å’Œå¯¹åº”çš„åº“ã€‚
</code></pre></div></div>

<p>Â  Â  Â  Â ä¹‹å‰æˆ‘ä»¬è¯´è¿‡äº†ï¼š</p>

<p>Â  Â  Â  1. å¦‚æœæ²¡æœ‰æŒ‡å®šå¯¹åº”çš„å¤´æ–‡ä»¶ï¼Œ åˆ™ç¼–è¯‘ä¼šæŠ¥é”™ï¼Œ æç¤ºæ‰¾ä¸åˆ°å¤´æ–‡ä»¶ã€‚Â </p>

<p>Â  Â  Â  2. å¦‚æœæŒ‡å®šäº†åº“è·¯å¾„ï¼Œ ä½†å®é™…æ²¡æœ‰åº“ï¼Œ åˆ™ä¼šæŠ¥æ‰¾ä¸é”™åº“æ–‡ä»¶çš„é”™è¯¯ã€‚Â </p>

<p>Â  Â  Â  3. å¦‚æœæ²¡æœ‰æŒ‡å®šåº“è·¯å¾„(å› å„ç§åŸå› å•¦)ï¼Œ åˆ™ç¼–è¯‘ä¸ä¼šæŠ¥é”™ï¼Œ è¿è¡Œçš„æ—¶å€™æ‰ä¼šæŠ¥é”™ï¼Œ æç¤ºdlopenå¤±è´¥ã€‚</p>

<p>Â  Â  Â  é’ˆå¯¹3ä¸­çš„é—®é¢˜ï¼Œ æˆ‘ä»¬ä¹‹å‰ä¹Ÿè¯´è¿‡ï¼Œ å®Œå…¨ä¸ç”¨ç­‰åˆ°è¿è¡Œé˜¶æ®µæ‰å»å‘ç°é—®é¢˜ï¼Œ æˆ‘ä»¬å¯ä»¥åœ¨ç¼–è¯‘å‡ºsoåº“åï¼Œ ç”¨ldd -rå‘½ä»¤æ¥æ‰¾å‡ºundefinedçš„å‡½æ•°å(å½“ç„¶ä¹Ÿå¯ä»¥ç”¨nmå‘½ä»¤)ï¼Œ æ¯”å¦‚ç”¨ldd -r test.soæŸ¥å‡ºç¼ºå°‘_ZNK4Json5ValueixEPKc(è¿™å°±æ˜¯name manglingåçš„å‡½æ•°å), é‚£æ€ä¹ˆçŸ¥é“è¿™ä¸ªname manglingåçš„åå­—çš„åŸå‡½æ•°åç§°å‘¢? Â æˆ‘ä»¬å¯ä»¥å¤§è‡´çŒœæµ‹ï¼Œ ä½†è¿™å¹¶ä¸é è°±ï¼Œ æ€ä¹ˆåŠå‘¢ï¼Ÿc++fileå‘½ä»¤å°±æ˜¯ä¸“é—¨å¹²è¿™ä¸ªçš„ï¼Œ å¦‚ä¸‹ï¼š</p>

<p>[taoge@localhost test]$ c++filt _ZNK4Json5ValueixEPKc
Json::Value::operator<a href="char const*"></a> const
Â  Â  Â  è¿™æ ·ï¼Œ å°±æ›´æ¸…æ¥šæ˜¯å“ªä¸ªå‡½æ•°äº†ã€‚ ç„¶åå°±å¯ä»¥åœ¨å·¥ç¨‹ä¸­æœç´¢äº†ï¼Œ ç„¶åå°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„åº“äº†ï¼Œ ç„¶åå°±å¯ä»¥ä¿®æ”¹makefileæ¥æŒ‡å®šåº“äº†ï¼Œ é…±ç´«å°±è§£å†³é—®é¢˜äº†</p>

<p>gdbæŸ¥çœ‹å¯„å­˜å™¨ i r Â  æŸ¥çœ‹æœ‰ç¨‹åºæŒ‡é’ˆpcæˆ–eip å¯„å­˜å™¨æŒ‡å‘ï¼Œ å‡½æ•°åé¢çš„+numï¼ˆè¡Œæ•°ï¼‰
ç„¶ååœ¨gdbä¸­ç”¨åæ±‡ç¼–æŒ‡ä»¤disassemble,
åœ¨æŒ‡å®šè¡Œä¸‹çœ‹ç¼–è¯‘ä¿¡æ¯Â _ZN6apsara5pangu15ScopedChunkInfoINS0_12RafChunkInfoEED1Ev</p>

<p>c++å‡½æ•°åœ¨linuxç³»ç»Ÿä¸‹ç¼–è¯‘ä¹‹åä¼šå˜æˆç±»ä¼¼ä¸‹é¢çš„æ ·å­ï¼š</p>

<p>_ZN6apsara5pangu15ScopedChunkInfoINS0_12RafChunkInfoEED1Ev</p>

<p>åœ¨linuxå‘½ä»¤è¡Œä½¿ç”¨c++filter:
c++filt _ZN6apsara5pangu15ScopedChunkInfoINS0_12RafChunkInfoEED1Ev
Json::Value::operator<a href="char const*"></a> const</p>

<p>è¿™æ ·å°±å¾—åˆ°å‡½æ•°çš„åŸå§‹åç§°</p>

<p>C++çš„name mangling
C++æ˜¯å…è®¸å‡½æ•°é‡è½½çš„ï¼Œä¹Ÿå°±å¼•å‡ºäº†ç¼–è¯‘å™¨çš„name manglingï¼ˆåå­—ä¿®é¥°ï¼‰æœºåˆ¶,å…¶ç›®çš„æ˜¯ç»™åŒåçš„é‡è½½å‡½æ•°ä¸åŒçš„ç­¾åã€‚</p>

<p>ä¾‹å¦‚ï¼Œå¯¹äºå¦‚ä¸‹ä»£ç ï¼š</p>

<p>int test(int a,int b)
{
  return a+b;
}</p>

<p>int test(int a){
 return a;
}
ä½¿ç”¨g++ç¼–è¯‘æˆsoåï¼Œä½¿ç”¨nm -a (ldd -rå‘½ä»¤ä¹Ÿå¯ä»¥)æŸ¥çœ‹soä¸­çš„ç¬¦å·ï¼š</p>

<p>ä½¿ç”¨g++ç¼–è¯‘æˆsoåï¼Œä½¿ç”¨nm -a (ldd -rå‘½ä»¤ä¹Ÿå¯ä»¥)æŸ¥çœ‹soä¸­çš„ç¬¦å·ï¼š</p>

<p>å‘ç°ä¸¤ä¸ªtestå‡½æ•°åå­—å˜ä¸ºZ4testiå’ŒZ4testii, è¿™å°±æ˜¯name manglingæœºåˆ¶äº§ç”Ÿçš„ã€‚å…¶ä¸­_Zæ˜¯ä¸€ä¸ªå‰ç¼€ï¼Œ4è¡¨ç¤ºå‡½æ•°åé•¿åº¦ï¼ˆtesté•¿åº¦ä¸º4ï¼‰ï¼Œiè¡¨ç¤ºå‚æ•°ç±»å‹ã€‚</p>

<p>C++çš„name manglingéµå¾ªä¸€å®šçš„è§„åˆ™ï¼Œå› æ­¤æ˜¯å¯é€†çš„ï¼Œå³é€šè¿‡ç¬¦å·è¿˜åŸå‡ºåŸæ¥çš„å‡½æ•°å®šä¹‰ã€‚è¿™ä¸ªå·¥å…·å°±å«c++filtã€‚</p>

<p>c++filt
å¯¹äºä¸Šè¿°ä¾‹å­ä¸­çš„ç¬¦å·æˆ‘ä»¬ä½¿ç”¨c++filt</p>

<p>upload successful</p>

<p>å¯ä»¥çœ‹åˆ°è¿˜åŸå‡ºæ¥æˆ‘ä»¬å®šä¹‰çš„å‡½æ•°ã€‚</p>

<p>å½“ç„¶ï¼Œå·¥ç¨‹ä¸­çš„å‡½æ•°å¹¶æ²¡æœ‰æˆ‘ä»¬ç»™å‡ºçš„ä¾‹å­ä¸­é‚£ä¹ˆç®€å•ï¼Œä¾‹å¦‚Androidä¸­æœ‰é‚£ä¹ˆå¤šçš„ç±»å’Œå‘½åç©ºé—´ï¼Œå…¶ç¼–è¯‘ç”Ÿæˆçš„ç¬¦å·ä¹Ÿæ˜¯å¾ˆå¤æ‚çš„ï¼Œä¾‹å¦‚</p>

<p>$c++filt <em>_ZN3art7DexFile10OpenMemoryEPKhjRKNSt3__112basic_stringIcNS3_11char_traitsIcEENS3_9allocatorIcEEEEjPNS_6MemMapEPKNS_10OatDexFileEPS9</em>
è¾“å‡ºï¼š
art::DexFile::OpenMemory(unsigned char const*, unsigned int, std::__1::basic_string&lt;char, std::__1::char_traits<char>, std::__1::allocator<char> &gt; const&amp;, unsigned int, art::MemMap*, art::OatDexFile const*, std::__1::basic_string&lt;char, std::__1::char_traits<char>, std::__1::allocator<char> &gt;*)
æ€»ç»“
c++filtåœ¨hookã€é€†å‘ç­‰åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¾ˆå¿«çš„è¿˜åŸç¬¦å·ï¼Œå®šä½ä»£ç ã€‚</char></char></char></char></p>

<p>åœ¨ç”¨gdb debug C/C++ ç¨‹å¼æ—¶ï¼Œå¸¸å¸¸ä¼šçœ‹åˆ°ä¸€äº›mangle è¿‡çš„å‡½å¼åç§°ï¼Œ</p>

<p>ç†è®ºä¸Šgdb åº”è¯¥ä¼šè‡ªåŠ¨è¿˜åŸåç§°ï¼Œä½†è¿˜æ˜¯å¸¸å¸¸ä¼šçœ‹åˆ°æ²¡æœ‰demangle çš„å‡½å¼â€¦</p>

<p>ä¸¾ä¾‹æ¥è¯´ï¼Œç”¨disas åç»„è¯‘æ—¶ï¼Œçœ‹åˆ°ç¨‹å¼å‘¼å«ä¸€ä¸ª_ZN7Scanner10ScanPacketEPhji çš„å‡½å¼ï¼š</p>

<p>( gdb ) disas 0x00002b757251dfc1
Dump of assembler code for function ScanPcap:
0x00002b757251dfa0 &lt;ScanPcap+0&gt;: sub     $0x8 ,%rsp
0x00002b757251dfa4 &lt;ScanPcap+4&gt;: mov %r9, ( %rsp )
0x00002b757251dfa8 &lt;ScanPcap+8&gt;: mov %r8,%r9
0x00002b757251dfab &lt;ScanPcap+11&gt;: mov %rcx,%r8
0x00002b757251dfae &lt;ScanPcap+14&gt;: mov %edx,%ecx
0x00002b757251dfb0 &lt;ScanPcap+16&gt;: mov %esi,%edx
0x00002b757251dfb2 &lt;ScanPcap+18&gt;: mov %rdi,%rsi
0x00002b757251dfb5 &lt;ScanPcap+21&gt;: mov 0x2063cc ( %rip ) ,%rdi         # 0x2b7572724388
0x00002b757251dfbc &lt;ScanPcap+28&gt;: callq 0x2b757251dbb0 <a href="mailto:_ZN7Scanner10ScanPacketEPhji@plt">_ZN7Scanner10ScanPacketEPhji@plt</a>
0x00002b757251dfc1 &lt;ScanPcap+33&gt;: add     $0x8 ,%rsp
0x00002b757251dfc5 &lt;ScanPcap+37&gt;: retq</p>

<p>è¿™ä¸ªæ˜¯ä»€ä¹ˆå‡½å¼å‘¢ï¼Ÿè—‰ç”±  c++filt  è¿™ä¸ªå·¥å…·çš„å¸®åŠ©ï¼Œæˆ‘ä»¬å¯ä»¥è¿˜åŸåŸå§‹çš„åç§°ï½</p>

<p>åªè¦è¾“å…¥c++filt <mangled symbol="" name=""> å°±è¡Œäº†(æ³¨æ„ä¸è¦æŠŠ@plt ä¹ŸåŠ ä¸Šå»)ï¼Œ</mangled></p>

<p>å¯ä»¥çœ‹åˆ°åŸå§‹çš„å‡½å¼åç§°æ˜¯ Scanner::ScanPacket()ï¼Œå¦å¤–ä¹Ÿå¯ä»¥çœ‹åˆ°å‡½å¼å‚æ•°çš„å‹æ€ï¼š</p>

<p>testuser@localhost ~ $ c++filt _ZN7Scanner10ScanPacketEPhji
Scanner::ScanPacket ( unsigned char*, unsigned int, int )</p>

<p>c++filt ä¸åªå¯¹æˆ‘ä»¬è‡ªå·±å†™çš„å‡½å¼æœ‰ç”¨ï¼ŒC++ STL ä¸­çš„å‡½å¼ä¹Ÿä¸€æ ·æœ‰æ•ˆï¼š</p>

<p>testuser@localhost ~ $ c++filt <em>ZNSt3mapImSt6vectorI4InfoSaIS1_EESt4lessImESaISt4pairIKmS3_EEEixERS7</em>
std::map&lt;unsigned long, std::vector&lt;Info, std::allocator<Info> &gt;, std::less<unsigned long="">, std::allocator&lt;std::pair&lt;unsigned long const, std:: vector&lt;Info, std::allocator<Info> &gt; &gt; &gt; &gt;::operator []( unsigned long const&amp; )</Info></unsigned></Info></p>

<p>ä¸è¿‡c++filt æœ€å¥½æ˜¯åœ¨ç¼–è¯‘å‡ºC/C++ ç¨‹å¼çš„åŒæ ·å¹³å°ä¸Šæ‰§è¡Œï¼Œç¡®ä¿mangle çš„æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œ</p>

<p>åƒæˆ‘åœ¨Mac ä¸Šè™½ç„¶ä¹Ÿå¯ä»¥æ‰§è¡Œc++filtï¼Œä½†è¾“å…¥Linux ä¸Šçš„unmangled å‡½å¼åç§°å‡ ä¹éƒ½æ— æ•ˆå–”ï½</p>
:ET