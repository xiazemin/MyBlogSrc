I"½<!-- more -->
<p>IDä¸º0çš„è¿›ç¨‹é€šå¸¸æ˜¯è°ƒåº¦è¿›ç¨‹ï¼Œå¸¸å¸¸è¢«ç§°ä¸ºäº¤æ¢è¿›ç¨‹ï¼ˆswapperï¼‰ã€‚è¯¥è¿›ç¨‹æ˜¯å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¹¶ä¸æ‰§è¡Œä»»ä½•ç£ç›˜ä¸Šçš„ç¨‹åºï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºç³»ç»Ÿè¿›ç¨‹ã€‚
IDä¸º1çš„è¿›ç¨‹ï¼Œé€šå¸¸æ˜¯initè¿›ç¨‹ï¼Œåœ¨è‡ªä¸¾è¿‡ç¨‹ç»“æŸæ—¶ç”±å†…æ ¸è°ƒç”¨ã€‚è¯¥è¿›ç¨‹çš„ç¨‹åºæ–‡ä»¶ï¼Œåœ¨UNIXæ—©èµ·ç‰ˆæœ¬ä¸­æ˜¯/etc/initï¼Œåœ¨è¾ƒæ–°çš„ç‰ˆæœ¬ä¸­æ˜¯/sbin/initã€‚è¯¥è¿›ç¨‹è´Ÿè´£åœ¨è‡ªä¸¾å†…æ ¸åå¯åŠ¨ä¸€ä¸ªUNIXç³»ç»Ÿã€‚inité€šå¸¸è¯»ä¸ç³»ç»Ÿæœ‰å…³çš„åˆå§‹åŒ–æ–‡ä»¶ï¼ˆ/etc/rc*æ–‡ä»¶æˆ–/etc/inittabæ–‡ä»¶ï¼Œä»¥åŠ/etc/init.dä¸­çš„æ–‡ä»¶ï¼‰ï¼Œå¹¶å°†ç³»ç»Ÿå¼•å¯¼åˆ°ä¸€ä¸ªçŠ¶æ€ã€‚init è¿›ç¨‹ç»ä¸ä¼šç»ˆæ­¢ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„ç”¨æˆ·è¿›ç¨‹ï¼ˆä¸äº¤æ¢è¿›ç¨‹ä¸åŒï¼Œå®ƒä¸æ˜¯å†…æ ¸çš„ç³»ç»Ÿè¿›ç¨‹ï¼‰ä½†æ˜¯å®ƒä»¥è¶…çº§ç”¨æˆ·ç‰¹æƒè¿è¡Œã€‚ â€”â€”æ‘˜è‡ªAPUE
çˆ¶è¿›ç¨‹IDä¸º0çš„è¿›ç¨‹é€šå¸¸æ˜¯å†…æ ¸è¿›ç¨‹ï¼Œå®ƒä»¬ä½œä¸ºç³»ç»Ÿè‡ªä¸¾è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†è€Œå¯åŠ¨ï¼Œä½†initè¿›ç¨‹æ˜¯ä¸ªä¾‹å¤–ï¼Œå®ƒçš„çˆ¶è¿›ç¨‹æ˜¯0ï¼Œä½†æ˜¯å®ƒæ˜¯ç”¨æˆ·è¿›ç¨‹ã€‚</p>

<p>å­è¿›ç¨‹æ˜¯é€šè¿‡çˆ¶è¿›ç¨‹åˆ›å»ºçš„ï¼Œå­è¿›ç¨‹åœ¨åˆ›å»ºæ–°çš„è¿›ç¨‹ã€‚å­è¿›ç¨‹çš„ç»“æŸå’Œçˆ¶è¿›ç¨‹çš„è¿è¡Œæ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹,å³çˆ¶è¿›ç¨‹æ°¸è¿œæ— æ³•é¢„æµ‹å­è¿›ç¨‹ åˆ°åº•ä»€ä¹ˆæ—¶å€™ç»“æŸã€‚ å½“ä¸€ä¸ª è¿›ç¨‹å®Œæˆå®ƒçš„å·¥ä½œç»ˆæ­¢ä¹‹åï¼Œå®ƒçš„çˆ¶è¿›ç¨‹éœ€è¦è°ƒç”¨wait()æˆ–è€…waitpid()ç³»ç»Ÿè°ƒç”¨å–å¾—å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ã€‚</p>

<p>ã€€ã€€å­¤å„¿è¿›ç¨‹ï¼šä¸€ä¸ªçˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆé‚£äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹å°†è¢«initè¿›ç¨‹(è¿›ç¨‹å·ä¸º1)æ‰€æ”¶å…»ï¼Œå¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚</p>

<p>ã€€ã€€åƒµå°¸è¿›ç¨‹ï¼šä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨forkåˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨waitæˆ–waitpidè·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ã€‚è¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµæ­»è¿›ç¨‹ã€‚</p>

<p>é—®é¢˜åŠå±å®³</p>

<p>ã€€ã€€unixæä¾›äº†ä¸€ç§æœºåˆ¶å¯ä»¥ä¿è¯åªè¦çˆ¶è¿›ç¨‹æƒ³çŸ¥é“å­è¿›ç¨‹ç»“æŸæ—¶çš„çŠ¶æ€ä¿¡æ¯ï¼Œ å°±å¯ä»¥å¾—åˆ°ã€‚è¿™ç§æœºåˆ¶å°±æ˜¯: åœ¨æ¯ä¸ªè¿›ç¨‹é€€å‡ºçš„æ—¶å€™,å†…æ ¸é‡Šæ”¾è¯¥è¿›ç¨‹æ‰€æœ‰çš„èµ„æº,åŒ…æ‹¬æ‰“å¼€çš„æ–‡ä»¶,å ç”¨çš„å†…å­˜ç­‰ã€‚ ä½†æ˜¯ä»ç„¶ä¸ºå…¶ä¿ç•™ä¸€å®šçš„ä¿¡æ¯(åŒ…æ‹¬è¿›ç¨‹å·the process ID,é€€å‡ºçŠ¶æ€the termination status of the process,è¿è¡Œæ—¶é—´the amount of CPU time taken by the processç­‰)ã€‚ç›´åˆ°çˆ¶è¿›ç¨‹é€šè¿‡wait / waitpidæ¥å–æ—¶æ‰é‡Šæ”¾ã€‚ ä½†è¿™æ ·å°±å¯¼è‡´äº†é—®é¢˜ï¼Œå¦‚æœè¿›ç¨‹ä¸è°ƒç”¨wait / waitpidçš„è¯ï¼Œ é‚£ä¹ˆä¿ç•™çš„é‚£æ®µä¿¡æ¯å°±ä¸ä¼šé‡Šæ”¾ï¼Œå…¶è¿›ç¨‹å·å°±ä¼šä¸€ç›´è¢«å ç”¨ï¼Œä½†æ˜¯ç³»ç»Ÿæ‰€èƒ½ä½¿ç”¨çš„è¿›ç¨‹å·æ˜¯æœ‰é™çš„ï¼Œå¦‚æœå¤§é‡çš„äº§ç”Ÿåƒµæ­»è¿›ç¨‹ï¼Œå°†å› ä¸ºæ²¡æœ‰å¯ç”¨çš„è¿›ç¨‹å·è€Œå¯¼è‡´ç³»ç»Ÿä¸èƒ½äº§ç”Ÿæ–°çš„è¿›ç¨‹. æ­¤å³ä¸ºåƒµå°¸è¿›ç¨‹çš„å±å®³ï¼Œåº”å½“é¿å…ã€‚</p>

<p>ã€€ã€€å­¤å„¿è¿›ç¨‹æ˜¯æ²¡æœ‰çˆ¶è¿›ç¨‹çš„è¿›ç¨‹ï¼Œå­¤å„¿è¿›ç¨‹è¿™ä¸ªé‡ä»»å°±è½åˆ°äº†initè¿›ç¨‹èº«ä¸Šï¼Œinitè¿›ç¨‹å°±å¥½åƒæ˜¯ä¸€ä¸ªæ°‘æ”¿å±€ï¼Œä¸“é—¨è´Ÿè´£å¤„ç†å­¤å„¿è¿›ç¨‹çš„å–„åå·¥ä½œã€‚æ¯å½“å‡ºç°ä¸€ä¸ªå­¤å„¿è¿›ç¨‹çš„æ—¶å€™ï¼Œå†…æ ¸å°±æŠŠå­¤ å„¿è¿›ç¨‹çš„çˆ¶è¿›ç¨‹è®¾ç½®ä¸ºinitï¼Œè€Œinitè¿›ç¨‹ä¼šå¾ªç¯åœ°wait()å®ƒçš„å·²ç»é€€å‡ºçš„å­è¿›ç¨‹ã€‚è¿™æ ·ï¼Œå½“ä¸€ä¸ªå­¤å„¿è¿›ç¨‹å‡„å‡‰åœ°ç»“æŸäº†å…¶ç”Ÿå‘½å‘¨æœŸçš„æ—¶å€™ï¼Œinitè¿›ç¨‹å°±ä¼šä»£è¡¨å…šå’Œæ”¿åºœå‡ºé¢å¤„ç†å®ƒçš„ä¸€åˆ‡å–„åå·¥ä½œã€‚å› æ­¤å­¤å„¿è¿›ç¨‹å¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå±å®³ã€‚</p>

<p>ã€€ã€€ä»»ä½•ä¸€ä¸ªå­è¿›ç¨‹(inité™¤å¤–)åœ¨exit()ä¹‹åï¼Œå¹¶éé©¬ä¸Šå°±æ¶ˆå¤±æ‰ï¼Œè€Œæ˜¯ç•™ä¸‹ä¸€ä¸ªç§°ä¸ºåƒµå°¸è¿›ç¨‹(Zombie)çš„æ•°æ®ç»“æ„ï¼Œç­‰å¾…çˆ¶è¿›ç¨‹å¤„ç†ã€‚è¿™æ˜¯æ¯ä¸ª å­è¿›ç¨‹åœ¨ç»“æŸæ—¶éƒ½è¦ç»è¿‡çš„é˜¶æ®µã€‚å¦‚æœå­è¿›ç¨‹åœ¨exit()ä¹‹åï¼Œçˆ¶è¿›ç¨‹æ²¡æœ‰æ¥å¾—åŠå¤„ç†ï¼Œè¿™æ—¶ç”¨pså‘½ä»¤å°±èƒ½çœ‹åˆ°å­è¿›ç¨‹çš„çŠ¶æ€æ˜¯â€œZâ€ã€‚å¦‚æœçˆ¶è¿›ç¨‹èƒ½åŠæ—¶ å¤„ç†ï¼Œå¯èƒ½ç”¨pså‘½ä»¤å°±æ¥ä¸åŠçœ‹åˆ°å­è¿›ç¨‹çš„åƒµå°¸çŠ¶æ€ï¼Œä½†è¿™å¹¶ä¸ç­‰äºå­è¿›ç¨‹ä¸ç»è¿‡åƒµå°¸çŠ¶æ€ã€‚  å¦‚æœçˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹ç»“æŸä¹‹å‰é€€å‡ºï¼Œåˆ™å­è¿›ç¨‹å°†ç”±initæ¥ç®¡ã€‚initå°†ä¼šä»¥çˆ¶è¿›ç¨‹çš„èº«ä»½å¯¹åƒµå°¸çŠ¶æ€çš„å­è¿›ç¨‹è¿›è¡Œå¤„ç†ã€‚</p>

<p>ã€€ã€€åƒµå°¸è¿›ç¨‹å±å®³åœºæ™¯ï¼š</p>

<p>ã€€ã€€ä¾‹å¦‚æœ‰ä¸ªè¿›ç¨‹ï¼Œå®ƒå®šæœŸçš„äº§ ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¿™ä¸ªå­è¿›ç¨‹éœ€è¦åšçš„äº‹æƒ…å¾ˆå°‘ï¼Œåšå®Œå®ƒè¯¥åšçš„äº‹æƒ…ä¹‹åå°±é€€å‡ºäº†ï¼Œå› æ­¤è¿™ä¸ªå­è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œä½†æ˜¯ï¼Œçˆ¶è¿›ç¨‹åªç®¡ç”Ÿæˆæ–°çš„å­è¿›ç¨‹ï¼Œè‡³äºå­è¿›ç¨‹ é€€å‡ºä¹‹åçš„äº‹æƒ…ï¼Œåˆ™ä¸€æ¦‚ä¸é—»ä¸é—®ï¼Œè¿™æ ·ï¼Œç³»ç»Ÿè¿è¡Œä¸Šä¸€æ®µæ—¶é—´ä¹‹åï¼Œç³»ç»Ÿä¸­å°±ä¼šå­˜åœ¨å¾ˆå¤šçš„åƒµæ­»è¿›ç¨‹ï¼Œå€˜è‹¥ç”¨pså‘½ä»¤æŸ¥çœ‹çš„è¯ï¼Œå°±ä¼šçœ‹åˆ°å¾ˆå¤šçŠ¶æ€ä¸ºZçš„è¿›ç¨‹ã€‚ ä¸¥æ ¼åœ°æ¥è¯´ï¼Œåƒµæ­»è¿›ç¨‹å¹¶ä¸æ˜¯é—®é¢˜çš„æ ¹æºï¼Œç½ªé­ç¥¸é¦–æ˜¯äº§ç”Ÿå‡ºå¤§é‡åƒµæ­»è¿›ç¨‹çš„é‚£ä¸ªçˆ¶è¿›ç¨‹ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬å¯»æ±‚å¦‚ä½•æ¶ˆç­ç³»ç»Ÿä¸­å¤§é‡çš„åƒµæ­»è¿›ç¨‹æ—¶ï¼Œç­”æ¡ˆå°±æ˜¯æŠŠäº§ç”Ÿå¤§ é‡åƒµæ­»è¿›ç¨‹çš„é‚£ä¸ªå…ƒå‡¶æªæ¯™æ‰ï¼ˆä¹Ÿå°±æ˜¯é€šè¿‡killå‘é€SIGTERMæˆ–è€…SIGKILLä¿¡å·å•¦ï¼‰ã€‚æªæ¯™äº†å…ƒå‡¶è¿›ç¨‹ä¹‹åï¼Œå®ƒäº§ç”Ÿçš„åƒµæ­»è¿›ç¨‹å°±å˜æˆäº†å­¤å„¿è¿› ç¨‹ï¼Œè¿™äº›å­¤å„¿è¿›ç¨‹ä¼šè¢«initè¿›ç¨‹æ¥ç®¡ï¼Œinitè¿›ç¨‹ä¼šwait()è¿™äº›å­¤å„¿è¿›ç¨‹ï¼Œé‡Šæ”¾å®ƒä»¬å ç”¨çš„ç³»ç»Ÿè¿›ç¨‹è¡¨ä¸­çš„èµ„æºï¼Œè¿™æ ·ï¼Œè¿™äº›å·²ç»åƒµæ­»çš„å­¤å„¿è¿›ç¨‹ å°±èƒ½ç‘ç›®è€Œå»äº†ã€‚
ã€€ã€€
ã€€ã€€é¿å…äº§ç”Ÿåƒµå°¸è¿›ç¨‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    æˆ‘ä»¬çŸ¥é“äº†åƒµå°¸è¿›ç¨‹äº§ç”Ÿçš„åŸå› ï¼Œä¸‹è¾¹æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•é¿å…äº§ç”Ÿåƒµå°¸è¿›ç¨‹ã€‚

    ä¸€èˆ¬ï¼Œä¸ºäº†é˜²æ­¢äº§ç”Ÿåƒµå°¸è¿›ç¨‹ï¼Œåœ¨forkå­è¿›ç¨‹ä¹‹åæˆ‘ä»¬éƒ½è¦waitå®ƒä»¬ï¼›åŒæ—¶ï¼Œå½“å­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œå†…æ ¸éƒ½ä¼šç»™çˆ¶è¿›ç¨‹ä¸€ä¸ªSIGCHLDä¿¡å·ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªæ•è·SIGCHLDä¿¡å·çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œåœ¨å‡½æ•°ä½“ä¸­è°ƒç”¨waitï¼ˆæˆ–waitpidï¼‰ï¼Œå°±å¯ä»¥æ¸…ç†é€€å‡ºçš„å­è¿›ç¨‹ä»¥è¾¾åˆ°é˜²æ­¢åƒµå°¸è¿›ç¨‹çš„ç›®çš„ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š
</code></pre></div></div>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre> <span class="kt">void</span> <span class="nf">sig_chld</span><span class="p">(</span> <span class="kt">int</span> <span class="n">signo</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">stat</span><span class="p">;</span>
    <span class="n">pid</span> <span class="o">=</span> <span class="n">wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stat</span><span class="p">);</span>    
    <span class="n">printf</span><span class="p">(</span> <span class="s">"child %d exit</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pid</span> <span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">signal</span><span class="p">(</span><span class="n">SIGCHLD</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">sig_chld</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>ç°åœ¨mainå‡½æ•°ä¸­ç»™SIGCHLDä¿¡å·æ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼ˆsig_chldï¼‰ï¼Œç„¶ååœ¨å­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œå†…æ ¸é€’äº¤ä¸€ä¸ªSIGCHLDçš„æ—¶å€™å°±ä¼šè¢«ä¸»è¿›ç¨‹æ•è·è€Œè¿›å…¥ä¿¡å·å¤„ç†å‡½æ•°sig_chldï¼Œç„¶åå†åœ¨sig_chldä¸­è°ƒç”¨waitï¼Œå°±å¯ä»¥æ¸…ç†é€€å‡ºçš„å­è¿›ç¨‹ã€‚è¿™æ ·é€€å‡ºçš„å­è¿›ç¨‹å°±ä¸ä¼šæˆä¸ºåƒµå°¸è¿›ç¨‹ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ç„¶åï¼Œå³ä¾¿æˆ‘ä»¬æ•è·SIGCHLDä¿¡å·å¹¶ä¸”è°ƒç”¨waitæ¥æ¸…ç†é€€å‡ºçš„è¿›ç¨‹ï¼Œä»ç„¶ä¸èƒ½å½»åº•é¿å…äº§ç”Ÿåƒµå°¸è¿›ç¨‹ï¼›æˆ‘ä»¬æ¥çœ‹ä¸€ç§ç‰¹æ®Šçš„æƒ…å†µï¼š

    æˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªclient/serverçš„ç¨‹åºï¼Œå¯¹äºæ¯ä¸€ä¸ªè¿æ¥è¿‡æ¥çš„clientï¼Œserveréƒ½å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹å»å¤„ç†æ¥è‡ªè¿™ä¸ªclientçš„è¯·æ±‚ã€‚ç„¶åæˆ‘ä»¬æœ‰ä¸€ä¸ªclientè¿›ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿›ç¨‹å†…ï¼Œå‘èµ·äº†å¤šä¸ªåˆ°serverçš„è¯·æ±‚ï¼ˆå‡è®¾5ä¸ªï¼‰ï¼Œåˆ™serverä¼šfork 5ä¸ªå­è¿›ç¨‹æ¥è¯»å–clientè¾“å…¥å¹¶å¤„ç†ï¼ˆåŒæ—¶ï¼Œå½“å®¢æˆ·ç«¯å…³é—­å¥—æ¥å­—çš„æ—¶å€™ï¼Œæ¯ä¸ªå­è¿›ç¨‹éƒ½é€€å‡ºï¼‰ï¼›å½“æˆ‘ä»¬ç»ˆæ­¢è¿™ä¸ªclientè¿›ç¨‹çš„æ—¶å€™ ï¼Œå†…æ ¸å°†è‡ªåŠ¨å…³é—­æ‰€æœ‰ç”±è¿™ä¸ªclientè¿›ç¨‹æ‰“å¼€çš„å¥—æ¥å­—ï¼Œé‚£ä¹ˆç”±è¿™ä¸ªclientè¿›ç¨‹å‘èµ·çš„5ä¸ªè¿æ¥åŸºæœ¬åœ¨åŒä¸€æ—¶åˆ»ç»ˆæ­¢ã€‚è¿™å°±å¼•å‘äº†5ä¸ªFINï¼Œæ¯ä¸ªè¿æ¥ä¸€ä¸ªã€‚serverç«¯æ¥å—åˆ°è¿™5ä¸ªFINçš„æ—¶å€™ï¼Œ5ä¸ªå­è¿›ç¨‹åŸºæœ¬åœ¨åŒä¸€æ—¶åˆ»ç»ˆæ­¢ã€‚è¿™å°±åˆå¯¼è‡´å·®ä¸å¤šåœ¨åŒä¸€æ—¶åˆ»é€’äº¤5ä¸ªSIGCHLDä¿¡å·ç»™çˆ¶è¿›ç¨‹   å»ºç«‹ä¿¡å·å¤„ç†å‡½æ•°å¹¶åœ¨å…¶ä¸­è°ƒç”¨waitå¹¶ä¸è¶³ä»¥é˜²æ­¢å‡ºç°åƒµå°¸è¿›ç¨‹ï¼Œå…¶åŸå› åœ¨äºï¼šæ‰€æœ‰5ä¸ªä¿¡å·éƒ½åœ¨ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œä¹‹å‰äº§ç”Ÿï¼Œè€Œä¿¡å·å¤„ç†å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸ºUnixä¿¡å·ä¸€èˆ¬æ˜¯ä¸æ’é˜Ÿçš„(æˆ‘çš„è¿™ç¯‡åšå®¢ä¸­æœ‰æåˆ°http://www.cnblogs.com/yuxingfirst/p/3160697.html)ã€‚ æ›´ä¸ºä¸¥é‡çš„æ˜¯ï¼Œæœ¬é—®é¢˜æ˜¯ä¸ç¡®å®šçš„ï¼Œä¾èµ–äºå®¢æˆ·FINåˆ°è¾¾æœåŠ¡å™¨ä¸»æœºçš„æ—¶æœºï¼Œä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œçš„æ¬¡æ•°å¹¶ä¸ç¡®å®šã€‚

   æ­£ç¡®çš„è§£å†³åŠæ³•æ˜¯è°ƒç”¨waitpidè€Œä¸æ˜¯waitï¼Œè¿™ä¸ªåŠæ³•çš„æ–¹æ³•ä¸ºï¼šä¿¡å·å¤„ç†å‡½æ•°ä¸­ï¼Œåœ¨ä¸€ä¸ªå¾ªç¯å†…è°ƒç”¨waitpidï¼Œä»¥è·å–æ‰€æœ‰å·²ç»ˆæ­¢å­è¿›ç¨‹çš„çŠ¶æ€ã€‚æˆ‘ä»¬å¿…é¡»æŒ‡å®šWNOHANGé€‰é¡¹ï¼Œä»–å‘ŠçŸ¥waitpidåœ¨æœ‰å°šæœªç»ˆæ­¢çš„å­è¿›ç¨‹åœ¨è¿è¡Œæ—¶ä¸è¦é˜»å¡ã€‚ï¼ˆæˆ‘ä»¬ä¸èƒ½åœ¨å¾ªç¯å†…è°ƒç”¨waitï¼Œå› ä¸ºæ²¡æœ‰åŠæ³•é˜²æ­¢waitåœ¨å°šæœ‰æœªç»ˆæ­¢çš„å­è¿›ç¨‹åœ¨è¿è¡Œæ—¶é˜»å¡ï¼Œwaitå°†ä¼šé˜»å¡åˆ°ç°æœ‰çš„å­è¿›ç¨‹ä¸­ç¬¬ä¸€ä¸ªç»ˆæ­¢ä¸ºæ­¢ï¼‰ï¼Œä¸‹è¾¹çš„ç¨‹åºåˆ†åˆ«ç»™å‡ºäº†è¿™ä¸¤ç§å¤„ç†åŠæ³•(func_wait, func_waitpid)ã€‚
</code></pre></div></div>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
</pre></td><td class="code"><pre>       <span class="c1">//server.c</span>
 <span class="cp">#include &lt;stdio.h&gt;
</span> <span class="cp">#include &lt;stdlib.h&gt;
</span> <span class="cp">#include &lt;unistd.h&gt;
</span> <span class="cp">#include &lt;sys/socket.h&gt;
</span> <span class="cp">#include &lt;errno.h&gt;
</span> <span class="cp">#include &lt;error.h&gt;
</span> <span class="cp">#include &lt;netinet/in.h&gt;
</span> <span class="cp">#include &lt;netinet/ip.h&gt;
</span> <span class="cp">#include &lt;arpa/inet.h&gt;
</span> <span class="cp">#include &lt;string.h&gt;
</span> <span class="cp">#include &lt;signal.h&gt;
</span> <span class="cp">#include &lt;sys/wait.h&gt;
</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="nf">sigfunc</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">func_wait</span><span class="p">(</span><span class="kt">int</span> <span class="n">signo</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">stat</span><span class="p">;</span>
    <span class="n">pid</span> <span class="o">=</span> <span class="n">wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stat</span><span class="p">);</span>    
    <span class="n">printf</span><span class="p">(</span> <span class="s">"child %d exit</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pid</span> <span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">func_waitpid</span><span class="p">(</span><span class="kt">int</span> <span class="n">signo</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">stat</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span> <span class="p">(</span><span class="n">pid</span> <span class="o">=</span> <span class="n">waitpid</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stat</span><span class="p">,</span> <span class="n">WNOHANG</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span> <span class="s">"child %d exit</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pid</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">sigfunc</span><span class="o">*</span> <span class="nf">signal</span><span class="p">(</span> <span class="kt">int</span> <span class="n">signo</span><span class="p">,</span> <span class="n">sigfunc</span> <span class="o">*</span><span class="n">func</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">sigaction</span> <span class="n">act</span><span class="p">,</span> <span class="n">oact</span><span class="p">;</span>
    <span class="n">act</span><span class="p">.</span><span class="n">sa_handler</span> <span class="o">=</span> <span class="n">func</span><span class="p">;</span>
    <span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">act</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span>
    <span class="n">act</span><span class="p">.</span><span class="n">sa_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">signo</span> <span class="o">==</span> <span class="n">SIGALRM</span> <span class="p">)</span> <span class="p">{</span>
 <span class="cp">#ifdef            SA_INTERRUPT
</span>        <span class="n">act</span><span class="p">.</span><span class="n">sa_flags</span> <span class="o">|=</span> <span class="n">SA_INTERRUPT</span><span class="p">;</span>    <span class="cm">/* SunOS 4.x */</span>
 <span class="cp">#endif
</span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
 <span class="cp">#ifdef           SA_RESTART
</span>        <span class="n">act</span><span class="p">.</span><span class="n">sa_flags</span> <span class="o">|=</span> <span class="n">SA_RESTART</span><span class="p">;</span>    <span class="cm">/* SVR4, 4.4BSD */</span>
 <span class="cp">#endif
</span>    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">sigaction</span><span class="p">(</span><span class="n">signo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">act</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oact</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">SIG_ERR</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">oact</span><span class="p">.</span><span class="n">sa_handler</span><span class="p">;</span>
<span class="p">}</span> 


<span class="kt">void</span> <span class="nf">str_echo</span><span class="p">(</span> <span class="kt">int</span> <span class="n">cfd</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kt">ssize_t</span> <span class="n">n</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<span class="nl">again:</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
    <span class="k">while</span><span class="p">(</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">cfd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">write</span><span class="p">(</span><span class="n">cfd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span> 
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">n</span> <span class="o">&lt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">errno</span> <span class="o">==</span> <span class="n">EINTR</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">goto</span> <span class="n">again</span><span class="p">;</span> 
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"str_echo: read error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">signal</span><span class="p">(</span><span class="n">SIGCHLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">func_waitpid</span><span class="p">);</span>    

    <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
    <span class="n">pid_t</span> <span class="n">child</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">e</span> <span class="o">=</span> <span class="n">errno</span><span class="p">;</span> 
        <span class="n">perror</span><span class="p">(</span><span class="s">"create socket fail.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">server_addr</span><span class="p">,</span> <span class="n">child_addr</span><span class="p">;</span> 
    <span class="n">bzero</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">server_addr</span><span class="p">));</span>
    <span class="n">server_addr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
    <span class="n">server_addr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">9998</span><span class="p">);</span>
    <span class="n">server_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">bind</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">server_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">server_addr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">e</span> <span class="o">=</span> <span class="n">errno</span><span class="p">;</span> 
        <span class="n">perror</span><span class="p">(</span><span class="s">"bind address fail.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span><span class="p">(</span> <span class="n">listen</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">e</span> <span class="o">=</span> <span class="n">errno</span><span class="p">;</span> 
        <span class="n">perror</span><span class="p">(</span><span class="s">"listen fail.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">socklen_t</span> <span class="n">chilen</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">child_addr</span><span class="p">);</span> 
        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">child_addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">chilen</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">perror</span><span class="p">(</span><span class="s">"listen fail."</span><span class="p">);</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">child</span> <span class="o">=</span> <span class="n">fork</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">close</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> 
            <span class="n">str_echo</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">close</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//client.c</span>
<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;errno.h&gt;
#include &lt;error.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;netinet/ip.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;string.h&gt;
#include &lt;signal.h&gt;
</span>
<span class="kt">void</span> <span class="nf">str_cli</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sfd</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">sendline</span><span class="p">[</span><span class="mi">1024</span><span class="p">],</span> <span class="n">recvline</span><span class="p">[</span><span class="mi">2014</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">recvline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sendline</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">sendline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">recvline</span><span class="p">));</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">fgets</span><span class="p">(</span><span class="n">sendline</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">write</span><span class="p">(</span><span class="n">sfd</span><span class="p">,</span> <span class="n">sendline</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sendline</span><span class="p">));</span> 
        <span class="k">if</span><span class="p">(</span> <span class="n">read</span><span class="p">(</span><span class="n">sfd</span><span class="p">,</span> <span class="n">recvline</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"server term prematurely.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span> 
        <span class="p">}</span>
        <span class="n">fputs</span><span class="p">(</span><span class="n">recvline</span><span class="p">,</span> <span class="n">stdout</span><span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">recvline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sendline</span><span class="p">));</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">sendline</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">recvline</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span> 
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">e</span> <span class="o">=</span> <span class="n">errno</span><span class="p">;</span> 
            <span class="n">perror</span><span class="p">(</span><span class="s">"create socket fail.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">server_addr</span><span class="p">,</span> <span class="n">child_addr</span><span class="p">;</span> 
        <span class="n">bzero</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">server_addr</span><span class="p">));</span>
        <span class="n">server_addr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
        <span class="n">server_addr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">9998</span><span class="p">);</span>
        <span class="n">inet_pton</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">server_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">connect</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">server_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">server_addr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">perror</span><span class="p">(</span><span class="s">"connect fail."</span><span class="p">);</span> 
            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="n">str_cli</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

:ET