I"´<p>Iâ€™m trying to install ambari 2.6 on a docker centos7 image but in the the ambari setup step and exactly while intializing the postgresql db I receive this error:</p>

<p>Failed to get D-Bus connection: Operation not permitted</p>

<p>Iâ€™ve got this error every time I try to run a serice on my docker image.</p>

<p>I tried every solution in the net but nothing worked yet.
<!-- more -->
Use this command</p>

<p>docker run -d -it â€“privileged ContainerId /usr/sbin/init</p>

<p>And access root in container</p>

<p>systemctl start httpd.service</p>

<p>åœ¨centos7çš„å®¹å™¨é‡Œé¢å‡ºç°äº†ä¸€ä¸ªBUGï¼Œå°±æ˜¯serveiceå¯åŠ¨æœåŠ¡çš„æ—¶å€™å‡ºç°æŠ¥é”™ï¼Œä¸èƒ½ç”¨serviceå¯åŠ¨æœåŠ¡ã€‚
[root@e13c3d3802d0 /]# service httpd start
Redirecting to /bin/systemctl start  httpd.service
Failed to get D-Bus connection: Operation not permitted</p>

<p>é¦–å…ˆæ­å–œä½ ä½¿ç”¨centos7é•œåƒï¼Œç„¶åå°±æ˜¯ä¸å¹¸å‘Šè¯‰ä½ è¿™ä¸ªé—®é¢˜æ˜¯ä¸ªBUG å°†åœ¨centos7.2è§£å†³ã€‚
  Currently, systemd in CentOS 7 has been removed and replaced with a fakesystemd package for dependency resolution. This is due to systemd requiring the CAP_SYS_ADMIN capability, as well as being able to read the hostâ€™s cgroups. If you wish to replace the fakesystemd package and use systemd normally, please follow the steps below.</p>

<p>æˆ‘æŸ¥äº†å¥½å¤šåœ°æ–¹éƒ½è¯´æ˜¯ä¸ªBUGä¸èƒ½è§£å†³
æœ‰çš„è¯´åˆ›å»ºçš„æ—¶å€™åŠ ä¸Š â€“privilegedé€‰é¡¹</p>

<p>æˆ‘è¯•äº†è¿™äº›ç„¶è€Œå¹¶æ²¡æœ‰ä»»ä½•çš„åµç”¨</p>

<p>æœ€åå®åœ¨æ˜¯æ²¡åŠæ³•å°± rpm -ql è½¯ä»¶åŒ… æŸ¥çœ‹å®‰è£…çš„æ—¶å€™æœ‰å“ªäº›å‘½ä»¤åœ¨PATHä¸‹ï¼Œç”¨è¿™äº›å‘½ä»¤å»å¯åŠ¨ï¼Œè¿™ä¸ªæ˜¯ä¸€ç§è§£å†³çš„æ–¹æ³•
ä¾‹å¦‚apacheçš„å¯åŠ¨å°±æ˜¯ç”¨å‘½ä»¤ httpd</p>

<p>è¿™å‡ å¤©ç ”ç©¶äº†ä¸ªè§£å†³çš„åŠæ³•æ¯”è¾ƒé è°±ï¼Œäº²èº«å®æµ‹å¥½ä½¿ï¼š
systemctl start http.service
Failed to get D-Bus connection: No connection to service manager.</p>

<p>è¿™ä¸ªçš„åŸå› æ˜¯å› ä¸ºdbus-daemonæ²¡èƒ½å¯åŠ¨ã€‚å…¶å®systemctlå¹¶ä¸æ˜¯ä¸å¯ä»¥ä½¿ç”¨ã€‚å°†ä½ çš„CMDæˆ–è€…entrypointè®¾ç½®ä¸º/usr/sbin/initå³å¯ã€‚ä¼šè‡ªåŠ¨å°†dbusç­‰æœåŠ¡å¯åŠ¨èµ·æ¥ã€‚
   ç„¶åå°±å¯ä»¥ä½¿ç”¨systemctläº†ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š
   docker run â€“privileged  -ti -e â€œcontainer=dockerâ€  -v /sys/fs/cgroup:/sys/fs/cgroup  centos  /usr/sbin/init</p>

<p>å› ä¸ºcentos7é•œåƒçš„åŸå› ï¼Œé»˜è®¤æ˜¯æ— æ³•å¼€å¯systemctlçš„ï¼Œéœ€è¦ç‰¹æƒå¯åŠ¨ï¼Œå¹¶æŒ‚è½½cgroupï¼Œå¯åŠ¨ç‚¹è®¾ç½®ä¸ºinitï¼Œå¯åŠ¨å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<p>docker run -d -it â€“network=mynet â€“ip 172.18.0.8 â€“restart=always -h test â€“name test -v /sys/fs/cgroup:/sys/fs/cgroup:ro â€“privileged=true centos /usr/sbin/init</p>

<p>docker centos ä½¿ç”¨ systemctl Failed to get D-Bus connection: Operation not permitted
è½¬è½½å€¾-å°½ å‘å¸ƒäº2017-12-22 15:35:01 é˜…è¯»æ•° 11766  æ”¶è—
å±•å¼€
æˆ‘ä»¬çŸ¥é“ï¼ŒDockerè¿è¡Œä¸€ä¸ªå®¹å™¨èµ·æ¥çš„æ—¶å€™ï¼Œåªæ˜¯ä¸ºä½ æä¾›ç‰¹å®šçš„æ–‡ä»¶ç³»ç»Ÿå±‚å’Œè¿›ç¨‹éš”ç¦»ï¼Œå®ƒç»™ä½ ä¸€ä¸ªVMçš„æ„Ÿè§‰å´å¹¶ä¸æ˜¯VMï¼Œæ‰€ä»¥ä½ å¯èƒ½å¶å°”ä¼šæƒ³è¦åƒåœ¨ç‰©ç†æœºé‚£æ ·ä½¿ç”¨systemctl start|status|stopæ¥ç®¡ç†æœåŠ¡è¿›ç¨‹ï¼Œç„¶åä½ é€šå¸¸ä¼šçœ‹åˆ°
Failed to get D-Bus connection: Operation not permitted
è¿™ä¸ªé”™è¯¯ã€‚
åŸå› å¾ˆç®€å•ï¼š</p>

<p>ä½ éœ€è¦å¯åŠ¨systemdè¿›ç¨‹
ä½ éœ€è¦ç‰¹æƒ
æ‰€ä»¥ä½ å¦‚æœæƒ³è¦ä¸€ä¸ªå¯ä»¥ä½¿ç”¨Systemdçš„å®¹å™¨ï¼Œä½ å¯ä»¥å°è¯•è¿™æ ·å¯åŠ¨å®¹å™¨:</p>

<p>1.è§£å†³åŠæ³•ä¸€ï¼šç»™æƒé™
cat /etc/redhat-release 
//CentOS Linux release 7.2.1511 (Core) 
docker run -tdi â€“privileged centos init</p>

<p>åœ¨å®¹å™¨ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨systemdç®¡ç†æœåŠ¡è¿›ç¨‹äº†:</p>

<p>yum install -y vsftpd
systemctl start vsftpd
systemctl status vsftpd</p>

<p>2.è§£å†³åŠæ³•äºŒï¼šinit.d
é™¤æ­¤ä¹‹å¤–ä½ ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–å¯åŠ¨è½¯ä»¶çš„æ–¹å¼: init.dæ¥è¾¾åˆ° systemctl çš„æ•ˆæœï¼š
æ¯”å¦‚è¦å¯åŠ¨ mysql æœåŠ¡ï¼š/etc/init.d/mysql start</p>

<p>Dockerçš„è®¾è®¡ç†å¿µæ˜¯åœ¨å®¹å™¨é‡Œé¢ä¸è¿è¡Œåå°æœåŠ¡ï¼Œå®¹å™¨æœ¬èº«å°±æ˜¯å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªç‹¬ç«‹çš„ä¸»è¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥é—´æ¥çš„ç†è§£ä¸ºå°±æ˜¯å®¹å™¨é‡Œè¿è¡ŒæœåŠ¡çš„åº”ç”¨è¿›ç¨‹ã€‚ä¸€ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å›´ç»•è¿™ä¸ªä¸»è¿›ç¨‹å­˜åœ¨çš„ï¼Œæ‰€ä»¥æ­£ç¡®çš„ä½¿ç”¨å®¹å™¨æ–¹æ³•æ˜¯å°†é‡Œé¢çš„æœåŠ¡è¿è¡Œåœ¨å‰å°ã€‚</p>

<p>å†è¯´åˆ°systemdï¼Œè¿™ä¸ªå¥—ä»¶å·²ç»æˆä¸ºä¸»æµLinuxå‘è¡Œç‰ˆï¼ˆæ¯”å¦‚CentOS7ã€Ubuntu14+ï¼‰é»˜è®¤çš„æœåŠ¡ç®¡ç†ï¼Œå–ä»£äº†ä¼ ç»Ÿçš„SystemVé£æ ¼æœåŠ¡ç®¡ç†ã€‚systemdç»´æŠ¤ç³»ç»ŸæœåŠ¡ç¨‹åºï¼Œå®ƒéœ€è¦ç‰¹æƒå»ä¼šè®¿é—®Linuxå†…æ ¸ã€‚è€Œå®¹å™¨å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸”é»˜è®¤å¯åŠ¨åªæ˜¯æ™®é€šç”¨æˆ·è¿™æ ·çš„æƒé™è®¿é—®Linuxå†…æ ¸ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ç‰¹æƒï¼Œæ‰€ä»¥è‡ªç„¶å°±ç”¨ä¸äº†ï¼</p>

<p>å› æ­¤ï¼Œè¯·éµå®ˆå®¹å™¨è®¾è®¡åŸåˆ™ï¼Œä¸€ä¸ªå®¹å™¨é‡Œè¿è¡Œä¸€ä¸ªå‰å°æœåŠ¡ï¼</p>

<p>æˆ‘å°±æƒ³è¿™æ ·è¿è¡Œï¼Œéš¾é“è§£å†³ä¸äº†å—ï¼Ÿ</p>

<p>ç­”ï¼šå¯ä»¥ï¼Œä»¥ç‰¹æƒæ¨¡å¼è¿è¡Œå®¹å™¨ã€‚</p>

<p>åˆ›å»ºå®¹å™¨ï¼š</p>

<h1 id="docker-run--d--name-centos7-privilegedtrue-centos7-usrsbininit">docker run -d -name centos7 â€“privileged=true centos:7 /usr/sbin/init</h1>

<p>è¿›å…¥å®¹å™¨ï¼š</p>

<h1 id="docker-exec--it-centos7-binbash">docker exec -it centos7 /bin/bash</h1>

<p>è¿™æ ·å¯ä»¥ä½¿ç”¨systemctlå¯åŠ¨æœåŠ¡äº†ã€‚</p>
:ET