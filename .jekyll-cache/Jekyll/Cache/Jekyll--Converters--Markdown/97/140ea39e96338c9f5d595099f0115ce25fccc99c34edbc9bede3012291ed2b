I"«<p>golang easyJson åŒ…çš„ä½¿ç”¨
easyjson æ˜¯ç”¨æ¥å¿«é€Ÿè¿›è¡Œjsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å·¥å…·åŒ…ï¼Œé€šè¿‡ç»™æˆ‘ä»¬è¦è¿›è¡Œåºåˆ—åŒ–çš„structç”Ÿæˆæ–¹æ³•æ¥å®ç°ä¸é€šè¿‡åå°„è¿›è¡Œjsonåºåˆ—åŒ–ï¼Œå¯¹æ¯”golangåŸæœ‰jsonå·¥å…·åŒ…ï¼Œæ€§èƒ½èƒ½å¤Ÿæé«˜3å€ä»¥ä¸Šã€‚</p>

<p>githubåœ°å€ï¼šhttps://github.com/mailru/easyjson</p>

<p>ä¸€ å®‰è£…ï¼š</p>

<p>â€‹ å®˜ç½‘æ¨èä½¿ç”¨ï¼š</p>

<h1 id="install">install</h1>
<p>go get -u github.com/mailru/easyjson/â€¦
â€‹ å¦‚æœå¤±è´¥ï¼Œå¯ä»¥å°†é¡¹ç›®å…‹éš†åˆ°$GOPATH/src/mailru ç›®å½•ä¸‹ å¹¶å°†åŒ…åæ”¹ä¸ºeasyjson,ç„¶åè¿›å…¥easyjsonåŒ…ä¸‹çš„easyjsonç›®å½•ï¼Œè¿è¡Œgo build å‘½ä»¤ï¼Œå†å°†ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åˆ°$GOPATH/binç›®å½•ä¸‹å¹¶æ”¹åä¸ºeasyjson</p>

<p>æˆ‘çš„go build æ–‡ä»¶è·¯å¾„</p>

<p>/home/luslin/go/src/github.com/mailru/easyjson/easyjson</p>

<!-- more -->
<p>äºŒ ç”Ÿæˆæ–‡ä»¶:</p>

<p>é¡¹ç›®æ–‡ä»¶è·¯å¾„ï¼š</p>

<p>tests/ï¼ˆåœ¨gopathç›®å½•ä¸‹ï¼‰
â””â”€â”€ src
    â”œâ”€â”€ json_test.go
    â””â”€â”€ models
        â”œâ”€â”€ models_easyjson.go	ï¼ˆeasyjsonå‘½ä»¤ç”Ÿæˆçš„æ–‡ä»¶)
        â””â”€â”€ models.go	ï¼ˆæ¨¡å‹æ–‡ä»¶ï¼‰</p>

<p>Easyjson å‘½ä»¤å·¥å…·ä½¿ç”¨æ—¶modelsæ–‡ä»¶éœ€è¦åœ¨gopathè·¯å¾„ä¸‹ï¼Œå¹¶ä¸”è¦ç”Ÿæˆjsonæ–¹æ³•çš„structä¸Šé¢è¦åŠ ä¸Š//easyjsonå£°æ˜ï¼Œä¾‹å¦‚ï¼š</p>

<p>package models</p>

<p>//easyjson
type User struct {
	Name string <code class="language-plaintext highlighter-rouge">json:"name"</code>
	Age  int    <code class="language-plaintext highlighter-rouge">json:"age"</code>
}</p>

<p>å‘½ä»¤è¡Œä¸­è¿è¡Œï¼š</p>

<p>easyjson -all models.go
1
ä¼šçœ‹åˆ°æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ models_easyjson.go æ–‡ä»¶ï¼ŒæŸ¥çœ‹å†…å®¹ï¼Œä¼šå‘ç°æ–‡ä»¶ç»™User struct æ·»åŠ äº†å››ä¸ªæ–¹æ³•</p>

<p>// MarshalJSON supports json.Marshaler interface
func (v User) MarshalJSON() ([]byte, error) {
	w := jwriter.Writer{}
	easyjsonD2b7633eEncodeTestsSrcModels(&amp;w, v)
	return w.Buffer.BuildBytes(), w.Error
}</p>

<p>// MarshalEasyJSON supports easyjson.Marshaler interface
func (v User) MarshalEasyJSON(w *jwriter.Writer) {
	easyjsonD2b7633eEncodeTestsSrcModels(w, v)
}</p>

<p>// UnmarshalJSON supports json.Unmarshaler interface
func (v *User) UnmarshalJSON(data []byte) error {
	r := jlexer.Lexer{Data: data}
	easyjsonD2b7633eDecodeTestsSrcModels(&amp;r, v)
	return r.Error()
}</p>

<p>// UnmarshalEasyJSON supports easyjson.Unmarshaler interface
func (v *User) UnmarshalEasyJSON(l *jlexer.Lexer) {
	easyjsonD2b7633eDecodeTestsSrcModels(l, v)
}</p>

<p>ä¸‰ æ–¹æ³•ä½¿ç”¨</p>

<p>1 å°†struct åºåˆ—åŒ–æˆjsonæ ¼å¼</p>

<p>func TestMarshal(t *testing.T)  {
	u1 := models.User{â€œteststructâ€,12}
	ujs,_ := json.Marshal(u1)
	fmt.Println(string(ujs),reflect.TypeOf(ujs))
}
ç»“æœï¼š
{â€œnameâ€:â€teststructâ€,â€ageâ€:12} []uint8</p>

<p>2 å°†jsonåºåˆ—åŒ–æˆstruct</p>

<p>func TestUnmarshal(t *testing.T) {
	u1 := models.User{â€œteststructâ€,12}
	ujs,_ := json.Marshal(u1)
	u2 := models.User{}
	_ = u2.UnmarshalJSON(ujs)
	fmt.Println(u2,reflect.TypeOf(u2))
}
ç»“æœï¼š
{teststruct 12} models.User</p>

<p>å›› æ€§èƒ½å¯¹æ¯”</p>

<p>é€šè¿‡Benchmarkæ¥å¯¹æ¯”è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ—¶easyjsonä¸åŸjsonçš„æ€§èƒ½</p>

<p>func BenchmarkEasyJson(t *testing.B)  {
	u1 := models.User{â€œteststructâ€,12}
	u2 := models.User{}
	for i:=0;i&lt;t.N;i++{
		ujs,_ := u1.MarshalJSON()
		_ = u2.UnmarshalJSON(ujs)
	}
}</p>

<p>func BenchmarkJson(t *testing.B)  {
	u1 := models.User{â€œteststructâ€,12}
	u2 := models.User{}
	for i:=0;i&lt;t.N;i++{
		ujs,_ := json.Marshal(u1)
		_ = json.Unmarshal(ujs,u2)
	}
}
è¿è¡Œ</p>

<p>go test -bench=â€.â€
1
ç»“æœï¼š</p>

<p>goos: linux
goarch: amd64
pkg: tests/src
BenchmarkEasyJson-4      5000000               366 ns/op
BenchmarkJson-4          1000000              1146 ns/op
PASS</p>

<p>æ€§èƒ½å¤§çº¦ä¸ºåŸjsonåŒ…çš„ä¸‰å€å·¦å³</p>
:ET