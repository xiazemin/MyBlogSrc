I"ô<p>github.com/olivere/elastic
options := []elastic.ClientOptionFunc{
	elastic.SetURL(â€œhttp://xxxxxxx:9200â€),
	elastic.SetSniff(true),      //æ˜¯å¦å¼€å¯é›†ç¾¤å—…æ¢
	elastic.SetHealthcheckInterval(10 * time.Second), //è®¾ç½®ä¸¤æ¬¡è¿è¡ŒçŠ¶å†µæ£€æŸ¥ä¹‹é—´çš„é—´éš”, é»˜è®¤60s
	elastic.SetGzip(false),  //å¯ç”¨æˆ–ç¦ç”¨gzipå‹ç¼©
	elastic.SetErrorLog(log.New(os.Stderr, â€œELASTIC â€œ, log.LstdFlags)),  //ERRORæ—¥å¿—è¾“å‡ºé…ç½®
	elastic.SetInfoLog(log.New(os.Stdout, â€œâ€, log.LstdFlags)),  //INFOçº§åˆ«æ—¥å¿—è¾“å‡ºé…ç½®
}
options = append(options, elastic.SetBasicAuth(
	â€œxxxxâ€,            //è´¦å·
	â€œxxxxxxxxxxxxxxâ€,  //å¯†ç 
))
con, err := elastic.NewClient(optionsâ€¦)
<!-- more -->
1 åˆ›å»ºç´¢å¼•
_, err = conf.ES().CreateIndex(indexName).BodyJson(mapping).Do(context.Background())</p>

<p>2 åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨
exists, err := conf.ES().IndexExists(indexName).Do(context.Background())</p>

<p>3 æ›´æ–°ç´¢å¼•
_, err = conf.ES().PutMapping().
	Index(indexName).
	Type(â€œ_docâ€).
	BodyJson(mapping).
	Do(context.Background())</p>

<p>4 åˆ é™¤ç´¢å¼•
_, err = conf.ES().DeleteIndex(indexName).Do(context.Background())</p>

<p>5 æ•°æ®è¿ç§»
type mi = map[string]interface{}
_, err = conf.ES().Reindex().Body(mi{
	â€œsourceâ€: mi{
		â€œindexâ€: oldIndexName,
	},
	â€œdestâ€: mi{
		â€œindexâ€: newIndexName,
	},
}).Do(context.Background())</p>

<p>6 è®¾ç½®åˆ«å
_, err = conf.ES().Alias().Action(
	elastic.NewAliasAddAction(oldIndexName).Index(newIndexName),
).Do(context.Background())</p>

<p>7 æ–°å¢æˆ–è¦†ç›–æ•°æ®(å•æ¡)
_, err = conf.ES().Index().
	Index(indexName).
	Type(â€œ_docâ€).
	// idä¸ºå­—ç¬¦ä¸², åˆ›å»ºä¸€æ¡æ­¤idçš„æ•°æ®æˆ–è¦†ç›–å·²æœ‰æ­¤idçš„è®°å½•
	// dataä¸ºç»“æ„ä½“æˆ–map, å½“ç„¶ç»“æ„éœ€è¦è·Ÿç´¢å¼•çš„mappingç±»å‹ä¿æŒä¸€è‡´
	Id(id).BodyJson(data).
	Do(context.Background())</p>

<p>8 æ ¹æ®idæ–°å¢æˆ–æ›´æ–°æ•°æ®(å•æ¡)
_, err = conf.ES().Update().
	Index(t.index()).
	Type(â€œ_docâ€).
	Id(id).
	// dataä¸ºç»“æ„ä½“æˆ–map, éœ€æ³¨æ„çš„æ˜¯å¦‚æœä½¿ç”¨ç»“æ„ä½“é›¶å€¼ä¹Ÿä¼šå»æ›´æ–°åŸè®°å½•
	Upsert(data).
	// true æ— åˆ™æ’å…¥, æœ‰åˆ™æ›´æ–°, è®¾ç½®ä¸ºfalseæ—¶è®°å½•ä¸å­˜åœ¨å°†æŠ¥é”™
	DocAsUpsert(true). 
	Do(context.Background())</p>

<p>9,æ ¹æ®idæ–°å¢æˆ–æ›´æ–°æ•°æ®(æ‰¹é‡)
bulkRequest := conf.ES().Bulk()
// data map[int]interface{}, keyä¸ºid, valueä¸ºè¦æ›´æ–°çš„æ•°æ®
for id, v := range data {
	doc := elastic.NewBulkUpdateRequest().
		Index(t.index()).
		Type(â€œ_docâ€).
		Id(strconv.Itoa(id)).
		Doc(v).
		// true æ— åˆ™æ’å…¥, æœ‰åˆ™æ›´æ–°, è®¾ç½®ä¸ºfalseæ—¶è®°å½•ä¸å­˜åœ¨å°†æŠ¥é”™
		DocAsUpsert(true)
	bulkRequest.Add(doc)
}
bulkResponse, err := bulkRequest.Do(context.Background())
if err != nil {
	return
}
// è·å–æ“ä½œå¤±è´¥çš„è®°å½•
bad := bulkResponse.Failed()
if len(bad) &gt; 0 {
	s, _ := jsoniter.MarshalToString(bad)
	err = errors.New(â€œéƒ¨åˆ†è®°å½•æ›´æ–°å¤±è´¥ â€œ + s)
}</p>

<p>10.æ ¹æ®æ¡ä»¶æ›´æ–°æ•°æ®
_, err = conf.ES().UpdateByQuery().
	Index(indexName).
	Type(â€œ_docâ€).
	//æŸ¥è¯¢æ¡ä»¶, è¯¦ç»†é…ç½®æŸ¥è¯¢æ¡ä»¶è¯·æŸ¥çœ‹ç« èŠ‚ 5
	Query(query).
	//è¦æ‰§è¡Œçš„æ›´æ–°æ“ä½œ, è¯¦ç»†é…ç½®è¯·æŸ¥çœ‹ç« èŠ‚ 6åŠ7.1
	Script(script).
	Do(context.Background())</p>

<ol>
  <li>æŸ¥è¯¢
_, err = conf.ES().Search().
Index(indexName).
//åç§»é‡
From(0).
//è¿”å›æ•°æ®çš„æ¡æ•°
Size(10).
//æŒ‡å®šè¿”å›æ•°æ®çš„å­—æ®µ(æ­¤å¤„æŒ‡å®šè¿”å›idå’Œname), å…¨éƒ¨è¿”å›åˆ™æ— éœ€è®¾ç½®
FetchSourceContext(elastic.NewFetchSourceContext(true).Include(â€œidâ€, â€œnameâ€)).
//æŸ¥è¯¢æ¡ä»¶, è¯¦ç»†é…ç½®æŸ¥è¯¢æ¡ä»¶è¯·æŸ¥çœ‹ç« èŠ‚ 5
Query(query).
//æŒ‰ç…§idå‡åºæ’åº, æ— éœ€æ’åºåˆ™å¯è·³è¿‡æ­¤è®¾ç½®, å¤šä¸ªSortä¼šæŒ‰å…ˆåé¡ºåºä¾æ¬¡ç”Ÿæ•ˆ
Sort(â€œidâ€, true).
//è‡ªå®šä¹‰æ’åºè§„åˆ™, è¯¦ç»†å†™æ³•è¯·æŸ¥çœ‹ç« èŠ‚ 6åŠ7.2
SortBy(sorter).
Do(context.Background())</li>
</ol>

<p>https://blog.csdn.net/p1049990866/article/details/117254708</p>
:ET