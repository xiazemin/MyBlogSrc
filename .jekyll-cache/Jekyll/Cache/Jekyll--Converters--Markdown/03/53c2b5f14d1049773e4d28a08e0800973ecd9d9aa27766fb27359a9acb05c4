I"ß<p>sqlcå¯ä»¥æ ¹æ®æˆ‘ä»¬ç¼–å†™çš„ SQL è¯­å¥ç”Ÿæˆç±»å‹å®‰å…¨çš„ã€åœ°é“çš„ Go æ¥å£ä»£ç ï¼Œæˆ‘ä»¬è¦åšçš„åªæ˜¯è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚ä½†æ˜¯sqlc ä¸æ”¯æŒin è¯­æ³•ï¼Œå†™ä»£ç æ¯”è¾ƒç—›è‹¦ï¼Œæ‰€ä»¥å¯¹sqlcè¿›è¡Œäº†ä¿®æ”¹ï¼Œæ·»åŠ äº†inè¯­æ³•æ”¯æŒçš„åŠŸèƒ½ã€‚</p>

<p>é¡¹ç›®åœ°å€ï¼š</p>

<p>æºç ï¼šhttps://github.com/xiazemin/sqlc</p>

<p>å®ä¾‹ï¼šhttps://github.com/xiazemin/sqlc_study
<!-- more -->
å®‰è£…</p>

<p>go get -u github.com/xiazemin/sqlc</p>

<p>ä½¿ç”¨</p>

<p>https://github.com/kyleconroy/sqlc çš„sql æ˜¯æ²¡æ³•è§£æinæ“ä½œçš„</p>

<p>æœ¬æ–‡å®ç°çš„sqlc æ”¯æŒå¤æ‚çš„in æ“ä½œæ¯”å¦‚</p>

<p>â€“ name: GetOneAuthor :one
SELECT * FROM authors where  id in (?)  and bio=? and  name in (?)  limit 1;</p>

<p>ç”Ÿæˆçš„ç›¸å…³ä»£ç å¦‚ä¸‹</p>

<p>const getOneAuthor = <code class="language-plaintext highlighter-rouge">-- name: GetOneAuthor :one
SELECT id, name, bio FROM authors where  id in (?)  and bio=? and  name in (?)  limit 1
</code></p>

<p>type GetOneAuthorParams struct {
  ID []int32</p>

<p>Bio sql.NullString</p>

<p>Name []string
}</p>

<p>func stringSlice2interface(l []string) []interface{} {
  v := make([]interface{}, len(l))
  for i, val := range l {
    v[i] = val</p>

<p>}
  return v
}</p>

<p>func (q *Queries) GetOneAuthor(ctx context.Context, arg GetOneAuthorParams) (Author, error) {</p>

<p>getOneAuthor := getOneAuthor</p>

<p>{
    param := â€œ?â€
    for i := 0; i &lt; len(arg.ID)-1; i++ {
      param += â€œ,?â€
    }
    getOneAuthor = replaceNth(getOneAuthor, â€œ(?)â€, â€œ(â€œ+param+â€)â€, 1)
  }</p>

<p>{
    param := â€œ?â€
    for i := 0; i &lt; len(arg.Name)-1; i++ {
      param += â€œ,?â€
    }
    getOneAuthor = replaceNth(getOneAuthor, â€œ(?)â€, â€œ(â€œ+param+â€)â€, 1)
  }</p>

<p>row := q.db.QueryRowContext(ctx, getOneAuthor, append(append(int32Slice2interface(arg.ID), arg.Bio), stringSlice2interface(arg.Name)â€¦)â€¦)
  var i Author
  err := row.Scan(&amp;i.ID, &amp;i.Name, &amp;i.Bio)
  return i, err
}
å®Œå…¨å…¼å®¹ä»¥å‰çš„sqlcï¼Œä¸€é”®ç”Ÿæˆæ”¯æŒin è¯­æ³•çš„ä»£ç ï¼Œä¸ç”¨æ‰‹åŠ¨ç»´æŠ¤</p>

<p>å¯¹å­æŸ¥è¯¢ç±»ä¼¼</p>

<p>https://github.com/pingcap/parser</p>

<p>https://github.com/pingcap/parser/blob/master/parser.y
https://github.com/pingcap/parser/blob/master/docs/quickstart.md</p>

:ET