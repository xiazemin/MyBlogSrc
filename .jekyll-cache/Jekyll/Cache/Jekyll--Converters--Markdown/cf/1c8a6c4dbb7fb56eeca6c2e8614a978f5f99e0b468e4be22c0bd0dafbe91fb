I"¦<p>æ‰©å±•å¯èƒ½éœ€è¦è°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°æˆ–è€…å…¶ä»–æ‰©å±•å®šä¹‰çš„å†…éƒ¨å‡½æ•°,PHPæä¾›çš„å‡½æ•°è°ƒç”¨APIçš„ä½¿ç”¨:</p>

<p>ZEND_API int call_user_function(HashTable *function_table, zval *object,zval *function_name, zval *retval_ptr, uint32_t param_count, zval params[
]);
å„å‚æ•°çš„å«ä¹‰ï¼š</p>

<p><strong>function_table:</strong> å‡½æ•°ç¬¦å·è¡¨ï¼Œæ™®é€šå‡½æ•°æ˜¯EG(function_table)ï¼Œå¦‚æœæ˜¯æˆå‘˜æ–¹æ³•åˆ™æ˜¯zend_class_entry.function_table
object: è°ƒç”¨æˆå‘˜æ–¹æ³•æ—¶çš„å¯¹è±¡
<strong>function_name:</strong> è°ƒç”¨çš„å‡½æ•°åç§°
<strong>retval_ptr:</strong> å‡½æ•°è¿”å›å€¼åœ°å€
<strong>param_count:</strong> å‚æ•°æ•°é‡
params: å‚æ•°æ•°ç»„
ä»æ¥å£çš„å®šä¹‰çœ‹å…¶ä½¿ç”¨è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä¸éœ€è¦æˆ‘ä»¬å…³å¿ƒæ‰§è¡Œè¿‡ç¨‹ä¸­å„é˜¶æ®µå¤æ‚çš„æ“ä½œã€‚
<!-- more --></p>

<p>ä¸‹é¢ä»ä¸€ä¸ªå…·ä½“çš„ä¾‹å­çœ‹ä¸‹å…¶ä½¿ç”¨ï¼š</p>

<p>ï¼ˆ1ï¼‰åœ¨PHPä¸­å®šä¹‰äº†ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œå°†å‚æ•°$iåŠ ä¸Š100åè¿”å›ï¼š</p>

<p>function mySum($i){
    return $i+100;
}</p>

<p>ï¼ˆ2ï¼‰æ¥ä¸‹æ¥åœ¨æ‰©å±•ä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼š</p>

<p>PHP_FUNCTION(my_func_2)
{
Â Â  Â zend_long i;
Â Â  Â zval call_func_name, call_func_ret, call_func_params[1];
Â Â  Â uint32_t call_func_param_cnt = 1;
Â Â  Â zend_string *call_func_str;
Â Â  Â char *func_name = â€œmySumâ€;
Â Â  Â if(zend_parse_parameters(ZEND_NUM_ARGS(), â€œlâ€, &amp;i) == FAILURE){
Â Â  Â Â Â  Â RETURN_FALSE;
Â Â  Â }
Â Â  Â //åˆ†é…zend_string:è°ƒç”¨å®Œéœ€è¦é‡Šæ”¾
Â Â  Â call_func_str = zend_string_init(func_name, strlen(func_name), 0);
Â Â  Â //è®¾ç½®åˆ°zval
Â Â  Â ZVAL_STR(&amp;call_func_name, call_func_str);
Â Â  Â 
Â Â  Â //è®¾ç½®å‚æ•°
Â Â  Â ZVAL_LONG(&amp;call_func_params[0], i);
Â Â  Â 
Â Â  Â //call
Â Â  Â if(SUCCESS != call_user_function(EG(function_table), NULL, &amp;call_func_name, &amp;call_func_ret, call_func_param_cnt, call_func_params)){
Â Â  Â Â Â  Â zend_string_release(call_func_str);
Â Â  Â Â Â  Â RETURN_FALSE;
Â Â  Â }
Â Â  Â 
Â Â  Â zend_string_release(call_func_str);
Â Â  Â RETURN_LONG(Z_LVAL(call_func_ret));
}
ï¼ˆ3ï¼‰æœ€åè°ƒç”¨è¿™ä¸ªå†…éƒ¨å‡½æ•°ï¼š</p>

<p>function mySum($i){
    return $i+100;
}
echo my_func_2(60);
===========[output]===========
160
call_user_function() å¹¶ä¸æ˜¯åªèƒ½è°ƒç”¨PHPè„šæœ¬ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œå†…æ ¸æˆ–å…¶å®ƒæ‰©å±•æ³¨å†Œ
çš„å‡½æ•°åŒæ ·å¯ä»¥é€šè¿‡æ­¤å‡½æ•°è°ƒç”¨ï¼Œæ¯”å¦‚ï¼šarray_merge()ã€‚</p>

<p>PHP_FUNCTION(my_func_1)
{
Â Â  Â zend_array *arr1, *arr2;
Â Â  Â zval call_func_name, call_func_ret, call_func_params[2];
Â Â  Â uint32_t call_func_param_cnt = 2;
Â Â  Â zend_string *call_func_str;
Â Â  Â char *func_name = â€œarray_mergeâ€;
Â Â  Â if(zend_parse_parameters(ZEND_NUM_ARGS(), â€œhhâ€, &amp;arr1, &amp;arr2) == FAILURE){
Â Â  Â Â Â  Â RETURN_FALSE;
Â Â  Â }
Â Â  Â 
Â Â  Â //åˆ†é…zend_string
Â Â  Â call_func_str = zend_string_init(func_name, strlen(func_name), 0);
Â Â  Â //è®¾ç½®åˆ°zval
Â Â  Â ZVAL_STR(&amp;call_func_name, call_func_str);
Â Â  Â 
Â Â  Â ZVAL_ARR(&amp;call_func_params[0], arr1);
Â Â  Â ZVAL_ARR(&amp;call_func_params[1], arr2);
Â Â  Â 
Â Â  Â if(SUCCESS != call_user_function(EG(function_table), NULL, &amp;call_func_name, &amp;call_func_ret, call_func_param_cnt, call_func_params)){
Â Â  Â zend_string_release(call_func_str);
Â Â  Â RETURN_FALSE;
Â Â  Â }
Â Â  Â zend_string_release(call_func_str);
Â Â  Â RETURN_ARR(Z_ARRVAL(call_func_ret));
}
$arr1 = array(1,2);
$arr2 = array(3,4);
$arr = my_func_1($arr1, $arr2);
var_dump($arr);</p>

<p>https://blog.csdn.net/rorntuck7/article/details/86240202</p>
:ET