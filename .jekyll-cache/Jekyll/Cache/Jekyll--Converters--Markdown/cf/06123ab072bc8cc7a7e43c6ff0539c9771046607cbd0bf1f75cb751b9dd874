I"¦D<p>åœ¨æŸä¸ªé¡¹ç›®éœ€è¦æ”¯æŒå¤šå¹³å°æ—¶ï¼ŒæŸä¸ªåŠŸèƒ½å¯èƒ½éœ€è¦é’ˆå¯¹ä¸åŒå¹³å°ç¼–å†™ä¸“å±è¿™ä¸ªå¹³å°çš„å…·ä½“å®ç°ã€‚ åœ¨c/c++ä¸­ï¼Œä¸åŒå¹³å°çš„å®ç°æˆ–è€…æŸä¸ªå¹³å°çš„ç‰¹æ€§å¾€å¾€é€šè¿‡#if, #else, #endifè¿™ç±»é¢„å¤„ç†æŒ‡ä»¤æ¥é…åˆ äº¤å‰ç¼–è¯‘è¾¾åˆ°ã€‚</p>

<p>go build -tags
goæŸç§ç¨‹åº¦ä¸Šä¹Ÿå¯ä»¥æ”¯æŒæ¡ä»¶ç¼–è¯‘ã€‚goä¸­çš„æ¡ä»¶ç¼–è¯‘æ˜¾å¾—æ ¼å¤–çš„éšè”½ï¼Œå¹¶ä¸”æ¡ä»¶ç¼–è¯‘ä¹Ÿä»…é™äºåŒ…çº§åˆ«ã€‚</p>

<p>å‡è®¾æŸä¸ªæœåŠ¡ï¼Œå¯¹å¤–æ—¢æä¾›HTTPæœåŠ¡ï¼Œä¹Ÿå¯é€‰çš„æä¾›grpcæœåŠ¡ã€‚ä»¥æ­¤ä¸ºä¾‹æ¥è¯´æ˜å¦‚ä½•æ”¯æŒå¯é€‰çš„grpcã€‚</p>

<p>goæ¡ä»¶ç¼–è¯‘ä»¥ä¸€è¡Œç‰¹æ®Šçš„ // +build æ³¨é‡Šè¡Œå¼€å§‹ã€‚</p>

<p>ä¸ºäº†è·ŸåŒ…æ–‡æ¡£åŒºåˆ†å¼€ï¼Œ// +buildè¡Œåé¢å¿…é¡»è·Ÿä¸€ä¸ªç©ºç™½è¡Œã€‚</p>

<p>/<em>é”™è¯¯: +buildä¸‹æ²¡æœ‰ç”¨ç©ºç™½è¡Œåˆ†éš”ï¼Œbuild tagæ— æ³•ç”Ÿæ•ˆ</em>/
// +build enable_rpc 
func init(){
    go StartRPCForever()
}</p>

<p>/<em>æ­£ç¡®</em>/
// +build enable_rpc</p>

<p>func init(){
    go StartRPCForever()  <br />
}</p>

<p>func StartRPCForever(){
    // â€¦
}
åœ¨ç¼–è¯‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œ: go build -tags=enable_rpcæ¥å¯åŠ¨RPCæœåŠ¡ã€‚</p>

<p>+buildåé¢çš„tagä¹Ÿæœ‰è®²ç©¶: ä»¥</p>

<p>// +build linux,386 darwin,!cgo ä¸ºä¾‹:
go buildå­å‘½ä»¤å°†å…¶è§£é‡Šæˆ:</p>

<p>(linux AND 386) OR (darwin AND (NOT cgo))
å½“+buildä»¥å¤šè¡Œå‡ºç°æ—¶ï¼Œè¿™äº›+buildä¹‹åçš„æ ‡ç­¾æ„æˆANDå…³ç³»:</p>

<p>// +build linux darwin
// +build 386
go buildå­å‘½ä»¤å°†å…¶è§£é‡Šä¸º:</p>

<p>(linux OR darwin) AND 386
<!-- more -->
The mistake I made is:</p>

<p>// +build !go1.4
package xxx
Where should really have an empty line between these two lines:</p>

<p>// +build !go1.4</p>

<p>package xxx</p>

<p>https://github.com/nange/blog/issues/26</p>

<p>go build -tags çš„ä½œç”¨æ˜¯åœ¨buildè¿‡ç¨‹ä¸­ï¼Œä¼ å…¥æŸäº›å‚æ•°ï¼Œç”¨äºç¡®å®šå“ªäº›æ–‡ä»¶ç”¨äºç¼–è¯‘ï¼Œå“ªäº›æ–‡ä»¶ä¸å‚ä¸ç¼–è¯‘ç­‰ã€‚</p>

<p>ä½¿ç”¨æ–¹æ³•
æ„å»ºçº¦æŸä»¥ä¸€è¡Œ+buildå¼€å§‹çš„æ³¨é‡Šã€‚åœ¨+buildä¹‹ååˆ—å‡ºäº†ä¸€äº›æ¡ä»¶ï¼Œåœ¨è¿™äº›æ¡ä»¶æˆç«‹æ—¶ï¼Œè¯¥æ–‡ä»¶åº”åŒ…å«åœ¨ç¼–è¯‘çš„åŒ…ä¸­ï¼›
çº¦æŸå¯ä»¥å‡ºç°åœ¨ä»»ä½•æºæ–‡ä»¶ä¸­ï¼Œä¸é™äºgoæ–‡ä»¶ï¼›
+buildå¿…é¡»å‡ºç°åœ¨packageè¯­å¥ä¹‹å‰ï¼Œ+buildæ³¨é‡Šä¹‹ååº”è¦æœ‰ä¸€ä¸ªç©ºè¡Œã€‚
// +build debug</p>

<p>package main</p>

<p>import â€œfmtâ€</p>

<p>func main() {
 fmt.Println(â€œHello World!â€)
}
è¯­æ³•è§„åˆ™
åªå…è®¸æ˜¯å­—æ¯æ•°å­—æˆ–_
å¤šä¸ªæ¡ä»¶ä¹‹é—´ï¼Œç©ºæ ¼è¡¨ç¤ºORï¼›é€—å·è¡¨ç¤ºANDï¼›å¹å·(!)è¡¨ç¤ºNOT
ä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ª+buildï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯ANDã€‚å¦‚ï¼š
// +build linux darwin
// +build 386
ç­‰ä»·äº
// +build (linux OR darwin) AND 386
é¢„å®šä¹‰äº†ä¸€äº›æ¡ä»¶ï¼š
runtime.GOOSã€runtime.GOARCHã€compilerï¼ˆgcæˆ–gccgoï¼‰ã€cgoã€context.BuildTagsä¸­çš„å…¶ä»–å•è¯
å¦‚æœä¸€ä¸ªæ–‡ä»¶åï¼ˆä¸å«åç¼€ï¼‰ï¼Œä»¥ *_GOOS, *_GOARCH, æˆ– *_GOOS_GOARCHç»“å°¾ï¼Œå®ƒä»¬éšå¼åŒ…å«äº† æ„å»ºçº¦æŸ
å½“ä¸æƒ³ç¼–è¯‘æŸä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥åŠ ä¸Š// +build ignoreã€‚è¿™é‡Œçš„ignoreå¯ä»¥æ˜¯å…¶ä»–å•è¯ï¼Œåªæ˜¯ignoreæ›´èƒ½è®©äººçŸ¥é“ä»€ä¹ˆæ„æ€
æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹go/build/build.goæ–‡ä»¶ä¸­shouldBuildå’Œmatchæ–¹æ³•ã€‚</p>

<p>åº”ç”¨å®ä¾‹
display_hash.goï¼š</p>

<p>// +build hash !display_alternatives</p>

<p>package main</p>

<p>import â€œfmtâ€</p>

<p>type DisplayName string</p>

<p>func Print(name DisplayName) {
    fmt.Printf(â€œ%s\nâ€, name)
}</p>

<p>func MakeDisplayName(name string) DisplayName {
    return DisplayName(name)
}
ç¼–è¯‘display_hash.go:
ç¼–è¯‘æ‰§è¡Œè¿‡ç¨‹ go build -tags â€œhash â€œ</p>

<p>å½“æˆ‘ä»¬ç¼–å†™çš„goä»£ç ä¾èµ–ç‰¹å®šå¹³å°æˆ–è€…cpuæ¶æ„çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç»™å‡ºä¸åŒçš„å®ç°</p>

<p>Cè¯­è¨€æœ‰é¢„å¤„ç†å™¨ï¼Œå¯ä»¥é€šè¿‡å®æˆ–è€…#defineåŒ…å«ç‰¹å®šå¹³å°æŒ‡å®šçš„ä»£ç è¿›è¡Œç¼–è¯‘</p>

<p>ä½†æ˜¯Goæ²¡æœ‰é¢„å¤„ç†å™¨ï¼Œä»–æ˜¯é€šè¿‡ go/buildåŒ… é‡Œå®šä¹‰çš„tagså’Œå‘½åçº¦å®šæ¥è®©Goçš„åŒ…å¯ä»¥ç®¡ç†ä¸åŒå¹³å°çš„ä»£ç </p>

<p>è¿™ç¯‡æ–‡ç« å°†è®²è¿°Goçš„æ¡ä»¶ç¼–è¯‘ç³»ç»Ÿæ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¹¶ä¸”é€šè¿‡å®ä¾‹æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨</p>

<ol>
  <li>é¢„å¤‡çŸ¥è¯†ï¼šgo listå‘½ä»¤çš„ä½¿ç”¨</li>
</ol>

<p>åœ¨è®²æ¡ä»¶ç¼–è¯‘ä¹‹å‰éœ€è¦äº†è§£go listçš„ç®€å•ç”¨æ³•</p>

<p>go listè®¿é—®æºæ–‡ä»¶é‡Œé‚£äº›èƒ½å¤Ÿå½±å“ç¼–è¯‘è¿›ç¨‹å†…éƒ¨çš„æ•°æ®ç»“æ„</p>

<p>go listä¸go build ,test,installå¤§éƒ¨åˆ†çš„å‚æ•°ç›¸åŒï¼Œä½†æ˜¯go listä¸ä¼šæ‰§è¡Œç¼–è¯‘æ“ä½œã€‚ä½¿ç”¨-få‚æ•°å¯ä»¥è®©æˆ‘ä»¬æä¾›çš„text/templateé‡Œçš„ä»£ç åœ¨åŒ…å«go/build.Packageä¸Šä¸‹æ–‡çš„ç¯å¢ƒé‡Œæ­£ç¡®æ‰§è¡Œï¼ˆå°±æ˜¯è®©go/build.Packageé‡Œçš„ä¸Šä¸‹æ–‡å»æ ¼å¼åŒ– text/templateé‡Œè¿™ç§æ ¼å¼ â€˜{{.GoFiles}}â€˜é‡Œçš„å ä½ç¬¦ï¼Œå†™è¿‡http serverç¨‹åºçš„åŒå­¦çœ‹åˆ°åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼‰</p>

<p>ä½¿ç”¨æ ¼å¼åŒ–å‚æ•°ï¼Œæˆ‘ä»¬èƒ½é€šè¿‡go listè·å–å°†ä¼šè¢«ç¼–è¯‘çš„æ–‡ä»¶å</p>

<p>% go list -f â€˜{{.GoFiles}}â€™ os/exec
[exec.go lp_unix.go]
ä¸Šé¢è¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬ç”¨go listæ¥æŸ¥çœ‹åœ¨linux/armå¹³å°ä¸‹ os/execåŒ…é‡Œæœ‰å“ªäº›æ–‡ä»¶å°†ä¼šè¢«ç¼–è¯‘ã€‚</p>

<p>ç»“æœæ˜¾ç¤ºï¼šexec.goåŒ…å«äº†é€šç”¨çš„ä»£ç åœ¨æ‰€æœ‰çš„å¹³å°ä¸‹å¯ç”¨ï¼Œlp_unix.goåŒ…å«äº†*nixç³»ç»Ÿé‡Œçš„exec.LookPath</p>

<p>åœ¨windowsç³»ç»Ÿä¸‹è¿è¡ŒåŒæ ·çš„å‘½ä»¤ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>

<p>C:\go&gt; go list -f â€˜{{.GoFiles}}â€™ os/exec
[exec.go lp_windows.go]
ä¸Šé¢è¿™ä¸ªä¾‹å­æ˜¯Go æ¡ä»¶ç¼–è¯‘ç³»ç»Ÿçš„ä¸¤ä¸ªéƒ¨åˆ†ï¼Œç§°ä¹‹ä¸ºï¼šç¼–è¯‘çº¦æŸï¼Œä¸‹é¢å°†è¯¦ç»†æè¿°</p>

<ol>
  <li>ç¬¬ä¸€ç§æ¡ä»¶ç¼–è¯‘çš„æ–¹æ³•ï¼šç¼–è¯‘æ ‡ç­¾</li>
</ol>

<p>åœ¨æºä»£ç é‡Œæ·»åŠ æ ‡æ³¨ï¼Œé€šå¸¸ç§°ä¹‹ä¸ºç¼–è¯‘æ ‡ç­¾( build tag)</p>

<p>ç¼–è¯‘æ ‡ç­¾æ˜¯åœ¨å°½é‡é è¿‘æºä»£ç æ–‡ä»¶é¡¶éƒ¨çš„åœ°æ–¹ç”¨æ³¨é‡Šçš„æ–¹å¼æ·»åŠ </p>

<p>go buildåœ¨æ„å»ºä¸€ä¸ªåŒ…çš„æ—¶å€™ä¼šè¯»å–è¿™ä¸ªåŒ…é‡Œçš„æ¯ä¸ªæºæ–‡ä»¶å¹¶ä¸”åˆ†æç¼–è¯‘ä¾¿ç­¾ï¼Œè¿™äº›æ ‡ç­¾å†³å®šäº†è¿™ä¸ªæºæ–‡ä»¶æ˜¯å¦å‚ä¸æœ¬æ¬¡ç¼–è¯‘</p>

<p>ç¼–è¯‘æ ‡ç­¾æ·»åŠ çš„è§„åˆ™ï¼ˆé™„ä¸ŠåŸæ–‡ï¼‰ï¼š</p>

<ol>
  <li>a build tag is evaluated as the OR of space-separated options</li>
  <li>each option evaluates as the AND of its comma-separated terms</li>
  <li>each term is an alphanumeric word or, preceded by !, its negation</li>
</ol>

<p>1). ç¼–è¯‘æ ‡ç­¾ç”±ç©ºæ ¼åˆ†éš”çš„ç¼–è¯‘é€‰é¡¹(options)ä»¥â€æˆ–â€çš„é€»è¾‘å…³ç³»ç»„æˆ</p>

<p>2). æ¯ä¸ªç¼–è¯‘é€‰é¡¹ç”±é€—å·åˆ†éš”çš„æ¡ä»¶é¡¹ä»¥é€»è¾‘â€ä¸â€çš„å…³ç³»ç»„æˆ</p>

<p>3). æ¯ä¸ªæ¡ä»¶é¡¹çš„åå­—ç”¨å­—æ¯+æ•°å­—è¡¨ç¤ºï¼Œåœ¨å‰é¢åŠ !è¡¨ç¤ºå¦å®šçš„æ„æ€</p>

<p>ä¾‹å­ï¼ˆç¼–è¯‘æ ‡ç­¾è¦æ”¾åœ¨æºæ–‡ä»¶é¡¶éƒ¨ï¼‰</p>

<p>// +build darwin freebsd netbsd openbsd
è¿™ä¸ªå°†ä¼šè®©è¿™ä¸ªæºæ–‡ä»¶åªèƒ½åœ¨æ”¯æŒkqueueçš„BSDç³»ç»Ÿé‡Œç¼–è¯‘</p>

<p>ä¸€ä¸ªæºæ–‡ä»¶é‡Œå¯ä»¥æœ‰å¤šä¸ªç¼–è¯‘æ ‡ç­¾ï¼Œå¤šä¸ªç¼–è¯‘æ ‡ç­¾ä¹‹é—´æ˜¯é€»è¾‘â€ä¸â€çš„å…³ç³»</p>

<p>// +build linux darwin
// +build 386
è¿™ä¸ªå°†é™åˆ¶æ­¤æºæ–‡ä»¶åªèƒ½åœ¨ linux/386æˆ–è€…darwin/386å¹³å°ä¸‹ç¼–è¯‘</p>

<p>å…³äºæ³¨é‡Šçš„è¯´æ˜</p>

<p>åˆšå¼€å§‹ä½¿ç”¨ç¼–è¯‘æ ‡ç­¾ç»å¸¸ä¼šçŠ¯ä¸‹é¢è¿™ä¸ªé”™è¯¯</p>

<p>// +build !linux
package mypkg // wrong
è¿™ä¸ªä¾‹å­é‡Œçš„ç¼–è¯‘æ ‡ç­¾å’ŒåŒ…çš„å£°æ˜ä¹‹é—´æ²¡æœ‰ç”¨ç©ºè¡Œéš”å¼€ï¼Œè¿™æ ·ç¼–è¯‘æ ‡ç­¾ä¼šè¢«å½“åšåŒ…å£°æ˜çš„æ³¨é‡Šè€Œä¸æ˜¯ç¼–è¯‘æ ‡ç­¾ä»è€Œè¢«å¿½ç•¥æ‰</p>

<p>ä¸‹é¢è¿™ä¸ªæ˜¯æ­£ç¡®çš„æ ‡ç­¾çš„ä¹¦å†™æ–¹å¼ï¼Œæ ‡ç­¾çš„ç»“å°¾æ·»åŠ ä¸€ä¸ªç©ºè¡Œè¿™æ ·æ ‡ç­¾å°±ä¸ä¼šå½“åšå…¶ä»–å£°æ˜çš„æ³¨é‡Š</p>

<p>// +build !linux</p>

<p>package mypkg // correct</p>

<p>ç”¨go vetå‘½ä»¤ä¹Ÿå¯ä»¥æ£€æµ‹åˆ°è¿™ä¸ªç¼ºå°‘ç©ºè¡Œçš„é”™è¯¯ï¼ŒåˆæœŸå¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤æ¥é¿å…ç¼ºå°‘ç©ºè¡Œçš„é”™è¯¯</p>

<p>% go vet mypkg
mypkg.go:1: +build comment appears too late in file
exit status 1</p>

<p>ä½œä¸ºå‚è€ƒï¼Œä¸‹é¢çš„ä¾‹å­å°†licenceå£°æ˜,ç¼–è¯‘æ ‡ç­¾å’ŒåŒ…å£°æ˜æ”¾åœ¨ä¸€èµ·ï¼Œè¯·å¤§å®¶æ³¨æ„åˆ†è¾¨</p>

<p>% head headspin.go 
// Copyright 2013 Way out enterprises. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.</p>

<p>// +build someos someotheros thirdos,!amd64</p>

<p>// Package headspin implements calculates numbers so large
// they will make your head spin.
package headspin</p>

<ol>
  <li>ç¬¬äºŒç§æ¡ä»¶ç¼–è¯‘æ–¹æ³•ï¼šæ–‡ä»¶åç¼€</li>
</ol>

<p>è¿™ä¸ªæ–¹æ³•é€šè¿‡æ”¹å˜æ–‡ä»¶åçš„åç¼€æ¥æä¾›æ¡ä»¶ç¼–è¯‘ï¼Œè¿™ç§æ–¹æ¡ˆæ¯”ç¼–è¯‘æ ‡ç­¾è¦ç®€å•ï¼Œgo/buildå¯ä»¥åœ¨ä¸è¯»å–æºæ–‡ä»¶çš„æƒ…å†µä¸‹å°±å¯ä»¥å†³å®šå“ªäº›æ–‡ä»¶ä¸éœ€è¦å‚ä¸ç¼–è¯‘</p>

<p>æ–‡ä»¶å‘½åçº¦å®šå¯ä»¥åœ¨go/build åŒ…é‡Œæ‰¾åˆ°è¯¦ç»†çš„è¯´æ˜ï¼Œç®€å•æ¥è¯´å¦‚æœä½ çš„æºæ–‡ä»¶åŒ…å«åç¼€ï¼š<em>$GOOS.goï¼Œé‚£ä¹ˆè¿™ä¸ªæºæ–‡ä»¶åªä¼šåœ¨è¿™ä¸ªå¹³å°ä¸‹ç¼–è¯‘ï¼Œ</em>$GOARCH.goä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™ä¸¤ä¸ªåç¼€å¯ä»¥ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œä½†æ˜¯è¦æ³¨æ„é¡ºåºï¼š<em>$GOOS</em>$GOARCH.goï¼Œ    ä¸èƒ½åè¿‡æ¥ç”¨ï¼š<em>$GOARCH</em>$GOOS.go</p>

<p>ä¾‹å­å¦‚ä¸‹ï¼š</p>

<p>mypkg_freebsd_arm.go // only builds on freebsd/arm systems
mypkg_plan9.go       // only builds on plan9</p>

<p>æºæ–‡ä»¶ä¸èƒ½åªæä¾›æ¡ä»¶ç¼–è¯‘åç¼€ï¼Œè¿˜å¿…é¡»æœ‰æ–‡ä»¶åï¼š</p>

<p>_linux.go
_freebsd_386.go
è¿™ä¸¤ä¸ªæºæ–‡ä»¶åœ¨æ‰€æœ‰å¹³å°ä¸‹éƒ½ä¼šè¢«å¿½ç•¥æ‰ï¼Œå› ä¸ºgo/buildå°†ä¼šå¿½ç•¥æ‰€æœ‰ä»¥ä¸‹åˆ’çº¿æˆ–è€…ç‚¹å¼€å¤´çš„æºæ–‡ä»¶</p>

<ol>
  <li>ç¼–è¯‘æ ‡ç­¾å’Œæ–‡ä»¶åç¼€çš„é€‰æ‹©</li>
</ol>

<p>ç¼–è¯‘æ ‡ç­¾å’Œæ–‡ä»¶åç¼€çš„åŠŸèƒ½ä¸Šæœ‰é‡å ï¼Œä¾‹å¦‚ä¸€ä¸ªæ–‡ä»¶åï¼šmypkg_linux.goåŒ…å«äº†// +build linuxå°†ä¼šå‡ºç°å†—ä½™</p>

<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæºæ–‡ä»¶ä¸å¹³å°æˆ–è€…cpuæ¶æ„å®Œå…¨åŒ¹é…ï¼Œé‚£ä¹ˆç”¨æ–‡ä»¶åç¼€ï¼Œä¾‹å¦‚ï¼š</p>

<p>mypkg_linux.go         // only builds on linux systems
mypkg_windows_amd64.go // only builds on windows 64bit platforms</p>

<p>ç›¸åï¼Œå¦‚æœè¿™ä¸ªæºæ–‡ä»¶å¯ä»¥åœ¨è¶…è¿‡ä¸€ä¸ªå¹³å°æˆ–è€…è¶…è¿‡ä¸€ä¸ªcpuæ¶æ„ä¸‹å¯ä»¥ä½¿ç”¨æˆ–è€…éœ€è¦å»é™¤æŒ‡å®šå¹³å°ï¼Œé‚£ä¹ˆä½¿ç”¨ç¼–è¯‘æ ‡ç­¾ï¼Œä¾‹å¦‚ä¸‹é¢çš„ç¼–è¯‘æ ‡ç­¾å¯ä»¥åœ¨æ‰€æœ‰*nixå¹³å°ä¸Šç¼–è¯‘ï¼š</p>

<p>% grep â€˜+buildâ€™ $HOME/go/src/pkg/os/exec/lp_unix.go 
// +build darwin dragonfly freebsd linux netbsd openbsd</p>

<p>ä¸‹é¢æ˜¯å¯ä»¥åœ¨é™¤äº†windowsçš„æ‰€æœ‰å¹³å°ä¸‹ç¼–è¯‘</p>

<p>% grep â€˜+buildâ€™ $HOME/go/src/pkg/os/types_notwin.go 
// +build !windows</p>

<ol>
  <li>æ€»ç»“</li>
</ol>

<p>è¿™ç¯‡æ–‡ç« ä¸»è¦å…³æ³¨æ‰€æœ‰å¯ä»¥è¢«go toolç¼–è¯‘çš„goæºæ–‡ä»¶,ç¼–è¯‘æ ‡ç­¾å’Œæ–‡ä»¶åç¼€åï¼ˆä¹ŸåŒ…æ‹¬äº†.c å’Œ.sæ–‡ä»¶)</p>

<p>Goçš„æ ‡å‡†åº“é‡ŒåŒ…å«äº†å¾ˆå¤šçš„æ ·ä¾‹ï¼Œç‰¹åˆ«æ˜¯runtime,syscall,oså’ŒnetåŒ…ï¼Œè¯»è€…å¯ä»¥é€šè¿‡è¿™äº›åŒ…æ¥å­¦ä¹ </p>

<p>Testæ–‡ä»¶ä¹Ÿæ”¯æŒç¼–è¯‘æ ‡ç­¾å’Œæ–‡ä»¶åç¼€æ¡ä»¶ç¼–è¯‘ï¼Œå¹¶ä¸”ä½œç”¨æ–¹å¼ä¸goæºæ–‡ä»¶ç›¸åŒã€‚å¯ä»¥åœ¨ä¸åŒå¹³å°ä¸‹æœ‰æ¡ä»¶çš„åŒ…å«ä¸€äº›æµ‹è¯•æ ·ä¾‹ã€‚åŒæ ·ï¼Œæ ‡å‡†åº“ä¹ŸåŒ…å«äº†å¤§é‡çš„ä¾‹å­</p>

<p>æœ€åï¼Œè¿™ç¯‡æ–‡ä»¶æ˜¯è®²å¦‚ä½•ç”¨go toolæ¥è¾¾åˆ°æ¡ä»¶ç¼–è¯‘ï¼Œä½†æ˜¯æ¡ä»¶ç¼–è¯‘ä¸é™äºgo toolï¼Œä½ å¯ä»¥ç”¨go/buildåŒ…ç¼–å†™è‡ªå·±çš„æ¡ä»¶ç¼–è¯‘å·¥å…·</p>

<p>go build
ä½¿ç”¨tagæ¥å®ç°ç¼–è¯‘ä¸åŒçš„æ–‡ä»¶
go-tooling-workshop ä¸­å…³äºgo buildçš„è®²è§£å¯ä»¥äº†è§£åˆ°go bulidçš„ä¸€äº›ç”¨æ³•ï¼Œè¿™ç¯‡æ–‡ç« æœ€åè¦æ±‚å®ç°ä¸€ä¸ªæ ¹æ®go bulid -tagåŠŸèƒ½æ¥ç¼–è¯‘ä¸åŒç‰ˆæœ¬çš„åšæ³•ï¼Œversionå‚æ•°æ ¹æ®tagä¼ è¿›æ¥çš„å€¼è¿›è¡Œç¼–è¯‘ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œmain.go</p>

<p>package main</p>

<p>import â€œfmtâ€</p>

<p>// HINT: You might need to move this declaration to a different file.
const version = â€œdevâ€
func main() {
    fmt.Printf(â€œrunning %s versionâ€, version)
}
å¥½ï¼Œæ–°å»ºä¸€ä¸ªdev_config.goæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹</p>

<p>// +build dev</p>

<p>package main</p>

<p>var version = â€œDEVâ€
ä¸Šé¢ä»£ç çš„å…³é”®æ˜¯ // +build devè¿™è¡Œä»£ç ï¼Œæ³¨æ„è¿™è¡Œä»£ç å‰åé¡»æœ‰ä¸€ä¸ªç©ºè¡Œéš”å¼€ï¼Œä¾‹å¦‚åœ¨ç¬¬ä¸€è¡Œæ—¶ï¼Œæ¥ä¸‹æ¥è¦ç©ºå‡ºä¸€è¡Œã€‚è¿™ä¸ªæ–‡ä»¶åªä¼šè¢«go bulidè¯†åˆ«åˆ°ï¼Œè€Œgo runç­‰å‘½ä»¤ä¸ä¼šå»è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ï¼Œè€Œä¸”vscodeç­‰ç¼–è¾‘å™¨ä¹Ÿä¼šç•¥è¿‡è¿™ä¸ªæ–‡ä»¶ã€‚
å†æ–°å»ºä¸€ä¸ªæ–‡ä»¶release_config.go,ä»£ç å¦‚ä¸‹</p>

<p>// +build release</p>

<p>package main</p>

<p>const version = â€œRELEASEâ€
ä»£ç å·²ç»å‡†å¤‡å®Œæ¯•ï¼Œè¿˜æœ‰ä¸€ä¸ªåœ°æ–¹è¦æ³¨æ„ï¼Œéœ€è¦å»æ‰main.goä¸­çš„const version = â€˜devâ€™è¿™è¡Œä»£ç ï¼Œå¦åˆ™ï¼Œgo bulidå‘½ä»¤ä¼šæŠ¥versioné‡å¤å®šä¹‰ã€‚
æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>

<p>lin@DESKTOP-HQI5HRL MINGW64 /g/workspace/GoWorkspace/src
$ go build -tags dev -o dev_version</p>

<p>lin@DESKTOP-HQI5HRL MINGW64 /g/workspace/GoWorkspace/src
$ ./dev_version
running DEV version</p>

<p>lin@DESKTOP-HQI5HRL MINGW64 /g/workspace/GoWorkspace/src
$ go build -tags release -o release_version</p>

<p>lin@DESKTOP-HQI5HRL MINGW64 /g/workspace/GoWorkspace/src
$ ./release_version
running RELEASE version
go buildè¿˜æ”¯æŒé€šè¿‡å‘½ä»¤è¡Œä¼ é€’ç¼–è¯‘å‚æ•°ï¼Œé€šè¿‡-ldflagså‚æ•°å®ç°ï¼Œå°†main.goä¿®æ”¹ä¸º</p>

<p>package main</p>

<p>import â€œfmtâ€</p>

<p>// HINT: You might need to move this declaration to a different file.
var version string</p>

<p>func main() {
    fmt.Printf(â€œrunning %s versionâ€, version)
}
å‘½ä»¤è¡Œæ‰§è¡Œï¼š</p>

<p>lin@DESKTOP-HQI5HRL MINGW64 /g/workspace/GoWorkspace/src
$ go build -ldflags â€˜-X main.version=â€devâ€â€™ -o dev_version</p>

<p>lin@DESKTOP-HQI5HRL MINGW64 /g/workspace/GoWorkspace/src
$ ./dev_version
running â€œdevâ€ version
lin@DESKTOP-HQI5HRL MINGW64 /g/workspace/GoWorkspace/src</p>

<p>https://www.digitalocean.com/community/tutorials/customizing-go-binaries-with-build-tags</p>

<p>ä¸ºäº†è¦å†™ä¸€ä¸ªWebæœåŠ¡ä½†æ˜¯æœ‰å¯èƒ½ä¼šå‘ç”Ÿä»¥ä¸‹çš„éœ€æ±‚ï¼š</p>

<p>ä¸åŒæœåŠ¡å™¨ï¼Œæœ‰ä¸åŒçš„è®¾å®šå‚æ•°
ä¸åŒçš„OSæœ‰ä¸åŒçš„å‘½ä»¤é›†
æƒ³è¦å¿«é€Ÿçš„å¼€å¯æˆ–è€…å…³é—­è°ƒè¯•æ—¥å¿—
åœ¨æœ‰ä»¥ä¸Šçš„éœ€æ±‚çš„æ—¶å€™ï¼Œä¸€å¼€å§‹éƒ½æ˜¯ä½¿ç”¨OSæ£€æµ‹æˆ–é…ç½®æ–‡ä»¶æ¥åˆ†åŒºã€‚ä½†æ˜¯åˆ°åé¢å…¶å®æ˜¯å¸Œæœ›èƒ½é€è¿‡ä¸åŒçš„build configèƒ½äº§ç”Ÿä¸åŒçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>

<p>å†³å®šç ”ç©¶äº†ä¸€ä¸‹ï¼šgo buildæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼å¯ä»¥è¾¾åˆ°éƒ¨åˆ†çš„æ•ˆæœã€‚</p>

<h2 id="go-build--ldflags">Go build -ldflags</h2>

<p>è¿™å¯ä»¥åœ¨go buildçš„æ—¶å€™ï¼Œå…ˆè®¾å®šä¸€äº›å˜æ•°çš„åç§°ã€‚é€šå¸¸æˆ‘è‡ªå·±æ¯”è¾ƒä¹ æƒ¯é€è¿‡OSç¯å¢ƒå˜æ•°æ¥è®¾å®šï¼Œç„¶åç¨‹å¼é‡Œé¢å†å»è¯»å–ã€‚</p>

<p>åœ¨ä½ çš„ä¸»ç¨‹å¼é‡Œé¢ï¼Œå¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ªå˜æ•°flagStringï¼š</p>

<p>package main</p>

<p>import (
	â€œfmtâ€
)</p>

<p>var flagString string</p>

<p>func main() {
	fmt.Println(â€œThis build with ldflag:â€, flagString)
}
é€è¿‡å¤–åœ¨go buildæ¥è®¾å®šè¿™ä¸ªå˜æ•°go build -ldflags â€˜-X main.flagString â€œtestâ€â€˜è¿™æ ·ä½ çš„ç»“æœä¼šæ˜¯</p>

<blockquote>
  <blockquote>
    <p>This build with ldflag: test
è¿™ä¸ªæ–¹å¼å¯ä»¥ç›´æ¥è®¾å®šå‚æ•°ï¼Œè®©å€¼åˆå§‹åŒ–é€šè¿‡å¤–éƒ¨è®¾å®šæ¥è·‘ã€‚</p>
  </blockquote>
</blockquote>

<h2 id="go-build--tags">Go build -tags</h2>

<p>é€šè¿‡go build -tagsè¿™æ ·ï¼Œä½ èƒ½å¤Ÿæ”¾åœ¨è¿™ä¸ªæ¡£æ¡ˆé‡Œé¢çš„ä¸œè¥¿å°±æœ‰å¾ˆå¤šã€‚å¯ä»¥æ˜¯ï¼š</p>

<p>ä¸åŒç³»åˆ—çš„defineï¼ˆè¾¾åˆ°ifdefçš„æ•ˆæœï¼‰
ä¸åŒçš„åŠŸèƒ½å·¥å…·ï¼ˆè¾¾åˆ°åŒä¸€ä¸ªåŠŸèƒ½åœ¨ä¸åŒè®¾å®šä¸‹æœ‰ä¸åŒå®ç°ï¼‰
ä»¥ä¸‹å¢åŠ ä¸€ä¸ªç®€å•çš„èŒƒä¾‹ï¼Œæ¥è¾¾åˆ°ä¸åŒçš„ç”Ÿæˆé…ç½®å¯ä»¥åŠ è½½ä¸åŒçš„å®šä¹‰å€¼ã€‚</p>

<p>æ–‡ä»¶ï¼š debug_config.go</p>

<p>//+build debug</p>

<p>package main</p>

<p>var TestString string = â€œtest debugâ€
var TestString2 string = â€œ and it will run every module with debug tag.â€</p>

<p>func GetConfigString() string {
	return â€œit is debugâ€¦..â€
}
è¯·æ³¨æ„ï¼š//+build debugå‰åéœ€è¦ä¸€ä¸ªç©ºè¡Œï¼ˆé™¤éä½ åœ¨ç¬¬ä¸€è¡Œï¼‰</p>

<p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰ä¸€èˆ¬çš„è®¾å®šæ¡£ release_config.go</p>

<p>//+build !debug</p>

<p>package main</p>

<p>var TestString string = â€œtest releaseâ€
var TestString2 string = â€œ and it will run every module as no debug tag.â€</p>

<p>func GetConfigString() string {
	return â€œit is releaseâ€¦..â€
}
æœ€ååœ¨ä¸»è¦çš„mainé‡Œé¢ï¼Œå¯ä»¥ç›´æ¥å»å‚è€ƒè¿™ä¸¤ä¸ªå®šä¹‰å€¼æ–‡ä»¶ï¼š main.go</p>

<p>package main</p>

<p>import (
	â€œfmtâ€
)</p>

<p>func main() {
	fmt.Println(â€œThis build is â€œ, TestString, TestString2, GetConfigString())
}
åœ¨è¿™é‡Œå¦‚æœä½ æ˜¯è·‘go build -tags debugé‚£ä¹ˆæ‰§è¡Œç»“æœä¼šæ˜¯ï¼š</p>

<blockquote>
  <blockquote>
    <p>This build is  test debug  and it will run every module with debug tag. it is debugâ€¦..
å¦‚æœè·‘çš„æ˜¯go buildä¼šé¢„è®¾å»è¯»å–!debugï¼Œé‚£ä¹ˆç»“æœä¼šæ˜¯ï¼š</p>
  </blockquote>
</blockquote>

<blockquote>
  <blockquote>
    <p>This build is  test release  and it will run every module as no debug tag. it is releaseâ€¦..
å¯ä»¥çœ‹åˆ°ä»–ä¸åªå¯ä»¥åŠ å…¥å®šä¹‰å‚æ•°ï¼Œä¹Ÿå¯ä»¥æŠŠä¸åŒçš„åŠŸèƒ½å¸¦æ¥ä¸åŒçš„å®ç°ã€‚</p>
  </blockquote>
</blockquote>

<p>##ä½¿ç”¨æ—¶æœºè®¨è®ºä¸å¿ƒå¾—</p>

<p>ä½¿ç”¨ä¸Šå·®å¼‚ï¼š</p>

<p>ldflagså¯ä»¥åŠ å…¥ä¸€äº›å‚æ•°ï¼Œå°±è·Ÿgccçš„ldflagsä¸€æ ·-
æ ‡ç­¾å¾ˆåƒæ˜¯gcc -Dä¸è¿‡ç”±äºåœ¨æ¡£æ¡ˆé‡Œé¢è¦å®šä¹‰//+build XXXXï¼Œæ„Ÿè§‰æœ‰ç‚¹ç¹çã€‚ä¸è¿‡ç”±äºå¯ä»¥å¯ä»¥ä»¥æ¡£æ¡ˆæ¥åŒºéš”ï¼Œä½ å¯ä»¥åŠ å…¥å¤šä¸ªå®šä¹‰å€¼è·ŸåŠŸèƒ½
ldflagsä½¿ç”¨æ—¶æœºï¼š</p>

<p>ä¸ªäººè®¤ä¸ºå¯èƒ½å¯ä»¥æ‹¿æ¥æ”¹å˜åˆå§‹å€¼å¾—è®¾å®šï¼Œæˆ–è€…å»æ”¹å˜ä¸€äº›ç¨‹åºå†…çš„è®¾å®šã€‚<strong>æŸç§è¯´ï¼š</strong></p>

<p>ç¼“å†²åŒºå€¼ï¼šé€è¿‡æ„å»ºæ¥æ”¹å˜ç¼“å†²åŒºçš„å¤§å°ï¼Œæ¥åšä¸åŒçš„æµ‹è¯•ä¸åº”ç”¨ã€‚
æ—¥å¿—æ ‡å¿—ï¼šå†³å®šè¦ä¸è¦å°log
æ ‡ç­¾ä½¿ç”¨æ—¶æœºï¼š</p>

<p>tagsçš„ä½¿ç”¨æ—¶æœºç›¸å½“çš„å¤šï¼Œåˆ—å‡ºå‡ ä¸ªæˆ‘çœ‹åˆ°çš„ï¼š</p>

<p>è°ƒè¯•æ—¥å¿—/åŠ å¯†ï¼šå®šä¹‰è°ƒè¯•åŠŸèƒ½ï¼Œç„¶åå†é‡Šæ”¾/è°ƒè¯•æœ‰ä¸åŒçš„å®ç°ï¼ˆå°æ—¢ä¸å°logï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨æŸäº›çŠ¶å†µä¸‹å¼€å¯æˆ–å…³é—­åŠ å¯†æ¥æµ‹è¯•ã€‚
è·¨å¹³å°éƒ¨åˆ†ï¼šä¸åŒOSå¹³å°éœ€è¦ä¸åŒçš„è®¾ç½®ä¸å®ç°
å…¶ä»–æ›´å¤šçš„éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°åœ¨é€æ¸åŠ ä¸Šå»ã€‚</p>

<p>##å‚è€ƒé“¾ç»“</p>

<p>http://blog.csdn.net/varding/article/details/20465311
http://shinpei.github.io/blog/2014/10/07/use-build-constrains-or-build-tag-in-golang/
http://stackoverflow.com/questions/15214459/how-to-properly-use-build-tags
http://stackoverflow.com/questions/11354518/golang-application-auto-build-versioning
http://codegangsta.io/blog/2013/07/11/practical-go-build-tags/
http://technosophos.com/2014/06/11/compile-time-string-in-go.html
Godocï¼šè¿›å…¥å‘½ä»¤è¡Œ
Godcoï¼šè¿›è¡Œæ„å»ºå‘½ä»¤
Dave Cheneyï¼šä½¿ç”¨// + buildåœ¨è°ƒè¯•å’Œå‘è¡Œç‰ˆæœ¬ä¹‹é—´åˆ‡æ¢</p>
:ET