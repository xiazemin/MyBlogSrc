I"›?<p>Chart ç›®å½•ç»“æ„
examples/
  Chart.yaml          # Yamlæ–‡ä»¶ï¼Œç”¨äºæè¿°Chartçš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç§°ç‰ˆæœ¬ç­‰
  LICENSE             # [å¯é€‰] åè®®
  README.md           # [å¯é€‰] å½“å‰Chartçš„ä»‹ç»
  values.yaml         # Chartçš„é»˜è®¤é…ç½®æ–‡ä»¶
  requirements.yaml   # [å¯é€‰] ç”¨äºå­˜æ”¾å½“å‰Chartä¾èµ–çš„å…¶å®ƒChartçš„è¯´æ˜æ–‡ä»¶
  charts/             # [å¯é€‰]: è¯¥ç›®å½•ä¸­æ”¾ç½®å½“å‰Chartä¾èµ–çš„å…¶å®ƒChart
  templates/          # [å¯é€‰]: éƒ¨ç½²æ–‡ä»¶æ¨¡ç‰ˆç›®å½•ï¼Œæ¨¡ç‰ˆä½¿ç”¨çš„å€¼æ¥è‡ªvalues.yamlå’Œç”±Tilleræä¾›çš„å€¼
  templates/NOTES.txt # [å¯é€‰]: æ”¾ç½®Chartçš„ä½¿ç”¨æŒ‡å—
<!-- more -->
templates ç›®å½•
templatesç›®å½•ä¸­å­˜æ”¾äº†Kuberneteséƒ¨ç½²æ–‡ä»¶çš„æ¨¡ç‰ˆã€‚</p>

<p>æ¨¡æ¿
Templatesç›®å½•ä¸‹æ˜¯yamlæ–‡ä»¶çš„æ¨¡æ¿ï¼Œéµå¾ªGo templateè¯­æ³•ã€‚ä½¿ç”¨è¿‡Hugoçš„é™æ€ç½‘ç«™ç”Ÿæˆå·¥å…·çš„äººåº”è¯¥å¯¹æ­¤å¾ˆç†Ÿæ‚‰ã€‚</p>

<p>æ£€æŸ¥é…ç½®å’Œæ¨¡æ¿æ˜¯å¦æœ‰æ•ˆ
å½“ä½¿ç”¨kuberneteséƒ¨ç½²åº”ç”¨çš„æ—¶å€™å®é™…ä¸Šè®²templatesæ¸²æŸ“æˆæœ€ç»ˆçš„kubernetesèƒ½å¤Ÿè¯†åˆ«çš„yamlæ ¼å¼ã€‚</p>

<p>ä½¿ç”¨helm install â€“dry-run â€“debug <chart_dir>å‘½ä»¤æ¥éªŒè¯charté…ç½®ã€‚è¯¥è¾“å‡ºä¸­åŒ…å«äº†æ¨¡æ¿çš„å˜é‡é…ç½®ä¸æœ€ç»ˆæ¸²æŸ“çš„yamlæ–‡ä»¶ã€‚</chart_dir></p>

<p>éƒ¨ç½²åˆ°kubernetes
åœ¨mychartç›®å½•ä¸‹æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†nginxéƒ¨ç½²åˆ°kubernetesé›†ç¾¤ä¸Šã€‚</p>

<p>helm install .</p>

<p>https://www.jianshu.com/p/aff467690d57</p>

<p>åœ¨äº‘ (Kubernetes)ä¸Šï¼Œéƒ¨ç½²ä¸€ä¸ªåº”ç”¨å¾€å¾€å´ä¸æ˜¯é‚£ä¹ˆç®€å•ã€‚å¦‚æœæƒ³è¦éƒ¨ç½²ä¸€ä¸ªåº”ç”¨ç¨‹åºåˆ°äº‘ä¸Šï¼Œé¦–å…ˆè¦å‡†å¤‡å¥½å®ƒæ‰€éœ€è¦çš„ç¯å¢ƒï¼Œæ‰“åŒ…æˆ Docker é•œåƒï¼Œè¿›è€ŒæŠŠé•œåƒæ”¾åœ¨éƒ¨ç½²æ–‡ä»¶ (Deployment) ä¸­ã€é…ç½®æœåŠ¡ (Service)ã€åº”ç”¨æ‰€éœ€çš„è´¦æˆ· (ServiceAccount) åŠæƒé™ (Role)ã€å‘½åç©ºé—´ (Namespace)ã€å¯†é’¥ä¿¡æ¯ (Secret)ã€å¯æŒä¹…åŒ–å­˜å‚¨ (PersistentVolumes) ç­‰èµ„æºã€‚ä¹Ÿå°±æ˜¯ç¼–å†™ä¸€ç³»åˆ—äº’ç›¸ç›¸å…³çš„ YAML é…ç½®æ–‡ä»¶ï¼Œå°†å®ƒä»¬éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ä¸Šã€‚</p>

<p>ä½†æ˜¯å³ä¾¿åº”ç”¨çš„å¼€å‘è€…å¯ä»¥æŠŠè¿™äº› Docker é•œåƒå­˜æ”¾åœ¨å…¬å…±ä»“åº“ä¸­ï¼Œå¹¶ä¸”å°†æ‰€éœ€çš„ YAML èµ„æºæ–‡ä»¶æä¾›ç»™ç”¨æˆ·ï¼Œç”¨æˆ·ä»ç„¶éœ€è¦è‡ªå·±å»å¯»æ‰¾è¿™äº›èµ„æºæ–‡ä»¶ï¼Œå¹¶æŠŠå®ƒä»¬ä¸€ä¸€éƒ¨ç½²ã€‚å€˜è‹¥ç”¨æˆ·å¸Œæœ›ä¿®æ”¹å¼€å‘è€…æä¾›çš„é»˜è®¤èµ„æºï¼Œæ¯”å¦‚ä½¿ç”¨æ›´å¤šçš„å‰¯æœ¬ (Replicas) æˆ–æ˜¯ä¿®æ”¹æœåŠ¡ç«¯å£ (Port)ï¼Œä»–è¿˜éœ€è¦è‡ªå·±å»æŸ¥éœ€è¦åœ¨è¿™äº›èµ„æºæ–‡ä»¶çš„å“ªäº›åœ°æ–¹ä¿®æ”¹ï¼Œæ›´ä¸ç”¨æç‰ˆæœ¬å˜æ›´ä¸ç»´æŠ¤ä¼šç»™å¼€å‘è€…å’Œç”¨æˆ·é€ æˆå¤šå°‘éº»çƒ¦äº†ã€‚</p>

<p>æœ‰ä¸€ç³»åˆ—åŸºäº Kubernetes çš„åº”ç”¨åŒ…ç®¡ç†å·¥å…·æ¨ªç©ºå‡ºä¸–ã€‚è€Œæˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’ Helmï¼Œå°±æ˜¯è¿™å…¶ä¸­æœ€å—æ¬¢è¿çš„é€‰æ‹©ä¹‹ä¸€ã€‚</p>

<p>å¼€å‘è€…æŒ‰ç…§ Helm Chart çš„æ ¼å¼ï¼Œå°†åº”ç”¨æ‰€éœ€çš„èµ„æºæ–‡ä»¶åŒ…è£…èµ·æ¥ï¼Œé€šè¿‡æ¨¡ç‰ˆåŒ– (Templating) çš„æ–¹å¼å°†ä¸€äº›å¯å˜å­—æ®µï¼ˆæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„æš´éœ²å“ªä¸ªç«¯å£ã€ä½¿ç”¨å¤šå°‘å‰¯æœ¬ï¼‰æš´éœ²ç»™ç”¨æˆ·ï¼Œæœ€åå°†å°è£…å¥½çš„åº”ç”¨åŒ…ï¼Œä¹Ÿå°±æ˜¯ Helm Chartï¼Œé›†ä¸­å­˜æ”¾åœ¨ç»Ÿä¸€çš„ä»“åº“ä¸­ä¾›ç”¨æˆ·æµè§ˆä¸‹è½½ã€‚</p>

<p>ç«™åœ¨ç”¨æˆ·è§’åº¦ï¼Œç”¨æˆ·åªéœ€è¦ä¸€è¡Œç®€å•çš„å‘½ä»¤å°±å¯ä»¥å®Œæˆåº”ç”¨çš„å®‰è£…ã€å¸è½½ä¸å‡çº§ã€‚å¯¹äºå®‰è£…ä¹‹åçŠ¶æ€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ helm list æˆ–è€…æ˜¯åŸç”Ÿçš„ kubectl è¿›è¡ŒæŸ¥è¯¢ã€‚</p>

<p>é‚£ä¹ˆåˆ¶ä½œå®Œæˆçš„åº”ç”¨å¦‚ä½•å’Œå…¶ä»–äººåˆ†äº«å‘¢ï¼ŸHelm å®˜æ–¹æ¨å‡ºçš„ ChartMuseum æä¾›äº† Chart ä»“åº“çš„æ„å»ºæ–¹æ³•ï¼Œä½¿ç”¨å®ƒå¯ä»¥åˆ›å»ºè‡ªå·±çš„ Chart ä»“åº“ã€‚ç„¶è€Œè‡ªè¡Œç»´æŠ¤ä¸€ä¸ªä»“åº“æœ¬èº«æˆæœ¬ä¸å°ï¼Œè€Œä¸”å¯¹äºç”¨æˆ·è€Œè¨€å¦‚æœæ¯ä¸€ä¸ªå¼€å‘è€…éƒ½æ˜¯è‡ªå·±çš„ä»“åº“ï¼Œä»–å°±éœ€è¦å°†æ‰€éœ€åº”ç”¨å¯¹åº”çš„ä»“åº“éƒ½åŠ å…¥è‡ªå·±çš„æ£€ç´¢åˆ—è¡¨ä¸­ï¼Œå¾ˆä¸åˆ©äºåº”ç”¨çš„ä¼ æ’­ä¸åˆ†äº«ã€‚</p>

<p>ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å®šæœŸä»ä¸€äº›å›½å¤–çš„çŸ¥å Helm ä»“åº“åŒæ­¥ Chart èµ„æºï¼Œåœ¨åŒæ­¥çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹ Chart å†…éƒ¨ä½¿ç”¨çš„ä¸€éƒ¨åˆ† Docker é•œåƒè¿›è¡ŒåŒæ­¥æ›¿æ¢ï¼ˆä¾‹å¦‚ gcr.io æˆ–è€… quay.io çš„é•œåƒï¼‰ï¼Œæ–¹ä¾¿å›½å†…ç”¨æˆ·è®¿é—®ä½¿ç”¨ï¼›
å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å’Œ Helm å®˜æ–¹åº“ä¸€æ ·åœ¨ Github ä¸Šæ¥å—å¼€å‘è€…é€šè¿‡ Pull Request çš„å½¢å¼æäº¤è‡ªå·±çš„åº”ç”¨ã€‚æäº¤æˆåŠŸçš„åº”ç”¨ä¼šåœ¨çŸ­æœŸå†…åŒæ­¥è‡³äº‘åŸç”Ÿåº”ç”¨ä¸­å¿ƒï¼Œå’Œå…¶ä»–å®˜æ–¹åº”ç”¨å±•ç¤ºåœ¨ä¸€èµ·ä¾›å…¶ä»–ç”¨æˆ·ä½¿ç”¨ã€‚</p>

<p>https://www.sohu.com/a/338145305_612370</p>

<p>https://github.com/elastic/helm-charts/tree/master/elasticsearch
https://helm.sh/docs/topics/charts/</p>

<p>https://www.yuque.com/kylinxiang/dtthu6/me73r2
https://www.alibabacloud.com/help/zh/doc-detail/128090.htm
https://blog.csdn.net/boling_cavalry/article/details/88759724</p>

<p>æˆ‘ä»¬å¯ä»¥å°†Helmçœ‹ä½œKubernetesä¸‹çš„apt-get/yumã€‚Helmæ˜¯Deis (https://deis.com/) å¼€å‘çš„ä¸€ä¸ªç”¨äºkubernetesçš„åŒ…ç®¡ç†å™¨ã€‚æ¯ä¸ªåŒ…ç§°ä¸ºä¸€ä¸ªChartï¼Œä¸€ä¸ªChartæ˜¯ä¸€ä¸ªç›®å½•ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¼šå°†ç›®å½•è¿›è¡Œæ‰“åŒ…å‹ç¼©ï¼Œå½¢æˆname-version.tgzæ ¼å¼çš„å•ä¸€æ–‡ä»¶ï¼Œæ–¹ä¾¿ä¼ è¾“å’Œå­˜å‚¨ï¼‰ã€‚</p>

<p>å¯¹äºåº”ç”¨å‘å¸ƒè€…è€Œè¨€ï¼Œå¯ä»¥é€šè¿‡Helmæ‰“åŒ…åº”ç”¨ï¼Œç®¡ç†åº”ç”¨ä¾èµ–å…³ç³»ï¼Œç®¡ç†åº”ç”¨ç‰ˆæœ¬å¹¶å‘å¸ƒåº”ç”¨åˆ°è½¯ä»¶ä»“åº“ã€‚</p>

<p>å¯¹äºä½¿ç”¨è€…è€Œè¨€ï¼Œä½¿ç”¨Helmåä¸ç”¨éœ€è¦äº†è§£Kubernetesçš„Yamlè¯­æ³•å¹¶ç¼–å†™åº”ç”¨éƒ¨ç½²æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡Helmä¸‹è½½å¹¶åœ¨kubernetesä¸Šå®‰è£…éœ€è¦çš„åº”ç”¨ã€‚</p>

<p>é™¤æ­¤ä»¥å¤–ï¼ŒHelmè¿˜æä¾›äº†kubernetesä¸Šçš„è½¯ä»¶éƒ¨ç½²ï¼Œåˆ é™¤ï¼Œå‡çº§ï¼Œå›æ»šåº”ç”¨çš„å¼ºå¤§åŠŸèƒ½ã€‚</p>

<p>Helm ç»„ä»¶åŠç›¸å…³æœ¯è¯­
Helm
Helm æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œä¸‹çš„å®¢æˆ·ç«¯å·¥å…·ã€‚ä¸»è¦ç”¨äº Kubernetes åº”ç”¨ç¨‹åº Chart çš„åˆ›å»ºã€æ‰“åŒ…ã€å‘å¸ƒä»¥åŠåˆ›å»ºå’Œç®¡ç†æœ¬åœ°å’Œè¿œç¨‹çš„ Chart ä»“åº“ã€‚</p>

<p>Tiller
Tiller æ˜¯ Helm çš„æœåŠ¡ç«¯ï¼Œéƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ä¸­ã€‚Tiller ç”¨äºæ¥æ”¶ Helm çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ® Chart ç”Ÿæˆ Kubernetes çš„éƒ¨ç½²æ–‡ä»¶ï¼ˆ Helm ç§°ä¸º Release ï¼‰ï¼Œç„¶åæäº¤ç»™ Kubernetes åˆ›å»ºåº”ç”¨ã€‚Tiller è¿˜æä¾›äº† Release çš„å‡çº§ã€åˆ é™¤ã€å›æ»šç­‰ä¸€ç³»åˆ—åŠŸèƒ½ã€‚</p>

<p>Chart
Helm çš„è½¯ä»¶åŒ…ï¼Œé‡‡ç”¨ TAR æ ¼å¼ã€‚ç±»ä¼¼äº APT çš„ DEB åŒ…æˆ–è€… YUM çš„ RPM åŒ…ï¼Œå…¶åŒ…å«äº†ä¸€ç»„å®šä¹‰ Kubernetes èµ„æºç›¸å…³çš„ YAML æ–‡ä»¶ã€‚</p>

<p>Repoistory
Helm çš„è½¯ä»¶ä»“åº“ï¼ŒRepository æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ä¿å­˜äº†ä¸€ç³»åˆ—çš„ Chart è½¯ä»¶åŒ…ä»¥ä¾›ç”¨æˆ·ä¸‹è½½ï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ªè¯¥ Repository çš„ Chart åŒ…çš„æ¸…å•æ–‡ä»¶ä»¥ä¾›æŸ¥è¯¢ã€‚Helm å¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªä¸åŒçš„ Repositoryã€‚</p>

<p>Release
ä½¿ç”¨ helm install å‘½ä»¤åœ¨ Kubernetes é›†ç¾¤ä¸­éƒ¨ç½²çš„ Chart ç§°ä¸º Releaseã€‚</p>

<p>æ³¨ï¼šéœ€è¦æ³¨æ„çš„æ˜¯ï¼šHelm ä¸­æåˆ°çš„ Release å’Œæˆ‘ä»¬é€šå¸¸æ¦‚å¿µä¸­çš„ç‰ˆæœ¬æœ‰æ‰€ä¸åŒï¼Œè¿™é‡Œçš„ Release å¯ä»¥ç†è§£ä¸º Helm ä½¿ç”¨ Chart åŒ…éƒ¨ç½²çš„ä¸€ä¸ªåº”ç”¨å®ä¾‹ã€‚</p>

<p>Helmå·¥ä½œåŸç†
Chart Install è¿‡ç¨‹ï¼š</p>

<p>Helmä»æŒ‡å®šçš„ç›®å½•æˆ–è€…tgzæ–‡ä»¶ä¸­è§£æå‡ºChartç»“æ„ä¿¡æ¯
Helmå°†æŒ‡å®šçš„Chartç»“æ„å’ŒValuesä¿¡æ¯é€šè¿‡gRPCä¼ é€’ç»™Tiller
Tilleræ ¹æ®Chartå’ŒValuesç”Ÿæˆä¸€ä¸ªRelease
Tillerå°†Releaseå‘é€ç»™Kubernetesç”¨äºç”ŸæˆRelease
Chart Updateè¿‡ç¨‹ï¼š</p>

<p>Helmä»æŒ‡å®šçš„ç›®å½•æˆ–è€…tgzæ–‡ä»¶ä¸­è§£æå‡ºChartç»“æ„ä¿¡æ¯
Helmå°†è¦æ›´æ–°çš„Releaseçš„åç§°å’ŒChartç»“æ„ï¼ŒValuesä¿¡æ¯ä¼ é€’ç»™Tiller
Tillerç”ŸæˆReleaseå¹¶æ›´æ–°æŒ‡å®šåç§°çš„Releaseçš„History
Tillerå°†Releaseå‘é€ç»™Kubernetesç”¨äºæ›´æ–°Release
Chart Rollbackè¿‡ç¨‹ï¼š</p>

<p>Helmå°†è¦å›æ»šçš„Releaseçš„åç§°ä¼ é€’ç»™Tiller
Tilleræ ¹æ®Releaseçš„åç§°æŸ¥æ‰¾History
Tillerä»Historyä¸­è·å–ä¸Šä¸€ä¸ªRelease
Tillerå°†ä¸Šä¸€ä¸ªReleaseå‘é€ç»™Kubernetesç”¨äºæ›¿æ¢å½“å‰Release
helméƒ¨ç½²
ä¸€ã€Helm å®¢æˆ·ç«¯å®‰è£…
Helm çš„å®‰è£…æ–¹å¼å¾ˆå¤šï¼Œè¿™é‡Œé‡‡ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼å®‰è£…ã€‚æ›´å¤šå®‰è£…æ–¹æ³•å¯ä»¥å‚è€ƒ Helm çš„å®˜æ–¹å¸®åŠ©æ–‡æ¡£ã€‚</p>

<p>æ–¹å¼ä¸€ï¼šä½¿ç”¨å®˜æ–¹æä¾›çš„è„šæœ¬ä¸€é”®å®‰è£…</p>

<p>curl https://raw.githubusercontent.com/helm/helm/master/scripts/get &gt; get_helm.sh
$ chmod 700 get_helm.sh
$ ./get_helm.sh
æ–¹å¼äºŒï¼šæ‰‹åŠ¨ä¸‹è½½å®‰è£…</p>

<p>#ä»å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„äºŒè¿›åˆ¶å®‰è£…åŒ…åˆ°æœ¬åœ°ï¼šhttps://github.com/kubernetes/helm/releases
tar -zxvf helm-2.9.0.tar.gz # è§£å‹å‹ç¼©åŒ…</p>
<h1 id="æŠŠ-helm-æŒ‡ä»¤æ”¾åˆ°binç›®å½•ä¸‹">æŠŠ helm æŒ‡ä»¤æ”¾åˆ°binç›®å½•ä¸‹</h1>
<p>mv helm-2.9.0/helm /usr/local/bin/helm
helm help # éªŒè¯
äºŒã€Helm æœåŠ¡ç«¯å®‰è£…Tiller
æ³¨æ„ï¼šå…ˆåœ¨ K8S é›†ç¾¤ä¸Šæ¯ä¸ªèŠ‚ç‚¹å®‰è£… socat è½¯ä»¶(yum install -y socat )ï¼Œä¸ç„¶ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>

<p>E0522 22:22:15.492436   24409 portforward.go:331] an error occurred forwarding 38398 -&gt; 44134: error forwarding port 44134 to pod dc6da4ab99ad9c497c0cef1776b9dd18e0a612d507e2746ed63d36ef40f30174, uid : unable to do port forwarding: socat not found.
Error: cannot connect to Tiller
Tiller æ˜¯ä»¥ Deployment æ–¹å¼éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ä¸­çš„ï¼Œåªéœ€ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¾¿å¯ç®€å•çš„å®Œæˆå®‰è£…ã€‚</p>

<p>$ helm init
ç”±äº Helm é»˜è®¤ä¼šå» storage.googleapis.com æ‹‰å–é•œåƒï¼Œå¦‚æœä½ å½“å‰æ‰§è¡Œçš„æœºå™¨ä¸èƒ½è®¿é—®è¯¥åŸŸåçš„è¯å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…ï¼š</p>

<p>helm init â€“client-only â€“stable-repo-url https://aliacs-app-catalog.oss-cn-hangzhou.aliyuncs.com/charts/
helm repo add incubator https://aliacs-app-catalog.oss-cn-hangzhou.aliyuncs.com/charts-incubator/
helm repo update</p>
<h1 id="åˆ›å»ºæœåŠ¡ç«¯">åˆ›å»ºæœåŠ¡ç«¯</h1>
<p>helm init â€“service-account tiller â€“upgrade -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.9.1  â€“stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</p>

<h1 id="åˆ›å»ºtlsè®¤è¯æœåŠ¡ç«¯å‚è€ƒåœ°å€httpsgithubcomgjmzjkubeaszblobmasterdocsguidehelmmd">åˆ›å»ºTLSè®¤è¯æœåŠ¡ç«¯ï¼Œå‚è€ƒåœ°å€ï¼šhttps://github.com/gjmzj/kubeasz/blob/master/docs/guide/helm.md</h1>
<p>helm init â€“service-account tiller â€“upgrade -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.9.1 â€“tiller-tls-cert /etc/kubernetes/ssl/tiller001.pem â€“tiller-tls-key /etc/kubernetes/ssl/tiller001-key.pem â€“tls-ca-cert /etc/kubernetes/ssl/ca.pem â€“tiller-namespace kube-system â€“stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts
åœ¨ Kubernetes ä¸­å®‰è£… Tiller æœåŠ¡ï¼Œå› ä¸ºå®˜æ–¹çš„é•œåƒå› ä¸ºæŸäº›åŸå› æ— æ³•æ‹‰å–ï¼Œä½¿ç”¨-iæŒ‡å®šè‡ªå·±çš„é•œåƒï¼Œå¯é€‰é•œåƒï¼šregistry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.9.1ï¼ˆé˜¿é‡Œäº‘ï¼‰ï¼Œè¯¥é•œåƒçš„ç‰ˆæœ¬ä¸helmå®¢æˆ·ç«¯çš„ç‰ˆæœ¬ç›¸åŒï¼Œä½¿ç”¨helm versionå¯æŸ¥çœ‹helmå®¢æˆ·ç«¯ç‰ˆæœ¬ã€‚</p>

<p>å¦‚æœåœ¨ç”¨helm initå®‰è£…tiller serveræ—¶ä¸€ç›´éƒ¨ç½²ä¸æˆåŠŸ,æ£€æŸ¥deploymentï¼Œæ ¹æ®æè¿°è§£å†³é—®é¢˜ã€‚</p>

<p>ä¸‰ã€ç»™ Tiller æˆæƒ
å› ä¸º Helm çš„æœåŠ¡ç«¯ Tiller æ˜¯ä¸€ä¸ªéƒ¨ç½²åœ¨ Kubernetes ä¸­ Kube-System Namespace ä¸‹ çš„ Deploymentï¼Œå®ƒä¼šå»è¿æ¥ Kube-Api åœ¨ Kubernetes é‡Œåˆ›å»ºå’Œåˆ é™¤åº”ç”¨ã€‚</p>

<p>è€Œä» Kubernetes 1.6 ç‰ˆæœ¬å¼€å§‹ï¼ŒAPI Server å¯ç”¨äº† RBAC æˆæƒã€‚ç›®å‰çš„ Tiller éƒ¨ç½²æ—¶é»˜è®¤æ²¡æœ‰å®šä¹‰æˆæƒçš„ ServiceAccountï¼Œè¿™ä¼šå¯¼è‡´è®¿é—® API Server æ—¶è¢«æ‹’ç»ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸º Tiller éƒ¨ç½²æ·»åŠ æˆæƒã€‚</p>

<p>åˆ›å»º Kubernetes çš„æœåŠ¡å¸å·å’Œç»‘å®šè§’è‰²</p>

<p>$ kubectl create serviceaccount â€“namespace kube-system tiller
$ kubectl create clusterrolebinding tiller-cluster-rule â€“clusterrole=cluster-admin â€“serviceaccount=kube-system:tiller
ä¸º Tiller è®¾ç½®å¸å·</p>

<h1 id="ä½¿ç”¨-kubectl-patch-æ›´æ–°-api-å¯¹è±¡">ä½¿ç”¨ kubectl patch æ›´æ–° API å¯¹è±¡</h1>
<p>$ kubectl patch deploy â€“namespace kube-system tiller-deploy -p â€˜{â€œspecâ€:{â€œtemplateâ€:{â€œspecâ€:{â€œserviceAccountâ€:â€tillerâ€}}}}â€™
deployment.extensions â€œtiller-deployâ€ patched
æŸ¥çœ‹æ˜¯å¦æˆæƒæˆåŠŸ</p>

<p>$ kubectl get deploy â€“namespace kube-system Â  tiller-deploy Â â€“output yaml|grep Â serviceAccount
serviceAccount: tiller
serviceAccountName: tiller
å››ã€éªŒè¯ Tiller æ˜¯å¦å®‰è£…æˆåŠŸ
$ kubectl -n kube-system get pods|grep tiller
tiller-deploy-6d68f5c78f-nql2z Â  Â  Â  Â  Â 1/1 Â  Â  Â  Running Â  0 Â  Â  Â  Â  Â 5m</p>

<p>$ helm version
Client: &amp;version.Version{SemVer:â€v2.9.1â€, GitCommit:â€20adb27c7c5868466912eebdf6664e7390ebe710â€, GitTreeState:â€cleanâ€}
Server: &amp;version.Version{SemVer:â€v2.9.1â€, GitCommit:â€20adb27c7c5868466912eebdf6664e7390ebe710â€, GitTreeState:â€cleanâ€}
äº”ã€å¸è½½ Helm æœåŠ¡å™¨ç«¯ Tiller
å¦‚æœä½ éœ€è¦åœ¨ Kubernetes ä¸­å¸è½½å·²éƒ¨ç½²çš„ Tillerï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®Œæˆå¸è½½ã€‚</p>

<p>$ helm reset æˆ–
$helm reset â€“force
å…­ã€Helm ä½¿ç”¨
1ï¼‰æ›´æ¢ä»“åº“ï¼š</p>

<p>è‹¥é‡åˆ°Unable to get an update from the â€œstableâ€ chart repository (https://kubernetes-charts.storage.googleapis.com) é”™è¯¯
æ‰‹åŠ¨æ›´æ¢stable å­˜å‚¨åº“ä¸ºé˜¿é‡Œäº‘çš„å­˜å‚¨åº“</p>

<h1 id="å…ˆç§»é™¤åŸå…ˆçš„ä»“åº“">å…ˆç§»é™¤åŸå…ˆçš„ä»“åº“</h1>
<p>helm repo remove stable</p>
<h1 id="æ·»åŠ æ–°çš„ä»“åº“åœ°å€">æ·»åŠ æ–°çš„ä»“åº“åœ°å€</h1>
<p>helm repo add stable https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</p>
<h1 id="æ›´æ–°ä»“åº“">æ›´æ–°ä»“åº“</h1>
<p>helm repo update
2ï¼‰æŸ¥çœ‹åœ¨å­˜å‚¨åº“ä¸­å¯ç”¨çš„æ‰€æœ‰ Helm chartsï¼š</p>

<p>helm search</p>

<p>NAME                            CHART VERSION   APP VERSION     DESCRIPTION                                     <br />
stable/acs-engine-autoscaler    2.1.3           2.1.1           Scales worker nodes within agent pools          <br />
stable/aerospike                0.1.7           v3.14.1.2       A Helm chart for Aerospike in Kubernetes        <br />
stable/anchore-engine           0.1.3           0.1.6           Anchore container analysis and policy evaluatioâ€¦
stable/artifactory              7.0.3           5.8.4           Universal Repository Manager supporting all majâ€¦
stable/artifactory-ha           0.1.0           5.8.4           Universal Repository Manager supporting all majâ€¦
stable/aws-cluster-autoscaler   0.3.2                           Scales worker nodes within autoscaling groups.
â€¦ â€¦
3ï¼‰æ›´æ–°chartsåˆ—è¡¨ï¼š</p>

<p>helm repo update
4ï¼‰å®‰è£…chartsï¼š</p>

<p>Monocularæ˜¯ä¸€ä¸ªå¼€æºè½¯ä»¶ï¼Œç”¨äºç®¡ç†kubernetesä¸Šä»¥Helm Chartså½¢å¼åˆ›å»ºçš„æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡å®ƒçš„webé¡µé¢æ¥å®‰è£…helm Charts</p>

<p>å®‰è£…Nginx Ingress controllerï¼Œå®‰è£…çš„k8sé›†ç¾¤å¯ç”¨äº†RBACï¼Œåˆ™ä¸€å®šè¦åŠ rbac.create=trueå‚æ•°</p>

<p>helm install stable/nginx-ingress â€“set controller.hostNetwork=trueï¼Œrbac.create=true</p>

<p>https://blog.csdn.net/bbwangj/article/details/81087911</p>

<p>https://www.kubernetes.org.cn/3884.html
https://help.aliyun.com/document_detail/128090.html</p>

<p>https://cloudnativeapp.gitbook.io/handbook/helm-chart-creation-tutorial</p>

<p>https://www.codercto.com/a/73043.html
https://github.com/netdata/helmchart</p>

<p>https://github.com/helm/charts/tree/master/stable/nginx-ingress
https://github.com/kubernetes/ingress-nginx/tree/master/charts/ingress-nginx</p>

<p>helmçš„å®‰è£…å‚è€ƒï¼š
https://www.kubernetes.org.cn/4619.html</p>

<p>Helmç”±å®¢æˆ·ç«¯å‘½helmä»¤è¡Œå·¥å…·å’ŒæœåŠ¡ç«¯tillerç»„æˆï¼ŒHelmçš„å®‰è£…ååˆ†ç®€å•ã€‚ ä¸‹è½½helmå‘½ä»¤è¡Œå·¥å…·åˆ°masterèŠ‚ç‚¹node1çš„/usr/local/binä¸‹ï¼Œè¿™é‡Œä¸‹è½½çš„2.9.1ç‰ˆæœ¬ï¼š</p>

<p>wget https://storage.googleapis.com/kubernetes-helm/helm-v2.11.0-linux-amd64.tar.gz
tar -zxvf helm-v2.11.0-linux-amd64.tar.gz
cd linux-amd64/
cp helm /usr/local/bin/
ä¸ºäº†å®‰è£…æœåŠ¡ç«¯tillerï¼Œè¿˜éœ€è¦åœ¨è¿™å°æœºå™¨ä¸Šé…ç½®å¥½kubectlå·¥å…·å’Œkubeconfigæ–‡ä»¶ï¼Œç¡®ä¿kubectlå·¥å…·å¯ä»¥åœ¨è¿™å°æœºå™¨ä¸Šè®¿é—®apiserverä¸”æ­£å¸¸ä½¿ç”¨ã€‚ è¿™é‡Œçš„node1èŠ‚ç‚¹ä»¥åŠé…ç½®å¥½äº†kubectlã€‚</p>

<p>å› ä¸ºKubernetes APIServerå¼€å¯äº†RBACè®¿é—®æ§åˆ¶ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºtillerä½¿ç”¨çš„service account: tillerå¹¶åˆ†é…åˆé€‚çš„è§’è‰²ç»™å®ƒã€‚ è¯¦ç»†å†…å®¹å¯ä»¥æŸ¥çœ‹helmæ–‡æ¡£ä¸­çš„Role-based Access Controlã€‚ è¿™é‡Œç®€å•èµ·è§ç›´æ¥åˆ†é…cluster-adminè¿™ä¸ªé›†ç¾¤å†…ç½®çš„ClusterRoleç»™å®ƒã€‚</p>

<p>https://www.jianshu.com/p/d0cdbb49569b?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation</p>

<p>å®‰è£…Helm</p>

<p>Helmæœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼šHelmå®¢æˆ·ç«¯(helm)å’ŒHelmæœåŠ¡å™¨(Tiller)ã€‚ æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•å®‰è£…å®¢æˆ·ç«¯ï¼Œç„¶åç»§ç»­ä»‹ç»å®‰è£…æœåŠ¡å™¨çš„ä¸¤ç§æ–¹å¼ã€‚</p>

<p>https://blog.csdn.net/weixin_42116847/article/details/112014889</p>

<p>$ brew unlink kubernetes-helm
$ brew install https://raw.githubusercontent.com/Homebrew/homebrew-core/78d64252f30a12b6f4b3ce29686ab5e262eea812/Formula/kubernetes-helm.rb
$ brew switch kubernetes-helm 2.9.1</p>

<p>https://stackoverflow.com/questions/59626834/installing-helm-2-9-on-mac-osx-and-tiller</p>

<p>https://www.centoscn.vip/3881.html
brew install helm</p>

<p>https://helm.sh/docs/intro/install/</p>

:ET