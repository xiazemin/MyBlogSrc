<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>æ³½æ°‘åšå®¢</title>
    <description>å¤æ³½æ°‘çš„ä¸ªäººä¸»é¡µï¼Œå­¦ä¹ ç¬”è®°ã€‚</description>
    <link>https://xiazemin.github.io/MyBlog/</link>
    <atom:link href="https://xiazemin.github.io/MyBlog/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 22 Dec 2017 21:22:15 +0800</pubDate>
    <lastBuildDate>Fri, 22 Dec 2017 21:22:15 +0800</lastBuildDate>
    <generator>Jekyll v3.6.0.pre.beta1</generator>
    
      <item>
        <title>tcp_flag</title>
        <description>&lt;!-- more --&gt;
&lt;p&gt;åœ¨TCPå±‚ï¼Œæœ‰ä¸ªFLAGSå­—æ®µï¼Œè¿™ä¸ªå­—æ®µæœ‰ä»¥ä¸‹å‡ ä¸ªæ ‡è¯†ï¼šSYN, FIN, ACK, PSH, RST, URG.&lt;/p&gt;

&lt;p&gt;å…¶ä¸­ï¼Œå¯¹äºæˆ‘ä»¬æ—¥å¸¸çš„åˆ†ææœ‰ç”¨çš„å°±æ˜¯å‰é¢çš„äº”ä¸ªå­—æ®µã€‚&lt;/p&gt;

&lt;p&gt;å®ƒä»¬çš„å«ä¹‰æ˜¯ï¼š&lt;/p&gt;

&lt;p&gt;SYNè¡¨ç¤ºå»ºç«‹è¿æ¥ï¼Œ&lt;/p&gt;

&lt;p&gt;FINè¡¨ç¤ºå…³é—­è¿æ¥ï¼Œ&lt;/p&gt;

&lt;p&gt;ACKè¡¨ç¤ºå“åº”ï¼Œ&lt;/p&gt;

&lt;p&gt;PSHè¡¨ç¤ºæœ‰ DATAæ•°æ®ä¼ è¾“ï¼Œ&lt;/p&gt;

&lt;p&gt;RSTè¡¨ç¤ºè¿æ¥é‡ç½®ã€‚&lt;/p&gt;

&lt;p&gt;å…¶ä¸­ï¼ŒACKæ˜¯å¯èƒ½ä¸SYNï¼ŒFINç­‰åŒæ—¶ä½¿ç”¨çš„ï¼Œæ¯”å¦‚SYNå’ŒACKå¯èƒ½åŒæ—¶ä¸º1ï¼Œå®ƒè¡¨ç¤ºçš„å°±æ˜¯å»ºç«‹è¿æ¥ä¹‹åçš„å“åº”ï¼Œ&lt;/p&gt;

&lt;p&gt;å¦‚æœåªæ˜¯å•ä¸ªçš„ä¸€ä¸ªSYNï¼Œå®ƒè¡¨ç¤ºçš„åªæ˜¯å»ºç«‹è¿æ¥ã€‚&lt;/p&gt;

&lt;p&gt;TCPçš„å‡ æ¬¡æ¡æ‰‹å°±æ˜¯é€šè¿‡è¿™æ ·çš„ACKè¡¨ç°å‡ºæ¥çš„ã€‚&lt;/p&gt;

&lt;p&gt;ä½†SYNä¸FINæ˜¯ä¸ä¼šåŒæ—¶ä¸º1çš„ï¼Œå› ä¸ºå‰è€…è¡¨ç¤ºçš„æ˜¯å»ºç«‹è¿æ¥ï¼Œè€Œåè€…è¡¨ç¤ºçš„æ˜¯æ–­å¼€è¿æ¥ã€‚&lt;/p&gt;

&lt;p&gt;RSTä¸€èˆ¬æ˜¯åœ¨FINä¹‹åæ‰ä¼šå‡ºç°ä¸º1çš„æƒ…å†µï¼Œè¡¨ç¤ºçš„æ˜¯è¿æ¥é‡ç½®ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬åœ°ï¼Œå½“å‡ºç°FINåŒ…æˆ–RSTåŒ…æ—¶ï¼Œæˆ‘ä»¬ä¾¿è®¤ä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯æ–­å¼€äº†è¿æ¥ï¼›è€Œå½“å‡ºç°SYNå’ŒSYNï¼‹ACKåŒ…æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹äº†ä¸€ä¸ªè¿æ¥ã€‚&lt;/p&gt;

&lt;p&gt;PSHä¸º1çš„æƒ…å†µï¼Œä¸€èˆ¬åªå‡ºç°åœ¨ DATAå†…å®¹ä¸ä¸º0çš„åŒ…ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´PSHä¸º1è¡¨ç¤ºçš„æ˜¯æœ‰çœŸæ­£çš„TCPæ•°æ®åŒ…å†…å®¹è¢«ä¼ é€’ã€‚&lt;/p&gt;

&lt;p&gt;TCPçš„è¿æ¥å»ºç«‹å’Œè¿æ¥å…³é—­ï¼Œéƒ½æ˜¯é€šè¿‡è¯·æ±‚ï¼å“åº”çš„æ¨¡å¼å®Œæˆçš„ã€‚&lt;/p&gt;

&lt;p&gt;æ¦‚å¿µè¡¥å……-TCPä¸‰æ¬¡æ¡æ‰‹ï¼š&lt;/p&gt;

&lt;p&gt;TCP(Transmission Control Protocol)ä¼ è¾“æ§åˆ¶åè®®&lt;/p&gt;

&lt;p&gt;TCPæ˜¯ä¸»æœºå¯¹ä¸»æœºå±‚çš„ä¼ è¾“æ§åˆ¶åè®®ï¼Œæä¾›å¯é çš„è¿æ¥æœåŠ¡ï¼Œé‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹ç¡®è®¤å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼š&lt;/p&gt;

&lt;p&gt;ä½ç å³tcpæ ‡å¿—ä½ï¼Œæœ‰6ç§æ ‡ç¤ºï¼šSYN(synchronouså»ºç«‹è”æœº) ACK(acknowledgement ç¡®è®¤) PSH(pushä¼ é€) FIN(finishç»“æŸ) RST(reseté‡ç½®) URG(urgentç´§æ€¥)Sequence number(é¡ºåºå·ç ) Acknowledge number(ç¡®è®¤å·ç )&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šä¸»æœºAå‘é€ä½ç ä¸ºsynï¼1ï¼Œéšæœºäº§ç”Ÿseq number=1234567çš„æ•°æ®åŒ…åˆ°æœåŠ¡å™¨ï¼Œä¸»æœºBç”±SYN=1çŸ¥é“ï¼ŒAè¦æ±‚å»ºç«‹è”æœºï¼›&lt;/p&gt;

&lt;p&gt;ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šä¸»æœºBæ”¶åˆ°è¯·æ±‚åè¦ç¡®è®¤è”æœºä¿¡æ¯ï¼Œå‘Aå‘é€ack number=(ä¸»æœºAçš„seq+1)ï¼Œsyn=1ï¼Œack=1ï¼Œéšæœºäº§ç”Ÿseq=7654321çš„åŒ…ï¼›&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šä¸»æœºAæ”¶åˆ°åæ£€æŸ¥ack numberæ˜¯å¦æ­£ç¡®ï¼Œå³ç¬¬ä¸€æ¬¡å‘é€çš„seq number+1ï¼Œä»¥åŠä½ç ackæ˜¯å¦ä¸º1ï¼Œè‹¥æ­£ç¡®ï¼Œä¸»æœºAä¼šå†å‘é€ack number=(ä¸»æœºBçš„seq+1)ï¼Œack=1ï¼Œä¸»æœºBæ”¶åˆ°åç¡®è®¤seqå€¼ä¸ack=1åˆ™è¿æ¥å»ºç«‹æˆåŠŸã€‚&lt;/p&gt;

&lt;p&gt;å®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸»æœºAä¸ä¸»æœºBå¼€å§‹ä¼ é€æ•°æ®ã€‚
 åœ¨TCP/IPåè®®ä¸­ï¼ŒTCPåè®®æä¾›å¯é çš„è¿æ¥æœåŠ¡ï¼Œé‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹ä¸€ä¸ªè¿æ¥ã€‚  ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€synåŒ…(syn=j)åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥SYN_SENDçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ï¼›  ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨æ”¶åˆ°synåŒ…ï¼Œå¿…é¡»ç¡®è®¤å®¢æˆ·çš„SYNï¼ˆack=j+1ï¼‰ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªSYNåŒ…ï¼ˆsyn=kï¼‰ï¼Œå³SYN+ACKåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVçŠ¶æ€ï¼›&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYNï¼‹ACKåŒ…ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤åŒ…ACK(ack=k+1)ï¼Œæ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚å®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å¼€å§‹ä¼ é€æ•°æ®.&lt;/p&gt;

&lt;p&gt;URGï¼šæ­¤æ ‡å¿—è¡¨ç¤ºTCPåŒ…çš„ç´§æ€¥æŒ‡é’ˆåŸŸï¼ˆåé¢é©¬ä¸Šå°±è¦è¯´åˆ°ï¼‰æœ‰æ•ˆï¼Œç”¨æ¥ä¿è¯TCPè¿æ¥ä¸è¢«ä¸­æ–­ï¼Œå¹¶ä¸”ç£ä¿ƒä¸­é—´å±‚è®¾å¤‡è¦å°½å¿«å¤„ç†è¿™äº›æ•°æ®ï¼›&lt;/p&gt;

&lt;p&gt;ACKï¼šæ­¤æ ‡å¿—è¡¨ç¤ºåº”ç­”åŸŸæœ‰æ•ˆï¼Œå°±æ˜¯è¯´å‰é¢æ‰€è¯´çš„TCPåº”ç­”å·å°†ä¼šåŒ…å«åœ¨TCPæ•°æ®åŒ…ä¸­ï¼›æœ‰ä¸¤ä¸ªå–å€¼ï¼š0å’Œ1ï¼Œä¸º1çš„æ—¶å€™è¡¨ç¤ºåº”ç­”åŸŸæœ‰æ•ˆï¼Œåä¹‹ä¸º0ï¼›&lt;/p&gt;

&lt;p&gt;PSHï¼šè¿™ä¸ªæ ‡å¿—ä½è¡¨ç¤ºPushæ“ä½œã€‚æ‰€è°“Pushæ“ä½œå°±æ˜¯æŒ‡åœ¨æ•°æ®åŒ…åˆ°è¾¾æ¥æ”¶ç«¯ä»¥åï¼Œç«‹å³ä¼ é€ç»™åº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯åœ¨ç¼“å†²åŒºä¸­æ’é˜Ÿï¼›&lt;/p&gt;

&lt;p&gt;RSTï¼šè¿™ä¸ªæ ‡å¿—è¡¨ç¤ºè¿æ¥å¤ä½è¯·æ±‚ã€‚ç”¨æ¥å¤ä½é‚£äº›äº§ç”Ÿé”™è¯¯çš„è¿æ¥ï¼Œä¹Ÿè¢«ç”¨æ¥æ‹’ç»é”™è¯¯å’Œéæ³•çš„æ•°æ®åŒ…ï¼›&lt;/p&gt;

&lt;p&gt;SYNï¼šè¡¨ç¤ºåŒæ­¥åºå·ï¼Œç”¨æ¥å»ºç«‹è¿æ¥ã€‚SYNæ ‡å¿—ä½å’ŒACKæ ‡å¿—ä½æ­é…ä½¿ç”¨ï¼Œå½“è¿æ¥è¯·æ±‚çš„æ—¶å€™ï¼ŒSYN=1ï¼ŒACK=0ï¼›è¿æ¥è¢«ç›¸åº”çš„æ—¶å€™ï¼ŒSYN=1ï¼ŒACK= 1ï¼›è¿™ä¸ªæ ‡å¿—çš„æ•°æ®åŒ…ç»å¸¸è¢«ç”¨æ¥è¿›è¡Œç«¯å£æ‰«æã€‚æ‰«æè€…å‘é€ä¸€ä¸ªåªæœ‰SYNçš„æ•°æ®åŒ…ï¼Œå¦‚æœå¯¹æ–¹ä¸»æœºå“åº”äº†ä¸€ä¸ªæ•°æ®åŒ…å›æ¥ï¼Œå°±è¡¨æ˜è¿™å°ä¸»æœºå­˜åœ¨è¿™ä¸ªç«¯å£ï¼›ä½†æ˜¯ç”±äºè¿™ç§æ‰«ææ–¹å¼åªæ˜¯è¿›è¡ŒTCPä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œå› æ­¤è¿™ç§æ‰«æçš„æˆåŠŸè¡¨ç¤ºè¢«æ‰«æçš„æœºå™¨ä¸å¾ˆå®‰å…¨ï¼Œä¸€å°å®‰å…¨çš„ä¸»æœºå°†ä¼šå¼ºåˆ¶è¦æ±‚ä¸€ä¸ªè¿æ¥ä¸¥æ ¼çš„è¿›è¡ŒTCPçš„ä¸‰æ¬¡æ¡æ‰‹ï¼›&lt;/p&gt;

&lt;p&gt;FINï¼šè¡¨ç¤ºå‘é€ç«¯å·²ç»è¾¾åˆ°æ•°æ®æœ«å°¾ï¼Œä¹Ÿå°±æ˜¯è¯´åŒæ–¹çš„æ•°æ®ä¼ é€å®Œæˆï¼Œæ²¡æœ‰æ•°æ®å¯ä»¥ä¼ é€äº†ï¼Œå‘é€FINæ ‡å¿—ä½çš„TCPæ•°æ®åŒ…åï¼Œè¿æ¥å°†è¢«æ–­å¼€ã€‚è¿™ä¸ªæ ‡å¿—çš„æ•°æ®åŒ…ä¹Ÿç»å¸¸è¢«ç”¨äºè¿›è¡Œç«¯å£æ‰«æã€‚å½“ä¸€ä¸ªFINæ ‡å¿—çš„TCPæ•°æ®åŒ…å‘é€åˆ°ä¸€å°è®¡ç®—æœºçš„ç‰¹å®šç«¯å£ï¼Œå¦‚æœè¿™å°è®¡ç®—æœºå“åº”äº†è¿™ä¸ªæ•°æ®ï¼Œå¹¶ä¸”åé¦ˆå›æ¥ä¸€ä¸ªRSTæ ‡å¿—çš„TCPåŒ…ï¼Œå°±è¡¨æ˜è¿™å°è®¡ç®—æœºä¸Šæ²¡æœ‰æ‰“å¼€è¿™ä¸ªç«¯å£ï¼Œä½†æ˜¯è¿™å°è®¡ç®—æœºæ˜¯å­˜åœ¨çš„ï¼›å¦‚æœè¿™å°è®¡ç®—æœºæ²¡æœ‰åé¦ˆå›æ¥ä»»ä½•æ•°æ®åŒ…ï¼Œè¿™å°±è¡¨æ˜ï¼Œè¿™å°è¢«æ‰«æçš„è®¡ç®—æœºå­˜åœ¨è¿™ä¸ªç«¯å£ã€‚&lt;/p&gt;

&lt;p&gt;*SYNï¼šåŒæ­¥æ ‡å¿—
åŒæ­¥åºåˆ—ç¼–å·(Synchronize Sequence Numbers)æ æœ‰æ•ˆã€‚è¯¥æ ‡å¿—ä»…åœ¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹TCPè¿æ¥æ—¶æœ‰æ•ˆã€‚å®ƒæç¤ºTCPè¿æ¥çš„æœåŠ¡ç«¯æ£€æŸ¥åºåˆ—ç¼–å·ï¼Œè¯¥åºåˆ—ç¼–å·ä¸ºTCPè¿æ¥åˆå§‹ç«¯(ä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯)çš„åˆå§‹åºåˆ—ç¼–å·ã€‚åœ¨è¿™é‡Œï¼Œå¯ä»¥æŠŠ TCPåºåˆ—ç¼–å·çœ‹ä½œæ˜¯ä¸€ä¸ªèŒƒå›´ä»0åˆ°4ï¼Œ294ï¼Œ967ï¼Œ295çš„32ä½è®¡æ•°å™¨ã€‚é€šè¿‡TCPè¿æ¥äº¤æ¢çš„æ•°æ®ä¸­æ¯ä¸€ä¸ªå­—èŠ‚éƒ½ç»è¿‡åºåˆ—ç¼–å·ã€‚åœ¨TCPæŠ¥å¤´ä¸­çš„åºåˆ—ç¼–å·æ åŒ…æ‹¬äº†TCPåˆ†æ®µä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—ç¼–å·ã€‚&lt;/p&gt;

&lt;p&gt;*ACKï¼šç¡®è®¤æ ‡å¿—
ç¡®è®¤ç¼–å·(Acknowledgement Number)æ æœ‰æ•ˆã€‚å¤§å¤šæ•°æƒ…å†µä¸‹è¯¥æ ‡å¿—ä½æ˜¯ç½®ä½çš„ã€‚TCPæŠ¥å¤´å†…çš„ç¡®è®¤ç¼–å·æ å†…åŒ…å«çš„ç¡®è®¤ç¼–å·(w+1ï¼ŒFigure-1)ä¸ºä¸‹ä¸€ä¸ªé¢„æœŸçš„åºåˆ—ç¼–å·ï¼ŒåŒæ—¶æç¤ºè¿œç«¯ç³»ç»Ÿå·²ç»æˆåŠŸæ¥æ”¶æ‰€æœ‰æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;*RSTï¼šå¤ä½æ ‡å¿—
å¤ä½æ ‡å¿—æœ‰æ•ˆã€‚ç”¨äºå¤ä½ç›¸åº”çš„TCPè¿æ¥ã€‚&lt;/p&gt;

&lt;p&gt;*URGï¼šç´§æ€¥æ ‡å¿—
ç´§æ€¥(The urgent pointer) æ ‡å¿—æœ‰æ•ˆã€‚ç´§æ€¥æ ‡å¿—ç½®ä½ï¼Œ&lt;/p&gt;

&lt;p&gt;*PSHï¼šæ¨æ ‡å¿—
è¯¥æ ‡å¿—ç½®ä½æ—¶ï¼Œæ¥æ”¶ç«¯ä¸å°†è¯¥æ•°æ®è¿›è¡Œé˜Ÿåˆ—å¤„ç†ï¼Œè€Œæ˜¯å°½å¯èƒ½å¿«å°†æ•°æ®è½¬ç”±åº”ç”¨å¤„ç†ã€‚åœ¨å¤„ç† telnet æˆ– rlogin ç­‰äº¤äº’æ¨¡å¼çš„è¿æ¥æ—¶ï¼Œè¯¥æ ‡å¿—æ€»æ˜¯ç½®ä½çš„ã€‚&lt;/p&gt;

&lt;p&gt;*FINï¼šç»“æŸæ ‡å¿—
å¸¦æœ‰è¯¥æ ‡å¿—ç½®ä½çš„æ•°æ®åŒ…ç”¨æ¥ç»“æŸä¸€ä¸ªTCPå›è¯ï¼Œä½†å¯¹åº”ç«¯å£ä»å¤„äºå¼€æ”¾çŠ¶æ€ï¼Œå‡†å¤‡æ¥æ”¶åç»­æ•°æ®ã€‚
.TCPçš„å‡ ä¸ªçŠ¶æ€å¯¹äºæˆ‘ä»¬åˆ†ææ‰€èµ·çš„ä½œç”¨ã€‚åœ¨TCPå±‚ï¼Œæœ‰ä¸ªFLAGSå­—æ®µï¼Œè¿™ä¸ªå­—æ®µæœ‰ä»¥ä¸‹å‡ ä¸ªæ ‡è¯†ï¼šSYN, FIN, ACK, PSH, RST, URG.å…¶ä¸­ï¼Œå¯¹äºæˆ‘ä»¬æ—¥å¸¸çš„åˆ†ææœ‰ç”¨çš„å°±æ˜¯å‰é¢çš„äº”ä¸ªå­—æ®µã€‚å®ƒä»¬çš„å«ä¹‰æ˜¯ï¼šSYNè¡¨ç¤ºå»ºç«‹è¿æ¥ï¼ŒFINè¡¨ç¤ºå…³é—­è¿æ¥ï¼ŒACKè¡¨ç¤ºå“åº”ï¼ŒPSHè¡¨ç¤ºæœ‰ DATAæ•°æ®ä¼ è¾“ï¼ŒRSTè¡¨ç¤ºè¿æ¥é‡ç½®ã€‚å…¶ä¸­ï¼ŒACKæ˜¯å¯èƒ½ä¸SYNï¼ŒFINç­‰åŒæ—¶ä½¿ç”¨çš„ï¼Œæ¯”å¦‚SYNå’ŒACKå¯èƒ½åŒæ—¶ä¸º1ï¼Œå®ƒè¡¨ç¤ºçš„å°±æ˜¯å»ºç«‹è¿æ¥ä¹‹åçš„å“åº”ï¼Œå¦‚æœåªæ˜¯å•ä¸ªçš„ä¸€ä¸ªSYNï¼Œå®ƒè¡¨ç¤ºçš„åªæ˜¯å»ºç«‹è¿æ¥ã€‚TCPçš„å‡ æ¬¡æ¡æ‰‹å°±æ˜¯é€šè¿‡è¿™æ ·çš„ACKè¡¨ç°å‡ºæ¥çš„ã€‚ä½†SYNä¸FINæ˜¯ä¸ä¼šåŒæ—¶ä¸º1çš„ï¼Œå› ä¸ºå‰è€…è¡¨ç¤ºçš„æ˜¯å»ºç«‹è¿æ¥ï¼Œè€Œåè€…è¡¨ç¤ºçš„æ˜¯æ–­å¼€è¿æ¥ã€‚RSTä¸€èˆ¬æ˜¯åœ¨FINä¹‹åæ‰ä¼šå‡ºç°ä¸º1çš„æƒ…å†µï¼Œè¡¨ç¤ºçš„æ˜¯è¿æ¥é‡ç½®ã€‚ä¸€èˆ¬åœ°ï¼Œå½“å‡ºç°FINåŒ…æˆ–RSTåŒ…æ—¶ï¼Œæˆ‘ä»¬ä¾¿è®¤ä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯æ–­å¼€äº†è¿æ¥ï¼›è€Œå½“å‡ºç°SYNå’ŒSYNï¼‹ACKåŒ…æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹äº†ä¸€ä¸ªè¿æ¥ã€‚PSHä¸º1çš„æƒ…å†µï¼Œä¸€èˆ¬åªå‡ºç°åœ¨ DATAå†…å®¹ä¸ä¸º0çš„åŒ…ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´PSHä¸º1è¡¨ç¤ºçš„æ˜¯æœ‰çœŸæ­£çš„TCPæ•°æ®åŒ…å†…å®¹è¢«ä¼ é€’ã€‚TCPçš„è¿æ¥å»ºç«‹å’Œè¿æ¥å…³é—­ï¼Œéƒ½æ˜¯é€šè¿‡è¯·æ±‚ï¼å“åº”çš„æ¨¡å¼å®Œæˆçš„ã€‚&lt;/p&gt;
</description>
        <pubDate>Fri, 22 Dec 2017 00:00:00 +0800</pubDate>
        <link>https://xiazemin.github.io/MyBlog/web/2017/12/22/tcp_flag.html</link>
        <guid isPermaLink="true">https://xiazemin.github.io/MyBlog/web/2017/12/22/tcp_flag.html</guid>
        
        
        <category>web</category>
        
      </item>
    
      <item>
        <title>urlçŸ­é“¾</title>
        <description>&lt;p&gt;ä»€ä¹ˆæ˜¯çŸ­é“¾æ¥ ğŸ”—
å°±æ˜¯æŠŠæ™®é€šç½‘å€ï¼Œè½¬æ¢æˆæ¯”è¾ƒçŸ­çš„ç½‘å€ã€‚æ¯”å¦‚ï¼šhttp://t.cn/RlB2PdD è¿™ç§ï¼Œåœ¨å¾®åšè¿™äº›é™åˆ¶å­—æ•°çš„åº”ç”¨é‡Œã€‚å¥½å¤„ä¸è¨€è€Œå–»ã€‚çŸ­ã€å­—ç¬¦å°‘ã€ç¾è§‚ã€ä¾¿äºå‘å¸ƒã€ä¼ æ’­ã€‚&lt;/p&gt;

&lt;p&gt;ç™¾åº¦çŸ­ç½‘å€ http://dwz.cn/
è°·æ­ŒçŸ­ç½‘å€æœåŠ¡ https://goo.gl/ ï¼ˆéœ€ç§‘å­¦ä¸Šç½‘ï¼‰å·ç§°æ˜¯æœ€å¿«çš„ ğŸš€&lt;/p&gt;

&lt;p&gt;åŸç†è§£æ
å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨é‡Œè¾“å…¥ http://t.cn/RlB2PdD æ—¶&lt;/p&gt;

&lt;p&gt;DNSé¦–å…ˆè§£æè·å¾— http://t.cn çš„ IP åœ°å€&lt;/p&gt;

&lt;p&gt;å½“ DNS è·å¾— IP åœ°å€ä»¥åï¼ˆæ¯”å¦‚ï¼š74.125.225.72ï¼‰ï¼Œä¼šå‘è¿™ä¸ªåœ°å€å‘é€ HTTP GET è¯·æ±‚ï¼ŒæŸ¥è¯¢çŸ­ç  RlB2PdD&lt;/p&gt;

&lt;p&gt;http://t.cn æœåŠ¡å™¨ä¼šé€šè¿‡çŸ­ç  RlB2PdD è·å–å¯¹åº”çš„é•¿ URL&lt;/p&gt;

&lt;p&gt;è¯·æ±‚é€šè¿‡ HTTP 301 è½¬åˆ°å¯¹åº”çš„é•¿ URL https://m.helijia.com ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œæœ‰ä¸ªå°çš„çŸ¥è¯†ç‚¹ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ 301 è·³è½¬è€Œä¸æ˜¯ 302 å‘ï¼Ÿ&lt;/p&gt;

&lt;p&gt;301 æ˜¯æ°¸ä¹…é‡å®šå‘ï¼Œ302 æ˜¯ä¸´æ—¶é‡å®šå‘ã€‚çŸ­åœ°å€ä¸€ç»ç”Ÿæˆå°±ä¸ä¼šå˜åŒ–ï¼Œæ‰€ä»¥ç”¨ 301 æ˜¯ç¬¦åˆ http è¯­ä¹‰çš„ã€‚åŒæ—¶å¯¹æœåŠ¡å™¨å‹åŠ›ä¹Ÿä¼šæœ‰ä¸€å®šå‡å°‘ã€‚
ä½†æ˜¯å¦‚æœä½¿ç”¨äº† 301ï¼Œæˆ‘ä»¬å°±æ— æ³•ç»Ÿè®¡åˆ°çŸ­åœ°å€è¢«ç‚¹å‡»çš„æ¬¡æ•°äº†ã€‚è€Œè¿™ä¸ªç‚¹å‡»æ¬¡æ•°æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„å¤§æ•°æ®åˆ†ææ•°æ®æºã€‚èƒ½å¤Ÿåˆ†æå‡ºçš„ä¸œè¥¿éå¸¸éå¸¸å¤šã€‚æ‰€ä»¥é€‰æ‹©302è™½ç„¶ä¼šå¢åŠ æœåŠ¡å™¨å‹åŠ›ï¼Œä½†æ˜¯æˆ‘æƒ³æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚&lt;/p&gt;

&lt;p&gt;ç®—æ³•å®ç°
ç½‘ä¸Šæ¯”è¾ƒæµè¡Œçš„ç®—æ³•æœ‰ä¸¤ç§ è‡ªå¢åºåˆ—ç®—æ³•ã€ æ‘˜è¦ç®—æ³•&lt;/p&gt;

&lt;p&gt;ç®—æ³•ä¸€
è‡ªå¢åºåˆ—ç®—æ³• ä¹Ÿå«æ°¸ä¸é‡å¤ç®—æ³•&lt;/p&gt;

&lt;p&gt;è®¾ç½® id è‡ªå¢ï¼Œä¸€ä¸ª 10è¿›åˆ¶ id å¯¹åº”ä¸€ä¸ª 62è¿›åˆ¶çš„æ•°å€¼ï¼Œ1å¯¹1ï¼Œä¹Ÿå°±ä¸ä¼šå‡ºç°é‡å¤çš„æƒ…å†µã€‚è¿™ä¸ªåˆ©ç”¨çš„å°±æ˜¯ä½è¿›åˆ¶è½¬åŒ–ä¸ºé«˜è¿›åˆ¶æ—¶ï¼Œå­—ç¬¦æ•°ä¼šå‡å°‘çš„ç‰¹æ€§ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚ä¸‹å›¾ï¼šåè¿›åˆ¶ 10000ï¼Œå¯¹åº”ä¸åŒè¿›åˆ¶çš„å­—ç¬¦è¡¨ç¤ºã€‚
çŸ­å€çš„é•¿åº¦ä¸€èˆ¬è®¾ä¸º 6 ä½ï¼Œè€Œæ¯ä¸€ä½æ˜¯ç”± [a - z, A - Z, 0 - 9] æ€»å…± 62 ä¸ªå­—æ¯ç»„æˆçš„ï¼Œæ‰€ä»¥ 6 ä½çš„è¯ï¼Œæ€»å…±ä¼šæœ‰ 62^6 ~= 568äº¿ç§ç»„åˆï¼ŒåŸºæœ¬ä¸Šå¤Ÿç”¨äº†ã€‚
è¿™é‡Œé™„ä¸Šä¸€ä¸ªè¿›åˆ¶è½¬æ¢å·¥å…· http://tool.lu/hexconvert/ ä¸Šå›¾çš„æ•°æ®å°±æ˜¯ç”¨è¿™ä¸ªå·¥å…·ç”Ÿæˆçš„ã€‚&lt;/p&gt;

&lt;p&gt;ç®—æ³•äºŒ
å°†é•¿ç½‘å€ md5 ç”Ÿæˆ 32 ä½ç­¾åä¸²,åˆ†ä¸º 4 æ®µ, æ¯æ®µ 8 ä¸ªå­—èŠ‚&lt;/p&gt;

&lt;p&gt;å¯¹è¿™å››æ®µå¾ªç¯å¤„ç†, å– 8 ä¸ªå­—èŠ‚, å°†ä»–çœ‹æˆ 16 è¿›åˆ¶ä¸²ä¸ 0x3fffffff(30ä½1) ä¸æ“ä½œ, å³è¶…è¿‡ 30 ä½çš„å¿½ç•¥å¤„ç†&lt;/p&gt;

&lt;p&gt;è¿™ 30 ä½åˆ†æˆ 6 æ®µ, æ¯ 5 ä½çš„æ•°å­—ä½œä¸ºå­—æ¯è¡¨çš„ç´¢å¼•å–å¾—ç‰¹å®šå­—ç¬¦, ä¾æ¬¡è¿›è¡Œè·å¾— 6 ä½å­—ç¬¦ä¸²&lt;/p&gt;

&lt;p&gt;æ€»çš„ md5 ä¸²å¯ä»¥è·å¾— 4 ä¸ª 6 ä½ä¸²,å–é‡Œé¢çš„ä»»æ„ä¸€ä¸ªå°±å¯ä½œä¸ºè¿™ä¸ªé•¿ url çš„çŸ­ url åœ°å€&lt;/p&gt;

&lt;p&gt;è¿™ç§ç®—æ³•,è™½ç„¶ä¼šç”Ÿæˆ4ä¸ª,ä½†æ˜¯ä»ç„¶å­˜åœ¨é‡å¤å‡ ç‡&lt;/p&gt;

&lt;p&gt;ä¸¤ç§ç®—æ³•å¯¹æ¯”
ç¬¬ä¸€ç§ç®—æ³•çš„å¥½å¤„å°±æ˜¯ç®€å•å¥½ç†è§£ï¼Œæ°¸ä¸é‡å¤ã€‚ä½†æ˜¯çŸ­ç çš„é•¿åº¦ä¸å›ºå®šï¼Œéšç€ id å˜å¤§ä»ä¸€ä½é•¿åº¦å¼€å§‹é€’å¢ã€‚å¦‚æœéè¦è®©çŸ­ç é•¿åº¦å›ºå®šä¹Ÿå¯ä»¥å°±æ˜¯è®© id ä»æŒ‡å®šçš„æ•°å­—å¼€å§‹é€’å¢å°±å¯ä»¥äº†ã€‚ç™¾åº¦çŸ­ç½‘å€ç”¨çš„è¿™ç§ç®—æ³•ã€‚ä¸Šæ–‡è¯´çš„å¼€æºçŸ­ç½‘å€é¡¹ç›® YOURLS ä¹Ÿæ˜¯é‡‡ç”¨äº†è¿™ç§ç®—æ³•ã€‚æºç å­¦ä¹ &lt;/p&gt;

&lt;p&gt;ç¬¬äºŒç§ç®—æ³•ï¼Œå­˜åœ¨ç¢°æ’ï¼ˆé‡å¤ï¼‰çš„å¯èƒ½æ€§ï¼Œè™½ç„¶å‡ ç‡å¾ˆå°ã€‚çŸ­ç ä½æ•°æ˜¯æ¯”è¾ƒå›ºå®šçš„ã€‚ä¸ä¼šä»ä¸€ä½é•¿åº¦é€’å¢åˆ°å¤šä½çš„ã€‚æ®è¯´å¾®åšä½¿ç”¨çš„è¿™ç§ç®—æ³•ã€‚
å…¶å®å¾ˆç®€å• ï¼Œç³»ç»ŸæŠŠä¸€ä¸ªé•¿çš„åœ°å€ å¦‚ http://www.xxx.com/ddd/xxx/a.html?dsada 
é¦–å…ˆç”¨ä¸€ä¸ªç®—æ³•è½¬æ¢æˆ çŸ­åœ°å€ http://t.cn/Afafhe 
ç„¶åæŠŠ  Afafheâ€“&amp;gt;http://www.xxx.com/ddd/xxx/a.html?dsada çš„å…³ç³»ä¿å­˜åˆ°æ•°æ®åº“ä¸­&lt;/p&gt;

&lt;p&gt;å½“ç”¨æˆ·è®¿é—® http://t.cn/Afafheç½‘å€æ—¶ï¼Œç³»ç»Ÿåˆ°æ•°æ®åº“æ‰¾åˆ°å¯¹åº”çš„URLåœ°å€ï¼Œå®ç°è·³è½¬&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆæˆ‘ä»¬è¦çŸ¥é“çš„1ã€ç®—æ³• 2ã€ç³»ç»Ÿçš„å­˜å‚¨æ–¹å¼&lt;/p&gt;

&lt;p&gt;é¦–å…ˆçœ‹ç®—æ³•å§ï¼Œç½‘ä¸Šæœç´¢äº†ä¸‹ï¼Œå¤§è‡´æ˜¯ç”¨MD5ä»€ä¹ˆçš„ç”Ÿæˆçš„ ï¼Œå…¶å®è¿™ä¸ªç®—æ³•ä¸»è¦æ˜¯æŠŠé•¿å­—ç¬¦ä¸²å˜å° ï¼Œè¿™ä¸ªç®—æ³•æ˜¯ä¸å¯é€†çš„ï¼Œæ‰€ä»¥åˆ«æƒ³ç€å»ç›´æ¥åè½¬çŸ­åœ°å€ 
è¦è¯¦ç»†çœ‹ç®—æ³•çš„ å¯ä»¥åˆ°ç½‘ä¸Šæœç´¢èµ„æ–™&lt;/p&gt;

&lt;p&gt;2ã€ç³»ç»Ÿçš„å­˜å‚¨æ–¹å¼ ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±å†™ç€ç©ï¼Œé‚£ç›´æ¥æ‰¾ä¸ªSQL Server æˆ–è€…MySql ä¹‹ç±»çš„å°±å¯ä»¥ï¼Œä½†æ˜¯æƒ³æ–°æµªå¾®åšä¹‹ç±»çš„å¤§å‹ç½‘ç«™ï¼Œé‚£ä¸ªæ•°æ®é‡æ˜¯éå¸¸å·¨å¤§çš„ï¼Œæˆ‘æƒ³ä»–ä»¬åº”è¯¥ç”¨çš„NoSql éå…³ç³»å‹æ•°æ®åº“ï¼ˆåº”è¯¥ä¹Ÿå°±æ˜¯äººä»¬è¯´çš„åˆ†å¸ƒå¼æ•°æ®åº“ ï¼‰ï¼Œä¸€äº›å¼€æºçš„  å¦‚Facebook çš„Cassandraï¼Œ Apache çš„HBaseï¼Œä¹Ÿå¾—åˆ°äº†å¹¿æ³›è®¤åŒã€‚ä»è¿™äº›NoSQLé¡¹ç›®çš„åå­—ä¸Šçœ‹ä¸å‡ºä»€ä¹ˆç›¸åŒä¹‹å¤„ï¼šHadoopã€Voldemortã€Dynomiteï¼Œè¿˜æœ‰å…¶å®ƒå¾ˆå¤šã€‚ã€ 
http://baike.baidu.com/view/2677528.htm 
  çŸ­ç½‘å€æœåŠ¡ï¼Œå¯èƒ½å¾ˆå¤šæœ‹å‹éƒ½å·²ç»ä¸å†é™Œç”Ÿï¼Œç°åœ¨å¤§éƒ¨åˆ†å¾®åšã€æ‰‹æœºé‚®ä»¶æé†’ç­‰åœ°æ–¹å·²ç»æœ‰å¾ˆå¤šåº”ç”¨æ¨¡å¼äº†ï¼Œå¹¶å æ®äº†ä¸€å®šçš„å¸‚åœºã€‚ä¼°è®¡å¾ˆå¤šæœ‹å‹ç°åœ¨ä¹Ÿæ­£åœ¨ä½¿ç”¨ã€‚ 
       çœ‹è¿‡æ–°æµªçš„çŸ­è¿æ¥æœåŠ¡ï¼Œå‘ç°åé¢ä¸»è¦æœ‰6ä¸ªå­—ç¬¦ä¸²ç»„æˆï¼Œäºæ˜¯ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯åŸæ¥å…¬å¸å†™çš„ä¸€ä¸ªæ¸¸æˆæ¿€æ´»ç è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ç®—æ³•2ï¼Œ
       26ä¸ªå¤§å†™å­—æ¯ 26å°å†™å­—æ¯ï¼Œ10ä¸ªæ•°å­—ï¼Œéšæœºç”Ÿæˆ6ä¸ªç„¶åæ’å…¥æ•°æ®åº“å¯¹åº”ä¸€ä¸ªidï¼ŒçŸ­è¿æ¥è·³è½¬çš„æ—¶å€™ï¼Œæ ¹æ®å­—ç¬¦ä¸²æŸ¥è¯¢åˆ°å¯¹åº”idï¼Œå³å¯å®ç°ç›¸åº”çš„è·³è½¬ï¼ä¸è¿‡2çš„62æ¬¡æ–¹ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰é‡å¤çš„ï¼Œå°æ¦‚ç‡å¯ä»¥ï¼Œä½†æ˜¯å¯¹åº”ä¸æ˜¯å¾ˆå¤§çš„ç½‘ç«™åº”è¯¥è¶³å¤Ÿäº†
è‡ªä»twitteræ¨å‡ºçŸ­ç½‘å€(shorturl),ç»§ä¹‹å›½å†…å„å¤§å¾®åšè·Ÿé£,googleå…¬å¼€goo.glä½¿ç”¨API,çŸ­ç½‘å€ä¹‹é£æ„ˆæ¼”æ„ˆçƒˆ.ä¸å¾—ä¸è¯´è¿™æ˜¯ä¸€ä¸ªæ–°å…´åˆä¸€å¤§çƒ­é—¨web2.0æœåŠ¡.ç°æ•´ç†ä¸€ä¸‹,åŒ…æ‹¬å®Œæ•´çŸ­ç½‘å€ç½‘ç«™,çŸ­ç½‘å€ç”ŸæˆåŸç†,ç®—æ³•ä¸¾ä¾‹,ä»¥åŠä¼˜åŠ£æ¯”è¾ƒ,åŒæ—¶è¿˜ä»‹ç»å‡ ä¸ªphperä¸ªäººå®ç°çš„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;çŸ­é“¾æ¥çš„å¥½å¤„ï¼š

1ã€å†…å®¹éœ€è¦ï¼›2ã€ç”¨æˆ·å‹å¥½ï¼›3ã€ä¾¿äºç®¡ç†ã€‚

ä¸ºä»€ä¹ˆè¦è¿™æ ·åšçš„ï¼ŒåŸå› æˆ‘æƒ³æœ‰è¿™æ ·å‡ ç‚¹ï¼š
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¾®åšé™åˆ¶å­—æ•°ä¸º140å­—ä¸€æ¡ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬éœ€è¦å‘ä¸€äº›è¿æ¥ä¸Šå»ï¼Œä½†æ˜¯è¿™ä¸ªè¿æ¥éå¸¸çš„é•¿ï¼Œä»¥è‡³äºå°†è¿‘è¦å ç”¨æˆ‘ä»¬å†…å®¹çš„ä¸€åŠç¯‡å¹…ï¼Œè¿™è‚¯å®šæ˜¯ä¸èƒ½è¢«å…è®¸çš„ï¼Œæ‰€ä»¥çŸ­ç½‘å€åº”è¿è€Œç”Ÿäº†ã€‚
çŸ­ç½‘å€å¯ä»¥åœ¨æˆ‘ä»¬é¡¹ç›®é‡Œå¯ä»¥å¾ˆå¥½çš„å¯¹å¼€æ”¾çº§URLè¿›è¡Œç®¡ç†ã€‚æœ‰ä¸€éƒ¨åˆ†ç½‘å€å¯ä»¥ä¼šæ¶µç›–æš´åŠ›ï¼Œå¹¿å‘Šç­‰ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡ç”¨æˆ·çš„ä¸¾æŠ¥ï¼Œå®Œå…¨ç®¡ç†è¿™ä¸ªè¿æ¥å°†ä¸å‡ºç°åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œåº”ä¸ºåŒæ ·çš„URLé€šè¿‡åŠ å¯†ç®—æ³•ä¹‹åï¼Œå¾—åˆ°çš„åœ°å€æ˜¯ä¸€æ ·çš„ã€‚
æˆ‘ä»¬å¯ä»¥å¯¹ä¸€ç³»åˆ—çš„ç½‘å€è¿›è¡Œæµé‡ï¼Œç‚¹å‡»ç­‰ç»Ÿè®¡ï¼ŒæŒ–æ˜å‡ºå¤§å¤šæ•°ç”¨æˆ·çš„å…³æ³¨ç‚¹ï¼Œè¿™æ ·æœ‰åˆ©äºæˆ‘ä»¬å¯¹é¡¹ç›®çš„åç»­å·¥ä½œæ›´å¥½çš„ä½œå‡ºå†³ç­–ã€‚
ç®—æ³•åŸç†&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;   ç®—æ³•ä¸€
   1)å°†é•¿ç½‘å€md5ç”Ÿæˆ32ä½ç­¾åä¸²,åˆ†ä¸º4æ®µ, æ¯æ®µ8ä¸ªå­—èŠ‚;
   2)å¯¹è¿™å››æ®µå¾ªç¯å¤„ç†, å–8ä¸ªå­—èŠ‚, å°†ä»–çœ‹æˆ16è¿›åˆ¶ä¸²ä¸0x3fffffff(30ä½1)ä¸æ“ä½œ, å³è¶…è¿‡30ä½çš„å¿½ç•¥å¤„ç†;
   3)è¿™30ä½åˆ†æˆ6æ®µ, æ¯5ä½çš„æ•°å­—ä½œä¸ºå­—æ¯è¡¨çš„ç´¢å¼•å–å¾—ç‰¹å®šå­—ç¬¦, ä¾æ¬¡è¿›è¡Œè·å¾—6ä½å­—ç¬¦ä¸²;
   4)æ€»çš„md5ä¸²å¯ä»¥è·å¾—4ä¸ª6ä½ä¸²; å–é‡Œé¢çš„ä»»æ„ä¸€ä¸ªå°±å¯ä½œä¸ºè¿™ä¸ªé•¿urlçš„çŸ­urlåœ°å€;
   è¿™ç§ç®—æ³•,è™½ç„¶ä¼šç”Ÿæˆ4ä¸ª,ä½†æ˜¯ä»ç„¶å­˜åœ¨é‡å¤å‡ ç‡
   
    ç®—æ³•äºŒ
    a-zA-Z0-9 è¿™64ä½å–6ä½ç»„åˆ,å¯äº§ç”Ÿ500å¤šäº¿ä¸ªç»„åˆæ•°é‡.æŠŠæ•°å­—å’Œå­—ç¬¦ç»„åˆåšä¸€å®šçš„æ˜ å°„,å°±å¯ä»¥äº§ç”Ÿå”¯ä¸€çš„å­—ç¬¦ä¸²,å¦‚ç¬¬62ä¸ªç»„åˆå°±æ˜¯aaaaa9,ç¬¬63ä¸ªç»„åˆå°±æ˜¯aaaaba,å†åˆ©ç”¨æ´—ç‰Œç®—æ³•ï¼ŒæŠŠåŸå­—ç¬¦ä¸²æ‰“ä¹±åä¿å­˜ï¼Œé‚£ä¹ˆå¯¹åº”ä½ç½®çš„ç»„åˆå­—ç¬¦ä¸²å°±ä¼šæ˜¯æ— åºçš„ç»„åˆã€‚ æŠŠé•¿ç½‘å€å­˜å…¥æ•°æ®åº“,å–è¿”å›çš„id,æ‰¾å‡ºå¯¹åº”çš„å­—ç¬¦ä¸²,ä¾‹å¦‚è¿”å›IDä¸º1ï¼Œé‚£ä¹ˆå¯¹åº”ä¸Šé¢çš„å­—ç¬¦ä¸²ç»„åˆå°±æ˜¯bbb,åŒç† IDä¸º2æ—¶ï¼Œå­—ç¬¦ä¸²ç»„åˆä¸ºbba,ä¾æ¬¡ç±»æ¨,ç›´è‡³åˆ°è¾¾64ç§ç»„åˆåæ‰ä¼šå‡ºç°é‡å¤çš„å¯èƒ½ï¼Œæ‰€ä»¥å¦‚æœç”¨ä¸Šé¢çš„62ä¸ªå­—ç¬¦ï¼Œä»»æ„å–6ä¸ªå­—ç¬¦ç»„åˆæˆå­—ç¬¦ä¸²çš„è¯ï¼Œä½ çš„æ•°æ®å­˜é‡è¾¾åˆ°500å¤šäº¿åæ‰ä¼šå‡ºç°é‡å¤çš„å¯èƒ½ã€‚
    å…·ä½“å‚çœ‹è¿™é‡Œå½»åº•å®Œå–„æ–°æµªå¾®åšæ¥å£å’Œè¶…çŸ­URLç®—æ³•,ç®—æ³•å››å¯ä»¥ç®—ä½œæ˜¯æ­¤ç®—æ³•çš„ä¸€ç§å®ç°,æ­¤ç®—æ³•ä¸€èˆ¬ä¸ä¼šé‡å¤,ä½†æ˜¯å¦‚æœæ˜¯ç»Ÿè®¡çš„è¯,å°±æœ‰å¾ˆå¤§é—®é¢˜,ç‰¹åˆ«æ˜¯å¯¹åŸŸåç›¸å…³çš„ç»Ÿè®¡
&lt;/code&gt;&lt;/pre&gt;
</description>
        <pubDate>Fri, 22 Dec 2017 00:00:00 +0800</pubDate>
        <link>https://xiazemin.github.io/MyBlog/web/2017/12/22/short_url.html</link>
        <guid isPermaLink="true">https://xiazemin.github.io/MyBlog/web/2017/12/22/short_url.html</guid>
        
        
        <category>web</category>
        
      </item>
    
      <item>
        <title>IDä¸º0å’ŒIDä¸º1çš„è¿›ç¨‹</title>
        <description>&lt;!-- more --&gt;
&lt;p&gt;IDä¸º0çš„è¿›ç¨‹é€šå¸¸æ˜¯è°ƒåº¦è¿›ç¨‹ï¼Œå¸¸å¸¸è¢«ç§°ä¸ºäº¤æ¢è¿›ç¨‹ï¼ˆswapperï¼‰ã€‚è¯¥è¿›ç¨‹æ˜¯å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¹¶ä¸æ‰§è¡Œä»»ä½•ç£ç›˜ä¸Šçš„ç¨‹åºï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºç³»ç»Ÿè¿›ç¨‹ã€‚
IDä¸º1çš„è¿›ç¨‹ï¼Œé€šå¸¸æ˜¯initè¿›ç¨‹ï¼Œåœ¨è‡ªä¸¾è¿‡ç¨‹ç»“æŸæ—¶ç”±å†…æ ¸è°ƒç”¨ã€‚è¯¥è¿›ç¨‹çš„ç¨‹åºæ–‡ä»¶ï¼Œåœ¨UNIXæ—©èµ·ç‰ˆæœ¬ä¸­æ˜¯/etc/initï¼Œåœ¨è¾ƒæ–°çš„ç‰ˆæœ¬ä¸­æ˜¯/sbin/initã€‚è¯¥è¿›ç¨‹è´Ÿè´£åœ¨è‡ªä¸¾å†…æ ¸åå¯åŠ¨ä¸€ä¸ªUNIXç³»ç»Ÿã€‚inité€šå¸¸è¯»ä¸ç³»ç»Ÿæœ‰å…³çš„åˆå§‹åŒ–æ–‡ä»¶ï¼ˆ/etc/rc*æ–‡ä»¶æˆ–/etc/inittabæ–‡ä»¶ï¼Œä»¥åŠ/etc/init.dä¸­çš„æ–‡ä»¶ï¼‰ï¼Œå¹¶å°†ç³»ç»Ÿå¼•å¯¼åˆ°ä¸€ä¸ªçŠ¶æ€ã€‚init è¿›ç¨‹ç»ä¸ä¼šç»ˆæ­¢ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„ç”¨æˆ·è¿›ç¨‹ï¼ˆä¸äº¤æ¢è¿›ç¨‹ä¸åŒï¼Œå®ƒä¸æ˜¯å†…æ ¸çš„ç³»ç»Ÿè¿›ç¨‹ï¼‰ä½†æ˜¯å®ƒä»¥è¶…çº§ç”¨æˆ·ç‰¹æƒè¿è¡Œã€‚ â€”â€”æ‘˜è‡ªAPUE
çˆ¶è¿›ç¨‹IDä¸º0çš„è¿›ç¨‹é€šå¸¸æ˜¯å†…æ ¸è¿›ç¨‹ï¼Œå®ƒä»¬ä½œä¸ºç³»ç»Ÿè‡ªä¸¾è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†è€Œå¯åŠ¨ï¼Œä½†initè¿›ç¨‹æ˜¯ä¸ªä¾‹å¤–ï¼Œå®ƒçš„çˆ¶è¿›ç¨‹æ˜¯0ï¼Œä½†æ˜¯å®ƒæ˜¯ç”¨æˆ·è¿›ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;å­è¿›ç¨‹æ˜¯é€šè¿‡çˆ¶è¿›ç¨‹åˆ›å»ºçš„ï¼Œå­è¿›ç¨‹åœ¨åˆ›å»ºæ–°çš„è¿›ç¨‹ã€‚å­è¿›ç¨‹çš„ç»“æŸå’Œçˆ¶è¿›ç¨‹çš„è¿è¡Œæ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹,å³çˆ¶è¿›ç¨‹æ°¸è¿œæ— æ³•é¢„æµ‹å­è¿›ç¨‹ åˆ°åº•ä»€ä¹ˆæ—¶å€™ç»“æŸã€‚ å½“ä¸€ä¸ª è¿›ç¨‹å®Œæˆå®ƒçš„å·¥ä½œç»ˆæ­¢ä¹‹åï¼Œå®ƒçš„çˆ¶è¿›ç¨‹éœ€è¦è°ƒç”¨wait()æˆ–è€…waitpid()ç³»ç»Ÿè°ƒç”¨å–å¾—å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ã€‚&lt;/p&gt;

&lt;p&gt;ã€€ã€€å­¤å„¿è¿›ç¨‹ï¼šä¸€ä¸ªçˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆé‚£äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹å°†è¢«initè¿›ç¨‹(è¿›ç¨‹å·ä¸º1)æ‰€æ”¶å…»ï¼Œå¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚&lt;/p&gt;

&lt;p&gt;ã€€ã€€åƒµå°¸è¿›ç¨‹ï¼šä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨forkåˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨waitæˆ–waitpidè·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ã€‚è¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµæ­»è¿›ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;é—®é¢˜åŠå±å®³&lt;/p&gt;

&lt;p&gt;ã€€ã€€unixæä¾›äº†ä¸€ç§æœºåˆ¶å¯ä»¥ä¿è¯åªè¦çˆ¶è¿›ç¨‹æƒ³çŸ¥é“å­è¿›ç¨‹ç»“æŸæ—¶çš„çŠ¶æ€ä¿¡æ¯ï¼Œ å°±å¯ä»¥å¾—åˆ°ã€‚è¿™ç§æœºåˆ¶å°±æ˜¯: åœ¨æ¯ä¸ªè¿›ç¨‹é€€å‡ºçš„æ—¶å€™,å†…æ ¸é‡Šæ”¾è¯¥è¿›ç¨‹æ‰€æœ‰çš„èµ„æº,åŒ…æ‹¬æ‰“å¼€çš„æ–‡ä»¶,å ç”¨çš„å†…å­˜ç­‰ã€‚ ä½†æ˜¯ä»ç„¶ä¸ºå…¶ä¿ç•™ä¸€å®šçš„ä¿¡æ¯(åŒ…æ‹¬è¿›ç¨‹å·the process ID,é€€å‡ºçŠ¶æ€the termination status of the process,è¿è¡Œæ—¶é—´the amount of CPU time taken by the processç­‰)ã€‚ç›´åˆ°çˆ¶è¿›ç¨‹é€šè¿‡wait / waitpidæ¥å–æ—¶æ‰é‡Šæ”¾ã€‚ ä½†è¿™æ ·å°±å¯¼è‡´äº†é—®é¢˜ï¼Œå¦‚æœè¿›ç¨‹ä¸è°ƒç”¨wait / waitpidçš„è¯ï¼Œ é‚£ä¹ˆä¿ç•™çš„é‚£æ®µä¿¡æ¯å°±ä¸ä¼šé‡Šæ”¾ï¼Œå…¶è¿›ç¨‹å·å°±ä¼šä¸€ç›´è¢«å ç”¨ï¼Œä½†æ˜¯ç³»ç»Ÿæ‰€èƒ½ä½¿ç”¨çš„è¿›ç¨‹å·æ˜¯æœ‰é™çš„ï¼Œå¦‚æœå¤§é‡çš„äº§ç”Ÿåƒµæ­»è¿›ç¨‹ï¼Œå°†å› ä¸ºæ²¡æœ‰å¯ç”¨çš„è¿›ç¨‹å·è€Œå¯¼è‡´ç³»ç»Ÿä¸èƒ½äº§ç”Ÿæ–°çš„è¿›ç¨‹. æ­¤å³ä¸ºåƒµå°¸è¿›ç¨‹çš„å±å®³ï¼Œåº”å½“é¿å…ã€‚&lt;/p&gt;

&lt;p&gt;ã€€ã€€å­¤å„¿è¿›ç¨‹æ˜¯æ²¡æœ‰çˆ¶è¿›ç¨‹çš„è¿›ç¨‹ï¼Œå­¤å„¿è¿›ç¨‹è¿™ä¸ªé‡ä»»å°±è½åˆ°äº†initè¿›ç¨‹èº«ä¸Šï¼Œinitè¿›ç¨‹å°±å¥½åƒæ˜¯ä¸€ä¸ªæ°‘æ”¿å±€ï¼Œä¸“é—¨è´Ÿè´£å¤„ç†å­¤å„¿è¿›ç¨‹çš„å–„åå·¥ä½œã€‚æ¯å½“å‡ºç°ä¸€ä¸ªå­¤å„¿è¿›ç¨‹çš„æ—¶å€™ï¼Œå†…æ ¸å°±æŠŠå­¤ å„¿è¿›ç¨‹çš„çˆ¶è¿›ç¨‹è®¾ç½®ä¸ºinitï¼Œè€Œinitè¿›ç¨‹ä¼šå¾ªç¯åœ°wait()å®ƒçš„å·²ç»é€€å‡ºçš„å­è¿›ç¨‹ã€‚è¿™æ ·ï¼Œå½“ä¸€ä¸ªå­¤å„¿è¿›ç¨‹å‡„å‡‰åœ°ç»“æŸäº†å…¶ç”Ÿå‘½å‘¨æœŸçš„æ—¶å€™ï¼Œinitè¿›ç¨‹å°±ä¼šä»£è¡¨å…šå’Œæ”¿åºœå‡ºé¢å¤„ç†å®ƒçš„ä¸€åˆ‡å–„åå·¥ä½œã€‚å› æ­¤å­¤å„¿è¿›ç¨‹å¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå±å®³ã€‚&lt;/p&gt;

&lt;p&gt;ã€€ã€€ä»»ä½•ä¸€ä¸ªå­è¿›ç¨‹(inité™¤å¤–)åœ¨exit()ä¹‹åï¼Œå¹¶éé©¬ä¸Šå°±æ¶ˆå¤±æ‰ï¼Œè€Œæ˜¯ç•™ä¸‹ä¸€ä¸ªç§°ä¸ºåƒµå°¸è¿›ç¨‹(Zombie)çš„æ•°æ®ç»“æ„ï¼Œç­‰å¾…çˆ¶è¿›ç¨‹å¤„ç†ã€‚è¿™æ˜¯æ¯ä¸ª å­è¿›ç¨‹åœ¨ç»“æŸæ—¶éƒ½è¦ç»è¿‡çš„é˜¶æ®µã€‚å¦‚æœå­è¿›ç¨‹åœ¨exit()ä¹‹åï¼Œçˆ¶è¿›ç¨‹æ²¡æœ‰æ¥å¾—åŠå¤„ç†ï¼Œè¿™æ—¶ç”¨pså‘½ä»¤å°±èƒ½çœ‹åˆ°å­è¿›ç¨‹çš„çŠ¶æ€æ˜¯â€œZâ€ã€‚å¦‚æœçˆ¶è¿›ç¨‹èƒ½åŠæ—¶ å¤„ç†ï¼Œå¯èƒ½ç”¨pså‘½ä»¤å°±æ¥ä¸åŠçœ‹åˆ°å­è¿›ç¨‹çš„åƒµå°¸çŠ¶æ€ï¼Œä½†è¿™å¹¶ä¸ç­‰äºå­è¿›ç¨‹ä¸ç»è¿‡åƒµå°¸çŠ¶æ€ã€‚  å¦‚æœçˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹ç»“æŸä¹‹å‰é€€å‡ºï¼Œåˆ™å­è¿›ç¨‹å°†ç”±initæ¥ç®¡ã€‚initå°†ä¼šä»¥çˆ¶è¿›ç¨‹çš„èº«ä»½å¯¹åƒµå°¸çŠ¶æ€çš„å­è¿›ç¨‹è¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;ã€€ã€€åƒµå°¸è¿›ç¨‹å±å®³åœºæ™¯ï¼š&lt;/p&gt;

&lt;p&gt;ã€€ã€€ä¾‹å¦‚æœ‰ä¸ªè¿›ç¨‹ï¼Œå®ƒå®šæœŸçš„äº§ ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¿™ä¸ªå­è¿›ç¨‹éœ€è¦åšçš„äº‹æƒ…å¾ˆå°‘ï¼Œåšå®Œå®ƒè¯¥åšçš„äº‹æƒ…ä¹‹åå°±é€€å‡ºäº†ï¼Œå› æ­¤è¿™ä¸ªå­è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œä½†æ˜¯ï¼Œçˆ¶è¿›ç¨‹åªç®¡ç”Ÿæˆæ–°çš„å­è¿›ç¨‹ï¼Œè‡³äºå­è¿›ç¨‹ é€€å‡ºä¹‹åçš„äº‹æƒ…ï¼Œåˆ™ä¸€æ¦‚ä¸é—»ä¸é—®ï¼Œè¿™æ ·ï¼Œç³»ç»Ÿè¿è¡Œä¸Šä¸€æ®µæ—¶é—´ä¹‹åï¼Œç³»ç»Ÿä¸­å°±ä¼šå­˜åœ¨å¾ˆå¤šçš„åƒµæ­»è¿›ç¨‹ï¼Œå€˜è‹¥ç”¨pså‘½ä»¤æŸ¥çœ‹çš„è¯ï¼Œå°±ä¼šçœ‹åˆ°å¾ˆå¤šçŠ¶æ€ä¸ºZçš„è¿›ç¨‹ã€‚ ä¸¥æ ¼åœ°æ¥è¯´ï¼Œåƒµæ­»è¿›ç¨‹å¹¶ä¸æ˜¯é—®é¢˜çš„æ ¹æºï¼Œç½ªé­ç¥¸é¦–æ˜¯äº§ç”Ÿå‡ºå¤§é‡åƒµæ­»è¿›ç¨‹çš„é‚£ä¸ªçˆ¶è¿›ç¨‹ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬å¯»æ±‚å¦‚ä½•æ¶ˆç­ç³»ç»Ÿä¸­å¤§é‡çš„åƒµæ­»è¿›ç¨‹æ—¶ï¼Œç­”æ¡ˆå°±æ˜¯æŠŠäº§ç”Ÿå¤§ é‡åƒµæ­»è¿›ç¨‹çš„é‚£ä¸ªå…ƒå‡¶æªæ¯™æ‰ï¼ˆä¹Ÿå°±æ˜¯é€šè¿‡killå‘é€SIGTERMæˆ–è€…SIGKILLä¿¡å·å•¦ï¼‰ã€‚æªæ¯™äº†å…ƒå‡¶è¿›ç¨‹ä¹‹åï¼Œå®ƒäº§ç”Ÿçš„åƒµæ­»è¿›ç¨‹å°±å˜æˆäº†å­¤å„¿è¿› ç¨‹ï¼Œè¿™äº›å­¤å„¿è¿›ç¨‹ä¼šè¢«initè¿›ç¨‹æ¥ç®¡ï¼Œinitè¿›ç¨‹ä¼šwait()è¿™äº›å­¤å„¿è¿›ç¨‹ï¼Œé‡Šæ”¾å®ƒä»¬å ç”¨çš„ç³»ç»Ÿè¿›ç¨‹è¡¨ä¸­çš„èµ„æºï¼Œè¿™æ ·ï¼Œè¿™äº›å·²ç»åƒµæ­»çš„å­¤å„¿è¿›ç¨‹ å°±èƒ½ç‘ç›®è€Œå»äº†ã€‚
ã€€ã€€
ã€€ã€€é¿å…äº§ç”Ÿåƒµå°¸è¿›ç¨‹&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    æˆ‘ä»¬çŸ¥é“äº†åƒµå°¸è¿›ç¨‹äº§ç”Ÿçš„åŸå› ï¼Œä¸‹è¾¹æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•é¿å…äº§ç”Ÿåƒµå°¸è¿›ç¨‹ã€‚

    ä¸€èˆ¬ï¼Œä¸ºäº†é˜²æ­¢äº§ç”Ÿåƒµå°¸è¿›ç¨‹ï¼Œåœ¨forkå­è¿›ç¨‹ä¹‹åæˆ‘ä»¬éƒ½è¦waitå®ƒä»¬ï¼›åŒæ—¶ï¼Œå½“å­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œå†…æ ¸éƒ½ä¼šç»™çˆ¶è¿›ç¨‹ä¸€ä¸ªSIGCHLDä¿¡å·ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªæ•è·SIGCHLDä¿¡å·çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œåœ¨å‡½æ•°ä½“ä¸­è°ƒç”¨waitï¼ˆæˆ–waitpidï¼‰ï¼Œå°±å¯ä»¥æ¸…ç†é€€å‡ºçš„å­è¿›ç¨‹ä»¥è¾¾åˆ°é˜²æ­¢åƒµå°¸è¿›ç¨‹çš„ç›®çš„ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š
&lt;/code&gt;&lt;/pre&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;lineno&quot;&gt; 1 &lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sig_chld&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;pid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    
&lt;span class=&quot;lineno&quot;&gt; 5 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;child %d exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8 &lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SIGCHLD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sig_chld&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ç°åœ¨mainå‡½æ•°ä¸­ç»™SIGCHLDä¿¡å·æ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼ˆsig_chldï¼‰ï¼Œç„¶ååœ¨å­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œå†…æ ¸é€’äº¤ä¸€ä¸ªSIGCHLDçš„æ—¶å€™å°±ä¼šè¢«ä¸»è¿›ç¨‹æ•è·è€Œè¿›å…¥ä¿¡å·å¤„ç†å‡½æ•°sig_chldï¼Œç„¶åå†åœ¨sig_chldä¸­è°ƒç”¨waitï¼Œå°±å¯ä»¥æ¸…ç†é€€å‡ºçš„å­è¿›ç¨‹ã€‚è¿™æ ·é€€å‡ºçš„å­è¿›ç¨‹å°±ä¸ä¼šæˆä¸ºåƒµå°¸è¿›ç¨‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    ç„¶åï¼Œå³ä¾¿æˆ‘ä»¬æ•è·SIGCHLDä¿¡å·å¹¶ä¸”è°ƒç”¨waitæ¥æ¸…ç†é€€å‡ºçš„è¿›ç¨‹ï¼Œä»ç„¶ä¸èƒ½å½»åº•é¿å…äº§ç”Ÿåƒµå°¸è¿›ç¨‹ï¼›æˆ‘ä»¬æ¥çœ‹ä¸€ç§ç‰¹æ®Šçš„æƒ…å†µï¼š

    æˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªclient/serverçš„ç¨‹åºï¼Œå¯¹äºæ¯ä¸€ä¸ªè¿æ¥è¿‡æ¥çš„clientï¼Œserveréƒ½å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹å»å¤„ç†æ¥è‡ªè¿™ä¸ªclientçš„è¯·æ±‚ã€‚ç„¶åæˆ‘ä»¬æœ‰ä¸€ä¸ªclientè¿›ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿›ç¨‹å†…ï¼Œå‘èµ·äº†å¤šä¸ªåˆ°serverçš„è¯·æ±‚ï¼ˆå‡è®¾5ä¸ªï¼‰ï¼Œåˆ™serverä¼šfork 5ä¸ªå­è¿›ç¨‹æ¥è¯»å–clientè¾“å…¥å¹¶å¤„ç†ï¼ˆåŒæ—¶ï¼Œå½“å®¢æˆ·ç«¯å…³é—­å¥—æ¥å­—çš„æ—¶å€™ï¼Œæ¯ä¸ªå­è¿›ç¨‹éƒ½é€€å‡ºï¼‰ï¼›å½“æˆ‘ä»¬ç»ˆæ­¢è¿™ä¸ªclientè¿›ç¨‹çš„æ—¶å€™ ï¼Œå†…æ ¸å°†è‡ªåŠ¨å…³é—­æ‰€æœ‰ç”±è¿™ä¸ªclientè¿›ç¨‹æ‰“å¼€çš„å¥—æ¥å­—ï¼Œé‚£ä¹ˆç”±è¿™ä¸ªclientè¿›ç¨‹å‘èµ·çš„5ä¸ªè¿æ¥åŸºæœ¬åœ¨åŒä¸€æ—¶åˆ»ç»ˆæ­¢ã€‚è¿™å°±å¼•å‘äº†5ä¸ªFINï¼Œæ¯ä¸ªè¿æ¥ä¸€ä¸ªã€‚serverç«¯æ¥å—åˆ°è¿™5ä¸ªFINçš„æ—¶å€™ï¼Œ5ä¸ªå­è¿›ç¨‹åŸºæœ¬åœ¨åŒä¸€æ—¶åˆ»ç»ˆæ­¢ã€‚è¿™å°±åˆå¯¼è‡´å·®ä¸å¤šåœ¨åŒä¸€æ—¶åˆ»é€’äº¤5ä¸ªSIGCHLDä¿¡å·ç»™çˆ¶è¿›ç¨‹   å»ºç«‹ä¿¡å·å¤„ç†å‡½æ•°å¹¶åœ¨å…¶ä¸­è°ƒç”¨waitå¹¶ä¸è¶³ä»¥é˜²æ­¢å‡ºç°åƒµå°¸è¿›ç¨‹ï¼Œå…¶åŸå› åœ¨äºï¼šæ‰€æœ‰5ä¸ªä¿¡å·éƒ½åœ¨ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œä¹‹å‰äº§ç”Ÿï¼Œè€Œä¿¡å·å¤„ç†å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸ºUnixä¿¡å·ä¸€èˆ¬æ˜¯ä¸æ’é˜Ÿçš„(æˆ‘çš„è¿™ç¯‡åšå®¢ä¸­æœ‰æåˆ°http://www.cnblogs.com/yuxingfirst/p/3160697.html)ã€‚ æ›´ä¸ºä¸¥é‡çš„æ˜¯ï¼Œæœ¬é—®é¢˜æ˜¯ä¸ç¡®å®šçš„ï¼Œä¾èµ–äºå®¢æˆ·FINåˆ°è¾¾æœåŠ¡å™¨ä¸»æœºçš„æ—¶æœºï¼Œä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œçš„æ¬¡æ•°å¹¶ä¸ç¡®å®šã€‚

   æ­£ç¡®çš„è§£å†³åŠæ³•æ˜¯è°ƒç”¨waitpidè€Œä¸æ˜¯waitï¼Œè¿™ä¸ªåŠæ³•çš„æ–¹æ³•ä¸ºï¼šä¿¡å·å¤„ç†å‡½æ•°ä¸­ï¼Œåœ¨ä¸€ä¸ªå¾ªç¯å†…è°ƒç”¨waitpidï¼Œä»¥è·å–æ‰€æœ‰å·²ç»ˆæ­¢å­è¿›ç¨‹çš„çŠ¶æ€ã€‚æˆ‘ä»¬å¿…é¡»æŒ‡å®šWNOHANGé€‰é¡¹ï¼Œä»–å‘ŠçŸ¥waitpidåœ¨æœ‰å°šæœªç»ˆæ­¢çš„å­è¿›ç¨‹åœ¨è¿è¡Œæ—¶ä¸è¦é˜»å¡ã€‚ï¼ˆæˆ‘ä»¬ä¸èƒ½åœ¨å¾ªç¯å†…è°ƒç”¨waitï¼Œå› ä¸ºæ²¡æœ‰åŠæ³•é˜²æ­¢waitåœ¨å°šæœ‰æœªç»ˆæ­¢çš„å­è¿›ç¨‹åœ¨è¿è¡Œæ—¶é˜»å¡ï¼Œwaitå°†ä¼šé˜»å¡åˆ°ç°æœ‰çš„å­è¿›ç¨‹ä¸­ç¬¬ä¸€ä¸ªç»ˆæ­¢ä¸ºæ­¢ï¼‰ï¼Œä¸‹è¾¹çš„ç¨‹åºåˆ†åˆ«ç»™å‡ºäº†è¿™ä¸¤ç§å¤„ç†åŠæ³•(func_wait, func_waitpid)ã€‚
&lt;/code&gt;&lt;/pre&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;lineno&quot;&gt;  1 &lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;//server.c&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;  2 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;  3 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;  4 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;  5 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;sys/socket.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;  6 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;errno.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;  7 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;error.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;  8 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;netinet/in.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;  9 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;netinet/ip.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 10 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;arpa/inet.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 11 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 12 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;signal.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 13 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;sys/wait.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 14 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 15 &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sigfunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 16 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 17 &lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;func_wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 18 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;pid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 19 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 20 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    
&lt;span class=&quot;lineno&quot;&gt; 21 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;child %d exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 22 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 23 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 24 &lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;func_waitpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 25 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;pid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 26 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 27 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;waitpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WNOHANG&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 28 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;child %d exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 29 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 30 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 31 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 32 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 33 &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sigfunc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigfunc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 34 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigaction&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oact&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 35 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sa_handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 36 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;sigemptyset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sa_mask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 37 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sa_flags&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 38 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SIGALRM&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 39 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#ifdef            SA_INTERRUPT&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 40 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sa_flags&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SA_INTERRUPT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;cm&quot;&gt;/* SunOS 4.x */&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 41 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#endif&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 42 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 43 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#ifdef           SA_RESTART&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 44 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sa_flags&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SA_RESTART&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;cm&quot;&gt;/* SVR4, 4.4BSD */&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 45 &lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;#endif&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 46 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 47 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigaction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;signo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oact&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 48 &lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SIG_ERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 49 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 50 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oact&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sa_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 51 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 52 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 53 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 54 &lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;str_echo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cfd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 55 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;ssize_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 56 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 57 &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;again&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 58 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 59 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cfd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 60 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cfd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 61 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 62 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errno&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EINTR&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 63 &lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;again&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 64 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 65 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;str_echo: read error&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 66 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 67 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 68 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 69 &lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 70 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 71 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SIGCHLD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;func_waitpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    
&lt;span class=&quot;lineno&quot;&gt; 72 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 73 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 74 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;pid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;child&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 75 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SOCK_STREAM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 76 &lt;/span&gt;        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errno&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 77 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;create socket fail.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 78 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 79 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 80 &lt;/span&gt;    
&lt;span class=&quot;lineno&quot;&gt; 81 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sockaddr_in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;child_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 82 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;bzero&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 83 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_family&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 84 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;htons&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9998&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 85 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;htonl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;INADDR_ANY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 86 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 87 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sockaddr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 88 &lt;/span&gt;        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errno&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 89 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;bind address fail.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 90 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 91 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 92 &lt;/span&gt;    
&lt;span class=&quot;lineno&quot;&gt; 93 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 94 &lt;/span&gt;        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errno&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 95 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;listen fail.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 96 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 97 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 98 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 99 &lt;/span&gt;        &lt;span class=&quot;kt&quot;&gt;socklen_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chilen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;child_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;100 &lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sockaddr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;child_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chilen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;101 &lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;listen fail.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;102 &lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;103 &lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;104 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;105 &lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;child&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;106 &lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;107 &lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;str_echo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;108 &lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;109 &lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;110 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;111 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;112 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;113 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;114 &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//client.c&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;115 &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;116 &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;117 &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;118 &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;sys/socket.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;119 &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;errno.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;120 &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;error.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;121 &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;netinet/in.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;122 &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;netinet/ip.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;123 &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;arpa/inet.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;124 &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;125 &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;signal.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;126 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;127 &lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;str_cli&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;FILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sfd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;128 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2014&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;129 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;130 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;131 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fgets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;132 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sfd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;133 &lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sfd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;134 &lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;server term prematurely.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;135 &lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;136 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;fputs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;137 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;138 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;139 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;140 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;141 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;142 &lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;143 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;144 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;145 &lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SOCK_STREAM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;146 &lt;/span&gt;            &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errno&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;147 &lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;create socket fail.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;148 &lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;149 &lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;150 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;151 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;152 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;153 &lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sockaddr_in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;child_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;154 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;bzero&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;155 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_family&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;156 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;htons&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9998&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;157 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;inet_pton&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;127.0.0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sin_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;158 &lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sockaddr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;159 &lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;connect fail.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;160 &lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;161 &lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;162 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;163 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;164 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;165 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;str_cli&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;166 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;167 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

</description>
        <pubDate>Fri, 22 Dec 2017 00:00:00 +0800</pubDate>
        <link>https://xiazemin.github.io/MyBlog/linux/2017/12/22/pid_0_1.html</link>
        <guid isPermaLink="true">https://xiazemin.github.io/MyBlog/linux/2017/12/22/pid_0_1.html</guid>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>Shellè„šæœ¬ç»å…¸ä¹‹Forkç‚¸å¼¹</title>
        <description>&lt;!-- more --&gt;
&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼Œbashæ˜¯ä¸€æ¬¾æå…¶å¼ºå¤§çš„shellï¼Œæä¾›äº†å¼ºå¤§çš„äº¤äº’ä¸ç¼–ç¨‹åŠŸèƒ½ã€‚è¿™æ ·çš„ä¸€æ¬¾shellä¸­è‡ªç„¶ä¸ä¼šç¼ºå°‘â€œå‡½æ•°â€è¿™ä¸ªå…ƒç´ æ¥å¸®åŠ©ç¨‹åºè¿›è¡Œæ¨¡å—åŒ–çš„é«˜æ•ˆå¼€å‘ä¸ç®¡ç†ã€‚äºæ˜¯äº§ç”Ÿäº†ç”±äºå…¶ç‰¹æ®Šçš„ç‰¹æ€§ï¼Œbashæ‹¥æœ‰äº†forkç‚¸å¼¹ã€‚Jaromilåœ¨2002å¹´è®¾è®¡äº†æœ€ä¸ºç²¾ç®€çš„ä¸€ä¸ªforkç‚¸å¼¹çš„å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€è°“forkç‚¸å¼¹æ˜¯ä¸€ç§æ¶æ„ç¨‹åºï¼Œå®ƒçš„å†…éƒ¨æ˜¯ä¸€ä¸ªä¸æ–­åœ¨forkè¿›ç¨‹çš„æ— é™å¾ªç¯ï¼Œforkç‚¸å¼¹å¹¶ä¸éœ€è¦æœ‰ç‰¹åˆ«çš„æƒé™å³å¯å¯¹ç³»ç»Ÿé€ æˆç ´åã€‚forkç‚¸å¼¹å®è´¨æ˜¯ä¸€ä¸ªç®€å•çš„é€’å½’ç¨‹åºã€‚ç”±äºç¨‹åºæ˜¯é€’å½’çš„ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œè¿™ä¼šå¯¼è‡´è¿™ä¸ªç®€å•çš„ç¨‹åºè¿…é€Ÿè€—å°½ç³»ç»Ÿé‡Œé¢çš„æ‰€æœ‰èµ„æºã€‚ç°åœ¨æ¥çœ‹çœ‹Jaromilè®¾è®¡çš„æœ€ç®€å•çš„forkç‚¸å¼¹:&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;:() { :&lt;/td&gt;
      &lt;td&gt;:&amp;amp; };:&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;æˆ–è€…&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;.() { .&lt;/td&gt;
      &lt;td&gt;.&amp;amp; };.&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ä¸€è¡Œçœ‹ä¼¼æ— æ³•ç†è§£çš„åªæœ‰13ä¸ªå­—ç¬¦çš„å‘½ä»¤ï¼Œå³å¯å ç”¨æ‰æ‰€æœ‰ç³»ç»Ÿçš„èµ„æºã€‚å…¶å®ï¼Œè¿™è¡Œå‘½ä»¤å¦‚æœè¿™æ ·å†™æˆbash scriptå°±ä¸éš¾ç†è§£äº†ï¼š&lt;/p&gt;

&lt;dl&gt;
  &lt;dt&gt;:()&lt;/dt&gt;
  &lt;dt&gt;{&lt;/dt&gt;
  &lt;dd&gt;|: &amp;amp;
}
;
:&lt;/dd&gt;
&lt;/dl&gt;

&lt;ul&gt;
  &lt;li&gt;ç¬¬ 1 è¡Œè¯´æ˜ä¸‹é¢è¦å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°åä¸ºå°æ•°ç‚¹ï¼Œæ²¡æœ‰å¯é€‰å‚æ•°ã€‚&lt;/li&gt;
  &lt;li&gt;ç¬¬ 2 è¡Œè¡¨ç¤ºå‡½æ•°ä½“å¼€å§‹ã€‚&lt;/li&gt;
  &lt;li&gt;ç¬¬ 3 è¡Œæ˜¯å‡½æ•°ä½“çœŸæ­£è¦åšçš„äº‹æƒ…ï¼Œé¦–å…ˆå®ƒé€’å½’è°ƒç”¨æœ¬å‡½æ•°ï¼Œç„¶ååˆ©ç”¨ç®¡é“è°ƒç”¨ä¸€ä¸ªæ–°è¿›ç¨‹ï¼ˆå®ƒè¦åšçš„äº‹æƒ…ä¹Ÿæ˜¯é€’å½’è°ƒç”¨æœ¬å‡½æ•°ï¼‰ï¼Œå¹¶å°†å…¶æ”¾åˆ°åå°æ‰§è¡Œã€‚&lt;/li&gt;
  &lt;li&gt;ç¬¬ 4 è¡Œè¡¨ç¤ºå‡½æ•°ä½“ç»“æŸã€‚&lt;/li&gt;
  &lt;li&gt;ç¬¬ 5 è¡Œå¹¶ä¸ä¼šæ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œåœ¨å‘½ä»¤è¡Œä¸­ç”¨æ¥åˆ†éš”ä¸¤ä¸ªå‘½ä»¤ç”¨ã€‚ä»æ€»ä½“æ¥çœ‹ï¼Œå®ƒè¡¨æ˜è¿™æ®µç¨‹åºåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚&lt;/li&gt;
  &lt;li&gt;ç¬¬ 6 è¡Œè¡¨ç¤ºè°ƒç”¨æœ¬å‡½æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å†’å·â€:â€å…¶å®æ˜¯å‡½æ•°åï¼Œè¿™ä¸ªbashè„šæœ¬å°±æ˜¯åœ¨ä¸æ–­çš„æ‰§è¡Œè¯¥å‡½æ•°ï¼Œç„¶åä¸æ–­forkå‡ºæ–°çš„è¿›ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºå‡½æ•°åï¼Œå¤§å®¶å¯èƒ½ä¼šæœ‰æ‰€ç–‘æƒ‘ï¼Œå°æ•°ç‚¹ä¹Ÿèƒ½åšå‡½æ•°åä½¿ç”¨å—ï¼Ÿæ¯•ç«Ÿå°æ•°ç‚¹æ˜¯ shell çš„ä¸€ä¸ªå†…åµŒå‘½ä»¤ï¼Œç”¨æ¥åœ¨å½“å‰ shell ç¯å¢ƒä¸­è¯»å–æŒ‡å®š æ–‡ä»¶ï¼Œå¹¶è¿è¡Œå…¶ä¸­çš„å‘½ä»¤ã€‚å®é™…ä¸Šçš„ç¡®å¯ä»¥ï¼Œè¿™å–å†³äºbashå¯¹å‘½ä»¤çš„è§£é‡Šé¡ºåºã€‚&lt;/p&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œbashå¤„äºéPOSIXæ¨¡å¼ï¼Œæ­¤æ—¶å¯¹å‘½ä»¤çš„è§£é‡Šé¡ºåºå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å…³é”®å­—ï¼Œä¾‹å¦‚ ifã€for ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;åˆ«åã€‚åˆ«åä¸èƒ½ä¸å…³é”®å­—ç›¸åŒï¼Œä½†æ˜¯å¯ä»¥ä¸ºå…³é”®å­—å®šä¹‰åˆ«åï¼Œä¾‹å¦‚ end=fiã€‚&lt;/li&gt;
  &lt;li&gt;ç‰¹ æ®Šå†…åµŒå‘½ä»¤ï¼Œä¾‹å¦‚ breakã€continue ç­‰ã€‚POSIX å®šä¹‰çš„ç‰¹æ®Šå†…åµŒå‘½ä»¤åŒ…æ‹¬ï¼š.ï¼ˆå°æ•°ç‚¹ï¼‰ã€:ï¼ˆå†’å·ï¼‰ã€breakã€continueã€ evalã€execã€exitã€exportã€readonlyã€ returnã€setã€shiftã€timesã€trap å’Œ unsetã€‚ bash åˆå¢åŠ äº†ä¸€ä¸ªç‰¹æ®Šçš„å†…åµŒå‘½ä»¤ sourceã€‚&lt;/li&gt;
  &lt;li&gt;å‡½æ•°ã€‚å¦‚æœå¤„äºé POSIX æ¨¡å¼ï¼Œbash ä¼šä¼˜å…ˆåŒ¹é…å‡½æ•°ï¼Œç„¶åå†åŒ¹é…å†…åµŒå‘½ä»¤ã€‚&lt;/li&gt;
  &lt;li&gt;éç‰¹æ®Šå†…åµŒå‘½ä»¤ï¼Œä¾‹å¦‚ cdã€test ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;è„šæœ¬å’Œå¯æ‰§è¡Œç¨‹åºã€‚åœ¨ PATH ç¯å¢ƒå˜é‡æŒ‡å®šçš„ç›®å½•ä¸­è¿›è¡Œæœç´¢ï¼Œè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ã€‚
ç”± äºé»˜è®¤æƒ…å†µä¸‹ï¼Œbash å¤„äºé POSIX æ¨¡å¼ï¼Œå› æ­¤forkç‚¸å¼¹ä¸­çš„å°æ•°ç‚¹ä¼šä¼˜å…ˆå½“æˆä¸€ä¸ªå‡½æ•°è¿›è¡ŒåŒ¹é…ã€‚(æ³¨ï¼šä½¿ç”¨å°æ•°ç‚¹ä»£æ›¿å…¶ä¸­çš„å†’å·ï¼Œä¹Ÿèƒ½èµ·åˆ°å®Œå…¨ç›¸åŒçš„æ•ˆæœã€‚)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¦ä½¿ç”¨POSIXæ¨¡å¼æ¥è¿è¡Œbashè„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä½¿ç”¨ â€“posix é€‰é¡¹å¯åŠ¨ bashã€‚&lt;/li&gt;
  &lt;li&gt;åœ¨è¿è¡Œbashä¹‹åï¼Œæ‰§è¡Œ set -o posix å‘½ä»¤ã€‚&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨ /bin/sh ã€‚&lt;/li&gt;
&lt;/ul&gt;

</description>
        <pubDate>Fri, 22 Dec 2017 00:00:00 +0800</pubDate>
        <link>https://xiazemin.github.io/MyBlog/linux/2017/12/22/fork_b.html</link>
        <guid isPermaLink="true">https://xiazemin.github.io/MyBlog/linux/2017/12/22/fork_b.html</guid>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>fork</title>
        <description>&lt;!-- more --&gt;
&lt;p&gt;ä¸€ã€forkå…¥é—¨çŸ¥è¯†&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; ä¸€ä¸ªè¿›ç¨‹ï¼ŒåŒ…æ‹¬ä»£ç ã€æ•°æ®å’Œåˆ†é…ç»™è¿›ç¨‹çš„èµ„æºã€‚forkï¼ˆï¼‰å‡½æ•°é€šè¿‡ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªä¸åŸæ¥è¿›ç¨‹å‡ ä¹å®Œå…¨ç›¸åŒçš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥åšå®Œå…¨ç›¸åŒçš„äº‹ï¼Œä½†å¦‚æœåˆå§‹å‚æ•°æˆ–è€…ä¼ å…¥çš„å˜é‡ä¸åŒï¼Œä¸¤ä¸ªè¿›ç¨‹ä¹Ÿå¯ä»¥åšä¸åŒçš„äº‹ã€‚
ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨forkï¼ˆï¼‰å‡½æ•°åï¼Œç³»ç»Ÿå…ˆç»™æ–°çš„è¿›ç¨‹åˆ†é…èµ„æºï¼Œä¾‹å¦‚å­˜å‚¨æ•°æ®å’Œä»£ç çš„ç©ºé—´ã€‚ç„¶åæŠŠåŸæ¥çš„è¿›ç¨‹çš„æ‰€æœ‰å€¼éƒ½å¤åˆ¶åˆ°æ–°çš„æ–°è¿›ç¨‹ä¸­ï¼Œåªæœ‰å°‘æ•°å€¼ä¸åŸæ¥çš„è¿›ç¨‹çš„å€¼ä¸åŒã€‚ç›¸å½“äºå…‹éš†äº†ä¸€ä¸ªè‡ªå·±ã€‚

 æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š
&lt;/code&gt;&lt;/pre&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;lineno&quot;&gt; 1 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;/* &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt; *  fork_test.c &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt; *  version 1 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 5 &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unistd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 6 &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;   
&lt;span class=&quot;lineno&quot;&gt; 7 &lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;   
&lt;span class=&quot;lineno&quot;&gt; 8 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;   
&lt;span class=&quot;lineno&quot;&gt; 9 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;pid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//fpidè¡¨ç¤ºforkå‡½æ•°è¿”å›çš„å€¼  &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;11 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;   
&lt;span class=&quot;lineno&quot;&gt;12 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   
&lt;span class=&quot;lineno&quot;&gt;13 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;error in fork!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;   
&lt;span class=&quot;lineno&quot;&gt;14 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;15 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;i am the child process, my process id is %d/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;   
&lt;span class=&quot;lineno&quot;&gt;16 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;æˆ‘æ˜¯çˆ¹çš„å„¿å­/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//å¯¹æŸäº›äººæ¥è¯´ä¸­æ–‡çœ‹ç€æ›´ç›´ç™½ã€‚  &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;17 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;18 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;19 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;20 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;i am the parent process, my process id is %d/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;   
&lt;span class=&quot;lineno&quot;&gt;21 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;æˆ‘æ˜¯å­©å­ä»–çˆ¹/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;22 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;23 &lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;24 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;ç»Ÿè®¡ç»“æœæ˜¯: %d/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;25 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;26 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;pre&gt;&lt;code&gt; è¿è¡Œç»“æœæ˜¯ï¼š
i am the child process, my process id is 5574
æˆ‘æ˜¯çˆ¹çš„å„¿å­
ç»Ÿè®¡ç»“æœæ˜¯: 1
i am the parent process, my process id is 5573
æˆ‘æ˜¯å­©å­ä»–çˆ¹
ç»Ÿè®¡ç»“æœæ˜¯: 1
åœ¨è¯­å¥fpid=fork()ä¹‹å‰ï¼Œåªæœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œè¿™æ®µä»£ç ï¼Œä½†åœ¨è¿™æ¡è¯­å¥ä¹‹åï¼Œå°±å˜æˆä¸¤ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œäº†ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹çš„å‡ ä¹å®Œå…¨ç›¸åŒï¼Œå°†è¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡è¯­å¥éƒ½æ˜¯if(fpid&amp;lt;0)â€¦â€¦
ä¸ºä»€ä¹ˆä¸¤ä¸ªè¿›ç¨‹çš„fpidä¸åŒå‘¢ï¼Œè¿™ä¸forkå‡½æ•°çš„ç‰¹æ€§æœ‰å…³ã€‚forkè°ƒç”¨çš„ä¸€ä¸ªå¥‡å¦™ä¹‹å¤„å°±æ˜¯å®ƒä»…ä»…è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå´èƒ½å¤Ÿè¿”å›ä¸¤æ¬¡ï¼Œå®ƒå¯èƒ½æœ‰ä¸‰ç§ä¸åŒçš„è¿”å›å€¼ï¼š
1ï¼‰åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œforkè¿”å›æ–°åˆ›å»ºå­è¿›ç¨‹çš„è¿›ç¨‹IDï¼›
2ï¼‰åœ¨å­è¿›ç¨‹ä¸­ï¼Œforkè¿”å›0ï¼›
3ï¼‰å¦‚æœå‡ºç°é”™è¯¯ï¼Œforkè¿”å›ä¸€ä¸ªè´Ÿå€¼ï¼›
åœ¨forkå‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœåˆ›å»ºæ–°è¿›ç¨‹æˆåŠŸï¼Œåˆ™å‡ºç°ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯å­è¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯çˆ¶è¿›ç¨‹ã€‚åœ¨å­è¿›ç¨‹ä¸­ï¼Œforkå‡½æ•°è¿”å›0ï¼Œåœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œforkè¿”å›æ–°åˆ›å»ºå­è¿›ç¨‹çš„è¿›ç¨‹IDã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡forkè¿”å›çš„å€¼æ¥åˆ¤æ–­å½“å‰è¿›ç¨‹æ˜¯å­è¿›ç¨‹è¿˜æ˜¯çˆ¶è¿›ç¨‹ã€‚

å¼•ç”¨ä¸€ä½ç½‘å‹çš„è¯æ¥è§£é‡Šfpidçš„å€¼ä¸ºä»€ä¹ˆåœ¨çˆ¶å­è¿›ç¨‹ä¸­ä¸åŒã€‚â€œå…¶å®å°±ç›¸å½“äºé“¾è¡¨ï¼Œè¿›ç¨‹å½¢æˆäº†é“¾è¡¨ï¼Œçˆ¶è¿›ç¨‹çš„fpid(p æ„å‘³point)æŒ‡å‘å­è¿›ç¨‹çš„è¿›ç¨‹id, å› ä¸ºå­è¿›ç¨‹æ²¡æœ‰å­è¿›ç¨‹ï¼Œæ‰€ä»¥å…¶fpidä¸º0.
forkå‡ºé”™å¯èƒ½æœ‰ä¸¤ç§åŸå› ï¼š
1ï¼‰å½“å‰çš„è¿›ç¨‹æ•°å·²ç»è¾¾åˆ°äº†ç³»ç»Ÿè§„å®šçš„ä¸Šé™ï¼Œè¿™æ—¶errnoçš„å€¼è¢«è®¾ç½®ä¸ºEAGAINã€‚
2ï¼‰ç³»ç»Ÿå†…å­˜ä¸è¶³ï¼Œè¿™æ—¶errnoçš„å€¼è¢«è®¾ç½®ä¸ºENOMEMã€‚
åˆ›å»ºæ–°è¿›ç¨‹æˆåŠŸåï¼Œç³»ç»Ÿä¸­å‡ºç°ä¸¤ä¸ªåŸºæœ¬å®Œå…¨ç›¸åŒçš„è¿›ç¨‹ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹æ‰§è¡Œæ²¡æœ‰å›ºå®šçš„å…ˆåé¡ºåºï¼Œå“ªä¸ªè¿›ç¨‹å…ˆæ‰§è¡Œè¦çœ‹ç³»ç»Ÿçš„è¿›ç¨‹è°ƒåº¦ç­–ç•¥ã€‚
æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹ï¼ˆäº’ä¸ç›¸åŒï¼‰çš„è¿›ç¨‹æ ‡è¯†ç¬¦ï¼ˆprocess IDï¼‰ï¼Œå¯ä»¥é€šè¿‡getpidï¼ˆï¼‰å‡½æ•°è·å¾—ï¼Œè¿˜æœ‰ä¸€ä¸ªè®°å½•çˆ¶è¿›ç¨‹pidçš„å˜é‡ï¼Œå¯ä»¥é€šè¿‡getppidï¼ˆï¼‰å‡½æ•°è·å¾—å˜é‡çš„å€¼ã€‚
forkæ‰§è¡Œå®Œæ¯•åï¼Œå‡ºç°ä¸¤ä¸ªè¿›ç¨‹ï¼Œ
æœ‰äººè¯´ä¸¤ä¸ªè¿›ç¨‹çš„å†…å®¹å®Œå…¨ä¸€æ ·å•Šï¼Œæ€ä¹ˆæ‰“å°çš„ç»“æœä¸ä¸€æ ·å•Šï¼Œé‚£æ˜¯å› ä¸ºåˆ¤æ–­æ¡ä»¶çš„åŸå› ï¼Œä¸Šé¢åˆ—ä¸¾çš„åªæ˜¯è¿›ç¨‹çš„ä»£ç å’ŒæŒ‡ä»¤ï¼Œè¿˜æœ‰å˜é‡å•Šã€‚
æ‰§è¡Œå®Œforkåï¼Œè¿›ç¨‹1çš„å˜é‡ä¸ºcount=0ï¼Œfpidï¼=0ï¼ˆçˆ¶è¿›ç¨‹ï¼‰ã€‚è¿›ç¨‹2çš„å˜é‡ä¸ºcount=0ï¼Œfpid=0ï¼ˆå­è¿›ç¨‹ï¼‰ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹çš„å˜é‡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå­˜åœ¨ä¸åŒçš„åœ°å€ä¸­ï¼Œä¸æ˜¯å…±ç”¨çš„ï¼Œè¿™ç‚¹è¦æ³¨æ„ã€‚å¯ä»¥è¯´ï¼Œæˆ‘ä»¬å°±æ˜¯é€šè¿‡fpidæ¥è¯†åˆ«å’Œæ“ä½œçˆ¶å­è¿›ç¨‹çš„ã€‚
è¿˜æœ‰äººå¯èƒ½ç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ä»#includeå¤„å¼€å§‹å¤åˆ¶ä»£ç çš„ï¼Œè¿™æ˜¯å› ä¸ºforkæ˜¯æŠŠè¿›ç¨‹å½“å‰çš„æƒ…å†µæ‹·è´ä¸€ä»½ï¼Œæ‰§è¡Œforkæ—¶ï¼Œè¿›ç¨‹å·²ç»æ‰§è¡Œå®Œäº†int count=0;forkåªæ‹·è´ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„ä»£ç åˆ°æ–°çš„è¿›ç¨‹ã€‚
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;äºŒã€forkè¿›é˜¶çŸ¥è¯†&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;å…ˆçœ‹ä¸€ä»½ä»£ç ï¼š
&lt;/code&gt;&lt;/pre&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;lineno&quot;&gt; 1 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;/* &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt; *  fork_test.c &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt; *  version 2 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 5 &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unistd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 6 &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 7 &lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 8 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 9 &lt;/span&gt;   &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;10 &lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;i son/pa ppid pid  fpid/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;11 &lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;//ppidæŒ‡å½“å‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹pid  &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;12 &lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;//pidæŒ‡å½“å‰è¿›ç¨‹çš„pid,  &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;13 &lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;//fpidæŒ‡forkè¿”å›ç»™å½“å‰è¿›ç¨‹çš„å€¼  &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;14 &lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;15 &lt;/span&gt;       &lt;span class=&quot;kt&quot;&gt;pid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;16 &lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;17 &lt;/span&gt;           &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;%d child  %4d %4d %4d/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getppid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;18 &lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;19 &lt;/span&gt;           &lt;span class=&quot;nf&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;%d parent %4d %4d %4d/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getppid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;20 &lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;21 &lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;22 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;pre&gt;&lt;code&gt;è¿è¡Œç»“æœæ˜¯ï¼š
i son/pa ppid pid  fpid
0 parent 2043 3224 3225
0 child  3224 3225    0
1 parent 2043 3224 3226
1 parent 3224 3225 3227
1 child     1 3227    0
1 child     1 3226    0 
è¿™ä»½ä»£ç æ¯”è¾ƒæœ‰æ„æ€ï¼Œæˆ‘ä»¬æ¥è®¤çœŸåˆ†æä¸€ä¸‹ï¼š
ç¬¬ä¸€æ­¥ï¼šåœ¨çˆ¶è¿›ç¨‹ä¸­ï¼ŒæŒ‡ä»¤æ‰§è¡Œåˆ°forå¾ªç¯ä¸­ï¼Œi=0ï¼Œæ¥ç€æ‰§è¡Œforkï¼Œforkæ‰§è¡Œå®Œåï¼Œç³»ç»Ÿä¸­å‡ºç°ä¸¤ä¸ªè¿›ç¨‹ï¼Œåˆ†åˆ«æ˜¯p3224å’Œp3225ï¼ˆåé¢æˆ‘éƒ½ç”¨pxxxxè¡¨ç¤ºè¿›ç¨‹idä¸ºxxxxçš„è¿›ç¨‹ï¼‰ã€‚å¯ä»¥çœ‹åˆ°çˆ¶è¿›ç¨‹p3224çš„çˆ¶è¿›ç¨‹æ˜¯p2043ï¼Œå­è¿›ç¨‹p3225çš„çˆ¶è¿›ç¨‹æ­£å¥½æ˜¯p3224ã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªé“¾è¡¨æ¥è¡¨ç¤ºè¿™ä¸ªå…³ç³»ï¼š
p2043-&amp;gt;p3224-&amp;gt;p3225 
ç¬¬ä¸€æ¬¡forkåï¼Œp3224ï¼ˆçˆ¶è¿›ç¨‹ï¼‰çš„å˜é‡ä¸ºi=0ï¼Œfpid=3225ï¼ˆforkå‡½æ•°åœ¨çˆ¶è¿›ç¨‹ä¸­è¿”å‘å­è¿›ç¨‹idï¼‰ï¼Œä»£ç å†…å®¹ä¸ºï¼š
&lt;/code&gt;&lt;/pre&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;lineno&quot;&gt;1 &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;2 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;pid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//æ‰§è¡Œå®Œæ¯•ï¼Œi=0ï¼Œfpid=3225  &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;3 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;4 &lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;%d child  %4d %4d %4d/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getppid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;5 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;6 &lt;/span&gt;       &lt;span class=&quot;nf&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;%d parent %4d %4d %4d/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getppid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;7 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;8 &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;pre&gt;&lt;code&gt;p3225ï¼ˆå­è¿›ç¨‹ï¼‰çš„å˜é‡ä¸ºi=0ï¼Œfpid=0ï¼ˆforkå‡½æ•°åœ¨å­è¿›ç¨‹ä¸­è¿”å›0ï¼‰ï¼Œä»£ç å†…å®¹ä¸ºï¼š
&lt;/code&gt;&lt;/pre&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;lineno&quot;&gt;1 &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;2 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;pid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//æ‰§è¡Œå®Œæ¯•ï¼Œi=0ï¼Œfpid=0  &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;3 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;4 &lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;%d child  %4d %4d %4d/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getppid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;5 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;6 &lt;/span&gt;       &lt;span class=&quot;nf&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;%d parent %4d %4d %4d/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getppid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;7 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;8 &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;pre&gt;&lt;code&gt;æ‰€ä»¥æ‰“å°å‡ºç»“æœï¼š
0 parent 2043 3224 3225
0 child  3224 3225    0
ç¬¬äºŒæ­¥ï¼šå‡è®¾çˆ¶è¿›ç¨‹p3224å…ˆæ‰§è¡Œï¼Œå½“è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯æ—¶ï¼Œi=1ï¼Œæ¥ç€æ‰§è¡Œforkï¼Œç³»ç»Ÿä¸­åˆæ–°å¢ä¸€ä¸ªè¿›ç¨‹p3226ï¼Œå¯¹äºæ­¤æ—¶çš„çˆ¶è¿›ç¨‹ï¼Œp2043-&amp;gt;p3224ï¼ˆå½“å‰è¿›ç¨‹ï¼‰-&amp;gt;p3226ï¼ˆè¢«åˆ›å»ºçš„å­è¿›ç¨‹ï¼‰ã€‚
å¯¹äºå­è¿›ç¨‹p3225ï¼Œæ‰§è¡Œå®Œç¬¬ä¸€æ¬¡å¾ªç¯åï¼Œi=1ï¼Œæ¥ç€æ‰§è¡Œforkï¼Œç³»ç»Ÿä¸­æ–°å¢ä¸€ä¸ªè¿›ç¨‹p3227ï¼Œå¯¹äºæ­¤è¿›ç¨‹ï¼Œp3224-&amp;gt;p3225ï¼ˆå½“å‰è¿›ç¨‹ï¼‰-&amp;gt;p3227ï¼ˆè¢«åˆ›å»ºçš„å­è¿›ç¨‹ï¼‰ã€‚ä»è¾“å‡ºå¯ä»¥çœ‹åˆ°p3225åŸæ¥æ˜¯p3224çš„å­è¿›ç¨‹ï¼Œç°åœ¨å˜æˆp3227çš„çˆ¶è¿›ç¨‹ã€‚çˆ¶å­æ˜¯ç›¸å¯¹çš„ï¼Œè¿™ä¸ªå¤§å®¶åº”è¯¥å®¹æ˜“ç†è§£ã€‚åªè¦å½“å‰è¿›ç¨‹æ‰§è¡Œäº†forkï¼Œè¯¥è¿›ç¨‹å°±å˜æˆäº†çˆ¶è¿›ç¨‹äº†ï¼Œå°±æ‰“å°å‡ºäº†parentã€‚
æ‰€ä»¥æ‰“å°å‡ºç»“æœæ˜¯ï¼š
1 parent 2043 3224 3226
1 parent 3224 3225 3227 
ç¬¬ä¸‰æ­¥ï¼šç¬¬äºŒæ­¥åˆ›å»ºäº†ä¸¤ä¸ªè¿›ç¨‹p3226ï¼Œp3227ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹æ‰§è¡Œå®Œprintfå‡½æ•°åå°±ç»“æŸäº†ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªè¿›ç¨‹æ— æ³•è¿›å…¥ç¬¬ä¸‰æ¬¡å¾ªç¯ï¼Œæ— æ³•forkï¼Œè¯¥æ‰§è¡Œreturn 0;äº†ï¼Œå…¶ä»–è¿›ç¨‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚
ä»¥ä¸‹æ˜¯p3226ï¼Œp3227æ‰“å°å‡ºçš„ç»“æœï¼š
1 child     1 3227    0
1 child     1 3226    0 
ç»†å¿ƒçš„è¯»è€…å¯èƒ½æ³¨æ„åˆ°p3226ï¼Œp3227çš„çˆ¶è¿›ç¨‹éš¾é“ä¸è¯¥æ˜¯p3224å’Œp3225å—ï¼Œæ€ä¹ˆä¼šæ˜¯1å‘¢ï¼Ÿè¿™é‡Œå¾—è®²åˆ°è¿›ç¨‹çš„åˆ›å»ºå’Œæ­»äº¡çš„è¿‡ç¨‹ï¼Œåœ¨p3224å’Œp3225æ‰§è¡Œå®Œç¬¬äºŒä¸ªå¾ªç¯åï¼Œmainå‡½æ•°å°±è¯¥é€€å‡ºäº†ï¼Œä¹Ÿå³è¿›ç¨‹è¯¥æ­»äº¡äº†ï¼Œå› ä¸ºå®ƒå·²ç»åšå®Œæ‰€æœ‰äº‹æƒ…äº†ã€‚p3224å’Œp3225æ­»äº¡åï¼Œp3226ï¼Œp3227å°±æ²¡æœ‰çˆ¶è¿›ç¨‹äº†ï¼Œè¿™åœ¨æ“ä½œç³»ç»Ÿæ˜¯ä¸è¢«å…è®¸çš„ï¼Œæ‰€ä»¥p3226ï¼Œp3227çš„çˆ¶è¿›ç¨‹å°±è¢«ç½®ä¸ºp1äº†ï¼Œp1æ˜¯æ°¸è¿œä¸ä¼šæ­»äº¡çš„ï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œè¿™é‡Œå…ˆä¸ä»‹ç»ï¼Œç•™åˆ°â€œä¸‰ã€forké«˜é˜¶çŸ¥è¯†â€è®²ã€‚
æ€»ç»“ä¸€ä¸‹ï¼Œè¿™ä¸ªç¨‹åºæ‰§è¡Œçš„æµç¨‹å¦‚ä¸‹ï¼š



 è¿™ä¸ªç¨‹åºæœ€ç»ˆäº§ç”Ÿäº†3ä¸ªå­è¿›ç¨‹ï¼Œæ‰§è¡Œè¿‡6æ¬¡printfï¼ˆï¼‰å‡½æ•°ã€‚
æˆ‘ä»¬å†æ¥çœ‹ä¸€ä»½ä»£ç ï¼š
&lt;/code&gt;&lt;/pre&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;lineno&quot;&gt; 1 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;/* &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt; *  fork_test.c &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt; *  version 3 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt; */&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 5 &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unistd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 6 &lt;/span&gt; &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 7 &lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 8 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 9 &lt;/span&gt;   &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;10 &lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;11 &lt;/span&gt;       &lt;span class=&quot;kt&quot;&gt;pid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;12 &lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;13 &lt;/span&gt;           &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;son/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;14 &lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;15 &lt;/span&gt;           &lt;span class=&quot;nf&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;father/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;16 &lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;17 &lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;18 &lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;19 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;pre&gt;&lt;code&gt; å®ƒçš„æ‰§è¡Œç»“æœæ˜¯ï¼š
father
son
father
father
father
father
son
son
father
son
son
son
father
son 
è¿™é‡Œå°±ä¸åšè¯¦ç»†è§£é‡Šäº†ï¼Œåªåšä¸€ä¸ªå¤§æ¦‚çš„åˆ†æã€‚
for        i=0         1           2
          father     father     father
                                    son
                        son       father
                                    son
           son       father     father
                                    son
                        son       father
                                    son
å…¶ä¸­æ¯ä¸€è¡Œåˆ†åˆ«ä»£è¡¨ä¸€ä¸ªè¿›ç¨‹çš„è¿è¡Œæ‰“å°ç»“æœã€‚
æ€»ç»“ä¸€ä¸‹è§„å¾‹ï¼Œå¯¹äºè¿™ç§Næ¬¡å¾ªç¯çš„æƒ…å†µï¼Œæ‰§è¡Œprintfå‡½æ•°çš„æ¬¡æ•°ä¸º2*ï¼ˆ1+2+4+â€¦â€¦+2N-1ï¼‰æ¬¡ï¼Œåˆ›å»ºçš„å­è¿›ç¨‹æ•°ä¸º1+2+4+â€¦â€¦+2N-1ä¸ªã€‚(æ„Ÿè°¢gao_jiaweiç½‘å‹æŒ‡å‡ºçš„é”™è¯¯ï¼ŒåŸæœ¬æˆ‘çš„ç»“è®ºæ˜¯â€œæ‰§è¡Œprintfå‡½æ•°çš„æ¬¡æ•°ä¸º2*ï¼ˆ1+2+4+â€¦â€¦+2Nï¼‰æ¬¡ï¼Œåˆ›å»ºçš„å­è¿›ç¨‹æ•°ä¸º1+2+4+â€¦â€¦+2N â€ï¼Œè¿™æ˜¯é”™çš„)
ç½‘ä¸Šæœ‰äººè¯´Næ¬¡å¾ªç¯äº§ç”Ÿ2*ï¼ˆ1+2+4+â€¦â€¦+2Nï¼‰ä¸ªè¿›ç¨‹ï¼Œè¿™ä¸ªè¯´æ³•æ˜¯ä¸å¯¹çš„ï¼Œå¸Œæœ›å¤§å®¶éœ€è¦æ³¨æ„ã€‚

æ•°å­¦æ¨ç†è§http://202.117.3.13/wordpress/?p=81ï¼ˆè¯¥åšæ–‡çš„æœ€åï¼‰ã€‚
åŒæ—¶ï¼Œå¤§å®¶å¦‚æœæƒ³æµ‹ä¸€ä¸‹ä¸€ä¸ªç¨‹åºä¸­åˆ°åº•åˆ›å»ºäº†å‡ ä¸ªå­è¿›ç¨‹ï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯è°ƒç”¨printfå‡½æ•°æ‰“å°è¯¥è¿›ç¨‹çš„pidï¼Œä¹Ÿå³è°ƒç”¨printf(&quot;%d/n&quot;,getpid());æˆ–è€…é€šè¿‡printf(&quot;+/n&quot;);æ¥åˆ¤æ–­äº§ç”Ÿäº†å‡ ä¸ªè¿›ç¨‹ã€‚æœ‰äººæƒ³é€šè¿‡è°ƒç”¨printf(&quot;+&quot;);æ¥ç»Ÿè®¡åˆ›å»ºäº†å‡ ä¸ªè¿›ç¨‹ï¼Œè¿™æ˜¯ä¸å¦¥å½“çš„ã€‚å…·ä½“åŸå› æˆ‘æ¥åˆ†æã€‚
è€è§„çŸ©ï¼Œå¤§å®¶çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼š
&lt;/code&gt;&lt;/pre&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;lineno&quot;&gt; 1 &lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;  *  fork_test.c &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;  *  version 4&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4 &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;  */&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 5 &lt;/span&gt;  &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unistd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 6 &lt;/span&gt;   &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 7 &lt;/span&gt;  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 8 &lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;pid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//fpidè¡¨ç¤ºforkå‡½æ•°è¿”å›çš„å€¼  &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9 &lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//printf(&amp;quot;fork!&amp;quot;);  &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;fork!/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;11 &lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;12 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;13 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;error in fork!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;14 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fpid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;15 &lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;I am the child process, my process id is %d/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;16 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;17 &lt;/span&gt;        &lt;span class=&quot;nf&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;I am the parent process, my process id is %d/n&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;18 &lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;19 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;pre&gt;&lt;code&gt;æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š
fork!
I am the parent process, my process id is 3361
I am the child process, my process id is 3362 
å¦‚æœæŠŠè¯­å¥printf(&quot;fork!/n&quot;);æ³¨é‡Šæ‰ï¼Œæ‰§è¡Œprintf(&quot;fork!&quot;);
åˆ™æ–°çš„ç¨‹åºçš„æ‰§è¡Œç»“æœæ˜¯ï¼š
fork!I am the parent process, my process id is 3298
fork!I am the child process, my process id is 3299 
ç¨‹åºçš„å”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºä¸€ä¸ª/nå›è½¦ç¬¦å·ï¼Œä¸ºä»€ä¹ˆç»“æœä¼šç›¸å·®è¿™ä¹ˆå¤§å‘¢ï¼Ÿ
è¿™å°±è·Ÿprintfçš„ç¼“å†²æœºåˆ¶æœ‰å…³äº†ï¼ŒprintfæŸäº›å†…å®¹æ—¶ï¼Œæ“ä½œç³»ç»Ÿä»…ä»…æ˜¯æŠŠè¯¥å†…å®¹æ”¾åˆ°äº†stdoutçš„ç¼“å†²é˜Ÿåˆ—é‡Œäº†,å¹¶æ²¡æœ‰å®é™…çš„å†™åˆ°å±å¹•ä¸Šã€‚ä½†æ˜¯,åªè¦çœ‹åˆ°æœ‰/n åˆ™ä¼šç«‹å³åˆ·æ–°stdout,å› æ­¤å°±é©¬ä¸Šèƒ½å¤Ÿæ‰“å°äº†ã€‚
è¿è¡Œäº†printf(&quot;fork!&quot;)å,â€œfork!â€ä»…ä»…è¢«æ”¾åˆ°äº†ç¼“å†²é‡Œ,ç¨‹åºè¿è¡Œåˆ°forkæ—¶ç¼“å†²é‡Œé¢çš„â€œfork!â€  è¢«å­è¿›ç¨‹å¤åˆ¶è¿‡å»äº†ã€‚å› æ­¤åœ¨å­è¿›ç¨‹åº¦stdoutç¼“å†²é‡Œé¢å°±ä¹Ÿæœ‰äº†fork! ã€‚æ‰€ä»¥,ä½ æœ€ç»ˆçœ‹åˆ°çš„ä¼šæ˜¯fork!  è¢«printfäº†2æ¬¡ï¼ï¼ï¼ï¼
è€Œè¿è¡Œprintf(&quot;fork! /n&quot;)å,â€œfork!â€è¢«ç«‹å³æ‰“å°åˆ°äº†å±å¹•ä¸Š,ä¹‹åforkåˆ°çš„å­è¿›ç¨‹é‡Œçš„stdoutç¼“å†²é‡Œä¸ä¼šæœ‰fork! å†…å®¹ã€‚å› æ­¤ä½ çœ‹åˆ°çš„ç»“æœä¼šæ˜¯fork! è¢«printfäº†1æ¬¡ï¼ï¼ï¼ï¼
æ‰€ä»¥è¯´printf(&quot;+&quot;);ä¸èƒ½æ­£ç¡®åœ°ååº”è¿›ç¨‹çš„æ•°é‡ã€‚
å¤§å®¶çœ‹äº†è¿™ä¹ˆå¤šå¯èƒ½æœ‰ç‚¹ç–²å€¦å§ï¼Œä¸è¿‡æˆ‘è¿˜å¾—è´´æœ€åä¸€ä»½ä»£ç æ¥è¿›ä¸€æ­¥åˆ†æforkå‡½æ•°ã€‚
&lt;/code&gt;&lt;/pre&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;lineno&quot;&gt; 1 &lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 2 &lt;/span&gt;  &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdio.h&amp;gt;  &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3 &lt;/span&gt;  &lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;unistd.h&amp;gt;  &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4 &lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 5 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 6 &lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 7 &lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 8 &lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;fork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt; 9 &lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;lineno&quot;&gt;10 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;pre&gt;&lt;code&gt;é—®é¢˜æ˜¯ä¸ç®—mainè¿™ä¸ªè¿›ç¨‹è‡ªèº«ï¼Œç¨‹åºåˆ°åº•åˆ›å»ºäº†å¤šå°‘ä¸ªè¿›ç¨‹ã€‚
ä¸ºäº†è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…ˆåšä¸€ä¸‹å¼Šï¼Œå…ˆç”¨ç¨‹åºéªŒè¯ä¸€ä¸‹ï¼Œåˆ°æ­¤æœ‰å¤šå°‘ä¸ªè¿›ç¨‹ã€‚ [c-sharp] view plain copy #include &amp;lt;stdio.h&amp;gt;   int main(int argc, char* argv[])   {      fork();      fork() &amp;amp;&amp;amp; fork() || fork();      fork();      printf(&quot;+/n&quot;);   }  

ç­”æ¡ˆæ˜¯æ€»å…±20ä¸ªè¿›ç¨‹ï¼Œé™¤å»mainè¿›ç¨‹ï¼Œè¿˜æœ‰19ä¸ªè¿›ç¨‹ã€‚
æˆ‘ä»¬å†æ¥ä»”ç»†åˆ†æä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿˜æœ‰19ä¸ªè¿›ç¨‹ã€‚
ç¬¬ä¸€ä¸ªforkå’Œæœ€åä¸€ä¸ªforkè‚¯å®šæ˜¯ä¼šæ‰§è¡Œçš„ã€‚
ä¸»è¦åœ¨ä¸­é—´3ä¸ªforkä¸Šï¼Œå¯ä»¥ç”»ä¸€ä¸ªå›¾è¿›è¡Œæè¿°ã€‚
è¿™é‡Œå°±éœ€è¦æ³¨æ„&amp;amp;&amp;amp;å’Œ||è¿ç®—ç¬¦ã€‚
A&amp;amp;&amp;amp;Bï¼Œå¦‚æœA=0ï¼Œå°±æ²¡æœ‰å¿…è¦ç»§ç»­æ‰§è¡Œ&amp;amp;&amp;amp;Bäº†ï¼›Aé0ï¼Œå°±éœ€è¦ç»§ç»­æ‰§è¡Œ&amp;amp;&amp;amp;Bã€‚
A||Bï¼Œå¦‚æœAé0ï¼Œå°±æ²¡æœ‰å¿…è¦ç»§ç»­æ‰§è¡Œ||Bäº†ï¼ŒA=0ï¼Œå°±éœ€è¦ç»§ç»­æ‰§è¡Œ||Bã€‚
fork()å¯¹äºçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹çš„è¿”å›å€¼æ˜¯ä¸åŒçš„ï¼ŒæŒ‰ç…§ä¸Šé¢çš„A&amp;amp;&amp;amp;Bå’ŒA||Bçš„åˆ†æ”¯è¿›è¡Œç”»å›¾ï¼Œå¯ä»¥å¾—å‡º5ä¸ªåˆ†æ”¯ã€‚

åŠ ä¸Šå‰é¢çš„forkå’Œæœ€åçš„forkï¼Œæ€»å…±4*5=20ä¸ªè¿›ç¨‹ï¼Œé™¤å»mainä¸»è¿›ç¨‹ï¼Œå°±æ˜¯19ä¸ªè¿›ç¨‹äº†ã€‚

ä¸€ã€fork()å‡½æ•°
åœ¨æ“ä½œç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µä¸­è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œï¼Œä¸”æ˜¯æ‹¥æœ‰èµ„æºçš„æœ€å°å•ä½å’Œè°ƒåº¦å•ä½ï¼ˆåœ¨å¼•å…¥çº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æ˜¯æœ€å°çš„è°ƒåº¦å•ä½ï¼‰ã€‚åœ¨Linuxç³»ç»Ÿä¸­åˆ›å»ºè¿›ç¨‹æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€æ˜¯ç”±æ“ä½œç³»ç»Ÿåˆ›å»ºï¼ŒäºŒæ˜¯ç”±çˆ¶è¿›ç¨‹åˆ›å»ºè¿›ç¨‹ï¼ˆé€šå¸¸ä¸ºå­è¿›ç¨‹ï¼‰ã€‚ç³»ç»Ÿè°ƒç”¨å‡½æ•°fork()æ˜¯åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹çš„å”¯ä¸€æ–¹å¼ï¼Œå½“ç„¶vfork()ä¹Ÿå¯ä»¥åˆ›å»ºè¿›ç¨‹ï¼Œä½†æ˜¯å®é™…ä¸Šå…¶è¿˜æ˜¯è°ƒç”¨äº†fork()å‡½æ•°ã€‚fork()å‡½æ•°æ˜¯Linuxç³»ç»Ÿä¸­ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„å‡½æ•°ï¼Œå…¶ä¸€æ¬¡è°ƒç”¨ä¼šæœ‰ä¸¤ä¸ªè¿”å›å€¼ï¼Œä¸‹é¢æ˜¯fork()å‡½æ•°çš„å£°æ˜ï¼š  #include &amp;lt;unistd.h&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;// On success, The PID of the process is returned in the parent, and 0 is returned in the child. On failure,
// -1 is returned in the parent, no child process is created, and errno is set appropriately.
pid_t fork (void);&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;å½“ç¨‹åºè°ƒç”¨fork()å‡½æ•°å¹¶è¿”å›æˆåŠŸä¹‹åï¼Œç¨‹åºå°±å°†å˜æˆä¸¤ä¸ªè¿›ç¨‹ï¼Œè°ƒç”¨fork()è€…ä¸ºçˆ¶è¿›ç¨‹ï¼Œåæ¥ç”Ÿæˆè€…ä¸ºå­è¿›ç¨‹ã€‚è¿™ä¸¤ä¸ªè¿›ç¨‹å°†æ‰§è¡Œç›¸åŒçš„ç¨‹åºæ–‡æœ¬ï¼Œä½†å´å„è‡ªæ‹¥æœ‰ä¸åŒçš„æ ˆæ®µã€æ•°æ®æ®µä»¥åŠå †æ ˆæ‹·è´ã€‚å­è¿›ç¨‹çš„æ ˆã€æ•°æ®ä»¥åŠæ ˆæ®µå¼€å§‹æ—¶æ˜¯çˆ¶è¿›ç¨‹å†…å­˜ç›¸åº”å„éƒ¨åˆ†çš„å®Œå…¨æ‹·è´ï¼Œå› æ­¤å®ƒä»¬äº’ä¸å½±å“ã€‚ä»æ€§èƒ½æ–¹é¢è€ƒè™‘ï¼Œçˆ¶è¿›ç¨‹åˆ°å­è¿›ç¨‹çš„æ•°æ®æ‹·è´å¹¶ä¸æ˜¯åˆ›å»ºæ—¶å°±æ‹·è´äº†çš„ï¼Œè€Œæ˜¯é‡‡ç”¨äº†å†™æ—¶æ‹·è´ï¼ˆcopy-on -writeï¼‰æŠ€æœ¯æ¥å¤„ç†ã€‚è°ƒç”¨fork()ä¹‹åï¼Œçˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯æˆ‘ä»¬æ— æ³•ç¡®å®šçš„ï¼ˆå³è°ƒåº¦è¿›ç¨‹ä½¿ç”¨CPUï¼‰ï¼Œæ„è¯†åˆ°è¿™ä¸€ç‚¹æä¸ºé‡è¦ï¼Œå› ä¸ºåœ¨ä¸€äº›è®¾è®¡ä¸å¥½çš„ç¨‹åºä¸­ä¼šå¯¼è‡´èµ„æºç«äº‰ï¼Œä»è€Œå‡ºç°ä¸å¯é¢„çŸ¥çš„é—®é¢˜ã€‚ä¸‹å›¾ä¸ºå†™æ—¶æ‹·è´æŠ€æœ¯å¤„ç†å‰åçš„ç¤ºæ„å›¾ï¼š
      

åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¸¸å¸¸å­˜åœ¨è®¸å¤šå¯¹æ–‡ä»¶çš„æ“ä½œï¼Œfork()çš„æ‰§è¡Œå°†ä¼šå¯¹æ–‡ä»¶æ“ä½œå¸¦æ¥ä¸€äº›å°éº»çƒ¦ã€‚ç”±äºå­è¿›ç¨‹ä¼šå°†çˆ¶è¿›ç¨‹çš„å¤§å¤šæ•°æ•°æ®æ‹·è´ä¸€ä»½ï¼Œè¿™æ ·åœ¨æ–‡ä»¶æ“ä½œä¸­å°±æ„å‘³ç€å­è¿›ç¨‹ä¼šè·å¾—çˆ¶è¿›ç¨‹æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦çš„å‰¯æœ¬ï¼Œè¿™äº›å‰¯æœ¬çš„åˆ›å»ºæ–¹å¼ç±»ä¼¼äºdup()å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤çˆ¶ã€å­è¿›ç¨‹ä¸­å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å‡æŒ‡å‘ç›¸åŒçš„æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ï¼Œè€Œä¸”æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„åŒ…å«ç€å½“å‰æ–‡ä»¶çš„åç§»é‡ä»¥åŠæ–‡ä»¶çŠ¶æ€æ ‡å¿—ï¼Œæ‰€ä»¥åœ¨çˆ¶å­è¿›ç¨‹ä¸­å¤„ç†æ–‡ä»¶æ—¶è¦è€ƒè™‘è¿™ç§æƒ…å†µï¼Œä»¥é¿å…æ–‡ä»¶å†…å®¹å‡ºç°æ··ä¹±æˆ–è€…åˆ«çš„é—®é¢˜ã€‚ä¸‹å›¾ä¸ºæ‰§è¡Œfork()è°ƒç”¨åæ–‡ä»¶æè¿°ç¬¦çš„ç›¸å…³å¤„ç†åŠå…¶å˜åŒ–ï¼š
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;äºŒã€çº¿ç¨‹
    ä¸è¿›ç¨‹ç±»ä¼¼ï¼Œçº¿ç¨‹ï¼ˆthreadï¼‰æ˜¯å…è®¸åº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡çš„ä¸€ç§æœºåˆ¶ã€‚ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼ŒåŒä¸€ä¸ªç¨‹åºä¸­çš„æ‰€æœ‰çº¿ç¨‹å‡ä¼šç‹¬ç«‹æ‰§è¡Œï¼Œä¸”å…±äº«åŒä¸€ä»½å…¨å±€å†…å­˜åŒºåŸŸï¼Œå…¶ä¸­åŒ…æ‹¬åˆå§‹åŒ–æ•°æ®æ®µï¼ˆinitialized dataï¼‰ï¼Œæœªåˆå§‹åŒ–æ•°æ®æ®µï¼ˆuninitialized dataï¼‰ï¼Œä»¥åŠå †å†…å­˜æ®µï¼ˆheap segmentï¼‰ã€‚åœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œå¦‚æœçº¿ç¨‹æ•°è¶…è¿‡äº†CPUçš„ä¸ªæ•°ï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºå°†æ˜¯æ— æ³•ç¡®å®šçš„ï¼Œå› æ­¤å¯¹äºä¸€äº›å…¨å±€å…±äº«æ•°æ®æ®éœ€è¦ä½¿ç”¨åŒæ­¥æœºåˆ¶æ¥ç¡®ä¿å…¶çš„æ­£ç¡®æ€§ã€‚
    åœ¨ç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹ä¹Ÿæ˜¯ç¨€ç¼ºèµ„æºï¼Œä¸€ä¸ªè¿›ç¨‹èƒ½åŒæ—¶åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹è¿™å–å†³äºåœ°å€ç©ºé—´çš„å¤§å°å’Œå†…æ ¸å‚æ•°ï¼Œä¸€å°æœºå™¨å¯ä»¥åŒæ—¶å¹¶å‘è¿è¡Œå¤šå°‘ä¸ªçº¿ç¨‹ä¹Ÿå—é™äºCPUçš„æ•°ç›®ã€‚åœ¨è¿›è¡Œç¨‹åºè®¾è®¡æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ç²¾å¿ƒè§„åˆ’çº¿ç¨‹çš„ä¸ªæ•°ï¼Œç‰¹åˆ«æ˜¯æ ¹æ®æœºå™¨CPUçš„æ•°ç›®æ¥è®¾ç½®å·¥ä½œçº¿ç¨‹çš„æ•°ç›®ï¼Œå¹¶ä¸ºå…³é”®ä»»åŠ¡ä¿ç•™è¶³å¤Ÿçš„è®¡ç®—èµ„æºã€‚å¦‚æœä½ è®¾è®¡çš„ç¨‹åºåœ¨èƒŒåœ°é‡Œå¯åŠ¨äº†é¢å¤–çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œé‚£è¿™ä¹Ÿå±äºèµ„æºè§„åˆ’æ¼ç®—çš„æƒ…å†µï¼Œä»è€Œå½±å“å…³é”®ä»»åŠ¡çš„æ‰§è¡Œï¼Œæœ€ç»ˆå¯¼è‡´æ— æ³•è¾¾åˆ°é¢„æœŸçš„æ€§èƒ½ã€‚å¾ˆå¤šç¨‹åºä¸­éƒ½å­˜åœ¨å…¨å±€å¯¹è±¡ï¼Œè¿™äº›å…¨å±€å¯¹è±¡çš„åˆå§‹åŒ–å·¥ä½œéƒ½æ˜¯åœ¨è¿›å…¥main()å‡½æ•°ä¹‹å‰è¿›è¡Œçš„ï¼Œä¸ºäº†èƒ½ä¿è¯å…¨å±€å¯¹è±¡çš„å®‰å…¨åˆå§‹åŒ–ï¼ˆæŒ‰é¡ºåºçš„ï¼‰ï¼Œå› æ­¤åœ¨ç¨‹åºè¿›å…¥main()å‡½æ•°ä¹‹å‰åº”è¯¥é¿å…çº¿ç¨‹çš„åˆ›å»ºï¼Œä»è€Œæœç»æœªçŸ¥é”™è¯¯çš„å‘ç”Ÿã€‚&lt;/p&gt;

&lt;p&gt;ä¸‰ã€fork()ä¸å¤šçº¿ç¨‹
    åœ¨ç¨‹åºä¸­fork()ä¸å¤šçº¿ç¨‹çš„åä½œæ€§å¾ˆå·®ï¼Œè¿™æ˜¯POSIXç³»åˆ—æ“ä½œç³»ç»Ÿçš„å†å²åŒ…è¢±ã€‚å› ä¸ºé•¿æœŸä»¥æ¥ç¨‹åºéƒ½æ˜¯å•çº¿ç¨‹çš„ï¼Œfork()è¿è½¬æ­£å¸¸ã€‚å½“20ä¸–çºª90å¹´ä»£åˆæœŸå¼•å…¥çº¿ç¨‹ä¹‹åï¼Œfork()çš„é€‚ç”¨èŒƒå›´å°±å¤§ä¸ºç¼©å°äº†ã€‚
    åœ¨å¤šçº¿ç¨‹æ‰§è¡Œçš„æƒ…å†µä¸‹è°ƒç”¨fork()å‡½æ•°ï¼Œä»…ä¼šå°†å‘èµ·è°ƒç”¨çš„çº¿ç¨‹å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­ã€‚ï¼ˆå­è¿›ç¨‹ä¸­è¯¥çº¿ç¨‹çš„IDä¸çˆ¶è¿›ç¨‹ä¸­å‘èµ·fork()è°ƒç”¨çš„çº¿ç¨‹IDæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤ï¼Œçº¿ç¨‹IDç›¸åŒçš„æƒ…å†µæœ‰æ—¶æˆ‘ä»¬éœ€è¦åšç‰¹æ®Šçš„å¤„ç†ã€‚ï¼‰ä¹Ÿå°±æ˜¯è¯´ä¸èƒ½åŒæ—¶åˆ›å»ºå‡ºäºçˆ¶è¿›ç¨‹ä¸€æ ·å¤šçº¿ç¨‹çš„å­è¿›ç¨‹ã€‚å…¶ä»–çº¿ç¨‹å‡åœ¨å­è¿›ç¨‹ä¸­ç«‹å³åœæ­¢å¹¶æ¶ˆå¤±ï¼Œå¹¶ä¸”ä¸ä¼šä¸ºè¿™äº›çº¿ç¨‹è°ƒç”¨æ¸…ç†å‡½æ•°ä»¥åŠé’ˆå¯¹çº¿ç¨‹å±€éƒ¨å­˜å‚¨å˜é‡çš„ææ„å‡½æ•°ã€‚è¿™å°†å¯¼è‡´ä¸‹åˆ—ä¸€äº›é—®é¢˜:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;è™½ç„¶åªå°†å‘èµ·fork()è°ƒç”¨çš„çº¿ç¨‹å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­ï¼Œä½†å…¨å±€å˜é‡çš„çŠ¶æ€ä»¥åŠæ‰€æœ‰çš„pthreadså¯¹è±¡ï¼ˆå¦‚äº’æ–¥é‡ã€æ¡ä»¶å˜é‡ç­‰ï¼‰éƒ½ä¼šåœ¨å­è¿›ç¨‹ä¸­å¾—ä»¥ä¿ç•™ï¼Œè¿™å°±é€ æˆä¸€ä¸ªå±é™©çš„å±€é¢ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªçº¿ç¨‹åœ¨fork()è¢«è°ƒç”¨å‰é”å®šäº†æŸä¸ªäº’æ–¥é‡ï¼Œä¸”å¯¹æŸä¸ªå…¨å±€å˜é‡çš„æ›´æ–°ä¹Ÿåšåˆ°äº†ä¸€åŠï¼Œæ­¤æ—¶fork()è¢«è°ƒç”¨ï¼Œæ‰€æœ‰æ•°æ®åŠçŠ¶æ€è¢«æ‹·è´åˆ°å­è¿›ç¨‹ä¸­ï¼Œé‚£ä¹ˆå­è¿›ç¨‹ä¸­å¯¹è¯¥äº’æ–¥é‡å°±æ— æ³•è§£é”ï¼ˆå› ä¸ºå…¶å¹¶éè¯¥äº’æ–¥é‡çš„å±ä¸»ï¼‰ï¼Œå¦‚æœå†è¯•å›¾é”å®šè¯¥äº’æ–¥é‡å°±ä¼šå¯¼è‡´æ­»é”ï¼Œè¿™æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­æœ€ä¸æ„¿æ„çœ‹åˆ°çš„æƒ…å†µã€‚åŒæ—¶ï¼Œå…¨å±€å˜é‡çš„çŠ¶æ€ä¹Ÿå¯èƒ½å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œå› ä¸ºå¯¹å…¶æ›´æ–°çš„æ“ä½œåªåšåˆ°äº†ä¸€åŠå¯¹åº”çš„çº¿ç¨‹å°±æ¶ˆå¤±äº†ã€‚fork()å‡½æ•°è¢«è°ƒç”¨ä¹‹åï¼Œå­è¿›ç¨‹å°±ç›¸å½“äºå¤„äºsignal handlerä¹‹ä¸­ï¼Œæ­¤æ—¶å°±ä¸èƒ½è°ƒç”¨çº¿ç¨‹å®‰å…¨çš„å‡½æ•°ï¼ˆç”¨é”æœºåˆ¶å®ç°å®‰å…¨çš„å‡½æ•°ï¼‰ï¼Œé™¤éå‡½æ•°æ˜¯å¯é‡å…¥çš„ï¼Œè€Œåªèƒ½è°ƒç”¨å¼‚æ­¥ä¿¡å·å®‰å…¨ï¼ˆasync-signal-safeï¼‰çš„å‡½æ•°ã€‚fork()ä¹‹åï¼Œå­è¿›ç¨‹ä¸èƒ½è°ƒç”¨ï¼š
malloc(3)ã€‚å› ä¸ºmalloc()åœ¨è®¿é—®å…¨å±€çŠ¶æ€æ—¶ä¼šåŠ é”ã€‚
ä»»ä½•å¯èƒ½åˆ†é…æˆ–é‡Šæ”¾å†…å­˜çš„å‡½æ•°ï¼ŒåŒ…æ‹¬newã€map::insert()ã€snprintf() â€¦â€¦
ä»»ä½•pthreadså‡½æ•°ã€‚ä½ ä¸èƒ½ç”¨pthread_cond_signal()å»é€šçŸ¥çˆ¶è¿›ç¨‹ï¼Œåªèƒ½é€šè¿‡è¯»å†™pipe(2)æ¥åŒæ­¥ã€‚
printf()ç³»åˆ—å‡½æ•°ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹å¯èƒ½æ°å¥½æŒæœ‰stdout/stderrçš„é”ã€‚
é™¤äº†man 7 signalä¸­æ˜ç¡®åˆ—å‡ºçš„â€œsignalå®‰å…¨â€å‡½æ•°ä¹‹å¤–çš„ä»»ä½•å‡½æ•°ã€‚&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å› ä¸ºå¹¶æœªæ‰§è¡Œæ¸…ç†å‡½æ•°å’Œé’ˆå¯¹çº¿ç¨‹å±€éƒ¨å­˜å‚¨æ•°æ®çš„ææ„å‡½æ•°ï¼Œæ‰€ä»¥å¤šçº¿ç¨‹æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´å­è¿›ç¨‹çš„å†…å­˜æ³„éœ²ã€‚å¦å¤–ï¼Œå­è¿›ç¨‹ä¸­çš„çº¿ç¨‹å¯èƒ½æ— æ³•è®¿é—®ï¼ˆçˆ¶è¿›ç¨‹ä¸­ï¼‰ç”±å…¶ä»–çº¿ç¨‹æ‰€åˆ›å»ºçš„çº¿ç¨‹å±€éƒ¨å­˜å‚¨å˜é‡ï¼Œå› ä¸ºï¼ˆå­è¿›ç¨‹ï¼‰æ²¡æœ‰ä»»ä½•ç›¸åº”çš„å¼•ç”¨æŒ‡é’ˆã€‚&lt;/p&gt;

    &lt;p&gt;ç”±äºè¿™äº›é—®é¢˜ï¼Œæ¨èåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­è°ƒç”¨fork()çš„å”¯ä¸€æƒ…å†µæ˜¯ï¼šå…¶åç«‹å³è°ƒç”¨exec()å‡½æ•°æ‰§è¡Œå¦ä¸€ä¸ªç¨‹åºï¼Œå½»åº•éš”æ–­å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹çš„å…³ç³»ã€‚ç”±æ–°çš„è¿›ç¨‹è¦†ç›–æ‰åŸæœ‰çš„å†…å­˜ï¼Œä½¿å¾—å­è¿›ç¨‹ä¸­çš„æ‰€æœ‰pthreadså¯¹è±¡æ¶ˆå¤±ã€‚
 å¯¹äºé‚£äº›å¿…é¡»æ‰§è¡Œfork()ï¼Œè€Œå…¶ååˆæ— exec()ç´§éšå…¶åçš„ç¨‹åºæ¥è¯´ï¼Œpthreads APIæä¾›äº†ä¸€ç§æœºåˆ¶ï¼šfork()å¤„ç†å‡½æ•°ã€‚åˆ©ç”¨å‡½æ•°pthread_atfork()æ¥åˆ›å»ºfork()å¤„ç†å‡½æ•°ã€‚&lt;/p&gt;

    &lt;p&gt;å½“ä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åº fork(2) ä¹‹å&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;fork(2) ç¨‹åº åˆ›å»ºäº†å½“å‰è¿›ç¨‹çš„å‰¯æœ¬ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„å†…å­˜é¡µï¼Œè¿˜æœ‰æ‰“å¼€æ–‡ä»¶çš„å¥æŸ„ç­‰ã€‚æ‰€æœ‰è¿™äº›å·¥ä½œå¯¹äºä¸€ä¸ª UNIX ç¨‹åºå‘˜æ¥è¯´ï¼Œéƒ½ä¸é™Œç”Ÿã€‚å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ä¹‹é—´ä¸€ä¸ªéå¸¸é‡è¦çš„åŒºåˆ«æ˜¯ï¼Œå­è¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ ä¸€ä¸ªç¨‹åºå‘˜ä¹Ÿè®¸ä¸å¸Œæœ›å¤åˆ¶åŒ…æ‹¬æ‰€æœ‰çº¿ç¨‹åœ¨å†…çš„æ•´ä¸ªè¿›ç¨‹ï¼Œè€Œä¸”ï¼Œè¿™ä¹Ÿå®¹æ˜“å‡ºé—®é¢˜ã€‚æƒ³æƒ³ï¼šæ‰€æœ‰çš„çº¿ç¨‹éƒ½å› ä¸ºä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯ fork(2)ï¼‰è€Œè¢«æš‚åœï¼ˆSuspendedï¼‰ã€‚æ‰€ä»¥ï¼Œfork(2) ä»…ä»…ä¼šå¤åˆ¶è°ƒç”¨å®ƒçš„é‚£ä¸ªçº¿ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆï¼ˆå½“å‰çš„å®ç°æ–¹å¼ï¼‰ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å…³é”®éƒ¨åˆ†ï¼Œäº’æ–¥é”ï¼ˆmutexï¼‰&lt;/p&gt;

&lt;p&gt;è¿™ç§åšæ³•ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜æ˜¯ï¼Œå½“ fork(2) è¢«è°ƒç”¨çš„æ—¶å€™ï¼ŒæŸäº›çº¿ç¨‹å¯ä»¥æ­£åœ¨æ‰§è¡Œå…³é”®éƒ¨åˆ†çš„ä»£ç ï¼Œåœ¨äº’æ–¥é”çš„ä¿æŠ¤ä¸‹å¯¹æ•°æ®è¿›è¡ŒéåŸå­æ“ä½œã€‚åœ¨å­è¿›ç¨‹é‡Œï¼Œè¿™äº›çº¿ç¨‹æ¶ˆå¤±äº†ï¼Œåªç•™ä¸‹ä¸€äº›ä¿®æ”¹åˆ°ä¸€åŠå´æ²¡æœ‰å¯èƒ½â€œä¿®æ­£â€çš„æ•°æ®ï¼Œä¸å¯èƒ½å»ç¡®å®š â€œå…¶ä»–çº¿ç¨‹æ­£åœ¨åšä»€ä¹ˆâ€å’Œâ€œæ€ä¹ˆåšå¯ä»¥ä¿æŒæ•°æ®ä¸€è‡´â€ã€‚æ­¤å¤–ï¼Œé‚£äº›ï¼ˆå¤åˆ¶è¿‡æ¥çš„äº’æ–¥é”ï¼‰çš„çŠ¶æ€æ˜¯æœªå®šä¹‰ï¼Œä»–ä»¬ä¹Ÿè®¸ä¸èƒ½ç”¨ï¼ˆunusableï¼‰ï¼Œé™¤éå­è¿›ç¨‹è°ƒç”¨ pthread_mutex_init() å»é‡ç½®ä»–ä»¬çš„çŠ¶æ€ä¸ºä¸€ä¸ªå¯ç”¨çš„å€¼ã€‚å®ƒï¼ˆ pthread_mutex_init() ï¼‰çš„å®ç°å–å†³äºäº’æ–¥é”åœ¨ fork(2) æ‰§è¡Œä¹‹åçš„å…·ä½“è¡Œä¸ºã€‚åœ¨æˆ‘çš„ Linux æœºå™¨ä¸Šï¼Œè¢«é”å®šï¼ˆlockedï¼‰çš„äº’æ–¥é”çš„çŠ¶æ€ï¼ˆé‡ç½®ä¹‹åï¼‰åœ¨å­è¿›ç¨‹ä¸­ä»æ˜¯ï¼ˆlockedï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;åº“å‡½æ•°&lt;/p&gt;

&lt;p&gt;ä¸Šé¢å…³äºäº’æ–¥é”å’Œå…³é”®ä»£ç çš„é—®é¢˜ï¼Œåˆå¼•å‡ºäº†å¦ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ã€‚ç†è®ºä¸Šï¼Œå†™ä¸€äº›åœ¨å¤šçº¿ç¨‹ä¸Šè¿è¡Œå¹¶ä¸”åœ¨è°ƒç”¨ fork(2) ä¹‹åä¸ä¼šå‡ºé”™çš„ä»£ç ï¼Œæ˜¯å¯è¡Œçš„ã€‚ä½†æ˜¯ï¼Œå®è·µä¸­ï¼Œå´æœ‰ä¸€ä¸ªé—®é¢˜â”€â”€åº“å‡½æ•°ã€‚ä½ ä¸èƒ½ç¡®è®¤ä½ æ­£åœ¨ç”¨çš„åº“å‡½æ•°ä¸ä¼šä½¿ç”¨åˆ°å…¨å±€æ•°æ®ã€‚å³ä½¿å®ƒï¼ˆç”¨åˆ°çš„åº“å‡½æ•°ï¼‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒä¹Ÿå¯èƒ½æ˜¯é€šè¿‡åœ¨å†…éƒ¨ä½¿ç”¨äº’æ–¥é”æ¥è¾¾åˆ°ç›®çš„ã€‚ä½ æ°¸è¿œæ— æ³•ç¡®è®¤ã€‚å³ä½¿ç³»ç»Ÿçš„çº¿ç¨‹å®‰å…¨çš„åº“å‡½æ•°ï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨äº†äº’æ–¥é”ã€‚ä¸€ä¸ªæ½œåœ¨çš„ä¾‹å­æ˜¯ï¼Œmalloc() å‡½æ•°ï¼Œè‡³å°‘åœ¨æˆ‘çš„å¤šçº¿ç¨‹ç¨‹åºé‡Œï¼Œå†…éƒ¨ä½¿ç”¨äº†é”ã€‚æ‰€ä»¥ï¼Œåœ¨å…¶ä»–çº¿ç¨‹è°ƒç”¨ malloc() çš„æ—¶å€™è°ƒç”¨ fork(2) æ˜¯ä¸å®‰å…¨çš„ï¼ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿåœ¨ä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºè°ƒç”¨ fork(2) ä¹‹åï¼Œä½ åªåº”è¯¥è°ƒç”¨å¼‚æ­¥å®‰å…¨ï¼ˆasync-safeï¼‰çš„å‡½æ•°ï¼ˆåœ¨signal(7) http://www.kernel.org/doc/man-pages/online/pages/man7/signal.7.html åˆ—å‡ºï¼‰ã€‚è¿™ä¸ªåˆ—è¡¨ä¸ä½ åœ¨ä¸€ä¸ªæ¶ˆæ¯å›è°ƒå‡½æ•°ï¼ˆsignal hanlderï¼‰é‡Œé¢å¯ä»¥è°ƒç”¨çš„å‡½æ•°çš„åˆ—è¡¨æ˜¯ç›¸ä¼¼çš„ï¼Œè€ŒåŸå› ä¹Ÿç›¸ä¼¼ï¼šåœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼Œåœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œçº¿ç¨‹ä¼šè¢«ç»ˆæ­¢ï¼ˆåŸæ–‡ä¸ºå¸¦å¼•å·çš„interruptedï¼Œç”±äºè¯¥çº¿ç¨‹åœ¨æ–°çš„å­è¿›ç¨‹é‡Œå·²ç»ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ç¿»è¯‘ä¸ºç»ˆæ­¢ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œæ˜¯å‡ ä¸ªåœ¨æˆ‘çš„ç³»ç»Ÿé‡Œï¼Œä½¿ç”¨ç±»å†…éƒ¨é”çš„å‡½æ•°ï¼Œä»…ä»…æ˜¯æƒ³è®©ä½ çŸ¥é“ï¼Œå‡ ä¹æ²¡æœ‰ä¸œè¥¿æ˜¯å®‰å…¨çš„ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;malloc()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;stdioçš„å‡½æ•°ï¼Œæ¯”å¦‚printf() - è¿™æ˜¯æ ‡å‡†è¦æ±‚çš„&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;syslog()&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;execve() å’Œæ–‡ä»¶å¥æŸ„&lt;/p&gt;

&lt;p&gt;ä¼¼ä¹ä½¿ç”¨ execve(2) æ¥å¯åŠ¨ä¸€ä¸ªéœ€è¦è°ƒç”¨fork(2)çš„å¤šçº¿ç¨‹ç¨‹åºï¼Œæ˜¯ä½ å”¯ä¸€æ˜æ™ºçš„é€‰æ‹©ã€‚ä½†å³ä½¿è¿™æ ·åšï¼Œä¹Ÿè¿˜æœ‰ä¸€ç‚¹ä¸è¶³ã€‚å½“è°ƒç”¨execve(2) æ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„è¿˜å°†ç»´æŒæ‰“å¼€çš„çŠ¶æ€ï¼ˆåœ¨æ–°çš„å­è¿›ç¨‹ä¸­ â€”â€” è¯‘è€…Xorcererï¼‰ï¼Œå¯ä»¥ç»§ç»­è¢«è¯»å–å’Œå†™å…¥æ•°æ®ã€‚ä½ åœ¨è°ƒç”¨ execve(2) ä¹‹å‰æ‰“å¼€äº†ä¸€ä¸ªä½ ä¸å¸Œæœ›åœ¨æ–°çš„å­è¿›ç¨‹é‡Œè¢«ä½¿ç”¨çš„æ–‡ä»¶ï¼Œé—®é¢˜å°±å‡ºç°äº†ã€‚è¿™ç”šè‡³ä¼šäº§ç”Ÿå®‰å…¨æ–¹ä¾¿çš„é—®é¢˜ã€‚å¯¹æ­¤ï¼Œæœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä½ å¿…é¡»ä½¿ç”¨ fcntl(2) æ¥å¯¹æ¯ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„è®¾æ–½ FD_CLOEXEC æ ‡è®°ï¼Œè¿™æ ·ï¼Œå®ƒä»¬ä¼šåœ¨æ–°çš„è¿›ç¨‹ä¸­è¢«è‡ªåŠ¨å…³é—­ã€‚ä¸å¹¸çš„æ˜¯ï¼Œåœ¨å¤šçº¿ç¨‹ç¨‹åºé‡Œï¼Œè¿™æ²¡é‚£ä¹ˆç®€å•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ fcntl(2) å»è®¾ç½® FD_CLOEXEC æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªé—´éš™ï¼š
fd = open (â€œfileâ€, O_RDWR | O_CREAT | O_TRUNC,0600);&lt;/p&gt;

&lt;p&gt;if(fd &amp;lt;0){&lt;br /&gt;
    perror (â€œopen()â€);&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;return0;   }  
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;fcntl (fd, F_SETFD, FD_CLOEXEC);&lt;/p&gt;

&lt;p&gt;å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹æ­£å¥½åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ open(2) ä¹‹å fcntl(2) ä¹‹å‰è°ƒç”¨ fork(2) å’Œ execve(2) ï¼Œé‚£ä¹ˆå¾—åˆ°çš„æ–°è¿›ç¨‹å°†è·å¾—è¿™ä¸ªæ–‡ä»¶å¥æŸ„çš„å‰¯æœ¬ã€‚è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå·²ç»éšç€æ–°æ ‡å‡†ï¼ˆå¦‚ï¼šPOSIX.1-2008ï¼‰å’Œæ–°çš„ Linux å†…æ ¸ï¼ˆ2.6.23ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ï¼‰åˆ°æ¥äº†ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨ open(2) ä½¿ç”¨ O_CLOEXEC æ ‡è®°ï¼Œæ‰€ä»¥ï¼Œâ€œå¼€æ‰“æ–‡ä»¶ä¸è®¾ç½® FD_CLOEXECâ€ å·²ç»æˆä¸ºäº†ä¸€ä¸ªåŸå­æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†ä½¿ç”¨ open(2) ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„åˆ›å»ºæ–‡ä»¶å¥æŸ„çš„æ–¹æ³•ï¼šä½¿ç”¨ dup(2) å¤åˆ¶å®ƒä»¬ï¼Œä½¿ç”¨ socket(2) åˆ›å»ºsocketï¼Œç­‰ã€‚æ‰€æœ‰è¿™äº›å‡½æ•°ç°åœ¨éƒ½æœ‰ä¸€ä¸ªç›¸ä¼¼çš„æ ‡è®°å¦‚O_CLOEXECæˆ–è€…å…¶ä»–æ›´æ–°çš„ç‰ˆæœ¬ï¼ˆå…¶ä¸­æŸäº›å‡½æ•°ï¼Œå¦‚dup2(2)æ²¡æœ‰ä¸€ä¸ªç”¨äºæ ‡è®°ä½çš„å‚æ•°ï¼Œæ‰€ä»¥dup3(2)ä¸ºæ­¤äº§ç”Ÿäº†ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å€¼å¾—æåˆ°çš„ä¸€ç‚¹æ˜¯åŒæ ·çš„ä¸œè¥¿åœ¨å•çº¿ç¨‹ç¨‹åºé‡Œä¹Ÿå¯èƒ½å‘ç”Ÿï¼Œå¦‚æœå®ƒåœ¨åŒä¸€ä¸ªæ¶ˆæ¯å¤„ç†å‡½æ•°ï¼ˆsingal handlerï¼‰ä¸­ä½¿ç”¨ fork(2) å’Œ execve(2) ã€‚è¿™ä¸ªæ“ä½œæ˜¯å®Œå…¨åˆæ³•çš„ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå‡½æ•°æ˜¯å¼‚æ­¥å®‰å…¨å¹¶ä¸”å…è®¸åœ¨æ¶ˆæ¯å¤„ç†å‡½æ•°ä¸­è¢«è°ƒç”¨ï¼Œä½†æ˜¯é—®é¢˜æ˜¯è¿™ä¸ªç¨‹åºä¹Ÿè®¸ä¼šåœ¨è°ƒç”¨ open(2) å’Œ fcntl(2) ä¹‹é—´æ—¶ï¼Œè¢«ä¸­æ–­ã€‚&lt;/p&gt;

&lt;p&gt;æƒ³çŸ¥é“æ›´å¤šå…³äºè®¾ç½® FD_CLOEXEC æ–°APIçš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ ã€ŠUlrich Drepperâ€™s blog: Secure File Descriptor Handlingã€‹ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€ä¸ªæœ‰ç”¨çš„ç³»ç»Ÿå‡½æ•°ï¼špthread_atfork()&lt;/p&gt;

&lt;p&gt;å…¶ä¸­ä¸€ä¸ªå°è¯•è§£å†³å¤šçº¿ç¨‹ç¨‹åºä¸­ä½¿ç”¨ fork(2) çš„é—®é¢˜çš„å‡½æ•°æ˜¯ pthread_atfork()ã€‚å®ƒæ‹¥æœ‰å¦‚ä¸‹åŸå‹ï¼š
int pthread_atfork(void (&lt;em&gt;prepare)(void), void (&lt;/em&gt;parent)(void), void (*child)(void));&lt;/p&gt;

&lt;p&gt;å®ƒå…è®¸æŒ‡å®šåœ¨ fork è¢«è°ƒç”¨æ—¶çš„å¤„ç†å‡½æ•°ï¼š&lt;/p&gt;

&lt;p&gt;prepare æ–°è¿›ç¨‹äº§ç”Ÿä¹‹å‰è¢«è°ƒç”¨ã€‚
parent æ–°è¿›ç¨‹äº§ç”Ÿä¹‹ååœ¨çˆ¶è¿›ç¨‹è¢«è°ƒç”¨ã€‚
child æ–°è¿›ç¨‹äº§ç”Ÿä¹‹åï¼Œåœ¨å­è¿›ç¨‹è¢«è°ƒç”¨ã€‚
è°ƒç”¨çš„ç›®çš„æ˜¯åœ¨ fork(2) è¢«è°ƒç”¨æ—¶ï¼Œå¤„ç†å¤šçº¿ç¨‹ç¨‹åºçš„å…³é”®éƒ¨åˆ†ï¼ˆæœ¬æ–‡å¼€å§‹éƒ¨åˆ†æåŠï¼‰ã€‚ä¸€ä¸ªå¸¸è§çš„åœºæ™¯æ—¶åœ¨ prepare å¤„ç†å‡½æ•°ä¸­åŠ é”ï¼Œåœ¨ parent å¤„ç†å‡½æ•°è§£é”å’Œåœ¨ child å¤„ç†å‡½æ•°é‡æ–°åˆå§‹åŒ–é”ã€‚&lt;/p&gt;
</description>
        <pubDate>Fri, 22 Dec 2017 00:00:00 +0800</pubDate>
        <link>https://xiazemin.github.io/MyBlog/linux/2017/12/22/fork.html</link>
        <guid isPermaLink="true">https://xiazemin.github.io/MyBlog/linux/2017/12/22/fork.html</guid>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>Linuxè¿›ç¨‹æ§åˆ¶â€”â€”execå‡½æ•°æ—</title>
        <description>&lt;p&gt;åœ¨Linuxä¸­ï¼Œå¹¶ä¸å­˜åœ¨exec()å‡½æ•°ï¼ŒexecæŒ‡çš„æ˜¯ä¸€ç»„å‡½æ•°ï¼Œä¸€å…±æœ‰6ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼š
 #include &lt;unistd.h&gt;
extern char **environ;
int execl(const char *path, const char *arg, ...);
int execlp(const char *file, const char *arg, ...);
int execle(const char *path, const char *arg, ..., char * const envp[]);
int execv(const char *path, char *const argv[]);
int execvp(const char *file, char *const argv[]);
int execve(const char *path, char *const argv[], char *const envp[]);
å…¶ä¸­åªæœ‰execveæ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶å®ƒéƒ½æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šç»è¿‡åŒ…è£…çš„åº“å‡½æ•°ã€‚
execå‡½æ•°æ—çš„ä½œç”¨æ˜¯æ ¹æ®æŒ‡å®šçš„æ–‡ä»¶åæ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ç”¨å®ƒæ¥å–ä»£è°ƒç”¨è¿›ç¨‹çš„å†…å®¹ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯åœ¨è°ƒç”¨è¿›ç¨‹å†…éƒ¨æ‰§è¡Œä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™é‡Œçš„å¯æ‰§è¡Œæ–‡ä»¶æ—¢å¯ä»¥æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»»ä½•Linuxä¸‹å¯æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶ã€‚
å‡½æ•°åä¸å‚æ•°çš„å…³ç³»ï¼š
ç»†çœ‹ä¸€ä¸‹ï¼Œè¿™6ä¸ªå‡½æ•°éƒ½æ˜¯ä»¥execå¼€å¤´ï¼ˆè¡¨ç¤ºå±äºexecå‡½æ•°ç»„ï¼‰ï¼Œå‰3ä¸ªå‡½æ•°æ¥ç€å­—æ¯lçš„ï¼Œå3ä¸ªæ¥ç€å­—æ¯vçš„ï¼Œæˆ‘çš„ç†è§£æ˜¯lè¡¨ç¤ºlistï¼ˆåˆ—ä¸¾å‚æ•°ï¼‰ï¼Œvè¡¨ç¤ºvectorï¼ˆå‚æ•°å‘é‡è¡¨ï¼‰
ã€‚å®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼Œexecvå¼€å¤´çš„å‡½æ•°æ˜¯ä»¥&quot;char *argv[]&quot;(vector)å½¢å¼ä¼ é€’å‘½ä»¤è¡Œå‚æ•°ï¼Œè€Œexeclå¼€å¤´çš„å‡½æ•°é‡‡ç”¨äº†ç½—åˆ—(list)çš„æ–¹å¼ï¼ŒæŠŠå‚æ•°ä¸€ä¸ªä¸€ä¸ªåˆ—å‡ºæ¥ï¼Œç„¶åä»¥ä¸€ä¸ªNULLè¡¨ç¤ºç»“æŸã€‚è¿™é‡Œçš„NULLçš„ä½œç”¨å’Œargvæ•°ç»„é‡Œçš„NULLä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚
å­—æ¯pæ˜¯æŒ‡åœ¨ç¯å¢ƒå˜é‡PATHçš„ç›®å½•é‡Œå»æŸ¥æ‰¾è¦æ‰§è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚2ä¸ªä»¥pç»“å°¾çš„å‡½æ•°execlpå’Œexecvpï¼Œçœ‹èµ·æ¥ï¼Œå’Œexeclä¸execvçš„å·®åˆ«å¾ˆå°ï¼Œäº‹å®ä¹Ÿå¦‚æ­¤ï¼Œå®ƒä»¬çš„åŒºåˆ«ä»ç¬¬ä¸€ä¸ªå‚æ•°åå¯ä»¥çœ‹å‡ºï¼šé™¤ execlpå’Œexecvpä¹‹å¤–çš„4ä¸ªå‡½æ•°éƒ½è¦æ±‚ï¼Œå®ƒä»¬çš„ç¬¬1ä¸ªå‚æ•°pathå¿…é¡»æ˜¯ä¸€ä¸ªå®Œæ•´çš„è·¯å¾„ï¼Œå¦‚&quot;/bin/ls&quot;ï¼›è€Œexeclpå’Œexecvp çš„ç¬¬1ä¸ªå‚æ•°fileå¯ä»¥ä»…ä»…åªæ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼Œå¦‚&quot;ls&quot;ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥è‡ªåŠ¨åˆ°ç¯å¢ƒå˜é‡PATHæŒ‡å®šçš„ç›®å½•é‡Œå»æŸ¥æ‰¾ã€‚
å­—æ¯eæ˜¯æŒ‡ç»™å¯æ‰§è¡Œæ–‡ä»¶æŒ‡å®šç¯å¢ƒå˜é‡ã€‚åœ¨å…¨éƒ¨6ä¸ªå‡½æ•°ä¸­ï¼Œåªæœ‰execleå’Œexecveä½¿ç”¨äº†char *envp[]ä¼ é€’ç¯å¢ƒå˜é‡ï¼Œå…¶å®ƒçš„4ä¸ªå‡½æ•°éƒ½æ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼Œè¿™å¹¶ä¸æ„å‘³ç€å®ƒä»¬ä¸ä¼ é€’ç¯å¢ƒå˜é‡ï¼Œè¿™4ä¸ªå‡½æ•°å°†æŠŠé»˜è®¤çš„ç¯å¢ƒå˜é‡ä¸åšä»»ä½•ä¿®æ”¹åœ°ä¼ ç»™è¢«æ‰§è¡Œçš„åº”ç”¨ç¨‹åºã€‚è€Œexecleå’Œexecveç”¨æŒ‡å®šçš„ç¯å¢ƒå˜é‡å»æ›¿ä»£é»˜è®¤çš„é‚£äº›ã€‚
è¿”å›å€¼
ä¸ä¸€èˆ¬æƒ…å†µä¸åŒï¼Œexecå‡½æ•°æ—çš„å‡½æ•°æ‰§è¡ŒæˆåŠŸåä¸ä¼šè¿”å›ï¼Œå› ä¸ºè°ƒç”¨è¿›ç¨‹çš„å®ä½“ï¼ŒåŒ…æ‹¬ä»£ç æ®µï¼Œæ•°æ®æ®µå’Œå †æ ˆç­‰éƒ½å·²ç»è¢«æ–°çš„å†…å®¹å–ä»£ï¼Œåªæœ‰è¿›ç¨‹IDç­‰ä¸€äº›è¡¨é¢ä¸Šçš„ä¿¡æ¯ä»ä¿æŒåŸæ ·ã€‚è°ƒç”¨å¤±è´¥æ—¶ï¼Œä¼šè®¾ç½®errnoå¹¶è¿”å›-1ï¼Œç„¶åä»åŸç¨‹åºçš„è°ƒç”¨ç‚¹æ¥ç€å¾€ä¸‹æ‰§è¡Œã€‚
ä¸å…¶ä»–ç³»ç»Ÿè°ƒç”¨æ¯”èµ·æ¥ï¼Œexecå¾ˆå®¹æ˜“å¤±è´¥ï¼Œè¢«æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ï¼Œæƒé™ç­‰å¾ˆå¤šå› ç´ éƒ½èƒ½å¯¼è‡´è°ƒç”¨å¤±è´¥ã€‚å› æ­¤ï¼Œä½¿ç”¨execå‡½æ•°æ—æ—¶ï¼Œä¸€å®šè¦åŠ é”™è¯¯åˆ¤æ–­è¯­å¥ã€‚æœ€å¸¸è§çš„é”™è¯¯ï¼š
æ‰¾ä¸åˆ°æ–‡ä»¶æˆ–è·¯å¾„ï¼Œæ­¤æ—¶errnoè¢«è®¾ç½®ä¸ºENOENTï¼›
æ•°ç»„argvå’Œenvpå¿˜è®°ç”¨NULLç»“æŸï¼Œæ­¤æ—¶errnoè¢«è®¾ç½®ä¸ºEFAULTï¼›
æ²¡æœ‰å¯¹è¦æ‰§è¡Œæ–‡ä»¶çš„è¿è¡Œæƒé™ï¼Œæ­¤æ—¶errnoè¢«è®¾ç½®ä¸ºEACCESã€‚
2ã€åº”ç”¨
å¦‚æœä¸€ä¸ªè¿›ç¨‹æƒ³æ‰§è¡Œå¦ä¸€ä¸ªç¨‹åºï¼Œå®ƒå°±å¯ä»¥forkæˆ–vforkå‡ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œç„¶åè°ƒç”¨ä»»ä½•ä¸€ä¸ªexecå‡½æ•°ã€‚
ä¸ºæ­¤ï¼ŒLinuxè¿˜ä¸“é—¨å¯¹forkä½œäº†ä¼˜åŒ–ï¼šé€šå¸¸forkä¼šå°†è°ƒç”¨è¿›ç¨‹çš„æ‰€æœ‰å†…å®¹åŸå°ä¸åŠ¨çš„æ‹·è´åˆ°æ–°äº§ç”Ÿçš„å­è¿›ç¨‹ä¸­å»ï¼Œè¿™äº›æ‹·è´çš„åŠ¨ä½œå¾ˆæ¶ˆè€—æ—¶ é—´ï¼Œè€Œå¦‚æœforkå®Œä¹‹åæˆ‘ä»¬é©¬ä¸Šå°±è°ƒç”¨execï¼Œé‚£è¿™äº›è¾›è¾›è‹¦è‹¦æ‹·è´æ¥çš„ä¸œè¥¿å°±ä¼šè¢«ç«‹åˆ»æŠ¹æ‰ï¼Œè¿™çœ‹èµ·æ¥éå¸¸ä¸åˆ’ç®—ï¼Œäºæ˜¯äººä»¬è®¾è®¡äº†ä¸€ç§&quot;å†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰&quot; æŠ€æœ¯ï¼Œä½¿å¾—forkç»“æŸåå¹¶ä¸ç«‹åˆ»å¤åˆ¶çˆ¶è¿›ç¨‹çš„å†…å®¹åˆ°å­è¿›ç¨‹ï¼Œè€Œæ˜¯åˆ°äº†çœŸæ­£ä½¿ç”¨æ—¶æ‰å¤åˆ¶ï¼Œè¿™æ ·å¦‚æœä¸‹ä¸€æ¡è¯­å¥æ˜¯execï¼Œå®ƒå°±ä¸ä¼šä½œæ— ç”¨åŠŸäº†ã€‚å…¶å®&quot;å†™æ—¶ å¤åˆ¶&quot;è¿˜æ˜¯æœ‰å¤åˆ¶ï¼Œè¿›ç¨‹çš„mmç»“æ„ã€é¡µè¡¨éƒ½è¿˜æ˜¯è¢«å¤åˆ¶äº†ï¼ˆ&quot;å†™æ—¶å¤åˆ¶&quot;ä¹Ÿå¿…é¡»ç”±è¿™äº›ä¿¡æ¯æ¥æ”¯æ’‘ã€‚å¦åˆ™å†…æ ¸æ•æ‰åˆ°CPUè®¿å­˜å¼‚å¸¸ï¼Œæ€ä¹ˆåŒºåˆ† è¿™æ˜¯â€œå†™æ—¶å¤åˆ¶â€å¼•èµ·çš„ï¼Œè¿˜æ˜¯çœŸæ­£çš„è¶Šæƒè®¿é—®å‘¢ï¼Ÿï¼‰ã€‚
è€Œvforkå°±æŠŠäº‹æƒ…åšç»äº†ï¼Œæ‰€æœ‰æœ‰å…³äºå†…å­˜çš„ä¸œè¥¿éƒ½ä¸å¤åˆ¶äº†ï¼Œçˆ¶å­è¿›ç¨‹çš„å†…å­˜æ˜¯å®Œå…¨å…±äº«çš„ã€‚ ä½†æ˜¯è¿™æ ·ä¸€æ¥åˆæœ‰é—®é¢˜äº†ï¼Œè™½ç„¶ç”¨æˆ·ç¨‹åºå¯ä»¥è®¾è®¡å¾ˆå¤šæ–¹æ³•æ¥é¿å…çˆ¶å­è¿›ç¨‹é—´çš„è®¿å­˜å†²çªã€‚ä½†æ˜¯å…³é”®çš„ä¸€ç‚¹ï¼Œçˆ¶å­è¿›ç¨‹å…±ç”¨ç€æ ˆï¼Œè¿™å¯ä¸ç”±ç”¨æˆ·ç¨‹åºæ§åˆ¶çš„ã€‚ä¸€ä¸ªè¿› ç¨‹è¿›è¡Œäº†å…³äºå‡½æ•°è°ƒç”¨æˆ–è¿”å›çš„æ“ä½œï¼Œåˆ™å¦ä¸€ä¸ªè¿›ç¨‹çš„è°ƒç”¨æ ˆ ï¼ˆå®é™…ä¸Šå°±æ˜¯åŒä¸€ä¸ªæ ˆï¼‰ä¹Ÿè¢«å½±å“äº†ã€‚è¿™æ ·çš„ç¨‹åºæ²¡æ³•è¿è¡Œä¸‹å»ã€‚æ‰€ä»¥ï¼Œvforkæœ‰ä¸ªé™åˆ¶ï¼Œå­è¿›ç¨‹ç”Ÿæˆåï¼Œçˆ¶è¿›ç¨‹åœ¨vforkä¸­è¢«å†…æ ¸æŒ‚èµ·ï¼Œç›´åˆ°å­è¿›ç¨‹æœ‰äº† è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼ˆexec**ï¼‰æˆ–é€€å‡º(_exit)ã€‚å¹¶ä¸”ï¼Œ åœ¨æ­¤ä¹‹å‰ï¼Œå­è¿›ç¨‹ä¸èƒ½ä»è°ƒç”¨vforkçš„å‡½æ•°ä¸­è¿”å›ï¼ˆåŒæ—¶ï¼Œä¸èƒ½ä¿®æ”¹æ ˆä¸Šå˜é‡ã€ä¸èƒ½ç»§ç»­è°ƒç”¨é™¤_exitæˆ–execç³»åˆ—ä¹‹å¤–çš„å‡½æ•°ï¼Œå¦åˆ™çˆ¶è¿›ç¨‹çš„æ•°æ®å¯èƒ½ è¢«æ”¹å†™ï¼‰ã€‚
å°½ç®¡é™åˆ¶å¾ˆå¤šï¼Œvforkåé©¬ä¸Šexecæ•ˆç‡ä¼šæ¯”forké«˜ä¸å°‘ã€‚
&lt;!-- more --&gt;
forkå‡½æ•°æ˜¯ç”¨äºåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¯¥å­è¿›ç¨‹å‡ ä¹æ˜¯çˆ¶è¿›ç¨‹çš„å‰¯æœ¬ï¼Œè€Œæœ‰æ—¶æˆ‘ä»¬å¸Œæœ›å­è¿›ç¨‹å»æ‰§è¡Œå¦å¤–çš„ç¨‹åºï¼Œexecå‡½æ•°æ—å°±æä¾›äº†ä¸€ä¸ªåœ¨è¿›ç¨‹ä¸­å¯åŠ¨å¦ä¸€ä¸ªç¨‹åºæ‰§è¡Œçš„æ–¹æ³•ã€‚å®ƒå¯ä»¥æ ¹æ®æŒ‡å®šçš„æ–‡ä»¶åæˆ–ç›®å½•åæ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ç”¨å®ƒæ¥å–ä»£åŸè°ƒç”¨è¿›ç¨‹çš„æ•°æ®æ®µã€ä»£ç æ®µå’Œå †æ ˆæ®µï¼Œåœ¨æ‰§è¡Œå®Œä¹‹åï¼ŒåŸè°ƒç”¨è¿›ç¨‹çš„å†…å®¹é™¤äº†è¿›ç¨‹å·å¤–ï¼Œå…¶ä»–å…¨éƒ¨è¢«æ–°ç¨‹åºçš„å†…å®¹æ›¿æ¢äº†ã€‚å¦å¤–ï¼Œè¿™é‡Œçš„å¯æ‰§è¡Œæ–‡ä»¶æ—¢å¯ä»¥æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯Linuxä¸‹ä»»ä½•å¯æ‰§è¡Œè„šæœ¬æ–‡ä»¶ã€‚
ï¼ˆ2ï¼‰åœ¨Linuxä¸­ä½¿ç”¨execå‡½æ•°æ—ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µ
a. å½“è¿›ç¨‹è®¤ä¸ºè‡ªå·±ä¸èƒ½å†ä¸ºç³»ç»Ÿå’Œç”¨æˆ·åšå‡ºä»»ä½•è´¡çŒ®æ—¶ï¼Œå°±å¯ä»¥è°ƒç”¨ä»»ä½•exec å‡½æ•°æ—è®©è‡ªå·±é‡ç”Ÿã€‚
b. å¦‚æœä¸€ä¸ªè¿›ç¨‹æƒ³æ‰§è¡Œå¦ä¸€ä¸ªç¨‹åºï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥è°ƒç”¨forkå‡½æ•°æ–°å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œç„¶åè°ƒç”¨ä»»ä½•ä¸€ä¸ªexecå‡½æ•°ä½¿å­è¿›ç¨‹é‡ç”Ÿã€‚
ï¼ˆ3ï¼‰execå‡½æ•°æ—è¯­æ³•
å®é™…ä¸Šï¼Œåœ¨Linuxä¸­å¹¶æ²¡æœ‰execå‡½æ•°ï¼Œè€Œæ˜¯æœ‰6ä¸ªä»¥execå¼€å¤´çš„å‡½æ•°æ—ï¼Œä¸‹è¡¨åˆ—ä¸¾äº†execå‡½æ•°æ—çš„6ä¸ªæˆå‘˜å‡½æ•°çš„è¯­æ³•ã€‚
æ‰€éœ€å¤´æ–‡ä»¶ï¼š #include &lt;unistd.h&gt;
å‡½æ•°è¯´æ˜ï¼š æ‰§è¡Œæ–‡ä»¶
å‡½æ•°åŸå‹ï¼š
[plain] view plain copy
int execl(const char *path, const char *arg, ...)  
int execv(const char *path, char *const argv[])  
int execle(const char *path, const char *arg, ..., char *const envp[])  
int execve(const char *path, char *const argv[], char *const envp[])  
int execlp(const char *file, const char *arg, ...)  
int execvp(const char *file, char *const argv[])&lt;/unistd.h&gt;&lt;/unistd.h&gt;&lt;/p&gt;

&lt;p&gt;å‡½æ•°è¿”å›å€¼ï¼šæˆåŠŸ -&amp;gt; å‡½æ•°ä¸ä¼šè¿”å›ï¼Œå‡ºé”™ -&amp;gt; è¿”å›-1ï¼Œå¤±è´¥åŸå› è®°å½•åœ¨errorä¸­ã€‚
è¿™6 ä¸ªå‡½æ•°åœ¨å‡½æ•°åå’Œä½¿ç”¨è¯­æ³•çš„è§„åˆ™ä¸Šéƒ½æœ‰ç»†å¾®çš„åŒºåˆ«ï¼Œä¸‹é¢å°±å¯æ‰§è¡Œæ–‡ä»¶æŸ¥æ‰¾æ–¹å¼ã€å‚æ•°è¡¨ä¼ é€’æ–¹å¼åŠç¯å¢ƒå˜é‡è¿™å‡ ä¸ªæ–¹é¢è¿›è¡Œæ¯”è¾ƒè¯´æ˜ã€‚
â‘     æŸ¥æ‰¾æ–¹å¼ï¼šä¸Šè¡¨å…¶ä¸­å‰4ä¸ªå‡½æ•°çš„æŸ¥æ‰¾æ–¹å¼éƒ½æ˜¯å®Œæ•´çš„æ–‡ä»¶ç›®å½•è·¯å¾„ï¼Œè€Œæœ€å2ä¸ªå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯ä»¥pç»“å°¾çš„ä¸¤ä¸ªå‡½æ•°ï¼‰å¯ä»¥åªç»™å‡ºæ–‡ä»¶åï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨ä»ç¯å¢ƒå˜é‡â€œ$PATHâ€æ‰€æŒ‡å‡ºçš„è·¯å¾„ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚
â‘¡    å‚æ•°ä¼ é€’æ–¹å¼ï¼šexecå‡½æ•°æ—çš„å‚æ•°ä¼ é€’æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€ä¸ªåˆ—ä¸¾çš„æ–¹å¼ï¼Œè€Œå¦ä¸€ç§åˆ™æ˜¯å°†æ‰€æœ‰å‚æ•°æ•´ä½“æ„é€ æˆæŒ‡é’ˆæ•°ç»„è¿›è¡Œä¼ é€’ã€‚
åœ¨è¿™é‡Œå‚æ•°ä¼ é€’æ–¹å¼æ˜¯ä»¥å‡½æ•°åçš„ç¬¬5ä½å­—æ¯æ¥åŒºåˆ†çš„ï¼Œå­—æ¯ä¸ºâ€œlâ€ï¼ˆlistï¼‰çš„è¡¨ç¤ºé€ä¸ªåˆ—ä¸¾çš„æ–¹å¼ï¼Œå­—æ¯ä¸ºâ€œvâ€ï¼ˆvertorï¼‰çš„è¡¨ç¤ºå°†æ‰€æœ‰å‚æ•°æ•´ä½“æ„é€ æˆæŒ‡é’ˆæ•°ç»„ä¼ é€’ï¼Œç„¶åå°†è¯¥æ•°ç»„çš„é¦–åœ°å€å½“åšå‚æ•°ä¼ ç»™å®ƒï¼Œæ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªæŒ‡é’ˆè¦æ±‚æ˜¯NULLã€‚è¯»è€…å¯ä»¥è§‚å¯Ÿexeclã€execleã€execlpçš„è¯­æ³•ä¸execvã€execveã€execvpçš„åŒºåˆ«ã€‚
â‘¢    ç¯å¢ƒå˜é‡ï¼šexecå‡½æ•°æ—ä½¿ç”¨äº†ç³»ç»Ÿé»˜è®¤çš„ç¯å¢ƒå˜é‡ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥æŒ‡å®šçš„ç¯å¢ƒå˜é‡ã€‚è¿™é‡Œä»¥â€œeâ€ï¼ˆenvironmentï¼‰ç»“å°¾çš„ä¸¤ä¸ªå‡½æ•°execleã€execveå°±å¯ä»¥åœ¨envp[]ä¸­æŒ‡å®šå½“å‰è¿›ç¨‹æ‰€ä½¿ç”¨çš„ç¯å¢ƒå˜é‡æ›¿æ¢æ‰è¯¥è¿›ç¨‹ç»§æ‰¿çš„æ‰€ä»¥ç¯å¢ƒå˜é‡ã€‚
ï¼ˆ4ï¼‰PATHç¯å¢ƒå˜é‡è¯´æ˜
PATHç¯å¢ƒå˜é‡åŒ…å«äº†ä¸€å¼ ç›®å½•è¡¨ï¼Œç³»ç»Ÿé€šè¿‡PATHç¯å¢ƒå˜é‡å®šä¹‰çš„è·¯å¾„æœç´¢æ‰§è¡Œç ï¼ŒPATHç¯å¢ƒå˜é‡å®šä¹‰æ—¶ç›®å½•ä¹‹é—´éœ€ç”¨ç”¨â€œ:â€åˆ†éš”ï¼Œä»¥â€œ.â€å·è¡¨ç¤ºç»“æŸã€‚PATHç¯å¢ƒå˜é‡å®šä¹‰åœ¨ç”¨æˆ·çš„.profileæˆ–.bash_profileä¸­ï¼Œä¸‹é¢æ˜¯PATHç¯å¢ƒå˜é‡å®šä¹‰çš„æ ·ä¾‹ï¼Œæ­¤PATHå˜é‡æŒ‡å®šåœ¨â€œ/binâ€ã€â€œ/usr/binâ€å’Œå½“å‰ç›®å½•ä¸‰ä¸ªç›®å½•è¿›è¡Œæœç´¢æ‰§è¡Œç ã€‚
PATH=/bin:/usr/bin:.
export $PATH
ï¼ˆ5ï¼‰è¿›ç¨‹ä¸­çš„ç¯å¢ƒå˜é‡è¯´æ˜
    åœ¨Linuxä¸­ï¼ŒShellè¿›ç¨‹æ˜¯æ‰€æœ‰æ‰§è¡Œç çš„çˆ¶è¿›ç¨‹ã€‚å½“ä¸€ä¸ªæ‰§è¡Œç æ‰§è¡Œæ—¶ï¼ŒShellè¿›ç¨‹ä¼šforkå­è¿›ç¨‹ç„¶åè°ƒç”¨execå‡½æ•°å»æ‰§è¡Œæ‰§è¡Œç ã€‚Shellè¿›ç¨‹å †æ ˆä¸­å­˜æ”¾ç€è¯¥ç”¨æˆ·ä¸‹çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨execlã€execvã€execlpã€execvpå‡½æ•°ä½¿æ‰§è¡Œç é‡ç”Ÿæ—¶ï¼ŒShellè¿›ç¨‹ä¼šå°†æ‰€æœ‰ç¯å¢ƒå˜é‡å¤åˆ¶ç»™ç”Ÿæˆçš„æ–°è¿›ç¨‹ï¼›è€Œä½¿ç”¨execleã€execveæ—¶æ–°è¿›ç¨‹ä¸ç»§æ‰¿ä»»ä½•Shellè¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œè€Œç”±envp[]æ•°ç»„è‡ªè¡Œè®¾ç½®ç¯å¢ƒå˜é‡ã€‚
ï¼ˆ6ï¼‰execå‡½æ•°æ—å…³ç³»
ç¬¬4ä½ç»Ÿä¸€ä¸ºï¼šexec
ç¬¬5ä½
lï¼šå‚æ•°ä¼ é€’ä¸ºé€ä¸ªåˆ—ä¸¾æ–¹å¼
execlã€execleã€execlp
vï¼šå‚æ•°ä¼ é€’ä¸ºæ„é€ æŒ‡é’ˆæ•°ç»„æ–¹å¼
execvã€execveã€execvp
ç¬¬6ä½
eï¼šå¯ä¼ é€’æ–°è¿›ç¨‹ç¯å¢ƒå˜é‡
execleã€execve
pï¼šå¯æ‰§è¡Œæ–‡ä»¶æŸ¥æ‰¾æ–¹å¼ä¸ºæ–‡ä»¶å
execlpã€execvp
äº‹å®ä¸Šï¼Œè¿™6ä¸ªå‡½æ•°ä¸­çœŸæ­£çš„ç³»ç»Ÿè°ƒç”¨åªæœ‰execveï¼Œå…¶ä»–5ä¸ªéƒ½æ˜¯åº“å‡½æ•°ï¼Œå®ƒä»¬æœ€ç»ˆéƒ½ä¼šè°ƒç”¨execveè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè°ƒç”¨å…³ç³»å¦‚ä¸‹å›¾
&lt;img src=&quot;https://xiazemin.github.io/MyBlog/img/exec.gif&quot; /&gt;
ï¼ˆ7ï¼‰execè°ƒç”¨ä¸¾ä¾‹å¦‚ä¸‹ï¼š
[plain] view plain copy
char *const ps_argv[] ={â€œpsâ€, â€œ-oâ€, â€œpid,ppid,pgrp,session,tpgid,commâ€, NULL};&lt;br /&gt;
char *const ps_envp[] ={â€œPATH=/bin:/usr/binâ€, â€œTERM=consoleâ€, NULL};&lt;br /&gt;
execl(â€œ/bin/psâ€, â€œpsâ€, â€œ-oâ€, â€œpid,ppid,pgrp,session,tpgid,commâ€, NULL);&lt;br /&gt;
execv(â€œ/bin/psâ€, ps_argv);&lt;br /&gt;
execle(â€œ/bin/psâ€, â€œpsâ€, â€œ-oâ€, â€œpid,ppid,pgrp,session,tpgid,commâ€, NULL, ps_envp);&lt;br /&gt;
execve(â€œ/bin/psâ€, ps_argv, ps_envp);&lt;br /&gt;
execlp(â€œpsâ€, â€œpsâ€, â€œ-oâ€, â€œpid,ppid,pgrp,session,tpgid,commâ€, NULL);&lt;br /&gt;
execvp(â€œpsâ€, ps_argv);&lt;/p&gt;

&lt;p&gt;è¯·æ³¨æ„execå‡½æ•°æ—å½¢å‚å±•å¼€æ—¶çš„å‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¸¦è·¯å¾„çš„æ‰§è¡Œç ï¼ˆexeclpã€execvpå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ— è·¯å¾„çš„ï¼Œç³»ç»Ÿä¼šæ ¹æ®PATHè‡ªåŠ¨æŸ¥æ‰¾ç„¶ååˆæˆå¸¦è·¯å¾„çš„æ‰§è¡Œç ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸å¸¦è·¯å¾„çš„æ‰§è¡Œç ï¼Œæ‰§è¡Œç å¯ä»¥æ˜¯äºŒè¿›åˆ¶æ‰§è¡Œç å’ŒShellè„šæœ¬ã€‚
ï¼ˆ8ï¼‰execå‡½æ•°æ—ä½¿ç”¨æ³¨æ„ç‚¹
åœ¨ä½¿ç”¨execå‡½æ•°æ—æ—¶ï¼Œä¸€å®šè¦åŠ ä¸Šé”™è¯¯åˆ¤æ–­è¯­å¥ã€‚å› ä¸ºexecå¾ˆå®¹æ˜“æ‰§è¡Œå¤±è´¥ï¼Œå…¶ä¸­æœ€å¸¸è§çš„åŸå› æœ‰ï¼š
â‘     æ‰¾ä¸åˆ°æ–‡ä»¶æˆ–è·¯å¾„ï¼Œæ­¤æ—¶errnoè¢«è®¾ç½®ä¸ºENOENTã€‚
â‘¡    æ•°ç»„argvå’Œenvpå¿˜è®°ç”¨NULLç»“æŸï¼Œæ­¤æ—¶errnoè¢«è®¾ç½®ä¸ºEFAULTã€‚
â‘¢    æ²¡æœ‰å¯¹åº”å¯æ‰§è¡Œæ–‡ä»¶çš„è¿è¡Œæƒé™ï¼Œæ­¤æ—¶errnoè¢«è®¾ç½®ä¸ºEACCESã€‚
ï¼ˆ9ï¼‰execåæ–°è¿›ç¨‹ä¿æŒåŸè¿›ç¨‹ä»¥ä¸‹ç‰¹å¾
ÂŸ      ç¯å¢ƒå˜é‡ï¼ˆä½¿ç”¨äº†execleã€execveå‡½æ•°åˆ™ä¸ç»§æ‰¿ç¯å¢ƒå˜é‡ï¼‰ï¼›
ÂŸ      è¿›ç¨‹IDå’Œçˆ¶è¿›ç¨‹IDï¼›
ÂŸ      å®é™…ç”¨æˆ·IDå’Œå®é™…ç»„IDï¼›
ÂŸ      é™„åŠ ç»„IDï¼›
ÂŸ      è¿›ç¨‹ç»„IDï¼›
ÂŸ      ä¼šè¯IDï¼›
ÂŸ      æ§åˆ¶ç»ˆç«¯ï¼›
ÂŸ      å½“å‰å·¥ä½œç›®å½•ï¼›
ÂŸ      æ ¹ç›®å½•ï¼›
ÂŸ      æ–‡ä»¶æƒé™å±è”½å­—ï¼›
ÂŸ      æ–‡ä»¶é”ï¼›
ÂŸ      è¿›ç¨‹ä¿¡å·å±è”½ï¼›
ÂŸ      æœªå†³ä¿¡å·ï¼›
ÂŸ      èµ„æºé™åˆ¶ï¼›
ÂŸ      tms_utimeã€tms_stimeã€tms_cutimeä»¥åŠtms_ustimeå€¼ã€‚
å¯¹æ‰“å¼€æ–‡ä»¶çš„å¤„ç†ä¸æ¯ä¸ªæè¿°ç¬¦çš„execå…³é—­æ ‡å¿—å€¼æœ‰å…³ï¼Œè¿›ç¨‹ä¸­æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦æœ‰ä¸€ä¸ªexecå…³é—­æ ‡å¿—ï¼ˆFD_CLOEXECï¼‰ï¼Œè‹¥æ­¤æ ‡å¿—è®¾ç½®ï¼Œåˆ™åœ¨æ‰§è¡Œexecæ—¶å…³é—­è¯¥æè¿°ç¬¦ï¼Œå¦åˆ™è¯¥æè¿°ç¬¦ä»æ‰“å¼€ã€‚é™¤éç‰¹åœ°ç”¨fcntlè®¾ç½®äº†è¯¥æ ‡å¿—ï¼Œå¦åˆ™ç³»ç»Ÿçš„é»˜è®¤æ“ä½œæ˜¯åœ¨execåä»ä¿æŒè¿™ç§æè¿°ç¬¦æ‰“å¼€ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹å¯ä»¥å®ç°I/Oé‡å®šå‘ã€‚&lt;/p&gt;

</description>
        <pubDate>Fri, 22 Dec 2017 00:00:00 +0800</pubDate>
        <link>https://xiazemin.github.io/MyBlog/linux/2017/12/22/exec.html</link>
        <guid isPermaLink="true">https://xiazemin.github.io/MyBlog/linux/2017/12/22/exec.html</guid>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>å„ç§æ ‘çš„åº”ç”¨åœºæ™¯</title>
        <description>&lt;!-- more --&gt;
&lt;p&gt;AVLæ ‘ï¼šå¹³è¡¡äºŒå‰æ ‘ï¼Œä¸€èˆ¬æ˜¯ç”¨å¹³è¡¡å› å­å·®å€¼å†³å®šå¹¶é€šè¿‡æ—‹è½¬æ¥å®ç°ï¼Œå·¦å³å­æ ‘æ ‘é«˜å·®ä¸è¶…è¿‡1ï¼Œé‚£ä¹ˆå’Œçº¢é»‘æ ‘æ¯”è¾ƒå®ƒæ˜¯ä¸¥æ ¼çš„å¹³è¡¡äºŒå‰æ ‘ï¼Œå¹³è¡¡æ¡ä»¶éå¸¸ä¸¥æ ¼ï¼ˆæ ‘é«˜å·®åªæœ‰1ï¼‰ï¼Œåªè¦æ’å…¥æˆ–åˆ é™¤ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶å°±è¦é€šè¿‡æ—‹è½¬æ¥ä¿æŒå¹³è¡¡ã€‚ç”±äºæ—‹è½¬æ˜¯éå¸¸è€—è´¹æ—¶é—´çš„ã€‚æˆ‘ä»¬å¯ä»¥æ¨å‡ºAVLæ ‘é€‚åˆç”¨äºæ’å…¥åˆ é™¤æ¬¡æ•°æ¯”è¾ƒå°‘ï¼Œä½†æŸ¥æ‰¾å¤šçš„æƒ…å†µã€‚&lt;/p&gt;

&lt;p&gt;çº¢é»‘æ ‘ï¼šå¹³è¡¡äºŒå‰æ ‘ï¼Œé€šè¿‡å¯¹ä»»ä½•ä¸€æ¡ä»æ ¹åˆ°å¶å­çš„ç®€å•è·¯å¾„ä¸Šå„ä¸ªèŠ‚ç‚¹çš„é¢œè‰²è¿›è¡Œçº¦æŸï¼Œç¡®ä¿æ²¡æœ‰ä¸€æ¡è·¯å¾„ä¼šæ¯”å…¶ä»–è·¯å¾„é•¿2å€ï¼Œå› è€Œæ˜¯è¿‘ä¼¼å¹³è¡¡çš„ã€‚æ‰€ä»¥ç›¸å¯¹äºä¸¥æ ¼è¦æ±‚å¹³è¡¡çš„AVLæ ‘æ¥è¯´ï¼Œå®ƒçš„æ—‹è½¬ä¿æŒå¹³è¡¡æ¬¡æ•°è¾ƒå°‘ã€‚ç”¨äºæœç´¢æ—¶ï¼Œæ’å…¥åˆ é™¤æ¬¡æ•°å¤šçš„æƒ…å†µä¸‹æˆ‘ä»¬å°±ç”¨çº¢é»‘æ ‘æ¥å–ä»£AVLã€‚ï¼ˆç°åœ¨éƒ¨åˆ†åœºæ™¯ä½¿ç”¨è·³è¡¨æ¥æ›¿æ¢çº¢é»‘æ ‘ï¼Œå¯æœç´¢â€œä¸ºå•¥ redis ä½¿ç”¨è·³è¡¨(skiplist)è€Œä¸æ˜¯ä½¿ç”¨ red-blackï¼Ÿâ€ï¼‰&lt;/p&gt;

&lt;p&gt;Bæ ‘ï¼ŒB+æ ‘ï¼šå®ƒä»¬ç‰¹ç‚¹æ˜¯ä¸€æ ·çš„ï¼Œæ˜¯å¤šè·¯æŸ¥æ‰¾æ ‘ï¼Œä¸€èˆ¬ç”¨äºæ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œä¸º ä»€ä¹ˆï¼Œå› ä¸ºå®ƒä»¬åˆ†æ”¯å¤šå±‚æ•°å°‘å‘—ï¼Œéƒ½çŸ¥é“ç£ç›˜IOæ˜¯éå¸¸è€—æ—¶çš„ï¼Œè€Œåƒå¤§é‡æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸­æ‰€ä»¥æˆ‘ä»¬è¦æœ‰æ•ˆçš„å‡å°‘ç£ç›˜IOæ¬¡æ•°é¿å…ç£ç›˜é¢‘ç¹çš„æŸ¥æ‰¾ã€‚B+æ ‘æ˜¯Bæ ‘çš„å˜ç§æ ‘ï¼Œæœ‰næ£µå­æ ‘çš„èŠ‚ç‚¹ä¸­å«æœ‰nä¸ªå…³é”®å­—ï¼Œæ¯ä¸ªå…³é”®å­—ä¸ä¿å­˜æ•°æ®ï¼Œåªç”¨æ¥ç´¢å¼•ï¼Œæ•°æ®éƒ½ä¿å­˜åœ¨å¶å­èŠ‚ç‚¹ã€‚æ˜¯ä¸ºæ–‡ä»¶ç³»ç»Ÿè€Œç”Ÿçš„ã€‚&lt;/p&gt;

&lt;p&gt;Trieæ ‘ï¼šåˆåå•è¯æŸ¥æ‰¾æ ‘ï¼Œä¸€ç§æ ‘å½¢ç»“æ„ï¼Œå¸¸ç”¨æ¥æ“ä½œå­—ç¬¦ä¸²ã€‚å®ƒæ˜¯ä¸åŒå­—ç¬¦ä¸²çš„ç›¸åŒå‰ç¼€åªä¿å­˜ä¸€ä»½ã€‚ç›¸å¯¹ç›´æ¥ä¿å­˜å­—ç¬¦ä¸²è‚¯å®šæ˜¯èŠ‚çœç©ºé—´çš„ï¼Œä½†æ˜¯å®ƒä¿å­˜å¤§é‡å­—ç¬¦ä¸²æ—¶ä¼šå¾ˆè€—è´¹å†…å­˜ï¼ˆæ˜¯å†…å­˜ï¼‰ã€‚ç±»ä¼¼çš„æœ‰å‰ç¼€æ ‘(prefix tree)ï¼Œåç¼€æ ‘(suffix tree)ï¼Œradix tree(patricia tree, compact prefix tree)ï¼Œcrit-bit treeï¼ˆè§£å†³è€—è´¹å†…å­˜é—®é¢˜ï¼‰ï¼Œä»¥åŠå‰é¢è¯´çš„double array trieã€‚ç®€å•çš„è¡¥å……ä¸‹æˆ‘äº†è§£åº”ç”¨å‰ç¼€æ ‘ï¼šå­—ç¬¦ä¸²å¿«é€Ÿæ£€ç´¢ï¼Œå­—ç¬¦ä¸²æ’åºï¼Œæœ€é•¿å…¬å…±å‰ç¼€ï¼Œè‡ªåŠ¨åŒ¹é…å‰ç¼€æ˜¾ç¤ºåç¼€ã€‚åç¼€æ ‘ï¼šæŸ¥æ‰¾å­—ç¬¦ä¸²s1åœ¨s2ä¸­ï¼Œå­—ç¬¦ä¸²s1åœ¨s2ä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œå­—ç¬¦ä¸²s1,s2æœ€é•¿å…¬å…±éƒ¨åˆ†ï¼Œæœ€é•¿å›æ–‡ä¸²ã€‚radix treeï¼šlinuxå†…æ ¸ï¼Œnginxã€‚&lt;/p&gt;
</description>
        <pubDate>Wed, 13 Dec 2017 00:00:00 +0800</pubDate>
        <link>https://xiazemin.github.io/MyBlog/web/2017/12/13/tree.html</link>
        <guid isPermaLink="true">https://xiazemin.github.io/MyBlog/web/2017/12/13/tree.html</guid>
        
        
        <category>web</category>
        
      </item>
    
      <item>
        <title>sbt</title>
        <description>&lt;!-- more --&gt;
&lt;p&gt;SBT = (not so) Simple Build Tool,æ˜¯scalaçš„æ„å»ºå·¥å…·ï¼Œä¸javaçš„mavenåœ°ä½ç›¸åŒã€‚å…¶è®¾è®¡å®—æ—¨æ˜¯è®©ç®€å•çš„é¡¹ç›®å¯ä»¥ç®€å•çš„é…ç½®ï¼Œè€Œå¤æ‚çš„é¡¹ç›®å¯ä»¥å¤æ‚çš„é…ç½®ã€‚ã€‚ã€‚
sbté¡¹ç›®çš„ç›®å½•è§„çº¦
å’Œmavenä¸€æ ·ï¼Œsbtæœ‰çº¦å®šäº†ä¸€ä¸ªé€šç”¨çš„ç›®å½•ç»“æ„ï¼Œä½¿ç”¨çº¦å®šçš„ç»“æ„ä¼šä½¿åé¢çš„å·¥ä½œç®€å•å¾ˆå¤šã€‚
base/&lt;br /&gt;
          build.sbt              //æ„å»ºé…ç½®æ–‡ä»¶
         /project                 //ä¹Ÿæ˜¯æ„å»ºé…ç½®çš„ä¸€éƒ¨åˆ†
                      /build.scala                         //é«˜çº§é…ç½®ï¼Œå¯é€‰
         /src/
                /main
                          /scala
                          /java
                         /resources
               /test
                          /scala
                          /java
                         /resources
baseä»£è¡¨é¡¹ç›®çš„æ ¹ç›®å½•
é¡¹ç›®é…ç½®å¯ä»¥åœ¨build.sbtæ–‡ä»¶é‡Œå®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨base/project/build.scalaæ–‡ä»¶é‡Œå®šä¹‰ï¼Œä¸€èˆ¬æƒ…å†µä¸‹build.sbtå°±å·²ç»è¶³å¤Ÿï¼Œé™¤éå¤šå·¥ç¨‹é¡¹ç›®æˆ–è€…éœ€è¦å¾ˆå¤šç‰¹æ®Šå®šä¹‰çš„é¡¹ç›®
å¸¸ç”¨å‘½ä»¤
åœ¨æˆ‘è¯»å®Œsbtçš„getting startedæ–‡æ¡£ä¹‹å‰ï¼Œæˆ‘ä¹Ÿç»å¸¸æœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆscalaä¸æ²¿ç”¨mavenï¼Œè€Œè¦æå‡ºsbtè¿™ä¹ˆä¸ª(not so simple) Simple Build Tool ï¼Ÿ
åœ¨è¯»å®Œæ–‡æ¡£ï¼Œå¹¶å®é™…æ“ä½œåï¼Œæˆ‘ç°åœ¨æ„Ÿè§‰ç¡®å®æ˜¯ç‰©æœ‰æ‰€å€¼çš„ã€‚
checkout æˆ‘çš„sbtTempleé¡¹ç›®åï¼Œè¿›å…¥å‘½ä»¤è¡Œï¼Œè¿›å…¥åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œè¾“å…¥sbtå›è½¦è¿›å…¥sbtäº¤äº’æ¨¡å¼
sbtæœ‰å“ªäº›å‘½ä»¤å¯ç”¨ï¼Ÿè¾“å…¥helpå‘½ä»¤æŸ¥è¯¢ï¼Œå³ä¼šåˆ—å‡ºä¸€å †å¯ç”¨çš„å‘½ä»¤ï¼Œæ¯”å¦‚exit,reloadç­‰ï¼Œä¸çŸ¥é“æŸä¸ªå‘½ä»¤çš„ä½œç”¨ï¼Ÿhelp å‘½ä»¤åï¼Œæ¯”å¦‚è¾“å…¥help exitæ˜¾ç¤ºexitå‘½ä»¤çš„ä½œç”¨ã€‚ 
åˆ—å‡ºçš„å‘½ä»¤é‡Œå¹¶æ²¡æœ‰compile,testç­‰å¸¸ç”¨çš„å‘½ä»¤ï¼Ÿå› ä¸ºé‚£äº›ä¸æ˜¯sbtçš„å‘½ä»¤è€Œæ˜¯å½“å‰å·¥ç¨‹çš„task. è¾“å…¥ taskså‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹è§ compile,test,packageç­‰ç­‰ä»»åŠ¡çš„è¯´æ˜äº†ã€‚
æƒ³æŸ¥çœ‹é¡¹ç›®çš„é…ç½®ï¼Ÿç”¨showå‘½ä»¤ï¼Œè¾“å…¥show name,çœ‹å½“å‰é¡¹ç›®çš„åå­—ï¼Œè¾“å…¥show libraryDependenciesçœ‹å½“å‰é¡¹ç›®ä¾èµ–çš„åº“ï¼ŒlibraryDependencieså¤ªé•¿è®°ä¸ä½ï¼Ÿè¾“å…¥libåæŒ‰tabé”®ï¼ äº¤äº’çª—å£æ˜¯æœ‰tabæç¤ºçš„ï¼è¾“å…¥help showï¼Œä½ å¯ä»¥çœ‹åˆ°showå‘½ä»¤çš„ä½œç”¨æ˜¯æ˜¾ç¤ºé…ç½®çš„å€¼ï¼Œå¦‚æœshowä¹‹åè·Ÿçš„æ˜¯ä»»åŠ¡ï¼Œåˆ™æ‰§è¡Œè¯¥ä»»åŠ¡å¹¶æ˜¾ç¤ºä»»åŠ¡æ‰§è¡Œçš„ç»“æœã€‚ ä½ å¯ä»¥è¯•è¯•show compileçœ‹ä»€ä¹ˆç»“æœ,å¦‚æœä½ ä¸æƒ³æ‰§è¡Œcompileï¼Œè€Œæ˜¯æƒ³çœ‹å‘½ä»¤çš„è¯´æ˜ï¼Œè¯·ç”¨inspectå‘½ä»¤,inspectå‘½ä»¤æ¯”è¾ƒå¤æ‚ï¼Œæ‰§è¡Œåè¾“å‡ºçš„ç»“æœä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œå…·ä½“è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ä»€ä¹ˆè¯·help inspect, ä¸è¿‡å¾—ç­‰ç†è§£äº†build definitionçš„å«ä¹‰åæ‰èƒ½çœ‹æ‡‚helpè¯´çš„æ˜¯ä»€ä¹ˆã€‚ã€‚ã€‚
å¸¸ç”¨çš„ä»»åŠ¡åˆ™æœ‰compile, test, run,package,docç­‰ï¼Œè¯·é¡¾åæ€ä¹‰æˆ–è‡ªè¡Œhelpä¹‹ã€‚å¦å¤–è¿™äº›ä»»åŠ¡å¸¸å¸¸è¿˜æœ‰äº›å˜ç§ï¼Œæ¯”å¦‚package-doc,package-srcç­‰ï¼Œç”¨taskså‘½ä»¤æŸ¥çœ‹ä»»åŠ¡çš„åˆ—è¡¨ï¼Œå¿…æœ‰ä¸€æ¬¾é€‚åˆæ‚¨
æœ‰ä¸€ä¸ªå¼ºå¤§çš„ä»»åŠ¡ä¸å¾—ä¸ç‰¹åˆ«æ‹å‡ºæ¥è¯´ä¸€ä¸‹ï¼šconsole
è¾“å…¥consoleå›è½¦ï¼Œä¼šåœ¨å½“å‰ä¼šè¯å†…å¯åŠ¨ä¸€ä¸ªREPLï¼Œä¸è¦å‘Šè¯‰æˆ‘ä½ ä¸çŸ¥é“REPLæ˜¯scalaè§£é‡Šå™¨çš„æ„æ€ã€‚ã€‚ã€‚å°±æ˜¯ä½ åœ¨å‘½ä»¤è¡Œä¸‹è¾“å…¥scalaå›è½¦åè¿›å…¥çš„é‚£ä¸ªäº¤äº’ç•Œé¢ã€‚
å¼ºå¤§çš„æ˜¯ï¼Œsbtä¼šåŠ è½½ä½ çš„é¡¹ç›®ä¾èµ–çš„å…¨éƒ¨jaråŒ…å’Œä½ è‡ªå·±çš„ä»£ç ï¼ ä½ å¯ä»¥åœ¨è¿™ä¸ªè§£é‡Šå™¨é‡Œå®éªŒä½ çš„åŠæˆå“ã€‚ æˆ‘çš„æ¨¡æ¿å·¥ç¨‹é‡Œæœ‰ä¸€ä¸ªsample/Account.scalaæ–‡ä»¶ï¼Œåå‡ è¡Œå¾ˆç®€å•çš„ä»£ç ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œç„¶ååœ¨consoleçª—å£é‡Œç©å¼„Accountç±»å’ŒAccountä¼´ç”Ÿå¯¹è±¡.  ä¸è¿‡åˆ«å¿˜äº†å…ˆimport sample._
å› ä¸ºä¾èµ–çš„jaråŒ…ä¹Ÿéƒ½è¢«åŠ è½½äº†ï¼Œæ‰€ä»¥å¯¹äºé‚£äº›ä½ å¯èƒ½è¿˜ä¸ç†Ÿæ‚‰çš„ç¬¬ä¸‰æ–¹åº“ï¼Œä½ æœ‰å¯ä»¥åœ¨consoleé‡Œç©ä¸ªç—›å¿«ï¼è¿™åŠŸèƒ½å¾ˆç»™åŠ›ï¼Œè°ç”¨è°çŸ¥é“ã€‚
é¡ºä¾¿åœ¨æä¸€ä¸‹ï¼Œsbtå‘½ä»¤æœ‰3ç§æ‰§è¡Œæ¨¡å¼ï¼š
1ã€äº¤äº’å¼ï¼Œå³ä¸Šæ–‡æ‰€æè¿°çš„
2ã€æ‰¹å¤„ç†å¼ï¼Œå³åœ¨å‘½ä»¤è¡Œä¸‹è¾“å…¥sbt å‘½ä»¤åæ¥æ‰§è¡Œï¼Œæ¯”å¦‚sbt compileå°±ä¼šç¼–è¯‘ä»£ç ï¼Œè€Œä¸è¿›å…¥äº¤äº’æ¨¡å¼
3ã€è¿ç»µä¸ç»å¼ï¼Œåœ¨å‘½ä»¤åå‰åŠ ä¸Š~å·ï¼Œå³ä¼šè¿›å…¥è¿ç»µä¸ç»æ¨¡å¼ï¼Œæ¯”å¦‚~compile,ä¼šç¼–è¯‘å½“å‰ä»£ç ï¼Œç„¶åç›‘å¬ä»£ç æ”¹å˜ï¼Œæ¯å½“ä½ ç¼–è¾‘äº†ä»£ç å¹¶ä¿å­˜åï¼Œsbtå°±ä¼šè‡ªåŠ¨ç¼–è¯‘ä»£ç ï¼Œ~testä¹Ÿä¸€æ ·ï¼Œå½“ä½ ä¿®æ”¹ä»£ç åè‡ªåŠ¨ç¼–è¯‘å¹¶è¿è¡Œå•å…ƒæµ‹è¯•ã€‚æŒ‰å›è½¦é”®å¯é€€å‡ºæ­¤æ¨¡å¼ã€‚
build definitioné‡Šä¹‰
ä½ å‰é¢åº”è¯¥è¯•è¿‡show nameå’Œshow libraryDependenciesäº†å§ï¼Ÿshowå‡ºæ¥çš„ç»“æœå°±æ˜¯æ¥è‡ªä½ çš„build.sbtæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯build definitionäº†ã€‚æ‰“å¼€build.sbtå°±å¯ä»¥çœ‹åˆ°name := â€œsbt11templateâ€  è¿˜æœ‰å…¶ä»–çš„ä¸€å †xxx := xxxxï¼Œå¾ˆæ˜¾ç„¶çš„ï¼Œè¿™å°±æ˜¯ä¸ªkey-value pair,  sbtå°±æ˜¯è¯»å–é…ç½®æ–‡ä»¶å¹¶æ„å»ºä¸€ä¸ªkey-valueçš„map. ä½†æ˜¯åœ¨build.sbté‡Œé¢å¹¶ékey := value, è€Œæ˜¯key := expression. æ–‡ä»¶é‡Œçš„æ¯ä¸€è¡Œå…¶å®æ˜¯ä¸€å¥scalaè¯­å¥ï¼Œä¸è¡Œä½ å¯ä»¥è¯•è¯•æŠŠ
name := â€œsbt11templateâ€ æ”¹æˆ
name := {â€œsbt11templateâ€.toUpperCase} 
ç„¶åreload,  å†show name,ä½ ä¼šçœ‹åˆ°å˜æˆå¤§å†™çš„SBT11TEMPLATE
:=æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œå…¶ä½œç”¨å°±æ˜¯å°†keyè®¾ç½®æˆexpressionçš„å€¼ï¼Œç›¸åŒçš„keyå¦‚æœè¢«å¤šæ¬¡èµ‹å€¼ï¼Œåˆ™åé¢çš„å€¼ä¼šè¦†ç›–æ‰å‰é¢çš„å€¼ã€‚é€‚ç”¨äºç®€å•ç±»å‹çš„keyï¼Œæ¯”å¦‚name,versionç­‰ã€‚
å…¶ä»–çš„å¸¸ç”¨æ–¹æ³•æœ‰
+=ï¼Œå°†å€¼æ·»åŠ è¿›ç°æœ‰å€¼é‡Œï¼Œé€‚ç”¨äºé›†åˆç±»å‹çš„keyï¼Œæ¯”å¦‚libraryDependencies
++=,å°†ä¸€ä¸ªé›†åˆå€¼åŠ å…¥å½“å‰é›†åˆé‡Œ
~= ï¼Œã€‚ã€‚è¿™ä¸ªç‰›Xï¼Œä½ åœ¨~=åé¢å†™ä¸ªå‡½æ•°ï¼Œ~=å°†keyçš„å½“å‰å€¼ä¼ ç»™ä½ çš„å‡½æ•°ï¼Œç„¶åå°†å‡½æ•°ç»“æœä½œä¸ºæ–°å€¼ï¼Œæ¯”å¦‚ä½ å¯ä»¥åœ¨name := xxxåé¢å†æ¥ä¸€å¥ 
name ~= { _. toUpperCase },ä¸€æ ·æ˜¯æŠŠnameå˜æˆå¤§å†™
Â«= å°†å¦ä¸€ä¸ªkeyçš„å€¼èµ‹ç»™å½“å‰key,æ¯”å¦‚auther Â«= name ,è¿™ä¸ªæ–¹æ³•è¿˜æœ‰ä¸ªé«˜çº§ç”¨æ³•ï¼Œä½ å¯ä»¥ç»„åˆå¤šä¸ªå…¶ä»–keyçš„å€¼ï¼Œèµ‹ç»™å½“å‰keyï¼Œç”¨æ–‡æ¡£é‡Œçš„ä¾‹å­
name Â«= (name, organization, version) { (n, o, v) =&amp;gt; â€œproject â€œ + n + â€œ from â€œ + o + â€œ version â€œ + v }
è¿˜æœ‰é€‚ç”¨äºé›†åˆç±»å‹çš„ç‰ˆæœ¬
&amp;lt;+= å’Œ &amp;lt;++=
è¿™äº›è¯­æ³•çš„å®˜æ–¹æ–‡æ¡£åœ¨æ­¤https://github.com/harrah/xsbt/wiki/Getting-Started-More-About-Settings&lt;/p&gt;

&lt;p&gt;ä¾èµ–ç®¡ç†
å¯¹äºä¸æ‰“ç®—é€šè¿‡å®˜æ–¹repositoryç®¡ç†çš„ç¬¬ä¸‰æ–¹åº“ï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹å»ºä¸ªlibç›®å½•ï¼ŒæŠŠjaråŒ…æ‰”è¿›å»å°±è¡Œäº†ã€‚
å¸Œæœ›sbtå¾…ä¸ºç®¡ç†çš„åˆ™åœ¨build.sbté‡Œç”¨ä¸‹é¢çš„è¯­æ³•åŠ å…¥
libraryDependencies += groupID % artifactID % revision % configuration
% configurationæ˜¯å¯é€‰çš„ï¼Œè¡¨ç¤ºæŸä¾èµ–åº“åªåœ¨ç‰¹å®šé…ç½®ä¸­éœ€è¦ï¼Œæ¯”å¦‚æ¨¡æ¿é¡¹ç›®é‡Œçš„â€org.specs2â€ %% â€œspecs2â€ % â€œ1.7.1â€ % â€œtestâ€ æ˜¯å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œåªåœ¨æµ‹è¯•æ—¶éœ€è¦ã€‚
å¦‚æœä½ è§†åŠ›å¥½ï¼Œä¼šçœ‹åˆ°å…¶ä¸­æœ‰ä¸ª %%ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª%ï¼Œè¿™è¡¨ç¤ºè¦æ±‚sbtå¯»æ‰¾ç”¨å½“å‰ä½ é…ç½®çš„scalaç‰ˆæœ¬ç¼–è¯‘å‡ºæ¥çš„jaråŒ…ï¼Œè¿™æ˜¯å› ä¸ºscalaä¸åŒç‰ˆæœ¬ç¼–è¯‘å‡ºæ¥çš„ç»“æœä¼šä¸å…¼å®¹ï¼ˆæ‚²å‰§ï¼‰ï¼Œå¸Œæœ›ä»¥åscalaç¤¾åŒºä¼šè§£å†³è¿™ä¸å…¼å®¹çš„é—®é¢˜ã€‚ã€‚ã€‚
å¯¹äºä¾èµ–çš„javaè¯­è¨€å†™çš„åº“çš„jaråŒ…ï¼Œå°±æ²¡è¿™é—®é¢˜äº†ï¼Œæ¯”å¦‚libraryDependencies += â€œorg.slf4jâ€ % â€œslf4j-apiâ€ % â€œ1.6.4â€ å°±ä¸éœ€è¦%%äº†
é…ç½®å¥½ä¾èµ–åï¼Œè¿è¡Œsbt updateï¼Œsbtä¼šè‡ªåŠ¨åˆ°mavenåº“å’Œscalaå®˜æ–¹åº“é‡Œå»æ‰¾è¿™äº›jaråŒ…å¹¶ä¸‹è½½åˆ°ä½ çš„ç”¨æˆ·ç›®å½•çš„.ivy2ç›®å½•é‡Œé¢ï¼Œå¦‚æœä½ ä¸åŒçš„é¡¹ç›®ç”¨äº†ç›¸åŒçš„åº“ï¼Œåˆ™sbtä¸‹è½½ä¸€æ¬¡å°±å¤Ÿäº†ã€‚
å¦‚æœä½ å¸Œæœ›sbtä»ä½ è‡ªå·±é…ç½®çš„repositoryé‡Œä¸‹è½½ï¼Œä½¿ç”¨è¿™ä¸ªè¯­æ³•ï¼š
resolvers += name at location
æ¯”å¦‚
resolvers += â€œScala-Tools Maven2 Snapshots Repositoryâ€ at â€œhttp://scala-tools.org/repo-snapshotsâ€
æ‰€æœ‰çš„ä¸€åˆ‡éƒ½æ˜¯é€šè¿‡keyç±»é…ç½®çš„ï¼Œkey çš„åˆ—è¡¨åœ¨http://harrah.github.com/xsbt/latest/sxr/Keys.scala.html  æ…¢æ…¢çœ‹å§ã€‚ã€‚ã€‚
sbtæ’ä»¶
ç°æœ‰çš„sbtæ’ä»¶çš„åˆ—è¡¨åœ¨https://github.com/harrah/xsbt/wiki/sbt-0.10-plugins-list   å®‰è£…çš„æ–¹æ³•å„æœ‰ä¸åŒï¼Œè¯·è‡ªå·±æŸ¥é˜…
æˆ‘çš„é¡¹ç›®æ¨¡æ¿é‡Œå·²ç»é…ç½®äº†sbteclipseæ’ä»¶,è¿è¡Œsbt eclipseæˆ–åœ¨äº¤äº’æ¨¡å¼ä¸‹è¾“å…¥eclipseå›è½¦å³ä¼šç”Ÿæˆç›¸åº”çš„eclipseé¡¹ç›®æ–‡ä»¶ï¼Œç„¶åä½ å°±å¯ä»¥åœ¨eclipseé‡Œç”¨import  /  existing projects into workspaceæ¥å¯¼å…¥äº†ã€‚
æ·»åŠ ä¾èµ–&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªç®€å•çš„è§£æå™¨å¯¹äºè¿™ç‚¹è¾“å…¥å†…å®¹æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦åŠ å…¥æµ‹è¯•ä»£ç å¹¶ä¸”å¯¹å®ƒè¿›è¡Œä¸€äº›æ”¹é€ ã€‚é¦–å…ˆè¦åšçš„å°±æ˜¯æŠŠspecsæµ‹è¯•åº“ä»¥åŠä¸€ä¸ªçœŸæ­£çš„JSONè§£æå™¨åŠ å…¥åˆ°æˆ‘ä»¬çš„å·¥ç¨‹é‡Œæ¥ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é»˜è®¤çš„å·¥ç¨‹ç»“æ„ä¸Šè¿›è¡Œæ”¹é€ ï¼Œç„¶ååˆ›å»ºé¡¹ç›®ã€‚æŠŠä¸‹é¢çš„å†…å®¹æ·»åŠ åˆ°project/build/SampleProject.scalaé‡Œï¼š&lt;/p&gt;

&lt;p&gt;import sbt._&lt;/p&gt;

&lt;p&gt;class SampleProject(info: ProjectInfo) extends DefaultProject(info) {
  val jackson = â€œorg.codehaus.jacksonâ€ % â€œjackson-core-aslâ€ % â€œ1.6.1â€
  val specs = â€œorg.scala-tools.testingâ€ % â€œspecs_2.8.0â€ % â€œ1.6.5â€ % â€œtestâ€
}
å¸¸ç”¨å‘½ä»¤&lt;/p&gt;

&lt;p&gt;actions â€“ æ˜¾ç¤ºå¯¹å½“å‰å·¥ç¨‹å¯ç”¨çš„å‘½ä»¤
update â€“ ä¸‹è½½ä¾èµ–
compile â€“ ç¼–è¯‘ä»£ç 
test â€“ è¿è¡Œæµ‹è¯•ä»£ç 
package â€“ åˆ›å»ºä¸€ä¸ªå¯å‘å¸ƒçš„jaråŒ…
publish-local â€“ æŠŠæ„å»ºå‡ºæ¥çš„jaråŒ…å®‰è£…åˆ°æœ¬åœ°çš„ivyç¼“å­˜
publish â€“ æŠŠjaråŒ…å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ï¼ˆå¦‚æœé…ç½®äº†çš„è¯)
æ›´å¤šå‘½ä»¤&lt;/p&gt;

&lt;p&gt;test-failed â€“ è¿è¡Œå¤±è´¥çš„spec
test-quick â€“ è¿è¡Œæ‰€æœ‰å¤±è´¥çš„ä»¥åŠ/æˆ–è€…æ˜¯ç”±ä¾èµ–æ›´æ–°çš„spec
clean-cache â€“ æ¸…é™¤æ‰€æœ‰çš„sbtç¼“å­˜ã€‚ç±»ä¼¼äºsbtçš„cleanå‘½ä»¤
clean-lib â€“ åˆ é™¤lib_managedä¸‹çš„æ‰€æœ‰å†…å®¹&lt;/p&gt;

&lt;p&gt;sbtç»“æ„è¯´æ˜&lt;/p&gt;

&lt;p&gt;åŸºç¡€ç›®å½•&lt;/p&gt;

&lt;p&gt;åœ¨ sbt çš„æœ¯è¯­é‡Œï¼Œâ€œåŸºç¡€ç›®å½•â€æ˜¯åŒ…å«é¡¹ç›®çš„ç›®å½•ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªå’Œ Hello, World ä¸€æ ·çš„é¡¹ç›®hello ï¼ŒåŒ…å« hello/build.sbt å’Œ hello/hw.scalaï¼Œ hello å°±æ˜¯åŸºç¡€ç›®å½•ã€‚&lt;/p&gt;

&lt;p&gt;æºä»£ç &lt;/p&gt;

&lt;p&gt;æºä»£ç å¯ä»¥åƒ hello/hw.scala ä¸€æ ·çš„æ”¾åœ¨é¡¹ç›®çš„åŸºç¡€ç›®å½•ä¸­ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°äººä¸ä¼šåœ¨çœŸå®çš„é¡¹ç›®ä¸­è¿™æ ·åšï¼Œå› ä¸ºå¤ªæ‚ä¹±äº†ã€‚ sbt å’Œ Maven çš„é»˜è®¤çš„æºæ–‡ä»¶çš„ç›®å½•ç»“æ„æ˜¯ä¸€æ ·çš„ï¼ˆæ‰€æœ‰çš„è·¯å¾„éƒ½æ˜¯ç›¸å¯¹äºåŸºç¡€ç›®å½•çš„ï¼‰ï¼š&lt;/p&gt;

&lt;p&gt;src/
  main/
    resources/
       &lt;files to=&quot;&quot; include=&quot;&quot; in=&quot;&quot; main=&quot;&quot; jar=&quot;&quot; here=&quot;&quot;&gt;
    scala/
       &amp;lt;main Scala sources&amp;gt;
    java/
       &amp;lt;main Java sources&amp;gt;
  test/
    resources
       &lt;files to=&quot;&quot; include=&quot;&quot; in=&quot;&quot; test=&quot;&quot; jar=&quot;&quot; here=&quot;&quot;&gt;
    scala/
       &lt;test Scala=&quot;&quot; sources=&quot;&quot;&gt;
    java/
       &lt;test Java=&quot;&quot; sources=&quot;&quot;&gt;
src/ ä¸­å…¶ä»–çš„ç›®å½•å°†è¢«å¿½ç•¥ã€‚è€Œä¸”ï¼Œæ‰€æœ‰çš„éšè—ç›®å½•ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚&lt;/test&gt;&lt;/test&gt;&lt;/files&gt;&lt;/files&gt;&lt;/p&gt;

&lt;p&gt;æ„å»ºäº§å“&lt;/p&gt;

&lt;p&gt;æ„å»ºå‡ºæ¥çš„æ–‡ä»¶ï¼ˆç¼–è¯‘çš„ classesï¼Œæ‰“åŒ…çš„ jarsï¼Œæ‰˜ç®¡æ–‡ä»¶ï¼Œcaches å’Œæ–‡æ¡£ï¼‰é»˜è®¤å†™åœ¨ target ç›®å½•ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;äº¤äº’æ¨¡å¼&lt;/p&gt;

&lt;p&gt;åœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œ sbt ä¸è·Ÿä»»ä½•å‚æ•°ï¼š&lt;/p&gt;

&lt;p&gt;$ sbt
æ‰§è¡Œ sbt ä¸è·Ÿä»»ä½•å‘½ä»¤è¡Œå‚æ•°å°†ä¼šè¿›å…¥äº¤äº’æ¨¡å¼ã€‚äº¤äº’æ¨¡å¼æœ‰ä¸€ä¸ªå‘½ä»¤è¡Œï¼ˆå«æœ‰ tab è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½å’Œå†å²è®°å½•ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œåœ¨ sbt å‘½ä»¤è¡Œé‡Œè¾“å…¥ compileï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;compile
å†æ¬¡ compileï¼Œåªéœ€è¦æŒ‰å‘ä¸Šçš„æ–¹å‘é”®ï¼Œç„¶åå›è½¦ã€‚ è¾“å…¥ run æ¥å¯åŠ¨ç¨‹åºã€‚ è¾“å…¥ exit æˆ–è€… Ctrl+D ï¼ˆUnixï¼‰æˆ–è€… Ctrl+Z ï¼ˆWindowsï¼‰å¯ä»¥é€€å‡ºäº¤äº’æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ‰¹å¤„ç†æ¨¡å¼&lt;/p&gt;

&lt;p&gt;ä½ ä¹Ÿå¯ä»¥ç”¨æ‰¹å¤„ç†æ¨¡å¼æ¥è¿è¡Œ sbtï¼Œå¯ä»¥ä»¥ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦æŒ‡å®šå‚æ•°ã€‚å¯¹äºæ¥å—å‚æ•°çš„ sbt å‘½ä»¤ï¼Œå°†å‘½ä»¤å’Œå‚æ•°ç”¨å¼•å·å¼•èµ·æ¥ä¸€èµ·ä¼ ç»™ sbtã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;p&gt;$ sbt clean compile â€œtestOnly TestA TestBâ€
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒtestOnly æœ‰ä¸¤ä¸ªå‚æ•° TestA å’Œ TestBã€‚è¿™ä¸ªå‘½ä»¤ä¼šæŒ‰é¡ºåºæ‰§è¡Œï¼ˆcleanï¼Œ compileï¼Œ ç„¶å testOnlyï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å¸¸ç”¨å‘½ä»¤&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æ˜¯ä¸€äº›éå¸¸å¸¸ç”¨çš„çš„ sbt å‘½ä»¤ã€‚æ›´åŠ è¯¦ç»†çš„åˆ—è¡¨è¯·å‚è§ å‘½ä»¤è¡Œå‚è€ƒã€‚&lt;/p&gt;

&lt;p&gt;clean	åˆ é™¤æ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶ ï¼ˆåœ¨ target ç›®å½•ä¸‹ï¼‰ã€‚
compile	ç¼–è¯‘æºæ–‡ä»¶ï¼ˆåœ¨ src/main/scala å’Œ src/main/java ç›®å½•ä¸‹ï¼‰ã€‚
test	ç¼–è¯‘å’Œè¿è¡Œæ‰€æœ‰æµ‹è¯•ã€‚
console	è¿›å…¥åˆ°ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç¼–è¯‘çš„æ–‡ä»¶å’Œæ‰€æœ‰ä¾èµ–çš„ classpath çš„ Scala è§£æå™¨ã€‚è¾“å…¥ :quitï¼Œ Ctrl+D ï¼ˆUnixï¼‰ï¼Œæˆ–è€… Ctrl+Z ï¼ˆWindowsï¼‰ è¿”å›åˆ° sbtã€‚
run &lt;å‚æ•°&gt;*	åœ¨å’Œ sbt æ‰€å¤„çš„åŒä¸€ä¸ªè™šæ‹Ÿæœºä¸Šæ‰§è¡Œé¡¹ç›®çš„ main classã€‚
package	å°† src/main/resources ä¸‹çš„æ–‡ä»¶å’Œ src/main/scala ä»¥åŠ src/main/java ä¸­ç¼–è¯‘å‡ºæ¥çš„ class æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª jar æ–‡ä»¶ã€‚
help &lt;å‘½ä»¤&gt;	æ˜¾ç¤ºæŒ‡å®šçš„å‘½ä»¤çš„è¯¦ç»†å¸®åŠ©ä¿¡æ¯ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‘½ä»¤ï¼Œä¼šæ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤çš„ç®€ä»‹ã€‚
reload	é‡æ–°åŠ è½½æ„å»ºå®šä¹‰ï¼ˆbuild.sbtï¼Œ project/*.scalaï¼Œ project/*.sbt è¿™äº›æ–‡ä»¶ä¸­å®šä¹‰çš„å†…å®¹)ã€‚åœ¨ä¿®æ”¹äº†æ„å»ºå®šä¹‰æ–‡ä»¶ä¹‹åéœ€è¦é‡æ–°åŠ è½½ã€‚
æ·»åŠ ä¾èµ–åº“&lt;/å‘½ä»¤&gt;&lt;/å‚æ•°&gt;&lt;/p&gt;

&lt;p&gt;æœ‰ä¸¤ç§æ–¹å¼æ·»åŠ ç¬¬ä¸‰æ–¹çš„ä¾èµ–ã€‚ä¸€ç§æ˜¯å°† jar æ–‡ä»¶ æ”¾å…¥ lib/ï¼ˆéæ‰˜ç®¡çš„ä¾èµ–ï¼‰ä¸­ï¼Œå¦ä¸€ç§æ˜¯åœ¨build.sbt ä¸­æ·»åŠ æ‰˜ç®¡çš„ä¾èµ–ï¼Œåƒè¿™æ ·ï¼š&lt;/p&gt;

&lt;p&gt;val derby = â€œorg.apache.derbyâ€ % â€œderbyâ€ % â€œ10.4.1.3â€&lt;/p&gt;

&lt;p&gt;lazy val commonSettings = Seq(
  organization := â€œcom.exampleâ€,
  version := â€œ0.1.0â€,
  scalaVersion := â€œ2.11.4â€
)&lt;/p&gt;

&lt;p&gt;lazy val root = (project in file(â€œ.â€)).
  settings(commonSettings: _*).
  settings(
    name := â€œhelloâ€,
    libraryDependencies += derby
  )&lt;/p&gt;

</description>
        <pubDate>Wed, 13 Dec 2017 00:00:00 +0800</pubDate>
        <link>https://xiazemin.github.io/MyBlog/spark/2017/12/13/sbt.html</link>
        <guid isPermaLink="true">https://xiazemin.github.io/MyBlog/spark/2017/12/13/sbt.html</guid>
        
        
        <category>spark</category>
        
      </item>
    
      <item>
        <title>radix tree</title>
        <description>&lt;p&gt;åŸºæ•°æ ‘&lt;/p&gt;

&lt;p&gt;å¯¹äºé•¿æ•´å‹æ•°æ®çš„æ˜ å°„ï¼Œå¦‚ä½•è§£å†³Hashå†²çªå’ŒHashè¡¨å¤§å°çš„è®¾è®¡æ˜¯ä¸€ä¸ªå¾ˆå¤´ç–¼çš„é—®é¢˜ã€‚
radixæ ‘å°±æ˜¯é’ˆå¯¹è¿™ç§ç¨€ç–çš„é•¿æ•´å‹æ•°æ®æŸ¥æ‰¾ï¼Œèƒ½å¿«é€Ÿä¸”èŠ‚çœç©ºé—´åœ°å®Œæˆæ˜ å°„ã€‚å€ŸåŠ©äºRadixæ ‘ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å¯¹äºé•¿æ•´å‹æ•°æ®ç±»å‹çš„è·¯ç”±ã€‚åˆ©ç”¨radixæ ‘å¯ä»¥æ ¹æ®ä¸€ä¸ªé•¿æ•´å‹ï¼ˆæ¯”å¦‚ä¸€ä¸ªé•¿IDï¼‰å¿«é€ŸæŸ¥æ‰¾åˆ°å…¶å¯¹åº”çš„å¯¹è±¡æŒ‡é’ˆã€‚è¿™æ¯”ç”¨hashæ˜ å°„æ¥çš„ç®€å•ï¼Œä¹Ÿæ›´èŠ‚çœç©ºé—´ï¼Œä½¿ç”¨hashæ˜ å°„hashå‡½æ•°éš¾ä»¥è®¾è®¡ï¼Œä¸æ°å½“çš„hashå‡½æ•°å¯èƒ½å¢å¤§å†²çªï¼Œæˆ–æµªè´¹ç©ºé—´ã€‚&lt;/p&gt;

&lt;p&gt;radix treeæ˜¯ä¸€ç§å¤šå‰æœç´¢æ ‘ï¼Œæ ‘çš„å¶å­ç»“ç‚¹æ˜¯å®é™…çš„æ•°æ®æ¡ç›®ã€‚æ¯ä¸ªç»“ç‚¹æœ‰ä¸€ä¸ªå›ºå®šçš„ã€2^næŒ‡é’ˆæŒ‡å‘å­ç»“ç‚¹ï¼ˆæ¯ä¸ªæŒ‡é’ˆç§°ä¸ºæ§½slotï¼Œnä¸ºåˆ’åˆ†çš„åŸºçš„å¤§å°ï¼‰&lt;/p&gt;

&lt;p&gt;Radixæ ‘åœ¨Linuxä¸­çš„åº”ç”¨ï¼š
LinuxåŸºæ•°æ ‘ï¼ˆradix treeï¼‰æ˜¯å°†longæ•´æ•°é”®å€¼ä¸æŒ‡é’ˆç›¸å…³è”çš„æœºåˆ¶ï¼Œå®ƒå­˜å‚¨æœ‰æ•ˆç‡ï¼Œå¹¶ä¸”å¯å¿«é€ŸæŸ¥è¯¢ï¼Œç”¨äºæ•´æ•°å€¼ä¸æŒ‡é’ˆçš„æ˜ å°„ï¼ˆå¦‚ï¼šIDRæœºåˆ¶ï¼‰ã€å†…å­˜ç®¡ç†ç­‰ã€‚
IDRï¼ˆID Radixï¼‰æœºåˆ¶æ˜¯å°†å¯¹è±¡çš„èº«ä»½é‰´åˆ«å·æ•´æ•°å€¼IDä¸å¯¹è±¡æŒ‡é’ˆå»ºç«‹å…³è”è¡¨ï¼Œå®Œæˆä»IDä¸æŒ‡é’ˆä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚IDRæœºåˆ¶ä½¿ç”¨radixæ ‘çŠ¶ç»“æ„ä½œä¸ºç”±idè¿›è¡Œç´¢å¼•è·å–æŒ‡é’ˆçš„ç¨€ç–æ•°ç»„ï¼Œé€šè¿‡ä½¿ç”¨ä½å›¾å¯ä»¥å¿«é€Ÿåˆ†é…æ–°çš„IDï¼ŒIDRæœºåˆ¶é¿å…äº†ä½¿ç”¨å›ºå®šå°ºå¯¸çš„æ•°ç»„å­˜æ”¾æŒ‡é’ˆã€‚IDRæœºåˆ¶çš„APIå‡½æ•°åœ¨lib/idr.cä¸­å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;Linux radixæ ‘æœ€å¹¿æ³›çš„ç”¨é€”æ˜¯ç”¨äºå†…å­˜ç®¡ç†ï¼Œç»“æ„address_spaceé€šè¿‡radixæ ‘è·Ÿè¸ªç»‘å®šåˆ°åœ°å€æ˜ å°„ä¸Šçš„æ ¸å¿ƒé¡µï¼Œè¯¥radixæ ‘å…è®¸å†…å­˜ç®¡ç†ä»£ç å¿«é€ŸæŸ¥æ‰¾æ ‡è¯†ä¸ºdirtyæˆ–writebackçš„é¡µã€‚å…¶ä½¿ç”¨çš„æ˜¯æ•°æ®ç±»å‹unsigned longçš„å›ºå®šé•¿åº¦è¾“å…¥çš„ç‰ˆæœ¬ã€‚æ¯çº§ä»£è¡¨äº†è¾“å…¥ç©ºé—´å›ºå®šä½æ•°ã€‚Linux radixæ ‘çš„APIå‡½æ•°åœ¨lib/radix-tree.cä¸­å®ç°ã€‚ï¼ˆæŠŠé¡µæŒ‡é’ˆå’Œæè¿°é¡µçŠ¶æ€çš„ç»“æ„æ˜ å°„èµ·æ¥ï¼Œä½¿èƒ½å¿«é€ŸæŸ¥è¯¢ä¸€ä¸ªé¡µçš„ä¿¡æ¯ã€‚ï¼‰&lt;/p&gt;

&lt;p&gt;Linuxå†…æ ¸åˆ©ç”¨radixæ ‘åœ¨æ–‡ä»¶å†…åç§»å¿«é€Ÿå®šä½æ–‡ä»¶ç¼“å­˜é¡µã€‚ 
Linux(2.6.7) å†…æ ¸ä¸­çš„åˆ†å‰ä¸º 64(2^6)ï¼Œæ ‘é«˜ä¸º 6(64ä½ç³»ç»Ÿ)æˆ–è€… 11(32ä½ç³»ç»Ÿ)ï¼Œç”¨æ¥å¿«é€Ÿå®šä½ 32 ä½æˆ–è€… 64 ä½åç§»ï¼Œradix tree ä¸­çš„æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹æŒ‡å‘æ–‡ä»¶å†…ç›¸åº”åç§»æ‰€å¯¹åº”çš„Cacheé¡¹ã€‚&lt;/p&gt;

&lt;p&gt;ã€radixæ ‘ä¸ºç¨€ç–æ ‘æä¾›äº†æœ‰æ•ˆçš„å­˜å‚¨ï¼Œä»£æ›¿å›ºå®šå°ºå¯¸æ•°ç»„æä¾›äº†é”®å€¼åˆ°æŒ‡é’ˆçš„å¿«é€ŸæŸ¥æ‰¾ã€‚ã€‘&lt;/p&gt;

&lt;p&gt;radixæ ‘æ¦‚è¿°&lt;/p&gt;

&lt;p&gt;radixæ ‘æ˜¯é€šç”¨çš„å­—å…¸ç±»å‹æ•°æ®ç»“æ„ï¼Œradixæ ‘åˆç§°ä¸ºPATä½æ ‘ï¼ˆPatricia Trie or crit bit treeï¼‰ã€‚Linuxå†…æ ¸ä½¿ç”¨äº†æ•°æ®ç±»å‹unsigned longçš„å›ºå®šé•¿åº¦è¾“å…¥çš„ç‰ˆæœ¬ã€‚æ¯çº§ä»£è¡¨äº†è¾“å…¥ç©ºé—´å›ºå®šä½æ•°ã€‚
radix treeæ˜¯ä¸€ç§å¤šå‰æœç´¢æ ‘ï¼Œæ ‘çš„å¶å­ç»“ç‚¹æ˜¯å®é™…çš„æ•°æ®æ¡ç›®ã€‚æ¯ä¸ªç»“ç‚¹æœ‰ä¸€ä¸ªå›ºå®šçš„ã€2^næŒ‡é’ˆæŒ‡å‘å­ç»“ç‚¹ï¼ˆæ¯ä¸ªæŒ‡é’ˆç§°ä¸ºæ§½slotï¼‰ï¼Œå¹¶æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘çˆ¶ç»“ç‚¹ã€‚
Linuxå†…æ ¸åˆ©ç”¨radixæ ‘åœ¨æ–‡ä»¶å†…åç§»å¿«é€Ÿå®šä½æ–‡ä»¶ç¼“å­˜é¡µï¼Œå›¾4æ˜¯ä¸€ä¸ªradixæ ‘æ ·ä¾‹ï¼Œè¯¥radixæ ‘çš„åˆ†å‰ä¸º4(22)ï¼Œæ ‘é«˜ä¸º4ï¼Œæ ‘çš„æ¯ä¸ªå¶å­ç»“ç‚¹ç”¨æ¥å¿«é€Ÿå®šä½8ä½æ–‡ä»¶å†…åç§»ï¼Œå¯ä»¥å®šä½4x4x4x4=256é¡µï¼Œå¦‚ï¼šå›¾ä¸­è™šçº¿å¯¹åº”çš„ä¸¤ä¸ªå¶å­ç»“ç‚¹çš„è·¯å¾„ç»„æˆå€¼0x00000010å’Œ0x11111010ï¼ŒæŒ‡å‘æ–‡ä»¶å†…ç›¸åº”åç§»æ‰€å¯¹åº”çš„ç¼“å­˜é¡µ
&lt;!-- more --&gt;&lt;/p&gt;
&lt;div class=&quot;container&quot;&gt;
	&lt;div class=&quot;row&quot;&gt;
	&lt;img src=&quot;https://xiazemin.github.io/MyBlog/img/radix_tree.jpg&quot; /&gt;
	&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Linux radixæ ‘æ¯ä¸ªç»“ç‚¹æœ‰64ä¸ªslotï¼Œä¸æ•°æ®ç±»å‹longçš„ä½æ•°ç›¸åŒï¼Œå›¾1æ˜¾ç¤ºäº†ä¸€ä¸ªæœ‰3çº§ç»“ç‚¹çš„radixæ ‘ï¼Œæ¯ä¸ªæ•°æ®æ¡ç›®ï¼ˆitemï¼‰å¯ç”¨3ä¸ª6ä½çš„é”®å€¼ï¼ˆkeyï¼‰è¿›è¡Œç´¢å¼•ï¼Œé”®å€¼ä»å·¦åˆ°å³åˆ†åˆ«ä»£è¡¨ç¬¬1~3å±‚ç»“ç‚¹ä½ç½®ã€‚æ²¡æœ‰å­©å­çš„ç»“ç‚¹åœ¨å›¾ä¸­ä¸å‡ºç°ã€‚å› æ­¤ï¼Œradixæ ‘ä¸ºç¨€ç–æ ‘æä¾›äº†æœ‰æ•ˆçš„å­˜å‚¨ï¼Œä»£æ›¿å›ºå®šå°ºå¯¸æ•°ç»„æä¾›äº†é”®å€¼åˆ°æŒ‡é’ˆçš„å¿«é€ŸæŸ¥æ‰¾ã€‚ 
radixæ ‘slotæ•°&lt;/p&gt;

&lt;p&gt;Linuxå†…æ ¸æ ¹ç”¨æˆ·é…ç½®å°†æ ‘çš„slotæ•°å®šä¹‰ä¸º4æˆ–6ï¼Œå³æ¯ä¸ªç»“ç‚¹æœ‰16æˆ–64ä¸ªslotï¼Œå¦‚å›¾2æ‰€ç¤ºï¼Œå½“æ ‘é«˜ä¸º1æ—¶ï¼Œ64ä¸ªslotå¯¹åº”64ä¸ªé¡µï¼Œå½“æ ‘é«˜ä¸º2æ—¶ï¼Œå¯¹åº”64*64ä¸ªé¡µã€‚&lt;/p&gt;
</description>
        <pubDate>Wed, 13 Dec 2017 00:00:00 +0800</pubDate>
        <link>https://xiazemin.github.io/MyBlog/linux/2017/12/13/radix_tree.html</link>
        <guid isPermaLink="true">https://xiazemin.github.io/MyBlog/linux/2017/12/13/radix_tree.html</guid>
        
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>maven å®‰è£…</title>
        <description>&lt;!-- more --&gt;
&lt;p&gt;https://maven.apache.org/download.cgi?Preferred=http%3A%2F%2Fmirror.bit.edu.cn%2Fapache%2F
ä¸‹è½½ Maven, å¹¶è§£å‹åˆ°æŸä¸ªç›®å½•ã€‚ä¾‹å¦‚/Users/robbie/apache-maven-3.3.3&lt;/p&gt;

&lt;p&gt;æ‰“å¼€Terminal,è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œè®¾ç½®Maven classpath&lt;/p&gt;

&lt;p&gt;$ vi ~/.bash_profile
æ·»åŠ ä¸‹åˆ—ä¸¤è¡Œä»£ç ï¼Œä¹‹åä¿å­˜å¹¶é€€å‡ºViï¼š
export M2_HOME=/Users/robbie/apache-maven-3.3.3
export PATH=$PATH:$M2_HOME/bin&lt;/p&gt;

</description>
        <pubDate>Wed, 13 Dec 2017 00:00:00 +0800</pubDate>
        <link>https://xiazemin.github.io/MyBlog/spark/2017/12/13/maven.html</link>
        <guid isPermaLink="true">https://xiazemin.github.io/MyBlog/spark/2017/12/13/maven.html</guid>
        
        
        <category>spark</category>
        
      </item>
    
  </channel>
</rss>
